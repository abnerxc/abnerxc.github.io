<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Abnerçš„åšå®¢</title>
    <link>https://abnerxc.github.io/</link>
    <description>Recent content on Abnerçš„åšå®¢</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Sun, 25 Jan 2026 12:07:58 +0800</lastBuildDate><atom:link href="https://abnerxc.github.io/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>åœºæ™¯æ€»ç»“</title>
      <link>https://abnerxc.github.io/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/</link>
      <pubDate>Sun, 25 Jan 2026 12:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/</guid>
      <description>&lt;h1 id=&#34;é¡¹ç›®é‡Œç§’æ€å•†å“çš„è¯¦æƒ…é¡µqpsèƒ½åˆ°å¤šå°‘å¦‚æœçªç„¶é£™å‡åˆ°50ä¸‡qpsä¼šå‡ºç°ä»€ä¹ˆç“¶é¢ˆæ€ä¹ˆä¼˜åŒ–&#34;&gt;é¡¹ç›®é‡Œç§’æ€å•†å“çš„è¯¦æƒ…é¡µQPSèƒ½åˆ°å¤šå°‘?å¦‚æœçªç„¶é£™å‡åˆ°50ä¸‡QPSï¼Œä¼šå‡ºç°ä»€ä¹ˆç“¶é¢ˆ?æ€ä¹ˆä¼˜åŒ–? &lt;a href=&#34;#%e9%a1%b9%e7%9b%ae%e9%87%8c%e7%a7%92%e6%9d%80%e5%95%86%e5%93%81%e7%9a%84%e8%af%a6%e6%83%85%e9%a1%b5qps%e8%83%bd%e5%88%b0%e5%a4%9a%e5%b0%91%e5%a6%82%e6%9e%9c%e7%aa%81%e7%84%b6%e9%a3%99%e5%8d%87%e5%88%b050%e4%b8%87qps%e4%bc%9a%e5%87%ba%e7%8e%b0%e4%bb%80%e4%b9%88%e7%93%b6%e9%a2%88%e6%80%8e%e4%b9%88%e4%bc%98%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;åœºæ™¯&#34;&gt;åœºæ™¯ &lt;a href=&#34;#%e5%9c%ba%e6%99%af&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ç™¾äº¿è¡¥è´´è¯¦æƒ…é¡µé€šå¸¸åŒ…å«é™æ€ä¿¡æ¯ï¼ˆå›¾æ–‡ã€å‚æ•°ï¼‰å’ŒåŠ¨æ€ä¿¡æ¯ï¼ˆä»·æ ¼ã€åº“å­˜ã€ä¼˜æƒ ï¼‰ã€‚å¹³æ—¶QPSå¯èƒ½åœ¨å‡ åƒï¼Œä½†å¤§ä¿ƒæ—¶å¯èƒ½ç¬é—´é£™å‡è‡³50ä¸‡QPSã€‚&lt;/p&gt;
&lt;h2 id=&#34;50ä¸‡-qps-ä¸‹çš„ç“¶é¢ˆç‚¹&#34;&gt;50ä¸‡ QPS ä¸‹çš„ç“¶é¢ˆç‚¹ &lt;a href=&#34;#50%e4%b8%87-qps-%e4%b8%8b%e7%9a%84%e7%93%b6%e9%a2%88%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç½‘ç»œå¸¦å®½ç“¶é¢ˆï¼š è¯¦æƒ…é¡µHTMLå¾ˆå¤§ï¼ˆå‡ ç™¾KBï¼‰ï¼Œ50ä¸‡QPS * 200KB = 100Gbpsçš„å¸¦å®½å‡ºå£ï¼Œç¬é—´æ‰“æ»¡äº¤æ¢æœºå’Œç½‘å¡ã€‚&lt;/li&gt;
&lt;li&gt;CPU/è®¡ç®—ç“¶é¢ˆï¼š å¦‚æœåŠ¨æ€è®¡ç®—ä»·æ ¼æˆ–æ‹¼æ¥HTMLï¼ŒCPUä¼šæˆä¸ºç“¶é¢ˆï¼Œå°¤å…¶æ˜¯å¤§é‡çš„åºåˆ—åŒ–/ååºåˆ—åŒ–å’ŒJSONæ¸²æŸ“ã€‚&lt;/li&gt;
&lt;li&gt;Redis/DBç“¶é¢ˆï¼š å³ä½¿æ˜¯Redisï¼Œå•æœºQPSä¹Ÿå°±10ä¸‡å·¦å³ï¼Œä¸”50ä¸‡è¿æ¥ä¼šè€—å°½æ–‡ä»¶å¥æŸ„ï¼Œå¯¼è‡´è¿æ¥å»ºç«‹å¤±è´¥ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯è¿æ¥æ•°ï¼š é»˜è®¤çš„å†…æ ¸å‚æ•°ï¼ˆå¦‚ulimitï¼‰å’Œå…¨è¿æ¥é˜Ÿåˆ—å¯èƒ½è¢«å æ»¡ï¼Œå¯¼è‡´SYNä¸¢å¼ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¼˜åŒ–æ–¹æ¡ˆåˆ†å±‚æ¶æ„&#34;&gt;ä¼˜åŒ–æ–¹æ¡ˆï¼ˆåˆ†å±‚æ¶æ„ï¼‰ &lt;a href=&#34;#%e4%bc%98%e5%8c%96%e6%96%b9%e6%a1%88%e5%88%86%e5%b1%82%e6%9e%b6%e6%9e%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æŒ‰è°ƒç”¨é“¾æ‹†è§£ï¼šCDN â†’ Nginx â†’ å•†å“æœåŠ¡ â†’ Redis â†’ MySQL / ES&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é™æ€èµ„æºå…¨é¢CDNåŠ é€Ÿï¼ˆé™æ€åŒ–ï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š å°†å•†å“è¯¦æƒ…é¡µçš„HTMLã€å›¾ç‰‡ã€CSSã€JSå…¨éƒ¨é™æ€åŒ–ï¼Œæ¨é€åˆ°CDNè¾¹ç¼˜èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;æ•ˆæœï¼š 90%ä»¥ä¸Šçš„æµé‡ç›´æ¥åœ¨CDNè¾¹ç¼˜èŠ‚ç‚¹å“åº”ï¼Œæ ¹æœ¬ä¸ä¼šæ‰“åˆ°ä½ çš„æºç«™æœåŠ¡å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åŠ¨æ€å†…å®¹åˆ†ç¦»ï¼ˆåŠ¨é™åˆ†ç¦»ï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š å°†åŠ¨æ€å†…å®¹ï¼ˆä»·æ ¼ã€åº“å­˜ã€ä¼˜æƒ ï¼‰ä»HTMLä¸­åˆ†ç¦»å‡ºæ¥ï¼Œé€šè¿‡APIå¼‚æ­¥è·å–ã€‚&lt;/li&gt;
&lt;li&gt;æ•ˆæœï¼š åŠ¨æ€å†…å®¹çš„QPSå¯ä»¥å•ç‹¬è°ƒæ•´ï¼Œè€Œä¸ä¼šå½±å“é™æ€èµ„æºçš„è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¤šçº§ç¼“å­˜æ¶æ„ï¼š
&lt;ul&gt;
&lt;li&gt;æµè§ˆå™¨ç¼“å­˜ï¼š å¯¹é™æ€èµ„æºè®¾ç½®å¼ºç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;æœ¬åœ°ç¼“å­˜ï¼š åº”ç”¨æœåŠ¡å™¨éƒ¨ç½²L1ç¼“å­˜ï¼ˆå¦‚Guava/Caffeineæˆ–Golangçš„bigcacheï¼‰ã€‚ä»·æ ¼å˜æ›´ä¸é¢‘ç¹æ—¶ï¼Œç›´æ¥è¯»å†…å­˜ï¼ŒQPSå¯è¾¾ç™¾ä¸‡çº§ã€‚è®¾ç½®10~50msTTLï¼ŒæŠµæŒ¡ Redis æŠ–åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;Redisé›†ç¾¤ï¼š åšåˆ†ç‰‡ï¼Œé¿å¼€å•ç‚¹çƒ­ç‚¹ã€‚å¦‚ sku_stock:123 â†’ sku_stock:{123}_{0..9}ï¼Œé€šè¿‡ hash å–ä¸€ä¸ªå†™æ—¶å†™å¤šä¸ª key&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é™çº§å…œåº•ï¼š
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š Redis è¶…æ—¶ â†’ è¿”å›â€œåº“å­˜ç´§å¼ â€ã€‚&lt;/li&gt;
&lt;li&gt;æ•ˆæœï¼š ES è¶…æ—¶ â†’ è¿”å›é»˜è®¤æ’åº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ‹¼å•æˆåŠŸåéœ€åŒæ—¶æ‰£å‡å•†å“åº“å­˜æ›´æ–°æ‹¼å•çŠ¶æ€æ¨é€æˆåŠŸé€šçŸ¥å¦‚ä½•ä¿è¯è¿™ä¸‰ä¸ªæ“ä½œçš„åŸå­æ€§æ¯”è¾ƒseataatseatatccæœ¬åœ°æ¶ˆæ¯è¡¨çš„ä¼˜åŠ£&#34;&gt;æ‹¼å•æˆåŠŸåéœ€åŒæ—¶æ‰£å‡å•†å“åº“å­˜ã€æ›´æ–°æ‹¼å•çŠ¶æ€ã€æ¨é€æˆåŠŸé€šçŸ¥ï¼Œå¦‚ä½•ä¿è¯è¿™ä¸‰ä¸ªæ“ä½œçš„åŸå­æ€§?æ¯”è¾ƒSeataATã€SeataTCCã€æœ¬åœ°æ¶ˆæ¯è¡¨çš„ä¼˜åŠ£ã€‚ &lt;a href=&#34;#%e6%8b%bc%e5%8d%95%e6%88%90%e5%8a%9f%e5%90%8e%e9%9c%80%e5%90%8c%e6%97%b6%e6%89%a3%e5%87%8f%e5%95%86%e5%93%81%e5%ba%93%e5%ad%98%e6%9b%b4%e6%96%b0%e6%8b%bc%e5%8d%95%e7%8a%b6%e6%80%81%e6%8e%a8%e9%80%81%e6%88%90%e5%8a%9f%e9%80%9a%e7%9f%a5%e5%a6%82%e4%bd%95%e4%bf%9d%e8%af%81%e8%bf%99%e4%b8%89%e4%b8%aa%e6%93%8d%e4%bd%9c%e7%9a%84%e5%8e%9f%e5%ad%90%e6%80%a7%e6%af%94%e8%be%83seataatseatatcc%e6%9c%ac%e5%9c%b0%e6%b6%88%e6%81%af%e8%a1%a8%e7%9a%84%e4%bc%98%e5%8a%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;åœºæ™¯-1&#34;&gt;åœºæ™¯ &lt;a href=&#34;#%e5%9c%ba%e6%99%af-1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æ‰£å‡åº“å­˜ã€æ›´æ–°æ‹¼å•çŠ¶æ€ã€æ¨é€é€šçŸ¥ï¼ˆçŸ­ä¿¡/IMï¼‰ï¼Œ&lt;code&gt;ä¿è¯åŸå­æ€§ï¼ˆä¸€è‡´æ€§ï¼‰çš„æ€è·¯&lt;/code&gt;ï¼š
è¿™ä¸‰ä¸ªæ“ä½œä¸­ï¼Œåº“å­˜å’ŒçŠ¶æ€å±äºå¼ºä¸€è‡´æ€§èŒƒç•´ï¼Œé€šçŸ¥å±äºæœ€ç»ˆä¸€è‡´æ€§èŒƒç•´ã€‚&lt;code&gt;ä¸è¦è¯•å›¾è®©è¿™ä¸‰è€…å…¨éƒ¨å¼ºä¸€è‡´&lt;/code&gt;ï¼Œå¦åˆ™æ€§èƒ½ä¼šæåº¦ä½ä¸‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åº“å­˜ &amp;amp; çŠ¶æ€ï¼š å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼ˆæœ¬åœ°äº‹åŠ¡æˆ–TCCï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šçŸ¥ï¼š å¿…é¡»å¼‚æ­¥ï¼Œå…è®¸å¤±è´¥é‡è¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆå¯¹æ¯”&#34;&gt;æ–¹æ¡ˆå¯¹æ¯” &lt;a href=&#34;#%e6%96%b9%e6%a1%88%e5%af%b9%e6%af%94&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ–¹æ¡ˆ&lt;/th&gt;
          &lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
          &lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Seata AT&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;æ¥å…¥ç®€å•&lt;/td&gt;
          &lt;td&gt;é«˜å¹¶å‘ä¸‹æ€§èƒ½å·®&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Seata TCC&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;å¼ºä¸€è‡´&lt;/td&gt;
          &lt;td&gt;ä¾µå…¥æ€§å¼º&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆæ¨èï¼‰&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;æœ€ç¨³ã€å¯æ‰©å±•&lt;/td&gt;
          &lt;td&gt;å®ç°å¤æ‚&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Seata ATæ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†ï¼š åŸºäºæœ¬åœ°äº‹åŠ¡ + Undo Logï¼ˆå›æ»šæ—¥å¿—ï¼‰ã€‚äºŒé˜¶æ®µæäº¤æ—¶ï¼Œå¦‚æœå…¨å±€å¤±è´¥ï¼Œå›æ»šæ—¶åˆ©ç”¨Undo Logåå‘è¡¥å¿ã€‚&lt;/li&gt;
&lt;li&gt;åŠ£åŠ¿ï¼š
&lt;ul&gt;
&lt;li&gt;é”ç«äº‰ä¸¥é‡ï¼š å…¨å±€äº‹åŠ¡æœŸé—´ï¼Œæ•°æ®åº“è¡Œé”è¢«é”å®šç›´åˆ°äº‹åŠ¡ç»“æŸï¼Œåœ¨é«˜å¹¶å‘æ‹¼å•åœºæ™¯ä¸‹ï¼Œæ•°æ®åº“ååé‡æä½ã€‚&lt;/li&gt;
&lt;li&gt;æ€§èƒ½æŸè€—ï¼š éœ€è¦è§£æSQLï¼Œç”Ÿæˆå‰åé•œåƒï¼Œé¢å¤–å¼€é”€å¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é€‚ç”¨æ€§ï¼š ä¸é€‚åˆé«˜å¹¶å‘çš„ç§’æ€/æ‹¼å•æ ¸å¿ƒé“¾è·¯ï¼Œé€‚åˆä½å¹¶å‘çš„åå°ç®¡ç†é“¾è·¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Seata TCCæ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†ï¼š Try-Confirm-Cancelã€‚ä¸šåŠ¡ä»£ç éœ€è¦å†™ä¸‰ä¸ªæ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŠ£ï¼š æ€§èƒ½æ¯”ATå¥½ï¼Œé”ç”±ä¸šåŠ¡æ§åˆ¶ï¼Œä¸ä¾èµ–DBé”ã€‚ä½†ä»£ç ä¾µå…¥æ€§æå¼ºï¼Œå¼€å‘æˆæœ¬é«˜ï¼Œä¸”æœ‰ç©ºå›æ»šã€æ‚¬æŒ‚ç­‰å‘ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨æ€§ï¼š é€‚åˆæ ¸å¿ƒèµ„äº§æ“ä½œï¼ˆå¦‚åº“å­˜æ‰£å‡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ¬åœ°æ¶ˆæ¯è¡¨æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœ¬åœ°DBäº‹åŠ¡ï¼š
&lt;ul&gt;
&lt;li&gt;æ‰£åº“å­˜&lt;/li&gt;
&lt;li&gt;æ›´æ–°æ‹¼å•çŠ¶æ€&lt;/li&gt;
&lt;li&gt;å†™æ¶ˆæ¯è¡¨ï¼ˆSUCCESSï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;MQ å¼‚æ­¥ï¼š
&lt;ul&gt;
&lt;li&gt;æ¨é€é€šçŸ¥&lt;/li&gt;
&lt;li&gt;å‘æ”¾æƒç›Š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯è¡¨é‡è¯•ï¼š
&lt;ul&gt;
&lt;li&gt;DB ä¿è¯ä¸€è‡´æ€§&lt;/li&gt;
&lt;li&gt;MQ åªè´Ÿè´£â€œæœ€ç»ˆé€šçŸ¥â€&lt;/li&gt;
&lt;li&gt;å¯è¡¥å¿ã€å¯å›æ”¾&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç”¨redisåšæ‹¼å•åˆ†å¸ƒå¼é”æ—¶æ€ä¹ˆé˜²æ­¢é”è¢«è¯¯åˆ å’Œæ­»é”å¦‚æœæ‹¼å•ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”è¶…æ—¶ä¼šå¯¼è‡´é‡å¤æ‹¼å•å—æ€ä¹ˆé¿å…&#34;&gt;ç”¨Redisåšæ‹¼å•åˆ†å¸ƒå¼é”æ—¶ï¼Œæ€ä¹ˆé˜²æ­¢é”è¢«è¯¯åˆ å’Œæ­»é”?å¦‚æœæ‹¼å•ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”è¶…æ—¶ï¼Œä¼šå¯¼è‡´é‡å¤æ‹¼å•å—?æ€ä¹ˆé¿å…? &lt;a href=&#34;#%e7%94%a8redis%e5%81%9a%e6%8b%bc%e5%8d%95%e5%88%86%e5%b8%83%e5%bc%8f%e9%94%81%e6%97%b6%e6%80%8e%e4%b9%88%e9%98%b2%e6%ad%a2%e9%94%81%e8%a2%ab%e8%af%af%e5%88%a0%e5%92%8c%e6%ad%bb%e9%94%81%e5%a6%82%e6%9e%9c%e6%8b%bc%e5%8d%95%e4%b8%9a%e5%8a%a1%e6%89%a7%e8%a1%8c%e6%97%b6%e9%97%b4%e8%b6%85%e8%bf%87%e9%94%81%e8%b6%85%e6%97%b6%e4%bc%9a%e5%af%bc%e8%87%b4%e9%87%8d%e5%a4%8d%e6%8b%bc%e5%8d%95%e5%90%97%e6%80%8e%e4%b9%88%e9%81%bf%e5%85%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;é—®é¢˜1é˜²æ­¢è¯¯åˆ é”&#34;&gt;é—®é¢˜1ï¼šé˜²æ­¢è¯¯åˆ é” &lt;a href=&#34;#%e9%97%ae%e9%a2%981%e9%98%b2%e6%ad%a2%e8%af%af%e5%88%a0%e9%94%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç°è±¡ï¼š çº¿ç¨‹Aæ‹¿åˆ°é”ï¼Œä¸šåŠ¡æ‰§è¡Œæ…¢ï¼Œé”è¶…æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚çº¿ç¨‹Bæ‹¿åˆ°é”ï¼Œæ­¤æ—¶çº¿ç¨‹Aæ‰§è¡Œå®Œï¼Œè¯¯åˆ äº†çº¿ç¨‹Bçš„é”ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š Valueæ ‡è¯†æ³•ã€‚SET key valueæ—¶ï¼Œvalueè®¾ä¸ºUUID+çº¿ç¨‹IDã€‚åˆ é™¤å‰ï¼Œå…ˆç”¨Luaè„šæœ¬ï¼ˆä¿è¯åŸå­æ€§ï¼‰åˆ¤æ–­Redisä¸­çš„Valueæ˜¯å¦ç­‰äºè‡ªå·±æŒæœ‰çš„æ ‡è¯†ï¼Œç›¸ç­‰æ‰DELã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é—®é¢˜2é˜²æ­¢æ­»é”&#34;&gt;é—®é¢˜2ï¼šé˜²æ­¢æ­»é” &lt;a href=&#34;#%e9%97%ae%e9%a2%982%e9%98%b2%e6%ad%a2%e6%ad%bb%e9%94%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç°è±¡ï¼š æ‹¿åˆ°é”çš„æœåŠ¡å®•æœºï¼Œé”æ°¸è¿œæ— æ³•é‡Šæ”¾ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆTTLï¼‰ã€‚SETNX EX 10ã€‚å³ä½¿å®•æœºï¼Œ10ç§’åé”è‡ªåŠ¨é‡Šæ”¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é—®é¢˜3ä¸šåŠ¡æ‰§è¡Œè¶…è¿‡é”è¶…æ—¶å¯¼è‡´é‡å¤ä¸‹å•&#34;&gt;é—®é¢˜3ï¼šä¸šåŠ¡æ‰§è¡Œè¶…è¿‡é”è¶…æ—¶ï¼ˆå¯¼è‡´é‡å¤ä¸‹å•ï¼‰ &lt;a href=&#34;#%e9%97%ae%e9%a2%983%e4%b8%9a%e5%8a%a1%e6%89%a7%e8%a1%8c%e8%b6%85%e8%bf%87%e9%94%81%e8%b6%85%e6%97%b6%e5%af%bc%e8%87%b4%e9%87%8d%e5%a4%8d%e4%b8%8b%e5%8d%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç°è±¡ï¼š é”TTL=10sï¼Œä¸šåŠ¡è·‘äº†15sã€‚ç¬¬10sé”é‡Šæ”¾ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹è¿›æ¥ï¼Œå¯¼è‡´ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‹¼å•ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼ˆçœ‹é—¨ç‹—æœºåˆ¶ / Watchdogï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨ç»­æœŸï¼š å¼€å¯ä¸€ä¸ªåå°å®ˆæŠ¤çº¿ç¨‹ï¼ˆWatchdogï¼‰ã€‚å¦‚æœä¸šåŠ¡æœªæ‰§è¡Œå®Œï¼Œåœ¨TTLè¿‡æœŸå‰çš„1/3æ—¶é—´ï¼ˆå¦‚3sæ—¶ï¼‰ï¼Œä¸»åŠ¨å°†Redisä¸­çš„Keyé‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º10sã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š Redissonï¼ˆJavaï¼‰æˆ–ç±»ä¼¼çš„Golangåº“éƒ½æœ‰æ­¤æœºåˆ¶ã€‚è‡ªå®ç°æ—¶ï¼Œéœ€ç¡®ä¿ç»­æœŸé€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åŒç”Ÿå‘½å‘¨æœŸï¼Œä¸šåŠ¡åœåˆ™ç»­æœŸåœã€‚&lt;/li&gt;
&lt;li&gt;é¿å…é‡å¤æ‹¼å•ï¼š å³ä½¿é”ç»­æœŸå¤±è´¥ï¼Œæ•°æ®åº“å±‚é¢å¿…é¡»å…œåº•ã€‚æ‹¼å•SQLå¸¦ä¸Šæ¡ä»¶ UPDATE order SET status = &amp;lsquo;SUCCESS&amp;rsquo; WHERE id = ? AND status = &amp;lsquo;çŠ¶æ€å€¼&amp;rsquo;ï¼ˆä¹è§‚é”ï¼‰ï¼Œåˆ©ç”¨æ•°æ®åº“è¡Œé”æˆ–å”¯ä¸€ç´¢å¼•é˜²æ­¢å¹¶å‘ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å•†å“åº“å­˜åˆ†ä»“å­˜å‚¨abcä»“åº“è·¨ä»“è°ƒæ‹¨æ—¶æ•°æ®åŒæ­¥å»¶è¿Ÿå¯¼è‡´ç”¨æˆ·ä¸‹å•åå‘ç°ç›®æ ‡ä»“åº“æ— è´§æ€ä¹ˆè§£å†³&#34;&gt;å•†å“åº“å­˜åˆ†ä»“å­˜å‚¨(A/B/Cä»“åº“)ï¼Œè·¨ä»“è°ƒæ‹¨æ—¶æ•°æ®åŒæ­¥å»¶è¿Ÿï¼Œå¯¼è‡´ç”¨æˆ·ä¸‹å•åå‘ç°ç›®æ ‡ä»“åº“æ— è´§ï¼Œæ€ä¹ˆè§£å†³? &lt;a href=&#34;#%e5%95%86%e5%93%81%e5%ba%93%e5%ad%98%e5%88%86%e4%bb%93%e5%ad%98%e5%82%a8abc%e4%bb%93%e5%ba%93%e8%b7%a8%e4%bb%93%e8%b0%83%e6%8b%a8%e6%97%b6%e6%95%b0%e6%8d%ae%e5%90%8c%e6%ad%a5%e5%bb%b6%e8%bf%9f%e5%af%bc%e8%87%b4%e7%94%a8%e6%88%b7%e4%b8%8b%e5%8d%95%e5%90%8e%e5%8f%91%e7%8e%b0%e7%9b%ae%e6%a0%87%e4%bb%93%e5%ba%93%e6%97%a0%e8%b4%a7%e6%80%8e%e4%b9%88%e8%a7%a3%e5%86%b3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æ ¸å¿ƒçŸ›ç›¾ï¼š CAPå®šç†ä¸‹ï¼Œä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼ˆAï¼‰å’Œåˆ†åŒºå®¹é”™ï¼ˆPï¼‰ï¼Œç‰ºç‰²äº†å¼ºä¸€è‡´æ€§ï¼ˆCï¼‰ï¼Œå¯¼è‡´ç”¨æˆ·çœ‹åˆ°çš„â€œæœ‰è´§â€æ˜¯æ—§æ•°æ®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§£å†³æ–¹æ¡ˆ&#34;&gt;è§£å†³æ–¹æ¡ˆ &lt;a href=&#34;#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å†™å…¥å‰æ ¡éªŒï¼ˆå¼ºçº¦æŸï¼‰:
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š ä¸‹å•æ—¶ï¼Œå¼ºåˆ¶è·¯ç”±åˆ°ä¸»ä»“çš„Masteræ•°æ®åº“è¿›è¡Œåº“å­˜æ‰£å‡ã€‚ä¸å…è®¸è¯»å–Slaveåº“å­˜ä½œä¸ºæ‰£å‡ä¾æ®ï¼ŒSlaveä»…ç”¨äºæŸ¥è¯¢å±•ç¤ºã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š æ•°æ®åº“è·¯ç”±å±‚é…ç½®è¯»å†™åˆ†ç¦»è§„åˆ™ï¼Œå¼ºåˆ¶ä¸»ä»åŒæ­¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åº“å­˜é¢„å /é¢„ç•™æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;åº“å­˜é¢„å ï¼šåœ¨è·¨ä»“è°ƒæ‹¨å‘èµ·æ—¶ï¼Œç³»ç»Ÿç”Ÿæˆâ€œé”å®šåº“å­˜â€ã€‚ç›®æ ‡ä»“åº“çš„åº“å­˜ = å®ç‰©åº“å­˜ + é”å®šåº“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;åº“å­˜é¢„ç•™ï¼šæ•°æ®åŒæ­¥æ—¶ï¼Œä¸ä»…è¦åŒæ­¥å®ç‰©ï¼Œè¿˜è¦åŒæ­¥â€œè°ƒæ‹¨å•â€çš„çŠ¶æ€ã€‚è¿™æ ·å³ä½¿å®ç‰©æ²¡åˆ°ï¼Œåªè¦ç³»ç»Ÿé‡Œè°ƒæ‹¨å•æ˜¯â€œåœ¨é€”â€ï¼Œç”¨æˆ·ä¹Ÿèƒ½ä¸‹å•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è®¾ç½®â€œå®‰å…¨åº“å­˜æ°´ä½â€
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š ä¸ºäº†é¿å…ç”¨æˆ·ä¸‹å•åå‘ç°ç›®æ ‡ä»“åº“æ— è´§ï¼Œè®¾ç½®ä¸€ä¸ªâ€œå®‰å…¨åº“å­˜æ°´ä½â€ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š å¦‚æœåŒæ­¥å»¶è¿Ÿæœ€å¤§5ç§’ï¼Œæ ¹æ®å¹³å‡é”€å”®é€Ÿåº¦ï¼Œè®¡ç®—5ç§’å†…å¯èƒ½å–å‡ºçš„æ•°é‡ï¼ˆå¦‚100ä»¶ï¼‰ã€‚ç³»ç»Ÿå±•ç¤ºåº“å­˜ = å®é™…åº“å­˜ - ç¼“å†²åº“å­˜ï¼ˆ100ä»¶ï¼‰ã€‚åªæœ‰å½“è°ƒæ‹¨è´§ç‰©ç¡®è®¤å…¥åº“åï¼Œæ‰é‡Šæ”¾è¿™100ä»¶çš„ç¼“å†²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ€ç»ˆä¸€è‡´æ€§ä¿®å¤
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š å½“ç”¨æˆ·ä¸‹å•åï¼Œå‘ç°ç›®æ ‡ä»“åº“æ— è´§ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›æ»šè®¢å•ã€‚ç”¨æˆ·ç¨åå†æŸ¥è¯¢ï¼Œä¼šå‘ç°ç›®æ ‡ä»“åº“æœ‰è´§äº†ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š è®¢å•è¡¨æ·»åŠ çŠ¶æ€å­—æ®µï¼ˆå¦‚status=&amp;lsquo;CANCELLED&amp;rsquo;ï¼‰ï¼Œå½“å›æ»šè®¢å•æ—¶ï¼Œæ›´æ–°ä¸ºâ€œå·²å–æ¶ˆâ€ã€‚é€†å‘æµç¨‹ï¼šä¸»åŠ¨å–æ¶ˆè®¢å•ã€é€€æ¬¾å¹¶å‘é€ä¼˜æƒ åˆ¸è¡¥å¿ï¼Œä¸è¦é˜»å¡ç”¨æˆ·ä¸‹å•æµç¨‹å¤ªä¹…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç§’æ€æ´»åŠ¨ä¸­ç”¨æˆ·æ¯ç§’å‘èµ·10æ¬¡è¯·æ±‚å¦‚ä½•è®¾è®¡é™æµç­–ç•¥å…·ä½“æ€ä¹ˆå®ç°å’Œé€‰æ‹©&#34;&gt;ç§’æ€æ´»åŠ¨ä¸­ï¼Œç”¨æˆ·æ¯ç§’å‘èµ·10æ¬¡è¯·æ±‚ï¼Œå¦‚ä½•è®¾è®¡é™æµç­–ç•¥?å…·ä½“æ€ä¹ˆå®ç°å’Œé€‰æ‹©? &lt;a href=&#34;#%e7%a7%92%e6%9d%80%e6%b4%bb%e5%8a%a8%e4%b8%ad%e7%94%a8%e6%88%b7%e6%af%8f%e7%a7%92%e5%8f%91%e8%b5%b710%e6%ac%a1%e8%af%b7%e6%b1%82%e5%a6%82%e4%bd%95%e8%ae%be%e8%ae%a1%e9%99%90%e6%b5%81%e7%ad%96%e7%95%a5%e5%85%b7%e4%bd%93%e6%80%8e%e4%b9%88%e5%ae%9e%e7%8e%b0%e5%92%8c%e9%80%89%e6%8b%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;é™æµçš„ç®—æ³•&#34;&gt;é™æµçš„ç®—æ³• &lt;a href=&#34;#%e9%99%90%e6%b5%81%e7%9a%84%e7%ae%97%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è®¡æ•°å™¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼šåœ¨ä¸€æ®µæ—¶é—´é—´éš”å†…ï¼ˆæ—¶é—´çª—/æ—¶é—´åŒºé—´ï¼‰ï¼Œå¤„ç†è¯·æ±‚çš„æœ€å¤§æ•°é‡å›ºå®šï¼Œè¶…è¿‡éƒ¨åˆ†ä¸åšå¤„ç†&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;Redis å›ºå®šçª—ï¼šINCR + EXPIRE å®ç°â€œæ¯ç”¨æˆ·/æ¯IP æ¯ç§’/æ¯åˆ†é’Ÿæœ€å¤š N æ¬¡â€&lt;/li&gt;
&lt;li&gt;Redis æ»‘åŠ¨çª—ï¼šZSET è®°å½•æ—¶é—´æˆ³ï¼Œç§»é™¤è¿‡çª—å¤–æ•°æ®åæŒ‰çª—å£å†…è®¡æ•°&lt;/li&gt;
&lt;li&gt;åº”ç”¨å†…å®ç°ï¼šSpring/Go/Node æœåŠ¡ç”¨ Redis/æœ¬åœ°å†…å­˜åšè®¡æ•°å™¨ï¼ŒLua ä¿è¯åŸå­æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;ç™»å½•/çŸ­ä¿¡éªŒè¯ç é¢‘æ§ï¼šæ¯æ‰‹æœºå·æ¯åˆ†é’Ÿ â‰¤ 1 æ¬¡&lt;/li&gt;
&lt;li&gt;ç§’æ€æ´»åŠ¨ï¼šæ¯ä¸ªç”¨æˆ·/IP æ¯ç§’æœ€å¤š N æ¬¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¼æ¡¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼šæ¼æ¡¶å¤§å°å›ºå®šï¼Œå¤„ç†é€Ÿåº¦å›ºå®šï¼Œä½†è¯·æ±‚è¿›å…¥é€Ÿåº¦ä¸å›ºå®šï¼ˆåœ¨çªå‘æƒ…å†µè¯·æ±‚è¿‡å¤šæ—¶ï¼Œä¼šä¸¢å¼ƒè¿‡å¤šçš„è¯·æ±‚ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;Nginx limit_reqï¼šå¹³å‡é€Ÿç‡ + burstï¼Œ&lt;code&gt;limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;HAProxyï¼šé€šè¿‡è¯·æ±‚é€Ÿç‡å’Œé˜Ÿåˆ—æŠŠçªåˆºæŠ¹å¹³ï¼Œä¿éšœç¨³å®šå‡ºæµ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;ç½‘å…³å…¥å£å¹³æ»‘æµé‡ï¼šé¿å…ç¬æ—¶çªåˆºæŠŠåç«¯æ‰“æŒ‚&lt;/li&gt;
&lt;li&gt;ä¸‹æ¸¸ä¿æŠ¤ï¼šå¯¹æ•°æ®åº“/æœç´¢/å¤–éƒ¨ä¾èµ–ç»´æŒç¨³å®šåå&lt;/li&gt;
&lt;li&gt;å¤§ä¿ƒç§’æ€å…¥å£ï¼šå…è®¸å°å¹… burstï¼Œä½†æ•´ä½“ä»¥ç¨³å®šé€Ÿç‡è¿‡ç½‘å…³&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»¤ç‰Œæ¡¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼šä»¤ç‰Œæ¡¶å¤§å°å›ºå®šï¼Œä»¤ç‰Œçš„äº§ç”Ÿé€Ÿåº¦å›ºå®šï¼Œä½†æ˜¯æ¶ˆè€—ä»¤ç‰Œï¼ˆå³è¯·æ±‚ï¼‰é€Ÿåº¦ä¸å›ºå®šï¼ˆå¯ä»¥åº”å¯¹ä¸€äº›æŸäº›æ—¶é—´è¯·æ±‚è¿‡å¤šçš„æƒ…å†µï¼‰ï¼›æ¯ä¸ªè¯·æ±‚éƒ½ä¼šä»ä»¤ç‰Œæ¡¶ä¸­å–å‡ºä»¤ç‰Œï¼Œå¦‚æœæ²¡æœ‰ä»¤ç‰Œåˆ™ä¸¢å¼ƒè¯¥æ¬¡è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨Google Guavaçš„RateLimiteræˆ–Redis+Luaå®ç°ä»¤ç‰Œæ¡¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆé€‰æ‹©&#34;&gt;æ–¹æ¡ˆé€‰æ‹© &lt;a href=&#34;#%e6%96%b9%e6%a1%88%e9%80%89%e6%8b%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç½‘å…³å…¥å£ï¼šä¼˜å…ˆç”¨ Nginx çš„æ¼æ¡¶æˆ–ä»¤ç‰Œæ¡¶ï¼Œç»“åˆ burst ä¸é˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;æœåŠ¡å†…éƒ¨ï¼šæœ¬åœ°ä»¤ç‰Œæ¡¶ï¼ˆGuava/Resilience ç”Ÿæ€ï¼‰+ Redis åˆ†å¸ƒå¼è®¡æ•°æ»‘çª—&lt;/li&gt;
&lt;li&gt;é™æµç»´åº¦ï¼šåŒæ—¶æŒ‰ç”¨æˆ·ã€IPã€è·¯å¾„ã€ç§Ÿæˆ·ã€å®ä¾‹ç»´åº¦åˆ†å±‚é…ç½®&lt;/li&gt;
&lt;li&gt;è§‚å¯Ÿä¸å›é€€ï¼šé…åˆé™æµæ—¥å¿—ã€æŒ‡æ ‡æŠ¥è­¦ã€ç°åº¦å‚æ•°å’Œé™çº§é¡µï¼Œé¿å…è¯¯ä¼¤çœŸå®ç”¨æˆ·&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç”¨rediså­˜å‚¨1äº¿ç”¨æˆ·çš„ç ä»·è¿›åº¦æ•°æ®é€‰ä»€ä¹ˆæ•°æ®ç»“æ„å†…å­˜å ç”¨å¤§æ¦‚å¤šå°‘æ€ä¹ˆä¼˜åŒ–å†…å­˜&#34;&gt;ç”¨Rediså­˜å‚¨1äº¿ç”¨æˆ·çš„ç ä»·è¿›åº¦æ•°æ®ï¼Œé€‰ä»€ä¹ˆæ•°æ®ç»“æ„?å†…å­˜å ç”¨å¤§æ¦‚å¤šå°‘?æ€ä¹ˆä¼˜åŒ–å†…å­˜? &lt;a href=&#34;#%e7%94%a8redis%e5%ad%98%e5%82%a81%e4%ba%bf%e7%94%a8%e6%88%b7%e7%9a%84%e7%a0%8d%e4%bb%b7%e8%bf%9b%e5%ba%a6%e6%95%b0%e6%8d%ae%e9%80%89%e4%bb%80%e4%b9%88%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e5%86%85%e5%ad%98%e5%8d%a0%e7%94%a8%e5%a4%a7%e6%a6%82%e5%a4%9a%e5%b0%91%e6%80%8e%e4%b9%88%e4%bc%98%e5%8c%96%e5%86%85%e5%ad%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;æ•°æ®ç»“æ„é€‰æ‹©hash&#34;&gt;æ•°æ®ç»“æ„é€‰æ‹©ï¼šHash &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e9%80%89%e6%8b%a9hash&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Keyï¼šactivity:progress:{userID}
Fieldï¼š{activityID}
Valueï¼š{current_price} (æ•´æ•°æˆ–æµ®ç‚¹æ•°å­—ç¬¦ä¸²)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç†ç”±:&lt;/strong&gt; Hashç»“æ„å¯ä»¥åœ¨Fieldè¾ƒå°‘æ—¶ä½¿ç”¨ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ç¼–ç ï¼Œæå…¶èŠ‚çœå†…å­˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å†…å­˜å ç”¨ä¼°ç®—ç²—ç•¥&#34;&gt;å†…å­˜å ç”¨ä¼°ç®—ï¼ˆç²—ç•¥ï¼‰ï¼š &lt;a href=&#34;#%e5%86%85%e5%ad%98%e5%8d%a0%e7%94%a8%e4%bc%b0%e7%ae%97%e7%b2%97%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸ä¼˜åŒ–ï¼š1äº¿ä¸ªKeyï¼Œæ¯ä¸ªKeyæœ¬èº«çš„å¼€é”€ + Rediså¯¹è±¡å¤´å¼€é”€å¾ˆå¤§ï¼Œå¯èƒ½éœ€è¦å‡ åGBã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Hashä¼˜åŒ–ï¼šå¯ä»¥å°†Keyçš„æ•°é‡å‡å°‘ã€‚ä¾‹å¦‚ï¼Œå°†ç”¨æˆ·IDå–æ¨¡åˆ†ç‰‡ï¼Œæ¯ä¸ªHashå­˜1000ä¸ªç”¨æˆ·ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªEntryå‡è®¾10å­—èŠ‚ï¼ˆField 4å­—èŠ‚ + Value 4å­—èŠ‚ + å¼€é”€ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;1äº¿ç”¨æˆ· * 10å­—èŠ‚ â‰ˆ 1GB (çº¯æ•°æ®é‡)ã€‚åŠ ä¸ŠKeyå¼€é”€å’ŒRediså¯¹è±¡å¤´ï¼Œå¯èƒ½åœ¨ 2GB~3GB å·¦å³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å†…å­˜ä¼˜åŒ–ç­–ç•¥&#34;&gt;å†…å­˜ä¼˜åŒ–ç­–ç•¥ï¼š &lt;a href=&#34;#%e5%86%85%e5%ad%98%e4%bc%98%e5%8c%96%e7%ad%96%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Hash ZipMapä¼˜åŒ–ï¼š é…ç½®hash-max-ziplist-entrieså’Œhash-max-ziplist-valueï¼Œç¡®ä¿Hashå†…éƒ¨ä½¿ç”¨ziplistç¼–ç ï¼Œè€Œä¸æ˜¯hashtableï¼Œèƒ½èŠ‚çœ50%ä»¥ä¸Šå†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;Keyç²¾ç®€ï¼š å»æ‰ä¸å¿…è¦çš„ä¸šåŠ¡å‰ç¼€ï¼Œä½¿ç”¨çŸ­IDæˆ–Hashæ˜ å°„IDã€‚&lt;/li&gt;
&lt;li&gt;æ•°å€¼ç¼–ç ï¼š å¦‚æœç ä»·é‡‘é¢éƒ½æ˜¯æ•´æ•°ï¼ŒRediså†…éƒ¨ä¼šä½¿ç”¨intç¼–ç å­˜å‚¨Valueï¼Œéå¸¸çœå†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®åˆ†ç‰‡ï¼š ä¸è¦è®©å•ä¸ªRedisèŠ‚ç‚¹å­˜1äº¿æ•°æ®ã€‚æŒ‰userID % 1000åˆ†ç‰‡åˆ°ä¸åŒRediså®ä¾‹ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¼˜æƒ åˆ¸æ ¸é”€æ—¶ç”¨æˆ·åŒæ—¶ä½¿ç”¨æ»¡100å‡30æ‹¼å•ä»·æŠ˜5æ–°äººç«‹å‡15å¦‚ä½•ç²¾å‡†è®¡ç®—å®ä»˜é‡‘é¢è§„åˆ™å¼•æ“æ€ä¹ˆè®¾è®¡&#34;&gt;ä¼˜æƒ åˆ¸æ ¸é”€æ—¶ï¼Œç”¨æˆ·åŒæ—¶ä½¿ç”¨â€œæ»¡100å‡30â€â€œæ‹¼å•ä»·æŠ˜5%â€â€œæ–°äººç«‹å‡15â€ï¼Œå¦‚ä½•ç²¾å‡†è®¡ç®—å®ä»˜é‡‘é¢?è§„åˆ™å¼•æ“æ€ä¹ˆè®¾è®¡? &lt;a href=&#34;#%e4%bc%98%e6%83%a0%e5%88%b8%e6%a0%b8%e9%94%80%e6%97%b6%e7%94%a8%e6%88%b7%e5%90%8c%e6%97%b6%e4%bd%bf%e7%94%a8%e6%bb%a1100%e5%87%8f30%e6%8b%bc%e5%8d%95%e4%bb%b7%e6%8a%985%e6%96%b0%e4%ba%ba%e7%ab%8b%e5%87%8f15%e5%a6%82%e4%bd%95%e7%b2%be%e5%87%86%e8%ae%a1%e7%ae%97%e5%ae%9e%e4%bb%98%e9%87%91%e9%a2%9d%e8%a7%84%e5%88%99%e5%bc%95%e6%93%8e%e6%80%8e%e4%b9%88%e8%ae%be%e8%ae%a1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è®¡ç®—é¡ºåºä¸é€»è¾‘ï¼š&lt;code&gt;ç”µå•†é€šç”¨é¡ºåºï¼šå•å“ä»· -&amp;gt; ä¼šå‘˜ä»·/é™æ—¶ä»· -&amp;gt; ç±»ç›®æ»¡å‡ -&amp;gt; å¹³å°æ»¡å‡ -&amp;gt; æ‹¼å•ä»· -&amp;gt; æ–°äººåˆ¸ã€‚&lt;/code&gt;æ³¨æ„ï¼šæœ‰äº›äº’æ–¥ï¼Œæœ‰äº›å åŠ ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§„åˆ™å¼•æ“è®¾è®¡ç­–ç•¥æ¨¡å¼--è´£ä»»é“¾æ¨¡å¼&#34;&gt;è§„åˆ™å¼•æ“è®¾è®¡ï¼ˆç­–ç•¥æ¨¡å¼ + è´£ä»»é“¾æ¨¡å¼ï¼‰ï¼š &lt;a href=&#34;#%e8%a7%84%e5%88%99%e5%bc%95%e6%93%8e%e8%ae%be%e8%ae%a1%e7%ad%96%e7%95%a5%e6%a8%a1%e5%bc%8f--%e8%b4%a3%e4%bb%bb%e9%93%be%e6%a8%a1%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç­–ç•¥æ¨¡å¼(æ¨¡å‹æŠ½è±¡)ï¼š æ¯ä¸ªä¼˜æƒ åˆ¸æ˜¯ä¸€ä¸ª&lt;code&gt;Rule&lt;/code&gt;å¯¹è±¡ï¼ŒåŒ…å«ï¼š&lt;code&gt;Condition&lt;/code&gt;ï¼ˆè§„åˆ™ï¼Œå¦‚æ»¡100å…ƒï¼‰å’Œ&lt;code&gt;Action&lt;/code&gt;ï¼ˆåŠ¨ä½œï¼Œå‡30å…ƒï¼‰,&lt;code&gt;Condition&lt;/code&gt;æ”¯æŒé€»è¾‘ç»„åˆï¼š&lt;code&gt;AND / OR&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è´£ä»»é“¾æ¨¡å¼ï¼š
&lt;ul&gt;
&lt;li&gt;å°†å¤šä¸ªä¼˜æƒ åˆ¸è§„åˆ™ä¸²æˆä¸€æ¡é“¾ã€‚&lt;/li&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡Contextåœ¨é“¾ä¸­ä¼ é€’ï¼ŒåŒ…å«ï¼šå½“å‰é‡‘é¢ã€å•†å“åˆ—è¡¨ã€ç”¨æˆ·ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªRuleèŠ‚ç‚¹ï¼šæ£€æŸ¥Contextæ˜¯å¦æ»¡è¶³Condition -&amp;gt; è‹¥æ»¡è¶³ï¼Œä¿®æ”¹Contexté‡‘é¢ï¼Œæ ‡è®°å·²ä½¿ç”¨ä¼˜æƒ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç”µå•†å¹³å°è®¢å•idç”¨ä»€ä¹ˆåˆ†å¸ƒå¼idæ–¹æ¡ˆæ¯”è¾ƒé›ªèŠ±ç®—æ³•å˜ç§å«ä¸šåŠ¡ç¼–ç leafredisè‡ªå¢çš„ä¼˜åŠ£&#34;&gt;ç”µå•†å¹³å°è®¢å•IDç”¨ä»€ä¹ˆåˆ†å¸ƒå¼IDæ–¹æ¡ˆ?æ¯”è¾ƒé›ªèŠ±ç®—æ³•å˜ç§(å«ä¸šåŠ¡ç¼–ç )ã€Leafã€Redisè‡ªå¢çš„ä¼˜åŠ£ &lt;a href=&#34;#%e7%94%b5%e5%95%86%e5%b9%b3%e5%8f%b0%e8%ae%a2%e5%8d%95id%e7%94%a8%e4%bb%80%e4%b9%88%e5%88%86%e5%b8%83%e5%bc%8fid%e6%96%b9%e6%a1%88%e6%af%94%e8%be%83%e9%9b%aa%e8%8a%b1%e7%ae%97%e6%b3%95%e5%8f%98%e7%a7%8d%e5%90%ab%e4%b8%9a%e5%8a%a1%e7%bc%96%e7%a0%81leafredis%e8%87%aa%e5%a2%9e%e7%9a%84%e4%bc%98%e5%8a%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;é›ªèŠ±ç®—æ³•å˜ç§&#34;&gt;é›ªèŠ±ç®—æ³•å˜ç§ï¼š &lt;a href=&#34;#%e9%9b%aa%e8%8a%b1%e7%ae%97%e6%b3%95%e5%8f%98%e7%a7%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;åŸç†ï¼š 1ä½ç¬¦å·ä½ + 41ä½æ—¶é—´æ¯«ç§’ + 10ä½æœºå™¨ID + 12ä½åºåˆ—å·ã€‚&lt;/li&gt;
&lt;li&gt;å˜ç§ï¼š å°†æœºå™¨IDéƒ¨åˆ†æ›¿æ¢ä¸º ä¸šåŠ¡ç¼–ç ï¼ˆå¦‚æœºæˆ¿ID+ä¸šåŠ¡çº¿IDï¼‰ æˆ– åˆ†ç‰‡IDã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŠ£ï¼š æ€§èƒ½æœ€é«˜ï¼ˆæœ¬åœ°ç”Ÿæˆï¼‰ï¼Œä¸ä¾èµ–ç½‘ç»œã€‚ä½†ä¾èµ–æœºå™¨æ—¶é’Ÿï¼ˆæ—¶é’Ÿå›æ‹¨ä¼šé‡å¤ï¼‰ï¼Œä¸”IDè¿‡é•¿ï¼ˆ19ä½ï¼‰ï¼Œä¸å…·å¤‡ä¸¥æ ¼çš„ä¸šåŠ¡å¯è¯»æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;leafç¾å›¢&#34;&gt;Leafï¼ˆç¾å›¢ï¼‰ &lt;a href=&#34;#leaf%e7%be%8e%e5%9b%a2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Segmentæ¨¡å¼ï¼š ä»DBæ‰¹é‡è·å–IDå·æ®µï¼ˆå¦‚[1000, 2000]ï¼‰ï¼Œç¼“å­˜åœ¨æœ¬åœ°å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŠ£ï¼š æ€§èƒ½é«˜ï¼ŒDBå‹åŠ›å°ã€‚åŒBufferä¼˜åŒ–ä¿éšœå¹³æ»‘ã€‚é‡å¯å¯èƒ½ä¸¢å¤±éƒ¨åˆ†IDï¼ˆä¸è¿ç»­ï¼‰ï¼Œä½†å”¯ä¸€æ€§æ²¡é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;Snowflakeæ¨¡å¼ï¼š åŸºäºZookeeperè§£å†³æ—¶é’Ÿå›æ‹¨é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨æ€§ï¼š ç¨³å®šæ€§æé«˜ï¼Œé€‚åˆä¸­å¤§å‹äº’è”ç½‘å…¬å¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;redisè‡ªå¢incr&#34;&gt;Redisè‡ªå¢ï¼ˆINCRï¼‰ï¼š &lt;a href=&#34;#redis%e8%87%aa%e5%a2%9eincr&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ä¼˜åŠ£ï¼š å®ç°æœ€ç®€å•ã€‚ä½†å¼ºä¾èµ–Redisï¼Œé›†ç¾¤æ‰©ç¼©å®¹éº»çƒ¦ï¼ˆéœ€è¦è€ƒè™‘Luaè„šæœ¬æˆ–Redis Cluster Slotï¼‰ï¼Œä¸”ç½‘ç»œIOæœ‰å»¶è¿Ÿã€‚é«˜å¹¶å‘ä¸‹æˆä¸ºå•ç‚¹ç“¶é¢ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç§’æ€ä¼˜æƒ åˆ¸å¦‚ä½•é˜²æ­¢è¶…å‘å¯¹æ¯”redisluaè„šæœ¬å’Œåˆ†å¸ƒå¼æ•°æ®åº“é”çš„æ–¹æ¡ˆä¼˜åŠ£&#34;&gt;ç§’æ€ä¼˜æƒ åˆ¸å¦‚ä½•é˜²æ­¢è¶…å‘?å¯¹æ¯”Redis+Luaè„šæœ¬å’Œåˆ†å¸ƒå¼æ•°æ®åº“é”çš„æ–¹æ¡ˆä¼˜åŠ£ã€‚ &lt;a href=&#34;#%e7%a7%92%e6%9d%80%e4%bc%98%e6%83%a0%e5%88%b8%e5%a6%82%e4%bd%95%e9%98%b2%e6%ad%a2%e8%b6%85%e5%8f%91%e5%af%b9%e6%af%94redislua%e8%84%9a%e6%9c%ac%e5%92%8c%e5%88%86%e5%b8%83%e5%bc%8f%e6%95%b0%e6%8d%ae%e5%ba%93%e9%94%81%e7%9a%84%e6%96%b9%e6%a1%88%e4%bc%98%e5%8a%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;æ–¹æ¡ˆä¸€redis--lua-è„šæœ¬ä¸»æµç§’æ€é¦–é€‰&#34;&gt;æ–¹æ¡ˆä¸€ï¼šRedis + Lua è„šæœ¬ï¼ˆä¸»æµã€ç§’æ€é¦–é€‰ï¼‰ &lt;a href=&#34;#%e6%96%b9%e6%a1%88%e4%b8%80redis--lua-%e8%84%9a%e6%9c%ac%e4%b8%bb%e6%b5%81%e7%a7%92%e6%9d%80%e9%a6%96%e9%80%89&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;æ•°æ®ç»“æ„è®¾è®¡&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;keyè®¾è®¡ï¼š
coupon:stock:{couponId}: å­—ç¬¦ä¸²ï¼Œå‰©ä½™åº“å­˜æ•°ã€‚
coupon:user:{couponId}: Set æˆ– Hashï¼Œè®°å½•å·²é¢†å–ç”¨æˆ·ï¼ˆSet åšâ€œæ˜¯å¦å·²é¢†â€ï¼ŒHash å¯è®°å½•é¢†äº†å‡ å¼ ï¼‰ã€‚
åˆå§‹åŒ–æ—¶ï¼ˆæ´»åŠ¨å¼€å§‹å‰ï¼‰é¢„çƒ­åˆ° Redisï¼š
SET coupon:stock:1001 1000
SADD coupon:user:1001ï¼ˆç©ºé›†åˆå³å¯ï¼Œåç»­é€šè¿‡ SADD æ·»åŠ  userIdï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;luaè„šæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-lua&#34; data-lang=&#34;lua&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- KEYS[1]: coupon:stock:{couponId}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- KEYS[2]: coupon:user:{couponId}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- ARGV[1]: userId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- ARGV[2]: maxPerUserï¼ˆåŒä¸€ç”¨æˆ·æœ€å¤šå¯é¢†å‡ å¼ ï¼Œå¯ä¸º 1ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; stockKey   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; KEYS[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; userSetKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; KEYS[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; userId     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ARGV[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; maxPerUser &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tonumber(ARGV[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- 1) ç”¨æˆ·æ˜¯å¦å·²è¾¾åˆ°é¢†å–ä¸Šé™&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; count &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tonumber(redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;HGET&amp;#34;&lt;/span&gt;, userSetKey, userId) &lt;span style=&#34;color:#f92672&#34;&gt;or&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; count &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; maxPerUser &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;-- è¶…è¿‡ä¸ªäººé™é¢&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- 2) æ£€æŸ¥åº“å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; stock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tonumber(redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;, stockKey) &lt;span style=&#34;color:#f92672&#34;&gt;or&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; stock &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;-- åº“å­˜ä¸è¶³&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- 3) æ‰£åº“å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;DECR&amp;#34;&lt;/span&gt;, stockKey)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- 4) è®°å½•ç”¨æˆ·å·²é¢†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; count &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;HSET&amp;#34;&lt;/span&gt;, userSetKey, userId, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ts&amp;#34;&lt;/span&gt;, ARGV[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;]) &lt;span style=&#34;color:#75715e&#34;&gt;-- è®°å½•é¢†å–æ—¶é—´&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;HINCRBY&amp;#34;&lt;/span&gt;, userSetKey, userId, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- 5) è¿”å›å‰©ä½™åº“å­˜ï¼ˆå¯é€‰ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; tonumber(redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;, stockKey))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;PHPé›†æˆä¸MQé›†æˆï¼Œè½åº“&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     * ç”¨æˆ·é¢†å–ä¼˜æƒ åˆ¸ï¼ˆç§’æ€æ¥å£ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     * @param int $couponId  ä¼˜æƒ åˆ¸ID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     * @param int $userId    ç”¨æˆ·ID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     * @param int $maxPerUser æ¯äººæœ€å¤§å¯é¢†æ•°é‡ï¼ˆä¸€èˆ¬ 1ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     * @return array [&amp;#39;code&amp;#39;=&amp;gt;int, &amp;#39;msg&amp;#39;=&amp;gt;string, &amp;#39;leftStock&amp;#39;=&amp;gt;int|null]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;grabCoupon&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;int&lt;/span&gt; $couponId, &lt;span style=&#34;color:#a6e22e&#34;&gt;int&lt;/span&gt;$userId, &lt;span style=&#34;color:#a6e22e&#34;&gt;int&lt;/span&gt; $maxPerUser &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;array&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $stockKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;coupon:stock:&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;$couponId&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $userKey  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;coupon:user:&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;$couponId&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// Lua è„šæœ¬
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        $script &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;&amp;lt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;LUA&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local stockKey   = KEYS[1]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local userSetKey = KEYS[2]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local userId     = ARGV[1]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local maxPerUser = tonumber(ARGV[2])
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local nowTs      = ARGV[3]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local ttlSeconds = tonumber(ARGV[4]) // è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local count = tonumber(redis.call(&amp;#34;HGET&amp;#34;, userSetKey, userId) or &amp;#34;0&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;if count &amp;gt;= maxPerUser then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  return -1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local stock = tonumber(redis.call(&amp;#34;GET&amp;#34;, stockKey) or &amp;#34;0&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;if stock &amp;lt;= 0 then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  return 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;redis.call(&amp;#34;DECR&amp;#34;, stockKey)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;if count == 0 then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  redis.call(&amp;#34;HSET&amp;#34;, userSetKey, userId, 1, &amp;#34;ts&amp;#34;, nowTs)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  if ttlSeconds and ttlSeconds &amp;gt; 0 then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    local ttl = redis.call(&amp;#34;TTL&amp;#34;, userSetKey)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    if ttl == -1 then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      redis.call(&amp;#34;EXPIRE&amp;#34;, userSetKey, ttlSeconds)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;else
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  redis.call(&amp;#34;HINCRBY&amp;#34;, userSetKey, userId, 1)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;return tonumber(redis.call(&amp;#34;GET&amp;#34;, stockKey))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;LUA&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ï¼Œeval çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯åŒ…å«æ‰€æœ‰ KEYS å’Œ ARGV çš„æ•°ç»„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ KEYS çš„ä¸ªæ•°ï¼ŒRedis ä¼šæŠŠå‰ N ä¸ªå…ƒç´ å½“ä½œ KEYSï¼Œåé¢çš„å½“ä½œ ARGV
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        $args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            $stockKey,                 &lt;span style=&#34;color:#75715e&#34;&gt;// KEYS[1]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            $userKey,                  &lt;span style=&#34;color:#75715e&#34;&gt;// KEYS[2]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            $userId,                   &lt;span style=&#34;color:#75715e&#34;&gt;// ARGV[1]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            $maxPerUser,               &lt;span style=&#34;color:#75715e&#34;&gt;// ARGV[2]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            (&lt;span style=&#34;color:#a6e22e&#34;&gt;string&lt;/span&gt;)&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;(),            &lt;span style=&#34;color:#75715e&#34;&gt;// ARGV[3] å½“å‰æ—¶é—´æˆ³
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;24&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3600&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;// ARGV[4] è¿‡æœŸæ—¶é—´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        ];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $numKeys &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// KEYS çš„ä¸ªæ•°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$this&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;redis&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;eval&lt;/span&gt;($script,$args, $numKeys);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ($result &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// Redis é”™è¯¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;code&amp;#39;&lt;/span&gt;     &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;int&lt;/span&gt;)$result;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ($result &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// é¢†å–æˆåŠŸ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;code&amp;#39;&lt;/span&gt;     &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;é¢†å–æˆåŠŸ&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; $result,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ($result &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// åº“å­˜ä¸è¶³
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;code&amp;#39;&lt;/span&gt;     &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ä¼˜æƒ åˆ¸å·²è¢«æŠ¢å…‰&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// $result === -1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// é‡å¤é¢†å–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;code&amp;#39;&lt;/span&gt;     &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ä½ å·²ç»é¢†å–è¿‡è¯¥ä¼˜æƒ åˆ¸&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$service &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SeckillCouponService&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$couponId &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1001&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// æ´»åŠ¨å¼€å¯å‰ï¼Œåœ¨åå°ç®¡ç†æˆ–è„šæœ¬é‡Œåˆå§‹åŒ–åº“å­˜ï¼ˆåªåšä¸€æ¬¡ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;$service&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;initStock&lt;/span&gt;($couponId, &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ç”¨æˆ·è¯·æ±‚é¢†å–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;$userId &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;12345&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ret &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$service&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;grabCoupon&lt;/span&gt;($couponId,$userId);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; ($ret[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;code&amp;#39;&lt;/span&gt;]) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;é¢†å–æˆåŠŸï¼Œå‰©ä½™åº“å­˜ï¼š&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; $ret[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PHP_EOL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—å°è£…ï¼ˆRedis List æˆ–æ›´ä¸“ä¸šçš„ MQï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        $event &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;json_encode&lt;/span&gt;([
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;couponId&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; $couponId,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;userId&amp;#39;&lt;/span&gt;   &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; $userId,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ts&amp;#39;&lt;/span&gt;       &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $redis&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lPush&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;coupon:grab:queue&amp;#39;&lt;/span&gt;,$event);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å·²è¢«æŠ¢å…‰ï¼Œåº“å­˜ä¸è¶³ï¼š&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; $ret[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PHP_EOL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;echo&lt;/span&gt; $ret[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PHP_EOL&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// ä½ å·²ç»é¢†å–è¿‡è¯¥ä¼˜æƒ åˆ¸
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;echo&lt;/span&gt; $ret[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PHP_EOL&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// ç³»ç»Ÿé”™è¯¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ–¹æ¡ˆäºŒåˆ†å¸ƒå¼æ•°æ®åº“é”mysql-è¡Œé”--ä¹è§‚é”ç­‰&#34;&gt;æ–¹æ¡ˆäºŒï¼šåˆ†å¸ƒå¼æ•°æ®åº“é”ï¼ˆMySQL è¡Œé” / ä¹è§‚é”ç­‰ï¼‰ &lt;a href=&#34;#%e6%96%b9%e6%a1%88%e4%ba%8c%e5%88%86%e5%b8%83%e5%bc%8f%e6%95%b0%e6%8d%ae%e5%ba%93%e9%94%81mysql-%e8%a1%8c%e9%94%81--%e4%b9%90%e8%a7%82%e9%94%81%e7%ad%89&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;update&lt;/span&gt; coupon
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;set&lt;/span&gt; stock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stock &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt; id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;and&lt;/span&gt; stock &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¼ºç‚¹&#34;&gt;ç¼ºç‚¹ &lt;a href=&#34;#%e7%bc%ba%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;ç»´åº¦&lt;/th&gt;
          &lt;th&gt;Redis + Lua&lt;/th&gt;
          &lt;th&gt;æ•°æ®åº“é”&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;é˜²è¶…å‘èƒ½åŠ›&lt;/td&gt;
          &lt;td&gt;âœ… å¼º&lt;/td&gt;
          &lt;td&gt;âœ… å¼º&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ€§èƒ½&lt;/td&gt;
          &lt;td&gt;â­â­â­â­â­&lt;/td&gt;
          &lt;td&gt;â­&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å¹¶å‘èƒ½åŠ›&lt;/td&gt;
          &lt;td&gt;10ä¸‡~ç™¾ä¸‡&lt;/td&gt;
          &lt;td&gt;å‡ åƒ&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ¶æ„å¤æ‚åº¦&lt;/td&gt;
          &lt;td&gt;ä¸­&lt;/td&gt;
          &lt;td&gt;ä½&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ•°æ®ä¸€è‡´æ€§&lt;/td&gt;
          &lt;td&gt;æœ€ç»ˆä¸€è‡´&lt;/td&gt;
          &lt;td&gt;å¼ºä¸€è‡´&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ç§’æ€é€‚é…åº¦&lt;/td&gt;
          &lt;td&gt;â­â­â­â­â­&lt;/td&gt;
          &lt;td&gt;âŒ&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;å¤šçº§ç¼“å­˜æ¶æ„æœ¬åœ°ç¼“å­˜caffeineå’Œrediså¦‚ä½•ååŒä¿è¯æ•°æ®ä¸€è‡´æ€§&#34;&gt;å¤šçº§ç¼“å­˜æ¶æ„æœ¬åœ°ç¼“å­˜(Caffeine)å’ŒRediså¦‚ä½•ååŒä¿è¯æ•°æ®ä¸€è‡´æ€§? &lt;a href=&#34;#%e5%a4%9a%e7%ba%a7%e7%bc%93%e5%ad%98%e6%9e%b6%e6%9e%84%e6%9c%ac%e5%9c%b0%e7%bc%93%e5%ad%98caffeine%e5%92%8credis%e5%a6%82%e4%bd%95%e5%8d%8f%e5%90%8c%e4%bf%9d%e8%af%81%e6%95%b0%e6%8d%ae%e4%b8%80%e8%87%b4%e6%80%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;å¤šçº§ç¼“å­˜â€œä¸€å®šä¼šä¸ä¸€è‡´â€,åªèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;æœ€æ ¸å¿ƒçš„ååŒç­–ç•¥&#34;&gt;æœ€æ ¸å¿ƒçš„ååŒç­–ç•¥ &lt;a href=&#34;#%e6%9c%80%e6%a0%b8%e5%bf%83%e7%9a%84%e5%8d%8f%e5%90%8c%e7%ad%96%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å†™æ“ä½œï¼šå…ˆ DBï¼Œååˆ ç¼“å­˜ï¼ˆä¸¤çº§ï¼‰ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1. æ›´æ–° DBï¼ˆäº‹åŠ¡æäº¤ï¼‰
2. åˆ é™¤ Redis
3. åˆ é™¤ Caffeine
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;ä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Œæ˜¯åˆ é™¤ç¼“å­˜&lt;/code&gt; , æ›´æ–°ç¼“å­˜æ›´å®¹æ˜“è„å†™,åˆ é™¤è®©è¯»è¯·æ±‚å›æºé‡å»º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é˜²æ­¢å¹¶å‘å†™å¯¼è‡´è„æ•°æ®ï¼šå»¶è¿ŸåŒåˆ :&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1. åˆ  Redis + Caffeine
2. sleep 500ms
3. å†åˆ ä¸€æ¬¡ Redis
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹é—´æœ¬åœ°ç¼“å­˜ä¸€è‡´æ€§ï¼šæ¶ˆæ¯é€šçŸ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;DB æ›´æ–°
 â†’ åˆ é™¤ Redis
 â†’ å‘é€ MQ / Redis PubSub
 â†’ å„èŠ‚ç‚¹æ¸…ç†æœ¬åœ° Caffeine
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;TTL + ç‰ˆæœ¬å…œåº•ï¼ˆé˜²â€œæ°¸è¿œä¸ä¸€è‡´â€ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;æœ¬åœ°ç¼“å­˜ï¼šTTL = 30 ~ 60 ç§’
Redisç¼“å­˜ï¼šTTL =  5 ~ 10 åˆ†é’Ÿ
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å®Œæ•´è¯»å†™æµç¨‹çœŸå®ç”Ÿäº§&#34;&gt;å®Œæ•´è¯»å†™æµç¨‹ï¼ˆçœŸå®ç”Ÿäº§ï¼‰ &lt;a href=&#34;#%e5%ae%8c%e6%95%b4%e8%af%bb%e5%86%99%e6%b5%81%e7%a8%8b%e7%9c%9f%e5%ae%9e%e7%94%9f%e4%ba%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;è¯»æµç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1. æŸ¥ Caffeine
2. æœªå‘½ä¸­ â†’ æŸ¥ Redis
3. Redis å‘½ä¸­ â†’ å›å¡« Caffeine
4. Redis æœªå‘½ä¸­ â†’ æŸ¥ DB
5. å›å¡« Redis + Caffeine
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å†™æµç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1. åå°å†…å®¹æ“ä½œ
2. æ›´æ–° DBï¼ˆäº‹åŠ¡ï¼‰
3. åˆ é™¤ Redis
4. åˆ é™¤æœ¬åœ° Caffeine
5. å‘ MQ é€šçŸ¥
6. å„èŠ‚ç‚¹æ¸…æœ¬åœ°ç¼“å­˜
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;è®¢å•è¿‡æœŸå¤„ç†ç­–ç•¥å¦‚æ”¯ä»˜å¤–å–è®¢å•è¶…æ—¶&#34;&gt;è®¢å•è¿‡æœŸå¤„ç†ç­–ç•¥ï¼Œå¦‚æ”¯ä»˜ã€å¤–å–è®¢å•è¶…æ—¶ &lt;a href=&#34;#%e8%ae%a2%e5%8d%95%e8%bf%87%e6%9c%9f%e5%a4%84%e7%90%86%e7%ad%96%e7%95%a5%e5%a6%82%e6%94%af%e4%bb%98%e5%a4%96%e5%8d%96%e8%ae%a2%e5%8d%95%e8%b6%85%e6%97%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å®šæ—¶ä»»åŠ¡&#34;&gt;å®šæ—¶ä»»åŠ¡ &lt;a href=&#34;#%e5%ae%9a%e6%97%b6%e4%bb%bb%e5%8a%a1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼šå®ç°é€»è¾‘ç®€å•ï¼Œæ‰«ææ•°æ®åº“å³å¯&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šæ—¶é—´ä¸å¤Ÿç²¾ç¡®ï¼Œå¦‚è®¢å•è¶…æ—¶10åˆ†é’Ÿï¼Œå®šæ—¶ä»»åŠ¡åªèƒ½æ¯1åˆ†é’Ÿæ‰«æä¸€æ¬¡ï¼Œä¼šæœ‰10åˆ†é’Ÿçš„å»¶è¿Ÿï¼Œéšç€æ•°æ®é‡çš„å¢åŠ å»¶è¿Ÿå¢å¤§&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;redisè¿‡æœŸç›‘å¬&#34;&gt;Redisè¿‡æœŸç›‘å¬ &lt;a href=&#34;#redis%e8%bf%87%e6%9c%9f%e7%9b%91%e5%90%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;æºç &lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// è®¢é˜…ç«¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() { &lt;span style=&#34;color:#75715e&#34;&gt;// ä¸»å‡½æ•°ï¼Œç¨‹åºå…¥å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;addr&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:6379&amp;#34;&lt;/span&gt;               &lt;span style=&#34;color:#75715e&#34;&gt;// Redis åœ°å€ï¼ˆä¸»æœº:ç«¯å£ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;pwd&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;123456&amp;#34;&lt;/span&gt;                        &lt;span style=&#34;color:#75715e&#34;&gt;// Redis å¯†ç ï¼ˆå¦‚æ— å¯†ç å¯ç½®ç©ºï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;redis&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewClient&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;redis&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Options&lt;/span&gt;{ &lt;span style=&#34;color:#75715e&#34;&gt;// åˆ›å»º Redis å®¢æˆ·ç«¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Addr&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;addr&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;// è¿æ¥åœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Password&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;pwd&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;// è¿æ¥å¯†ç &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;DB&lt;/span&gt;:       &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,    &lt;span style=&#34;color:#75715e&#34;&gt;// ä½¿ç”¨çš„æ•°æ®åº“ç¼–å·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Ping&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;Result&lt;/span&gt;(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;// æ¢æµ‹è¿æ¥æ˜¯å¦æ­£å¸¸&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// è¿æ¥å¤±è´¥ç›´æ¥é€€å‡º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigSet&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;notify-keyspace-events&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Ex&amp;#34;&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;// å¯ç”¨é”®è¿‡æœŸäº‹ä»¶é€šçŸ¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// è®¾ç½®é€šçŸ¥å¤±è´¥ç›´æ¥é€€å‡ºï¼ˆäº‘æœåŠ¡å¯èƒ½éœ€è¦åœ¨æœåŠ¡ç«¯é…ç½®ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ps&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PSubscribe&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;__keyevent@0__:expired&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// è®¢é˜… DB0 çš„é”®è¿‡æœŸäº‹ä»¶é¢‘é“ï¼Œä¸å¯éšæ„æ›´æ”¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ps&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()                               &lt;span style=&#34;color:#75715e&#34;&gt;// ç¨‹åºç»“æŸæ—¶å…³é—­è®¢é˜…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ch&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ps&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Channel&lt;/span&gt;()                             &lt;span style=&#34;color:#75715e&#34;&gt;// è·å–è®¢é˜…æ¶ˆæ¯çš„é€šé“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ch&lt;/span&gt; {                          &lt;span style=&#34;color:#75715e&#34;&gt;// æŒç»­è¯»å–è¿‡æœŸäº‹ä»¶æ¶ˆæ¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Payload&lt;/span&gt;                        &lt;span style=&#34;color:#75715e&#34;&gt;// è¿‡æœŸçš„é”®å&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;strings&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HasPrefix&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pay:order:&amp;#34;&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;// åªå¤„ç†æ”¯ä»˜è®¢å•ç›¸å…³çš„é”®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;strings&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TrimPrefix&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pay:order:&amp;#34;&lt;/span&gt;)                                 &lt;span style=&#34;color:#75715e&#34;&gt;// æå–è®¢å• ID&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;timeout order=%s at=%s\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;Format&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RFC3339&lt;/span&gt;)) &lt;span style=&#34;color:#75715e&#34;&gt;// æ‰“å°è¶…æ—¶æ—¥å¿—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”Ÿäº§ç«¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;addr&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:6379&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;pwd&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;123456&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;redis&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewClient&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;redis&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Options&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Addr&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;addr&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Password&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;pwd&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;DB&lt;/span&gt;:       &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Ping&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;Result&lt;/span&gt;(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rand&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Seed&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;UnixNano&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sprintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%d%03d&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;UnixNano&lt;/span&gt;(), &lt;span style=&#34;color:#a6e22e&#34;&gt;rand&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Intn&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pay:order:&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Set&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;Format&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RFC3339&lt;/span&gt;), &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;create order=%s ttl=10s\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹: ç”±äºredisçš„é«˜æ€§èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è®¾ç½®keyï¼Œæˆ–è€…æ¶ˆè´¹key æ—¶ï¼Œé€Ÿåº¦ä¸Šæ˜¯å¯ä»¥ä¿è¯çš„ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹: ç”±äºredis çš„key è¿‡æœŸç­–ç•¥åŸå› ï¼Œå½“ä¸€ä¸ªkey è¿‡æœŸæ—¶ï¼Œredis æ— æ³•ä¿è¯ç«‹åˆ»å°†å…¶åˆ é™¤ï¼Œè‡ªç„¶æˆ‘ä»¬çš„ç›‘å¬äº‹ä»¶ä¹Ÿæ— æ³•ç¬¬ä¸€æ—¶é—´æ¶ˆè´¹åˆ°è¿™ä¸ªkeyï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿã€‚å¦å¤–ï¼Œåœ¨redis5.0ä¹‹å‰ï¼Œè®¢é˜…å‘å¸ƒä¸­çš„æ¶ˆæ¯å¹¶æ²¡æœ‰è¢«æŒä¹…åŒ–ï¼Œè‡ªç„¶ä¹Ÿæ²¡æœ‰æ‰€è°“çš„ç¡®è®¤æœºåˆ¶ã€‚æ‰€ä»¥ä¸€æ—¦æ¶ˆè´¹æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬çš„å®¢æˆ·ç«¯å‘ç”Ÿäº†å®•æœºï¼Œè¿™æ¡æ¶ˆæ¯å°±å½»åº•ä¸¢å¤±äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;rocketmqå»¶è¿Ÿé˜Ÿåˆ—-æˆ–è€…-æ­»ä¿¡é˜Ÿåˆ—&#34;&gt;RocketMQå»¶è¿Ÿé˜Ÿåˆ— æˆ–è€… æ­»ä¿¡é˜Ÿåˆ— &lt;a href=&#34;#rocketmq%e5%bb%b6%e8%bf%9f%e9%98%9f%e5%88%97-%e6%88%96%e8%80%85-%e6%ad%bb%e4%bf%a1%e9%98%9f%e5%88%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å»¶è¿Ÿæ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯å†™å…¥åˆ°Brokeråï¼Œä¸ä¼šç«‹åˆ»è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œéœ€è¦ç­‰å¾…æŒ‡å®šçš„æ—¶é•¿åæ‰å¯è¢«æ¶ˆè´¹å¤„ç†çš„æ¶ˆæ¯ï¼Œç§°ä¸ºå»¶æ—¶æ¶ˆæ¯ã€‚
åœ¨è®¢å•åˆ›å»ºä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè®¢å•ä½œä¸ºä¸€æ¡æ¶ˆæ¯æŠ•é€’åˆ°rocketmqï¼Œå¹¶å°†å»¶è¿Ÿæ—¶é—´è®¾ç½®ä¸º 30åˆ†é’Ÿï¼Œè¿™æ ·ï¼Œ30åˆ†é’Ÿåæˆ‘ä»¬å®šä¹‰çš„consumer å°±å¯ä»¥æ¶ˆè´¹åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œç„¶åæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ”¯ä»˜äº†è¿™ä¸ªè®¢å•ã€‚
é€šè¿‡å»¶è¿Ÿæ¶ˆæ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä¸šåŠ¡è§£è€¦ï¼Œæå¤§åœ°ç®€åŒ–æˆ‘ä»¬çš„ä»£ç é€»è¾‘ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹:å¯ä»¥ä½¿ä»£ç é€»è¾‘æ¸…æ™°ï¼Œç³»ç»Ÿä¹‹é—´å®Œå…¨è§£è€¦ï¼Œåªéœ€å…³æ³¨ç”Ÿäº§åŠæ¶ˆè´¹æ¶ˆæ¯å³å¯ã€‚å¦å¤–å…¶ååé‡æé«˜ï¼Œæœ€å¤šå¯ä»¥æ”¯æ’‘ä¸‡äº¿çº§çš„æ•°æ®é‡ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹:ç›¸å¯¹æ¥è¯´mqæ˜¯é‡é‡çº§çš„ç»„ä»¶ï¼Œå¼•å…¥mqä¹‹åï¼Œéšä¹‹è€Œæ¥çš„æ¶ˆæ¯ä¸¢å¤±ã€å¹‚ç­‰æ€§é—®é¢˜ç­‰éƒ½åŠ æ·±äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;li&gt;æ€»ç»“:é€šè¿‡ mq è¿›è¡Œç³»ç»Ÿä¸šåŠ¡è§£è€¦ï¼Œä»¥åŠå¯¹ç³»ç»Ÿæ€§èƒ½å‰Šå³°å¡«è°·å·²ç»æ˜¯å½“å‰é«˜æ€§èƒ½ç³»ç»Ÿçš„æ ‡é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Redroidå®‰å“å®¹å™¨</title>
      <link>https://abnerxc.github.io/android/redroid%E4%BD%BF%E7%94%A8/</link>
      <pubDate>Fri, 25 Jul 2025 20:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/android/redroid%E4%BD%BF%E7%94%A8/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æ–‡æ¡£åœ°å€ï¼šhttps://github.com/remote-android/redroid-doc/tree/master&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;ubuntu-2204å®‰è£…&#34;&gt;Ubuntu 22.04å®‰è£… &lt;a href=&#34;#ubuntu-2204%e5%ae%89%e8%a3%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install linux-modules-extra-&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;uname -r&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ç”¨äºåŠ è½½ Linux å†…æ ¸ä¸­çš„ binder_linux æ¨¡å—,è¯¥æ¨¡å—ä¸º Android çš„ Binder é€šä¿¡æœºåˆ¶æä¾›æ”¯æŒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo modprobe binder_linux devices&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;binder,hwbinder,vndbinder&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æ·»åŠ å¼€æœºå¯åŠ¨(å¯é€‰)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;binder_linux&amp;#34;&lt;/span&gt; | sudo tee -a /etc/modules
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  (å¯é€‰)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo modprobe ashmem_linux
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -itd --rm --privileged &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    --pull always &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    -v ~/data11:/data &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    -p 5555:5555 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    --name redroid11 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    redroid/redroid:12.0.0_64only-latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;dockerè¿è¡Œ&#34;&gt;dockerè¿è¡Œ &lt;a href=&#34;#docker%e8%bf%90%e8%a1%8c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;version: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;3.0&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;services:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  redroid:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    image: registry.cn-guangzhou.aliyuncs.com/xuchen/proxy:redroid-12.0.0_64only-latest
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    container_name: redroid-12
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    stdin_open: true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tty: true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    privileged: true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ports:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - 5555:5555
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    volumes:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - /home/abner/Document/redroid:/data:rw
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      -v /dev/dri:/dev/dri  &lt;span style=&#34;color:#75715e&#34;&gt;#GPUç¡¬ä»¶åŠ é€Ÿéœ€æŒ‚è½½è®¾å¤‡ï¼š-v /dev/dri:/dev/dri å¹¶è®¾ç½®redroid.gpu.mode=hostã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    command:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.redroid_width&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.redroid_height&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1920&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.redroid_dpi&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;480&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.redroid_fps&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;60&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.redroid_gpu_mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;host &lt;span style=&#34;color:#75715e&#34;&gt;#auto, host(ä½¿ç”¨GPU), guest(è½¯ä»¶æ¨¡æ‹Ÿ)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.redroid_net_ndns&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;#dns&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.redroid_net_dns1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;114.114.114.114
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.hardware&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;mt6891 &lt;span style=&#34;color:#75715e&#34;&gt;#cpu&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.serialno&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;861503068361145&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;#è®¾ç½®è®¾å¤‡åºåˆ—å·ï¼Œç”¨äºADBè¯†åˆ«&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.verifiedbootstate&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;orange &lt;span style=&#34;color:#75715e&#34;&gt;#ç³»ç»ŸéªŒè¯çŠ¶æ€ï¼šgreenï¼ˆå®˜æ–¹é”å®šï¼‰ã€orangeï¼ˆå·²è§£é”Bootloaderï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - androidboot.selinux&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;permissive      &lt;span style=&#34;color:#75715e&#34;&gt;#enforcing, permissive å¼ºåˆ¶æ¨¡å¼æˆ–å®½å®¹æ¨¡å¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - ro.secure&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;                         &lt;span style=&#34;color:#75715e&#34;&gt;#0å…è®¸root shellï¼Œ1é™åˆ¶ä¸ºæ™®é€šç”¨æˆ·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - ro.build.product&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;chopin             &lt;span style=&#34;color:#75715e&#34;&gt;#è®¾å¤‡å‹å·æ ‡è¯†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - ro.product.manufacturer&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Xiaomi      &lt;span style=&#34;color:#75715e&#34;&gt;#è®¾å¤‡åˆ¶é€ å•†ä¿¡æ¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;redroidå‚æ•°æŸ¥çœ‹&#34;&gt;redroidå‚æ•°æŸ¥çœ‹ &lt;a href=&#34;#redroid%e5%8f%82%e6%95%b0%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;redroid: å®¹å™¨ä¸“å±å‚æ•°&lt;/li&gt;
&lt;li&gt;androidboot:å†…æ ¸å¯åŠ¨å‚æ•°,é€šè¿‡U-Bootè®¾ç½®bootargs â†’ å†…æ ¸è®¾å¤‡æ ‘ï¼ˆDTBï¼‰çš„/chosen/bootargsèŠ‚ç‚¹ â†’ ç³»ç»Ÿå¯åŠ¨åé€šè¿‡/proc/cmdlineæŸ¥çœ‹&lt;/li&gt;
&lt;li&gt;ro:åªè¯»ç³»ç»Ÿå±æ€§,è¿è¡Œ &lt;code&gt;adb shell getprop | grep &amp;quot;ro\.&amp;quot;&lt;/code&gt; å¯æŸ¥çœ‹æ‰€æœ‰åªè¯»å±æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;qtscrcpy&#34;&gt;QtScrcpy &lt;a href=&#34;#qtscrcpy&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æŠ¥é”™è§£å†³&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install libqt5multimedia5
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;qtscrcpyé—®é¢˜&#34;&gt;QtScrcpyé—®é¢˜ &lt;a href=&#34;#qtscrcpy%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;è®¯é£è¾“å…¥æ”¯æŒé”®ç›˜,å…¶ä»–ä¸å¥½ä½¿&lt;/li&gt;
&lt;li&gt;QtScrcpy é”®ç›˜æ˜ å°„ åœ¨è½¯ä»¶keymapç›®å½•ä¸‹ï¼Œç›®å‰ä¸å¥½ä½¿&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;qtscrcpy-é”®ç›˜æ˜ å°„&#34;&gt;QtScrcpy é”®ç›˜æ˜ å°„ &lt;a href=&#34;#qtscrcpy-%e9%94%ae%e7%9b%98%e6%98%a0%e5%b0%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;åœ¨çº¿è°ƒè¯•åœ°å€ï¼šhttps://github.com/barry-ran/QtScrcpy/blob/dev/docs/KeyMapDes.md
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>AlmaLinux-k8så®‰è£…</title>
      <link>https://abnerxc.github.io/tool/almalinux-k8s/</link>
      <pubDate>Mon, 21 Jul 2025 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/tool/almalinux-k8s/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://juejin.cn/post/7369865018764984354&#34;&gt;https://juejin.cn/post/7369865018764984354&lt;/a&gt;
&lt;a href=&#34;https://developer.aliyun.com/article/1463360&#34;&gt;https://developer.aliyun.com/article/1463360&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;ç¯å¢ƒå‡†å¤‡æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ&#34;&gt;ç¯å¢ƒå‡†å¤‡ï¼ˆæ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼‰ &lt;a href=&#34;#%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9%e6%89%a7%e8%a1%8c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ç½‘ç»œé…ç½®&#34;&gt;ç½‘ç»œé…ç½® &lt;a href=&#34;#%e7%bd%91%e7%bb%9c%e9%85%8d%e7%bd%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;master=192.168.122.10,node=192.168.122.11,192.168.122.12&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#è¿›å…¥ç½‘ç»œé…ç½®æ–‡ä»¶ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vi /etc/NetworkManager/system-connections/enp1s0.nmconnection
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å°†&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;ipv4&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;çš„method&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;autoæ”¹ä¸ºmethod&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;manualï¼Œå³æ”¹ä¸ºé…ç½®é™æ€ip
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;ipv4&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;method&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;manual
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;address1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;192.168.122.10  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#address2=192.168.122.10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gateway&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;192.168.122.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;route1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;192.168.100.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dns&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;114.114.114.114;8.8.8.8
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#é‡å¯ç½‘ç»œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart NetworkManager
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ›¿æ¢æº&#34;&gt;æ›¿æ¢æº &lt;a href=&#34;#%e6%9b%bf%e6%8d%a2%e6%ba%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 1. é…ç½®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ³¨æ„ï¼šâ€œ# baseurlâ€ ä¸­é—´æœ‰ä¸ªç©ºæ ¼ï¼ˆAlmaLinux ä¸“æœ‰ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -e &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s|^mirrorlist=|#mirrorlist=|g&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    -e &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s|^# baseurl=https://repo.almalinux.org|baseurl=https://mirrors.aliyun.com|g&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    -i.bak &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    /etc/yum.repos.d/almalinux*.repo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ¢å¤ (sysin)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -e &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s|^#mirrorlist=|mirrorlist=|g&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    -e &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s|^baseurl=https://mirrors.aliyun.com|# baseurl=https://repo.almalinux.org|g&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    -i.bak &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;    /etc/yum.repos.d/almalinux*.repo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 2. æ¸…ç†ç¼“å­˜å¹¶é‡å»º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf clean all
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf makecache
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å…³é—­é˜²ç«å¢™å’Œ-selinux&#34;&gt;å…³é—­é˜²ç«å¢™å’Œ SELinux &lt;a href=&#34;#%e5%85%b3%e9%97%ad%e9%98%b2%e7%81%ab%e5%a2%99%e5%92%8c-selinux&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å…³é—­é˜²ç«å¢™&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl stop firewalld &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; systemctl disable firewalld
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å…³é—­ SELinux&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;setenforce &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s/^SELINUX=enforcing$/SELINUX=permissive/&amp;#39;&lt;/span&gt; /etc/selinux/config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é…ç½®æ—¶é—´åŒæ­¥&#34;&gt;é…ç½®æ—¶é—´åŒæ­¥ &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e6%97%b6%e9%97%b4%e5%90%8c%e6%ad%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£… chrony&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf install -y chrony
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl enable --now chronyd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æŸ¥çœ‹æ—¶é—´åŒæ­¥çŠ¶æ€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;chronyc sources
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;è®¾ç½®ä¸»æœºå&#34;&gt;è®¾ç½®ä¸»æœºå &lt;a href=&#34;#%e8%ae%be%e7%bd%ae%e4%b8%bb%e6%9c%ba%e5%90%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;k8s-master,k8s-node1,k8s-node2&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hostnamectl set-hostname k8s-master
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é…ç½®ä¸»æœºåå’Œ-etchosts&#34;&gt;é…ç½®ä¸»æœºåå’Œ /etc/hosts &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e4%b8%bb%e6%9c%ba%e5%90%8d%e5%92%8c-etchosts&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;åœ¨æ‰€æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ·»åŠ  hosts è§£æ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &amp;gt;&amp;gt; /etc/hosts &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;192.168.122.10 k8s-master
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;192.168.122.11 k8s-node1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;192.168.122.12 k8s-node2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;k8så…³é—­swap&#34;&gt;k8så…³é—­swap &lt;a href=&#34;#k8s%e5%85%b3%e9%97%adswap&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Kubernetes è¦æ±‚ç¦ç”¨ Swapï¼Œä»¥ä¿è¯ kubelet çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;swapoff -a
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -ri &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s/.*swap.*/#&amp;amp;/&amp;#39;&lt;/span&gt; /etc/fstab
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é…ç½®å†…æ ¸å‚æ•°&#34;&gt;é…ç½®å†…æ ¸å‚æ•° &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;åŠ è½½å¿…è¦çš„å†…æ ¸æ¨¡å—å¹¶é…ç½®ç½‘ç»œå‚æ•°ï¼Œè®© iptables èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†æ¡¥æ¥æµé‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£…é¢å¤–çš„å†…æ ¸æ¨¡å—åŒ…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf install -y kernel-modules-extra
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ·»åŠ  br_netfilter modules&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &amp;gt; /etc/modules-load.d/k8s.conf &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;overlay
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;br_netfilter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ·»åŠ  iptables é…ç½®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &amp;gt; /etc/sysctl.d/k8s.conf &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt; EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.bridge.bridge-nf-call-ip6tables = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.bridge.bridge-nf-call-iptables = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.ipv4.ip_forward = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;vm.swappiness = 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åº”ç”¨é…ç½®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sysctl --system
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#é‡å¯æœºå™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;reboot
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æŸ¥çœ‹ç½‘æ¡¥è¿‡æ»¤æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lsmod | grep -e br_netfilter -e overlay
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å®‰è£…-containerd&#34;&gt;å®‰è£… containerd &lt;a href=&#34;#%e5%ae%89%e8%a3%85-containerd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£… dnf-plugins-core&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf install -y dnf-plugins-core
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ·»åŠ  Docker CE ä»“åº“ (é˜¿é‡Œäº‘æº)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf config-manager --add-repo&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£… containerd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf install -y containerd.io
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p /etc/containerd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;containerd config default | tee /etc/containerd/config.toml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 1. ä½¿ç”¨ systemd cgroup é©±åŠ¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 2. é…ç½®é˜¿é‡Œäº‘é•œåƒä»“åº“åŠ é€Ÿå™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s/SystemdCgroup = false/SystemdCgroup = true/&amp;#39;&lt;/span&gt; /etc/containerd/config.toml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#åœ¨é…ç½®æ–‡ä»¶çš„æœ€åæ·»åŠ ä»¥ä¸‹å†…å®¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vi /etc/containerd/config.toml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æŸ¥æ‰¾pauseé•œåƒ ï¼Œå°†&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;registry.k8s.io&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;æ›¿æ¢ä¸º&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;registry.aliyuncs.com/google_containers&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;ï¼Œå¹¶ä¿®æ”¹ç‰ˆæœ¬3.9ï¼Œå› ä¸ºkubeadm config images list è·å–çš„ç‰ˆæœ¬æ˜¯3.19
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æŸ¥æ‰¾io.containerd.grpc.v1.criï¼Œåœ¨é‡Œé¢æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œæ³¨æ„ç¼©è¿›2ä¸ªç©ºæ ¼
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;io.containerd.grpc.v1.cri&amp;#34;&lt;/span&gt;.registry&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;io.containerd.grpc.v1.cri&amp;#34;&lt;/span&gt;.registry.mirrors&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;io.containerd.grpc.v1.cri&amp;#34;&lt;/span&gt;.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;docker.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://registry.aliyuncs.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¯åŠ¨å¹¶è®¾ç½® containerd å¼€æœºè‡ªå¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl enable --now containerd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ£€æŸ¥ containerd çŠ¶æ€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl status containerd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;kubernetesé•œåƒ&#34;&gt;Kubernetesé•œåƒ &lt;a href=&#34;#kubernetes%e9%95%9c%e5%83%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æ·»åŠ  Kubernetes Yum ä»“åº“ (é˜¿é‡Œäº‘æº),é•œåƒä¼šè½åå®˜ç½‘ç‰ˆæœ¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &amp;gt; /etc/yum.repos.d/kubernetes.repo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;[kubernetes]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;name=Kubernetes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;enabled=1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;gpgcheck=0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;repo_gpgcheck=0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®˜ç½‘ç‰ˆæœ¬(å¦‚æœè¦æ±‚æ–°ç‰ˆæœ¬å¯ä»¥é€‰è¿™ä¸ª)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;kubernetes&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Kubernetes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;baseurl&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://pkgs.k8s.io/core:/stable:/v1.30/rpm/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;enabled&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gpgcheck&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gpgkey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://pkgs.k8s.io/core:/stable:/v1.30/rpm/repodata/repomd.xml.key
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;exclude&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;kubelet kubeadm kubectl cri-tools kubernetes-cni
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ¸…ç†æ—§çš„ç¼“å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf clean all
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# é‡å»ºç¼“å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf makecache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å†æ¬¡éªŒè¯å¯ç”¨ç‰ˆæœ¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf list --showduplicates kubeadm --disableexcludes&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;kubernetes
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å®‰è£…-kubernetes&#34;&gt;å®‰è£… Kubernetes &lt;a href=&#34;#%e5%ae%89%e8%a3%85-kubernetes&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æ’é™¤kubernetesçš„å‡çº§å®‰è£…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dnf install -y kubelet-1.28.2-0 kubeadm-1.28.2-0 kubectl-1.28.2-0 --disableexcludes&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;kubernetes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl enable --now kubelet
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#é‡å¯æœºå™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;reboot
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;å…‹éš†èŠ‚ç‚¹&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;&lt;/p&gt;
&lt;h1 id=&#34;åˆå§‹åŒ–-master-èŠ‚ç‚¹-ä»…åœ¨-k8s-master-æ‰§è¡Œ&#34;&gt;åˆå§‹åŒ– Master èŠ‚ç‚¹ (ä»…åœ¨ k8s-master æ‰§è¡Œ) &lt;a href=&#34;#%e5%88%9d%e5%a7%8b%e5%8c%96-master-%e8%8a%82%e7%82%b9-%e4%bb%85%e5%9c%a8-k8s-master-%e6%89%a7%e8%a1%8c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ä½¿ç”¨-kubeadm-åˆå§‹åŒ–&#34;&gt;ä½¿ç”¨ kubeadm åˆå§‹åŒ– &lt;a href=&#34;#%e4%bd%bf%e7%94%a8-kubeadm-%e5%88%9d%e5%a7%8b%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm reset -f
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart kubelet
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æŸ¥çœ‹ç‰ˆæœ¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm config images list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¯ä»¥å…ˆæ‹‰å–é›†ç¾¤æ‰€éœ€è¦çš„images&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm config images pull --image-repository&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;registry.aliyuncs.com/google_containers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å¦‚æœæç¤ºç¼ºå°‘é•œåƒï¼Œè¯·æ‰§è¡Œç±»ä¼¼å¦‚ä¸‹å‘½ä»¤
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;crictl pull registry.aliyuncs.com/google_containers/pause:3.9
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åˆå§‹åŒ–Kubeadm&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm init &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --apiserver-advertise-address&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;192.168.122.10 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --control-plane-endpoint&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;192.168.122.10 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --kubernetes-version&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;v1.28.2 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --service-cidr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;10.96.0.0/12 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --pod-network-cidr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;10.244.0.0/16 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --image-repository&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;registry.aliyuncs.com/google_containers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åˆå§‹åŒ–æŠ¥é”™æŸ¥çœ‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;journalctl -xeu kubelet -f
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é…ç½®-kubectl&#34;&gt;é…ç½® kubectl &lt;a href=&#34;#%e9%85%8d%e7%bd%ae-kubectl&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ä¸ºäº†åœ¨MasterèŠ‚ç‚¹ä¸Šèƒ½æ–¹ä¾¿åœ°ä½¿ç”¨kubectlå‘½ä»¤ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# é’ˆå¯¹ root ç”¨æˆ·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export KUBECONFIG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/etc/kubernetes/admin.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;export KUBECONFIG=/etc/kubernetes/admin.conf&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /etc/bashrc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æˆ–è€…é’ˆå¯¹æ™®é€šç”¨æˆ· (æ¨è)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p $HOME/.kube
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;chown &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;id -u&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;:&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;id -g&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt; $HOME/.kube/config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;æ·»åŠ -worker-èŠ‚ç‚¹-åœ¨-k8s-node1-å’Œ-k8s-node2-æ‰§è¡Œ&#34;&gt;æ·»åŠ  Worker èŠ‚ç‚¹ (åœ¨ k8s-node1 å’Œ k8s-node2 æ‰§è¡Œ) &lt;a href=&#34;#%e6%b7%bb%e5%8a%a0-worker-%e8%8a%82%e7%82%b9-%e5%9c%a8-k8s-node1-%e5%92%8c-k8s-node2-%e6%89%a7%e8%a1%8c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åˆ†åˆ«åœ¨k8s-node1å’Œk8s-node2ä¸Šæ‰§è¡Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ·»åŠ masterèŠ‚ç‚¹ï¼ˆå¤šä¸ªmasteræ‰§è¡Œï¼Œå•ä¸ªä¸éœ€è¦æ‰§è¡Œï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm join 192.168.122.10:6443 --token lk9wh5.cu3batvd0axv4622 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--discovery-token-ca-cert-hash sha256:50d0019950338860872fd3ea1acd0bb92f1174c8520fdfda5d539de3036a2c4d &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--control-plane  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ·»åŠ node1èŠ‚ç‚¹
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm join 192.168.122.10:6443 --token lk9wh5.cu3batvd0axv4622 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--discovery-token-ca-cert-hash sha256:50d0019950338860872fd3ea1acd0bb92f1174c8520fdfda5d539de3036a2c4d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;å®‰è£…-calico-ç½‘ç»œæ’ä»¶-ä»…åœ¨-k8s-master-æ‰§è¡Œ&#34;&gt;å®‰è£… Calico ç½‘ç»œæ’ä»¶ (ä»…åœ¨ k8s-master æ‰§è¡Œ) &lt;a href=&#34;#%e5%ae%89%e8%a3%85-calico-%e7%bd%91%e7%bb%9c%e6%8f%92%e4%bb%b6-%e4%bb%85%e5%9c%a8-k8s-master-%e6%89%a7%e8%a1%8c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä¸‹è½½æ–‡ä»¶(å¶å°”ä¼šä¸‹è½½ä¸äº†ï¼Œå¤šè¯•å‡ æ¬¡)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl https://docs.tigera.io/archive/v3.25/manifests/calico.yaml -O
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä¿®æ”¹docker.ioåœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s#docker.io/#m.daocloud.io/docker.io/#g&amp;#39;&lt;/span&gt; calico.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æˆ–è€…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s#docker.io/#docker.1ms.run/#g&amp;#39;&lt;/span&gt; calico.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä¿®æ”¹IP_AUTODETECTION_METHOD,æ³¨æ„enp1s0 éœ€è¦æ˜¯ä½ è‡ªå·±ç½‘å¡çš„åç§°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/value: &amp;#34;autodetect&amp;#34;/a\\            - name: IP_AUTODETECTION_METHOD\n              value: &amp;#34;interface=enp1s0&amp;#34;&amp;#39;&lt;/span&gt; calico.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åº”ç”¨é…ç½®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl apply -f calico.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# éªŒè¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get pods -n kube-system | grep calico
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æŠ¥é”™å¤„ç†å®Œæˆååˆ é™¤é…ç½®é‡æ–°æ“ä½œï¼š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl delete -f calico.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;tokenå’Œhashä¸¢å¤±è¿‡æœŸå¤„ç†&#34;&gt;tokenå’Œhashä¸¢å¤±è¿‡æœŸå¤„ç† &lt;a href=&#34;#token%e5%92%8chash%e4%b8%a2%e5%a4%b1%e8%bf%87%e6%9c%9f%e5%a4%84%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm token list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#å½“å‰çš„tokenå€¼ï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºå‰é›†ç¾¤ä¸­æ²¡æœ‰æœ‰æ•ˆçš„tokenå€¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#é‡æ–°ç”³è¯·tokenå€¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm token create
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm token list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æ ¹æ®å®é™…æƒ…å†µæ¥åˆ é™¤å½“å‰æœ‰æ•ˆçš„tokenå€¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm token delete xpcpuh.mxbspj5lyyskofu1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-discovery-token-ca-cert-hash å€¼è¢«ä¿å­˜åˆ° Kubemetes é›†ç¾¤çš„æ ¹è¯ä¹¦æ–‡ä»¶ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ ¹è¯ä¹¦ä½äº /etc/kubemetes/pki/ca.cr
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ä¸‹ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤è·å–ï¼Œä½†éœ€è¦åœ¨å¾—åˆ°çš„hashå€¼å‰é¢æ‹¼æ¥ä¸Š sha256:æ‰ç®—å®Œæ•´ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#ä½¿ç”¨0penSSLå·¥å…·è®¡ç®—è¯ä¹¦æ–‡ä»¶çš„SHA256å“ˆå¸Œå€¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;openssl rsa -pubin -outform der 2&amp;gt;/dev/null | &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;openssl dgst -sha256 -hex | sed &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s/^.* //&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;é›†ç¾¤éªŒè¯&#34;&gt;é›†ç¾¤éªŒè¯ &lt;a href=&#34;#%e9%9b%86%e7%be%a4%e9%aa%8c%e8%af%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;åœ¨-master-èŠ‚ç‚¹éªŒè¯&#34;&gt;åœ¨ Master èŠ‚ç‚¹éªŒè¯ &lt;a href=&#34;#%e5%9c%a8-master-%e8%8a%82%e7%82%b9%e9%aa%8c%e8%af%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å›åˆ°k8s-masterèŠ‚ç‚¹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ–°åŠ å…¥çš„èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get nodes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ç¨ç­‰ç‰‡åˆ»ï¼ˆç­‰å¾…kubeletåœ¨nodeä¸Šæ‹‰å–flannelé•œåƒå¹¶å¯åŠ¨CNIï¼‰ï¼Œä½ ä¼šçœ‹åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€éƒ½å˜ä¸º Readyã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;NAME         STATUS     ROLES           AGE     VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;k8s-master   NotReady   control-plane   2m40s   v1.28.2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;k8s-node1    NotReady   &amp;lt;none&amp;gt;          15s     v1.28.2 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;k8s-node2    NotReady   &amp;lt;none&amp;gt;          7s      v1.28.2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;é›†ç¾¤åŠŸèƒ½éªŒè¯&#34;&gt;é›†ç¾¤åŠŸèƒ½éªŒè¯ &lt;a href=&#34;#%e9%9b%86%e7%be%a4%e5%8a%9f%e8%83%bd%e9%aa%8c%e8%af%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#éƒ¨ç½² Nginx&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl create deployment nginx --image&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;registry.cn-guangzhou.aliyuncs.com/xuchen/proxy:nginx-1.27.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æš´éœ²ç«¯å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl expose deployment nginx --port&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt; --type&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;NodePort
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æ£€æŸ¥çŠ¶æ€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æŸ¥çœ‹ Pod&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get pods -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æŸ¥çœ‹ Service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get svc nginx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get svc nginx çš„è¾“å‡ºä¼šæ˜¾ç¤ºä¸€ä¸ª NodePort ç±»å‹çš„æœåŠ¡ï¼Œä¾‹å¦‚ 80:31234/TCPã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥é€šè¿‡ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„IP + 31234ç«¯å£æ¥è®¿é—®Nginxã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;è®¿é—®æµ‹è¯•&#34;&gt;è®¿é—®æµ‹è¯• &lt;a href=&#34;#%e8%ae%bf%e9%97%ae%e6%b5%8b%e8%af%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;åœ¨MasterèŠ‚ç‚¹æˆ–ä»»ä½•èƒ½è®¿é—®é›†ç¾¤ç½‘ç»œçš„åœ°æ–¹ï¼Œä½¿ç”¨curlæµ‹è¯•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# è®¿é—® Master èŠ‚ç‚¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://192.168.122.10:30963
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# è®¿é—® Node1 èŠ‚ç‚¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://192.168.122.11:30963
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# è®¿é—® Node2 èŠ‚ç‚¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://192.168.122.12:31234
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>AlmaLinux10</title>
      <link>https://abnerxc.github.io/tool/linux-almalinux%E4%BC%98%E5%8C%96/</link>
      <pubDate>Mon, 21 Jul 2025 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/tool/linux-almalinux%E4%BC%98%E5%8C%96/</guid>
      <description>&lt;h1 id=&#34;ç½‘ç»œé…ç½®&#34;&gt;ç½‘ç»œé…ç½® &lt;a href=&#34;#%e7%bd%91%e7%bb%9c%e9%85%8d%e7%bd%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#è¿›å…¥ç½‘ç»œé…ç½®æ–‡ä»¶ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd /etc/NetworkManager/system-connections
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vi /etc/NetworkManager/system-connections/ens33.nmconnection
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å°†&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;ipv4&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;çš„method&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;autoæ”¹ä¸ºmethod&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;manualï¼Œå³æ”¹ä¸ºé…ç½®é™æ€ip
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;ipv4&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;method&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;manual
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;address1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;192.168.122.10
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#address2=192.168.122.10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gateway&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;192.168.122.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;route1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;192.168.100.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dns&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;114.114.114.114;8.8.8.8
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#é‡å¯ç½‘ç»œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart NetworkManager
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;è®¾ç½®ä¸»æœºå&#34;&gt;è®¾ç½®ä¸»æœºå &lt;a href=&#34;#%e8%ae%be%e7%bd%ae%e4%b8%bb%e6%9c%ba%e5%90%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo hostnamectl set-hostname k8s-master
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;selinuxå…³é—­&#34;&gt;selinuxå…³é—­ &lt;a href=&#34;#selinux%e5%85%b3%e9%97%ad&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sed -i &amp;#39;s/SELINUX=enforcing/SELINUX=disabled/g&amp;#39; /etc/sysconfig/selinux
sed -i &amp;#39;s/SELINUX=enforcing/SELINUX=disabled/g&amp;#39; /etc/selinux/config
setenforce 0
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;å…³é—­firewalld&#34;&gt;å…³é—­firewalld &lt;a href=&#34;#%e5%85%b3%e9%97%adfirewalld&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;systemctl disable firewalld
systemctl stop firewalld
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;æ›¿æ¢æº&#34;&gt;æ›¿æ¢æº &lt;a href=&#34;#%e6%9b%bf%e6%8d%a2%e6%ba%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 1. é…ç½®
# æ³¨æ„ï¼šâ€œ# baseurlâ€ ä¸­é—´æœ‰ä¸ªç©ºæ ¼ï¼ˆAlmaLinux ä¸“æœ‰ï¼‰
sed -e &amp;#39;s|^mirrorlist=|#mirrorlist=|g&amp;#39; \
    -e &amp;#39;s|^# baseurl=https://repo.almalinux.org|baseurl=https://mirrors.aliyun.com|g&amp;#39; \
    -i.bak \
    /etc/yum.repos.d/almalinux*.repo
# æ¢å¤ (sysin)
sed -e &amp;#39;s|^#mirrorlist=|mirrorlist=|g&amp;#39; \
    -e &amp;#39;s|^baseurl=https://mirrors.aliyun.com|# baseurl=https://repo.almalinux.org|g&amp;#39; \
    -i.bak \
    /etc/yum.repos.d/almalinux*.repo

# 2. æ¸…ç†ç¼“å­˜å¹¶é‡å»º
sudo dnf clean all
sudo dnf makecache
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Transformers-å…¥é—¨ç¯‡</title>
      <link>https://abnerxc.github.io/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/</link>
      <pubDate>Tue, 18 Mar 2025 15:35:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;ä»£ç ï¼šhttps://colab.research.google.com/drive/1VO2FJqN2D2LnByGQsXYbZ0GbzYYe-JCo#scrollTo=z2c4EnOjYc5l&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;ç¬¬ä¸€ç« autotokenizer&#34;&gt;ç¬¬ä¸€ç« ï¼šAutoTokenizer &lt;a href=&#34;#%e7%ac%ac%e4%b8%80%e7%ab%a0autotokenizer&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ç¬¬1æ­¥æ¨¡å‹åŠ è½½&#34;&gt;ç¬¬1æ­¥ã€æ¨¡å‹åŠ è½½ &lt;a href=&#34;#%e7%ac%ac1%e6%ad%a5%e6%a8%a1%e5%9e%8b%e5%8a%a0%e8%bd%bd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; transformers &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; AutoTokenizer
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#ä»huggingfaceåŠ è½½æ¨¡å‹ï¼Œè¾“å…¥æ¨¡å‹åç§°ï¼Œå³å¯åŠ è½½å¯¹åº”çš„åˆ†è¯å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;AutoTokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;uer/roberta-xlarge-wwm-chinese-cluecorpussmall&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# é»˜è®¤ä¼šå­˜åœ¨ ç³»ç»Ÿç”¨æˆ·çš„ã€.cache-&amp;gt;huggingface-&amp;gt;hub-&amp;gt;model-{æ¨¡å‹åç§°}-&amp;gt;snapshotsã€‘ç›®å½•é‡Œé¢&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æŒ‡å®šä¿å­˜æ¨¡å‹åˆ°æœ¬åœ°ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;save_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;./roberta_tokenizer&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä»æœ¬åœ°åŠ è½½tokenizer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;AutoTokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;./roberta_tokenizer&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬2æ­¥å¥å­åˆ†è¯&#34;&gt;ç¬¬2æ­¥ã€å¥å­åˆ†è¯ &lt;a href=&#34;#%e7%ac%ac2%e6%ad%a5%e5%8f%a5%e5%ad%90%e5%88%86%e8%af%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åˆ†è¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å½“å‰æ¨¡å‹ä¼šæ‹†åˆ†æˆä¸€ä¸ªä¸ªå­—ï¼Œæ¯ä¸ªæ¨¡å‹ä¸ä¸€æ ·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sen&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å¼±å°çš„æˆ‘ä¹Ÿæœ‰å¤§æ¢¦æƒ³&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokens&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;tokenize(sen)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokens
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# [&amp;#39;å¼±&amp;#39;, &amp;#39;å°&amp;#39;, &amp;#39;çš„&amp;#39;, &amp;#39;æˆ‘&amp;#39;, &amp;#39;ä¹Ÿ&amp;#39;, &amp;#39;æœ‰&amp;#39;, &amp;#39;å¤§&amp;#39;, &amp;#39;æ¢¦&amp;#39;, &amp;#39;æƒ³&amp;#39;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬3æ­¥æŸ¥çœ‹è¯å…¸&#34;&gt;ç¬¬3æ­¥ã€æŸ¥çœ‹è¯å…¸ &lt;a href=&#34;#%e7%ac%ac3%e6%ad%a5%e6%9f%a5%e7%9c%8b%e8%af%8d%e5%85%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä¸­æ–‡ &amp;#39;##æ¦­&amp;#39;: 16588,  ##æ— æ„ä¹‰ã€‚ä½†æ˜¯è‹±æ–‡ä¼šæŠŠä¸€ä¸ªå•è¯æ‹†æˆè¯æ ¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;vocab
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;vocab_size
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬4æ­¥ç´¢å¼•è½¬æ¢&#34;&gt;ç¬¬4æ­¥ã€ç´¢å¼•è½¬æ¢ &lt;a href=&#34;#%e7%ac%ac4%e6%ad%a5%e7%b4%a2%e5%bc%95%e8%bd%ac%e6%8d%a2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†è¯åºè½¬æ¢æˆidåºåˆ—ï¼Œè¿›å…¥ç¥ç»ç½‘ç»œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ids&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;convert_tokens_to_ids(tokens)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ids
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# [2483, 2207, 4638, 2769, 738, 3300, 1920, 3457, 2682]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†è¯åºè½¬æˆtokens&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokens&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;convert_ids_to_tokens(ids)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokens
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# [&amp;#39;å¼±&amp;#39;, &amp;#39;å°&amp;#39;, &amp;#39;çš„&amp;#39;, &amp;#39;æˆ‘&amp;#39;, &amp;#39;ä¹Ÿ&amp;#39;, &amp;#39;æœ‰&amp;#39;, &amp;#39;å¤§&amp;#39;, &amp;#39;æ¢¦&amp;#39;, &amp;#39;æƒ³&amp;#39;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†tokenè½¬å›æˆå­—ç¬¦ä¸²&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;str_sen &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;convert_tokens_to_string(tokens)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;str_sen
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# &amp;#39;å¼± å° çš„ æˆ‘ ä¹Ÿ æœ‰ å¤§ æ¢¦ æƒ³&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä¾¿æ·è°ƒç”¨&#34;&gt;ä¾¿æ·è°ƒç”¨ &lt;a href=&#34;#%e4%be%bf%e6%8d%b7%e8%b0%83%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†è¯åºè½¬æ¢æˆidåºåˆ—ï¼Œç¼–ç &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ids&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encode(sen)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ids
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# [101, 2483, 2207, 4638, 2769, 738, 3300, 1920, 3457, 2682, 102]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åºåˆ—å¤šäº† 101å’Œ102 æ¨¡å‹çš„è¯å¼€å§‹å’Œç»“æŸï¼Œå¦‚æœä¸éœ€è¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ids&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encode(sen,add_special_tokens&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†idè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œè§£ç &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;str_sen&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decode(ids,skip_special_tokens&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;str_sen
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬5æ­¥å¡«å……å’Œæˆªæ–­&#34;&gt;ç¬¬5æ­¥ï¼šå¡«å……å’Œæˆªæ–­ &lt;a href=&#34;#%e7%ac%ac5%e6%ad%a5%e5%a1%ab%e5%85%85%e5%92%8c%e6%88%aa%e6%96%ad&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¡«å……&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ids&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encode(sen,padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;max_length&amp;#34;&lt;/span&gt;,max_length&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ids &lt;span style=&#34;color:#75715e&#34;&gt;# [101, 2483, 2207, 4638, 2769, 738, 3300, 1920, 3457, 2682, 102, 0, 0, 0, 0]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æˆªæ–­&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ids&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encode(sen,max_length&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,truncation&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ids &lt;span style=&#34;color:#75715e&#34;&gt;# [101, 2483, 2207, 4638, 102]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¿«æ·è°ƒç”¨&#34;&gt;å¿«æ·è°ƒç”¨ &lt;a href=&#34;#%e5%bf%ab%e6%8d%b7%e8%b0%83%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¡«å……çœŸå®æœ‰æ•ˆéƒ¨åˆ†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inputs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encode_plus(sen,padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;max_length&amp;#34;&lt;/span&gt;,max_length&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inputs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ç®€æ´å†™æ³•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inputs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer(sen,padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;max_length&amp;#34;&lt;/span&gt;,max_length&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inputs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬6æ­¥å¤„ç†æ‰¹æ•°æ®&#34;&gt;ç¬¬6æ­¥ï¼šå¤„ç†æ‰¹æ•°æ® &lt;a href=&#34;#%e7%ac%ac6%e6%ad%a5%e5%a4%84%e7%90%86%e6%89%b9%e6%95%b0%e6%8d%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sens&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å¼±å°çš„æˆ‘ä¹Ÿæœ‰å¤§æ¢¦æƒ³&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;æœ‰æ¢¦æƒ³è°éƒ½äº†ä¸èµ·&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;è¿ç€é£è¿½é€æ¢¦æƒ³&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inputs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer(sens)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inputs &lt;span style=&#34;color:#75715e&#34;&gt;# {&amp;#39;input_ids&amp;#39;: [[101, 2483, 2207, 4638, 2769, 738, 3300, 1920, 3457, 2682, 102], [101, 3300, 3457, 2682, 6443, 6963, 749, 679, 6629, 102], [101, 6816, 4708, 7599, 6841, 6852, 3457, 2682, 102]], &amp;#39;token_type_ids&amp;#39;: [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0]], &amp;#39;attention_mask&amp;#39;: [[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1]]}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;fast-slow-tokenizer&#34;&gt;Fast/ Slow Tokenizer &lt;a href=&#34;#fast-slow-tokenizer&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sen&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;æˆ‘æœ‰ä¸€ä¸ªæ¢¦æƒ³Dreaming!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# FaståŸºäºRustå®ç°ï¼ŒslowåŸºäºPythonå®ç°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fast_tokenizer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; AutoTokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;uer/roberta-xlarge-wwm-chinese-cluecorpussmall&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;fast_tokenizer
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# slow_tokenizer = AutoTokenizer.from_pretrained(&amp;#34;uer/roberta-xlarge-wwm-chinese-cluecorpussmall&amp;#34;, use_fast=False)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# slow_tokenizer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç‰¹æ®Šçš„åŠ è½½&#34;&gt;ç‰¹æ®Šçš„åŠ è½½ &lt;a href=&#34;#%e7%89%b9%e6%ae%8a%e7%9a%84%e5%8a%a0%e8%bd%bd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# è¿œç¨‹ä»“åº“é‡Œé¢æœ‰è‡ªæœ‰å®ç°çš„åˆ†è¯å™¨ä»£ç  trust_remote_codeè°ƒç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; AutoTokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;THUDM/chatglm-6b&amp;#34;&lt;/span&gt;,trust_remote_code&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;ç¬¬äºŒç« modelåŸºæœ¬ä½¿ç”¨&#34;&gt;ç¬¬äºŒç« ï¼šModelåŸºæœ¬ä½¿ç”¨ &lt;a href=&#34;#%e7%ac%ac%e4%ba%8c%e7%ab%a0model%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;æ¨¡å‹åŠ è½½ä¸ä¿å­˜&#34;&gt;æ¨¡å‹åŠ è½½ä¸ä¿å­˜ &lt;a href=&#34;#%e6%a8%a1%e5%9e%8b%e5%8a%a0%e8%bd%bd%e4%b8%8e%e4%bf%9d%e5%ad%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; transformers &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; AutoModel
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ¨¡å‹ä¸‹è½½&#34;&gt;æ¨¡å‹ä¸‹è½½ &lt;a href=&#34;#%e6%a8%a1%e5%9e%8b%e4%b8%8b%e8%bd%bd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¼ºåˆ¶ä¸‹è½½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;AutoModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hfl/rbt3&amp;#34;&lt;/span&gt;,force_download&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;)  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# gitä¸‹è½½ï¼šgit clone &amp;#34;æ¨¡å‹åœ°å€&amp;#34;  ï¼Œå¦‚æœåªéœ€è¦æ¨¡å‹çš„éƒ¨åˆ†æŒ‡å®šæ–‡ä»¶ï¼Œå¯ä½¿ç”¨ git lfs clone &amp;#34;æ¨¡å‹åœ°å€&amp;#34; --include=&amp;#34;*.bin&amp;#34; &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ç¦»çº¿ä¸‹è½½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;AutoModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/User/Download/hfl/rbt3&amp;#34;&lt;/span&gt;)  
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ¨¡å‹å‚æ•°&#34;&gt;æ¨¡å‹å‚æ•° &lt;a href=&#34;#%e6%a8%a1%e5%9e%8b%e5%8f%82%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;config&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;AutoConfig&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hfl/rbt3&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ¨¡å‹è°ƒç”¨&#34;&gt;æ¨¡å‹è°ƒç”¨ &lt;a href=&#34;#%e6%a8%a1%e5%9e%8b%e8%b0%83%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sen&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å¼±å°çš„æˆ‘ä¹Ÿæœ‰å¤§æ¢¦æƒ³&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;AutoTokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hfl/rbt3&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inputs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer(sen,return_tensors&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inputs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ä¸å¸¦model-headçš„æ¨¡å‹è°ƒç”¨&#34;&gt;ä¸å¸¦Model Headçš„æ¨¡å‹è°ƒç”¨ &lt;a href=&#34;#%e4%b8%8d%e5%b8%a6model-head%e7%9a%84%e6%a8%a1%e5%9e%8b%e8%b0%83%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;AutoModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hfl/rbt3&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ouput&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;model(&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;tokenizer(sen,return_tensors&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ouput
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å¸¦model-headçš„æ¨¡å‹è°ƒç”¨&#34;&gt;å¸¦Model Headçš„æ¨¡å‹è°ƒç”¨ &lt;a href=&#34;#%e5%b8%a6model-head%e7%9a%84%e6%a8%a1%e5%9e%8b%e8%b0%83%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;form transformers &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; AutoModelForSequenceClassification
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;clz_model&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;AutoModelForSequenceClassification&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hfl/rbt3&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ouput&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;model(&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;tokenizer(sen,return_tensors&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ouput
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;ç¬¬ä¸‰ç« datasetsåŸºæœ¬ä½¿ç”¨&#34;&gt;ç¬¬ä¸‰ç« ï¼šDatasetsåŸºæœ¬ä½¿ç”¨ &lt;a href=&#34;#%e7%ac%ac%e4%b8%89%e7%ab%a0datasets%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;åŠ è½½åœ¨çº¿æ•°æ®é›†&#34;&gt;åŠ è½½åœ¨çº¿æ•°æ®é›† &lt;a href=&#34;#%e5%8a%a0%e8%bd%bd%e5%9c%a8%e7%ba%bf%e6%95%b0%e6%8d%ae%e9%9b%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; datasets &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;datasets&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;load_dataset(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;madao33/new-title-chinese&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;datasets
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åŠ è½½æ•°æ®é›†åˆé›†ä¸­çš„æŸä¸€é¡¹ä»»åŠ¡&#34;&gt;åŠ è½½æ•°æ®é›†åˆé›†ä¸­çš„æŸä¸€é¡¹ä»»åŠ¡ &lt;a href=&#34;#%e5%8a%a0%e8%bd%bd%e6%95%b0%e6%8d%ae%e9%9b%86%e5%90%88%e9%9b%86%e4%b8%ad%e7%9a%84%e6%9f%90%e4%b8%80%e9%a1%b9%e4%bb%bb%e5%8a%a1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;datasets&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;load_dataset(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;super_glue&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;boolq&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;datasets
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æŒ‰ç…§æ•°æ®é›†åˆ’åˆ†è¿›è¡ŒåŠ è½½&#34;&gt;æŒ‰ç…§æ•°æ®é›†åˆ’åˆ†è¿›è¡ŒåŠ è½½ &lt;a href=&#34;#%e6%8c%89%e7%85%a7%e6%95%b0%e6%8d%ae%e9%9b%86%e5%88%92%e5%88%86%e8%bf%9b%e8%a1%8c%e5%8a%a0%e8%bd%bd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;datasets&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;load_dataset(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;madao33/new-title-chinese&amp;#34;&lt;/span&gt;,split&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;train&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;datasets
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>AIæ¨¡å‹VLLMéƒ¨ç½²</title>
      <link>https://abnerxc.github.io/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/</link>
      <pubDate>Wed, 05 Mar 2025 18:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/</guid>
      <description>&lt;h1 id=&#34;ç¯å¢ƒè¯´æ˜&#34;&gt;ç¯å¢ƒè¯´æ˜ &lt;a href=&#34;#%e7%8e%af%e5%a2%83%e8%af%b4%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;OS: Ubuntu 22.04
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;GPU: A10æ˜¾å¡ 24G
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;CPU: 12æ ¸
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vLLM: 0.7.X
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Python: 3.10
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;MiniConda3: lastest version
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Nvidia Driver: 12.4
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;CUDA: 12.4
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;è½¯ä»¶å®‰è£…&#34;&gt;è½¯ä»¶å®‰è£… &lt;a href=&#34;#%e8%bd%af%e4%bb%b6%e5%ae%89%e8%a3%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;conda-å®‰è£…&#34;&gt;conda å®‰è£… &lt;a href=&#34;#conda-%e5%ae%89%e8%a3%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p ~/miniconda3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rm -rf ~/miniconda3/miniconda.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åˆå§‹åŒ–conda&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda init bash  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#é…ç½®æ¸…åæº&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/menpo/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æ˜¾ç¤ºæ£€ç´¢è·¯å¾„ï¼Œæ¯æ¬¡å®‰è£…åŒ…æ—¶ä¼šå°†åŒ…æºè·¯å¾„æ˜¾ç¤ºå‡ºæ¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --set show_channel_urls yes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --set always_yes True
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¸…é™¤ç´¢å¼•ç¼“å­˜ï¼Œä¿è¯ç”¨çš„æ˜¯é•œåƒç«™æä¾›çš„ç´¢å¼•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda clean -i
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ˜¾ç¤ºæ‰€æœ‰é•œåƒé€šé“è·¯å¾„å‘½ä»¤&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --show channels
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#ä¸æ˜¾ç¤ºbaseç¯å¢ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;~/miniconda3/bin/conda config --set auto_activate_base false
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿é…ç½®ç”Ÿæ•ˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;source ~/.bashrc 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#è™šæ‹Ÿç¯å¢ƒåˆ›å»º &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;conda create --name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;vllm python&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;3.10
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;conda activate vllm
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;nvidiaé©±åŠ¨å®‰è£…&#34;&gt;nvidiaé©±åŠ¨å®‰è£… &lt;a href=&#34;#nvidia%e9%a9%b1%e5%8a%a8%e5%ae%89%e8%a3%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£…nvidiaé©±åŠ¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get update &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get upgrade -y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¿…è¦ä¾èµ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install -y dkms build-essential &lt;span style=&#34;color:#75715e&#34;&gt;# æ‰§è¡Œå®Œæˆé‡å¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# linuxç¦ç”¨Nouvauï¼ˆå¦‚æœæ²¡æœ‰éœ€è¦æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo bash -c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;echo &amp;#34;blacklist nouveau&amp;#34; &amp;gt;&amp;gt; /etc/modprobe.d/blacklist.conf&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo bash -c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;echo &amp;#34;blacklist lbm-nouveau&amp;#34; &amp;gt;&amp;gt; /etc/modprobe.d/blacklist.conf&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo bash -c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;echo &amp;#34;options nouveau modeset=0&amp;#34; &amp;gt;&amp;gt; /etc/modprobe.d/blacklist.conf&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo update-initramfs -u &lt;span style=&#34;color:#75715e&#34;&gt;# æ‰§è¡Œå®Œæˆé‡å¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£…é©±åŠ¨  https://www.nvidia.cn/drivers è‡ªè¡ŒæŸ¥æ‰¾å¯¹åº”æ˜¾å¡é©±åŠ¨å’Œç³»ç»Ÿç‰ˆæœ¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir ~/Downloads  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; cd ~/Downloads 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo dpkg -i nvidia-driver-local-repo-ubuntu2204-550.144.03_1.0-1_amd64.deb
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get update &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get upgrade -y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install -y cuda-drivers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# é‡å¯æœåŠ¡å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;cudaå·¥å…·åŒ…å®‰è£…&#34;&gt;cudaå·¥å…·åŒ…å®‰è£… &lt;a href=&#34;#cuda%e5%b7%a5%e5%85%b7%e5%8c%85%e5%ae%89%e8%a3%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#ä¸‹è½½åœ°å€ï¼šhttps://developer.nvidia.com/cuda-toolkit-archiveï¼Œæ‰¾åˆ°12.4.0ç‰ˆæœ¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd ~/Downloads 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://developer.download.nvidia.com/compute/cuda/12.4.0/local_installers/cuda_12.4.0_550.54.14_linux.run
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo chmod a+x cuda_12.4.0_550.54.14_linux.run 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo sh cuda_12.4.0_550.54.14_linux.run
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#è®¾ç½®ç¯å¢ƒå˜é‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim ~/.bashrc  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export LD_LIBRARY_PATH&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$LD_LIBRARY_PATH:/usr/local/cuda-12.4/lib64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export PATH&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$PATH:/usr/local/cuda-12.4/bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export CUDA_HOME&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$CUDA_HOME:/usr/local/cuda-12.4
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;source ~/.bashrc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æŸ¥çœ‹å®‰è£…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nvcc --version
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;pytorchå’Œvllmå®‰è£…&#34;&gt;pytorchå’Œvllmå®‰è£… &lt;a href=&#34;#pytorch%e5%92%8cvllm%e5%ae%89%e8%a3%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£…pytorch https://download.pytorch.org/whl/torch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# torch-2.4.0+cu124-cp310-cp310-linux_x86_64.whl ï¼Œå…¶ä¸­cu124è¡¨ç¤ºcuda-12.4.0 cp310è¡¨ç¤ºpython-3.10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd ~/Downloads
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://download.pytorch.org/whl/cu124/torch-2.4.0%2Bcu124-cp310-cp310-linux_x86_64.whl#sha256&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;2cb28155635e3d3d0be198e3f3e7457a1d7b99e8c2eedc73fe22fab574d11a4c
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;conda activate vllm
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip install torch-2.4.0+cu124-cp310-cp310-linux_x86_64.whl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip install vLLM
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;vllmè¿è¡Œ&#34;&gt;vllmè¿è¡Œ &lt;a href=&#34;#vllm%e8%bf%90%e8%a1%8c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;é­”æ­ç¤¾åŒºæ–¹å¼ä¸‹è½½&#34;&gt;é­”æ­ç¤¾åŒºæ–¹å¼ä¸‹è½½ &lt;a href=&#34;#%e9%ad%94%e6%90%ad%e7%a4%be%e5%8c%ba%e6%96%b9%e5%bc%8f%e4%b8%8b%e8%bd%bd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#ä¼˜å…ˆä½¿ç”¨é˜¿é‡Œæ¨å‡ºçš„é­”æ­ä¸‹è½½ï¼Œæ¨¡å‹æ²¡æœ‰huggingfaceå…¨é¢ï¼Œæ•™ç¨‹åœ°å€ï¼šhttps://modelscope.cn/docs/home&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;modelscope download --model &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;unsloth/DeepSeek-R1-Distill-Llama-8B&amp;#39;&lt;/span&gt; --local_dir &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/home/ubuntu/data/DeepSeek-R1-Distill-Llama-8B&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;huggingfaceæ–¹å¼æ¨¡å‹ä¸‹è½½å¤‡é€‰&#34;&gt;huggingfaceæ–¹å¼æ¨¡å‹ä¸‹è½½ï¼ˆå¤‡é€‰ï¼‰ &lt;a href=&#34;#huggingface%e6%96%b9%e5%bc%8f%e6%a8%a1%e5%9e%8b%e4%b8%8b%e8%bd%bd%e5%a4%87%e9%80%89&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; huggingface_hub &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; snapshot_download
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model_name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;unsloth/DeepSeek-R1-Distill-Llama-8B&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;local_dir&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/home/ubuntu/data/DeepSeek-R1-Distill-Llama-8B&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# repo_id æ¨¡å‹id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# local_dir ä¸‹è½½åœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# endpoint é•œåƒåœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# resume_download (ä¸­æ–­å)ç»§ç»­ä¸‹è½½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;snapshot_download(repo_id&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;model_name, local_dir&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;local_dir,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  revision&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  endpoint&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;https://hf-mirror.com&amp;#39;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;#é•œåƒåœ°å€ä¼šé™æµ,ä¸å»ºè®®ä½¿ç”¨è¾ƒå¤§å‚æ•°æ¨¡å‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  force_download&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;æ¨¡å‹è°ƒç”¨&#34;&gt;æ¨¡å‹è°ƒç”¨ &lt;a href=&#34;#%e6%a8%a1%e5%9e%8b%e8%b0%83%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h3 id=&#34;æ¨¡å‹å¯åŠ¨&#34;&gt;æ¨¡å‹å¯åŠ¨ &lt;a href=&#34;#%e6%a8%a1%e5%9e%8b%e5%90%af%e5%8a%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å¯åŠ¨è¯´æ˜ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;CUDA_VISIBLE_DEVICES&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; vllm serve /home/ubuntu/data/DeepSeek-R1-Distill-Llama-8B --port &lt;span style=&#34;color:#ae81ff&#34;&gt;8088&lt;/span&gt; --max-model-len &lt;span style=&#34;color:#ae81ff&#34;&gt;16384&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å‚æ•°è¯´æ˜:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;CUDA_VISIBLE_DEVICES&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;0ï¼šæŒ‡å®šä½¿ç”¨çš„ GPU è®¾å¤‡ï¼ˆ0 è¡¨ç¤ºç¬¬ä¸€å— GPUï¼‰ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/home/ubuntu/data/DeepSeek-R1-Distill-Llama-8Bï¼šæ¨¡å‹çš„å®é™…ä¿å­˜è·¯å¾„ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--portï¼šæœåŠ¡ç›‘å¬çš„ç«¯å£å·ï¼ˆå¯æ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--max-model-lenï¼šæ¨¡å‹çš„æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--tensor-parallel-sizeã€-tpï¼šå¤šå¼ é‡å¹¶è¡Œå‰¯æœ¬æ•°é‡ï¼ˆå¯¹äº GPUï¼‰ã€‚é»˜è®¤å€¼ï¼š1ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--gpu-memory-utilizationï¼šè®¾ç½®æ¯å¼ GPUçš„æ˜¾å­˜åˆ©ç”¨ç‡ä¸Šé™ï¼Œå–å€¼èŒƒå›´ä¸º0~1ï¼ˆä¾‹å¦‚ï¼š0.9è¡¨ç¤ºé™åˆ¶ä¸º90%çš„æ˜¾å­˜ä½¿ç”¨ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--host å’Œ --portï¼šæŒ‡å®šæœåŠ¡å™¨åœ°å€å’Œç«¯å£ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--enforce-eagerï¼šå¯ç”¨å³æ—¶æ‰§è¡Œæ¨¡å¼ï¼ˆEager Executionï¼‰ï¼Œå³æ¨¡å‹æ¨ç†ä¼šåœ¨æ¯ä¸ªæ“ä½œæ‰§è¡Œæ—¶ç«‹å³è¿›è¡Œï¼Œè€Œéå…ˆæ„å»ºå®Œæ•´çš„æ“ä½œå›¾ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--dtypeï¼šæ¨¡å‹æƒé‡å’Œæ¿€æ´»çš„ç²¾åº¦ç±»å‹ã€‚å¯èƒ½çš„å€¼ï¼šautoã€halfã€float16ã€bfloat16ã€floatã€float32ã€‚é»˜è®¤å€¼ï¼šautoã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--max-num-seqsï¼šæ¯æ¬¡è¿­ä»£çš„æœ€å¤§åºåˆ—æ•°ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--distributed-executor-backend&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;rayï¼šæŒ‡å®šåˆ†å¸ƒå¼æœåŠ¡çš„åç«¯ï¼Œå¯èƒ½çš„å€¼ï¼šrayã€mpã€‚é»˜è®¤å€¼ï¼šrayï¼ˆå½“ä½¿ç”¨è¶…è¿‡ä¸€ä¸ª GPU æ—¶ï¼Œè‡ªåŠ¨è®¾ç½®ä¸º rayï¼‰ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡è®¿é—® http://localhost:8088/docs æŸ¥çœ‹ API æ–‡æ¡£ï¼ŒéªŒè¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;åå°å¯åŠ¨ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nohup vllm serve /home/ubuntu/data/DeepSeek-R1-Distill-Llama-8B --port &lt;span style=&#34;color:#ae81ff&#34;&gt;8088&lt;/span&gt; --max-model-len &lt;span style=&#34;color:#ae81ff&#34;&gt;16384&lt;/span&gt; --gpu-memory-utilization 0.9 &amp;gt; ./logs/vllm.log 2&amp;gt;&amp;amp;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æµ‹è¯•è°ƒç”¨&#34;&gt;æµ‹è¯•è°ƒç”¨ &lt;a href=&#34;#%e6%b5%8b%e8%af%95%e8%b0%83%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl --location &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;http://101.33.248.34:8088/v1/chat/completions&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--header &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;--data &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#34;model&amp;#34;: &amp;#34;/home/ubuntu/data/DeepSeek-R1-Distill-Llama-8B&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#34;messages&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;            &amp;#34;role&amp;#34;: &amp;#34;user&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;            &amp;#34;content&amp;#34;: &amp;#34;ä½ æ˜¯è°ï¼Ÿ&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;open-webuiè®¿é—®vllm&#34;&gt;open-webuiè®¿é—®vllm &lt;a href=&#34;#open-webui%e8%ae%bf%e9%97%aevllm&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;conda create --name openwebui python&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;3.12
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip install open-webui -i https://mirrors.aliyun.com/pypi/simple/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¯åŠ¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#é•œåƒç«™ç‚¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export HF_ENDPOINT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://hf-mirror.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## ç¦ç”¨OLLAMA API&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export ENABLE_OLLAMA_API&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;False
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## è®¾ç½®vllm APIçš„åŸºç¡€URLä¸ºæœ¬åœ°æœåŠ¡å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export OPENAI_API_BASE_URL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;http://localhost:8088/v1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## è®¾ç½®é»˜è®¤æ¨¡å‹è·¯å¾„&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export DEFAULT_MODELS&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/home/ubuntu/data/DeepSeek-R1-Distill-Llama-8B&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## å¯åŠ¨Open WebUI&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;open-webui serve  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åå°å¯åŠ¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nohup open-webui serve &amp;gt; ./logs/open-webui.log 2&amp;gt;&amp;amp;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>AIæ¨¡å‹å¾®è°ƒ</title>
      <link>https://abnerxc.github.io/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/</link>
      <pubDate>Mon, 03 Mar 2025 18:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/</guid>
      <description>&lt;h1 id=&#34;åŸºç¡€æ“ä½œ&#34;&gt;åŸºç¡€æ“ä½œ &lt;a href=&#34;#%e5%9f%ba%e7%a1%80%e6%93%8d%e4%bd%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å®‰è£…ä¾èµ–&#34;&gt;å®‰è£…ä¾èµ– &lt;a href=&#34;#%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£… unsloth åŒ…ã€‚unsloth æ˜¯ä¸€ä¸ªç”¨äºå¾®è°ƒå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„å·¥å…·ï¼Œå¯ä»¥è®©æ¨¡å‹è¿è¡Œæ›´å¿«ã€å ç”¨æ›´å°‘å†…å­˜ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip install unsloth 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¸è½½å½“å‰å·²å®‰è£…çš„ unsloth åŒ…ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰ï¼Œç„¶åä» GitHub çš„æºä»£ç å®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# è¿™æ ·å¯ä»¥ç¡®ä¿æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æœ€æ–°åŠŸèƒ½å’Œä¿®å¤ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip uninstall unsloth &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;y &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pip install &lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;upgrade &lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;no&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;cache&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;dir &lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;no&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;deps git&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;https:&lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt;github&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;com&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;unslothai&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;unsloth&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;git
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£… bitsandbytes å’Œ unsloth_zoo åŒ…ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# bitsandbytes æ˜¯ä¸€ä¸ªç”¨äºé‡åŒ–å’Œä¼˜åŒ–æ¨¡å‹çš„åº“ï¼Œå¯ä»¥å¸®åŠ©å‡å°‘æ¨¡å‹å ç”¨çš„å†…å­˜ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# unsloth_zoo å¯èƒ½åŒ…å«äº†ä¸€äº›é¢„è®­ç»ƒæ¨¡å‹æˆ–å…¶ä»–å·¥å…·ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip install bitsandbytes unsloth_zoo 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åŠ è½½é¢„è®­ç»ƒæ¨¡å‹&#34;&gt;åŠ è½½é¢„è®­ç»ƒæ¨¡å‹ &lt;a href=&#34;#%e5%8a%a0%e8%bd%bd%e9%a2%84%e8%ae%ad%e7%bb%83%e6%a8%a1%e5%9e%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; unsloth &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; FastLanguageModel  &lt;span style=&#34;color:#75715e&#34;&gt;# å¯¼å…¥FastLanguageModelç±»ï¼Œç”¨æ¥åŠ è½½å’Œä½¿ç”¨æ¨¡å‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; torch  &lt;span style=&#34;color:#75715e&#34;&gt;# å¯¼å…¥torchå·¥å…·ï¼Œç”¨äºå¤„ç†æ¨¡å‹çš„æ•°å­¦è¿ç®—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;max_seq_length &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2048&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½®æ¨¡å‹å¤„ç†æ–‡æœ¬çš„æœ€å¤§é•¿åº¦ï¼Œç›¸å½“äºç»™æ¨¡å‹è®¾ç½®ä¸€ä¸ªâ€œæœ€å¤§å®¹é‡â€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dtype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;None&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½®æ•°æ®ç±»å‹ï¼Œè®©æ¨¡å‹è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„ç²¾åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;load_in_4bit &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨4ä½é‡åŒ–æ¥èŠ‚çœå†…å­˜ï¼Œå°±åƒæŠŠå¤§ç®±å­å‹ç¼©æˆå°ç®±å­&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¹¶è·å–tokenizerå·¥å…·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model, tokenizer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FastLanguageModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    model_name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;unsloth/DeepSeek-R1-Distill-Llama-8B&amp;#34;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æŒ‡å®šè¦åŠ è½½çš„æ¨¡å‹åç§°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    max_seq_length&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;max_seq_length,  &lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨å‰é¢è®¾ç½®çš„æœ€å¤§é•¿åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dtype&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;dtype,  &lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨å‰é¢è®¾ç½®çš„æ•°æ®ç±»å‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    load_in_4bit&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;load_in_4bit,  &lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨4ä½é‡åŒ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# token=&amp;#34;hf_...&amp;#34;,  # å¦‚æœéœ€è¦è®¿é—®æˆæƒæ¨¡å‹ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¡«å…¥å¯†é’¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å¾®è°ƒå‰æµ‹è¯•&#34;&gt;å¾®è°ƒå‰æµ‹è¯• &lt;a href=&#34;#%e5%be%ae%e8%b0%83%e5%89%8d%e6%b5%8b%e8%af%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;prompt_style &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&amp;#34;ä»¥ä¸‹æ˜¯æè¿°ä»»åŠ¡çš„æŒ‡ä»¤ï¼Œä»¥åŠæä¾›è¿›ä¸€æ­¥ä¸Šä¸‹æ–‡çš„è¾“å…¥ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;è¯·å†™å‡ºä¸€ä¸ªé€‚å½“å®Œæˆè¯·æ±‚çš„å›ç­”ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;åœ¨å›ç­”ä¹‹å‰ï¼Œè¯·ä»”ç»†æ€è€ƒé—®é¢˜ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªé€»è¾‘è¿è´¯çš„æ€è€ƒè¿‡ç¨‹ï¼Œä»¥ç¡®ä¿å›ç­”å‡†ç¡®æ— è¯¯ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;### æŒ‡ä»¤ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ä½ æ˜¯ä¸€ä½èµ„æ·±é“¶è¡Œè¥é”€ä¸“å®¶ï¼Œéœ€è¦æ ¹æ®å®¢æˆ·éœ€æ±‚ç”Ÿæˆå®Œæ•´çš„é“¶è¡Œé¢†åŸŸæ´»åŠ¨æ–¹æ¡ˆã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;è¯·å›ç­”ä»¥ä¸‹é—®é¢˜ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;### é—®é¢˜ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{question}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;### å›ç­”ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;think&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{answer}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®šä¹‰æç¤ºé£æ ¼çš„å­—ç¬¦ä¸²æ¨¡æ¿ï¼Œç”¨äºæ ¼å¼åŒ–é—®é¢˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;question &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;è¯·ä¸ºå¹´è½»ç™½é¢†è®¾è®¡ä¿¡ç”¨å¡å¼€å¡ä¿ƒé”€æ´»åŠ¨&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;FastLanguageModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;for_inference(model)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å‡†å¤‡æ¨¡å‹ä»¥è¿›è¡Œæ¨ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inputs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tokenizer([prompt_style&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;format(question, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;)], return_tensors&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;to(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cuda&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨ tokenizer å¯¹æ ¼å¼åŒ–åçš„é—®é¢˜è¿›è¡Œç¼–ç ï¼Œå¹¶ç§»åŠ¨åˆ° GPU&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;outputs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;generate(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    input_ids&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;inputs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;input_ids,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    attention_mask&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;inputs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;attention_mask,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    max_new_tokens&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1200&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    use_cache&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨æ¨¡å‹ç”Ÿæˆå›ç­”&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;response &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;batch_decode(outputs)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# è§£ç æ¨¡å‹ç”Ÿæˆçš„è¾“å‡ºä¸ºå¯è¯»æ–‡æœ¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print(response[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ‰“å°ç”Ÿæˆçš„å›ç­”éƒ¨åˆ†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ•°æ®å‡†å¤‡&#34;&gt;æ•°æ®å‡†å¤‡ &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%87%86%e5%a4%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;EOS_TOKEN &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;eos_token  &lt;span style=&#34;color:#75715e&#34;&gt;# å¿…é¡»æ·»åŠ ç»“æŸæ ‡è®°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¯¼å…¥æ•°æ®é›†åŠ è½½å‡½æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; datasets &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; load_dataset
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åŠ è½½æŒ‡å®šçš„æ•°æ®é›†ï¼Œé€‰æ‹©ä¸­æ–‡è¯­è¨€å’Œè®­ç»ƒé›†çš„å‰500æ¡è®°å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dataset &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; load_dataset(path&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;, data_files&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/home/ubuntu/code/all.jsonl&amp;#34;&lt;/span&gt;, split&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;train[0:500]&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ‰“å°æ•°æ®é›†çš„åˆ—åï¼ŒæŸ¥çœ‹æ•°æ®é›†ä¸­æœ‰å“ªäº›å­—æ®µ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;formatting_prompts_func&lt;/span&gt;(examples):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# ä»æ•°æ®é›†ä¸­æå–é—®é¢˜å’Œå›ç­”&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    texts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []  &lt;span style=&#34;color:#75715e&#34;&gt;# ç”¨äºå­˜å‚¨æ ¼å¼åŒ–åçš„æ–‡æœ¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; messages &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; examples[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;messages&amp;#34;&lt;/span&gt;]:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# æå–ç”¨æˆ·é—®é¢˜ï¼ˆç¬¬äºŒä¸ªæ¶ˆæ¯ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        question &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; messages[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;][&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# æå–åŠ©æ‰‹å›ç­”ï¼ˆç¬¬ä¸‰ä¸ªæ¶ˆæ¯ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        answer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; messages[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;][&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# æ ¼å¼åŒ–æ¨¡æ¿&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        formatted_text &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; prompt_style&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;format(question&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;question, answer&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;answer)&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;EOS_TOKEN
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        texts&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(formatted_text)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;: texts,  &lt;span style=&#34;color:#75715e&#34;&gt;# è¿”å›åŒ…å«æ‰€æœ‰æ ¼å¼åŒ–æ–‡æœ¬çš„å­—å…¸&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dataset &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dataset&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;map(formatting_prompts_func, batched&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# print(dataset[&amp;#34;text&amp;#34;][0])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ‰§è¡Œå¾®è°ƒ&#34;&gt;æ‰§è¡Œå¾®è°ƒ &lt;a href=&#34;#%e6%89%a7%e8%a1%8c%e5%be%ae%e8%b0%83&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;FastLanguageModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;for_training(model)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FastLanguageModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get_peft_model(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    model,  &lt;span style=&#34;color:#75715e&#34;&gt;# ä¼ å…¥å·²ç»åŠ è½½å¥½çš„é¢„è®­ç»ƒæ¨¡å‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½® LoRA çš„ç§©ï¼Œå†³å®šæ·»åŠ çš„å¯è®­ç»ƒå‚æ•°æ•°é‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    target_modules &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;q_proj&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;k_proj&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;v_proj&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;o_proj&amp;#34;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æŒ‡å®šæ¨¡å‹ä¸­éœ€è¦å¾®è°ƒçš„å…³é”®æ¨¡å—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gate_proj&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;up_proj&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;down_proj&amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lora_alpha &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½® LoRA çš„è¶…å‚æ•°ï¼Œå½±å“å¯è®­ç»ƒå‚æ•°çš„è®­ç»ƒæ–¹å¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lora_dropout &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½®é˜²æ­¢è¿‡æ‹Ÿåˆçš„å‚æ•°ï¼Œè¿™é‡Œè®¾ç½®ä¸º 0 è¡¨ç¤ºä¸ä¸¢å¼ƒä»»ä½•å‚æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    bias &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;,    &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½®æ˜¯å¦æ·»åŠ åç½®é¡¹ï¼Œè¿™é‡Œè®¾ç½®ä¸º &amp;#34;none&amp;#34; è¡¨ç¤ºä¸æ·»åŠ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    use_gradient_checkpointing &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;unsloth&amp;#34;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨ä¼˜åŒ–æŠ€æœ¯èŠ‚çœæ˜¾å­˜å¹¶æ”¯æŒæ›´å¤§çš„æ‰¹é‡å¤§å°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    random_state &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3407&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½®éšæœºç§å­ï¼Œç¡®ä¿æ¯æ¬¡è¿è¡Œä»£ç æ—¶æ¨¡å‹çš„åˆå§‹åŒ–æ–¹å¼ç›¸åŒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    use_rslora &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½®æ˜¯å¦ä½¿ç”¨ Rank Stabilized LoRA æŠ€æœ¯ï¼Œè¿™é‡Œè®¾ç½®ä¸º False è¡¨ç¤ºä¸ä½¿ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    loftq_config &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;None&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½®æ˜¯å¦ä½¿ç”¨ LoftQ æŠ€æœ¯ï¼Œè¿™é‡Œè®¾ç½®ä¸º None è¡¨ç¤ºä¸ä½¿ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; trl &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; SFTTrainer  &lt;span style=&#34;color:#75715e&#34;&gt;# å¯¼å…¥ SFTTrainerï¼Œç”¨äºç›‘ç£å¼å¾®è°ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; transformers &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; TrainingArguments  &lt;span style=&#34;color:#75715e&#34;&gt;# å¯¼å…¥ TrainingArgumentsï¼Œç”¨äºè®¾ç½®è®­ç»ƒå‚æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; unsloth &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; is_bfloat16_supported  &lt;span style=&#34;color:#75715e&#34;&gt;# å¯¼å…¥å‡½æ•°ï¼Œæ£€æŸ¥æ˜¯å¦æ”¯æŒ bfloat16 æ•°æ®æ ¼å¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;trainer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; SFTTrainer(  &lt;span style=&#34;color:#75715e&#34;&gt;# åˆ›å»ºä¸€ä¸ª SFTTrainer å®ä¾‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    model&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;model,  &lt;span style=&#34;color:#75715e&#34;&gt;# ä¼ å…¥è¦å¾®è°ƒçš„æ¨¡å‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;tokenizer,  &lt;span style=&#34;color:#75715e&#34;&gt;# ä¼ å…¥ tokenizerï¼Œç”¨äºå¤„ç†æ–‡æœ¬æ•°æ®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    train_dataset&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;dataset,  &lt;span style=&#34;color:#75715e&#34;&gt;# ä¼ å…¥è®­ç»ƒæ•°æ®é›†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dataset_text_field&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æŒ‡å®šæ•°æ®é›†ä¸­æ–‡æœ¬å­—æ®µçš„åç§°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    max_seq_length&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;max_seq_length,  &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½®æœ€å¤§åºåˆ—é•¿åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dataset_num_proc&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# è®¾ç½®æ•°æ®å¤„ç†çš„å¹¶è¡Œè¿›ç¨‹æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    packing&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æ˜¯å¦å¯ç”¨æ‰“åŒ…åŠŸèƒ½ï¼ˆè¿™é‡Œè®¾ç½®ä¸º Falseï¼Œæ‰“åŒ…å¯ä»¥è®©è®­ç»ƒæ›´å¿«ï¼Œä½†å¯èƒ½å½±å“æ•ˆæœï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    args&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;TrainingArguments(  &lt;span style=&#34;color:#75715e&#34;&gt;# å®šä¹‰è®­ç»ƒå‚æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        per_device_train_batch_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æ¯ä¸ªè®¾å¤‡ï¼ˆå¦‚ GPUï¼‰ä¸Šçš„æ‰¹é‡å¤§å°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        gradient_accumulation_steps&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æ¢¯åº¦ç´¯ç§¯æ­¥æ•°ï¼Œç”¨äºæ¨¡æ‹Ÿå¤§æ‰¹æ¬¡è®­ç»ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        warmup_steps&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# é¢„çƒ­æ­¥æ•°ï¼Œè®­ç»ƒå¼€å§‹æ—¶å­¦ä¹ ç‡é€æ¸å¢åŠ çš„æ­¥æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        max_steps&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;75&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æœ€å¤§è®­ç»ƒæ­¥æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        learning_rate&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2e-4&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# å­¦ä¹ ç‡ï¼Œæ¨¡å‹å­¦ä¹ æ–°çŸ¥è¯†çš„é€Ÿåº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        fp16&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; is_bfloat16_supported(),  &lt;span style=&#34;color:#75715e&#34;&gt;# æ˜¯å¦ä½¿ç”¨ fp16 æ ¼å¼åŠ é€Ÿè®­ç»ƒï¼ˆå¦‚æœç¯å¢ƒä¸æ”¯æŒ bfloat16ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        bf16&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;is_bfloat16_supported(),  &lt;span style=&#34;color:#75715e&#34;&gt;# æ˜¯å¦ä½¿ç”¨ bfloat16 æ ¼å¼åŠ é€Ÿè®­ç»ƒï¼ˆå¦‚æœç¯å¢ƒæ”¯æŒï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        logging_steps&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æ¯éš”å¤šå°‘æ­¥è®°å½•ä¸€æ¬¡è®­ç»ƒæ—¥å¿—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        optim&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;adamw_8bit&amp;#34;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨çš„ä¼˜åŒ–å™¨ï¼Œç”¨äºè°ƒæ•´æ¨¡å‹å‚æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        weight_decay&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.01&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æƒé‡è¡°å‡ï¼Œé˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        lr_scheduler_type&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;linear&amp;#34;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# å­¦ä¹ ç‡è°ƒåº¦å™¨ç±»å‹ï¼Œæ§åˆ¶å­¦ä¹ ç‡çš„å˜åŒ–æ–¹å¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        seed&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3407&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# éšæœºç§å­ï¼Œç¡®ä¿è®­ç»ƒç»“æœå¯å¤ç°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        output_dir&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;outputs&amp;#34;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# è®­ç»ƒç»“æœä¿å­˜çš„ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        report_to&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æ˜¯å¦å°†è®­ç»ƒç»“æœæŠ¥å‘Šåˆ°å¤–éƒ¨å·¥å…·ï¼ˆå¦‚ WandBï¼‰ï¼Œè¿™é‡Œè®¾ç½®ä¸ºä¸æŠ¥å‘Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;trainer_stats &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; trainer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train() &lt;span style=&#34;color:#75715e&#34;&gt;# å¼€å§‹è®­ç»ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å¾®è°ƒåæµ‹è¯•&#34;&gt;å¾®è°ƒåæµ‹è¯• &lt;a href=&#34;#%e5%be%ae%e8%b0%83%e5%90%8e%e6%b5%8b%e8%af%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†æ¨¡å‹åˆ‡æ¢åˆ°æ¨ç†æ¨¡å¼ï¼Œå‡†å¤‡å›ç­”é—®é¢˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;FastLanguageModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;for_inference(model)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†é—®é¢˜è½¬æ¢æˆæ¨¡å‹èƒ½ç†è§£çš„æ ¼å¼ï¼Œå¹¶å‘é€åˆ° GPU ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;inputs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tokenizer([prompt_style&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;format(question, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;)], return_tensors&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;to(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cuda&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# è®©æ¨¡å‹æ ¹æ®é—®é¢˜ç”Ÿæˆå›ç­”ï¼Œæœ€å¤šç”Ÿæˆ 4000 ä¸ªæ–°è¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;outputs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;generate(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    input_ids&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;inputs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;input_ids,  &lt;span style=&#34;color:#75715e&#34;&gt;# è¾“å…¥çš„æ•°å­—åºåˆ—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    attention_mask&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;inputs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;attention_mask,  &lt;span style=&#34;color:#75715e&#34;&gt;# æ³¨æ„åŠ›é®ç½©ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£å“ªäº›éƒ¨åˆ†é‡è¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    max_new_tokens&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4000&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# æœ€å¤šç”Ÿæˆ 4000 ä¸ªæ–°è¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    use_cache&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;# ä½¿ç”¨ç¼“å­˜åŠ é€Ÿç”Ÿæˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†ç”Ÿæˆçš„å›ç­”ä»æ•°å­—è½¬æ¢å›æ–‡å­—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;response &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tokenizer&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;batch_decode(outputs)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ‰“å°å›ç­”&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;print(response[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å°†å¾®è°ƒåçš„æ¨¡å‹ä¿å­˜ä¸º-gguf-æ ¼å¼&#34;&gt;å°†å¾®è°ƒåçš„æ¨¡å‹ä¿å­˜ä¸º GGUF æ ¼å¼ &lt;a href=&#34;#%e5%b0%86%e5%be%ae%e8%b0%83%e5%90%8e%e7%9a%84%e6%a8%a1%e5%9e%8b%e4%bf%9d%e5%ad%98%e4%b8%ba-gguf-%e6%a0%bc%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¯¼å…¥ Google Colab çš„ userdata æ¨¡å—ï¼Œç”¨äºè®¿é—®ç”¨æˆ·æ•°æ®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; google.colab &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; userdata
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä» Google Colab ç”¨æˆ·æ•°æ®ä¸­è·å– Hugging Face çš„ API ä»¤ç‰Œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;HUGGINGFACE_TOKEN &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; userdata&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;HUGGINGFACE_TOKEN&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†æ¨¡å‹ä¿å­˜ä¸º 8 ä½é‡åŒ–æ ¼å¼ï¼ˆQ8_0ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# è¿™ç§æ ¼å¼æ–‡ä»¶å°ä¸”è¿è¡Œå¿«ï¼Œé€‚åˆéƒ¨ç½²åˆ°èµ„æºå—é™çš„è®¾å¤‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;: model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;save_pretrained_gguf(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;, tokenizer,)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†æ¨¡å‹ä¿å­˜ä¸º 16 ä½é‡åŒ–æ ¼å¼ï¼ˆf16ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 16 ä½é‡åŒ–ç²¾åº¦æ›´é«˜ï¼Œä½†æ–‡ä»¶ç¨å¤§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;: model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;save_pretrained_gguf(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;model_f16&amp;#34;&lt;/span&gt;, tokenizer, quantization_method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;f16&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†æ¨¡å‹ä¿å­˜ä¸º 4 ä½é‡åŒ–æ ¼å¼ï¼ˆq4_k_mï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 4 ä½é‡åŒ–æ–‡ä»¶æœ€å°ï¼Œä½†ç²¾åº¦å¯èƒ½ç¨ä½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;: model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;save_pretrained_gguf(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;, tokenizer, quantization_method &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;q4_k_m&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ¨¡å‹ä¸Šä¼ huggingface&#34;&gt;æ¨¡å‹ä¸Šä¼ HuggingFace &lt;a href=&#34;#%e6%a8%a1%e5%9e%8b%e4%b8%8a%e4%bc%a0huggingface&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å¯¼å…¥ Hugging Face Hub çš„ create_repo å‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹ä»“åº“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; huggingface_hub &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; create_repo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åœ¨ Hugging Face Hub ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹ä»“åº“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;create_repo(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Conard/fortunetelling&amp;#34;&lt;/span&gt;, token&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;HUGGINGFACE_TOKEN, exist_ok&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å°†æ¨¡å‹å’Œåˆ†è¯å™¨ä¸Šä¼ åˆ° Hugging Face Hub ä¸Šçš„ä»“åº“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;push_to_hub_gguf(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Conard/fortunetelling&amp;#34;&lt;/span&gt;, tokenizer, token&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;HUGGINGFACE_TOKEN)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Goä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨æ€»ç»“</title>
      <link>https://abnerxc.github.io/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/</link>
      <pubDate>Sat, 21 Sep 2024 10:46:12 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;åŸæ–‡ï¼šhttps://www.yuque.com/aceld/golang/zhzanb&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;è§†é¢‘é“¾æ¥åœ°å€ï¼šhttps://www.bilibili.com/video/BV1wz4y1y7Kd&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åƒåœ¾å›æ”¶(Garbage Collectionï¼Œç®€ç§°GC)æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­æä¾›çš„è‡ªåŠ¨çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œè‡ªåŠ¨é‡Šæ”¾ä¸éœ€è¦çš„å†…å­˜å¯¹è±¡ï¼Œè®©å‡ºå­˜å‚¨å™¨èµ„æºã€‚GCè¿‡ç¨‹ä¸­æ— éœ€ç¨‹åºå‘˜æ‰‹åŠ¨æ‰§è¡Œã€‚GCæœºåˆ¶åœ¨ç°ä»£å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒï¼ŒGCèƒ½åŠ›çš„æ€§èƒ½ä¸ä¼˜åŠ£ä¹Ÿæ˜¯ä¸åŒè¯­è¨€ä¹‹é—´å¯¹æ¯”åº¦æŒ‡æ ‡ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Go V1.3ä¹‹å‰çš„æ ‡è®°-æ¸…æ‰«(mark and sweep)&lt;/li&gt;
&lt;li&gt;Go V1.5çš„ä¸‰è‰²å¹¶å‘æ ‡è®°æ³•&lt;/li&gt;
&lt;li&gt;Go V1.5çš„ä¸‰è‰²æ ‡è®°ä¸ºä»€ä¹ˆéœ€è¦STW&lt;/li&gt;
&lt;li&gt;Go V1.5çš„ä¸‰è‰²æ ‡è®°ä¸ºä»€ä¹ˆéœ€è¦å±éšœæœºåˆ¶(â€œå¼º-å¼±â€ ä¸‰è‰²ä¸å˜å¼ã€æ’å…¥å±éšœã€åˆ é™¤å±éšœ )&lt;/li&gt;
&lt;li&gt;Go V1.8æ··åˆå†™å±éšœæœºåˆ¶&lt;/li&gt;
&lt;li&gt;Go V1.8æ··åˆå†™å±éšœæœºåˆ¶çš„å…¨åœºæ™¯åˆ†æ&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¸€go-v13ä¹‹å‰çš„æ ‡è®°-æ¸…é™¤mark-and-sweepç®—æ³•&#34;&gt;ä¸€ã€Go V1.3ä¹‹å‰çš„æ ‡è®°-æ¸…é™¤(mark and sweep)ç®—æ³• &lt;a href=&#34;#%e4%b8%80go-v13%e4%b9%8b%e5%89%8d%e7%9a%84%e6%a0%87%e8%ae%b0-%e6%b8%85%e9%99%a4mark-and-sweep%e7%ae%97%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;æ ‡è®°-æ¸…é™¤mark-and-sweepçš„åŸç†&#34;&gt;æ ‡è®°-æ¸…é™¤(mark and sweep)çš„åŸç† &lt;a href=&#34;#%e6%a0%87%e8%ae%b0-%e6%b8%85%e9%99%a4mark-and-sweep%e7%9a%84%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æ­¤ç®—æ³•ä¸»è¦æœ‰ä¸¤ä¸ªä¸»è¦çš„æ­¥éª¤ï¼š&lt;code&gt;æ ‡è®°(Mark phase)&lt;/code&gt;å’Œ&lt;code&gt;æ¸…é™¤(Sweep phase)&lt;/code&gt;
&lt;strong&gt;ç¬¬ä¸€æ­¥&lt;/strong&gt;ï¼Œæš‚åœç¨‹åºä¸šåŠ¡é€»è¾‘, åˆ†ç±»å‡ºå¯è¾¾å’Œä¸å¯è¾¾çš„å¯¹è±¡ï¼Œç„¶ååšä¸Šæ ‡è®°ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC1.png&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸­è¡¨ç¤ºæ˜¯ç¨‹åºä¸å¯¹è±¡çš„å¯è¾¾å…³ç³»ï¼Œç›®å‰ç¨‹åºçš„å¯è¾¾å¯¹è±¡æœ‰å¯¹è±¡1-2-3ï¼Œå¯¹è±¡4-7ç­‰äº”ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒæ­¥&lt;/strong&gt;, å¼€å§‹æ ‡è®°ï¼Œç¨‹åºæ‰¾å‡ºå®ƒæ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ï¼Œå¹¶åšä¸Šæ ‡è®°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC2.png&#34; alt=&#34;gc&#34;&gt;
æ‰€ä»¥å¯¹è±¡1-2-3ã€å¯¹è±¡4-7ç­‰äº”ä¸ªå¯¹è±¡è¢«åšä¸Šæ ‡è®°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸‰æ­¥&lt;/strong&gt;,  æ ‡è®°å®Œäº†ä¹‹åï¼Œç„¶åå¼€å§‹æ¸…é™¤æœªæ ‡è®°çš„å¯¹è±¡. ç»“æœå¦‚ä¸‹ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC3.png&#34; alt=&#34;gc&#34;&gt;
æ“ä½œéå¸¸ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦é¢å¤–æ³¨æ„ï¼šmark and sweepç®—æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œéœ€è¦ç¨‹åºæš‚åœï¼å³ STW(stop the world)ï¼ŒSTWçš„è¿‡ç¨‹ä¸­ï¼ŒCPUä¸æ‰§è¡Œç”¨æˆ·ä»£ç ï¼Œå…¨éƒ¨ç”¨äºåƒåœ¾å›æ”¶ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„å½±å“å¾ˆå¤§ï¼Œæ‰€ä»¥STWä¹Ÿæ˜¯ä¸€äº›å›æ”¶æœºåˆ¶æœ€å¤§çš„éš¾é¢˜å’Œå¸Œæœ›ä¼˜åŒ–çš„ç‚¹ã€‚æ‰€ä»¥åœ¨æ‰§è¡Œç¬¬ä¸‰æ­¥çš„è¿™æ®µæ—¶é—´ï¼Œç¨‹åºä¼šæš‚å®šåœæ­¢ä»»ä½•å·¥ä½œï¼Œå¡åœ¨é‚£ç­‰å¾…å›æ”¶æ‰§è¡Œå®Œæ¯•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬å››æ­¥&lt;/strong&gt;, åœæ­¢æš‚åœï¼Œè®©ç¨‹åºç»§ç»­è·‘ã€‚ç„¶åå¾ªç¯é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°processç¨‹åºç”Ÿå‘½å‘¨æœŸç»“æŸã€‚&lt;/p&gt;
&lt;h1 id=&#34;äºŒæ ‡è®°-æ¸…é™¤mark-and-sweepçš„ç¼ºç‚¹&#34;&gt;äºŒã€æ ‡è®°-æ¸…é™¤(mark and sweep)çš„ç¼ºç‚¹ &lt;a href=&#34;#%e4%ba%8c%e6%a0%87%e8%ae%b0-%e6%b8%85%e9%99%a4mark-and-sweep%e7%9a%84%e7%bc%ba%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æ ‡è®°æ¸…é™¤ç®—æ³•æ˜äº†ï¼Œè¿‡ç¨‹é²œæ˜å¹²è„†ï¼Œä½†æ˜¯ä¹Ÿæœ‰éå¸¸ä¸¥é‡çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;STWï¼Œstop the worldï¼›è®©ç¨‹åºæš‚åœï¼Œç¨‹åºå‡ºç°å¡é¡¿ &lt;code&gt;(é‡è¦é—®é¢˜)&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æ ‡è®°éœ€è¦æ‰«ææ•´ä¸ªheapï¼›&lt;/li&gt;
&lt;li&gt;æ¸…é™¤æ•°æ®ä¼šäº§ç”Ÿheapç¢ç‰‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Go V1.3ç‰ˆæœ¬ä¹‹å‰å°±æ˜¯ä»¥ä¸Šæ¥å®æ–½çš„,  åœ¨æ‰§è¡ŒGCçš„åŸºæœ¬æµç¨‹å°±æ˜¯é¦–å…ˆå¯åŠ¨STWæš‚åœï¼Œç„¶åæ‰§è¡Œæ ‡è®°ï¼Œå†æ‰§è¡Œæ•°æ®å›æ”¶ï¼Œæœ€ååœæ­¢STWï¼Œå¦‚å›¾æ‰€ç¤ºã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-STW1.png&#34; alt=&#34;gc&#34;&gt;
ä»ä¸Šå›¾æ¥çœ‹ï¼Œå…¨éƒ¨çš„GCæ—¶é—´éƒ½æ˜¯åŒ…è£¹åœ¨STWèŒƒå›´ä¹‹å†…çš„ï¼Œè¿™æ ·è²Œä¼¼ç¨‹åºæš‚åœçš„æ—¶é—´è¿‡é•¿ï¼Œå½±å“ç¨‹åºçš„è¿è¡Œæ€§èƒ½ã€‚æ‰€ä»¥Go V1.3 åšäº†ç®€å•çš„ä¼˜åŒ–,å°†STWçš„æ­¥éª¤æå‰, å‡å°‘STWæš‚åœçš„æ—¶é—´èŒƒå›´.å¦‚ä¸‹æ‰€ç¤º
&lt;img src=&#34;https://abnerxc.github.io/img/go-STW2.png&#34; alt=&#34;gc&#34;&gt;
ä¸Šå›¾ä¸»è¦æ˜¯å°†STWçš„æ­¥éª¤æå‰äº†ä¸€æ­¥ï¼Œå› ä¸ºåœ¨Sweepæ¸…é™¤çš„æ—¶å€™ï¼Œå¯ä»¥ä¸éœ€è¦STWåœæ­¢ï¼Œå› ä¸ºè¿™äº›å¯¹è±¡å·²ç»æ˜¯ä¸å¯è¾¾å¯¹è±¡äº†ï¼Œä¸ä¼šå‡ºç°å›æ”¶å†™å†²çªç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æ— è®ºæ€ä¹ˆä¼˜åŒ–ï¼ŒGo V1.3éƒ½é¢ä¸´è¿™ä¸ªä¸€ä¸ªé‡è¦é—®é¢˜ï¼Œå°±æ˜¯mark-and-sweep ç®—æ³•ä¼šæš‚åœæ•´ä¸ªç¨‹åº ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸‰go-v15çš„ä¸‰è‰²å¹¶å‘æ ‡è®°æ³•&#34;&gt;ä¸‰ã€Go V1.5çš„ä¸‰è‰²å¹¶å‘æ ‡è®°æ³• &lt;a href=&#34;#%e4%b8%89go-v15%e7%9a%84%e4%b8%89%e8%89%b2%e5%b9%b6%e5%8f%91%e6%a0%87%e8%ae%b0%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Golangä¸­çš„åƒåœ¾å›æ”¶ä¸»è¦åº”ç”¨ä¸‰è‰²æ ‡è®°æ³•ï¼ŒGCè¿‡ç¨‹å’Œå…¶ä»–ç”¨æˆ·goroutineå¯å¹¶å‘è¿è¡Œï¼Œä½†éœ€è¦ä¸€å®šæ—¶é—´çš„&lt;strong&gt;STW(stop the world)&lt;/strong&gt;ï¼Œæ‰€è°“&lt;strong&gt;ä¸‰è‰²æ ‡è®°æ³•&lt;/strong&gt;å®é™…ä¸Šå°±æ˜¯é€šè¿‡ä¸‰ä¸ªé˜¶æ®µçš„æ ‡è®°æ¥ç¡®å®šæ¸…æ¥šçš„å¯¹è±¡éƒ½æœ‰å“ªäº›ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„è¿‡ç¨‹ã€‚
&lt;strong&gt;ç¬¬ä¸€æ­¥&lt;/strong&gt; , æ¯æ¬¡æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œé»˜è®¤çš„é¢œè‰²éƒ½æ˜¯æ ‡è®°ä¸ºâ€œç™½è‰²â€ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC4.png&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„ç¨‹åºå¯æŠµè¾¾çš„å†…å­˜å¯¹è±¡å…³ç³»å¦‚å·¦å›¾æ‰€ç¤ºï¼Œå³è¾¹çš„æ ‡è®°è¡¨ï¼Œæ˜¯ç”¨æ¥è®°å½•ç›®å‰æ¯ä¸ªå¯¹è±¡çš„æ ‡è®°é¢œè‰²åˆ†ç±»ã€‚è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰€è°“â€œç¨‹åºâ€ï¼Œåˆ™æ˜¯ä¸€äº›å¯¹è±¡çš„æ ¹èŠ‚ç‚¹é›†åˆã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚æœå°†â€œç¨‹åºâ€å±•å¼€ï¼Œä¼šå¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¡¨ç°å½¢å¼ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC5.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒæ­¥&lt;/strong&gt;, æ¯æ¬¡GCå›æ”¶å¼€å§‹, ä¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†æ‰€æœ‰å¯¹è±¡ï¼ŒæŠŠéå†åˆ°çš„å¯¹è±¡ä»ç™½è‰²é›†åˆæ”¾å…¥â€œç°è‰²â€é›†åˆå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC6.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œ è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬æ¬¡éå†æ˜¯ä¸€æ¬¡éå†ï¼Œéé€’å½’å½¢å¼ï¼Œæ˜¯ä»ç¨‹åºæŠ½æ¬¡å¯æŠµè¾¾çš„å¯¹è±¡éå†ä¸€å±‚ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“å‰å¯æŠµè¾¾çš„å¯¹è±¡æ˜¯å¯¹è±¡1å’Œå¯¹è±¡4ï¼Œé‚£ä¹ˆè‡ªç„¶æœ¬è½®éå†ç»“æŸï¼Œå¯¹è±¡1å’Œå¯¹è±¡4å°±ä¼šè¢«æ ‡è®°ä¸ºç°è‰²ï¼Œç°è‰²æ ‡è®°è¡¨å°±ä¼šå¤šå‡ºè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸‰æ­¥&lt;/strong&gt;, éå†ç°è‰²é›†åˆï¼Œå°†ç°è‰²å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ä»ç™½è‰²é›†åˆæ”¾å…¥ç°è‰²é›†åˆï¼Œä¹‹åå°†æ­¤ç°è‰²å¯¹è±¡æ”¾å…¥é»‘è‰²é›†åˆï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC7.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ¬¡éå†æ˜¯åªæ‰«æç°è‰²å¯¹è±¡ï¼Œå°†ç°è‰²å¯¹è±¡çš„ç¬¬ä¸€å±‚éå†å¯æŠµè¾¾çš„å¯¹è±¡ç”±ç™½è‰²å˜ä¸ºç°è‰²ï¼Œå¦‚ï¼šå¯¹è±¡2ã€å¯¹è±¡7. è€Œä¹‹å‰çš„ç°è‰²å¯¹è±¡1å’Œå¯¹è±¡4åˆ™ä¼šè¢«æ ‡è®°ä¸ºé»‘è‰²ï¼ŒåŒæ—¶ç”±ç°è‰²æ ‡è®°è¡¨ç§»åŠ¨åˆ°é»‘è‰²æ ‡è®°è¡¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬å››æ­¥&lt;/strong&gt;, é‡å¤ç¬¬ä¸‰æ­¥, ç›´åˆ°ç°è‰²ä¸­æ— ä»»ä½•å¯¹è±¡ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC8.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC9.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬å…¨éƒ¨çš„å¯è¾¾å¯¹è±¡éƒ½éå†å®Œåï¼Œç°è‰²æ ‡è®°è¡¨å°†ä¸å†å­˜åœ¨ç°è‰²å¯¹è±¡ï¼Œç›®å‰å…¨éƒ¨å†…å­˜çš„æ•°æ®åªæœ‰ä¸¤ç§é¢œè‰²ï¼Œé»‘è‰²å’Œç™½è‰²ã€‚é‚£ä¹ˆé»‘è‰²å¯¹è±¡å°±æ˜¯æˆ‘ä»¬ç¨‹åºé€»è¾‘å¯è¾¾ï¼ˆéœ€è¦çš„ï¼‰å¯¹è±¡ï¼Œè¿™äº›æ•°æ®æ˜¯ç›®å‰æ”¯æ’‘ç¨‹åºæ­£å¸¸ä¸šåŠ¡è¿è¡Œçš„ï¼Œæ˜¯åˆæ³•çš„æœ‰ç”¨æ•°æ®ï¼Œä¸å¯åˆ é™¤ï¼Œç™½è‰²çš„å¯¹è±¡æ˜¯å…¨éƒ¨ä¸å¯è¾¾å¯¹è±¡ï¼Œç›®å‰ç¨‹åºé€»è¾‘å¹¶ä¸ä¾èµ–ä»–ä»¬ï¼Œé‚£ä¹ˆç™½è‰²å¯¹è±¡å°±æ˜¯å†…å­˜ä¸­ç›®å‰çš„åƒåœ¾æ•°æ®ï¼Œéœ€è¦è¢«æ¸…é™¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äº”æ­¥&lt;/strong&gt;: å›æ”¶æ‰€æœ‰çš„ç™½è‰²æ ‡è®°è¡¨çš„å¯¹è±¡. ä¹Ÿå°±æ˜¯å›æ”¶åƒåœ¾ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚
ä»¥ä¸Šæˆ‘ä»¬å°†å…¨éƒ¨çš„ç™½è‰²å¯¹è±¡è¿›è¡Œåˆ é™¤å›æ”¶ï¼Œ
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC10.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;å‰©ä¸‹çš„å°±æ˜¯å…¨éƒ¨ä¾èµ–çš„é»‘è‰²å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šä¾¿æ˜¯&lt;code&gt;ä¸‰è‰²å¹¶å‘æ ‡è®°æ³•&lt;/code&gt;ï¼Œä¸éš¾çœ‹å‡ºï¼Œæˆ‘ä»¬ä¸Šé¢å·²ç»æ¸…æ¥šçš„ä½“ç°&lt;code&gt;ä¸‰è‰²&lt;/code&gt;çš„ç‰¹æ€§ã€‚ä½†æ˜¯è¿™é‡Œé¢å¯èƒ½ä¼šæœ‰å¾ˆå¤šå¹¶å‘æµç¨‹å‡ä¼šè¢«æ‰«æï¼Œæ‰§è¡Œå¹¶å‘æµç¨‹çš„å†…å­˜å¯èƒ½ç›¸äº’ä¾èµ–ï¼Œä¸ºäº†åœ¨GCè¿‡ç¨‹ä¸­ä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œæˆ‘ä»¬åœ¨å¼€å§‹ä¸‰è‰²æ ‡è®°ä¹‹å‰å°±ä¼šåŠ ä¸ŠSTWï¼Œåœ¨æ‰«æç¡®å®šé»‘ç™½å¯¹è±¡ä¹‹åå†æ”¾å¼€STWã€‚ä½†æ˜¯å¾ˆæ˜æ˜¾è¿™æ ·çš„GCæ‰«æçš„æ€§èƒ½å®åœ¨æ˜¯å¤ªä½äº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å››æ²¡æœ‰stwçš„ä¸‰è‰²æ ‡è®°æ³•&#34;&gt;å››ã€æ²¡æœ‰STWçš„ä¸‰è‰²æ ‡è®°æ³• &lt;a href=&#34;#%e5%9b%9b%e6%b2%a1%e6%9c%89stw%e7%9a%84%e4%b8%89%e8%89%b2%e6%a0%87%e8%ae%b0%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å…ˆæŠ›ç –å¼•ç‰ï¼Œæˆ‘ä»¬åŠ å…¥å¦‚æœæ²¡æœ‰STWï¼Œé‚£ä¹ˆä¹Ÿå°±ä¸ä¼šå†å­˜åœ¨æ€§èƒ½ä¸Šçš„é—®é¢˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å‡è®¾å¦‚æœä¸‰è‰²æ ‡è®°æ³•ä¸åŠ å…¥STWä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ
æˆ‘ä»¬è¿˜æ˜¯åŸºäºä¸Šè¿°çš„ä¸‰è‰²å¹¶å‘æ ‡è®°æ³•æ¥è¯´, ä»–æ˜¯ä¸€å®šè¦ä¾èµ–STWçš„. å› ä¸ºå¦‚æœä¸æš‚åœç¨‹åº, ç¨‹åºçš„é€»è¾‘æ”¹å˜å¯¹è±¡å¼•ç”¨å…³ç³», è¿™ç§åŠ¨ä½œå¦‚æœåœ¨æ ‡è®°é˜¶æ®µåšäº†ä¿®æ”¹ï¼Œä¼šå½±å“æ ‡è®°ç»“æœçš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªåœºæ™¯ï¼Œå¦‚æœä¸‰è‰²æ ‡è®°æ³•, æ ‡è®°è¿‡ç¨‹ä¸ä½¿ç”¨STWå°†ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…?&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æŠŠåˆå§‹çŠ¶æ€è®¾ç½®ä¸ºå·²ç»ç»å†äº†ç¬¬ä¸€è½®æ‰«æï¼Œç›®å‰é»‘è‰²çš„æœ‰å¯¹è±¡1å’Œå¯¹è±¡4ï¼Œ ç°è‰²çš„æœ‰å¯¹è±¡2å’Œå¯¹è±¡7ï¼Œå…¶ä»–çš„ä¸ºç™½è‰²å¯¹è±¡ï¼Œä¸”å¯¹è±¡2æ˜¯é€šè¿‡æŒ‡é’ˆpæŒ‡å‘å¯¹è±¡3çš„ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC11.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¦‚æœä¸‰è‰²æ ‡è®°è¿‡ç¨‹ä¸å¯åŠ¨STWï¼Œé‚£ä¹ˆåœ¨GCæ‰«æè¿‡ç¨‹ä¸­ï¼Œä»»æ„çš„å¯¹è±¡å‡å¯èƒ½å‘ç”Ÿè¯»å†™æ“ä½œï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨è¿˜æ²¡æœ‰æ‰«æåˆ°å¯¹è±¡2çš„æ—¶å€™ï¼Œå·²ç»æ ‡è®°ä¸ºé»‘è‰²çš„å¯¹è±¡4ï¼Œæ­¤æ—¶åˆ›å»ºæŒ‡é’ˆqï¼Œå¹¶ä¸”æŒ‡å‘ç™½è‰²çš„å¯¹è±¡3ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC12.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸æ­¤åŒæ—¶ç°è‰²çš„å¯¹è±¡2å°†æŒ‡é’ˆpç§»é™¤ï¼Œé‚£ä¹ˆç™½è‰²çš„å¯¹è±¡3å®åˆ™å°±æ˜¯è¢«æŒ‚åœ¨äº†å·²ç»æ‰«æå®Œæˆçš„é»‘è‰²çš„å¯¹è±¡4ä¸‹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC13.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åæˆ‘ä»¬æ­£å¸¸æŒ‡å‘ä¸‰è‰²æ ‡è®°çš„ç®—æ³•é€»è¾‘ï¼Œå°†æ‰€æœ‰ç°è‰²çš„å¯¹è±¡æ ‡è®°ä¸ºé»‘è‰²ï¼Œé‚£ä¹ˆå¯¹è±¡2å’Œå¯¹è±¡7å°±è¢«æ ‡è®°æˆäº†é»‘è‰²ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC14.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå°±æ‰§è¡Œäº†ä¸‰è‰²æ ‡è®°çš„æœ€åä¸€æ­¥ï¼Œå°†æ‰€æœ‰ç™½è‰²å¯¹è±¡å½“åšåƒåœ¾è¿›è¡Œå›æ”¶ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC15.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æœ€åæˆ‘ä»¬æ‰å‘ç°ï¼Œæœ¬æ¥æ˜¯å¯¹è±¡4åˆæ³•å¼•ç”¨çš„å¯¹è±¡3ï¼Œå´è¢«GCç»™â€œè¯¯æ€â€å›æ”¶æ‰äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼Œåœ¨ä¸‰è‰²æ ‡è®°æ³•ä¸­ï¼Œæ˜¯ä¸å¸Œæœ›è¢«å‘ç”Ÿçš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¡ä»¶1: ä¸€ä¸ªç™½è‰²å¯¹è±¡è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨&lt;code&gt;(ç™½è‰²è¢«æŒ‚åœ¨é»‘è‰²ä¸‹)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ¡ä»¶2: ç°è‰²å¯¹è±¡ä¸å®ƒä¹‹é—´çš„å¯è¾¾å…³ç³»çš„ç™½è‰²å¯¹è±¡é­åˆ°ç ´å&lt;code&gt;(ç°è‰²åŒæ—¶ä¸¢äº†è¯¥ç™½è‰²)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœå½“ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼Œå°±ä¼šå‡ºç°å¯¹è±¡ä¸¢å¤±ç°è±¡!&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”ï¼Œå¦‚å›¾æ‰€ç¤ºçš„åœºæ™¯ä¸­ï¼Œå¦‚æœç¤ºä¾‹ä¸­çš„ç™½è‰²å¯¹è±¡3è¿˜æœ‰å¾ˆå¤šä¸‹æ¸¸å¯¹è±¡çš„è¯, ä¹Ÿä¼šä¸€å¹¶éƒ½æ¸…ç†æ‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢è¿™ç§ç°è±¡çš„å‘ç”Ÿï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯STWï¼Œç›´æ¥ç¦æ­¢æ‰å…¶ä»–ç”¨æˆ·ç¨‹åºå¯¹å¯¹è±¡å¼•ç”¨å…³ç³»çš„å¹²æ‰°ï¼Œä½†æ˜¯STWçš„è¿‡ç¨‹æœ‰æ˜æ˜¾çš„èµ„æºæµªè´¹ï¼Œå¯¹æ‰€æœ‰çš„ç”¨æˆ·ç¨‹åºéƒ½æœ‰å¾ˆå¤§å½±å“ã€‚é‚£ä¹ˆæ˜¯å¦å¯ä»¥åœ¨ä¿è¯å¯¹è±¡ä¸ä¸¢å¤±çš„æƒ…å†µä¸‹åˆç†çš„å°½å¯èƒ½çš„æé«˜GCæ•ˆç‡ï¼Œå‡å°‘STWæ—¶é—´å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬åªè¦ä½¿ç”¨ä¸€ç§æœºåˆ¶ï¼Œå°è¯•å»ç ´åä¸Šé¢çš„ä¸¤ä¸ªå¿…è¦æ¡ä»¶å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;äº”å±éšœæœºåˆ¶&#34;&gt;äº”ã€å±éšœæœºåˆ¶ &lt;a href=&#34;#%e4%ba%94%e5%b1%8f%e9%9a%9c%e6%9c%ba%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å¼º-å¼±-ä¸‰è‰²ä¸å˜å¼&#34;&gt;â€œå¼º-å¼±â€ ä¸‰è‰²ä¸å˜å¼ &lt;a href=&#34;#%e5%bc%ba-%e5%bc%b1-%e4%b8%89%e8%89%b2%e4%b8%8d%e5%8f%98%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;å¼ºä¸‰è‰²ä¸å˜å¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸å­˜åœ¨é»‘è‰²å¯¹è±¡å¼•ç”¨åˆ°ç™½è‰²å¯¹è±¡çš„æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC16.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¼ºä¸‰è‰²ä¸å˜è‰²å®é™…ä¸Šæ˜¯å¼ºåˆ¶æ€§çš„ä¸å…è®¸é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°æœ‰ç™½è‰²å¯¹è±¡è¢«è¯¯åˆ çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¼±ä¸‰è‰²ä¸å˜å¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨çš„ç™½è‰²å¯¹è±¡éƒ½å¤„äºç°è‰²ä¿æŠ¤çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC17.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¼±ä¸‰è‰²ä¸å˜å¼å¼ºè°ƒï¼Œé»‘è‰²å¯¹è±¡å¯ä»¥å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªç™½è‰²å¯¹è±¡å¿…é¡»å­˜åœ¨å…¶ä»–ç°è‰²å¯¹è±¡å¯¹å®ƒçš„å¼•ç”¨ï¼Œæˆ–è€…å¯è¾¾å®ƒçš„é“¾è·¯ä¸Šæ¸¸å­˜åœ¨ç°è‰²å¯¹è±¡ã€‚ è¿™æ ·å®åˆ™æ˜¯é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼Œç™½è‰²å¯¹è±¡å¤„äºä¸€ä¸ªå±é™©è¢«åˆ é™¤çš„çŠ¶æ€ï¼Œä½†æ˜¯ä¸Šæ¸¸ç°è‰²å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥ä¿æŠ¤è¯¥ç™½è‰²å¯¹è±¡ï¼Œä½¿å…¶å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†éµå¾ªä¸Šè¿°çš„ä¸¤ä¸ªæ–¹å¼ï¼ŒGCç®—æ³•æ¼”è¿›åˆ°ä¸¤ç§å±éšœæ–¹å¼ï¼Œä»–ä»¬â€œæ’å…¥å±éšœâ€, â€œåˆ é™¤å±éšœâ€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ’å…¥å±éšœ&#34;&gt;æ’å…¥å±éšœ &lt;a href=&#34;#%e6%8f%92%e5%85%a5%e5%b1%8f%e9%9a%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å…·ä½“æ“ä½œ: åœ¨Aå¯¹è±¡å¼•ç”¨Bå¯¹è±¡çš„æ—¶å€™ï¼ŒBå¯¹è±¡è¢«æ ‡è®°ä¸ºç°è‰²ã€‚(å°†BæŒ‚åœ¨Aä¸‹æ¸¸ï¼ŒBå¿…é¡»è¢«æ ‡è®°ä¸ºç°è‰²)
æ»¡è¶³: &lt;code&gt;å¼ºä¸‰è‰²ä¸å˜å¼&lt;/code&gt;. (ä¸å­˜åœ¨é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡çš„æƒ…å†µäº†ï¼Œ å› ä¸ºç™½è‰²ä¼šå¼ºåˆ¶å˜æˆç°è‰²)
ä¼ªç :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(å½“å‰ä¸‹æ¸¸å¯¹è±¡slot, æ–°ä¸‹æ¸¸å¯¹è±¡ptr) {   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  //1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  æ ‡è®°ç°è‰²(æ–°ä¸‹æ¸¸å¯¹è±¡ptr)   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  //2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  å½“å‰ä¸‹æ¸¸å¯¹è±¡slot = æ–°ä¸‹æ¸¸å¯¹è±¡ptr  				  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœºæ™¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(nil, B)   //A ä¹‹å‰æ²¡æœ‰ä¸‹æ¸¸ï¼Œ æ–°æ·»åŠ ä¸€ä¸ªä¸‹æ¸¸å¯¹è±¡Bï¼Œ Bè¢«æ ‡è®°ä¸ºç°è‰²
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(C, B)     //A å°†ä¸‹æ¸¸å¯¹è±¡C æ›´æ¢ä¸ºBï¼Œ  Bè¢«æ ‡è®°ä¸ºç°è‰²
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ®µä¼ªç é€»è¾‘å°±æ˜¯å†™å±éšœ,. æˆ‘ä»¬çŸ¥é“,é»‘è‰²å¯¹è±¡çš„å†…å­˜æ§½æœ‰ä¸¤ç§ä½ç½®, æ ˆå’Œå †. æ ˆç©ºé—´çš„ç‰¹ç‚¹æ˜¯å®¹é‡å°,ä½†æ˜¯è¦æ±‚ç›¸åº”é€Ÿåº¦å¿«,å› ä¸ºå‡½æ•°è°ƒç”¨å¼¹å‡ºé¢‘ç¹ä½¿ç”¨, æ‰€ä»¥â€œæ’å…¥å±éšœâ€æœºåˆ¶,åœ¨æ ˆç©ºé—´çš„å¯¹è±¡æ“ä½œä¸­ä¸ä½¿ç”¨. è€Œä»…ä»…ä½¿ç”¨åœ¨å †ç©ºé—´å¯¹è±¡çš„æ“ä½œä¸­.&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨å‡ å¼ å›¾ï¼Œæ¥æ¨¡æ‹Ÿæ•´ä¸ªä¸€ä¸ªè¯¦ç»†çš„è¿‡ç¨‹ï¼Œ å¸Œæœ›æ‚¨èƒ½å¤Ÿæ›´å¯è§‚çš„çœ‹æ¸…æ™°æ•´ä½“æµç¨‹ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-2.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-3.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-4.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-5.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-6.jpeg&#34; alt=&#34;gc&#34;&gt;
ä½†æ˜¯å¦‚æœæ ˆä¸æ·»åŠ ,å½“å…¨éƒ¨ä¸‰è‰²æ ‡è®°æ‰«æä¹‹å,æ ˆä¸Šæœ‰å¯èƒ½ä¾ç„¶å­˜åœ¨ç™½è‰²å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µ(å¦‚ä¸Šå›¾çš„å¯¹è±¡9).  æ‰€ä»¥è¦å¯¹æ ˆé‡æ–°è¿›è¡Œä¸‰è‰²æ ‡è®°æ‰«æ, ä½†è¿™æ¬¡ä¸ºäº†å¯¹è±¡ä¸ä¸¢å¤±, è¦å¯¹æœ¬æ¬¡æ ‡è®°æ‰«æå¯åŠ¨STWæš‚åœ. ç›´åˆ°æ ˆç©ºé—´çš„ä¸‰è‰²æ ‡è®°ç»“æŸ.
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-7.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-8.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-9.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;æœ€åå°†æ ˆå’Œå †ç©ºé—´ æ‰«æå‰©ä½™çš„å…¨éƒ¨ ç™½è‰²èŠ‚ç‚¹æ¸…é™¤.  è¿™æ¬¡STWå¤§çº¦çš„æ—¶é—´åœ¨10~100msé—´.
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-10.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;åˆ é™¤å±éšœ&#34;&gt;åˆ é™¤å±éšœ &lt;a href=&#34;#%e5%88%a0%e9%99%a4%e5%b1%8f%e9%9a%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å…·ä½“æ“ä½œ: è¢«åˆ é™¤çš„å¯¹è±¡ï¼Œå¦‚æœè‡ªèº«ä¸ºç°è‰²æˆ–è€…ç™½è‰²ï¼Œé‚£ä¹ˆè¢«æ ‡è®°ä¸ºç°è‰²ã€‚
æ»¡è¶³: &lt;code&gt;å¼±ä¸‰è‰²ä¸å˜å¼&lt;/code&gt;. (ä¿æŠ¤ç°è‰²å¯¹è±¡åˆ°ç™½è‰²å¯¹è±¡çš„è·¯å¾„ä¸ä¼šæ–­)
ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(å½“å‰ä¸‹æ¸¸å¯¹è±¡slotï¼Œ æ–°ä¸‹æ¸¸å¯¹è±¡ptr) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  //1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  if (å½“å‰ä¸‹æ¸¸å¯¹è±¡slotæ˜¯ç°è‰² || å½“å‰ä¸‹æ¸¸å¯¹è±¡slotæ˜¯ç™½è‰²) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  		æ ‡è®°ç°è‰²(å½“å‰ä¸‹æ¸¸å¯¹è±¡slot)     //slotä¸ºè¢«åˆ é™¤å¯¹è±¡ï¼Œ æ ‡è®°ä¸ºç°è‰²
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  //2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  å½“å‰ä¸‹æ¸¸å¯¹è±¡slot = æ–°ä¸‹æ¸¸å¯¹è±¡ptr
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœºæ™¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(B, nil)   //Aå¯¹è±¡ï¼Œåˆ é™¤Bå¯¹è±¡çš„å¼•ç”¨ã€‚  Bè¢«Aåˆ é™¤ï¼Œè¢«æ ‡è®°ä¸ºç°(å¦‚æœBä¹‹å‰ä¸ºç™½)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(B, C)		 //Aå¯¹è±¡ï¼Œæ›´æ¢ä¸‹æ¸¸Bå˜æˆCã€‚   Bè¢«Aåˆ é™¤ï¼Œè¢«æ ‡è®°ä¸ºç°(å¦‚æœBä¹‹å‰ä¸ºç™½)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨å‡ å¼ å›¾ï¼Œæ¥æ¨¡æ‹Ÿæ•´ä¸ªä¸€ä¸ªè¯¦ç»†çš„è¿‡ç¨‹ï¼Œ å¸Œæœ›æ‚¨èƒ½å¤Ÿæ›´å¯è§‚çš„çœ‹æ¸…æ™°æ•´ä½“æµç¨‹ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-2.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-3.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-4.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-5.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-6.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-7.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼çš„å›æ”¶ç²¾åº¦ä½ï¼Œä¸€ä¸ªå¯¹è±¡å³ä½¿è¢«åˆ é™¤äº†æœ€åä¸€ä¸ªæŒ‡å‘å®ƒçš„æŒ‡é’ˆä¹Ÿä¾æ—§å¯ä»¥æ´»è¿‡è¿™ä¸€è½®ï¼Œåœ¨ä¸‹ä¸€è½®GCä¸­è¢«æ¸…ç†æ‰ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…­go-v18çš„æ··åˆå†™å±éšœhybrid-write-barrieræœºåˆ¶&#34;&gt;å…­ã€Go V1.8çš„æ··åˆå†™å±éšœ(hybrid write barrier)æœºåˆ¶ &lt;a href=&#34;#%e5%85%adgo-v18%e7%9a%84%e6%b7%b7%e5%90%88%e5%86%99%e5%b1%8f%e9%9a%9chybrid-write-barrier%e6%9c%ba%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æ’å…¥å†™å±éšœå’Œåˆ é™¤å†™å±éšœçš„çŸ­æ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ’å…¥å†™å±éšœï¼šç»“æŸæ—¶éœ€è¦STWæ¥é‡æ–°æ‰«ææ ˆï¼Œæ ‡è®°æ ˆä¸Šå¼•ç”¨çš„ç™½è‰²å¯¹è±¡çš„å­˜æ´»ï¼›&lt;/li&gt;
&lt;li&gt;åˆ é™¤å†™å±éšœï¼šå›æ”¶ç²¾åº¦ä½ï¼ŒGCå¼€å§‹æ—¶STWæ‰«æå †æ ˆæ¥è®°å½•åˆå§‹å¿«ç…§ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šä¿æŠ¤å¼€å§‹æ—¶åˆ»çš„æ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Go V1.8ç‰ˆæœ¬å¼•å…¥äº†æ··åˆå†™å±éšœæœºåˆ¶ï¼ˆhybrid write barrierï¼‰ï¼Œé¿å…äº†å¯¹æ ˆre-scançš„è¿‡ç¨‹ï¼Œæå¤§çš„å‡å°‘äº†STWçš„æ—¶é—´ã€‚ç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ··åˆå†™å±éšœè§„åˆ™&#34;&gt;æ··åˆå†™å±éšœè§„åˆ™ &lt;a href=&#34;#%e6%b7%b7%e5%90%88%e5%86%99%e5%b1%8f%e9%9a%9c%e8%a7%84%e5%88%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å…·ä½“æ“ä½œ:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;1.  GCå¼€å§‹å°†æ ˆä¸Šçš„å¯¹è±¡å…¨éƒ¨æ‰«æå¹¶æ ‡è®°ä¸ºé»‘è‰²(ä¹‹åä¸å†è¿›è¡Œç¬¬äºŒæ¬¡é‡å¤æ‰«æï¼Œæ— éœ€STW)ï¼Œ
2.  GCæœŸé—´ï¼Œä»»ä½•åœ¨æ ˆä¸Šåˆ›å»ºçš„æ–°å¯¹è±¡ï¼Œå‡ä¸ºé»‘è‰²ã€‚
3.  è¢«åˆ é™¤çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ã€‚
4.  è¢«æ·»åŠ çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ»¡è¶³: å˜å½¢çš„&lt;code&gt;å¼±ä¸‰è‰²ä¸å˜å¼&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(å½“å‰ä¸‹æ¸¸å¯¹è±¡slot, æ–°ä¸‹æ¸¸å¯¹è±¡ptr) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	//1 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		æ ‡è®°ç°è‰²(å½“å‰ä¸‹æ¸¸å¯¹è±¡slot)    //åªè¦å½“å‰ä¸‹æ¸¸å¯¹è±¡è¢«ç§»èµ°ï¼Œå°±æ ‡è®°ç°è‰²
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	//2 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	æ ‡è®°ç°è‰²(æ–°ä¸‹æ¸¸å¯¹è±¡ptr)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  		
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	//3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	å½“å‰ä¸‹æ¸¸å¯¹è±¡slot = æ–°ä¸‹æ¸¸å¯¹è±¡ptr
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬æ³¨æ„ï¼Œ å±éšœæŠ€æœ¯æ˜¯ä¸åœ¨æ ˆä¸Šåº”ç”¨çš„ï¼Œå› ä¸ºè¦ä¿è¯æ ˆçš„è¿è¡Œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;æ··åˆå†™å±éšœçš„å…·ä½“åœºæ™¯åˆ†æ&#34;&gt;æ··åˆå†™å±éšœçš„å…·ä½“åœºæ™¯åˆ†æ &lt;a href=&#34;#%e6%b7%b7%e5%90%88%e5%86%99%e5%b1%8f%e9%9a%9c%e7%9a%84%e5%85%b7%e4%bd%93%e5%9c%ba%e6%99%af%e5%88%86%e6%9e%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨å‡ å¼ å›¾ï¼Œæ¥æ¨¡æ‹Ÿæ•´ä¸ªä¸€ä¸ªè¯¦ç»†çš„è¿‡ç¨‹ï¼Œ å¸Œæœ›æ‚¨èƒ½å¤Ÿæ›´å¯è§‚çš„çœ‹æ¸…æ™°æ•´ä½“æµç¨‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„æ··åˆå†™å±éšœæ˜¯Gcçš„ä¸€ç§å±éšœæœºåˆ¶ï¼Œæ‰€ä»¥åªæ˜¯å½“ç¨‹åºæ‰§è¡ŒGCçš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘è¿™ç§æœºåˆ¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;GCå¼€å§‹ï¼šæ‰«ææ ˆåŒºï¼Œå°†å¯è¾¾å¯¹è±¡å…¨éƒ¨æ ‡è®°ä¸ºé»‘
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC20-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC20-2.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åœºæ™¯ä¸€-å¯¹è±¡è¢«ä¸€ä¸ªå †å¯¹è±¡åˆ é™¤å¼•ç”¨æˆä¸ºæ ˆå¯¹è±¡çš„ä¸‹æ¸¸&#34;&gt;åœºæ™¯ä¸€ï¼š å¯¹è±¡è¢«ä¸€ä¸ªå †å¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæˆä¸ºæ ˆå¯¹è±¡çš„ä¸‹æ¸¸ &lt;a href=&#34;#%e5%9c%ba%e6%99%af%e4%b8%80-%e5%af%b9%e8%b1%a1%e8%a2%ab%e4%b8%80%e4%b8%aa%e5%a0%86%e5%af%b9%e8%b1%a1%e5%88%a0%e9%99%a4%e5%bc%95%e7%94%a8%e6%88%90%e4%b8%ba%e6%a0%88%e5%af%b9%e8%b1%a1%e7%9a%84%e4%b8%8b%e6%b8%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//å‰æï¼šå †å¯¹è±¡4-&amp;gt;å¯¹è±¡7 = å¯¹è±¡7ï¼›  //å¯¹è±¡7 è¢« å¯¹è±¡4å¼•ç”¨
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ ˆå¯¹è±¡1-&amp;gt;å¯¹è±¡7 = å †å¯¹è±¡7ï¼›  //å°†å †å¯¹è±¡7 æŒ‚åœ¨ æ ˆå¯¹è±¡1 ä¸‹æ¸¸
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å †å¯¹è±¡4-&amp;gt;å¯¹è±¡7 = nullï¼›    //å¯¹è±¡4 åˆ é™¤å¼•ç”¨ å¯¹è±¡7
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC21-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC21-2.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åœºæ™¯äºŒ-å¯¹è±¡è¢«ä¸€ä¸ªæ ˆå¯¹è±¡åˆ é™¤å¼•ç”¨æˆä¸ºå¦ä¸€ä¸ªæ ˆå¯¹è±¡çš„ä¸‹æ¸¸&#34;&gt;åœºæ™¯äºŒï¼š å¯¹è±¡è¢«ä¸€ä¸ªæ ˆå¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæˆä¸ºå¦ä¸€ä¸ªæ ˆå¯¹è±¡çš„ä¸‹æ¸¸ &lt;a href=&#34;#%e5%9c%ba%e6%99%af%e4%ba%8c-%e5%af%b9%e8%b1%a1%e8%a2%ab%e4%b8%80%e4%b8%aa%e6%a0%88%e5%af%b9%e8%b1%a1%e5%88%a0%e9%99%a4%e5%bc%95%e7%94%a8%e6%88%90%e4%b8%ba%e5%8f%a6%e4%b8%80%e4%b8%aa%e6%a0%88%e5%af%b9%e8%b1%a1%e7%9a%84%e4%b8%8b%e6%b8%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;new æ ˆå¯¹è±¡9ï¼›
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å¯¹è±¡8-&amp;gt;å¯¹è±¡3 = å¯¹è±¡9ï¼›      //å°†æ ˆå¯¹è±¡3 æŒ‚åœ¨ æ ˆå¯¹è±¡9 ä¸‹æ¸¸
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å¯¹è±¡2-&amp;gt;å¯¹è±¡3 = nullï¼›      //å¯¹è±¡2 åˆ é™¤å¼•ç”¨ å¯¹è±¡3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC22-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC22-2.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC22-3.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åœºæ™¯ä¸‰å¯¹è±¡è¢«ä¸€ä¸ªå †å¯¹è±¡åˆ é™¤å¼•ç”¨æˆä¸ºå¦ä¸€ä¸ªå †å¯¹è±¡çš„ä¸‹æ¸¸&#34;&gt;åœºæ™¯ä¸‰ï¼šå¯¹è±¡è¢«ä¸€ä¸ªå †å¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæˆä¸ºå¦ä¸€ä¸ªå †å¯¹è±¡çš„ä¸‹æ¸¸ &lt;a href=&#34;#%e5%9c%ba%e6%99%af%e4%b8%89%e5%af%b9%e8%b1%a1%e8%a2%ab%e4%b8%80%e4%b8%aa%e5%a0%86%e5%af%b9%e8%b1%a1%e5%88%a0%e9%99%a4%e5%bc%95%e7%94%a8%e6%88%90%e4%b8%ba%e5%8f%a6%e4%b8%80%e4%b8%aa%e5%a0%86%e5%af%b9%e8%b1%a1%e7%9a%84%e4%b8%8b%e6%b8%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å †å¯¹è±¡10-&amp;gt;å¯¹è±¡7 = å †å¯¹è±¡7ï¼›       //å°†å †å¯¹è±¡7 æŒ‚åœ¨ å †å¯¹è±¡10 ä¸‹æ¸¸
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å †å¯¹è±¡4-&amp;gt;å¯¹è±¡7 = nullï¼›         //å¯¹è±¡4 åˆ é™¤å¼•ç”¨ å¯¹è±¡7
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC23-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC23-2.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC23-3.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åœºæ™¯å››å¯¹è±¡ä»ä¸€ä¸ªæ ˆå¯¹è±¡åˆ é™¤å¼•ç”¨æˆä¸ºå¦ä¸€ä¸ªå †å¯¹è±¡çš„ä¸‹æ¸¸&#34;&gt;åœºæ™¯å››ï¼šå¯¹è±¡ä»ä¸€ä¸ªæ ˆå¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæˆä¸ºå¦ä¸€ä¸ªå †å¯¹è±¡çš„ä¸‹æ¸¸ &lt;a href=&#34;#%e5%9c%ba%e6%99%af%e5%9b%9b%e5%af%b9%e8%b1%a1%e4%bb%8e%e4%b8%80%e4%b8%aa%e6%a0%88%e5%af%b9%e8%b1%a1%e5%88%a0%e9%99%a4%e5%bc%95%e7%94%a8%e6%88%90%e4%b8%ba%e5%8f%a6%e4%b8%80%e4%b8%aa%e5%a0%86%e5%af%b9%e8%b1%a1%e7%9a%84%e4%b8%8b%e6%b8%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ ˆå¯¹è±¡1-&amp;gt;å¯¹è±¡2=null //å¯¹è±¡1åˆ é™¤å¼•ç”¨å¯¹è±¡2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å †å¯¹è±¡4-&amp;gt;å¯¹è±¡2=æ ˆå¯¹è±¡2 //å¯¹è±¡4æ·»åŠ ä¸‹æ¸¸æ ˆå¯¹è±¡2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å †å¯¹è±¡4-&amp;gt;å¯¹è±¡7=null //å¯¹è±¡4åˆ é™¤å¼•ç”¨å¯¹è±¡7
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC24-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC24-2.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC24-3.jpeg&#34; alt=&#34;gc&#34;&gt;
Golangä¸­çš„æ··åˆå†™å±éšœæ»¡è¶³å¼±ä¸‰è‰²ä¸å˜å¼ï¼Œç»“åˆäº†åˆ é™¤å†™å±éšœå’Œæ’å…¥å†™å±éšœçš„ä¼˜ç‚¹ï¼Œåªéœ€è¦åœ¨å¼€å§‹æ—¶å¹¶å‘æ‰«æå„ä¸ªgoroutineçš„æ ˆï¼Œä½¿å…¶å˜é»‘å¹¶ä¸€ç›´ä¿æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦STWï¼Œè€Œæ ‡è®°ç»“æŸåï¼Œå› ä¸ºæ ˆåœ¨æ‰«æåå§‹ç»ˆæ˜¯é»‘è‰²çš„ï¼Œä¹Ÿæ— éœ€å†è¿›è¡Œre-scanæ“ä½œäº†ï¼Œå‡å°‘äº†STWçš„æ—¶é—´ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“ &lt;a href=&#34;#%e6%80%bb%e7%bb%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;GoV1.3- æ™®é€šæ ‡è®°æ¸…é™¤æ³•ï¼Œæ•´ä½“è¿‡ç¨‹éœ€è¦å¯åŠ¨STWï¼Œæ•ˆç‡æä½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GoV1.5- ä¸‰è‰²æ ‡è®°æ³•ï¼Œ å †ç©ºé—´å¯åŠ¨å†™å±éšœï¼Œæ ˆç©ºé—´ä¸å¯åŠ¨ï¼Œå…¨éƒ¨æ‰«æä¹‹åï¼Œéœ€è¦é‡æ–°æ‰«æä¸€æ¬¡æ ˆ(éœ€è¦STW)ï¼Œæ•ˆç‡æ™®é€š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GoV1.8-ä¸‰è‰²æ ‡è®°æ³•ï¼Œæ··åˆå†™å±éšœæœºåˆ¶ï¼Œ æ ˆç©ºé—´ä¸å¯åŠ¨ï¼Œå †ç©ºé—´å¯åŠ¨ã€‚æ•´ä¸ªè¿‡ç¨‹å‡ ä¹ä¸éœ€è¦STWï¼Œæ•ˆç‡è¾ƒé«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Goä¸­makeä¸newåŒºåˆ«</title>
      <link>https://abnerxc.github.io/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/</link>
      <pubDate>Fri, 20 Sep 2024 10:46:12 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/</guid>
      <description>&lt;h1 id=&#34;å˜é‡çš„å£°æ˜&#34;&gt;å˜é‡çš„å£°æ˜ &lt;a href=&#34;#%e5%8f%98%e9%87%8f%e7%9a%84%e5%a3%b0%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡çš„å£°æ˜æˆ‘ä»¬å¯ä»¥é€šè¿‡varå…³é”®å­—ï¼Œç„¶åå°±å¯ä»¥åœ¨ç¨‹åºä¸­ä½¿ç”¨ã€‚å½“æˆ‘ä»¬ä¸æŒ‡å®šå˜é‡çš„é»˜è®¤å€¼æ—¶ï¼Œè¿™äº›å˜é‡çš„é»˜è®¤å€¼æ˜¯ä»–ä»¬çš„é›¶å€¼ï¼Œæ¯”å¦‚intç±»å‹çš„é›¶å€¼æ˜¯&lt;code&gt;0&lt;/code&gt;,stringç±»å‹çš„é›¶å€¼æ˜¯&lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt;ï¼Œå¼•ç”¨ç±»å‹çš„é›¶å€¼æ˜¯&lt;code&gt;nil&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä¾‹å­ä¸­çš„ä¸¤ç§ç±»å‹çš„å£°æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¯¹å…¶è¿›è¡Œèµ‹å€¼è¾“å‡ºã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ¢æˆæŒ‡é’ˆç±»å‹å‘¢ï¼Ÿ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;=&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ go run test1.go 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;panic: runtime error: invalid memory address or nil pointer dereference
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;signal SIGSEGV: segmentation violation code&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;0x1 addr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;0x0 pc&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;0x4849df&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;goroutine &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;running&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;main.main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	/home/itheima/go/src/golang_deeper/make_new/t
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¿™ä¸ªæç¤ºä¸­å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬ä¸å…‰è¦å£°æ˜å®ƒï¼Œè¿˜è¦ä¸ºå®ƒåˆ†é…å†…å®¹ç©ºé—´ï¼Œå¦åˆ™æˆ‘ä»¬çš„å€¼æ”¾åœ¨å“ªé‡Œå»å‘¢ï¼Ÿè¿™å°±æ˜¯ä¸Šé¢é”™è¯¯æç¤ºçš„åŸå› ã€‚&lt;/p&gt;
&lt;h1 id=&#34;new&#34;&gt;new &lt;a href=&#34;#new&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¯¹äºä¸Šé¢çš„é—®é¢˜æˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿæ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†æ²¡æœ‰ä¸ºå…¶åˆ†é…å†…å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨newåˆ†é…ä¸€ä¸ªå§ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;=new(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;=&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨newå…³é”®å­—ï¼Œä¸ºå¼•ç”¨ç±»å‹å˜é‡åˆ†é…å†…å­˜ï¼Œç„¶åå°±å¯ä»¥è¿›è¡Œèµ‹å€¼äº†ã€‚ç°åœ¨å†è¿è¡Œç¨‹åºï¼ŒPASSï¼Œæ‰“å°10ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;sync&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;user&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;lock&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Mutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;age&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;u&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; new(&lt;span style=&#34;color:#a6e22e&#34;&gt;user&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;//é»˜è®¤ç»™uåˆ†é…åˆ°å†…å­˜å…¨éƒ¨ä¸º0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;u&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lock&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()  &lt;span style=&#34;color:#75715e&#34;&gt;//å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå› ä¸ºlockä¸º0,æ˜¯å¼€é”çŠ¶æ€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;u&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å¼ ä¸‰&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;u&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lock&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;u&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ go run test2.go 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;amp;&lt;span style=&#34;color:#f92672&#34;&gt;{{&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; 0&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; å¼ ä¸‰ 0&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°±æ˜¯newï¼Œå®ƒè¿”å›çš„æ°¸è¿œæ˜¯ç±»å‹çš„æŒ‡é’ˆï¼ŒæŒ‡å‘åˆ†é…ç±»å‹çš„å†…å­˜åœ°å€ã€‚&lt;/p&gt;
&lt;h1 id=&#34;make&#34;&gt;make &lt;a href=&#34;#make&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;makeä¹Ÿæ˜¯ç”¨äºå†…å­˜åˆ†é…çš„ï¼Œä½†æ˜¯å’Œnewä¸åŒã€‚å®ƒåªç”¨äº&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;map&lt;/li&gt;
&lt;li&gt;chan&lt;/li&gt;
&lt;li&gt;slice
çš„å†…å­˜åˆ›å»ºï¼Œè€Œä¸”å®ƒè¿”å›çš„ç±»å‹å°±æ˜¯è¿™ä¸‰ä¸ªç±»å‹æœ¬èº«ï¼Œè€Œä¸æ˜¯ä»–ä»¬çš„æŒ‡é’ˆç±»å‹ï¼Œå› ä¸ºè¿™ä¸‰ç§ç±»å‹å°±æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¿…è¦è¿”å›ä»–ä»¬çš„æŒ‡é’ˆäº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;makeä¸newçš„å¼‚åŒ&#34;&gt;makeä¸newçš„å¼‚åŒ &lt;a href=&#34;#make%e4%b8%8enew%e7%9a%84%e5%bc%82%e5%90%8c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åŒï¼šå †ç©ºé—´åˆ†é…
ä¸åŒï¼šmake: åªç”¨äºsliceã€mapä»¥åŠchannelçš„åˆå§‹åŒ–ï¼Œ æ— å¯æ›¿ä»£ï¼›new: ç”¨äºç±»å‹å†…å­˜åˆ†é…(åˆå§‹åŒ–å€¼ä¸º0)ï¼Œ ä¸å¸¸ç”¨&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</title>
      <link>https://abnerxc.github.io/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/</link>
      <pubDate>Thu, 19 Sep 2024 17:50:03 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;åŸæ–‡åœ°å€ï¼šhttps://www.yuque.com/aceld/golang/ga6pb1&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;ä¸€åˆ†æç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸cpuåˆ©ç”¨ç‡æƒ…å†µ&#34;&gt;ä¸€ã€åˆ†æç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸CPUåˆ©ç”¨ç‡æƒ…å†µ &lt;a href=&#34;#%e4%b8%80%e5%88%86%e6%9e%90%e7%a8%8b%e5%ba%8f%e7%9a%84%e8%bf%90%e8%a1%8c%e6%97%b6%e9%97%b4%e4%b8%8ecpu%e5%88%a9%e7%94%a8%e7%8e%87%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;shellå†…ç½®timeæŒ‡ä»¤&#34;&gt;shellå†…ç½®timeæŒ‡ä»¤ &lt;a href=&#34;#shell%e5%86%85%e7%bd%aetime%e6%8c%87%e4%bb%a4&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªæ–¹æ³•ä¸ç®—æ–°é¢–ï¼Œä½†æ˜¯ç¡®å¾ˆå®ç”¨ã€‚ &lt;code&gt;time&lt;/code&gt;æ˜¯Unix/Linuxå†…ç½®å¤šå‘½ä»¤ï¼Œä½¿ç”¨æ—¶ä¸€èˆ¬ä¸ç”¨ä¼ è¿‡å¤šå‚æ•°ï¼Œç›´æ¥è·Ÿä¸Šéœ€è¦è°ƒè¯•å¤šç¨‹åºå³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;time go run main.go 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ–æ³¢é‚£å¥‘æ•°åˆ—ç¬¬30é¡¹çš„å€¼ä¸ºï¼š &lt;span style=&#34;color:#ae81ff&#34;&gt;55&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;real	0m0.843s
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;user	0m0.216s
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sys	0m0.389s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢æ˜¯ä½¿ç”¨timeå¯¹ go run main.goå¯¹æ‰§è¡Œç¨‹åºåšäº†æ€§èƒ½åˆ†æï¼Œå¾—åˆ°3ä¸ªæŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;real:ä»ç¨‹åºå¼€å§‹åˆ°ç»“æŸï¼Œå®é™…åº¦è¿‡çš„æ—¶é—´ï¼›&lt;/li&gt;
&lt;li&gt;user:ç¨‹åºåœ¨ç”¨æˆ·æ€åº¦è¿‡çš„æ—¶é—´ï¼›&lt;/li&gt;
&lt;li&gt;sys:ç¨‹åºåœ¨ç³»ç»Ÿæ€åº¦è¿‡æ—¶é—´ã€‚
ä¸€èˆ¬æƒ…å†µä¸‹ real &amp;gt;= user + sysï¼Œå› ä¸ºç³»ç»Ÿè¿˜æœ‰å…¶å®ƒè¿›ç¨‹(åˆ‡æ¢å…¶ä»–è¿›ç¨‹ä¸­é—´å¯¹äºæœ¬è¿›ç¨‹ä¼šæœ‰ç©ºç™½æœŸ)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;usrbintimeæŒ‡ä»¤&#34;&gt;/usr/bin/timeæŒ‡ä»¤ &lt;a href=&#34;#usrbintime%e6%8c%87%e4%bb%a4&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªæŒ‡ä»¤æ¯”å†…ç½®çš„timeæ›´åŠ è¯¦ç»†ä¸€äº›ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦ç”¨ç»å¯¹è·¯å¾„ï¼Œè€Œä¸”è¦åŠ ä¸Šå‚æ•°&lt;code&gt;-v&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ /usr/bin/time -v go run main.go  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Command being timed: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;go run main.go&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	User time &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;seconds&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: 0.12
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	System time &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;seconds&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: 0.06
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Percent of CPU this job got: 115%
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Elapsed &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;wall clock&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; time &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;h:mm:ss or m:ss&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: 0:00.16
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Average shared text size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Average unshared data size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Average stack size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Average total size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Maximum resident set size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;41172&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Average resident set size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Major &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;requiring I/O&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; page faults: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Minor &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;reclaiming a frame&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; page faults: &lt;span style=&#34;color:#ae81ff&#34;&gt;15880&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Voluntary context switches: &lt;span style=&#34;color:#ae81ff&#34;&gt;897&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Involuntary context switches: &lt;span style=&#34;color:#ae81ff&#34;&gt;183&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Swaps: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	File system inputs: &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	File system outputs: &lt;span style=&#34;color:#ae81ff&#34;&gt;2664&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Socket messages sent: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Socket messages received: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Signals delivered: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Page size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;bytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Exit status: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;äºŒåˆ†ægolangç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ&#34;&gt;äºŒã€åˆ†ægolangç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ &lt;a href=&#34;#%e4%ba%8c%e5%88%86%e6%9e%90golang%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%86%85%e5%ad%98%e4%bd%bf%e7%94%a8%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å†…å­˜å ç”¨æƒ…å†µæŸ¥çœ‹&#34;&gt;å†…å­˜å ç”¨æƒ…å†µæŸ¥çœ‹ &lt;a href=&#34;#%e5%86%85%e5%ad%98%e5%8d%a0%e7%94%a8%e6%83%85%e5%86%b5%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬å…ˆå†™ä¸€æ®µdemoä¾‹å­ä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop begin.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop end.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Start.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;force gc.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GC&lt;/span&gt;() &lt;span style=&#34;color:#75715e&#34;&gt;//å¼ºåˆ¶è°ƒç”¨gcå›æ”¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Done.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3600&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;//ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¼–è¯‘&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go build -o snippet_mem &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ./snippet_mem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨./snippet_memè¿›ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå†å¼€ä¸€ä¸ªçª—å£ï¼Œé€šè¿‡&lt;code&gt;top&lt;/code&gt;å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜å ç”¨æƒ…å†µ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;top -p &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;pidof snippet_mem&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¾—åˆ°ç»“æœå¦‚ä¸‹
&lt;img src=&#34;https://abnerxc.github.io/img/godebug1.png&#34; alt=&#34;godebug1&#34;&gt;
æˆ‘ä»¬çœ‹å‡ºæ¥ï¼Œæ²¡æœ‰é€€å‡ºçš„snippet_memè¿›ç¨‹æœ‰çº¦830mçš„å†…å­˜è¢«å ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ç›´è§‚ä¸Šæ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºåœ¨test()å‡½æ•°æ‰§è¡Œå®Œåï¼Œåˆ‡ç‰‡contanerçš„å†…å­˜åº”è¯¥è¢«é‡Šæ”¾ï¼Œä¸åº”è¯¥å ç”¨830Mé‚£ä¹ˆå¤§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨godebugä¸gctraceæ¥åˆ†æç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ&#34;&gt;ä½¿ç”¨GODEBUGä¸gctraceæ¥åˆ†æç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8godebug%e4%b8%8egctrace%e6%9d%a5%e5%88%86%e6%9e%90%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%86%85%e5%ad%98%e4%bd%bf%e7%94%a8%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æ‰§è¡Œsnippet_memç¨‹åºä¹‹å‰æ·»åŠ ç¯å¢ƒå˜é‡GODEBUG=&amp;lsquo;gctrace=1&amp;rsquo;æ¥è·Ÿè¸ªæ‰“å°åƒåœ¾å›æ”¶å™¨ä¿¡æ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;GODEBUG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;gctrace=1&amp;#39;&lt;/span&gt; ./snippet_mem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¾ç½®gctrace=1ä¼šä½¿å¾—åƒåœ¾å›æ”¶å™¨åœ¨æ¯æ¬¡å›æ”¶æ—¶æ±‡æ€»æ‰€å›æ”¶å†…å­˜çš„å¤§å°ä»¥åŠè€—æ—¶ï¼Œ
å¹¶å°†è¿™äº›å†…å®¹æ±‡æ€»æˆå•è¡Œå†…å®¹æ‰“å°åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºä¸­ã€‚
æ ¼å¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc # @#s #%: #+#+# ms clock, #+#/#/#+# ms cpu, #-&amp;gt;#-&amp;gt;# MB, # MB goal, # P
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å«ä¹‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc #        GCæ¬¡æ•°çš„ç¼–å·ï¼Œæ¯æ¬¡GCæ—¶é€’å¢
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;@#s         è·ç¦»ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶çš„æ—¶é—´
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;#%          GCå ç”¨çš„æ‰§è¡Œæ—¶é—´ç™¾åˆ†æ¯”
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;#+...+#     GCä½¿ç”¨çš„æ—¶é—´
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;#-&amp;gt;#-&amp;gt;# MB  GCå¼€å§‹ï¼Œç»“æŸï¼Œä»¥åŠå½“å‰æ´»è·ƒå †å†…å­˜çš„å¤§å°ï¼Œå•ä½M
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# MB goal   å…¨å±€å †å†…å­˜å¤§å°
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# P         ä½¿ç”¨processorçš„æ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 15 @0.123s 4%: 0.051+43+0.003 ms clock, 0.83+0/44/0+0.057 ms cpu, 277-&amp;gt;277-&amp;gt;94 MB, 277 MB goal, 0 MB stacks, 0 MB globals, 16 P
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥æ¡ä¿¡æ¯å«ä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;gc 15&lt;/code&gt;:Gc è°ƒè¯•ç¼–å·ä¸º15&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@0.123s&lt;/code&gt;:æ­¤æ—¶ç¨‹åºå·²ç»æ‰§è¡Œäº†0.123s&lt;/li&gt;
&lt;li&gt;&lt;code&gt;4%:&lt;/code&gt;:0.123sä¸­å…¶ä¸­gcæ¨¡å—å ç”¨äº†4%çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0.051+43+0.003 ms clock&lt;/code&gt;:åƒåœ¾å›æ”¶çš„æ—¶é—´ï¼Œåˆ†åˆ«ä¸ºSTWï¼ˆstop-the-worldï¼‰æ¸…æ‰«çš„æ—¶é—´+å¹¶å‘æ ‡è®°å’Œæ‰«æçš„æ—¶é—´+STWæ ‡è®°çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0.83+0/44/0+0.057 ms cpu&lt;/code&gt;: åƒåœ¾å›æ”¶å ç”¨cpuæ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;277-&amp;gt;277-&amp;gt;94 MB&lt;/code&gt;: GCå¼€å§‹å‰å †å†…å­˜277Mï¼Œ GCç»“æŸåå †å†…å­˜277Mï¼Œå½“å‰æ´»è·ƒçš„å †å†…å­˜94M&lt;/li&gt;
&lt;li&gt;&lt;code&gt;277 MB goal&lt;/code&gt;: å…¨å±€å †å†…å­˜å¤§å°277M&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 MB stacks&lt;/code&gt;: æ ˆå†…å­˜å¤§å°0M&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 MB globals&lt;/code&gt;: å…¨å±€å˜é‡å†…å­˜å¤§å°0M&lt;/li&gt;
&lt;li&gt;&lt;code&gt;16 P&lt;/code&gt;: ä½¿ç”¨processorçš„æ•°é‡16&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äº†è§£äº†GCçš„è°ƒè¯•ä¿¡æ¯è¯»æ³•åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æœ¬æ¬¡GCçš„ç»“æœã€‚
æ‰§è¡ŒGODEBUGè°ƒè¯•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;GODEBUG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;gctrace=1&amp;#39;&lt;/span&gt; ./snippet_mem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2024/09/19 21:04:09  ===&amp;gt; loop begin.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 1 @0.003s 2%: 0.040+2.0+0.012 ms clock, 0.81+0/2.1/0+0.24 ms cpu, 4-&amp;gt;4-&amp;gt;1 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 2 @0.006s 4%: 0.027+8.1+0.14 ms clock, 0.55+0/6.6/0+2.9 ms cpu, 4-&amp;gt;5-&amp;gt;3 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 3 @0.015s 4%: 0.026+2.9+0.010 ms clock, 0.52+0/2.9/0+0.21 ms cpu, 7-&amp;gt;7-&amp;gt;2 MB, 8 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 4 @0.019s 22%: 0.050+1.1+5.2 ms clock, 1.0+0/1.1/0+105 ms cpu, 6-&amp;gt;10-&amp;gt;7 MB, 6 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 5 @0.026s 17%: 0.028+10+0.014 ms clock, 0.56+0/10/0+0.29 ms cpu, 19-&amp;gt;19-&amp;gt;6 MB, 19 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 6 @0.037s 12%: 0.031+14+0.067 ms clock, 0.63+0/4.5/0.001+1.3 ms cpu, 14-&amp;gt;24-&amp;gt;18 MB, 14 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 7 @0.067s 8%: 0.037+44+0.21 ms clock, 0.75+0/44/0+4.2 ms cpu, 46-&amp;gt;46-&amp;gt;28 MB, 46 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 8 @0.116s 7%: 0.035+25+0.028 ms clock, 0.71+0/24/0+0.57 ms cpu, 72-&amp;gt;72-&amp;gt;44 MB, 72 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 9 @0.150s 6%: 0.036+53+0.059 ms clock, 0.72+0/53/0+1.1 ms cpu, 113-&amp;gt;113-&amp;gt;38 MB, 113 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 10 @0.204s 6%: 0.079+9.0+0.011 ms clock, 1.5+0/8.9/0+0.23 ms cpu, 86-&amp;gt;86-&amp;gt;48 MB, 86 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 11 @0.213s 6%: 0.10+19+0.23 ms clock, 2.1+0/19/0+4.6 ms cpu, 108-&amp;gt;108-&amp;gt;108 MB, 108 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 12 @0.283s 5%: 0.025+40+0.024 ms clock, 0.50+0/40/0+0.48 ms cpu, 277-&amp;gt;277-&amp;gt;169 MB, 277 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 13 @0.408s 4%: 0.035+101+0.006 ms clock, 0.70+0/101/0+0.12 ms cpu, 433-&amp;gt;433-&amp;gt;147 MB, 433 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 14 @0.510s 4%: 0.011+18+0.005 ms clock, 0.22+0/18/0+0.10 ms cpu, 330-&amp;gt;330-&amp;gt;183 MB, 330 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 15 @0.529s 4%: 0.010+36+0.011 ms clock, 0.20+0/36/0+0.22 ms cpu, 413-&amp;gt;413-&amp;gt;229 MB, 413 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2024/09/19 21:04:10  ===&amp;gt; loop end.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2024/09/19 21:04:10 force gc.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 16 @0.566s 4%: 0.022+116+0.004 ms clock, 0.45+0/116/0+0.094 ms cpu, 516-&amp;gt;516-&amp;gt;0 MB, 516 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 17 @0.682s 4%: 0.080+0.17+0.073 ms clock, 1.6+0/0.15/0+1.4 ms cpu, 0-&amp;gt;0-&amp;gt;0 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P (forced)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2024/09/19 21:04:10 Done.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;GC forced
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 18 @121.392s 0%: 0.029+0.29+0.004 ms clock, 0.59+0/0.31/0+0.093 ms cpu, 0-&amp;gt;0-&amp;gt;0 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ†æ&lt;/p&gt;
&lt;p&gt;å…ˆçœ‹åœ¨test()å‡½æ•°æ‰§è¡Œå®Œåç«‹å³æ‰“å°çš„gc 16é‚£è¡Œçš„ä¿¡æ¯ã€‚516-&amp;gt;516-&amp;gt;0 MB, 516 MB goalè¡¨ç¤ºåƒåœ¾å›æ”¶å™¨å·²ç»æŠŠ516Mçš„å†…å­˜æ ‡è®°ä¸ºéæ´»è·ƒçš„å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;å†çœ‹ä¸‹ä¸€ä¸ªè®°å½•gc 17è¡Œ0-&amp;gt;0-&amp;gt;0 MB, 4 MB goalè¡¨ç¤ºåƒåœ¾å›æ”¶å™¨ä¸­çš„å…¨å±€å †å†…å­˜å¤§å°ç”±888Mä¸‹é™ä¸º4Mã€‚&lt;/p&gt;
&lt;p&gt;ç»“è®º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨test()å‡½æ•°æ‰§è¡Œå®Œåï¼Œdemoç¨‹åºä¸­çš„åˆ‡ç‰‡å®¹å™¨æ‰€ç”³è¯·çš„å †ç©ºé—´éƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶äº†ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ­¤æ—¶åœ¨topæŒ‡ä»¤æŸ¥è¯¢å†…å­˜çš„æ—¶å€™ï¼Œå¦‚æœä¾ç„¶æ˜¯800+MBï¼Œè¯´æ˜åƒåœ¾å›æ”¶å™¨å›æ”¶äº†åº”ç”¨å±‚çš„å†…å­˜åï¼Œ&lt;code&gt;ï¼ˆå¯èƒ½ï¼‰å¹¶ä¸ä¼šç«‹å³å°†å†…å­˜å½’è¿˜ç»™ç³»ç»Ÿ&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;runtimereadmemstats&#34;&gt;runtime.ReadMemStats &lt;a href=&#34;#runtimereadmemstats&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æ¥ä¸‹æ¥æ¢å¦ä¸€ç§æ–¹å¼æŸ¥çœ‹å†…å­˜çš„æ–¹å¼ åˆ©ç”¨ &lt;code&gt;runtime&lt;/code&gt;åº“é‡Œçš„&lt;code&gt;ReadMemStats()&lt;/code&gt;æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MemStats&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadMemStats&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop begin.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ( &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop end.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [Start].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [force gc].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GC&lt;/span&gt;() &lt;span style=&#34;color:#75715e&#34;&gt;//å¼ºåˆ¶è°ƒç”¨gcå›æ”¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [Done].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3600&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;//ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ï¼Œ å°è£…äº†ä¸€ä¸ªå‡½æ•°&lt;code&gt;readMemStats()&lt;/code&gt;ï¼Œè¿™é‡Œé¢ä¸»è¦æ˜¯è°ƒç”¨runtimeä¸­çš„&lt;code&gt;ReadMemStats()&lt;/code&gt;æ–¹æ³•è·å¾—å†…å­˜ä¿¡æ¯ï¼Œç„¶åé€šè¿‡&lt;code&gt;log&lt;/code&gt;æ‰“å°å‡ºæ¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;.&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; [&lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt;].
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;71280&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;66633728&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;66600960&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;loop&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;begin&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;132535744&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;336756736&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;155721728&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;loop&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;end&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;598300600&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;609181696&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;434323456&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; [&lt;span style=&#34;color:#a6e22e&#34;&gt;force&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gc&lt;/span&gt;].
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; [&lt;span style=&#34;color:#a6e22e&#34;&gt;Done&lt;/span&gt;].
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;55840&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207427072&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;434266112&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;56656&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207394304&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;434266112&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;56912&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207394304&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1206493184&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;58&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;57488&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207394304&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1206493184&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;08&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;57616&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207394304&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1206493184&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;c2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;57744&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207394304&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1206493184&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;by&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Allocï¼šå·²åˆ†é…ä½†å°šæœªé‡Šæ”¾çš„å†…å­˜å­—èŠ‚æ•°ï¼ŒåŒ…æ‹¬å †å†…å­˜å’Œæ ˆå†…å­˜ç­‰&lt;/li&gt;
&lt;li&gt;HeapIdleï¼šå½“å‰æœªä½¿ç”¨ä½†ä»ç„¶ä¿ç•™ç»™å †çš„å†…å­˜å­—èŠ‚æ•°ï¼ˆå³å¯ä»¥å¿«é€Ÿé‡æ–°ä½¿ç”¨çš„å†…å­˜ï¼‰&lt;/li&gt;
&lt;li&gt;HeapReleasedï¼šå·²å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼ˆä½†æœªæ¥å¯èƒ½å†æ¬¡ç”³è¯·ï¼‰çš„å †å†…å­˜å­—èŠ‚æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œæ‰“å°&lt;code&gt;[Done]&lt;/code&gt;.ä¹‹åé‚£æ¡traceä¿¡æ¯ï¼ŒAllocå·²ç»ä¸‹é™ï¼Œå³å†…å­˜å·²è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚åœ¨2025/09/19 21:17:31å’Œ2020/03/02 18:21:48çš„ä¸¤æ¡traceä¿¡æ¯ä¸­ï¼ŒHeapReleasedå¼€å§‹ä¸Šå‡ï¼Œå³åƒåœ¾å›æ”¶å™¨æŠŠå†…å­˜å½’è¿˜ç»™ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ›´å¤šMemStatsè¯´æ˜ï¼š&lt;a href=&#34;https://pkg.go.dev/runtime#MemStats&#34;&gt;https://pkg.go.dev/runtime#MemStats&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;pprofå·¥å…·&#34;&gt;pprofå·¥å…· &lt;a href=&#34;#pprof%e5%b7%a5%e5%85%b7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;pprofå·¥å…·æ”¯æŒç½‘é¡µä¸ŠæŸ¥çœ‹å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œéœ€è¦åœ¨ä»£ç ä¸­æ·»åŠ ä¸€ä¸ªåç¨‹å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å®Œæ•´ç¤ºä¾‹ä»£ç :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http/pprof&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MemStats&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadMemStats&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop begin.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ( &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop end.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//å¯åŠ¨pprof&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.0.0.0:10000&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [Start].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [force gc].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GC&lt;/span&gt;() &lt;span style=&#34;color:#75715e&#34;&gt;//å¼ºåˆ¶è°ƒç”¨gcå›æ”¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [Done].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3600&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;//ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—®ï¼šhttp://127.0.0.1:10000/debug/pprof/heap?debug=1 æŸ¥çœ‹&lt;/p&gt;
&lt;p&gt;æµè§ˆå™¨çš„å†…å®¹å…¶ä¸­æœ‰ä¸€éƒ¨åˆ†å¦‚ä¸‹ï¼Œè®°å½•äº†ç›®å‰çš„å†…å­˜æƒ…å†µ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# runtime.MemStats
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Alloc = 393328
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# TotalAlloc = 1503610448
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Sys = 991758840
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Lookups = 0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Mallocs = 1023
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Frees = 233
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapAlloc = 393328
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapSys = 985137152
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapIdle = 984096768
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapInuse = 1040384
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapReleased = 984006656
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapObjects = 790
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Stack = 524288 / 524288
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# MSpan = 75680 / 81600
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# MCache = 24000 / 31200
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# BuckHashSys = 1450271
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# GCSys = 3206184
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# OtherSys = 1328145
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# NextGC = 4194304
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# LastGC = 1758288816398705240
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;ä¸‰åˆ†ægolangç¨‹åºçš„cpuæ€§èƒ½æƒ…å†µ&#34;&gt;ä¸‰ã€åˆ†æGolangç¨‹åºçš„CPUæ€§èƒ½æƒ…å†µ &lt;a href=&#34;#%e4%b8%89%e5%88%86%e6%9e%90golang%e7%a8%8b%e5%ba%8f%e7%9a%84cpu%e6%80%a7%e8%83%bd%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;cpuæ€§èƒ½æµ‹è¯•ä»£ç &#34;&gt;CPUæ€§èƒ½æµ‹è¯•ä»£ç  &lt;a href=&#34;#cpu%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e4%bb%a3%e7%a0%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bytes&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;math/rand&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http/pprof&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop begin.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;genSomeBytes&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop end.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;genSomeBytes&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Buffer&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;buff&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Buffer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20000&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;buff&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Write&lt;/span&gt;([]&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;{&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; byte(&lt;span style=&#34;color:#a6e22e&#34;&gt;rand&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Intn&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;))})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;buff&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//å¯åŠ¨pprof&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.0.0.0:10000&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ä½¿ç”¨pprof-webç•Œé¢æŸ¥çœ‹&#34;&gt;ä½¿ç”¨pprof-Webç•Œé¢æŸ¥çœ‹ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8pprof-web%e7%95%8c%e9%9d%a2%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æµè§ˆå™¨è®¿é—®: http://127.0.0.1:10000/debug/pprof/
&lt;img src=&#34;https://abnerxc.github.io/img/godebug2.png&#34; alt=&#34;godebug2&#34;&gt;
æˆ‘ä»¬å¯ä»¥ç›´æ¥ç‚¹å‡»ç½‘é¡µçš„profile,æµè§ˆå™¨ä¼šç»™æˆ‘ä»¬ä¸‹è½½ä¸€ä¸ªprofileæ–‡ä»¶.&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨pprofå·¥å…·æŸ¥çœ‹&#34;&gt;ä½¿ç”¨pprofå·¥å…·æŸ¥çœ‹ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8pprof%e5%b7%a5%e5%85%b7%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å°†ä¸‹è½½çš„profileæ–‡ä»¶å’Œgoçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸€èµ·æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go tool pprof &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;binary&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;profile&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;binary:goå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;profile:webç•Œé¢ä¸‹è½½çš„profileæ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go tool pprof ./democpu profile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;File: democpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Type: cpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Time: Mar 3, 2020 at 11:18pm (CST)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Duration: 30.13s, Total samples = 6.27s (20.81%)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Entering interactive mode (type &amp;#34;help&amp;#34; for commands, &amp;#34;o&amp;#34; for options)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;helpå¯ä»¥æŸ¥çœ‹ä¸€äº›æŒ‡ä»¤,æˆ‘ä¹ˆå¯ä»¥é€šè¿‡topæ¥æŸ¥çœ‹cpuçš„æ€§èƒ½æƒ…å†µ.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof) top
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Showing nodes accounting for 5090ms, 81.18% of 6270ms total
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Dropped 80 nodes (cum &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;&lt;/span&gt;= 31.35ms)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Showing top 10 nodes out of 60
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      flat  flat%   sum%        cum   cum%
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    1060ms 16.91% 16.91%     2170ms 34.61%  math/rand.(*lockedSource).Int63
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     850ms 13.56% 30.46%      850ms 13.56%  sync.(*Mutex).Unlock (inline)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     710ms 11.32% 41.79%     2950ms 47.05%  math/rand.(*Rand).Int31n
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     570ms  9.09% 50.88%      990ms 15.79%  bytes.(*Buffer).Write
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     530ms  8.45% 59.33%      540ms  8.61%  syscall.Syscall
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     370ms  5.90% 65.23%      370ms  5.90%  runtime.procyield
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     270ms  4.31% 69.54%     4490ms 71.61%  main.genSomeBytes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     250ms  3.99% 73.52%     3200ms 51.04%  math/rand.(*Rand).Intn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     250ms  3.99% 77.51%      250ms  3.99%  runtime.memmove
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     230ms  3.67% 81.18%      690ms 11.00%  runtime.suspendG
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œé¢æœ‰å‡ åˆ—æ•°æ®,éœ€è¦è¯´æ˜ä¸€ä¸‹.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;flatï¼šå½“å‰å‡½æ•°å ç”¨CPUçš„è€—æ—¶&lt;/li&gt;
&lt;li&gt;flat%ï¼š:å½“å‰å‡½æ•°å ç”¨CPUçš„è€—æ—¶ç™¾åˆ†æ¯”&lt;/li&gt;
&lt;li&gt;sum%ï¼šå‡½æ•°å ç”¨CPUçš„è€—æ—¶ç´¯è®¡ç™¾åˆ†æ¯”&lt;/li&gt;
&lt;li&gt;cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨CPUçš„æ€»è€—æ—¶&lt;/li&gt;
&lt;li&gt;cum%ï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨CPUçš„æ€»è€—æ—¶ç™¾åˆ†æ¯”&lt;/li&gt;
&lt;li&gt;æœ€åä¸€åˆ—ï¼šå‡½æ•°åç§°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é€šè¿‡go-tool-pprofå¾—åˆ°profileæ–‡ä»¶&#34;&gt;é€šè¿‡go tool pprofå¾—åˆ°profileæ–‡ä»¶ &lt;a href=&#34;#%e9%80%9a%e8%bf%87go-tool-pprof%e5%be%97%e5%88%b0profile%e6%96%87%e4%bb%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;webä¸‹è½½çš„é»˜è®¤æ˜¯30s,é€šè¿‡ä¸‹é¢å‘½ä»¤å¯ä»¥å¾—åˆ°60sçš„profileæ–‡ä»¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go tool pprof http://localhost:10000/debug/pprof/profile?seconds&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;60&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; go tool pprof http://localhost:10000/debug/pprof/profile?seconds=60
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Fetching profile over HTTP from http://localhost:10000/debug/pprof/profile?seconds=60
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Saved profile in /home/abner/pprof/pprof.procpu.samples.cpu.001.pb.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;File: procpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Type: cpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Time: Sep 19, 2024 at 10:28pm (CST)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Duration: 60.16s, Total samples = 18.90s (31.42%)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Entering interactive mode (type &amp;#34;help&amp;#34; for commands, &amp;#34;o&amp;#34; for options)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof) top
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Showing nodes accounting for 14990ms, 79.31% of 18900ms total
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Dropped 191 nodes (cum &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;&lt;/span&gt;= 94.50ms)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Showing top 10 nodes out of 74
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      flat  flat%   sum%        cum   cum%
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    3650ms 19.31% 19.31%     8440ms 44.66%  math/rand.(*Rand).Int31n
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    2960ms 15.66% 34.97%     2960ms 15.66%  internal/runtime/syscall.Syscall6
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    2770ms 14.66% 49.63%     2770ms 14.66%  internal/chacha8rand.block
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    1190ms  6.30% 55.93%     3050ms 16.14%  bytes.(*Buffer).Write
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    1160ms  6.14% 62.06%     1160ms  6.14%  runtime.memmove
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     780ms  4.13% 66.19%    14010ms 74.13%  main.genSomeBytes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     780ms  4.13% 70.32%     3970ms 21.01%  runtime.rand
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     660ms  3.49% 73.81%     9100ms 48.15%  math/rand.(*Rand).Intn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     550ms  2.91% 76.72%    10130ms 53.60%  math/rand.Intn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     490ms  2.59% 79.31%     4790ms 25.34%  math/rand.(*Rand).Int63 (inline)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof) 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å¯è§†åŒ–æŸ¥çœ‹&#34;&gt;å¯è§†åŒ–æŸ¥çœ‹ &lt;a href=&#34;#%e5%8f%af%e8%a7%86%e5%8c%96%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¾“å…¥web&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go tool pprof ./democpu profile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;File: democpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Type: cpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Time: Mar 3, 2020 at 11:18pm (CST)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Duration: 30.13s, Total samples = 6.27s (20.81%)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Entering interactive mode (type &amp;#34;help&amp;#34; for commands, &amp;#34;o&amp;#34; for options)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof) web
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œå¦‚æœæŠ¥æ‰¾ä¸åˆ°graphvizå·¥å…·,éœ€è¦å®‰è£…ä¸€ä¸‹
Ubuntuå®‰è£…:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install graphviz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Macå®‰è£…:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;brew install graphviz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Winå®‰è£…:
ä¸‹è½½https://graphviz.gitlab.io/_pages/Download/Download_windows.html
å°†graphvizå®‰è£…ç›®å½•ä¸‹çš„binæ–‡ä»¶å¤¹æ·»åŠ åˆ°Pathç¯å¢ƒå˜é‡ä¸­ã€‚ åœ¨ç»ˆç«¯è¾“å…¥dot -versionæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/godebug3.png&#34; alt=&#34;godebug3&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GRPCç¬”è®°</title>
      <link>https://abnerxc.github.io/go/grpc%E6%80%BB%E7%BB%93/</link>
      <pubDate>Mon, 22 Jul 2024 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/grpc%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;h1 id=&#34;å®‰è£…protobuf&#34;&gt;å®‰è£…Protobuf &lt;a href=&#34;#%e5%ae%89%e8%a3%85protobuf&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;ä¸‹è½½&lt;a href=&#34;https://github.com/protocolbuffers/protobuf/releases&#34;&gt;Protocol Buffers&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®ç¯å¢ƒå˜é‡ï¼Œmacoså¦‚ä¸‹:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export PATH&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$PATH:$JAVA_HOME/bin:&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;go env GOPATH&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;/bin:/Users/abner/tools/platform-tools:/Users/abner/tools/apache-maven-3.9.11/bin:/Users/abner/tools/protoc-32.0-osx-x86_64/bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ‰§è¡Œsource ~/.zshrc 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æœ€åç»ˆç«¯è¾“å…¥&lt;code&gt;protoc&lt;/code&gt; éªŒè¯&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å®‰è£…gRPCæ ¸å¿ƒåº“&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go get google.golang.org/grpc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;ä¸Šé¢å®‰è£…çš„æ˜¯protocolç¼–è¯‘å™¨,ä»–å¯ä»¥ç”Ÿæˆä¸åŒè¯­è¨€ä»£ç ã€‚æ¥ç€å®‰è£…goè¯­è¨€çš„ä»£ç ç”Ÿæˆå·¥å…·&lt;code&gt;protoc-gen-go&lt;/code&gt;ï¼Œå…¶ä»–è¯­è¨€è‡ªè¡Œç ”ç©¶&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;protoæ–‡ä»¶ç¼–å†™&#34;&gt;protoæ–‡ä»¶ç¼–å†™ &lt;a href=&#34;#proto%e6%96%87%e4%bb%b6%e7%bc%96%e5%86%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//è¿™æ˜¯åœ¨è¯´æ˜ä½¿ç”¨çš„æ˜¯proto3è¯­æ³•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;syntax &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;proto3&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//è¿™äº‹åœ¨è¯´æ˜ç”Ÿæˆçš„è·¯å¾„,è¿™é‡Œçš„.è¡¨ç¤ºå½“å‰ç›®å½•,serviceä»£ç ç”Ÿæˆçš„goæ–‡ä»¶åŒ…åæ˜¯service
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;option go_package &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;.;service&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å®šä¹‰æœåŠ¡Greeterï¼Œè¿™ä¸ªæœåŠ¡ä¸­æœ‰ä¸€ä¸ªrpcæ–¹æ³•SayHelloï¼Œè¯·æ±‚å‚æ•°æ˜¯HelloRequestï¼Œè¿”å›å‚æ•°æ˜¯HelloReplyã€‚ä¸€ä¸ªæ–‡ä»¶å¯ä»¥å®šä¹‰å¤šä¸ªserviceæœåŠ¡ï¼Œå¯ä»¥æŠŠä¸€ç»„ç›¸å…³çš„
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;service Greeter &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  rpc SayHello &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; returns &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;HelloReply&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// è¯·æ±‚å‚æ•°
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;message HelloRequest &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  string reqName &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å“åº”å‚æ•°
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;message HelloReply &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  string respMsg &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¼–å†™å®Œä¸Šé¢å†…å®¹åï¼Œåœ¨æ–‡ä»¶ç›®å½•æ‰§è¡Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protoc --go_out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;.  greeter.proto
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protoc --go-grpc_out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;.  greeter.proto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;protoæ–‡ä»¶ä»‹ç»&#34;&gt;protoæ–‡ä»¶ä»‹ç» &lt;a href=&#34;#proto%e6%96%87%e4%bb%b6%e4%bb%8b%e7%bb%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;message&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;message: protobufä¸­å®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ç±»å‹æ˜¯é€šè¿‡å…³é”®å­—messageå­—æ®µæŒ‡å®šçš„ã€‚ç±»ä¼¼c++ä¸­çš„class,javaä¸­çš„class,goä¸­çš„structï¼Œä¸€ä¸ªprotoæ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªæ¶ˆæ¯ç±»å‹&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å­—æ®µè§„åˆ™&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;required: è¡¨ç¤ºå­—æ®µå¿…é¡»èµ‹å€¼,å¦åˆ™ç¼–è¯‘ä¸è¿‡ã€‚åœ¨proto3ä¸­ï¼Œrequiredå­—æ®µå·²å¼ƒç”¨
optional: è¡¨ç¤ºå­—æ®µå¯ä»¥ä¸èµ‹å€¼ã€‚åœ¨proto3ä¸­ï¼Œrequiredã€optionalå­—æ®µå·²éƒ½å·²ç»é»˜è®¤optional
repeated: è¡¨ç¤ºå­—æ®µå¯ä»¥é‡å¤èµ‹å€¼,åœ¨goä¸­ä¼šè¢«å®šä¹‰ä¸ºåˆ‡ç‰‡&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¶ˆæ¯å·&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨æ¶ˆæ¯ä½“çš„å®šä¹‰ä¸­ï¼Œæ¯ä¸ªå­—æ®µéƒ½å¿…é¡»è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ï¼Œæ ‡è¯†ä»[1,2^29-1]èŒƒå›´å†…çš„ä¸€ä¸ªæ•´æ•°&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åµŒå¥—æ¶ˆæ¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯ä»¥åœ¨å…¶ä»–æ¶ˆæ¯ç±»å‹ä¸­å®šä¹‰ä½¿ç”¨æ¶ˆæ¯ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;message Father &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    message Son &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        string name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        int32 age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        repeated int32 weight &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 3;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    repeated Son sons &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœè¦åœ¨å¤–éƒ¨ä½¿ç”¨è¿™ä¸ªæ¶ˆæ¯ç±»å‹ï¼Œéœ€è¦Father.Sonçš„å½¢å¼ä½¿ç”¨ã€‚å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;message Family &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Father.Son one &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æœåŠ¡å®šä¹‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨protoæ–‡ä»¶ä¸­å®šä¹‰æœåŠ¡ï¼ŒæœåŠ¡ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½å¯¹åº”ä¸€ä¸ªRPCæ–¹æ³•ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;service GoodsService &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    rpc Serarch&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;SearchRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; returns &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;SearchResponse&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;æœåŠ¡ç«¯ç¼–å†™&#34;&gt;æœåŠ¡ç«¯ç¼–å†™ &lt;a href=&#34;#%e6%9c%8d%e5%8a%a1%e7%ab%af%e7%bc%96%e5%86%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;server.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;demo/grpc/pb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const port &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:50051&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type ServerDemo struct &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	pb.UnimplementedGreeterServer
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;s *ServerDemo&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, req *pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;resp *pb.HelloReply, err error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	msg :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fmt.Sprintf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hello,%s[rpc-server,os=%s,nowNanosecond=%d]&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		req.ReqName, runtime.GOOS, time.Now&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;.Nanosecond&lt;span style=&#34;color:#f92672&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &amp;amp;pb.HelloReply&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;RespMsg: msg&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	listen, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net.Listen&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, port&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		panic&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	newServer :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.NewServer&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	pb.RegisterGreeterServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;newServer, &amp;amp;ServerDemo&lt;span style=&#34;color:#f92672&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	err &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; newServer.Serve&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;listen&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	fmt.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;å®¢æˆ·ç«¯ç¼–å†™&#34;&gt;å®¢æˆ·ç«¯ç¼–å†™ &lt;a href=&#34;#%e5%ae%a2%e6%88%b7%e7%ab%af%e7%bc%96%e5%86%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;client.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;demo/grpc/pb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	address     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;localhost:50051&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	defaultName &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;kaola&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	conn, e :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.Dial&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;address, grpc.WithInsecure&lt;span style=&#34;color:#f92672&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; e !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		panic&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;e&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	defer conn.Close&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	c :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pb.NewGreeterClient&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;conn&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	reply, e :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; c.SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;context.Background&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;, &amp;amp;pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;ReqName: defaultName&lt;span style=&#34;color:#f92672&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; e !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		log.Fatal&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;e&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	fmt.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;reply.RespMsg&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;è®¤è¯&#34;&gt;è®¤è¯ &lt;a href=&#34;#%e8%ae%a4%e8%af%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;gRPCé»˜è®¤å†…ç½®äº†ä¸¤ç§è®¤è¯æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SSL/TLSè®¤è¯æ–¹å¼&lt;/li&gt;
&lt;li&gt;åŸºäºTokençš„è®¤è¯æ–¹å¼
åŒæ—¶ï¼ŒgRPCæä¾›äº†æ¥å£ç”¨äºæ‰©å±•è‡ªå®šä¹‰è®¤è¯æ–¹å¼
é¡¹ç›®è·¯é¢ç»“æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” client/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // æœåŠ¡ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” proto/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.proto   // protoæè¿°æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.pb.go   // protoç¼–è¯‘åæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ssltlsè®¤è¯&#34;&gt;SSL/TLSè®¤è¯ &lt;a href=&#34;#ssltls%e8%ae%a4%e8%af%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¿™é‡Œç›´æ¥æ‰©å±•helloé¡¹ç›®ï¼Œå®ç°TLSè®¤è¯æœºåˆ¶&lt;/p&gt;
&lt;p&gt;é¦–å…ˆéœ€è¦å‡†å¤‡è¯ä¹¦ï¼Œåœ¨helloç›®å½•æ–°å»ºkeysç›®å½•ç”¨äºå­˜æ”¾è¯ä¹¦æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯ä¹¦åˆ¶ä½œ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åˆ¶ä½œç§é’¥ (.key)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Key considerations for algorithm &amp;#34;RSA&amp;#34; â‰¥ 2048-bit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ openssl genrsa -out server.key &lt;span style=&#34;color:#ae81ff&#34;&gt;2048&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Key considerations for algorithm &amp;#34;ECDSA&amp;#34; â‰¥ secp384r1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# List ECDSA the supported curves (openssl ecparam -list_curves)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ openssl ecparam -genkey -name secp384r1 -out server.key
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‡ªç­¾åå…¬é’¥(x509) (PEM-encodings .pem|.crt)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ openssl req -new -x509 -sha256 -key server.key -out server.pem -days &lt;span style=&#34;color:#ae81ff&#34;&gt;3650&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‡ªå®šä¹‰ä¿¡æ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-----
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Country Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; letter code&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;AU&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:CN
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;State or Province Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;full name&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Some-State&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:XxXx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Locality Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;eg, city&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;:XxXx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Organization Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;eg, company&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Internet Widgits Pty Ltd&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:XX Co. Ltd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Organizational Unit Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;eg, section&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;:Dev
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Common Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;e.g. server FQDN or YOUR name&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;:server name
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Email Address &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;:xxx@xxx.com
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›®å½•ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” hello-tls/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” client/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // æœåŠ¡ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” keys/                 // è¯ä¹¦ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.key
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.pem
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” proto/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.proto   // protoæè¿°æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.pb.go   // protoç¼–è¯‘åæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ä»£ç 
ä¿®æ”¹æœåŠ¡ç«¯ä»£ç ï¼šserver/main.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // å¼•å…¥grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å®šä¹‰helloServiceå¹¶å®ç°çº¦å®šçš„æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type helloService struct&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// HelloService HelloæœåŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;var HelloService &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; helloService&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// SayHello å®ç°HelloæœåŠ¡æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;h helloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, in *pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;*pb.HelloResponse, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; new&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;pb.HelloResponse&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp.Message &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fmt.Sprintf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello %s.&amp;#34;&lt;/span&gt;, in.Name&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; resp, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net.Listen&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, Address&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to listen: %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewServerTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.key&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to generate credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // å®ä¾‹åŒ–grpc Server, å¹¶å¼€å¯TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.NewServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;grpc.Creds&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æ³¨å†ŒHelloService
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb.RegisterHelloServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;s, HelloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Listen on &amp;#34;&lt;/span&gt; + Address + &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; with TLS&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s.Serve&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;listen&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡ç«¯åœ¨å®ä¾‹åŒ–grpc Serveræ—¶ï¼Œå¯é…ç½®å¤šç§é€‰é¡¹ï¼ŒTLSè®¤è¯æ˜¯å…¶ä¸­ä¹‹ä¸€&lt;/p&gt;
&lt;p&gt;å®¢æˆ·ç«¯æ·»åŠ TLSè®¤è¯ï¼šclient/main.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt; // å¼•å…¥protoåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // å¼•å…¥grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // TLSè¿æ¥
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewClientTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;server name&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to create TLS credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    conn, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.Dial&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Address, grpc.WithTransportCredentials&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    defer conn.Close&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // åˆå§‹åŒ–å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    c :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pb.NewHelloClient&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;conn&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // è°ƒç”¨æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    req :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;amp;pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;Name: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gRPC&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    res, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; c.SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;context.Background&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;, req&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;res.Message&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®¢æˆ·ç«¯æ·»åŠ TLSè®¤è¯çš„æ–¹å¼å’ŒæœåŠ¡ç«¯ç±»ä¼¼ï¼Œåœ¨åˆ›å»ºè¿æ¥Dialæ—¶ï¼ŒåŒæ ·å¯ä»¥é…ç½®å¤šç§é€‰é¡¹ï¼Œåé¢çš„ç¤ºä¾‹ä¸­ä¼šçœ‹åˆ°æ›´å¤šçš„é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;tokenè®¤è¯&#34;&gt;Tokenè®¤è¯ &lt;a href=&#34;#token%e8%ae%a4%e8%af%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å†è¿›ä¸€æ­¥ï¼Œç»§ç»­æ‰©å±•hello-tlsé¡¹ç›®ï¼Œå®ç°TLS + Tokenè®¤è¯æœºåˆ¶ï¼Œä¹Ÿå¯ä»¥ä¸éœ€è¦TLSï¼Œä»…ä½¿ç”¨tokenã€‚ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨TLS + Tokenè®¤è¯æœºåˆ¶
ç›®å½•ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” hello_token/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” client/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // æœåŠ¡ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” keys/             // è¯ä¹¦ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.key
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.pem
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” proto/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.proto   // protoæè¿°æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.pb.go   // protoç¼–è¯‘åæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ä»£ç &lt;/p&gt;
&lt;p&gt;å…ˆä¿®æ”¹å®¢æˆ·ç«¯å®ç°ï¼šclient/main.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt; // å¼•å…¥protoåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // å¼•å…¥grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // OpenTLS æ˜¯å¦å¼€å¯TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    OpenTLS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// customCredential è‡ªå®šä¹‰è®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type customCredential struct&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// GetRequestMetadata å®ç°è‡ªå®šä¹‰è®¤è¯æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;c customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; GetRequestMetadata&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, uri ...string&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;map&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;string, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; map&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appid&amp;#34;&lt;/span&gt;:  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;101010&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appkey&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;i am key&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// RequireTransportSecurity è‡ªå®šä¹‰è®¤è¯æ˜¯å¦å¼€å¯TLS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;c customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; RequireTransportSecurity&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; bool &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; OpenTLS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var err error
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var opts &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;grpc.DialOption
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; OpenTLS &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        // TLSè¿æ¥
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewClientTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;server name&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to create TLS credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithTransportCredentials&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithInsecure&lt;span style=&#34;color:#f92672&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // ä½¿ç”¨è‡ªå®šä¹‰è®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithPerRPCCredentials&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;new&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    conn, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.Dial&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Address, opts...&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    defer conn.Close&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // åˆå§‹åŒ–å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    c :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pb.NewHelloClient&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;conn&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // è°ƒç”¨æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    req :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;amp;pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;Name: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gRPC&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    res, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; c.SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;context.Background&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;, req&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;res.Message&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª&lt;code&gt;customCredential&lt;/code&gt;ç»“æ„ï¼Œå¹¶å®ç°äº†ä¸¤ä¸ªæ–¹æ³•&lt;code&gt;GetRequestMetadata&lt;/code&gt;å’Œ&lt;code&gt;RequireTransportSecurity&lt;/code&gt;ã€‚è¿™æ˜¯gRPCæä¾›çš„è‡ªå®šä¹‰è®¤è¯æ–¹å¼ï¼Œæ¯æ¬¡RPCè°ƒç”¨éƒ½ä¼šä¼ è¾“è®¤è¯ä¿¡æ¯ã€‚&lt;code&gt;customCredential&lt;/code&gt;å…¶å®æ˜¯å®ç°äº†&lt;code&gt;grpc/credential&lt;/code&gt;åŒ…å†…çš„&lt;code&gt;PerRPCCredentials&lt;/code&gt;æ¥å£ã€‚æ¯æ¬¡è°ƒç”¨ï¼Œtokenä¿¡æ¯ä¼šé€šè¿‡è¯·æ±‚çš„metadataä¼ è¾“åˆ°æœåŠ¡ç«¯ã€‚ä¸‹é¢å…·ä½“çœ‹ä¸€ä¸‹æœåŠ¡ç«¯å¦‚ä½•è·å–metadataä¸­çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹server/main.goä¸­çš„SayHelloæ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/codes&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // å¼•å…¥grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/metadata&amp;#34;&lt;/span&gt; // å¼•å…¥grpc metaåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å®šä¹‰helloServiceå¹¶å®ç°çº¦å®šçš„æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type helloService struct&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// HelloService ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;var HelloService &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; helloService&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// SayHello å®ç°HelloæœåŠ¡æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;h helloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, in *pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;*pb.HelloResponse, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // è§£æmetadaä¸­çš„ä¿¡æ¯å¹¶éªŒè¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    md, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; metadata.FromContext&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; nil, grpc.Errorf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;codes.Unauthenticated, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;æ— Tokenè®¤è¯ä¿¡æ¯&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appid  string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appkey string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; val, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; md&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appid&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; val&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; val, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; md&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appkey&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appkey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; val&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; appid !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;101010&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; appkey !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;i am key&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; nil, grpc.Errorf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;codes.Unauthenticated, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Tokenè®¤è¯ä¿¡æ¯æ— æ•ˆ: appid=%s, appkey=%s&amp;#34;&lt;/span&gt;, appid, appkey&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; new&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;pb.HelloResponse&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp.Message &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fmt.Sprintf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello %s.\nToken info: appid=%s,appkey=%s&amp;#34;&lt;/span&gt;, in.Name, appid, appkey&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; resp, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net.Listen&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, Address&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;failed to listen: %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewServerTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.key&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to generate credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // å®ä¾‹åŒ–grpc Server, å¹¶å¼€å¯TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.NewServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;grpc.Creds&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æ³¨å†ŒHelloService
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb.RegisterHelloServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;s, HelloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Listen on &amp;#34;&lt;/span&gt; + Address + &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; with TLS + Token&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s.Serve&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;listen&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡ç«¯å¯ä»¥ä»contextä¸­è·å–æ¯æ¬¡è¯·æ±‚çš„metadataï¼Œä»ä¸­è¯»å–å®¢æˆ·ç«¯å‘é€çš„tokenä¿¡æ¯å¹¶éªŒè¯æœ‰æ•ˆæ€§ã€‚
&lt;code&gt;google.golang.org/grpc/credentials/oauth&lt;/code&gt;åŒ…å·²å®ç°äº†ç”¨äºGoogle APIçš„oauthå’ŒjwtéªŒè¯çš„æ–¹æ³•ï¼Œä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚å®ç°åˆé€‚çš„éªŒè¯æ–¹å¼ã€‚&lt;/p&gt;
&lt;h1 id=&#34;interceptor-æ‹¦æˆªå™¨&#34;&gt;Interceptor æ‹¦æˆªå™¨ &lt;a href=&#34;#interceptor-%e6%8b%a6%e6%88%aa%e5%99%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;grpcæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½æä¾›äº†interceptoråŠŸèƒ½ï¼ŒåŠŸèƒ½ç±»ä¼¼middlewareï¼Œå¾ˆé€‚åˆåœ¨è¿™é‡Œå¤„ç†éªŒè¯ã€æ—¥å¿—ç­‰æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è‡ªå®šä¹‰Tokenè®¤è¯çš„ç¤ºä¾‹ä¸­ï¼Œè®¤è¯ä¿¡æ¯æ˜¯ç”±æ¯ä¸ªæœåŠ¡ä¸­çš„æ–¹æ³•å¤„ç†å¹¶è®¤è¯çš„ï¼Œå¦‚æœæœ‰å¤§é‡çš„æ¥å£æ–¹æ³•ï¼Œè¿™ç§å§¿åŠ¿å°±å¤ªä¸ä¼˜é›…äº†ï¼Œæ¯ä¸ªæ¥å£å®ç°éƒ½è¦å…ˆå¤„ç†è®¤è¯ä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™interceptorå°±å¯ä»¥ç”¨æ¥è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œåœ¨è¯·æ±‚è¢«è½¬åˆ°å…·ä½“æ¥å£ä¹‹å‰å¤„ç†è®¤è¯ä¿¡æ¯ï¼Œä¸€å¤„è®¤è¯ï¼Œåˆ°å¤„æ— å¿§ã€‚ åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªè¯·æ±‚æ—¥å¿—ï¼Œè®°å½•è¯·æ±‚ç›¸å…³çš„å‚æ•°å’Œè€—æ—¶ç­‰ç­‰ã€‚ä¿®æ”¹hello_tokené¡¹ç›®å®ç°ï¼š
ç›®å½•ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” hello_interceptor/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” client/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // æœåŠ¡ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” keys/             // è¯ä¹¦ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.key
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.pem
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” proto/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.proto   // protoæè¿°æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.pb.go   // protoç¼–è¯‘åæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ä»£ç 
æœåŠ¡ç«¯interceptorï¼š hello_interceptor/server/main.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/codes&amp;#34;&lt;/span&gt;       // grpc å“åº”çŠ¶æ€ç 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/metadata&amp;#34;&lt;/span&gt; // grpc metadataåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å®šä¹‰helloServiceå¹¶å®ç°çº¦å®šçš„æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type helloService struct&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// HelloService HelloæœåŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;var HelloService &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; helloService&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// SayHello å®ç°HelloæœåŠ¡æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;h helloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, in *pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;*pb.HelloResponse, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; new&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;pb.HelloResponse&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp.Message &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fmt.Sprintf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello %s.&amp;#34;&lt;/span&gt;, in.Name&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; resp, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net.Listen&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, Address&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to listen: %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var opts &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;grpc.ServerOption
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewServerTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.key&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to generate credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.Creds&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æ³¨å†Œinterceptor
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.UnaryInterceptor&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;interceptor&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // å®ä¾‹åŒ–grpc Server
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.NewServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts...&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æ³¨å†ŒHelloService
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb.RegisterHelloServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;s, HelloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Listen on &amp;#34;&lt;/span&gt; + Address + &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; with TLS + Token + Interceptor&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s.Serve&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;listen&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// auth éªŒè¯Token
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func auth&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; error &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    md, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; metadata.FromContext&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; grpc.Errorf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;codes.Unauthenticated, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;æ— Tokenè®¤è¯ä¿¡æ¯&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appid  string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appkey string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; val, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; md&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appid&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; val&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; val, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; md&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appkey&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appkey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; val&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; appid !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;101010&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; appkey !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;i am key&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; grpc.Errorf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;codes.Unauthenticated, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Tokenè®¤è¯ä¿¡æ¯æ— æ•ˆ: appid=%s, appkey=%s&amp;#34;&lt;/span&gt;, appid, appkey&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// interceptor æ‹¦æˆªå™¨
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func interceptor&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, req interface&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;interface&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; auth&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; nil, err
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // ç»§ç»­å¤„ç†è¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; handler&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx, req&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ç°å®¢æˆ·ç«¯interceptorï¼šhello_intercepror/client/main.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt; // å¼•å…¥protoåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // å¼•å…¥grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // OpenTLS æ˜¯å¦å¼€å¯TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    OpenTLS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// customCredential è‡ªå®šä¹‰è®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type customCredential struct&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// GetRequestMetadata å®ç°è‡ªå®šä¹‰è®¤è¯æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;c customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; GetRequestMetadata&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, uri ...string&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;map&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;string, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; map&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appid&amp;#34;&lt;/span&gt;:  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;101010&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appkey&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;i am key&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// RequireTransportSecurity è‡ªå®šä¹‰è®¤è¯æ˜¯å¦å¼€å¯TLS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;c customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; RequireTransportSecurity&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; bool &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; OpenTLS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var err error
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var opts &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;grpc.DialOption
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; OpenTLS &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        // TLSè¿æ¥
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewClientTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;server name&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to create TLS credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithTransportCredentials&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithInsecure&lt;span style=&#34;color:#f92672&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æŒ‡å®šè‡ªå®šä¹‰è®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithPerRPCCredentials&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;new&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æŒ‡å®šå®¢æˆ·ç«¯interceptor
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithUnaryInterceptor&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;interceptor&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    conn, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.Dial&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Address, opts...&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    defer conn.Close&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // åˆå§‹åŒ–å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    c :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pb.NewHelloClient&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;conn&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // è°ƒç”¨æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    req :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;amp;pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;Name: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gRPC&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    res, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; c.SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;context.Background&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;, req&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;res.Message&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// interceptor å®¢æˆ·ç«¯æ‹¦æˆªå™¨
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func interceptor&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, method string, req, reply interface&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, cc *grpc.ClientConn, invoker grpc.UnaryInvoker, opts ...grpc.CallOption&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; error &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; time.Now&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; invoker&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx, method, req, reply, cc, opts...&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Printf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;method=%s req=%v rep=%v duration=%s error=%v\n&amp;#34;&lt;/span&gt;, method, req, reply, time.Since&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;start&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; err
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;å†…ç½®trace&#34;&gt;å†…ç½®Trace &lt;a href=&#34;#%e5%86%85%e7%bd%aetrace&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;grpcå†…ç½®äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¯·æ±‚è¿½è¸ªï¼ŒåŸºäº&lt;code&gt;golang.org/x/net/trace&lt;/code&gt;åŒ…å®ç°ï¼Œé»˜è®¤æ˜¯å¼€å¯çŠ¶æ€ï¼Œå¯ä»¥æŸ¥çœ‹äº‹ä»¶å’Œè¯·æ±‚æ—¥å¿—ï¼Œå¯¹äºåŸºæœ¬çš„è¯·æ±‚çŠ¶æ€æŸ¥çœ‹è°ƒè¯•ä¹Ÿæ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œä»¥æœåŠ¡ç«¯å¼€å¯trace serverä¸ºä¾‹ï¼Œä¿®æ”¹helloé¡¹ç›®æœåŠ¡ç«¯ä»£ç ï¼š
ç›®å½•ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” hello_trace/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” client/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // æœåŠ¡ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” proto/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.proto   // protoæè¿°æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.pb.go   // protoç¼–è¯‘åæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;pb&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å¼•å…¥ç¼–è¯‘ç”Ÿæˆçš„åŒ…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/trace&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Address gRPCæœåŠ¡åœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Address&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// å®šä¹‰helloServiceå¹¶å®ç°çº¦å®šçš„æ¥å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;helloService&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// HelloService HelloæœåŠ¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;HelloService&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;helloService&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// SayHello å®ç°HelloæœåŠ¡æ¥å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;h&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;helloService&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;SayHello&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ctx&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;context&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Context&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;pb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HelloRequest&lt;/span&gt;) (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;pb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HelloResponse&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;error&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;resp&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; new(&lt;span style=&#34;color:#a6e22e&#34;&gt;pb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HelloResponse&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;resp&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Message&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sprintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello %s.&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;in&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Name&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;resp&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;listen&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Listen&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;Address&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;grpclog&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatalf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;failed to listen: %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å®ä¾‹åŒ–grpc Server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;grpc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewServer&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// æ³¨å†ŒHelloService&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;pb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RegisterHelloServer&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;HelloService&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å¼€å¯trace&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;startTrace&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;grpclog&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Listen on &amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Address&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Serve&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;listen&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;startTrace&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;trace&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;AuthRequest&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;req&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Request&lt;/span&gt;) (&lt;span style=&#34;color:#66d9ef&#34;&gt;any&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;sensitive&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:50051&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;grpclog&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Trace listen on 50051&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬å¼€å¯ä¸€ä¸ªhttpæœåŠ¡ç›‘å¬50051ç«¯å£ï¼Œç”¨æ¥æŸ¥çœ‹grpcè¯·æ±‚çš„traceä¿¡æ¯&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç«¯äº‹ä»¶æŸ¥çœ‹&#34;&gt;æœåŠ¡ç«¯äº‹ä»¶æŸ¥çœ‹ &lt;a href=&#34;#%e6%9c%8d%e5%8a%a1%e7%ab%af%e4%ba%8b%e4%bb%b6%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è®¿é—®ï¼šlocalhost:50051/debug/eventsï¼Œç»“æœå¦‚å›¾ï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/grpc_trace_events.jpg&#34; alt=&#34;grpc-trace-events&#34;&gt;
å¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯æ³¨å†Œçš„æœåŠ¡å’ŒæœåŠ¡æ­£å¸¸å¯åŠ¨çš„äº‹ä»¶ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¯·æ±‚æ—¥å¿—ä¿¡æ¯æŸ¥çœ‹&#34;&gt;è¯·æ±‚æ—¥å¿—ä¿¡æ¯æŸ¥çœ‹ &lt;a href=&#34;#%e8%af%b7%e6%b1%82%e6%97%a5%e5%bf%97%e4%bf%a1%e6%81%af%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è®¿é—®ï¼šlocalhost:50051/debug/requestsï¼Œç»“æœå¦‚å›¾ï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/grpc_trace_requests.jpg&#34; alt=&#34;grpc-trace-events&#34;&gt;
è¿™é‡Œå¯ä»¥æ˜¾ç¤ºæœ€è¿‘çš„è¯·æ±‚çŠ¶æ€ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„æœåŠ¡ã€å‚æ•°ã€è€—æ—¶ã€å“åº”ï¼Œå¯¹äºç®€å•çš„çŠ¶æ€æŸ¥çœ‹è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œé»˜è®¤å€¼æ˜¾ç¤ºæœ€è¿‘10æ¡è®°å½•ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Goçš„deferæ€»ç»“</title>
      <link>https://abnerxc.github.io/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/</link>
      <pubDate>Fri, 15 Mar 2024 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;h1 id=&#34;ä¸€deferæ‰§è¡Œé¡ºåº&#34;&gt;ä¸€ã€deferæ‰§è¡Œé¡ºåº &lt;a href=&#34;#%e4%b8%80defer%e6%89%a7%e8%a1%8c%e9%a1%ba%e5%ba%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¤šä¸ªdeferå‡ºç°çš„æ—¶å€™ï¼Œ&lt;strong&gt;å®ƒæ˜¯ä¸€ä¸ªâ€œæ ˆâ€çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯å…ˆè¿›åå‡º&lt;/strong&gt;ã€‚ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå†™åœ¨å‰é¢çš„deferä¼šæ¯”å†™åœ¨åé¢çš„deferè°ƒç”¨çš„æ™šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func1&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func2&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func3&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func1&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func2&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func3&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-defer1.jpeg&#34; alt=&#34;go-defer&#34;&gt;
è¾“å‡ºç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;C
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;B
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;äºŒdeferä¸returnè°å…ˆè°å&#34;&gt;äºŒã€deferä¸returnè°å…ˆè°å &lt;a href=&#34;#%e4%ba%8cdefer%e4%b8%8ereturn%e8%b0%81%e5%85%88%e8%b0%81%e5%90%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;deferFunc&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer func called&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;returnFunc&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;return func called&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;returnAndDefer&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;deferFunc&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;returnFunc&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;returnAndDefer&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œç»“æœä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;return func called
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer func called
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“è®ºä¸ºï¼šreturnä¹‹åçš„è¯­å¥å…ˆæ‰§è¡Œï¼Œdeferåçš„è¯­å¥åæ‰§è¡Œ&lt;/p&gt;
&lt;h1 id=&#34;ä¸‰å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ–&#34;&gt;ä¸‰ã€å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ– &lt;a href=&#34;#%e4%b8%89%e5%87%bd%e6%95%b0%e7%9a%84%e8%bf%94%e5%9b%9e%e5%80%bc%e5%88%9d%e5%a7%8b%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DeferFunc1&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) (&lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;t = &amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;DeferFunc11&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// output t=0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯æ˜ï¼Œåªè¦å£°æ˜å‡½æ•°çš„è¿”å›å€¼å˜é‡åç§°ï¼Œå°±ä¼šåœ¨å‡½æ•°åˆå§‹åŒ–æ—¶å€™ä¸ºä¹‹èµ‹å€¼ä¸º0ï¼Œè€Œä¸”åœ¨å‡½æ•°ä½“ä½œç”¨åŸŸå¯è§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å››æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ&#34;&gt;å››ã€æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ &lt;a href=&#34;#%e5%9b%9b%e6%9c%89%e5%90%8d%e5%87%bd%e6%95%b0%e8%bf%94%e5%9b%9e%e5%80%bc%e9%81%87%e8%a7%81defer%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;returnButDefer&lt;/span&gt;() (&lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {  &lt;span style=&#34;color:#75715e&#34;&gt;//tåˆå§‹åŒ–0ï¼Œ å¹¶ä¸”ä½œç”¨åŸŸä¸ºè¯¥å‡½æ•°å…¨åŸŸ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;returnButDefer&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// output t=10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥returnButDefer()æœ¬åº”çš„è¿”å›å€¼æ˜¯1ï¼Œä½†æ˜¯åœ¨returnä¹‹åï¼Œåˆè¢«deferçš„åŒ¿åfuncå‡½æ•°æ‰§è¡Œï¼Œæ‰€ä»¥t=t*10è¢«æ‰§è¡Œï¼Œæœ€åreturnButDefer()è¿”å›ç»™ä¸Šå±‚main()çš„ç»“æœä¸º10&lt;/p&gt;
&lt;h1 id=&#34;äº”deferé‡è§panic&#34;&gt;äº”ã€deferé‡è§panic &lt;a href=&#34;#%e4%ba%94defer%e9%81%87%e8%a7%81panic&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æ ¹æ®çŸ¥è¯†ç‚¹2ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œdeferé‡è§returnæƒ…å†µå¦‚ä¸‹ï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/go-defer2.jpeg&#34; alt=&#34;go-defer2&#34;&gt;
é‚£ä¹ˆï¼Œé‡åˆ°panicæ—¶ï¼Œéå†æœ¬åç¨‹çš„deferé“¾è¡¨ï¼Œå¹¶æ‰§è¡Œdeferã€‚åœ¨æ‰§è¡Œdeferè¿‡ç¨‹ä¸­:é‡åˆ°recoveråˆ™åœæ­¢panicï¼Œè¿”å›recoverå¤„ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰é‡åˆ°recoverï¼Œéå†å®Œæœ¬åç¨‹çš„deferé“¾è¡¨åï¼Œå‘stderræŠ›å‡ºpanicä¿¡æ¯ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-defer3.jpeg&#34; alt=&#34;go-defer3&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;deferé‡è§panicä½†æ˜¯å¹¶ä¸æ•è·å¼‚å¸¸çš„æƒ…å†µ&#34;&gt;deferé‡è§panicï¼Œä½†æ˜¯å¹¶ä¸æ•è·å¼‚å¸¸çš„æƒ…å†µ &lt;a href=&#34;#defer%e9%81%87%e8%a7%81panic%e4%bd%86%e6%98%af%e5%b9%b6%e4%b8%8d%e6%8d%95%e8%8e%b7%e5%bc%82%e5%b8%b8%e7%9a%84%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;defer_call&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main æ­£å¸¸ç»“æŸ&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;defer_call&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹å‰1&amp;#34;&lt;/span&gt;) }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹å‰2&amp;#34;&lt;/span&gt;) }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å¼‚å¸¸å†…å®¹&amp;#34;&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;//è§¦å‘deferå‡ºæ ˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹åï¼Œæ°¸è¿œæ‰§è¡Œä¸åˆ°&amp;#34;&lt;/span&gt;) }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// output
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer: panic ä¹‹å‰2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer: panic ä¹‹å‰1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;panic: å¼‚å¸¸å†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//... å¼‚å¸¸å †æ ˆä¿¡æ¯
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;deferé‡è§panicå¹¶æ•è·å¼‚å¸¸&#34;&gt;deferé‡è§panicï¼Œå¹¶æ•è·å¼‚å¸¸ &lt;a href=&#34;#defer%e9%81%87%e8%a7%81panic%e5%b9%b6%e6%8d%95%e8%8e%b7%e5%bc%82%e5%b8%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;defer_call&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main æ­£å¸¸ç»“æŸ&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;defer_call&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹å‰1, æ•è·å¼‚å¸¸&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; recover(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹å‰2, ä¸æ•è·&amp;#34;&lt;/span&gt;) }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å¼‚å¸¸å†…å®¹&amp;#34;&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;//è§¦å‘deferå‡ºæ ˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹å, æ°¸è¿œæ‰§è¡Œä¸åˆ°&amp;#34;&lt;/span&gt;) }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer: panic ä¹‹å‰2, ä¸æ•è·
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer: panic ä¹‹å‰1, æ•è·å¼‚å¸¸
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å¼‚å¸¸å†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;main æ­£å¸¸ç»“æŸ
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;defer æœ€å¤§çš„åŠŸèƒ½æ˜¯ panic åä¾ç„¶æœ‰æ•ˆ
æ‰€ä»¥deferå¯ä»¥ä¿è¯ä½ çš„ä¸€äº›èµ„æºä¸€å®šä¼šè¢«å…³é—­ï¼Œä»è€Œé¿å…ä¸€äº›å¼‚å¸¸å‡ºç°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…­deferä¸­åŒ…å«panic&#34;&gt;å…­ã€deferä¸­åŒ…å«panic &lt;a href=&#34;#%e5%85%addefer%e4%b8%ad%e5%8c%85%e5%90%abpanic&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;()  {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; recover(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fatal&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer panic&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;panic&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer panic
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ†æ
&lt;strong&gt;panicä»…æœ‰æœ€åä¸€ä¸ªå¯ä»¥è¢«revoveræ•è·ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è§¦å‘&lt;code&gt;panic(&amp;quot;panic&amp;quot;)&lt;/code&gt;ådeferé¡ºåºå‡ºæ ˆæ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„deferä¸­ ä¼šæœ‰panic(&amp;ldquo;defer panic&amp;rdquo;)å¼‚å¸¸è¯­å¥ï¼Œè¿™ä¸ªå¼‚å¸¸å°†ä¼šè¦†ç›–æ‰mainä¸­çš„å¼‚å¸¸panic(&amp;ldquo;panic&amp;rdquo;)ï¼Œæœ€åè¿™ä¸ªå¼‚å¸¸è¢«ç¬¬äºŒä¸ªæ‰§è¡Œçš„deferæ•è·åˆ°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸ƒdeferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•°&#34;&gt;ä¸ƒã€deferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•° &lt;a href=&#34;#%e4%b8%83defer%e4%b8%8b%e7%9a%84%e5%87%bd%e6%95%b0%e5%8f%82%e6%95%b0%e5%8c%85%e5%90%ab%e5%ad%90%e5%87%bd%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœ:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;3
4
2
1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åˆ†æï¼š
è¿™é‡Œï¼Œæœ‰4ä¸ªå‡½æ•°ï¼Œä»–ä»¬çš„indexåºå·åˆ†åˆ«ä¸º1ï¼Œ2ï¼Œ3ï¼Œ4ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆè¿™4ä¸ªå‡½æ•°çš„å…ˆåæ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œé¢æœ‰ä¸¤ä¸ªdeferï¼Œ æ‰€ä»¥deferä¸€å…±ä¼šå‹æ ˆä¸¤æ¬¡ï¼Œå…ˆè¿›æ ˆ1ï¼Œåè¿›æ ˆ2ã€‚ é‚£ä¹ˆåœ¨å‹æ ˆfunction1çš„æ—¶å€™ï¼Œéœ€è¦è¿åŒå‡½æ•°åœ°å€ã€å‡½æ•°å½¢å‚ä¸€åŒè¿›æ ˆï¼Œé‚£ä¹ˆä¸ºäº†å¾—åˆ°function1çš„ç¬¬äºŒä¸ªå‚æ•°çš„ç»“æœï¼Œæ‰€ä»¥å°±éœ€è¦å…ˆæ‰§è¡Œfunction3å°†ç¬¬äºŒä¸ªå‚æ•°ç®—å‡ºï¼Œé‚£ä¹ˆfunction3å°±è¢«ç¬¬ä¸€ä¸ªæ‰§è¡Œã€‚åŒç†å‹æ ˆfunction2ï¼Œå°±éœ€è¦æ‰§è¡Œfunction4ç®—å‡ºfunction2ç¬¬äºŒä¸ªå‚æ•°çš„å€¼ã€‚ç„¶åå‡½æ•°ç»“æŸï¼Œå…ˆå‡ºæ ˆfuction2ã€å†å‡ºæ ˆfunction1.&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥é¡ºåºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;deferå‹æ ˆfunction1ï¼Œå‹æ ˆå‡½æ•°åœ°å€ã€å½¢å‚1ã€å½¢å‚2(è°ƒç”¨function3) &amp;ndash;&amp;gt; æ‰“å°3&lt;/li&gt;
&lt;li&gt;deferå‹æ ˆfunction2ï¼Œå‹æ ˆå‡½æ•°åœ°å€ã€å½¢å‚1ã€å½¢å‚2(è°ƒç”¨function4) &amp;ndash;&amp;gt; æ‰“å°4&lt;/li&gt;
&lt;li&gt;deferå‡ºæ ˆfunction2, è°ƒç”¨function2 &amp;ndash;&amp;gt; æ‰“å°2&lt;/li&gt;
&lt;li&gt;deferå‡ºæ ˆfunction1, è°ƒç”¨function1&amp;ndash;&amp;gt; æ‰“å°1&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å…«deferä¸­çš„å‘&#34;&gt;å…«ã€deferä¸­çš„å‘ &lt;a href=&#34;#%e5%85%abdefer%e4%b8%ad%e7%9a%84%e5%9d%91&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;defer-nilå‡½æ•°&#34;&gt;defer nilå‡½æ•° &lt;a href=&#34;#defer-nil%e5%87%bd%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() = &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runs&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;runs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;panic&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;error&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;invalid&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;memory&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;address&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;or&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;pointer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dereference&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åä¸º func çš„å‡½æ•°ä¸€ç›´è¿è¡Œè‡³ç»“æŸï¼Œç„¶å defer å‡½æ•°ä¼šè¢«æ‰§è¡Œä¸”ä¼šå› ä¸ºå€¼ä¸º nil è€Œäº§ç”Ÿ panic å¼‚å¸¸ã€‚ç„¶è€Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œrun() çš„å£°æ˜æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºåœ¨å¤–å›´å‡½æ•°è¿è¡Œå®Œæˆåå®ƒæ‰ä¼šè¢«è°ƒç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¾ªç¯ä¸­ä½¿ç”¨defer&#34;&gt;å¾ªç¯ä¸­ä½¿ç”¨defer &lt;a href=&#34;#%e5%be%aa%e7%8e%af%e4%b8%ad%e4%bd%bf%e7%94%a8defer&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;æ…é‡åœ¨å¾ªç¯ä¸­ä½¿ç”¨defer&lt;/code&gt;ï¼Œå› ä¸ºç»“æœå‡ºäººæ„æ–™&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func demo(){
	for{
		row,err:=db.Query(&amp;#34;select .....&amp;#34;)
		if err!=nil{
			...
		}
		defer row.close()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œdefer row.Close() åœ¨å¾ªç¯ä¸­çš„å»¶è¿Ÿå‡½æ•°ä¼šåœ¨å‡½æ•°ç»“æŸè¿‡åè¿è¡Œï¼Œè€Œä¸æ˜¯æ¯æ¬¡ for å¾ªç¯ç»“æŸä¹‹åã€‚è¿™äº›å»¶è¿Ÿå‡½æ•°ä¼šä¸åœåœ°å †ç§¯åˆ°å»¶è¿Ÿè°ƒç”¨æ ˆä¸­ï¼Œæœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆ1ï¼šä¸ä½¿ç”¨defer&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;demo&lt;/span&gt;(){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;row&lt;/span&gt;,&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Query&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;select .....&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;row&lt;/span&gt;.close()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§£å†³æ–¹æ¡ˆ2ï¼šç§»äº¤ç»™å‡½æ•°
è¿™æ ·æ¯æ¬¡åŒ¿åå‡½æ•°æ‰§è¡Œå®Œï¼Œä¼šæ‰§è¡Œdefer&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;demo&lt;/span&gt;(){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;row&lt;/span&gt;,&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Query&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;select .....&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;row&lt;/span&gt;.close()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å»¶è¿Ÿè°ƒç”¨å«æœ‰é—­åŒ…çš„å‡½æ•°&#34;&gt;å»¶è¿Ÿè°ƒç”¨å«æœ‰é—­åŒ…çš„å‡½æ•° &lt;a href=&#34;#%e5%bb%b6%e8%bf%9f%e8%b0%83%e7%94%a8%e5%90%ab%e6%9c%89%e9%97%ad%e5%8c%85%e7%9a%84%e5%87%bd%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;database&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;database&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;connect&lt;/span&gt;() (&lt;span style=&#34;color:#a6e22e&#34;&gt;disconnect&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;connect&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;disconnect&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//è¿è¡Œ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;database&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;connect&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;query db...&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;query&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;connect&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€ç»ˆ disconnect å¹¶æ²¡æœ‰è¾“å‡ºï¼Œæœ€ååªæœ‰ connect ï¼Œè¿™æ˜¯ä¸€ä¸ª bugï¼Œæœ€ç»ˆçš„æƒ…å†µæ˜¯ connect() æ‰§è¡Œç»“æŸåï¼Œå…¶æ‰§è¡ŒåŸŸå¾—ä»¥è¢«ä¿å­˜èµ·æ¥ï¼Œä½†å†…éƒ¨çš„é—­åŒ…å¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;database&lt;/span&gt;{}  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;close&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;connect&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; close()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;query db...&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åœ¨æ‰§è¡Œå—ä¸­ä½¿ç”¨-defer&#34;&gt;åœ¨æ‰§è¡Œå—ä¸­ä½¿ç”¨ defer &lt;a href=&#34;#%e5%9c%a8%e6%89%a7%e8%a1%8c%e5%9d%97%e4%b8%ad%e4%bd%bf%e7%94%a8-defer&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æƒ³è¦åœ¨æ‰§è¡Œå—æ‰§è¡Œç»“æŸåæ‰§è¡Œåœ¨å—å†…å»¶è¿Ÿè°ƒç”¨çš„å‡½æ•°ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ï¼Œå®ƒä»¬åªä¼šåœ¨å—æ‰€å±çš„å‡½æ•°æ‰§è¡Œç»“æŸåæ‰è¢«æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µé€‚ç”¨äºæ‰€æœ‰çš„ä»£ç å—é™¤äº†ä¸Šæ–‡çš„å‡½æ•°å—ä¾‹å¦‚ï¼Œforï¼Œswitch ç­‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;block: defer runs&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;block: ends&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main: ends&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;block&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;ends&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;ends&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;block&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§£å†³æ–¹æ¡ˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;func: defer runs&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;func: ends&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main: ends&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>åŸºäºScratchåˆ›å»ºæœ€å°ä¸”å®‰å…¨çš„golang dockeré•œåƒ</title>
      <link>https://abnerxc.github.io/go/%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83/</link>
      <pubDate>Mon, 12 Sep 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83/</guid>
      <description>&lt;h1 id=&#34;golangæ‰“åŒ…é•œåƒå¯¹æ¯”&#34;&gt;golangæ‰“åŒ…é•œåƒå¯¹æ¯” &lt;a href=&#34;#golang%e6%89%93%e5%8c%85%e9%95%9c%e5%83%8f%e5%af%b9%e6%af%94&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»dockerå®˜æ–¹ä¸‹è½½äº†é•œåƒä»¥åï¼Œå‘ç°ä¸€ä¸ªè¿è¡Œgoçš„ç¯å¢ƒéœ€è¦779M,æˆ‘å¾—é¡¹ç›®æ‰3~4Mï¼Œè¿™æ˜¯ä¸å¯ä»¥æ¥å—çš„&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ docker image list
golang    latest       1c1309ff8e0d        10 days ago         779MB
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å°±ç®—ä½¿ç”¨alpineé•œåƒä¹Ÿæœ‰269M&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ docker image list
golang     alpine      bbab7aea1231        7 weeks ago         269MB
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;äºæ˜¯æ‰“ç®—è‡ªå·±æ„å»ºgolangè¿è¡Œçš„æœ€å°é•œåƒ.&lt;/p&gt;
&lt;h1 id=&#34;dockerçš„multi-stage-builds&#34;&gt;dockerçš„Multi-stage builds &lt;a href=&#34;#docker%e7%9a%84multi-stage-builds&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¤šé˜¶æ®µæ„å»ºæ˜¯éœ€è¦Docker 17.05æˆ–æ›´é«˜ç‰ˆæœ¬çš„æ–°åŠŸèƒ½ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°docker scratch imageï¼ŒZero Bytes Imageã€‚éå¸¸é€‚åˆåµŒå…¥æˆ‘ä»¬çš„é™æ€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆä¸Šä»£ç ,ä¾‹å­è¯´æ˜&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;FROM        golang:alpine AS builder
MAINTAINER  Chen Xu &amp;lt;abner510@126.com&amp;gt;
RUN         apk update &amp;amp;&amp;amp; apk add --no-cache git ca-certificates tzdata &amp;amp;&amp;amp; update-ca-certificates &amp;amp;&amp;amp; adduser -D -g &amp;#39;&amp;#39; appuser
ENV         GOPROXY https://mirrors.aliyun.com/goproxy/
ENV         GO111MODULE on
WORKDIR     /go/cache
ADD         go.mod .
ADD         go.sum .
RUN         go mod download
WORKDIR     /go/src/ginx
ADD        . /go/src/ginx
RUN         CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -installsuffix cgo -ldflags=&amp;#34;-w -s&amp;#34; -o server

#å®¹å™¨æ„å»º
FROM        scratch AS prod
COPY        --from=builder /etc/passwd /etc/passwd
COPY        --from=builder /usr/share/zoneinfo /usr/share/zoneinfo
COPY        --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/
COPY        --from=builder /go/src/ginx/config /app/config
COPY        --from=builder /go/src/ginx/server /app
USER        appuser
EXPOSE      9000
CMD         [&amp;#34;/app/server&amp;#34;, &amp;#34;-e=prod&amp;#34;]
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ä»£ç ç¤ºä¾‹è¯´æ˜&#34;&gt;ä»£ç ç¤ºä¾‹è¯´æ˜ &lt;a href=&#34;#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b%e8%af%b4%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;æ·»åŠ sslè¯ä¹¦æ”¯æŒhttpså’Œæ—¶åŒº&#34;&gt;æ·»åŠ SSLè¯ä¹¦æ”¯æŒHTTPSå’Œæ—¶åŒº &lt;a href=&#34;#%e6%b7%bb%e5%8a%a0ssl%e8%af%81%e4%b9%a6%e6%94%af%e6%8c%81https%e5%92%8c%e6%97%b6%e5%8c%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apk add --no-cache git ca-certificates tzdata &amp;amp;&amp;amp; update-ca-certificates
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;æ·»åŠ è¿è¡Œgolangçš„ç”¨æˆ·&#34;&gt;æ·»åŠ è¿è¡Œgolangçš„ç”¨æˆ· &lt;a href=&#34;#%e6%b7%bb%e5%8a%a0%e8%bf%90%e8%a1%8cgolang%e7%9a%84%e7%94%a8%e6%88%b7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;adduser -D -g &amp;#39;&amp;#39; appuser
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;go-modæ¨¡å¼é¡¹ç›®åŒ…ç®¡ç†åŠ å¿«æ„å»ºé€Ÿåº¦&#34;&gt;go modæ¨¡å¼é¡¹ç›®åŒ…ç®¡ç†ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦ &lt;a href=&#34;#go-mod%e6%a8%a1%e5%bc%8f%e9%a1%b9%e7%9b%ae%e5%8c%85%e7%ae%a1%e7%90%86%e5%8a%a0%e5%bf%ab%e6%9e%84%e5%bb%ba%e9%80%9f%e5%ba%a6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ENV         GOPROXY https://goproxy.io   #è®¾ç½®ä»£ç†ï¼Œå›½å†…çš„å¢™ä½ æ‡‚çš„
ENV         GO111MODULE on  #å¼€å¯go mod æ¨¡å¼  ï¼Œè€ç‰ˆæœ¬GO111MODULE=auto é»˜è®¤æ˜¯è‡ªåŠ¨
WORKDIR     /go/cache  # è®¾ç½®åŒ…çš„ä¸‹è½½ç›®å½•
ADD         go.mod .
ADD         go.sum .
RUN         go mod download
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-alilog.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;cgoç¼–è¯‘ä½¿ç”¨&#34;&gt;CGOç¼–è¯‘ä½¿ç”¨ &lt;a href=&#34;#cgo%e7%bc%96%e8%af%91%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ç”±äºscratchæ˜¯ç©ºé•œåƒï¼Œ&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -installsuffix cgo -ldflags=&amp;#34;-w -s&amp;#34; -o server
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CGO_ENABLED=0&lt;/code&gt; ï¼ŒCGO_ENABLED æ˜¯å› ä¸º äº¤å‰ç¼–è¯‘ä¸æ”¯æŒ CGOï¼Œæˆ‘ä»¬è¿™é‡Œç¦ç”¨å®ƒ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-a -installsuffix cgo&lt;/code&gt; , &lt;code&gt;-a&lt;/code&gt;:å¼ºåˆ¶é‡æ–°ç¼–è¯‘ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸åˆ©ç”¨ç¼“å­˜æˆ–å·²ç¼–è¯‘å¥½çš„éƒ¨åˆ†æ–‡ä»¶ï¼Œç›´æ¥æ‰€æœ‰åŒ…éƒ½æ˜¯æœ€æ–°çš„ä»£ç é‡æ–°ç¼–è¯‘å’Œå…³è”; &lt;code&gt;installsuffix&lt;/code&gt;:åœ¨è½¯ä»¶åŒ…å®‰è£…çš„ç›®å½•ä¸­å¢åŠ åç¼€æ ‡è¯†ï¼Œä»¥ä¿æŒè¾“å‡ºä¸é»˜è®¤ç‰ˆæœ¬åˆ†å¼€&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åˆ¶ä½œgolangè¿è¡Œçš„å®¹å™¨&#34;&gt;åˆ¶ä½œgolangè¿è¡Œçš„å®¹å™¨ &lt;a href=&#34;#%e5%88%b6%e4%bd%9cgolang%e8%bf%90%e8%a1%8c%e7%9a%84%e5%ae%b9%e5%99%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;FROM        scratch AS prod #é•œåƒç‰ˆæœ¬
COPY        --from=builder /etc/passwd /etc/passwd  #è¿™é‡Œéœ€è¦ä½¿ç”¨appuerè´¦å·ä¿¡æ¯
COPY        --from=builder /usr/share/zoneinfo /usr/share/zoneinfo #æ—¶åŒº
COPY        --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ #SSLè¯ä¹¦æ–‡ä»¶
COPY        --from=builder /go/src/ginx/config /app/config #åº”ç”¨é…ç½®æ–‡ä»¶
COPY        --from=builder /go/src/ginx/server /app #åº”ç”¨äºŒè¿›åˆ¶æ–‡ä»¶
USER        appuser #è¿è¡Œç”¨æˆ·
EXPOSE      9000 #æš´éœ²ç«¯å£
CMD         [&amp;#34;/app/server&amp;#34;, &amp;#34;-e=prod&amp;#34;] #è¿è¡Œåº”ç”¨ï¼Œä¼ å…¥è¿è¡Œå‚æ•°
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;é˜¿é‡Œäº‘åŠ é€Ÿç¿»å¢™é€Ÿåº¦&#34;&gt;é˜¿é‡Œäº‘åŠ é€Ÿç¿»å¢™é€Ÿåº¦ &lt;a href=&#34;#%e9%98%bf%e9%87%8c%e4%ba%91%e5%8a%a0%e9%80%9f%e7%bf%bb%e5%a2%99%e9%80%9f%e5%ba%a6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;1ã€åˆ›å»ºé•œåƒä»“åº“
&lt;img src=&#34;https://abnerxc.github.io/img/go-aliset1.jpeg&#34; alt=&#34;&#34;&gt;
2ã€é€‰æ‹©ä»“åº“&lt;code&gt;ç®¡ç†&lt;/code&gt;ï¼Œè¿›è¡Œé…ç½®ä»“åº“
3ã€é€‰æ‹©gitä»“åº“ç‰ˆæœ¬ï¼Œè¿™é‡Œæœ¬äººæ˜¯æ”¾åœ¨githubä¸Šï¼Œæ‰€ä»¥é€‰æ‹©githubï¼Œè¿›è¡Œæˆæƒï¼Œé€‰æ‹©è‡ªå·±çš„ä»“åº“å’Œé¡¹ç›®ï¼Œé…ç½®å¦‚ä¸‹å…·ä½“dockerfileæ–‡ä»¶æ ¹æ®è‡ªå·±ä»“åº“è·¯å¾„é…ç½®
&lt;img src=&#34;https://abnerxc.github.io/img/go-aliset2.jpeg&#34; alt=&#34;&#34;&gt;
4ã€é€‰æ‹©æ„å»ºå³å¯&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Dockeræ­å»ºå¯ä¸€é”®éƒ¨ç½²çš„å¤šåŸŸåLNMPç¯å¢ƒ</title>
      <link>https://abnerxc.github.io/tool/docker-%E6%90%AD%E5%BB%BA%E5%8F%AF%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E7%9A%84%E5%A4%9A%E5%9F%9F%E5%90%8Dlnmp%E7%8E%AF%E5%A2%83/</link>
      <pubDate>Thu, 21 Jul 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/tool/docker-%E6%90%AD%E5%BB%BA%E5%8F%AF%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E7%9A%84%E5%A4%9A%E5%9F%9F%E5%90%8Dlnmp%E7%8E%AF%E5%A2%83/</guid>
      <description>&lt;h1 id=&#34;dockeræ­å»ºå¯ä¸€é”®éƒ¨ç½²çš„å¤šåŸŸålnmpç¯å¢ƒ&#34;&gt;Dockeræ­å»ºå¯ä¸€é”®éƒ¨ç½²çš„å¤šåŸŸåLNMPç¯å¢ƒ &lt;a href=&#34;#docker%e6%90%ad%e5%bb%ba%e5%8f%af%e4%b8%80%e9%94%ae%e9%83%a8%e7%bd%b2%e7%9a%84%e5%a4%9a%e5%9f%9f%e5%90%8dlnmp%e7%8e%af%e5%a2%83&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ç‰¹ç‚¹&#34;&gt;ç‰¹ç‚¹ &lt;a href=&#34;#%e7%89%b9%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;å®Œå…¨å¼€æº&lt;/li&gt;
&lt;li&gt;æ”¯æŒå¤šç‰ˆæœ¬PHPåˆ‡æ¢ï¼ˆPHP5.4ã€PHP5.6ã€PHP7.2&amp;hellip;)&lt;/li&gt;
&lt;li&gt;æ”¯æŒç»‘å®šä»»æ„å¤šä¸ªåŸŸå&lt;/li&gt;
&lt;li&gt;æ”¯æŒHTTPSå’ŒHTTP/2&lt;/li&gt;
&lt;li&gt;PHPæºä»£ç ä½äºhostä¸­&lt;/li&gt;
&lt;li&gt;MySQL dataä½äºhostä¸­&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰é…ç½®æ–‡ä»¶å¯åœ¨hostä¸­ç›´æ¥ä¿®æ”¹&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰æ—¥å¿—æ–‡ä»¶å¯åœ¨hostä¸­ç›´æ¥æŸ¥çœ‹&lt;/li&gt;
&lt;li&gt;å†…ç½®å®Œæ•´PHPæ‰©å±•å®‰è£…å‘½ä»¤&lt;/li&gt;
&lt;li&gt;å®é™…ä½¿ç”¨ï¼Œç¡®ä¿100%å¯è¡Œ&lt;/li&gt;
&lt;li&gt;å®ç°ä¸€æ¬¡é…ç½®ï¼Œå¯åœ¨ä»»ä½•æ”¯æŒDockerç³»ç»Ÿä½¿ç”¨&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;å®‰è£…æ­¥éª¤&#34;&gt;å®‰è£…æ­¥éª¤ &lt;a href=&#34;#%e5%ae%89%e8%a3%85%e6%ad%a5%e9%aa%a4&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h2 id=&#34;dockerå®‰è£…&#34;&gt;dockerå®‰è£… &lt;a href=&#34;#docker%e5%ae%89%e8%a3%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;1--centos7å®‰è£…æ–¹æ³•&#34;&gt;1.  Centos7å®‰è£…æ–¹æ³• &lt;a href=&#34;#1--centos7%e5%ae%89%e8%a3%85%e6%96%b9%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo yum install -y yum-utils device-mapper-persistent-data lvm2
sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
sudo yum makecache fast
sudo yum -y install docker-ce
sudo service docker start
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;2--ubuntuå®‰è£…æ–¹æ³•&#34;&gt;2.  Ubuntuå®‰è£…æ–¹æ³• &lt;a href=&#34;#2--ubuntu%e5%ae%89%e8%a3%85%e6%96%b9%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt-get update
sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common
curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
sudo add-apt-repository &amp;#34;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&amp;#34;
sudo apt-get -y update
sudo apt-get -y install docker-ce
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;docker-composeå®‰è£…&#34;&gt;docker-composeå®‰è£… &lt;a href=&#34;#docker-compose%e5%ae%89%e8%a3%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo curl -L https://get.daocloud.io/docker/compose/releases/download/1.18.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æŸ¥çœ‹ç‰ˆæœ¬åŠ å…¥åˆ°dockerç»„&#34;&gt;æŸ¥çœ‹ç‰ˆæœ¬ï¼ŒåŠ å…¥åˆ°dockerç»„ &lt;a href=&#34;#%e6%9f%a5%e7%9c%8b%e7%89%88%e6%9c%ac%e5%8a%a0%e5%85%a5%e5%88%b0docker%e7%bb%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ docker -v
$ docker-compose -v
$ sudo gpasswd -a ${USER} docker     
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å°±ä¸ç”¨æ¯æ¬¡å¯åŠ¨Dockeréƒ½å¾—åŠ sudoäº†ï¼Œæ³¨æ„ï¼Œæ‰§è¡Œgpasswdå‘½ä»¤ä¹‹åè¦é‡æ–°ç™»é™†æ‰æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨å›½å†…é•œåƒä»“åº“&#34;&gt;ä½¿ç”¨å›½å†…é•œåƒä»“åº“ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e5%9b%bd%e5%86%85%e9%95%9c%e5%83%8f%e4%bb%93%e5%ba%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæ³¨å†Œä¸€ä¸ªé˜¿é‡Œäº‘è´¦å·ï¼Œç„¶åè®¿é—®é˜¿é‡Œäº‘çš„&lt;a href=&#34;https://cr.console.aliyun.com/&#34;&gt;Dockeré•œåƒä»“åº“&lt;/a&gt;ï¼Œèƒ½æ‰¾åˆ°åŠ é€Ÿå™¨åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºDocker 1.10+ï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶ /etc/docker/daemon.jsonï¼ˆæ²¡æœ‰æ—¶æ–°å»ºè¯¥æ–‡ä»¶ï¼‰ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo mkdir -p /etc/docker
echo &amp;#39;{ &amp;#34;registry-mirrors&amp;#34;: [&amp;#34;https://l714mp7z.mirror.aliyuncs.com&amp;#34;] }&amp;#39; &amp;gt;  /etc/docker/daemon.json
sudo systemctl daemon-reload
sudo systemctl restart docker
sudo systemctl enable docker

#å¼€æœºå¯åŠ¨centos7
systemctl enable docker
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Docker 1.10ä»¥ä¸‹è¯·çœ‹ï¼šhttps://yq.aliyun.com/articles/29941ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…å®¹å™¨å’Œé•œåƒ&#34;&gt;å®‰è£…å®¹å™¨å’Œé•œåƒ &lt;a href=&#34;#%e5%ae%89%e8%a3%85%e5%ae%b9%e5%99%a8%e5%92%8c%e9%95%9c%e5%83%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;docker-compose up -d
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å¦‚æœæ˜¯windowsä¸‹åŸºäºvirtualboxæŒ‚è½½ç›®å½•åˆ°linux&#34;&gt;å¦‚æœæ˜¯windowsä¸‹åŸºäºvirtualboxæŒ‚è½½ç›®å½•åˆ°linux &lt;a href=&#34;#%e5%a6%82%e6%9e%9c%e6%98%afwindows%e4%b8%8b%e5%9f%ba%e4%ba%8evirtualbox%e6%8c%82%e8%bd%bd%e7%9b%ae%e5%bd%95%e5%88%b0linux&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;å®‰è£…å¢å¼ºå·¥å…·centos7ç‰ˆæœ¬&#34;&gt;å®‰è£…å¢å¼ºå·¥å…·(centos7ç‰ˆæœ¬) &lt;a href=&#34;#%e5%ae%89%e8%a3%85%e5%a2%9e%e5%bc%ba%e5%b7%a5%e5%85%b7centos7%e7%89%88%e6%9c%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/docker-win-a.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;yum install -y gcc gcc-devel gcc-c++ gcc-c++-devel make kernel kernel-devel bzip2 vim wget  
sudo reboot  #é‡å¯
ln -s /usr/src/kernels/3.10.0ï¼ˆæ³¨æ„å†…æ ¸ç‰ˆæœ¬å·è‡ªåŠ¨è¡¥å…¨ï¼‰ /usr/src/linuxã€€   ## å¢åŠ è½¯è¿æ¥
#ç‚¹å‡»è™šæ‹Ÿæœºè®¾å¤‡-&amp;gt;å®‰è£…å¢å¼º
mount /dev/cdrom /mnt  #æŒ‚è½½å¢å¼ºå…‰ç›˜åˆ°ç³»ç»Ÿï¼Œæç¤ºåªè¯»ä¸ç”¨ç®¡
cd /mnt &amp;amp;&amp;amp;  ./VBoxLinuxAdditions.run
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;é…ç½®å…±äº«ç›®å½•&#34;&gt;é…ç½®å…±äº«ç›®å½• &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e5%85%b1%e4%ba%ab%e7%9b%ae%e5%bd%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/docker-win-b.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ‰‹åŠ¨æŒ‚è½½&#34;&gt;æ‰‹åŠ¨æŒ‚è½½ &lt;a href=&#34;#%e6%89%8b%e5%8a%a8%e6%8c%82%e8%bd%bd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;h4 id=&#34;ubuntu&#34;&gt;ubuntu &lt;a href=&#34;#ubuntu&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo mkdir /home/abner/server  &amp;amp;&amp;amp; chmod -R 777 /home/abner/server 
sudo mount -t vboxsf docker /home/abner/server   #æ‰‹åŠ¨æŒ‚è½½ ï¼ˆè¿™é‡ŒæŒ‚è½½çš„ç›®å½•æœ€å¥½ä¸è¦å’Œå…±äº«æ–‡ä»¶å¤¹åç§°ä¸€æ ·ï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;centos7&#34;&gt;centos7 &lt;a href=&#34;#centos7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo mkdir /root/server  &amp;amp;&amp;amp; chmod -R 777 /root/server 
sudo mount -t vboxsf docker /root/server
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;å¼€æœºè‡ªåŠ¨æŒ‚è½½&#34;&gt;å¼€æœºè‡ªåŠ¨æŒ‚è½½ &lt;a href=&#34;#%e5%bc%80%e6%9c%ba%e8%87%aa%e5%8a%a8%e6%8c%82%e8%bd%bd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;em&gt;&lt;strong&gt;&lt;code&gt;virboxè‡ªåŠ¨æŒ‚è½½ä¸èƒ½å‹¾é€‰&lt;/code&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;ubuntu-1&#34;&gt;ubuntu &lt;a href=&#34;#ubuntu-1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo vim /etc/rc.local
##exit 0 å‰å¢åŠ å¦‚ä¸‹å‘½ä»¤
sleep 1
sudo mount -t vboxsf docker /home/abner/server
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;centos7-1&#34;&gt;centos7 &lt;a href=&#34;#centos7-1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mkdir /root/server &amp;amp;&amp;amp; chmod -R 777 /root/server
mount -t vboxsf docker /root/server   #æ‰‹åŠ¨æŒ‚è½½
## æ­¤æ—¶å¦‚æœæç¤º/sbin/mount.vboxsf: mounting failed with the error: No such deviceï¼Œè¯´æ˜å†…æ ¸æ¨¡å—vboxsfæœªåŠ è½½ï¼Œå¯é€šè¿‡lsmod | grep vboxsfæŸ¥çœ‹ï¼ˆæ— ç»“æœè¯´æ˜æœªåŠ è½½ï¼‰ã€‚æ‰§è¡Œ `modprobe vboxsf` #åŠ è½½vboxsfæ¨¡å—
#è‡ªåŠ¨æŒ‚è½½
sudo vim /etc/fstab
docker /root/server   vboxsf rw,gid=100,uid=1000,auto 0 0
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;è‹¥èµ°çš„ç«¯å£è½¬å‘æŒ‰å›¾å¦‚ä¸‹é…ç½®&#34;&gt;è‹¥èµ°çš„ç«¯å£è½¬å‘æŒ‰å›¾å¦‚ä¸‹é…ç½® &lt;a href=&#34;#%e8%8b%a5%e8%b5%b0%e7%9a%84%e7%ab%af%e5%8f%a3%e8%bd%ac%e5%8f%91%e6%8c%89%e5%9b%be%e5%a6%82%e4%b8%8b%e9%85%8d%e7%bd%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/docker-win-c.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;è‹¥èµ°çš„æ¡¥æ¥ç½‘å¡æ­£å¸¸ipåœ°å€è¿æ¥å³å¯&#34;&gt;è‹¥èµ°çš„æ¡¥æ¥ç½‘å¡ï¼Œæ­£å¸¸IPåœ°å€è¿æ¥å³å¯ &lt;a href=&#34;#%e8%8b%a5%e8%b5%b0%e7%9a%84%e6%a1%a5%e6%8e%a5%e7%bd%91%e5%8d%a1%e6%ad%a3%e5%b8%b8ip%e5%9c%b0%e5%9d%80%e8%bf%9e%e6%8e%a5%e5%8d%b3%e5%8f%af&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;h1 id=&#34;ä»¥ä¸‹éƒ¨åˆ†å±äºæ‰©å±•&#34;&gt;ä»¥ä¸‹éƒ¨åˆ†å±äºæ‰©å±• &lt;a href=&#34;#%e4%bb%a5%e4%b8%8b%e9%83%a8%e5%88%86%e5%b1%9e%e4%ba%8e%e6%89%a9%e5%b1%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ç›®å½•è¯´æ˜&#34;&gt;ç›®å½•è¯´æ˜ &lt;a href=&#34;#%e7%9b%ae%e5%bd%95%e8%af%b4%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h4 id=&#34;å¤§è‡´æ¡†æ¶&#34;&gt;å¤§è‡´æ¡†æ¶ &lt;a href=&#34;#%e5%a4%a7%e8%87%b4%e6%a1%86%e6%9e%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/docker-win-d.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;ç›®å½•ç»“æ„&#34;&gt;ç›®å½•ç»“æ„ &lt;a href=&#34;#%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;â”œâ”€â”€ docker-compose.yml          å®¹å™¨å¯åŠ¨é…ç½®æ–‡ä»¶
â”œâ”€â”€ Dockerfile                  PHP-FPMæ„å»ºé…ç½®æ–‡ä»¶
â”œâ”€â”€ conf                        é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ mysql                   MySQLé…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”‚   â””â”€â”€ my.cnf              MySQLé…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ nginx                   Nginxé…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”‚   â”œâ”€â”€ conf.d              ç«™ç‚¹é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ certs           SSLè®¤è¯æ–‡ä»¶ã€å¯†é’¥å’ŒåŠ å¯†æ–‡ä»¶ç›®å½•
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ site2       ç«™ç‚¹2çš„è®¤è¯æ–‡ä»¶ç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ site1.conf      ç«™ç‚¹1 Nginxé…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ site2.conf      ç«™ç‚¹2 Nginxé…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ nginx.conf          Nginxé€šç”¨é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ php                     PHPé…ç½®ç›®å½•
â”‚       â”œâ”€â”€ php-fpm.d           PHP-FPMé…ç½®ç›®å½•
â”‚       â”‚   â””â”€â”€ www.conf        PHP-FPMé…ç½®æ–‡ä»¶
â”‚       â””â”€â”€ php.ini             PHPé…ç½®æ–‡ä»¶
â”œâ”€â”€ log                         æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ mysql                   MySQLæ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ nginx                   Nginxæ—¥å¿—ç›®å½•
â”‚   â””â”€â”€ php-fpm                 PHP-FPMæ—¥å¿—ç›®å½•
â”œâ”€â”€ mysql                       MySQLæ•°æ®æ–‡ä»¶ç›®å½•
â””â”€â”€ www                         ç«™ç‚¹æ ¹ç›®å½•
    â”œâ”€â”€ site1                   ç«™ç‚¹1æ ¹ç›®å½•
    â””â”€â”€ site2                   ç«™ç‚¹2æ ¹ç›®å½•
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;nginxé…ç½®&#34;&gt;nginxé…ç½® &lt;a href=&#34;#nginx%e9%85%8d%e7%bd%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;server {
    listen  80;
    server_name www.site1.com;
    root /var/www/html/site1;
    index index.shtml index.php index.html;
    location ~* \.(css|js)$ {
        sendfile  off;
        break;
    }
    expires off;
    client_max_body_size 2M;
    client_body_temp_path /var/www/html;

    location / {
            index index.shtml index.php index.html;
            if (!-e $request_filename){
                 rewrite ^/(.+)$ /index.php?_url=https://abnerxc.github.io/$1 last;
            }
    }

    location ~ ^/.+\.php(/|$) {
        fastcgi_pass [å®¹å™¨çš„ipæˆ–è€…åç§°]:9000;  
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_read_timeout 600; 
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;ç«™ç‚¹éƒ¨ç½²&#34;&gt;ç«™ç‚¹éƒ¨ç½² &lt;a href=&#34;#%e7%ab%99%e7%82%b9%e9%83%a8%e7%bd%b2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;æœ¬æ–‡æœ‰é»˜è®¤åŠ äº†ä¸¤ä¸ªç«™ç‚¹ï¼šwww.site1.comï¼ˆåŒlocalhostï¼‰å’Œwww.site2.comã€‚&lt;br&gt;
è¦åœ¨æœ¬åœ°è®¿é—®è¿™ä¸¤ä¸ªåŸŸåï¼Œéœ€è¦ä¿®æ”¹ä½ çš„hostsæ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ä¸¤è¡Œï¼š&lt;br&gt;
127.0.0.1 &lt;a href=&#34;https://www.site1.com&#34;&gt;www.site1.com&lt;/a&gt;&lt;br&gt;
127.0.0.1 &lt;a href=&#34;https://www.site2.com&#34;&gt;www.site2.com&lt;/a&gt;&lt;br&gt;
å…¶ä¸­ï¼Œwww.site2.comä¸ºæ”¯æŒSSL/httpså’ŒHTTP/2çš„ç¤ºä¾‹ç«™ç‚¹ã€‚&lt;br&gt;
å› ä¸ºç«™ç‚¹2çš„SSLé‡‡ç”¨è‡ªç­¾åæ–¹å¼ï¼Œæ‰€ä»¥æµè§ˆå™¨æœ‰å®‰å…¨æç¤ºï¼Œç»§ç»­è®¿é—®å°±å¯ä»¥äº†ï¼Œè‡ªå·±çš„ç«™ç‚¹ç”¨ç¬¬ä¸‰æ–¹SSLè®¤è¯è¯ä¹¦æ›¿æ¢å³å¯ã€‚&lt;br&gt;
å¦‚æœåªç”¨åˆ°ç«™ç‚¹1ï¼ŒæŠŠç«™ç‚¹2ç›¸å…³çš„ç›®å½•å’Œé…ç½®æ–‡ä»¶åˆ é™¤ï¼š&lt;br&gt;
./conf/nginx/conf.d/certs/site2/&lt;br&gt;
./conf/nginx/conf.d/site2.conf&lt;br&gt;
./www/site2/&lt;br&gt;
é‡å¯å®¹å™¨å†…çš„Nginxç”Ÿæ•ˆï¼š&lt;br&gt;
docker exec -it dlnmp_nginx_1 nginx -s reload&lt;/p&gt;
&lt;h4 id=&#34;httpsä½¿ç”¨&#34;&gt;HTTPSä½¿ç”¨ &lt;a href=&#34;#https%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;./conf/nginx/conf.d/site2.conf&lt;br&gt;
å¦‚æœæ˜¯è‡ªç­¾åï¼Œå¯ä»¥ç”¨å»–é›ªå³°æä¾›çš„ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆè®¤è¯æ–‡ä»¶ã€ç§é’¥è„šæœ¬ï¼šgencert.shï¼Œ
è¿™ä¸ªè„šæœ¬å·²ç»æ”¾åœ¨é¡¹ç›®ä¸­ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼š&lt;br&gt;
./conf/nginx/conf.d/certs/site2/&lt;br&gt;
åœ¨Bashä¸­è¾“å…¥ï¼š&lt;br&gt;
$ ./gencert.sh&lt;br&gt;
è¾“å…¥ä¸€æ¬¡åŸŸåï¼Œå’Œå‡ æ¬¡å¯†ç ï¼ˆå†…å®¹éšæ„ï¼‰åï¼Œå°±ä¼šç”Ÿæˆå‡ ä¸ªè®¤è¯æ–‡ä»¶ã€‚&lt;br&gt;
å…¶ä¸­è‡ªç­¾åæƒ…å†µä¸éœ€è¦.csrå’Œ.origin.keyåç¼€çš„æ–‡ä»¶ã€‚&lt;br&gt;
ç„¶åä¿®æ”¹Nginxé…ç½®æ–‡ä»¶ï¼Œé…ç½®SSLæ”¯æŒå°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;docker-composeymlæ–‡ä»¶&#34;&gt;docker-compose.ymlæ–‡ä»¶ &lt;a href=&#34;#docker-composeyml%e6%96%87%e4%bb%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;å¦‚ä¸‹æ˜¯dockerå®¹å™¨çš„è¿è¡Œé…ç½®docker-compose.ymlçš„å†…å®¹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;nginx:
  image: nginx:alpine
  ports:
    - &amp;#34;80:80&amp;#34;
    - &amp;#34;443:443&amp;#34;
  volumes:
    - ./www/:/var/www/html/:rw
    - ./conf/nginx/conf.d:/etc/nginx/conf.d/:ro
    - ./conf/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    - ./log/nginx/:/var/log/nginx/:rw
  links:
    - php-fpm:fpm

php-fpm:
  build: .
  expose:
    - &amp;#34;9000&amp;#34;
  volumes:
    - ./www/:/var/www/html/:rw
    - ./conf/php/php.ini:/usr/local/etc/php/php.ini:ro
    - ./conf/php/php-fpm.d/www.conf:/usr/local/etc/php-fpm.d/www.conf:rw
    - ./log/php-fpm/:/var/log/php-fpm/:rw
  links:
    - mysql:mysql
    - redis:redis

mysql:
  image: mysql:latest
  ports:
    - &amp;#34;3306:3306&amp;#34;
  volumes:
    - ./conf/mysql/my.cnf:/etc/mysql/my.cnf:ro
    - ./mysql/:/var/lib/mysql/:rw
    - ./log/mysql/:/var/log/mysql/:rw
  environment:
    MYSQL_ROOT_PASSWORD: &amp;#34;123456&amp;#34;

redis:
  image: redis:latest
  ports:
    - &amp;#34;6379:6379&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;ç«™ç‚¹æ ¹ç›®å½•å†™æƒé™&#34;&gt;ç«™ç‚¹æ ¹ç›®å½•å†™æƒé™ &lt;a href=&#34;#%e7%ab%99%e7%82%b9%e6%a0%b9%e7%9b%ae%e5%bd%95%e5%86%99%e6%9d%83%e9%99%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;é»˜è®¤çš„ï¼Œå®¹å™¨ä¸­çš„/var/www/htmlç›®å½•å±äºrootï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸ºwww-dataï¼ŒPHPæ‰èƒ½æ­£å¸¸å†™ç›®å½•ã€‚&lt;br&gt;
å…ˆè¿›å…¥åˆ°å®¹å™¨ä¸­ï¼š&lt;br&gt;
$ docker exec -it dlnmp_php-fpm_1 /bin/bash&lt;br&gt;
ç„¶åä¿®æ”¹ç›®å½•æƒé™ï¼š&lt;br&gt;
$ chown -R www-data:www-data /var/www/html&lt;/p&gt;
&lt;h4 id=&#34;mysqlè¿æ¥&#34;&gt;MYSQLè¿æ¥ &lt;a href=&#34;#mysql%e8%bf%9e%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;$ mysql -h 127.0.0.1 -u root -p
&lt;ul&gt;
&lt;li&gt;è¯´æ˜ï¼šè¿™é‡ŒMySQLçš„è¿æ¥ä¸»æœºä¸èƒ½ç”¨localhostï¼Œå› ä¸ºMySQLå®¢æˆ·ç«¯é»˜è®¤ä½¿ç”¨unix socketæ–¹å¼è¿æ¥ï¼Œåº”è¯¥ç›´æ¥ç”¨æœ¬åœ°IPã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;$pdo = new PDO(&amp;lsquo;mysql:host=mysql;dbname=site1&amp;rsquo;, &amp;lsquo;root&amp;rsquo;, &amp;lsquo;123456&amp;rsquo;);
&lt;ul&gt;
&lt;li&gt;è¯´æ˜ï¼šï¼Œhostçš„å€¼å°±æ˜¯åœ¨æŒ‡å®šçš„MySQLå®¹å™¨çš„åç§°ã€‚ redis,memcacedç­‰ç±»ä¼¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;ä¸€é”®å®‰è£…è„šæœ¬&#34;&gt;ä¸€é”®å®‰è£…è„šæœ¬ &lt;a href=&#34;#%e4%b8%80%e9%94%ae%e5%ae%89%e8%a3%85%e8%84%9a%e6%9c%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#!/bin/bash

function getVersionNum(){
    version=`cat /proc/version`
    cut=${version%%(*}
    dd=${cut:14}
}

function dockerAlis() {
    dps=&amp;#34;\$(docker ps -aq)&amp;#34;
    dcup=&amp;#34;ztth=&amp;#39;docker-compose -f /root/docker/ztth.yml up -d&amp;#39;&amp;#34;
    dcrs=&amp;#34;ztth-rs=&amp;#39;docker-compose -f /root/docker/ztth.yml restart&amp;#39;&amp;#34;
    dcrm=&amp;#34;ztth-rm=&amp;#39;docker-compose -f /root/docker/ztth.yml stop &amp;amp;&amp;amp; docker-compose -f /root/docker/ztth.yml rm&amp;#39;&amp;#34;
    dcps=&amp;#34;ztth-ps=&amp;#39;docker-compose -f /root/docker/ztth.yml ps&amp;#39;&amp;#34;
    dcip=&amp;#34;docker-ips=&amp;#39;docker inspect --format=&amp;#39;\&amp;#34;&amp;#39;\&amp;#34;&amp;#39;{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&amp;#39;\&amp;#34;&amp;#39;\&amp;#34;&amp;#39; $dps&amp;#39;&amp;#34;
}

function main(){
	while [ True ];do
		echo -e &amp;#34;\033[33m CentOs7 dockerå®‰è£…æ­¥éª¤: \033[0m&amp;#34;
		echo -e &amp;#34;\033[33m The #1 dockeræœåŠ¡å®‰è£… \033[0m&amp;#34;
		echo -e &amp;#34;\033[33m The #2 virtual boxæŒ‚è½½å®‰è£…ï¼Œè¯·ä¿è¯å®‰è£…å¢åŠ å·¥å…·å’ŒæŒ‚è½½ç›®å½•å·²ç»æ·»åŠ  \033[0m&amp;#34;
		echo -e &amp;#34;\033[33m qé”®é€€å‡º \033[0m&amp;#34;
		read -p &amp;#39;é€‰æ‹©å®‰è£…: &amp;#39; number
		case $number in
          1)
            echo -e &amp;#34;\033[31m docker install starting \033[0m&amp;#34; \
            &amp;amp;&amp;amp; yum install -y wget \
            &amp;amp;&amp;amp; mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup \
            &amp;amp;&amp;amp; wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo \
            &amp;amp;&amp;amp; yum install -y yum-utils \
            &amp;amp;&amp;amp; yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo \
            &amp;amp;&amp;amp; yum install -y gcc gcc-devel gcc-c++ gcc-c++-devel make kernel kernel-devel bzip2 vim wget device-mapper-persistent-data lvm2 docker-ce \
            &amp;amp;&amp;amp; yum makecache fast \
            &amp;amp;&amp;amp; service docker start \
            &amp;amp;&amp;amp; curl -L  https://ghproxy.com/https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose \
            &amp;amp;&amp;amp; chmod +x /usr/local/bin/docker-compose\
            &amp;amp;&amp;amp; gpasswd -a $USER docker \
            &amp;amp;&amp;amp; mkdir -p /etc/docker \
            &amp;amp;&amp;amp; echo &amp;#39;{&amp;#34;registry-mirrors&amp;#34;:[&amp;#34;https://l714mp7z.mirror.aliyuncs.com&amp;#34;]}&amp;#39;&amp;gt;&amp;gt; /etc/docker/daemon.json \
            &amp;amp;&amp;amp; systemctl daemon-reload \
            &amp;amp;&amp;amp; systemctl restart docker \
            &amp;amp;&amp;amp; systemctl enable docker \
            &amp;amp;&amp;amp; echo -e &amp;#34;\033[31m dockerå®‰è£…å®Œæˆï¼Œè¯·é‡å¯ç”µè„‘ï¼Œæ‰§è¡Œæ­¥éª¤2 \033[0m&amp;#34; &amp;amp;&amp;amp; exit
            ;;

          2)
            echo -e &amp;#34;\033[31m virtual boxå¢å¼ºå·¥å…· install starting \033[0m&amp;#34; \
            &amp;amp;&amp;amp; getVersionNum &amp;amp;&amp;amp; rm -rf /usr/src/linux &amp;amp;&amp;amp; ln -s /usr/src/kernels/$dd /usr/src/linux \
            &amp;amp;&amp;amp; mount /dev/cdrom /mnt \
            &amp;amp;&amp;amp; cd /mnt &amp;amp;&amp;amp;  ./VBoxLinuxAdditions.run \
            &amp;amp;&amp;amp; mkdir -p /root/docker  &amp;amp;&amp;amp; chmod -R 777 /root/docker \
            &amp;amp;&amp;amp; echo &amp;#39;docker /root/docker   vboxsf rw,gid=100,uid=1000,auto 0 0&amp;#39;&amp;gt;&amp;gt; /etc/fstab \
            &amp;amp;&amp;amp; dockerAlis \
            &amp;amp;&amp;amp; echo &amp;#34;alias $dcup&amp;#34;&amp;gt;&amp;gt; /root/.bashrc \
            &amp;amp;&amp;amp; echo &amp;#34;alias $dcrs&amp;#34;&amp;gt;&amp;gt; /root/.bashrc \
            &amp;amp;&amp;amp; echo &amp;#34;alias $dcrm&amp;#34;&amp;gt;&amp;gt; /root/.bashrc \
            &amp;amp;&amp;amp; echo &amp;#34;alias $dcps&amp;#34;&amp;gt;&amp;gt; /root/.bashrc \
            &amp;amp;&amp;amp; echo &amp;#34;alias $dcip&amp;#34;&amp;gt;&amp;gt; /root/.bashrc \
            &amp;amp;&amp;amp; source /root/.bashrc \
            &amp;amp;&amp;amp; echo -e &amp;#34;\033[31m è¯·æœåŠ¡å™¨é‡å¯ \033[0m&amp;#34;] &amp;amp;&amp;amp; exit
            ;;

		 &amp;#34;q&amp;#34;|&amp;#34;quit&amp;#34;)
            exit
            ;;

         *)
            echo &amp;#34;Input error!!&amp;#34;
             ;;

		esac
	done
}

main
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;å¸¸ç”¨æ“ä½œ&#34;&gt;å¸¸ç”¨æ“ä½œ &lt;a href=&#34;#%e5%b8%b8%e7%94%a8%e6%93%8d%e4%bd%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;åˆ«åé…ç½®&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;alias docker-ips=&amp;#39;docker inspect --format=&amp;#39;&amp;#34;&amp;#39;&amp;#34;&amp;#39;{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&amp;#39;&amp;#34;&amp;#39;&amp;#34;&amp;#39; $(docker ps -aq)&amp;#39;
alias ztth=&amp;#39;docker-compose --compatibility -f /root/docker/ztth.yml up -d&amp;#39;
alias ztth-rs=&amp;#39;docker-compose --compatibility -f /root/docker/ztth.yml restart&amp;#39;
alias ztth-rm=&amp;#39;docker-compose --compatibility -f /root/docker/ztth.yml down -v&amp;#39;
alias ztth-ps=&amp;#39;docker-compose --compatibility -f /root/docker/ztth.yml ps&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰¹é‡æ“ä½œ&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;æ‰¹é‡åˆ é™¤é•œåƒ
docker rmi -f $(docker images -aq)
æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨èµ„æº
docker system prune -a --volumes
åˆ é™¤æœªä½¿ç”¨é•œåƒ
docker image prune -a -f
åˆ é™¤æœªä½¿ç”¨å®¹å™¨
docker rm -vf $(docker ps -aq)
æ‰¹é‡åˆ é™¤å·
docker volume rm $(docker volume ls -qf dangling=true)
åˆ é™¤æ‰€æœ‰å…³é—­çš„å®¹å™¨
docker ps -a | grep Exit | cut -d &amp;#39; &amp;#39; -f 1 | xargs docker rm
åˆ é™¤æ‰€æœ‰danglingé•œåƒï¼ˆå³æ— tagçš„é•œåƒï¼‰
docker rmi $(docker images | grep &amp;#34;^&amp;lt;none&amp;gt;&amp;#34; | awk &amp;#34;{print $3}&amp;#34;)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è‡ªåŠ¨è„šæœ¬&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;æŒ‚è½½åˆ°ç›®å½•`/docker-entrypoint-initdb.d/`,é¦–æ¬¡åˆ›å»ºå®¹å™¨ä¼šæ‰§è¡Œï¼Œä½†æ˜¯å¤šè„šæœ¬å¿…é¡»æ˜¯`01\02\03\04\05`è¿™æ ·çš„é¡ºåºå¼€å¤´ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;docker pull docker.1ms.run/apache/rocketmq:5.3.2&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>gitå‘½ä»¤å¤§å…¨</title>
      <link>https://abnerxc.github.io/tool/git-%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/</link>
      <pubDate>Thu, 21 Jul 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/tool/git-%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/</guid>
      <description>&lt;h3 id=&#34;æŸ¥çœ‹æ·»åŠ æäº¤åˆ é™¤æ‰¾å›é‡ç½®ä¿®æ”¹æ–‡ä»¶&#34;&gt;æŸ¥çœ‹ã€æ·»åŠ ã€æäº¤ã€åˆ é™¤ã€æ‰¾å›ï¼Œé‡ç½®ä¿®æ”¹æ–‡ä»¶ &lt;a href=&#34;#%e6%9f%a5%e7%9c%8b%e6%b7%bb%e5%8a%a0%e6%8f%90%e4%ba%a4%e5%88%a0%e9%99%a4%e6%89%be%e5%9b%9e%e9%87%8d%e7%bd%ae%e4%bf%ae%e6%94%b9%e6%96%87%e4%bb%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git help &amp;lt;command&amp;gt; # æ˜¾ç¤ºcommandçš„help
git show # æ˜¾ç¤ºæŸæ¬¡æäº¤çš„å†…å®¹ git show $id
git checkout -- &amp;lt;file&amp;gt; # æŠ›å¼ƒå·¥ä½œåŒºä¿®æ”¹
git checkout . # æŠ›å¼ƒå·¥ä½œåŒºä¿®æ”¹
git add &amp;lt;file&amp;gt; # å°†å·¥ä½œæ–‡ä»¶ä¿®æ”¹æäº¤åˆ°æœ¬åœ°æš‚å­˜åŒº
git add . # å°†æ‰€æœ‰ä¿®æ”¹è¿‡çš„å·¥ä½œæ–‡ä»¶æäº¤æš‚å­˜åŒº
git rm &amp;lt;file&amp;gt; # ä»ç‰ˆæœ¬åº“ä¸­åˆ é™¤æ–‡ä»¶
git rm &amp;lt;file&amp;gt; --cached # ä»ç‰ˆæœ¬åº“ä¸­åˆ é™¤æ–‡ä»¶ï¼Œä½†ä¸åˆ é™¤æ–‡ä»¶
git reset &amp;lt;file&amp;gt; # ä»æš‚å­˜åŒºæ¢å¤åˆ°å·¥ä½œæ–‡ä»¶
git reset -- . # ä»æš‚å­˜åŒºæ¢å¤åˆ°å·¥ä½œæ–‡ä»¶
git reset --hard # æ¢å¤æœ€è¿‘ä¸€æ¬¡æäº¤è¿‡çš„çŠ¶æ€ï¼Œå³æ”¾å¼ƒä¸Šæ¬¡æäº¤åçš„æ‰€æœ‰æœ¬æ¬¡ä¿®æ”¹
git commit &amp;lt;file&amp;gt; 
git commit . 
git commit -a # å°†git add, git rmå’Œgit ciç­‰æ“ä½œéƒ½åˆå¹¶åœ¨ä¸€èµ·åšã€€ã€€
git commit -am &amp;#34;some comments&amp;#34;
git commit --amend # ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤è®°å½•
git revert &amp;lt;$id&amp;gt; # æ¢å¤æŸæ¬¡æäº¤çš„çŠ¶æ€ï¼Œæ¢å¤åŠ¨ä½œæœ¬èº«ä¹Ÿåˆ›å»ºæ¬¡æäº¤å¯¹è±¡
git revert HEAD # æ¢å¤æœ€åä¸€æ¬¡æäº¤çš„çŠ¶æ€
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;æŸ¥çœ‹æ–‡ä»¶diff&#34;&gt;æŸ¥çœ‹æ–‡ä»¶diff &lt;a href=&#34;#%e6%9f%a5%e7%9c%8b%e6%96%87%e4%bb%b6diff&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git diff &amp;lt;file&amp;gt; # æ¯”è¾ƒå½“å‰æ–‡ä»¶å’Œæš‚å­˜åŒºæ–‡ä»¶å·®å¼‚ git diff
git diff &amp;lt;id1&amp;gt;&amp;lt;id1&amp;gt;&amp;lt;id2&amp;gt; # æ¯”è¾ƒä¸¤æ¬¡æäº¤ä¹‹é—´çš„å·®å¼‚
git diff &amp;lt;branch1&amp;gt;..&amp;lt;branch2&amp;gt; # åœ¨ä¸¤ä¸ªåˆ†æ”¯ä¹‹é—´æ¯”è¾ƒ
git diff --staged # æ¯”è¾ƒæš‚å­˜åŒºå’Œç‰ˆæœ¬åº“å·®å¼‚
git diff --cached # æ¯”è¾ƒæš‚å­˜åŒºå’Œç‰ˆæœ¬åº“å·®å¼‚
git diff --stat # ä»…ä»…æ¯”è¾ƒç»Ÿè®¡ä¿¡æ¯
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;æŸ¥çœ‹æäº¤è®°å½•&#34;&gt;æŸ¥çœ‹æäº¤è®°å½• &lt;a href=&#34;#%e6%9f%a5%e7%9c%8b%e6%8f%90%e4%ba%a4%e8%ae%b0%e5%bd%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git log  # æŸ¥çœ‹åˆ†æ”¯çš„æäº¤è®°å½•
git log &amp;lt;file&amp;gt; # æŸ¥çœ‹è¯¥æ–‡ä»¶æ¯æ¬¡æäº¤è®°å½•
git log -p &amp;lt;file&amp;gt; # æŸ¥çœ‹æ¯æ¬¡è¯¦ç»†ä¿®æ”¹å†…å®¹çš„diff
git log -p -2 # æŸ¥çœ‹æœ€è¿‘ä¸¤æ¬¡è¯¦ç»†ä¿®æ”¹å†…å®¹çš„diff
git log --stat #æŸ¥çœ‹æäº¤ç»Ÿè®¡ä¿¡æ¯
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;æŸ¥çœ‹åˆ‡æ¢åˆ›å»ºå’Œåˆ é™¤åˆ†æ”¯&#34;&gt;æŸ¥çœ‹ã€åˆ‡æ¢ã€åˆ›å»ºå’Œåˆ é™¤åˆ†æ”¯ &lt;a href=&#34;#%e6%9f%a5%e7%9c%8b%e5%88%87%e6%8d%a2%e5%88%9b%e5%bb%ba%e5%92%8c%e5%88%a0%e9%99%a4%e5%88%86%e6%94%af&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git branch -r # æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯
git branch &amp;lt;new_branch&amp;gt; # åˆ›å»ºæ–°çš„åˆ†æ”¯
git branch -v # æŸ¥çœ‹å„ä¸ªåˆ†æ”¯æœ€åæäº¤ä¿¡æ¯
git branch --merged # æŸ¥çœ‹å·²ç»è¢«åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯
git branch --no-merged # æŸ¥çœ‹å°šæœªè¢«åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯
git checkout &amp;lt;branch&amp;gt; # åˆ‡æ¢åˆ°æŸä¸ªåˆ†æ”¯
git checkout -b &amp;lt;new_branch&amp;gt; # åˆ›å»ºæ–°çš„åˆ†æ”¯ï¼Œå¹¶ä¸”åˆ‡æ¢è¿‡å»
git checkout -b &amp;lt;new_branch&amp;gt; &amp;lt;branch&amp;gt; # åŸºäºbranchåˆ›å»ºæ–°çš„new_branch
git checkout $id # æŠŠæŸæ¬¡å†å²æäº¤è®°å½•checkoutå‡ºæ¥ï¼Œä½†æ— åˆ†æ”¯ä¿¡æ¯ï¼Œåˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯ä¼šè‡ªåŠ¨åˆ é™¤
git checkout $id -b &amp;lt;new_branch&amp;gt; # æŠŠæŸæ¬¡å†å²æäº¤è®°å½•checkoutå‡ºæ¥ï¼Œåˆ›å»ºæˆä¸€ä¸ªåˆ†æ”¯
git checkout develop --patch æ–‡ä»¶è·¯å¾„ #åˆå¹¶å•ä¸ªæ–‡ä»¶åˆ°å½“å‰åˆ†æ”¯
git branch -d &amp;lt;branch&amp;gt; # åˆ é™¤æŸä¸ªåˆ†æ”¯
git branch -D &amp;lt;branch&amp;gt; # å¼ºåˆ¶åˆ é™¤æŸä¸ªåˆ†æ”¯ (æœªè¢«åˆå¹¶çš„åˆ†æ”¯è¢«åˆ é™¤çš„æ—¶å€™éœ€è¦å¼ºåˆ¶)
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;åˆ†æ”¯åˆå¹¶å’Œrebase&#34;&gt;åˆ†æ”¯åˆå¹¶å’Œrebase &lt;a href=&#34;#%e5%88%86%e6%94%af%e5%90%88%e5%b9%b6%e5%92%8crebase&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;git merge &amp;lt;branch&amp;gt; # å°†branchåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯
git merge origin/master --no-ff # ä¸è¦Fast-Fowardåˆå¹¶ï¼Œè¿™æ ·å¯ä»¥ç”Ÿæˆmergeæäº¤
git rebase master &amp;lt;branch&amp;gt; # å°†master rebaseåˆ°branchï¼Œç›¸å½“äºï¼š git co &amp;lt;branch&amp;gt; &amp;amp;&amp;amp; git rebase master &amp;amp;&amp;amp; git co master &amp;amp;&amp;amp; git merge &amp;lt;branch&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;åŒæ­¥è¿œç¨‹åˆ†æ”¯ç›®å½•åˆ°æœ¬åœ°&#34;&gt;åŒæ­¥è¿œç¨‹åˆ†æ”¯ç›®å½•åˆ°æœ¬åœ° &lt;a href=&#34;#%e5%90%8c%e6%ad%a5%e8%bf%9c%e7%a8%8b%e5%88%86%e6%94%af%e7%9b%ae%e5%bd%95%e5%88%b0%e6%9c%ac%e5%9c%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;git remote update origin --prune
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;gitè¡¥ä¸ç®¡ç†æ–¹ä¾¿åœ¨å¤šå°æœºå™¨ä¸Šå¼€å‘åŒæ­¥æ—¶ç”¨&#34;&gt;Gitè¡¥ä¸ç®¡ç†(æ–¹ä¾¿åœ¨å¤šå°æœºå™¨ä¸Šå¼€å‘åŒæ­¥æ—¶ç”¨) &lt;a href=&#34;#git%e8%a1%a5%e4%b8%81%e7%ae%a1%e7%90%86%e6%96%b9%e4%be%bf%e5%9c%a8%e5%a4%9a%e5%8f%b0%e6%9c%ba%e5%99%a8%e4%b8%8a%e5%bc%80%e5%8f%91%e5%90%8c%e6%ad%a5%e6%97%b6%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;git diff &amp;gt; ../sync.patch # ç”Ÿæˆè¡¥ä¸
git apply ../sync.patch # æ‰“è¡¥ä¸
git apply --check ../sync.patch #æµ‹è¯•è¡¥ä¸èƒ½å¦æˆåŠŸ
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;gitæš‚å­˜ç®¡ç†&#34;&gt;Gitæš‚å­˜ç®¡ç† &lt;a href=&#34;#git%e6%9a%82%e5%ad%98%e7%ae%a1%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;git stash # æš‚å­˜
git stash list # åˆ—æ‰€æœ‰stash
git stash apply # æ¢å¤æš‚å­˜çš„å†…å®¹
git stash drop # åˆ é™¤æš‚å­˜åŒº
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;gitè¿œç¨‹åˆ†æ”¯ç®¡ç†&#34;&gt;Gitè¿œç¨‹åˆ†æ”¯ç®¡ç† &lt;a href=&#34;#git%e8%bf%9c%e7%a8%8b%e5%88%86%e6%94%af%e7%ae%a1%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;git pull # æŠ“å–è¿œç¨‹ä»“åº“æ‰€æœ‰åˆ†æ”¯æ›´æ–°å¹¶åˆå¹¶åˆ°æœ¬åœ°
git pull --no-ff # æŠ“å–è¿œç¨‹ä»“åº“æ‰€æœ‰åˆ†æ”¯æ›´æ–°å¹¶åˆå¹¶åˆ°æœ¬åœ°ï¼Œä¸è¦å¿«è¿›åˆå¹¶
git fetch origin # æŠ“å–è¿œç¨‹ä»“åº“æ›´æ–°
git merge origin/master # å°†è¿œç¨‹ä¸»åˆ†æ”¯åˆå¹¶åˆ°æœ¬åœ°å½“å‰åˆ†æ”¯
git checkout --track origin/branch # è·Ÿè¸ªæŸä¸ªè¿œç¨‹åˆ†æ”¯åˆ›å»ºç›¸åº”çš„æœ¬åœ°åˆ†æ”¯
git checkout -b &amp;lt;local_branch&amp;gt; origin/&amp;lt;remote_branch&amp;gt; # åŸºäºè¿œç¨‹åˆ†æ”¯åˆ›å»ºæœ¬åœ°åˆ†æ”¯ï¼ŒåŠŸèƒ½åŒä¸Š
git push # pushæ‰€æœ‰åˆ†æ”¯
git push origin master # å°†æœ¬åœ°ä¸»åˆ†æ”¯æ¨åˆ°è¿œç¨‹ä¸»åˆ†æ”¯
git push -u origin master # å°†æœ¬åœ°ä¸»åˆ†æ”¯æ¨åˆ°è¿œç¨‹(å¦‚æ— è¿œç¨‹ä¸»åˆ†æ”¯åˆ™åˆ›å»ºï¼Œç”¨äºåˆå§‹åŒ–è¿œç¨‹ä»“åº“)
git push origin &amp;lt;local_branch&amp;gt; # åˆ›å»ºè¿œç¨‹åˆ†æ”¯ï¼Œ originæ˜¯è¿œç¨‹ä»“åº“å
git push origin &amp;lt;local_branch&amp;gt;:&amp;lt;remote_branch&amp;gt; # åˆ›å»ºè¿œç¨‹åˆ†æ”¯
git push origin :&amp;lt;remote_branch&amp;gt; #å…ˆåˆ é™¤æœ¬åœ°åˆ†æ”¯(git br -d &amp;lt;branch&amp;gt;)ï¼Œç„¶åå†pushåˆ é™¤è¿œç¨‹åˆ†æ”¯
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;gitè¿œç¨‹ä»“åº“ç®¡ç†&#34;&gt;Gitè¿œç¨‹ä»“åº“ç®¡ç† &lt;a href=&#34;#git%e8%bf%9c%e7%a8%8b%e4%bb%93%e5%ba%93%e7%ae%a1%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;git remote -v # æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨åœ°å€å’Œä»“åº“åç§°
git remote show origin # æŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨ä»“åº“çŠ¶æ€
git remote add origin git@ github:robbin/robbin_site.git # æ·»åŠ è¿œç¨‹ä»“åº“åœ°å€
git remote set-url origin git@ github.com:robbin/robbin_site.git # è®¾ç½®è¿œç¨‹ä»“åº“åœ°å€(ç”¨äºä¿®æ”¹è¿œç¨‹ä»“åº“åœ°å€) git remote rm &amp;lt;repository&amp;gt; # åˆ é™¤è¿œç¨‹ä»“åº“
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;åˆ›å»ºè¿œç¨‹ä»“åº“&#34;&gt;åˆ›å»ºè¿œç¨‹ä»“åº“ &lt;a href=&#34;#%e5%88%9b%e5%bb%ba%e8%bf%9c%e7%a8%8b%e4%bb%93%e5%ba%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;git clone --bare robbin_site robbin_site.git # ç”¨å¸¦ç‰ˆæœ¬çš„é¡¹ç›®åˆ›å»ºçº¯ç‰ˆæœ¬ä»“åº“
scp -r my_project.git git@ git.csdn.net:~ # å°†çº¯ä»“åº“ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š
mkdir robbin_site.git &amp;amp;&amp;amp; cd robbin_site.git &amp;amp;&amp;amp; git --bare init # åœ¨æœåŠ¡å™¨åˆ›å»ºçº¯ä»“åº“

git remote add origin git@ github.com:robbin/robbin_site.git # è®¾ç½®è¿œç¨‹ä»“åº“åœ°å€
git push -u origin master # å®¢æˆ·ç«¯é¦–æ¬¡æäº¤
git push -u origin develop # é¦–æ¬¡å°†æœ¬åœ°developåˆ†æ”¯æäº¤åˆ°è¿œç¨‹developåˆ†æ”¯ï¼Œå¹¶ä¸”track
git remote set-head origin master # è®¾ç½®è¿œç¨‹ä»“åº“çš„HEADæŒ‡å‘masteråˆ†æ”¯
ä¹Ÿå¯ä»¥å‘½ä»¤è®¾ç½®è·Ÿè¸ªè¿œç¨‹åº“å’Œæœ¬åœ°åº“

git branch --set-upstream master origin/master
git branch --set-upstream develop origin/develop
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;git-init&#34;&gt;git init &lt;a href=&#34;#git-init&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;åœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªrepo,è¿›å…¥ä¸€ä¸ªé¡¹ç›®ç›®å½•,æ‰§è¡Œgit init,ä¼šåˆå§‹åŒ–ä¸€ä¸ªrepo,å¹¶åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ª.gitæ–‡ä»¶å¤¹.&lt;/p&gt;
&lt;h3 id=&#34;git-clone&#34;&gt;git clone &lt;a href=&#34;#git-clone&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;è·å–ä¸€ä¸ªurlå¯¹åº”çš„è¿œç¨‹Git repo, åˆ›å»ºä¸€ä¸ªlocal copy.
ä¸€èˆ¬çš„æ ¼å¼æ˜¯git clone [url].
cloneä¸‹æ¥çš„repoä¼šä»¥urlæœ€åä¸€ä¸ªæ–œçº¿åé¢çš„åç§°å‘½å,åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹,å¦‚æœæƒ³è¦æŒ‡å®šç‰¹å®šçš„åç§°,å¯ä»¥git clone [url] newnameæŒ‡å®š.&lt;/p&gt;
&lt;h3 id=&#34;git-status&#34;&gt;git status &lt;a href=&#34;#git-status&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;æŸ¥è¯¢repoçš„çŠ¶æ€.
git status -s: -sè¡¨ç¤ºshort, -sçš„è¾“å‡ºæ ‡è®°ä¼šæœ‰ä¸¤åˆ—,ç¬¬ä¸€åˆ—æ˜¯å¯¹stagingåŒºåŸŸè€Œè¨€,ç¬¬äºŒåˆ—æ˜¯å¯¹workingç›®å½•è€Œè¨€.&lt;/p&gt;
&lt;h3 id=&#34;git-log&#34;&gt;git log &lt;a href=&#34;#git-log&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;åœ¨å½“å‰åˆ†æ”¯ä¸ŠæŸ¥çœ‹æäº¤æ—¥å¿—
git log --oneline --number: æ¯æ¡logåªæ˜¾ç¤ºä¸€è¡Œ,æ˜¾ç¤ºnumberæ¡.
git log --oneline --graph:å¯ä»¥å›¾å½¢åŒ–åœ°è¡¨ç¤ºå‡ºåˆ†æ”¯åˆå¹¶å†å².
git log branchnameå¯ä»¥æ˜¾ç¤ºç‰¹å®šåˆ†æ”¯çš„log.
git log --oneline branch1 ^branch2,å¯ä»¥æŸ¥çœ‹åœ¨åˆ†æ”¯1,å´ä¸åœ¨åˆ†æ”¯2ä¸­çš„æäº¤.^è¡¨ç¤ºæ’é™¤è¿™ä¸ªåˆ†æ”¯(Windowä¸‹å¯èƒ½è¦ç»™^branch2åŠ ä¸Šå¼•å·).
git log --decorateä¼šæ˜¾ç¤ºå‡ºtagä¿¡æ¯.
git log --author=[author name] å¯ä»¥æŒ‡å®šä½œè€…çš„æäº¤å†å².
git log --since --before --until --after æ ¹æ®æäº¤æ—¶é—´ç­›é€‰log.
--no-mergeså¯ä»¥å°†mergeçš„commitsæ’é™¤åœ¨å¤–.
git log --grep æ ¹æ®commitä¿¡æ¯è¿‡æ»¤log: git log --grep=keywords
é»˜è®¤æƒ…å†µä¸‹, git log --grep --authoræ˜¯ORçš„å…³ç³»,å³æ»¡è¶³ä¸€æ¡å³è¢«è¿”å›,å¦‚æœä½ æƒ³è®©å®ƒä»¬æ˜¯ANDçš„å…³ç³»,å¯ä»¥åŠ ä¸Š--all-matchçš„option.
git log -S: filter by introduced diff.
æ¯”å¦‚: git log -SmethodName (æ³¨æ„Så’Œåé¢çš„è¯ä¹‹é—´æ²¡æœ‰ç­‰å·åˆ†éš”).
git log -p: show patch introduced at each commit.
æ¯ä¸€ä¸ªæäº¤éƒ½æ˜¯ä¸€ä¸ªå¿«ç…§(snapshot),Gitä¼šæŠŠæ¯æ¬¡æäº¤çš„diffè®¡ç®—å‡ºæ¥,ä½œä¸ºä¸€ä¸ªpatchæ˜¾ç¤ºç»™ä½ çœ‹.
å¦ä¸€ç§æ–¹æ³•æ˜¯git show [SHA].
git log --stat: show diffstat of changes introduced at each commit.
åŒæ ·æ˜¯ç”¨æ¥çœ‹æ”¹åŠ¨çš„ç›¸å¯¹ä¿¡æ¯çš„,--statæ¯”-pçš„è¾“å‡ºæ›´ç®€å•ä¸€äº›.
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;git-commit&#34;&gt;git commit &lt;a href=&#34;#git-commit&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;æäº¤å·²ç»è¢«addè¿›æ¥çš„æ”¹åŠ¨.
git commit -m â€œthe commit message&amp;#34;
git commit -a ä¼šå…ˆæŠŠæ‰€æœ‰å·²ç»trackçš„æ–‡ä»¶çš„æ”¹åŠ¨addè¿›æ¥,ç„¶åæäº¤(æœ‰ç‚¹åƒsvnçš„ä¸€æ¬¡æäº¤,ä¸ç”¨å…ˆæš‚å­˜). å¯¹äºæ²¡æœ‰trackçš„æ–‡ä»¶,è¿˜æ˜¯éœ€è¦git addä¸€ä¸‹.
git commit --amend å¢è¡¥æäº¤. ä¼šä½¿ç”¨ä¸å½“å‰æäº¤èŠ‚ç‚¹ç›¸åŒçš„çˆ¶èŠ‚ç‚¹è¿›è¡Œä¸€æ¬¡æ–°çš„æäº¤,æ—§çš„æäº¤å°†ä¼šè¢«å–æ¶ˆ.
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;git-reset&#34;&gt;git reset &lt;a href=&#34;#git-reset&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;undo changes and commits.
è¿™é‡Œçš„HEADå…³é”®å­—æŒ‡çš„æ˜¯å½“å‰åˆ†æ”¯æœ€æœ«æ¢¢æœ€æ–°çš„ä¸€ä¸ªæäº¤.ä¹Ÿå°±æ˜¯ç‰ˆæœ¬åº“ä¸­è¯¥åˆ†æ”¯ä¸Šçš„æœ€æ–°ç‰ˆæœ¬.
git reset HEAD: unstage files from index and reset pointer to HEAD
è¿™ä¸ªå‘½ä»¤ç”¨æ¥æŠŠä¸å°å¿ƒaddè¿›å»çš„æ–‡ä»¶ä»stagedçŠ¶æ€å–å‡ºæ¥,å¯ä»¥å•ç‹¬é’ˆå¯¹æŸä¸€ä¸ªæ–‡ä»¶æ“ä½œ: git reset HEAD - - filename, è¿™ä¸ª- - ä¹Ÿå¯ä»¥ä¸åŠ .
git reset --soft
move HEAD to specific commit reference, index and staging are untouched.
git reset --hard
unstage files AND undo any changes in the working directory since last commit.
ä½¿ç”¨git reset â€”hard HEADè¿›è¡Œreset,å³ä¸Šæ¬¡æäº¤ä¹‹å,æ‰€æœ‰stagedçš„æ”¹åŠ¨å’Œå·¥ä½œç›®å½•çš„æ”¹åŠ¨éƒ½ä¼šæ¶ˆå¤±,è¿˜åŸåˆ°ä¸Šæ¬¡æäº¤çš„çŠ¶æ€.
è¿™é‡Œçš„HEADå¯ä»¥è¢«å†™æˆä»»ä½•ä¸€æ¬¡æäº¤çš„SHA-1.
ä¸å¸¦softå’Œhardå‚æ•°çš„git reset,å®é™…ä¸Šå¸¦çš„æ˜¯é»˜è®¤å‚æ•°mixed.

æ€»ç»“:
git reset --mixed id,æ˜¯å°†gitçš„HEADå˜äº†(ä¹Ÿå°±æ˜¯æäº¤è®°å½•å˜äº†),ä½†æ–‡ä»¶å¹¶æ²¡æœ‰æ”¹å˜ï¼Œ(ä¹Ÿå°±æ˜¯working treeå¹¶æ²¡æœ‰æ”¹å˜). å–æ¶ˆäº†commitå’Œaddçš„å†…å®¹.
git reset --soft id. å®é™…ä¸Šï¼Œæ˜¯git reset â€“mixed id å,åˆåšäº†ä¸€æ¬¡git add.å³å–æ¶ˆäº†commitçš„å†…å®¹.
git reset --hard id.æ˜¯å°†gitçš„HEADå˜äº†,æ–‡ä»¶ä¹Ÿå˜äº†.
æŒ‰æ”¹åŠ¨èŒƒå›´æ’åºå¦‚ä¸‹:
soft (commit) &amp;lt; mixed (commit + add) &amp;lt; hard (commit + add + local working)
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;git-revert&#34;&gt;git revert &lt;a href=&#34;#git-revert&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;åè½¬æ’¤é”€æäº¤.åªè¦æŠŠå‡ºé”™çš„æäº¤(commit)çš„åå­—(reference)ä½œä¸ºå‚æ•°ä¼ ç»™å‘½ä»¤å°±å¯ä»¥äº†.
git revert HEAD: æ’¤é”€æœ€è¿‘çš„ä¸€ä¸ªæäº¤.
git revertä¼šåˆ›å»ºä¸€ä¸ªåå‘çš„æ–°æäº¤,å¯ä»¥é€šè¿‡å‚æ•°-næ¥å‘Šè¯‰Gitå…ˆä¸è¦æäº¤.
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;git-rm&#34;&gt;git rm &lt;a href=&#34;#git-rm&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;git rm file: ä»stagingåŒºç§»é™¤æ–‡ä»¶,åŒæ—¶ä¹Ÿç§»é™¤å‡ºå·¥ä½œç›®å½•.
git rm --cached: ä»stagingåŒºç§»é™¤æ–‡ä»¶,ä½†ç•™åœ¨å·¥ä½œç›®å½•ä¸­.
git rm --cachedä»åŠŸèƒ½ä¸Šç­‰åŒäºgit reset HEAD,æ¸…é™¤äº†ç¼“å­˜åŒº,ä½†ä¸åŠ¨å·¥ä½œç›®å½•æ ‘.
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;git-clean&#34;&gt;git clean &lt;a href=&#34;#git-clean&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;git cleanæ˜¯ä»å·¥ä½œç›®å½•ä¸­ç§»é™¤æ²¡æœ‰trackçš„æ–‡ä»¶.
é€šå¸¸çš„å‚æ•°æ˜¯git clean -df:
-dè¡¨ç¤ºåŒæ—¶ç§»é™¤ç›®å½•,-fè¡¨ç¤ºforce,å› ä¸ºåœ¨gitçš„é…ç½®æ–‡ä»¶ä¸­, clean.requireForce=true,å¦‚æœä¸åŠ -f,cleanå°†ä¼šæ‹’ç»æ‰§è¡Œ.
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;git-rebase&#34;&gt;git rebase &lt;a href=&#34;#git-rebase&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;--rebaseä¸ä¼šäº§ç”Ÿåˆå¹¶çš„æäº¤,å®ƒä¼šå°†æœ¬åœ°çš„æ‰€æœ‰æäº¤ä¸´æ—¶ä¿å­˜ä¸ºè¡¥ä¸(patch),æ”¾åœ¨â€.git/rebaseâ€ç›®å½•ä¸­,ç„¶åå°†å½“å‰åˆ†æ”¯æ›´æ–°åˆ°æœ€æ–°çš„åˆ†æ”¯å°–ç«¯,æœ€åæŠŠä¿å­˜çš„è¡¥ä¸åº”ç”¨åˆ°åˆ†æ”¯ä¸Š.
rebaseçš„è¿‡ç¨‹ä¸­,ä¹Ÿè®¸ä¼šå‡ºç°å†²çª,Gitä¼šåœæ­¢rebaseå¹¶è®©ä½ è§£å†³å†²çª,åœ¨è§£å†³å®Œå†²çªä¹‹å,ç”¨git addå»æ›´æ–°è¿™äº›å†…å®¹,ç„¶åæ— éœ€æ‰§è¡Œcommit,åªéœ€è¦:
git rebase --continueå°±ä¼šç»§ç»­æ‰“ä½™ä¸‹çš„è¡¥ä¸.
git rebase --abortå°†ä¼šç»ˆæ­¢rebase,å½“å‰åˆ†æ”¯å°†ä¼šå›åˆ°rebaseä¹‹å‰çš„çŠ¶æ€.
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;git-reflog&#34;&gt;git reflog &lt;a href=&#34;#git-reflog&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;git reflogæ˜¯å¯¹reflogè¿›è¡Œç®¡ç†çš„å‘½ä»¤,reflogæ˜¯gitç”¨æ¥è®°å½•å¼•ç”¨å˜åŒ–çš„ä¸€ç§æœºåˆ¶,æ¯”å¦‚è®°å½•åˆ†æ”¯çš„å˜åŒ–æˆ–è€…æ˜¯HEADå¼•ç”¨çš„å˜åŒ–.
å½“git reflogä¸æŒ‡å®šå¼•ç”¨çš„æ—¶å€™,é»˜è®¤åˆ—å‡ºHEADçš„reflog.
HEAD@{0}ä»£è¡¨HEADå½“å‰çš„å€¼,HEAD@{3}ä»£è¡¨HEADåœ¨3æ¬¡å˜åŒ–ä¹‹å‰çš„å€¼.
gitä¼šå°†å˜åŒ–è®°å½•åˆ°HEADå¯¹åº”çš„reflogæ–‡ä»¶ä¸­,å…¶è·¯å¾„ä¸º.git/logs/HEAD, åˆ†æ”¯çš„reflogæ–‡ä»¶éƒ½æ”¾åœ¨.git/logs/refsç›®å½•ä¸‹çš„å­ç›®å½•ä¸­.&lt;/p&gt;
&lt;h3 id=&#34;cherry-pick&#34;&gt;cherry-pick &lt;a href=&#34;#cherry-pick&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;å®ƒä¼šè·å–æŸä¸€ä¸ªåˆ†æ”¯çš„å•ç¬”æäº¤ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªæ–°çš„æäº¤å¼•å…¥åˆ°ä½ å½“å‰åˆ†æ”¯ä¸Š
git cherry-pick [&lt;options&gt;] &lt;commit-ish&gt;&amp;hellip;
å¸¸ç”¨options:
&amp;ndash;quit                é€€å‡ºå½“å‰çš„chery-pickåºåˆ—
&amp;ndash;continue            ç»§ç»­å½“å‰çš„chery-pickåºåˆ—
&amp;ndash;abort               å–æ¶ˆå½“å‰çš„chery-pickåºåˆ—ï¼Œæ¢å¤å½“å‰åˆ†æ”¯
-n, &amp;ndash;no-commit       ä¸è‡ªåŠ¨æäº¤
-e, &amp;ndash;edit            ç¼–è¾‘æäº¤ä¿¡æ¯&lt;/p&gt;
&lt;h3 id=&#34;git-ä»£ç†è®¾ç½®&#34;&gt;git ä»£ç†è®¾ç½® &lt;a href=&#34;#git-%e4%bb%a3%e7%90%86%e8%ae%be%e7%bd%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;http&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git config --global http.proxy &amp;#34;socks5://127.0.0.1:1086&amp;#34;
git config --global https.proxy &amp;#34;socks5://127.0.0.1:1086&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;ssh æ–¹å¼
åœ¨ç”¨æˆ·æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰“å¼€/.ssh/configæ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰å°±è‡ªå·±åˆ›å»ºä¸€ä¸ªtouch ~/.ssh/configï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Host github.com
	Port 443
	Hostname ssh.github.com
	IdentityFile /Users/abner/.ssh/id_rsa
	TCPKeepAlive yes
	ProxyCommand nc -X 5 -x 127.0.0.1:1086 %h %p
	ServerAliveInterval 30
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;gitä½¿ç”¨å¯¹æ¯”å·¥å…·&#34;&gt;gitä½¿ç”¨å¯¹æ¯”å·¥å…· &lt;a href=&#34;#git%e4%bd%bf%e7%94%a8%e5%af%b9%e6%af%94%e5%b7%a5%e5%85%b7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;.gitconfig æ·»åŠ  å¦‚ä¸‹é…ç½®&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[diff]
    tool = bcomp
[difftool]
    prompt = false
[difftool &amp;#34;bcomp&amp;#34;]
    trustExitCode = true
    cmd = &amp;#34;/usr/local/bin/bcomp&amp;#34; &amp;#34;$LOCAL&amp;#34; &amp;#34;$REMOTE&amp;#34;
[merge]
    tool = bcomp
[mergetool]
    prompt = false
    keepBackup = false
[mergetool &amp;#34;bcomp&amp;#34;]
    trustExitCode = true
    cmd = &amp;#34;/usr/local/bin/bcomp&amp;#34; &amp;#34;$LOCAL&amp;#34; &amp;#34;$REMOTE&amp;#34; &amp;#34;$BASE&amp;#34; &amp;#34;$MERGED&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;windows-crlf&#34;&gt;windows CRLF &lt;a href=&#34;#windows-crlf&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cgo&#34; data-lang=&#34;cgo&#34;&gt;#æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶è½¬æ¢ä¸ºCRLF
git config --global core.autocrlf true
é€‚ç”¨äºWindowsç³»ç»Ÿï¼Œä¸”ä¸€èˆ¬ä¸ºWindowsé»˜è®¤è®¾ç½®ï¼Œä¼šåœ¨æäº¤æ—¶å¯¹æ¢è¡Œç¬¦è¿›è¡ŒCRLF - LFçš„è½¬æ¢ï¼Œæ£€å‡ºæ—¶åˆä¼šè¿›è¡ŒLF - CRLFçš„è½¬æ¢ã€‚

#æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢
git config --global core.autocrlf input
é€‚ç”¨äºLinuxç³»ç»Ÿï¼Œæ‰€æœ‰æ¢è¡Œç¬¦éƒ½ä¼šè¿›è¡ŒCRLF - LFè½¬æ¢ï¼Œä½†æ“ä½œæ—¶ä¸ä¼šè½¬æ¢å›CRLFã€‚

#æäº¤æ£€å‡ºå‡ä¸è½¬æ¢
git config --global core.autocrlf false
*é€‚ç”¨äºWindowsç³»ç»Ÿï¼Œä¸”åªåœ¨Windowsä¸Šå¼€å‘çš„æƒ…å†µã€‚åœ¨æäº¤ã€æ£€å‡ºæ—¶ä¸ä¼šå¯¹CRLF/LFæ¢è¡Œç¬¦è¿›è¡Œè½¬æ¢
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Go-é”™è¯¯(error)å¤„ç†æ–¹æ¡ˆ</title>
      <link>https://abnerxc.github.io/go/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88/</link>
      <pubDate>Thu, 21 Jul 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88/</guid>
      <description>&lt;h1 id=&#34;erroræ¥å£&#34;&gt;erroræ¥å£ &lt;a href=&#34;#error%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;code&gt;error&lt;/code&gt;å…¶å®æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå†…ç½®çš„ï¼Œçœ‹ä¸‹ä»–çš„å®šä¹‰&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// The error built-in interface type is the conventional interface for
// representing an error condition, with the nil value representing no error.
type error interface {
	Error() string
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å®ƒåªæœ‰ä¸€ä¸ªæ–¹æ³• &lt;code&gt;Error&lt;/code&gt;ï¼Œåªè¦å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯å®ç°äº†&lt;code&gt;error&lt;/code&gt;ã€‚ç°åœ¨æˆ‘ä»¬è‡ªå·±å®šä¹‰ä¸€ä¸ªé”™è¯¯è¯•è¯•ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type fileError struct {
}

func (fe *fileError) Error() string {
	return &amp;#34;æ–‡ä»¶é”™è¯¯&amp;#34;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;è‡ªå®šä¹‰-error&#34;&gt;è‡ªå®šä¹‰ error &lt;a href=&#34;#%e8%87%aa%e5%ae%9a%e4%b9%89-error&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è‡ªå®šä¹‰äº†ä¸€ä¸ª&lt;code&gt;fileError&lt;/code&gt;ç±»å‹ï¼Œå®ç°äº†&lt;code&gt;error&lt;/code&gt;æ¥å£ã€‚ç°åœ¨æµ‹è¯•ä¸‹çœ‹çœ‹æ•ˆæœã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	conent, err := openFile()
	if err != nil {
		fmt.Println(err)
	} else {
		fmt.Println(string(conent))
	}
}

//åªæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯
func openFile() ([]byte, error) {
	return nil, &amp;amp;fileError{}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿è¡Œæ¨¡æ‹Ÿçš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°&lt;code&gt;æ–‡ä»¶é”™è¯¯&lt;/code&gt;çš„é€šçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½é‡åˆ°å¾ˆå¤šé”™è¯¯ï¼Œä»–ä»¬çš„åŒºåˆ«æ˜¯é”™è¯¯ä¿¡æ¯ä¸ä¸€æ ·ï¼Œä¸€ç§åšæ³•æ˜¯æ¯ç§é”™è¯¯éƒ½ç±»ä¼¼ä¸Šé¢ä¸€æ ·å®šä¹‰ä¸€ä¸ªé”™è¯¯ç±»å‹ï¼Œä½†æ˜¯è¿™æ ·å¤ªéº»çƒ¦äº†ã€‚æˆ‘ä»¬å‘ç°&lt;code&gt;Error&lt;/code&gt;è¿”å›çš„å…¶å®æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸‹ï¼Œè®©è¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥è®¾ç½®å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type fileError struct {
	s string
}

func (fe *fileError) Error() string {
	return fe.s
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ ·æ”¹é€ åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å£°æ˜&lt;code&gt;fileError&lt;/code&gt;çš„æ—¶å€™ï¼Œè®¾ç½®å¥½è¦æç¤ºçš„é”™è¯¯æ–‡å­—ï¼Œå°±å¯ä»¥æ»¡è¶³æˆ‘ä»¬ä¸åŒçš„éœ€è¦äº†ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//åªæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯
func openFile() ([]byte, error) {
	return nil, &amp;amp;fileError{&amp;#34;æ–‡ä»¶é”™è¯¯ï¼Œè‡ªå®šä¹‰&amp;#34;}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¿®æ”¹fileErrorçš„åå­—ï¼Œå†åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œä¾¿äºæˆ‘ä»¬åˆ›å»ºä¸åŒçš„é”™è¯¯ç±»å‹ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//blog:www.flysnow.org
//wechat:flysnow_org
func New(text string) error {
	return &amp;amp;errorString{text}
}

type errorString struct {
	s string
}

func (e *errorString) Error() string {
	return e.s
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥é€šè¿‡&lt;code&gt;New&lt;/code&gt;å‡½æ•°ï¼Œè¾…åŠ©æˆ‘ä»¬åˆ›å»ºä¸åŒçš„é”™è¯¯äº†ï¼Œè¿™å…¶å®å°±æ˜¯æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„&lt;code&gt;errors.New&lt;/code&gt;å‡½æ•°ï¼Œè¢«æˆ‘ä»¬ä¸€æ­¥æ­¥å‰–ææ¼”åŒ–è€Œæ¥&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ä¸Šé¢çš„æ–¹æ¡ˆåªæ˜¯è§£å†³äº†æ–‡æ¡ˆæç¤ºçš„é”™è¯¯è‡ªå®šä¹‰ï¼Œèƒ½å¦åƒPHPé‚£æ ·æŒ‡å®šåˆ°é”™è¯¯çš„æ–‡ä»¶è¡Œæ•°ï¼Œå…·ä½“æ˜¯å“ªä¸€ä¸ªæ–¹æ³•é”™è¯¯å‘¢&lt;/p&gt;
&lt;h1 id=&#34;æ¨èçš„æ–¹æ¡ˆ&#34;&gt;æ¨èçš„æ–¹æ¡ˆ &lt;a href=&#34;#%e6%8e%a8%e8%8d%90%e7%9a%84%e6%96%b9%e6%a1%88&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å› ä¸ºGoè¯­è¨€æä¾›çš„é”™è¯¯å¤ªç®€å•äº†ï¼Œä»¥è‡³äºç®€å•çš„æˆ‘ä»¬æ— æ³•æ›´å¥½çš„å¤„ç†é—®é¢˜ï¼Œç”šè‡³ä¸èƒ½ä¸ºæˆ‘ä»¬å¤„ç†é”™è¯¯ï¼Œæä¾›æ›´æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ‰€ä»¥è¯ç”Ÿäº†å¾ˆå¤šå¯¹é”™è¯¯å¤„ç†çš„åº“ï¼Œ&lt;code&gt;github.com/pkg/errors&lt;/code&gt;æ˜¯æ¯”è¾ƒç®€æ´çš„ä¸€æ ·ï¼Œå¹¶ä¸”åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå—åˆ°äº†å¤§é‡å¼€å‘è€…çš„æ¬¢è¿ï¼Œä½¿ç”¨è€…å¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;å®ƒçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œå¦‚æœæˆ‘ä»¬è¦æ–°ç”Ÿæˆä¸€ä¸ªé”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;New&lt;/code&gt;å‡½æ•°,ç”Ÿæˆçš„é”™è¯¯ï¼Œè‡ªå¸¦è°ƒç”¨å †æ ˆä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func New(message string) error
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœæœ‰ä¸€ä¸ªç°æˆçš„&lt;code&gt;error&lt;/code&gt;ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä»–è¿›è¡Œå†æ¬¡åŒ…è£…å¤„ç†ï¼Œè¿™æ—¶å€™æœ‰ä¸‰ä¸ªå‡½æ•°å¯ä»¥é€‰æ‹©ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//åªé™„åŠ æ–°çš„ä¿¡æ¯
func WithMessage(err error, message string) error

//åªé™„åŠ è°ƒç”¨å †æ ˆä¿¡æ¯
func WithStack(err error) error

//åŒæ—¶é™„åŠ å †æ ˆå’Œä¿¡æ¯
func Wrap(err error, message string) error
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶å®ä¸Šé¢çš„åŒ…è£…ï¼Œå¾ˆç±»ä¼¼äºJavaçš„å¼‚å¸¸åŒ…è£…ï¼Œè¢«åŒ…è£…çš„errorï¼Œå…¶å®å°±æ˜¯Cause,åœ¨å‰é¢çš„ç« èŠ‚æåˆ°é”™è¯¯çš„æ ¹æœ¬åŸå› ï¼Œå°±æ˜¯è¿™ä¸ªCauseã€‚æ‰€ä»¥è¿™ä¸ªé”™è¯¯å¤„ç†åº“ä¸ºæˆ‘ä»¬æä¾›äº†Causeå‡½æ•°è®©æˆ‘ä»¬å¯ä»¥è·å¾—æœ€æ ¹æœ¬çš„é”™è¯¯åŸå› ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Cause(err error) error {
	type causer interface {
		Cause() error
	}

	for err != nil {
		cause, ok := err.(causer)
		if !ok {
			break
		}
		err = cause.Cause()
	}
	return err
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;for&lt;/code&gt;å¾ªç¯ä¸€ç›´æ‰¾åˆ°æœ€æ ¹æœ¬ï¼ˆæœ€åº•å±‚ï¼‰çš„é‚£ä¸ª&lt;code&gt;error&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šçš„é”™è¯¯æˆ‘ä»¬éƒ½åŒ…è£…å¥½äº†ï¼Œä¹Ÿæ”¶é›†å¥½äº†ï¼Œé‚£ä¹ˆæ€ä¹ˆæŠŠä»–ä»¬é‡Œé¢å­˜å‚¨çš„å †æ ˆã€é”™è¯¯åŸå› ç­‰è¿™äº›ä¿¡æ¯æ‰“å°å‡ºæ¥å‘¢ï¼Ÿå…¶å®ï¼Œè¿™ä¸ªé”™è¯¯å¤„ç†åº“çš„é”™è¯¯ç±»å‹ï¼Œéƒ½å®ç°äº†&lt;code&gt;Formatter&lt;/code&gt;æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡&lt;code&gt;fmt.Printf&lt;/code&gt;å‡½æ•°è¾“å‡ºå¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;%s,%v //åŠŸèƒ½ä¸€æ ·ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œä¸åŒ…å«å †æ ˆ
%q //è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯å¸¦å¼•å·ï¼Œä¸åŒ…å«å †æ ˆ
%+v //è¾“å‡ºé”™è¯¯ä¿¡æ¯å’Œå †æ ˆ
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Macä¼˜åŒ–</title>
      <link>https://abnerxc.github.io/tool/mac-%E4%BC%98%E5%8C%96/</link>
      <pubDate>Thu, 21 Jul 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/tool/mac-%E4%BC%98%E5%8C%96/</guid>
      <description>&lt;p&gt;å…¨å±€è®¾ç½®ä»£ç†&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;export ALL_PROXY=socks5://127.0.0.1:1086
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;git-ssh&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git config --global user.name &amp;#34;xuchen&amp;#34;
git config --global user.email &amp;#34;abner510@126.com&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;brew&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ruby -e &amp;#34;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ–è€…
/bin/zsh -c &amp;ldquo;$(curl -fsSL &lt;a href=&#34;https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)%22&#34;&gt;https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&amp;quot;&lt;/a&gt;
é€‰æ‹©1 ä¸­ç§‘å¤§æº&lt;/p&gt;
&lt;p&gt;oh-my-zsh&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;curl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;zsh-autosuggestions è‡ªåŠ¨è¡¥å…¨æ’ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸‹è½½è¯¥æ’ä»¶åˆ°.oh-my-zshçš„æ’ä»¶ç›®å½• &lt;code&gt;git clone git://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç¼–è¾‘.zshrcï¼š &lt;code&gt;plugins=(git zsh-autosuggestions)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é‡å¯å‘½ä»¤è¡Œå·¥å…·&lt;/li&gt;
&lt;li&gt;ä¸‹è½½è‡ªåŠ¨è¡¥å…¨æ’ä»¶ &lt;code&gt;http://mimosa-pudica.net/src/incr-0.2.zsh&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ”¾åˆ°oh-my-zshçš„æ’ä»¶åº“ä¸­ &lt;code&gt;.oh-my-zsh/plugins/åˆ›å»ºincræ–‡ä»¶å¤¹æ”¾åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;.zshrcæœ«å°¾æ·»åŠ ï¼š&lt;code&gt;source ~/.oh-my-zsh/plugins/incr/incr*.zsh&lt;/code&gt; é‡å¯å‘½ä»¤è¡Œ&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>sshå¸¸ç”¨è„šæœ¬</title>
      <link>https://abnerxc.github.io/tool/shell-ssh_script/</link>
      <pubDate>Thu, 21 Jul 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/tool/shell-ssh_script/</guid>
      <description>&lt;h1 id=&#34;sshç™»é™†è„šæœ¬&#34;&gt;sshç™»é™†è„šæœ¬ &lt;a href=&#34;#ssh%e7%99%bb%e9%99%86%e8%84%9a%e6%9c%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;1mainsh&#34;&gt;1.main.sh &lt;a href=&#34;#1mainsh&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;#!/bin/bash
# è·å–è„šæœ¬ç»å¯¹è·¯å¾„
SOURCE=&amp;#34;${BASH_SOURCE[0]}&amp;#34;
while [ -h &amp;#34;$SOURCE&amp;#34; ]; do # resolve $SOURCE until the file is no longer a symlink
  DIR=&amp;#34;$(cd -P &amp;#34;$(dirname &amp;#34;$SOURCE&amp;#34;)&amp;#34; &amp;amp;&amp;amp; pwd)&amp;#34;
  SOURCE=&amp;#34;$(readlink &amp;#34;$SOURCE&amp;#34;)&amp;#34;
  [[ $SOURCE != /* ]] &amp;amp;&amp;amp; SOURCE=&amp;#34;$DIR/$SOURCE&amp;#34; # if relative, re resolve it
done
direc=&amp;#34;$(cd -P &amp;#34;$(dirname &amp;#34;$SOURCE&amp;#34;)&amp;#34; &amp;amp;&amp;amp; pwd)&amp;#34;

# é¢œè‰²è¾“å‡ºå‡½æ•°
function color(){
    blue=&amp;#34;\033[0;36m&amp;#34;
    red=&amp;#34;\033[0;31m&amp;#34;
    green=&amp;#34;\033[0;32m&amp;#34;
    close=&amp;#34;\033[m&amp;#34;
    case $1 in
        blue)
            echo -e &amp;#34;$blue $2 $close&amp;#34;
        ;;
        red)
            echo -e &amp;#34;$red $2 $close&amp;#34;
        ;;
        green)
            echo -e &amp;#34;$green $2 $close&amp;#34;
        ;;
        *)
            echo &amp;#34;Input color error!!&amp;#34;
        ;;
    esac
}

# ç‰ˆæƒä¿¡æ¯
function copyright(){
    echo &amp;#34;#####################&amp;#34;
    color blue &amp;#34;   SSH Login Platform   &amp;#34;
    echo &amp;#34;#####################&amp;#34;
    echo
}

# ä¸‹åˆ’çº¿åˆ†éš”ç¬¦
function underline(){
    echo &amp;#34;-----------------------------------------&amp;#34;
}

# è·å–æœåŠ¡å™¨é…ç½®
function get_server_config() {
    local id=&amp;#34;$1&amp;#34;
    awk -v server_id=&amp;#34;server$id&amp;#34; -F &amp;#39;=&amp;#39; &amp;#39;
    BEGIN {
        current_section = &amp;#34;&amp;#34;
        ip = port = username = login_type = credential = label = &amp;#34;&amp;#34;
    }
    /^\[/ {
        current_section = substr($0, 2, length($0)-2)
        if(current_section == server_id) in_section=1
        else in_section=0
    }
    in_section &amp;amp;&amp;amp; NF&amp;gt;0 {
        gsub(/^[ \t]+|[ \t]+$/, &amp;#34;&amp;#34;, $1)
        gsub(/^[ \t]+|[ \t]+$/, &amp;#34;&amp;#34;, $2)
        
        if ($1 == &amp;#34;ip&amp;#34;) ip = $2
        if ($1 == &amp;#34;port&amp;#34;) port = $2
        if ($1 == &amp;#34;username&amp;#34;) username = $2
        if ($1 == &amp;#34;login_type&amp;#34;) login_type = $2
        if ($1 == &amp;#34;credential&amp;#34;) credential = $2
        if ($1 == &amp;#34;label&amp;#34;) label = $2
    }
    END {
        if (ip != &amp;#34;&amp;#34;) {
            printf &amp;#34;%s:%s:%s:%s:%s:%s&amp;#34;, ip, port, username, login_type, credential, label
        }
    }
    &amp;#39; &amp;#34;$direc/config.ini&amp;#34;
}

# åˆ—å‡ºæ‰€æœ‰æœåŠ¡å™¨
function list_servers() {
    awk -F &amp;#39;=&amp;#39; &amp;#39;
    BEGIN {
        print &amp;#34;åºå· |       ä¸»æœº      | ç™»å½•æ–¹å¼ | è¯´æ˜&amp;#34;
    }
    /^\[server/ {
        match($0, /server[0-9]+/)
        server_id = substr($0, RSTART+6, RLENGTH-6)
        ip = login_type = label = &amp;#34;&amp;#34;
    }
    !/^\[/ &amp;amp;&amp;amp; $1 ~ /[[:space:]]*ip/ {
        gsub(/^[ \t]+|[ \t]+$/, &amp;#34;&amp;#34;, $2)
        ip = $2
    }
    !/^\[/ &amp;amp;&amp;amp; $1 ~ /[[:space:]]*login_type/ {
        gsub(/^[ \t]+|[ \t]+$/, &amp;#34;&amp;#34;, $2)
        login_type = $2
    }
    !/^\[/ &amp;amp;&amp;amp; $1 ~ /[[:space:]]*label/ {
        gsub(/^[ \t]+|[ \t]+$/, &amp;#34;&amp;#34;, $2)
        label = $2
    }
    ip != &amp;#34;&amp;#34; &amp;amp;&amp;amp; login_type != &amp;#34;&amp;#34; &amp;amp;&amp;amp; label != &amp;#34;&amp;#34; {
        printf &amp;#34;\033[0;31m% 3s \033[m | %15s | %8s | %s\n&amp;#34;, server_id, ip, login_type, label
        server_id = ip = login_type = label = &amp;#34;&amp;#34;
    }
    &amp;#39; &amp;#34;$direc/config.ini&amp;#34;
}

# ä¸»å‡½æ•°
function main(){
    while true; do
        clear
        copyright
        
        echo &amp;#34;åºå· |       ä¸»æœº      | ç™»å½•æ–¹å¼ | è¯´æ˜&amp;#34;
        underline
        list_servers
        underline
        
        read -p &amp;#39;[*] é€‰æ‹©ä¸»æœº: &amp;#39; number
        
        if [[ &amp;#34;$number&amp;#34; == &amp;#34;q&amp;#34; || &amp;#34;$number&amp;#34; == &amp;#34;quit&amp;#34; ]]; then
            exit
        fi
        
        config=$(get_server_config &amp;#34;$number&amp;#34;)
        
        if [ -z &amp;#34;$config&amp;#34; ]; then
            color red &amp;#34;[!] æ— æ•ˆçš„ä¸»æœºåºå·: $number&amp;#34;
            sleep 1
            continue
        fi
        
        IFS=&amp;#39;:&amp;#39; read -r ipaddr port username login_type credential label &amp;lt;&amp;lt;&amp;lt; &amp;#34;$config&amp;#34;
        
        # æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        color blue &amp;#34;[*] è§£æé…ç½®ï¼š&amp;#34;
        echo &amp;#34;è·¯å¾„å‰ç¼€: $direc&amp;#34;
        echo &amp;#34;IPåœ°å€: $ipaddr&amp;#34;
        echo &amp;#34;ç«¯å£: $port&amp;#34;
        echo &amp;#34;ç”¨æˆ·å: $username&amp;#34;
        echo &amp;#34;ç™»å½•ç±»å‹: $login_type&amp;#34;
        echo &amp;#34;è¯ä¹¦æ–‡ä»¶: $credential&amp;#34;
        
        if [[ &amp;#34;$login_type&amp;#34; == &amp;#34;pem&amp;#34; ]]; then
            pem_path=&amp;#34;$direc/keys/$credential&amp;#34;
            color green &amp;#34;[*] ä½¿ç”¨è¯ä¹¦: $credential&amp;#34;
            echo &amp;#34;è¯ä¹¦è·¯å¾„: $pem_path&amp;#34;
            
            if [ ! -f &amp;#34;$pem_path&amp;#34; ]; then
                color red &amp;#34;[!] è¯ä¹¦æ–‡ä»¶ä¸å­˜åœ¨: $pem_path&amp;#34;
                sleep 2
                continue
            elif [ ! -r &amp;#34;$pem_path&amp;#34; ]; then
                color red &amp;#34;[!] æ— æƒé™è¯»å–è¯ä¹¦æ–‡ä»¶&amp;#34;
                sleep 2
                continue
            fi
            
            ssh -i &amp;#34;$pem_path&amp;#34; &amp;#34;$username@$ipaddr&amp;#34; -p &amp;#34;$port&amp;#34;
            
        elif [[ &amp;#34;$login_type&amp;#34; == &amp;#34;pwd&amp;#34; ]]; then
            exp_path=&amp;#34;$direc/login.exp&amp;#34;
            
            if [ ! -f &amp;#34;$exp_path&amp;#34; ]; then
                color red &amp;#34;[!] expectè„šæœ¬ä¸å­˜åœ¨: $exp_path&amp;#34;
                sleep 2
                continue
            elif [ ! -x &amp;#34;$exp_path&amp;#34; ]; then
                color red &amp;#34;[!] expectè„šæœ¬ä¸å¯æ‰§è¡Œ&amp;#34;
                sleep 2
                continue
            fi
            
            expect -f &amp;#34;$exp_path&amp;#34; &amp;#34;$ipaddr&amp;#34; &amp;#34;$username&amp;#34; &amp;#34;$credential&amp;#34; &amp;#34;$port&amp;#34;
        else
            color red &amp;#34;[!] æœªçŸ¥çš„ç™»å½•ç±»å‹: $login_type&amp;#34;
            sleep 2
        fi
    done
}

main
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;2loginexp&#34;&gt;2.login.exp &lt;a href=&#34;#2loginexp&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;#!/usr/bin/expect -f
proc abort {msg} {
    puts stderr $msg
    exit 1
}

if {$argc != 4} {
    abort &amp;#34;Usage: $argv0 host user password port&amp;#34;
}

set TARGET [lindex $argv 0]
set USER [lindex $argv 1]
set PASSWD [lindex $argv 2]
set PORT [lindex $argv 3]
set timeout 10

spawn ssh -o StrictHostKeyChecking=no -p $PORT $USER@$TARGET
match_max 100000

expect {
    &amp;#34;*yes/no&amp;#34; {
        send &amp;#34;yes\r&amp;#34;
        exp_continue
    }
    &amp;#34;*assword:&amp;#34; {
        send &amp;#34;$PASSWD\r&amp;#34;
        exp_continue
    }
    eof {
        puts &amp;#34;Connection closed.&amp;#34;
    }
    timeout {
        abort &amp;#34;Connection timeout&amp;#34;
    }
}

interact
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;3configini&#34;&gt;3.config.ini &lt;a href=&#34;#3configini&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;[server1] 
ip=127.0.0.1
port=22
username=root
login_type=pwd
credential=123456
label=æœ¬åœ°test

[server2] 
ip=127.0.0.1
port=22
username=root
login_type=pwd
credential=123456
label=æœ¬åœ°test
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;4åœ¨mainshç›®å½•ä¸‹æ–°å»ºkeysæ–‡ä»¶å¤¹å°†è¯ä¹¦æ–‡ä»¶æ”¾åœ¨keysæ–‡ä»¶å¤¹ä¸‹è¯ä¹¦æƒé™ä¸º600&#34;&gt;4.åœ¨main.shç›®å½•ä¸‹æ–°å»ºkeysæ–‡ä»¶å¤¹ï¼Œå°†è¯ä¹¦æ–‡ä»¶æ”¾åœ¨keysæ–‡ä»¶å¤¹ä¸‹,è¯ä¹¦æƒé™ä¸º600 &lt;a href=&#34;#4%e5%9c%a8mainsh%e7%9b%ae%e5%bd%95%e4%b8%8b%e6%96%b0%e5%bb%bakeys%e6%96%87%e4%bb%b6%e5%a4%b9%e5%b0%86%e8%af%81%e4%b9%a6%e6%96%87%e4%bb%b6%e6%94%be%e5%9c%a8keys%e6%96%87%e4%bb%b6%e5%a4%b9%e4%b8%8b%e8%af%81%e4%b9%a6%e6%9d%83%e9%99%90%e4%b8%ba600&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;chmod 600 a.pem
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Ubuntuå¼€æœºä¼˜åŒ–</title>
      <link>https://abnerxc.github.io/tool/linux-ubuntu%E4%BC%98%E5%8C%96/</link>
      <pubDate>Thu, 21 Jul 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/tool/linux-ubuntu%E4%BC%98%E5%8C%96/</guid>
      <description>&lt;h1 id=&#34;å®‰è£…openssh-server&#34;&gt;å®‰è£…openssh-server &lt;a href=&#34;#%e5%ae%89%e8%a3%85openssh-server&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install openssh-server vim git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;å†…æ ¸å‡çº§&#34;&gt;å†…æ ¸å‡çº§ &lt;a href=&#34;#%e5%86%85%e6%a0%b8%e5%8d%87%e7%ba%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;1ã€æŸ¥çœ‹å†…æ ¸ï¼šuname -a
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2ã€æŸ¥è¯¢æŒ‡å®šç‰ˆæœ¬å†…æ ¸ï¼šapt-cache search linux| grep inux-headers-6.5
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;3ã€ä¸‹è½½å†…æ ¸ï¼šsudo apt-get install linux-headers-6.5.0-45-generic linux-image-6.5.0-45-generic
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;4ã€æŸ¥çœ‹å·²å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬ï¼šdpkg --get-selections | grep linux-image
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;5ã€å®‰è£…å„ç§ç½‘å¡æ˜¾å¡é©±åŠ¨ï¼šsudo apt-get install linux-tools-6.5.0-45-generic  linux-modules-extra-6.5.0-45-generic
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;6ã€å†æ¬¡æŸ¥çœ‹é©±åŠ¨ï¼šdpkg --get-selections  | grep linux
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;7ã€ä¿®æ”¹å†…æ ¸å¯åŠ¨é¡ºåºï¼š
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#å¤‡ä»½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sudo cp /etc/default/grub /etc/default/grub.bak
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# ä¿®æ”¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sudo vim /etc/default/grub
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#GRUB_DEFAULT=&amp;#34;1&amp;gt; 3&amp;#34; å…¶ä¸­&amp;#34;1&amp;gt; 3&amp;#34;è¡¨ç¤ºåœ¨ç¬¬ä¸€çº§èœå•ä¸­åºå·ä¸º1çš„æ¡ç›®ï¼Œåœ¨è¯¥æ¡ç›®çš„ç¬¬äºŒçº§èœå•ä¸­æˆ‘ä»¬é€‰æ‹©åºå·ä¸º3çš„æ¡ç›®ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è®²è¿‡çš„Ubuntu é«˜çº§é€‰é¡¹ï¼ˆåºå·1ï¼‰ä¸‹çš„Ubuntuï¼ŒLinux 4.8.0-36-genericï¼ˆåºå·3ï¼‰ã€‚è¯·æ³¨æ„&amp;gt;å·åé¢æœ‰ç©ºæ ¼ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    GRUB_DEFAULT&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1&amp;gt; 5&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# æˆ–è€… GRUB_DEFAULT=&amp;#34;Advanced options for Ubuntu&amp;gt;Ubuntu, Linux 5.8.0-41-generic&amp;#34;    &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# æ›´æ–°é…ç½®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sudo update-grub
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;8ã€é‡å¯ç”µè„‘
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;å¼€å¯root&#34;&gt;å¼€å¯root &lt;a href=&#34;#%e5%bc%80%e5%90%afroot&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;sudo vi /etc/ssh/sshd_config(33è¡Œ)ï¼Œ #PermitRootLogin prohibit-password ä¿®æ”¹ä¸º &lt;code&gt;PermitRootLogin yes&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;//ä½¿ç”¨sudoè·å¾—rootæƒé™ &lt;code&gt;sudo su&lt;/code&gt; //è¾“å…¥æ–°å¯†ç å¹¶ç¡®è®¤ &lt;code&gt;passwd root&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ›¿æ¢å›½å†…æº&#34;&gt;æ›¿æ¢å›½å†…æº &lt;a href=&#34;#%e6%9b%bf%e6%8d%a2%e5%9b%bd%e5%86%85%e6%ba%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/ubuntu/ &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -sc&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; main restricted universe multiverse&amp;#34;&lt;/span&gt; | sudo tee /etc/apt/sources.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/ubuntu/ &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -sc&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; main restricted universe multiverse&amp;#34;&lt;/span&gt; | sudo tee -a /etc/apt/sources.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/ubuntu/ &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -sc&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-updates main restricted universe multiverse&amp;#34;&lt;/span&gt; | sudo tee -a /etc/apt/sources.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/ubuntu/ &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -sc&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-updates main restricted universe multiverse&amp;#34;&lt;/span&gt; | sudo tee -a /etc/apt/sources.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/ubuntu/ &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -sc&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-security main restricted universe multiverse&amp;#34;&lt;/span&gt; | sudo tee -a /etc/apt/sources.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/ubuntu/ &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -sc&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-security main restricted universe multiverse&amp;#34;&lt;/span&gt; | sudo tee -a /etc/apt/sources.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt upgrade
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;åˆ é™¤æ— ç”¨è½¯ä»¶&#34;&gt;åˆ é™¤æ— ç”¨è½¯ä»¶ &lt;a href=&#34;#%e5%88%a0%e9%99%a4%e6%97%a0%e7%94%a8%e8%bd%af%e4%bb%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove libreoffice
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove unity-webapps-common  &lt;span style=&#34;color:#75715e&#34;&gt;#åˆ é™¤Amazonçš„é“¾æ¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get  remove   libreoffice-common   unity-webapps-common thunderbird totem rhythmbox  simple-scan gnome-mahjongg aisleriot gnome-mines cheese transmission-common gnome-orca gnome-sudoku webbrowser-app onboard deja-dup &lt;span style=&#34;color:#75715e&#34;&gt;#æ— ç”¨è½¯ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove software-center &lt;span style=&#34;color:#75715e&#34;&gt;#åˆ é™¤è‡ªå¸¦çš„è½¯ä»¶ä¸­å¿ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove imagemagick &lt;span style=&#34;color:#75715e&#34;&gt;#è‡ªå¸¦å›¾ç‰‡ç¼–è¾‘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gsettings set com.canonical.Unity.Lenses remote-content-search &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;none&amp;#39;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;#å…³é—­dashåœ¨çº¿èµ„æºæœç´¢&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h1 id=&#34;å¸¸ç”¨å®‰è£…å’Œå¸è½½&#34;&gt;å¸¸ç”¨å®‰è£…å’Œå¸è½½ &lt;a href=&#34;#%e5%b8%b8%e7%94%a8%e5%ae%89%e8%a3%85%e5%92%8c%e5%8d%b8%e8%bd%bd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install alien &lt;span style=&#34;color:#75715e&#34;&gt;##aliené»˜è®¤æ²¡æœ‰å®‰è£…ï¼Œæ‰€ä»¥é¦–å…ˆè¦å®‰è£…å®ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo alien xxxx.rpm &lt;span style=&#34;color:#75715e&#34;&gt;##å°†rpmè½¬æ¢ä½debï¼Œå®Œæˆåä¼šç”Ÿæˆä¸€ä¸ªåŒåçš„xxxx.deb&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo dpkg -i xxxx.deb &lt;span style=&#34;color:#75715e&#34;&gt;##å®‰è£…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo dpkg -l | grep netease &lt;span style=&#34;color:#75715e&#34;&gt;#æŸ¥æ‰¾åŒ…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge  netease-cloud-music  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove  &lt;span style=&#34;color:#75715e&#34;&gt;#å¹²å‡€çš„å¸è½½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;è®¾ç½®æ—¶é—´ä½¿ç”¨utc&#34;&gt;è®¾ç½®æ—¶é—´ä½¿ç”¨UTC &lt;a href=&#34;#%e8%ae%be%e7%bd%ae%e6%97%b6%e9%97%b4%e4%bd%bf%e7%94%a8utc&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo vim /etc/default/rcS  &lt;span style=&#34;color:#75715e&#34;&gt;###å°†UTC=noæ”¹ä¸ºUTC=yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;è‡ªå®šä¹‰dhcpç½‘ç»œçš„dns-server-ipåœ°å€&#34;&gt;è‡ªå®šä¹‰DHCPç½‘ç»œçš„DNS Server IPåœ°å€ &lt;a href=&#34;#%e8%87%aa%e5%ae%9a%e4%b9%89dhcp%e7%bd%91%e7%bb%9c%e7%9a%84dns-server-ip%e5%9c%b0%e5%9d%80&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo vim /etc/dhcp/dhclient.confæ–‡ä»¶ï¼Œåœ¨ç¬¬21è¡Œ#prepend domain-name-servers 127.0.0.1;ä¸‹ä¸€è¡Œæ·»åŠ å¦‚ä¸‹2è¡Œä½¿ç”¨aliyunå’Œ114çš„DNS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;prepend domain-name-servers 114.114.114.114;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;prepend domain-name-servers 223.5.5.5;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;è¿™æ ·å¯ä»¥ä¼˜å…ˆä½¿ç”¨aliyunçš„dnsï¼Œæ¬¡è¦ä½¿ç”¨114çš„DNSã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;snapåˆ é™¤è„šæœ¬-winå­—ç¬¦æ›¿æ¢&#34;&gt;snapåˆ é™¤è„šæœ¬ winå­—ç¬¦æ›¿æ¢ &lt;a href=&#34;#snap%e5%88%a0%e9%99%a4%e8%84%9a%e6%9c%ac-win%e5%ad%97%e7%ac%a6%e6%9b%bf%e6%8d%a2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åœç”¨ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo systemctl stop snapd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#åˆ é™¤å’Œé—ç•™æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt purge snapd -y  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo  rm  -rf  ~/snap /snap /var/snap /var/lib/snapd &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt autoremove --purge -y &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt clean
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim delsnap 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# è¾“å…¥ä¸‹é¢å†…å®¹:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt; ubuntu_remove_snap&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sudo systemctl disable snapd.service
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sudo systemctl disable snapd.socket
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sudo systemctl disable snapd.seeded.service
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; snap in &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;snap list | awk &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;æ­£åœ¨ç§»é™¤: &lt;/span&gt;$snap&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        snap remove &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;$snap&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sudo apt autoremove --purge snapd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sudo rm -rf /var/cache/snapd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sudo rm -rf ~/snap
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; sudo apt update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ubuntu_remove_snap
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#ä¿®æ”¹æƒé™&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s/\r$//&amp;#39;&lt;/span&gt; delsnap.sh &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; chmod +x delsnap.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;è½¯ä»¶å›¾æ ‡&#34;&gt;è½¯ä»¶å›¾æ ‡ &lt;a href=&#34;#%e8%bd%af%e4%bb%b6%e5%9b%be%e6%a0%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#åˆ›å»ºæ¡Œé¢å›¾æ ‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ¡Œé¢åˆ›å»ºæ–‡ä»¶  xx.desktop ï¼Œå¹¶å¡«å…¥ä¸‹é¢é…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Desktop Entry&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Version&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;1.0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Type&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Application
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;xxx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Icon&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;è½¯ä»¶è·¯å¾„&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;/xxx/icon.png
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Exec&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;è½¯ä»¶è·¯å¾„&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;/xxx/xx.appimage
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Terminal&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;false
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Categories&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Development;IDE;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æƒé™æ·»åŠ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo chmod +x xxx.appimage
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸­&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo cp xxx.desktop ~/.local/share/applications
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;gnomeæ¡Œé¢ç¾åŒ–&#34;&gt;gnomeæ¡Œé¢ç¾åŒ– &lt;a href=&#34;#gnome%e6%a1%8c%e9%9d%a2%e7%be%8e%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£…Tweaks å’Œ Extensions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install -y gnome-tweaks gnome-shell-extensions git
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# è®¿é—®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;extensions.gnome.orgï¼Œå¼€å¯&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;Click here to install browser extension&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å®‰è£…User Themes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Big Sur ä¸»é¢˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone https://gh-proxy.com/github.com/vinceliuice/WhiteSur-gtk-theme.git --depth&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd WhiteSur-gtk-theme  &lt;span style=&#34;color:#75715e&#34;&gt;# è¿›å…¥ä¸»é¢˜ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./install.sh  &lt;span style=&#34;color:#75715e&#34;&gt;# è¿è¡Œå®‰è£…è„šæœ¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo ./tweaks.sh -g  &lt;span style=&#34;color:#75715e&#34;&gt;# æ·»åŠ ä¸»é¢˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Big Sur åº”ç”¨å›¾æ ‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://gh-proxy.com/github.com/zayronxio/Mkos-Big-Sur/releases/download/0.3/Mkos-Big-Sur.tar.xz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir ~/.icons  &lt;span style=&#34;color:#75715e&#34;&gt;# åˆ›å»º ~/.icons ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tar -xJvf Mkos-Big-Sur.tar.xz -C ~/.icons  &lt;span style=&#34;color:#75715e&#34;&gt;# å°†å›¾æ ‡æ–‡ä»¶è§£å‹åˆ° ~/.icons ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Big Sur å­—ä½“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## ç•Œé¢å­—ä½“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone https://gh-proxy.com/https://github.com/sahibjotsaggu/San-Francisco-Pro-Fonts.git --depth&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;# ä¸‹è½½å­—ä½“åº“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir /usr/local/share/fonts/SF-Pro  &lt;span style=&#34;color:#75715e&#34;&gt;# æ–°å»ºå­—ä½“æ–‡ä»¶å¤¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd San-Francisco-Pro-Fonts
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mv SF-Pro* /usr/local/share/fonts/SF-Pro  &lt;span style=&#34;color:#75715e&#34;&gt;# å®‰è£…å­—ä½“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo fc-cache -fv  &lt;span style=&#34;color:#75715e&#34;&gt;# åˆ·æ–°å­—ä½“åˆ—è¡¨ç¼“å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## æ–‡æ¡£å­—ä½“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://font.download/dl/font/helvetica-255.zip
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir /usr/local/share/fonts/Helvetica
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo unzip helvetica-255.zip -d /usr/local/share/fonts/Helvetica
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo fc-cache -fv
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## ä»£ç å­—ä½“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://gh-proxy.com/github.com/ryanoasis/nerd-fonts/releases/download/v3.2.0/Meslo.tar.xz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir Meslo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo tar -xJvf Meslo.tar.xz -C Meslo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir /usr/local/share/fonts/Meslo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd Meslo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mv MesloLG* /usr/local/share/fonts/Meslo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo fc-cache -fv
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  å£çº¸ä¸‹è½½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone https://gh-proxy.com/github.com/vinceliuice/WhiteSur-wallpapers.git --depth&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#è®¾ç½®ä¸»é¢˜ã€å›¾æ ‡å’Œå£çº¸&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ‰“å¼€ GNOME Tweaksã€‚GNOME Tweaks ä½äº Utilities æ–‡ä»¶å¤¹é‡Œé¢ã€‚ æ–°ç‰ˆæœ¬å«&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ä¼˜åŒ–&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;é€‰æ‹©å¤–è§‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- å›¾æ ‡ï¼Œé€‰æ‹©ï¼šMkos-Big-sur
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- è¿‡æ—¶åº”ç”¨ç¨‹åºï¼šWhiteSur-Light
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- Shell: WhiteSur-Light
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;é€‰æ‹©å­—ä½“
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- ç•Œé¢æ–‡æœ¬&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Interface Text&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;ï¼šSF Pro Regular &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- æ–‡æ¡£æ–‡æœ¬&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Dodument Text&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: Helvetica å¸¸è§„ä½“ &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- ç­‰å®½æ–‡æœ¬&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Monospace Text&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: MesloLGM Nerd Font Regular &lt;span style=&#34;color:#ae81ff&#34;&gt;13&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;çª—å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- æ ‡é¢˜æ æŒ‰é’®ï¼Œæ”¾ç½®ï¼šå·¦
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ç³»ç»Ÿè®¾ç½®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;åœ¨ç³»ç»Ÿè®¾ç½®ä¸­é€‰æ‹©ï¼ŒAppearanceï¼ˆæ¡Œé¢ï¼‰è°ƒæ•´å¦‚ä¸‹é…ç½®
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- æ¡Œé¢å›¾æ ‡ï¼šSizeé€‰æ‹©å°ï¼ŒPosition of New Iconsé€‰æ‹©é¡¶éƒ¨å³ä¾§
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- Dockï¼šPanel Modelé€‰æ‹©å…³é—­ï¼ŒIcon Sizeé€‰æ‹©40ï¼ŒPosition on Screené€‰æ‹©åº•éƒ¨
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ¯›ç»ç’ƒæ•ˆæœ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- æ·»åŠ æ¯›ç»ç’ƒæ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… Blur my Shell æ’ä»¶ã€‚æ‰“å¼€ GNOME çš„å®˜ç½‘ extensions.gnome.orgï¼Œæœç´¢å¹¶å¯ç”¨ Blur my Shell æ’ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- æœ€å°åŒ–çª—å£æ—¶çš„ç¥å¥‡æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… Compiz alike magic lamp effect æ’ä»¶ã€‚æ‰“å¼€ GNOME çš„å®˜ç½‘ extensions.gnome.orgï¼Œæœç´¢å¹¶å¯ç”¨ Compiz alike magic lamp effect æ’ä»¶ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Ubuntu çš„ç¨‹åºåé»˜è®¤åªèƒ½ç‚¹å‡»å±•å¼€ï¼Œä¸èƒ½ç‚¹å‡»éšè—çª—å£ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¼€å¯ç‚¹å‡»éšè—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gsettings set org.gnome.shell.extensions.dash-to-dock click-action &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;minimize&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#gnomeå¿«æ·é”®å†²çª&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æŸ¥çœ‹å¿«æ·é”®
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gsettings get org.gnome.desktop.wm.keybindings switch-to-workspace-left
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;è®¾ç½®å¿«æ·é”®
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gsettings set org.gnome.desktop.wm.keybindings switch-to-workspace-left &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[&amp;#39;&amp;lt;Super&amp;gt;&amp;lt;Alt&amp;gt;Left&amp;#39;]&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gsettings set org.gnome.desktop.wm.keybindings switch-to-workspace-right &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[&amp;#39;&amp;lt;Super&amp;gt;&amp;lt;Alt&amp;gt;Right&amp;#39;]&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;wsl2&#34;&gt;wsl2 &lt;a href=&#34;#wsl2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å®‰è£…wsl2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wsl.exe --install -d Ubuntu-24.04
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æŸ¥çœ‹: wsl --list --verbose
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ³¨é”€: wsl --unregister Ubuntu-24.04
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;åˆ é™¤ï¼šC:&lt;span style=&#34;color:#ae81ff&#34;&gt;\U&lt;/span&gt;sers&lt;span style=&#34;color:#ae81ff&#34;&gt;\&amp;lt;&lt;/span&gt;ç”¨æˆ·å&amp;gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\A&lt;/span&gt;ppData&lt;span style=&#34;color:#ae81ff&#34;&gt;\L&lt;/span&gt;ocal&lt;span style=&#34;color:#ae81ff&#34;&gt;\P&lt;/span&gt;ackages&lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;å¯¼å…¥: wsl --import Ubuntu-24.04 D:&lt;span style=&#34;color:#ae81ff&#34;&gt;\v&lt;/span&gt;mos&lt;span style=&#34;color:#ae81ff&#34;&gt;\U&lt;/span&gt;buntu-24.04 D:&lt;span style=&#34;color:#ae81ff&#34;&gt;\v&lt;/span&gt;mos&lt;span style=&#34;color:#ae81ff&#34;&gt;\U&lt;/span&gt;buntu-24.04.tar
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å¯¼å‡º: wsl --export Ubuntu-24.04 D:&lt;span style=&#34;color:#ae81ff&#34;&gt;\v&lt;/span&gt;mos&lt;span style=&#34;color:#ae81ff&#34;&gt;\U&lt;/span&gt;buntu-24.04.tar
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;é‡å¯ï¼šwsl --shutdown
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;å®¿ä¸»æœºæ— æ³•é€šè¿‡ipè¿æ¥wsl2è§£å†³æ–¹æ¡ˆ&#34;&gt;å®¿ä¸»æœºæ— æ³•é€šè¿‡ipè¿æ¥wsl2è§£å†³æ–¹æ¡ˆ &lt;a href=&#34;#%e5%ae%bf%e4%b8%bb%e6%9c%ba%e6%97%a0%e6%b3%95%e9%80%9a%e8%bf%87ip%e8%bf%9e%e6%8e%a5wsl2%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;wsl2çš„é»˜è®¤ç½‘ç»œæ¨¡å¼æ˜¯NATï¼Œå»ºè®®ä¿®æ”¹ä¸ºé•œåƒæ¨¡å¼ã€‚åœ¨C:\Users&amp;lt;UserName&amp;gt;.wslconfigä¸­æ·»åŠ ä¸‹åˆ—ä»£ç :&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[wsl2]
#é•œåƒç½‘ç»œ
networkingMode=mirrored
#å¦‚æœä½¿ç”¨ä»£ç†å¯ä»¥åœ¨åé¢æ·»åŠ 
autoProxy=true
è¿˜å¯ä»¥ä½¿ç”¨DNSéš§é“æé«˜ä¸ VPN å’Œå…¶ä»–å¤æ‚ç½‘ç»œè®¾ç½®çš„å…¼å®¹æ€§:
dnsTunneling=true
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;win11é˜²ç«å¢™&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è·å–wsl GUID:&lt;code&gt;Get-NetFirewallHyperVVMCreator&lt;/code&gt;,å¾—åˆ°idé€šå¸¸æ˜¯40ExxE90&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹Hyper-Vé˜²ç«å¢™çŠ¶æ€&lt;code&gt;Get-NetFirewallHyperVVMSetting -PolicyStore ActiveStore -Name &#39;{40E0AC32-46A5-438A-A0B2-2B479E8F2E90}&#39;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å…³é—­Hyper-Vé˜²ç«å¢™&lt;code&gt;Set-NetFirewallHyperVVMSetting -Name &#39;{40E0AC32-46A5-438A-A0B2-2B479E8F2E90}&#39; -Enabled False&lt;/code&gt;
Ubuntuå…³é—­é˜²ç«å¢™&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ufw disable
apt-get remove iptables
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;linux-mint22-ä¼˜åŒ–&#34;&gt;linux-mint22 ä¼˜åŒ– &lt;a href=&#34;#linux-mint22-%e4%bc%98%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#linuxmint å¸è½½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge libreoffice*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove   &lt;span style=&#34;color:#75715e&#34;&gt;#office&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge thingy*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove  &lt;span style=&#34;color:#75715e&#34;&gt;#ä¹¦åº“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge warpinator*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#å±€åŸŸç½‘è½»æ¾æ–‡ä»¶å…±äº«æ–°åˆ©å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge hypnotix*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#tv&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge webapp-manager*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#webåº”ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge mintchat*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#èŠå¤©&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge thunderbird*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#é‚®ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge transmission*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#ä¸‹è½½å·¥å…·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge drawing*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#ç»˜å›¾å·¥å…·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge sticky*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#ä¾¿ç­¾&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge gucharmap*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#å­—ç¬¦æ˜ å°„è¡¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge firefox*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#ç«ç‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get remove --purge onboard*  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get autoremove &lt;span style=&#34;color:#75715e&#34;&gt;#è½¯é”®ç›˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#sudo apt-get remove --purge celluloid*  &amp;amp;&amp;amp; sudo apt-get autoremove #è§†é¢‘æ’­æ”¾å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#sudo apt-get remove --purge rhythmbox*  &amp;amp;&amp;amp; sudo apt autoremove --purge  #éŸ³ä¹æ’­æ”¾å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#2ã€æ¡Œé¢å›¾æ ‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ln -s /home/llane/program/Motrix.AppImage ~/Desktop  åˆ›å»ºè½¯é“¾æ¥çš„å½¢å¼
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#3ã€fcitx5ä¸­æ–‡è¾“å…¥æ³• (ä¼šå¯¼è‡´ideaå¡æ­»))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install fcitx5  fcitx5-chinese-addons fcitx5-frontend-gtk2 fcitx5-frontend-gtk3 fcitx5-frontend-qt5 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#ç„¶åç¼–è¾‘ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo vim ~/.profile æˆ– ~/.xprofileï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼šå®Œæˆåé‡å¯ç”µè„‘
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;export GTK_IM_MODULE=fcitx&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.profile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;export QT_IM_MODULE=fcitx&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.profile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;export QT5_IM_MODULE=fcitx&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.profile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;export XMODIFIERS=@im=fcitx&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.profile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#å¯åŠ¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å°†è¾“å…¥æ³•Fcitx5æ·»åŠ ä¸ºå¼€æœºå¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ä¸‹è½½è¯åº“æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://hk.gh-proxy.org/https://github.com/felixonmars/fcitx5-pinyin-zhwiki/releases/download/0.3.0/zhwiki-20251104.dict
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# åˆ›å»ºå­˜å‚¨ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p ~/.local/share/fcitx5/pinyin/dictionaries/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ç§»åŠ¨è¯åº“æ–‡ä»¶è‡³è¯¥ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mv zhwiki-20251104.dict ~/.local/share/fcitx5/pinyin/dictionaries/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#4ã€ibusè¾“å…¥æ³•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install ibus  ibus-pinyin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æœ€è¿‘æ‰“å¼€çš„è®°å½•æ¸…ç† &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rm -rf ~/.local/share/recently-used.xbel
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æŸ¥çœ‹æœ€åçš„å…³æœºæ—¥å¿—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;journalctl -b -1 | grep &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to stop&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æ—¥æœŸæ˜¾ç¤ºï¼š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;%Y-%m-%d&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;%A&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;%H:%M
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#è®¾ç½®æ˜¾ç¤ºå‘¨å‡ å’Œç§’&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ç³»ç»Ÿ-&amp;gt;åŒºåŸŸä¸è¯­è¨€-&amp;gt;æ ¼å¼ ï¼šé€‰æ‹©ä¸­å›½
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gsettings set org.gnome.desktop.interface clock-show-weekday true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gsettings set org.gnome.desktop.interface clock-show-seconds true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æ¸¸æˆå¸§ç‡ç›‘æ§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mangohudä¸‹è½½åœ°å€ï¼šhttps://github.com/flightlessmango/MangoHud/releases
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;goverlayä¸‹è½½åœ°å€ï¼šhttps://github.com/benjamimgois/goverlay/releases
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ç¡¬ä»¶ä¿¡æ¯æŸ¥çœ‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hardinfo2 æˆ–è€… mission center
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#æˆªå›¾è½¯ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install flameshot
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ— æ³•æˆªå›¾è§£å†³
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;è®¾ç½®-&amp;gt;é”®ç›˜-&amp;gt;è‡ªå®šä¹‰å¿«æ·é”®ï¼Œæ·»åŠ  /bin/sh -c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;flameshot gui&amp;#34;&lt;/span&gt; &amp;gt; /dev/null &amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ·»åŠ å¼€æœºå¯åŠ¨
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å‘½ä»¤ï¼šflameshot  å³å¯
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>vscodeæŠ˜è…¾</title>
      <link>https://abnerxc.github.io/tool/vscode%E6%8A%98%E8%85%BE/</link>
      <pubDate>Thu, 21 Jul 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/tool/vscode%E6%8A%98%E8%85%BE/</guid>
      <description>&lt;h1 id=&#34;åŸºæœ¬è®¾ç½®&#34;&gt;åŸºæœ¬è®¾ç½® &lt;a href=&#34;#%e5%9f%ba%e6%9c%ac%e8%ae%be%e7%bd%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;0.ä½¿ç”¨å¿«æ·é”®ç»„åˆã€Ctrl+Shift+pã€‘ï¼Œåœ¨æœç´¢æ¡†ä¸­è¾“å…¥â€œconfigure display languageâ€ï¼Œé€‰æ‹©&lt;code&gt;install&lt;/code&gt; å®‰è£…ç®€ä½“ä¸­æ–‡&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Auto Close Tag ï¼Œè‡ªåŠ¨æ·»åŠ  HTML/XML çš„é—­åˆæ ‡ç­¾ï¼Œåƒ Visual Studio IDE æˆ– Sublime Text ä¸€æ ·ã€‚&lt;/li&gt;
&lt;li&gt;Beautifyï¼Œåœ¨ Visual Studio Code ä¸­æ ¼å¼åŒ– javascript ã€JSON ã€ CSS ã€Sassï¼Œä»¥åŠ HTMLã€‚&lt;/li&gt;
&lt;li&gt;GitLens å¯ä»¥å¢å¼º VSCode å†…ç½® Git çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ commits æœç´¢ï¼Œå†å²è®°å½•å’Œæ˜¾ç¤ºçš„ä»£ç ä½œè€…èº«ä»½å…·ä½“åŠŸèƒ½å¯ä»¥æŸ¥çœ‹Feature list&lt;/li&gt;
&lt;li&gt;Git History â€Š- æ˜¾ç¤ºæäº¤å†å²è®°å½•çš„ç¾ä¸½å›¾è¡¨ç­‰ç­‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;phpç¯å¢ƒ&#34;&gt;PHPç¯å¢ƒ &lt;a href=&#34;#php%e7%8e%af%e5%a2%83&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;php intelephenseï¼ŒPHP çš„ä»£ç æç¤ºã€è¡¥å…¨ã€è·³è½¬å®šä¹‰ã€æ ¼å¼åŒ–æ’ä»¶ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ— éœ€é…ç½®ï¼›ä¼˜ç§€ï¼Œå¿…è£…ã€‚ &lt;code&gt;setting.json&lt;/code&gt; æ·»åŠ å¦‚ä¸‹é…ç½®&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;#34;php.suggest.basic&amp;#34;: false, //ç¦ç”¨åŸºæœ¬å»ºè®®
    &amp;#34;editor.quickSuggestions&amp;#34;: {  //åœ¨è¯„è®º/æ³¨é‡Šä¸­å¯ç”¨è‡ªåŠ¨å®ŒæˆåŠŸèƒ½
        &amp;#34;comments&amp;#34;: true 
    },
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;PHP DocBlockerï¼Œæ³¨é‡Šæ’ä»¶&lt;/li&gt;
&lt;li&gt;PHP Snippets from PHPStrom,ä½¿ç”¨å’Œ PHPStrom ä¸€æ ·çš„å¿«æ·ä»£ç ç‰‡æ®µï¼Œpubf + tabï¼Ÿ&lt;/li&gt;
&lt;li&gt;PHP Namespace Resolver,PHP å‘½åç©ºé—´è§£æå™¨ï¼›å¯ä»¥å¯¼å…¥å’Œæ‰©å±•ç±»ï¼›è¿˜å¯ä»¥æ’åºã€‚ä¼˜ç§€ï¼Œå¿…è£…ã€‚&lt;/li&gt;
&lt;li&gt;Better Align,å¯ä»¥å®ç°å˜é‡å’Œæ•°ç»„çš„ç­‰å·å¯¹é½ã€‚ä¼˜ç§€ï¼Œå¿…è£…ã€‚&lt;/li&gt;
&lt;li&gt;php.validate.executablepath,é…ç½®æˆdocker å®¹å™¨ä¸­çš„phpè·¯å¾„ï¼ŒåŠæ³•
&lt;ol&gt;
&lt;li&gt;æ–°å»ºæ–‡ä»¶ Create a file named php in &lt;code&gt;ä½ è‡ªå·±çš„è·¯å¾„&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å†™å…¥å†…å®¹&lt;code&gt;#!/bin/bash docker exec -i --user=1000:1000 php7-vscode php &amp;quot;$@&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹å¯æ‰§è¡Œ&lt;code&gt;sudo chmod +x php&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;php.validate.executablepath=&lt;code&gt;ä½ è‡ªå·±çš„è·¯å¾„&lt;/code&gt;/php&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;goç¯å¢ƒ&#34;&gt;goç¯å¢ƒ &lt;a href=&#34;#go%e7%8e%af%e5%a2%83&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;è®¾ç½®ä»£ç†  set GOPROXY=&amp;ldquo;&lt;a href=&#34;https://goproxy.cn&#34;&gt;https://goproxy.cn&lt;/a&gt;&amp;rdquo;&lt;/li&gt;
&lt;li&gt;vscodeæ·»åŠ goæ’ä»¶&lt;/li&gt;
&lt;li&gt;å®‰è£…go-toolsï¼Œcommand+shift+pï¼Œè¾“å…¥ go:install é€‰æ‹© install/update tools&lt;/li&gt;
&lt;li&gt;Code Runer,è¿è¡Œä»£ç &lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;settingjson&#34;&gt;setting.json &lt;a href=&#34;#settingjson&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;{
	&amp;#34;security.workspace.trust.untrustedFiles&amp;#34;: &amp;#34;open&amp;#34;,
	//å·¥ä½œå°
	&amp;#34;workbench.iconTheme&amp;#34;: &amp;#34;material-icon-theme&amp;#34;,
	&amp;#34;workbench.tree.indent&amp;#34;: 22,
	&amp;#34;workbench.tree.renderIndentGuides&amp;#34;: &amp;#34;always&amp;#34;,
	&amp;#34;workbench.tree.expandMode&amp;#34;: &amp;#34;doubleClick&amp;#34;,
	&amp;#34;workbench.preferredHighContrastColorTheme&amp;#34;: &amp;#34;Monokai&amp;#34;,
	&amp;#34;workbench.preferredDarkColorTheme&amp;#34;: &amp;#34;Monokai&amp;#34;,
	&amp;#34;workbench.preferredLightColorTheme&amp;#34;: &amp;#34;Monokai&amp;#34;,
	&amp;#34;workbench.startupEditor&amp;#34;: &amp;#34;none&amp;#34;,
	&amp;#34;workbench.editor.untitled.hint&amp;#34;: &amp;#34;hidden&amp;#34;,
	&amp;#34;workbench.colorTheme&amp;#34;: &amp;#34;Monokai&amp;#34;,
	&amp;#34;workbench.tree.horizontalScrolling&amp;#34;: true,
	&amp;#34;workbench.editor.enablePreview&amp;#34;: false,
	&amp;#34;workbench.editorAssociations&amp;#34;: {
		&amp;#34;*.html&amp;#34;: &amp;#34;default&amp;#34;
	},
	//git
	&amp;#34;git.autofetch&amp;#34;: true,
	&amp;#34;git.confirmSync&amp;#34;: false,
	&amp;#34;git.ignoreMissingGitWarning&amp;#34;: true,
	//ç»ˆç«¯
	&amp;#34;terminal.integrated.fontSize&amp;#34;: 16,
	&amp;#34;terminal.integrated.tabs.enabled&amp;#34;: true,
	&amp;#34;terminal.external.osxExec&amp;#34;: &amp;#34;iTerm.app&amp;#34;,
	&amp;#34;terminal.integrated.fontFamily&amp;#34;: &amp;#34;Monaco&amp;#34;,
	&amp;#34;terminal.integrated.gpuAcceleration&amp;#34;: &amp;#34;off&amp;#34;,
	&amp;#34;editor.suggest.snippetsPreventQuickSuggestions&amp;#34;: false,
	&amp;#34;editor.snippetSuggestions&amp;#34;: &amp;#34;top&amp;#34;,
	&amp;#34;editor.renderControlCharacters&amp;#34;: true,
	&amp;#34;editor.rename.enablePreview&amp;#34;: false,
	&amp;#34;editor.wordWrap&amp;#34;: &amp;#34;on&amp;#34;,
	&amp;#34;editor.quickSuggestions&amp;#34;: {
		//æ³¨é‡Šä¸­å¯ç”¨è‡ªåŠ¨å®ŒæˆåŠŸèƒ½
		&amp;#34;comments&amp;#34;: true
	},
	&amp;#34;editor.minimap.renderCharacters&amp;#34;: false,
	&amp;#34;editor.mouseWheelZoom&amp;#34;: true,
	&amp;#34;editor.minimap.size&amp;#34;: &amp;#34;fit&amp;#34;,
	&amp;#34;diffEditor.wordWrap&amp;#34;: &amp;#34;on&amp;#34;,
	&amp;#34;alignment.operatorPadding&amp;#34;: &amp;#34;right&amp;#34;,
	&amp;#34;alignment.indentBase&amp;#34;: &amp;#34;dontchange&amp;#34;,
	&amp;#34;intelephense.telemetry.enabled&amp;#34;: true,
	&amp;#34;debug.console.lineHeight&amp;#34;: 18,
	&amp;#34;debug.console.fontSize&amp;#34;: 14,
	//php
	&amp;#34;[php]&amp;#34;: {
		&amp;#34;editor.defaultFormatter&amp;#34;: &amp;#34;bmewburn.vscode-intelephense-client&amp;#34;
	},
	&amp;#34;php.suggest.basic&amp;#34;: false,
	&amp;#34;intelephense.compatibility.correctForBaseClassStaticUnionTypes&amp;#34;: false,
	&amp;#34;php-docblocker.gap&amp;#34;: false,
	&amp;#34;php-docblocker.qualifyClassNames&amp;#34;: true,
	&amp;#34;php-docblocker.author&amp;#34;: {
		&amp;#34;name&amp;#34;: &amp;#34;abner&amp;#34;,
		&amp;#34;email&amp;#34;: &amp;#34;abnerxc666@gmail.com&amp;#34;
	},
	//go
	&amp;#34;go.autocompleteUnimportedPackages&amp;#34;: true,
	&amp;#34;go.docsTool&amp;#34;: &amp;#34;gogetdoc&amp;#34;,
	&amp;#34;go.testFlags&amp;#34;: [
		&amp;#34;-v&amp;#34;,
		&amp;#34;-count=1&amp;#34;
	],
	&amp;#34;go.languageServerFlags&amp;#34;: [
		&amp;#34;-remote=auto&amp;#34;, &amp;#34;-logfile=auto&amp;#34;, &amp;#34;-debug=:0&amp;#34;, &amp;#34;-rpc.trace&amp;#34;,
	],
	&amp;#34;go.buildTags&amp;#34;: &amp;#34;&amp;#34;,
	&amp;#34;go.buildFlags&amp;#34;: [],
	&amp;#34;go.lintFlags&amp;#34;: [],
	&amp;#34;go.vetFlags&amp;#34;: [],
	&amp;#34;go.coverOnSave&amp;#34;: false,
	&amp;#34;go.useCodeSnippetsOnFunctionSuggest&amp;#34;: false,
	&amp;#34;go.useCodeSnippetsOnFunctionSuggestWithoutType&amp;#34;: true,
	&amp;#34;go.useLanguageServer&amp;#34;: true,
	&amp;#34;go.formatTool&amp;#34;: &amp;#34;goreturns&amp;#34;,
	&amp;#34;go.gocodeAutoBuild&amp;#34;: false,
	&amp;#34;go.gocodePackageLookupMode&amp;#34;: &amp;#34;go&amp;#34;,
	&amp;#34;go.gotoSymbol.includeImports&amp;#34;: true,
	&amp;#34;go.formatOnSave&amp;#34;: true,
	&amp;#34;go.trace.server&amp;#34;: &amp;#34;verbose&amp;#34;,
	&amp;#34;gopls&amp;#34;: {
		&amp;#34;analyses&amp;#34;: {
			&amp;#34;composites&amp;#34;: false
		},
		&amp;#34;usePlaceholders&amp;#34;: false,
	},
	&amp;#34;go.testTimeout&amp;#34;: &amp;#34;1800s&amp;#34;,
	&amp;#34;go.toolsManagement.autoUpdate&amp;#34;: true,
	&amp;#34;go.alternateTools&amp;#34;: { //ç¦ç”¨åŸºæœ¬å»ºè®®
	},
	&amp;#34;go.inferGopath&amp;#34;: true,
	&amp;#34;[go]&amp;#34;: {
		&amp;#34;editor.formatOnSave&amp;#34;: true,
		&amp;#34;editor.codeActionsOnSave&amp;#34;: {
			&amp;#34;source.organizeImports&amp;#34;: true,
		},
	},
	&amp;#34;[go.mod]&amp;#34;: {
		&amp;#34;editor.formatOnSave&amp;#34;: true,
		&amp;#34;editor.codeActionsOnSave&amp;#34;: {
			&amp;#34;source.organizeImports&amp;#34;: true,
		},
	},
	&amp;#34;explorer.confirmDelete&amp;#34;: false,
	&amp;#34;explorer.compactFolders&amp;#34;: false,
	//æ’é™¤æ–‡ä»¶
	&amp;#34;files.exclude&amp;#34;: {
		&amp;#34;/.classpath&amp;#34;: true,
		&amp;#34;/.project&amp;#34;: true,
		&amp;#34;/.settings&amp;#34;: true,
		&amp;#34;/.factorypath&amp;#34;: true,
		&amp;#34;/.idea&amp;#34;: true,
		&amp;#34;/.metadata&amp;#34;: true,
		&amp;#34;/.vscode&amp;#34;: true,
		&amp;#34;/.svn&amp;#34;: true
	},
	&amp;#34;search.exclude&amp;#34;: {
		&amp;#34;/idea&amp;#34;: true,
		&amp;#34;/svn&amp;#34;: true,
		&amp;#34;/node_modules&amp;#34;: true,
		&amp;#34;/bower_components&amp;#34;: true,
		&amp;#34;/env&amp;#34;: true,
		&amp;#34;/venv&amp;#34;: true
	},
	&amp;#34;files.autoSave&amp;#34;: &amp;#34;afterDelay&amp;#34;,
	&amp;#34;files.associations&amp;#34;: {
		&amp;#34;*.vue&amp;#34;: &amp;#34;html&amp;#34;,
		&amp;#34;*.module&amp;#34;: &amp;#34;php&amp;#34;
	},
	&amp;#34;files.watcherExclude&amp;#34;: {
		&amp;#34;/.idea/&amp;#34;: true,
		&amp;#34;/.svn/&amp;#34;: true,
		&amp;#34;/.git/objects/&amp;#34;: true,
		&amp;#34;/.git/subtree-cache/&amp;#34;: true,
		&amp;#34;/node_modules/&amp;#34;: true,
		&amp;#34;/env/&amp;#34;: true,
		&amp;#34;/venv/&amp;#34;: true,
		&amp;#34;env-*&amp;#34;: true
	},
	&amp;#34;editor.inlineSuggest.enabled&amp;#34;: true,
	&amp;#34;auto-rename-tag.activationOnLanguage&amp;#34;: [
		&amp;#34;html&amp;#34;,
		&amp;#34;xml&amp;#34;,
		&amp;#34;php&amp;#34;,
		&amp;#34;javascript&amp;#34;
	],
	&amp;#34;editor.minimap.enabled&amp;#34;: false,
	&amp;#34;window.zoomLevel&amp;#34;: -1,
	&amp;#34;editor.fontSize&amp;#34;: 16,
	&amp;#34;editor.bracketPairColorization.enabled&amp;#34;: true,
}
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Goç›¸å¯¹è·¯å¾„é—®é¢˜</title>
      <link>https://abnerxc.github.io/go/%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/</link>
      <pubDate>Tue, 03 May 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/</guid>
      <description>&lt;h2 id=&#34;é—®é¢˜&#34;&gt;é—®é¢˜ &lt;a href=&#34;#%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;1ã€ go run æˆ‘ä»¬ä¸Šç§»ç›®å½•å±‚çº§ï¼Œåˆ° $GOPATH/src ä¸‹ï¼Œæ‰§è¡Œ go run gin-blog/main.go&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[$]# go run gin-blog/main.go
Fail to parse &amp;#39;conf/app.yam&amp;#39;: open conf/app.ini: no such file or directory
exit status 1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2ã€ go buildï¼Œæ‰§è¡Œ ./gin-blog/main&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[$]# ./gin-blog/main
 Fail to parse &amp;#39;conf/app.ini&amp;#39;: open conf/app.ini: no such file or directory
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯• &lt;a href=&#34;#%e6%b5%8b%e8%af%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ç¼–å†™è·å–å½“å‰è·¯å¾„çš„æ–¹æ³•&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import (
	&amp;#34;path/filepath&amp;#34;
	&amp;#34;os&amp;#34;
	&amp;#34;os/exec&amp;#34;
	&amp;#34;string&amp;#34;
)

func GetAppPath() string {
    file, _ := exec.LookPath(os.Args[0])
    path, _ := filepath.Abs(file)
    index := strings.LastIndex(path, string(os.PathSeparator))

    return path[:index]
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰§è¡Œ&lt;code&gt;go run&lt;/code&gt; å¾—åˆ°&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ go run main.go
C:\Users\abnerï¼ˆ~1\AppData\Local\Temp\go-build536365654\b001\exe
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å‰–æ&#34;&gt;å‰–æ &lt;a href=&#34;#%e5%89%96%e6%9e%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬èšç„¦åœ¨ &lt;code&gt;go run&lt;/code&gt; çš„è¾“å‡ºç»“æœä¸Šï¼Œå‘ç°å®ƒæ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶çš„åœ°å€ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨go help runä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;A Go source file is defined to be a file ending in a literal &amp;#34;.go&amp;#34; suffix.
ä¹Ÿå°±æ˜¯ go run æ‰§è¡Œæ—¶ä¼šå°†æ–‡ä»¶æ”¾åˆ° /tmp/go-build... ç›®å½•ä¸‹ï¼Œç¼–è¯‘å¹¶è¿è¡Œ
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å› æ­¤&lt;code&gt;go run main.go&lt;/code&gt;å‡ºç°/tmp/go-build536365654/b001/exeç»“æœä¹Ÿä¸å¥‡æ€ªäº†ï¼Œå› ä¸ºå®ƒå·²ç»è·‘åˆ°ä¸´æ—¶ç›®å½•ä¸‹å»æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶äº†&lt;/p&gt;
&lt;p&gt;è¿™å°±å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³æƒ³ï¼Œä¼šå‡ºç°å“ªäº›é—®é¢˜å‘¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾èµ–ç›¸å¯¹è·¯å¾„çš„æ–‡ä»¶ï¼Œå‡ºç°è·¯å¾„å‡ºé”™çš„é—®é¢˜&lt;/li&gt;
&lt;li&gt;&lt;code&gt;go run&lt;/code&gt; å’Œ &lt;code&gt;go build&lt;/code&gt; ä¸ä¸€æ ·ï¼Œä¸€ä¸ªåˆ°ä¸´æ—¶ç›®å½•ä¸‹æ‰§è¡Œï¼Œä¸€ä¸ªå¯æ‰‹åŠ¨åœ¨ç¼–è¯‘åçš„ç›®å½•ä¸‹æ‰§è¡Œï¼Œè·¯å¾„çš„å¤„ç†æ–¹å¼ä¼šä¸åŒ&lt;/li&gt;
&lt;li&gt;ä¸æ–­go runï¼Œä¸æ–­äº§ç”Ÿæ–°çš„ä¸´æ—¶æ–‡ä»¶
è¿™å…¶å®å°±æ˜¯æ ¹æœ¬åŸå› äº†ï¼Œå› ä¸º go run å’Œ go build çš„ç¼–è¯‘æ–‡ä»¶æ‰§è¡Œè·¯å¾„å¹¶ä¸åŒï¼Œæ‰§è¡Œçš„å±‚çº§ä¹Ÿæœ‰å¯èƒ½ä¸ä¸€æ ·ï¼Œè‡ªç„¶è€Œç„¶å°±å‡ºç°å„ç§è¯»å–ä¸åˆ°çš„å¥‡æ€ªé—®é¢˜äº†&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è§£å†³æ–¹æ¡ˆ&#34;&gt;è§£å†³æ–¹æ¡ˆ &lt;a href=&#34;#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ä¸€ã€è·å–ç¼–è¯‘åå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
1.	å°†é…ç½®æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ä¸GetAppPath()çš„ç»“æœç›¸æ‹¼æ¥ï¼Œå¯è§£å†³go build main.goçš„å¯æ‰§è¡Œæ–‡ä»¶è·¨ç›®å½•æ‰§è¡Œçš„é—®é¢˜ï¼ˆå¦‚ï¼š./src/gin-blog/mainï¼‰
2.	é€šè¿‡ä¼ é€’å‚æ•°æŒ‡å®šç»å¯¹è·¯å¾„ï¼Œå¯è§£å†³go runçš„é—®é¢˜
äºŒã€å¢åŠ os.Getwd()è¿›è¡Œå¤šå±‚åˆ¤æ–­
å‚è§ &lt;a href=&#34;https://github.com/astaxie/beego/blob/develop/config/config.go&#34;&gt;beego&lt;/a&gt; è¯»å– app.conf çš„ä»£ç &lt;/p&gt;
&lt;p&gt;è¯¥å†™æ³•å¯å…¼å®¹ go build å’Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ &lt;code&gt;go run&lt;/code&gt; ï¼Œä½†æ˜¯è‹¥è·¨ç›®å½•æ‰§è¡Œ &lt;code&gt;go run&lt;/code&gt; å°±ä¸è¡Œ
ä¸‰ã€é…ç½®å…¨å±€ç³»ç»Ÿå˜é‡
æˆ‘ä»¬å¯ä»¥é€šè¿‡os.Getenvæ¥è·å–ç³»ç»Ÿå…¨å±€å˜é‡ï¼Œç„¶åä¸ç›¸å¯¹è·¯å¾„è¿›è¡Œæ‹¼æ¥&lt;/p&gt;
&lt;p&gt;1ã€ è®¾ç½®é¡¹ç›®å·¥ä½œåŒº&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®¾ç½®é¡¹ç›®ï¼ˆåº”ç”¨ï¼‰çš„å·¥ä½œè·¯å¾„ï¼Œç„¶åä¸é…ç½®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ç­‰ç›¸å¯¹è·¯å¾„è¿›è¡Œæ‹¼æ¥ï¼Œè¾¾åˆ°ç›¸å¯¹çš„ç»å¯¹è·¯å¾„æ¥ä¿è¯è·¯å¾„ä¸€è‡´&lt;/p&gt;
&lt;p&gt;å‚è§ gogs è¯»å–GOGS_WORK_DIRè¿›è¡Œæ‹¼æ¥çš„ä»£ç &lt;/p&gt;
&lt;p&gt;2ã€ åˆ©ç”¨ç³»ç»Ÿè‡ªå¸¦å˜é‡&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡ç³»ç»Ÿè‡ªå¸¦çš„å…¨å±€å˜é‡ï¼Œä¾‹å¦‚$HOMEç­‰ï¼Œå°†é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨$HOME/confæˆ–/etc/confä¸‹&lt;/p&gt;
&lt;p&gt;è¿™æ ·å­å°±èƒ½æ›´åŠ å›ºå®šçš„å­˜æ”¾é…ç½®æ–‡ä»¶ï¼Œä¸éœ€è¦é¢å¤–å»è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;h2 id=&#34;æ‹“å±•&#34;&gt;æ‹“å±• &lt;a href=&#34;#%e6%8b%93%e5%b1%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;go test&lt;/code&gt; åœ¨ä¸€äº›åœºæ™¯ä¸‹ä¹Ÿä¼šé‡åˆ°è·¯å¾„é—®é¢˜ï¼Œå› ä¸º&lt;code&gt;go test&lt;/code&gt;åªèƒ½å¤Ÿåœ¨å½“å‰ç›®å½•æ‰§è¡Œï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ï¼Œä½ çš„æ‰§è¡Œç›®å½•å·²ç»æ˜¯æµ‹è¯•ç›®å½•äº†&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé‡‡ç”¨è·å–å¤–éƒ¨å‚æ•°çš„åŠæ³•ï¼Œç”¨ os.args æ—¶ï¼Œgo test -args å’Œ go runã€go build ä¼šæœ‰å‘½ä»¤è¡Œå‚æ•°ä½ç½®çš„ä¸ä¸€è‡´é—®é¢˜&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>gin_validator</title>
      <link>https://abnerxc.github.io/go/gin_validator/</link>
      <pubDate>Sun, 13 Jun 2021 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/gin_validator/</guid>
      <description>&lt;h1 id=&#34;æ¦‚è¿°&#34;&gt;æ¦‚è¿° &lt;a href=&#34;#%e6%a6%82%e8%bf%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨æ¥å£å¼€å‘ç»å¸¸ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜æ˜¯åç«¯éœ€è¦å†™å¤§é‡çš„ç¹çä»£ç è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œæ‰€ä»¥å°±æƒ³ç€æœ‰æ²¡æœ‰åƒå‰ç«¯æ ¡éªŒä¸€æ ·å†™è§„åˆ™è¿›è¡ŒåŒ¹é…æ ¡éªŒï¼Œç„¶åå°±å‘ç°äº†validatoråŒ…ï¼Œä¸€ä¸ªæ¯”è¾ƒå¼ºå¤§çš„æ ¡éªŒå·¥å…·åŒ…ä¸‹é¢æ˜¯ä¸€äº›å­¦ä¹ æ€»ç»“ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥æŸ¥çœ‹&lt;a href=&#34;https://github.com/go-playground/validator&#34;&gt;validator&lt;/a&gt;
åŒ…ä¸‹è½½ï¼šgo get github.com/go-playground/validator/v10&lt;/p&gt;
&lt;h1 id=&#34;æ“ä½œç¬¦è¯´æ˜&#34;&gt;æ“ä½œç¬¦è¯´æ˜ &lt;a href=&#34;#%e6%93%8d%e4%bd%9c%e7%ac%a6%e8%af%b4%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ ‡è®°&lt;/th&gt;
          &lt;th&gt;æ ‡è®°è¯´æ˜&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;,&lt;/td&gt;
          &lt;td&gt;å¤šæ“ä½œç¬¦åˆ†å‰²&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;|&lt;/td&gt;
          &lt;td&gt;æˆ–æ“ä½œç¬¦&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;è·³è¿‡éªŒè¯å­—æ®µ&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;å¸¸ç”¨æ ‡è®°è¯´æ˜&#34;&gt;å¸¸ç”¨æ ‡è®°è¯´æ˜ &lt;a href=&#34;#%e5%b8%b8%e7%94%a8%e6%a0%87%e8%ae%b0%e8%af%b4%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ ‡è®°&lt;/th&gt;
          &lt;th&gt;æ ‡è®°è¯´æ˜&lt;/th&gt;
          &lt;th&gt;ä¾‹&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;required&lt;/td&gt;
          &lt;td&gt;å¿…å¡«&lt;/td&gt;
          &lt;td&gt;Fieldæˆ–Structvalidate:&amp;ldquo;required&amp;rdquo;,å¦‚æœint,0ä½œä¸ºç‰¹æ®Šå¯é€šè¿‡*intåˆ¤æ–­&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;omitempty&lt;/td&gt;
          &lt;td&gt;ç©ºæ—¶å¿½ç•¥&lt;/td&gt;
          &lt;td&gt;Fieldæˆ–Structvalidate:&amp;ldquo;omitempty&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;len&lt;/td&gt;
          &lt;td&gt;é•¿åº¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;len=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;eq&lt;/td&gt;
          &lt;td&gt;ç­‰äº&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;eq=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gt&lt;/td&gt;
          &lt;td&gt;å¤§äº&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;gt=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gte&lt;/td&gt;
          &lt;td&gt;å¤§äºç­‰äº&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;gte=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;lt&lt;/td&gt;
          &lt;td&gt;å°äº&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;lt=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;lte&lt;/td&gt;
          &lt;td&gt;å°äºç­‰äº&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;lte=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;eqfield&lt;/td&gt;
          &lt;td&gt;åŒä¸€ç»“æ„ä½“å­—æ®µç›¸ç­‰&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;eqfield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;nefield&lt;/td&gt;
          &lt;td&gt;åŒä¸€ç»“æ„ä½“å­—æ®µä¸ç›¸ç­‰&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;nefield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gtfield&lt;/td&gt;
          &lt;td&gt;å¤§äºåŒä¸€ç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;gtfield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gtefield&lt;/td&gt;
          &lt;td&gt;å¤§äºç­‰äºåŒä¸€ç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;gtefield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ltfield&lt;/td&gt;
          &lt;td&gt;å°äºåŒä¸€ç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;ltfield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ltefield&lt;/td&gt;
          &lt;td&gt;å°äºç­‰äºåŒä¸€ç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;ltefield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;eqcsfield&lt;/td&gt;
          &lt;td&gt;è·¨ä¸åŒç»“æ„ä½“å­—æ®µç›¸ç­‰&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;eqcsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;necsfield&lt;/td&gt;
          &lt;td&gt;è·¨ä¸åŒç»“æ„ä½“å­—æ®µä¸ç›¸ç­‰&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;necsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gtcsfield&lt;/td&gt;
          &lt;td&gt;å¤§äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;gtcsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gtecsfield&lt;/td&gt;
          &lt;td&gt;å¤§äºç­‰äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;gtecsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ltcsfield&lt;/td&gt;
          &lt;td&gt;å°äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;ltcsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ltecsfield&lt;/td&gt;
          &lt;td&gt;å°äºç­‰äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;ltecsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;min&lt;/td&gt;
          &lt;td&gt;æœ€å¤§å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;min=1&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;max&lt;/td&gt;
          &lt;td&gt;æœ€å°å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;max=2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;structonly&lt;/td&gt;
          &lt;td&gt;ä»…éªŒè¯ç»“æ„ä½“ï¼Œä¸éªŒè¯ä»»ä½•ç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Structvalidate:&amp;ldquo;structonly&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;nostructlevel&lt;/td&gt;
          &lt;td&gt;ä¸è¿è¡Œä»»ä½•ç»“æ„çº§åˆ«çš„éªŒè¯&lt;/td&gt;
          &lt;td&gt;Structvalidate:&amp;ldquo;nostructlevel&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;dive&lt;/td&gt;
          &lt;td&gt;å‘ä¸‹å»¶ä¼¸éªŒè¯ï¼Œå¤šå±‚å‘ä¸‹éœ€è¦å¤šä¸ªdiveæ ‡è®°&lt;/td&gt;
          &lt;td&gt;[][]stringvalidate:&amp;ldquo;gt=0,dive,len=1,dive,required&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;diveKeys&amp;amp;EndKeys&lt;/td&gt;
          &lt;td&gt;ä¸diveåŒæ—¶ä½¿ç”¨ï¼Œç”¨äºå¯¹mapå¯¹è±¡çš„é”®çš„å’Œå€¼çš„éªŒè¯ï¼Œkeysä¸ºé”®ï¼Œendkeysä¸ºå€¼&lt;/td&gt;
          &lt;td&gt;map[string]stringvalidate:&amp;ldquo;gt=0,dive,keys,eq=1|eq=2,endkeys,required&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;required_with&lt;/td&gt;
          &lt;td&gt;å…¶ä»–å­—æ®µå…¶ä¸­ä¸€ä¸ªä¸ä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;required_with=Field1Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;required_with_all&lt;/td&gt;
          &lt;td&gt;å…¶ä»–æ‰€æœ‰å­—æ®µä¸ä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;required_with_all=Field1Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;required_without&lt;/td&gt;
          &lt;td&gt;å…¶ä»–å­—æ®µå…¶ä¸­ä¸€ä¸ªä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º&lt;/td&gt;
          &lt;td&gt;Field`validate:&amp;ldquo;required_without=Field1Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;required_without_all&lt;/td&gt;
          &lt;td&gt;å…¶ä»–æ‰€æœ‰å­—æ®µä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;required_without_all=Field1Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;isdefault&lt;/td&gt;
          &lt;td&gt;æ˜¯é»˜è®¤å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;isdefault=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;oneof&lt;/td&gt;
          &lt;td&gt;å…¶ä¸­ä¹‹ä¸€&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;oneof=579&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;containsfield&lt;/td&gt;
          &lt;td&gt;å­—æ®µåŒ…å«å¦ä¸€ä¸ªå­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;containsfield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;excludesfield&lt;/td&gt;
          &lt;td&gt;å­—æ®µä¸åŒ…å«å¦ä¸€ä¸ªå­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;excludesfield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;unique&lt;/td&gt;
          &lt;td&gt;æ˜¯å¦å”¯ä¸€ï¼Œé€šå¸¸ç”¨äºåˆ‡ç‰‡æˆ–ç»“æ„ä½“&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;unique&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;alphanum&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«ASCIIå­—æ¯æ•°å­—å­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;alphanum&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;alphaunicode&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«unicodeå­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;alphaunicode&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;alphanumunicode&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«unicodeå­—æ¯æ•°å­—å­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;alphanumunicode&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;numeric&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«åŸºæœ¬çš„æ•°å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;numeric&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;hexadecimal&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„åå…­è¿›åˆ¶&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;hexadecimal&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;hexcolor&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„åå…­è¿›åˆ¶é¢œè‰²&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;hexcolor&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;lowercase&lt;/td&gt;
          &lt;td&gt;ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«å°å†™å­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;lowercase&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;uppercase&lt;/td&gt;
          &lt;td&gt;ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«å¤§å†™å­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;uppercase&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;email&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼åŒ…å«ä¸€ä¸ªæœ‰æ•ˆçš„ç”µå­é‚®ä»¶&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;email&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;json&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦ä¸ºæœ‰æ•ˆçš„JSON&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;json&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;file&lt;/td&gt;
          &lt;td&gt;ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„ï¼Œä»¥åŠè¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºè®¡ç®—æœºä¸Š&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;file&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;url&lt;/td&gt;
          &lt;td&gt;ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„url&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;url&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;uri&lt;/td&gt;
          &lt;td&gt;ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„uri&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;uri&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;base64&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„base64å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;base64&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;contains&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼åŒ…å«å­å­—ç¬¦ä¸²å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;contains=@&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;containsany&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼åŒ…å«å­å­—ç¬¦ä¸²å€¼ä¸­çš„ä»»ä½•å­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;containsany=abc&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;containsrune&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼åŒ…å«æä¾›çš„ç‰¹æ®Šç¬¦å·å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;containsrune=â˜¢&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;excludes&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼ä¸åŒ…å«å­å­—ç¬¦ä¸²å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;excludes=@&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;excludesall&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼ä¸åŒ…å«ä»»ä½•å­å­—ç¬¦ä¸²å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;excludesall=abc&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;excludesrune&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼ä¸åŒ…å«æä¾›çš„ç‰¹æ®Šç¬¦å·å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;containsrune=â˜¢&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;startswith&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²ä»¥æä¾›çš„å­—ç¬¦ä¸²å€¼å¼€å§‹&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;startswith=abc&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;endswith&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²ä»¥æä¾›çš„å­—ç¬¦ä¸²å€¼ç»“æŸ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;endswith=abc&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ip&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„IPåœ°å€&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;ip&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ipv4&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ipv4åœ°å€&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;ipv4&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;datetime&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„æ—¥æœŸ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;datetime&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;ä½¿ç”¨ç¤ºä¾‹&#34;&gt;ä½¿ç”¨ç¤ºä¾‹ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ä½¿ç”¨æ³¨æ„&#34;&gt;ä½¿ç”¨æ³¨æ„ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e6%b3%a8%e6%84%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;å½“æœç´¢æ¡ä»¶ä¸ç‰¹æ®Šæ ‡è®°å†²çªæ—¶,å¦‚ï¼šé€—å·ï¼ˆ,ï¼‰ï¼Œæˆ–æ“ä½œï¼ˆ|ï¼‰ï¼Œä¸­æ¨ªçº¿ï¼ˆ-ï¼‰ç­‰åˆ™éœ€è¦ä½¿ç”¨ UTF-8åå…­è¿›åˆ¶è¡¨ç¤ºå½¢å¼&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Test struct {
   Field1 string  `validate:&amp;#34;excludesall=|&amp;#34;`    // é”™è¯¯
   Field2 string `validate:&amp;#34;excludesall=0x7C&amp;#34;` // æ­£ç¡®.
}
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å¯é€šè¿‡validationErrors := errs.(validator.ValidationErrors)è·å–é”™è¯¯å¯¹è±¡è‡ªå®šä¹‰è¿”å›å“åº”é”™è¯¯&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰æ ¡éªŒç»“æœç¿»è¯‘&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// åˆå§‹åŒ–ç¿»è¯‘å™¨
func validateInit() {
	zh_ch := zh.New()
	uni := ut.New(zh_ch)               // ä¸‡èƒ½ç¿»è¯‘å™¨ï¼Œä¿å­˜æ‰€æœ‰çš„è¯­è¨€ç¯å¢ƒå’Œç¿»è¯‘æ•°æ®
	Trans, _ = uni.GetTranslator(&amp;#34;zh&amp;#34;) // ç¿»è¯‘å™¨
	Validate = validator.New()
	_ = zh_translations.RegisterDefaultTranslations(Validate, Trans)
	// æ·»åŠ é¢å¤–ç¿»è¯‘
	_ = Validate.RegisterTranslation(&amp;#34;required_without&amp;#34;, Trans, func(ut ut.Translator) error {
		return ut.Add(&amp;#34;required_without&amp;#34;, &amp;#34;{0} ä¸ºå¿…å¡«å­—æ®µ!&amp;#34;, true)
	}, func(ut ut.Translator, fe validator.FieldError) string {
		t, _ := ut.T(&amp;#34;required_without&amp;#34;, fe.Field())
		return t
	})
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ä½¿ç”¨ç¤ºä¾‹-1&#34;&gt;ä½¿ç”¨ç¤ºä¾‹ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b-1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main
import (
   &amp;#34;fmt&amp;#34;
   &amp;#34;github.com/go-playground/validator/v10&amp;#34;
)
// å®ä¾‹åŒ–éªŒè¯å¯¹è±¡
var validate = validator.New()
func main() {
   // ç»“æ„ä½“éªŒè¯
   type Inner struct {
      String string `validate:&amp;#34;contains=111&amp;#34;`
   }
   inner := &amp;amp;Inner{String: &amp;#34;11@&amp;#34;}
   errs := validate.Struct(inner)
   if errs != nil {
      fmt.Println(errs.Error())
   }
   // å˜é‡éªŒè¯
   m := map[string]string{&amp;#34;&amp;#34;: &amp;#34;&amp;#34;, &amp;#34;val3&amp;#34;: &amp;#34;val3&amp;#34;}
   errs = validate.Var(m, &amp;#34;required,dive,keys,required,endkeys,required&amp;#34;)
   if errs != nil {
      fmt.Println(errs.Error())
   }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ginæ¡†æ¶ä¸­ä½¿ç”¨éªŒè¯å™¨&#34;&gt;ginæ¡†æ¶ä¸­ä½¿ç”¨éªŒè¯å™¨ &lt;a href=&#34;#gin%e6%a1%86%e6%9e%b6%e4%b8%ad%e4%bd%bf%e7%94%a8%e9%aa%8c%e8%af%81%e5%99%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å®šä¹‰é”™è¯¯ç¿»è¯‘å™¨&#34;&gt;å®šä¹‰é”™è¯¯ç¿»è¯‘å™¨ &lt;a href=&#34;#%e5%ae%9a%e4%b9%89%e9%94%99%e8%af%af%e7%bf%bb%e8%af%91%e5%99%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package xcore

import (
	&amp;#34;fmt&amp;#34;
	&amp;#34;github.com/gin-gonic/gin/binding&amp;#34;
	&amp;#34;reflect&amp;#34;
	&amp;#34;strings&amp;#34;
	//ginè¡¨å•éªŒè¯
	&amp;#34;github.com/go-playground/locales/en&amp;#34;
	&amp;#34;github.com/go-playground/locales/zh&amp;#34;
	&amp;#34;github.com/go-playground/universal-translator&amp;#34;
	&amp;#34;github.com/go-playground/validator/v10&amp;#34;
	enTranslations &amp;#34;github.com/go-playground/validator/v10/translations/en&amp;#34;
	zhTranslations &amp;#34;github.com/go-playground/validator/v10/translations/zh&amp;#34;
)

// å®šä¹‰ä¸€ä¸ªå…¨å±€ç¿»è¯‘å™¨
var trans ut.Translator

// InitTrans åˆå§‹åŒ–ç¿»è¯‘å™¨
func InitTrans(locale string) (err error) {
	//ä¿®æ”¹ginæ¡†æ¶ä¸­çš„Validatorå±æ€§ï¼Œå®ç°è‡ªå®šåˆ¶
	if v, ok := binding.Validator.Engine().(*validator.Validate); ok {
		// æ³¨å†Œä¸€ä¸ªè·å–json tagçš„è‡ªå®šä¹‰æ–¹æ³•
		v.RegisterTagNameFunc(func(fld reflect.StructField) string {
			name := strings.SplitN(fld.Tag.Get(&amp;#34;json&amp;#34;), &amp;#34;,&amp;#34;, 2)[0]
			if name == &amp;#34;-&amp;#34; {
				return &amp;#34;&amp;#34;
			}
			return name
		})

		zhT := zh.New() //ä¸­æ–‡ç¿»è¯‘å™¨
		enT := en.New() //è‹±æ–‡ç¿»è¯‘å™¨

		// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¤‡ç”¨ï¼ˆfallbackï¼‰çš„è¯­è¨€ç¯å¢ƒ
		// åé¢çš„å‚æ•°æ˜¯åº”è¯¥æ”¯æŒçš„è¯­è¨€ç¯å¢ƒï¼ˆæ”¯æŒå¤šä¸ªï¼‰
		// uni := ut.New(zhT, zhT) ä¹Ÿæ˜¯å¯ä»¥çš„
		uni := ut.New(enT, zhT, enT)

		// locale é€šå¸¸å–å†³äº http è¯·æ±‚å¤´çš„ &amp;#39;Accept-Language&amp;#39;
		var ok bool
		// ä¹Ÿå¯ä»¥ä½¿ç”¨ uni.FindTranslator(...) ä¼ å…¥å¤šä¸ªlocaleè¿›è¡ŒæŸ¥æ‰¾
		trans, ok = uni.GetTranslator(locale)
		if !ok {
			return fmt.Errorf(&amp;#34;uni.GetTranslator(%s) failed&amp;#34;, locale)
		}

		// æ·»åŠ é¢å¤–ç¿»è¯‘
		_ = v.RegisterTranslation(&amp;#34;required_with&amp;#34;, trans, func(ut ut.Translator) error {
			return ut.Add(&amp;#34;required_with&amp;#34;, &amp;#34;{0} ä¸ºå¿…å¡«å­—æ®µ!&amp;#34;, true)
		}, func(ut ut.Translator, fe validator.FieldError) string {
			t, _ := ut.T(&amp;#34;required_with&amp;#34;, fe.Field())
			return t
		})
		_ = v.RegisterTranslation(&amp;#34;required_without&amp;#34;, trans, func(ut ut.Translator) error {
			return ut.Add(&amp;#34;required_without&amp;#34;, &amp;#34;{0} ä¸ºå¿…å¡«å­—æ®µ!&amp;#34;, true)
		}, func(ut ut.Translator, fe validator.FieldError) string {
			t, _ := ut.T(&amp;#34;required_without&amp;#34;, fe.Field())
			return t
		})
		_ = v.RegisterTranslation(&amp;#34;required_without_all&amp;#34;, trans, func(ut ut.Translator) error {
			return ut.Add(&amp;#34;required_without_all&amp;#34;, &amp;#34;{0} ä¸ºå¿…å¡«å­—æ®µ!&amp;#34;, true)
		}, func(ut ut.Translator, fe validator.FieldError) string {
			t, _ := ut.T(&amp;#34;required_without_all&amp;#34;, fe.Field())
			return t
		})

		// æ³¨å†Œç¿»è¯‘å™¨
		switch locale {
		case &amp;#34;en&amp;#34;:
			err = enTranslations.RegisterDefaultTranslations(v, trans)
		case &amp;#34;zh&amp;#34;:
			err = zhTranslations.RegisterDefaultTranslations(v, trans)
		default:
			err = enTranslations.RegisterDefaultTranslations(v, trans)
		}
		return
	}
	return
}

func addValueToMap(fields map[string]string) map[string]interface{} {
	res := make(map[string]interface{})
	for field, err := range fields {
		fieldArr := strings.SplitN(field, &amp;#34;.&amp;#34;, 2)
		if len(fieldArr) &amp;gt; 1 {
			NewFields := map[string]string{fieldArr[1]: err}
			returnMap := addValueToMap(NewFields)
			if res[fieldArr[0]] != nil {
				for k, v := range returnMap {
					res[fieldArr[0]].(map[string]interface{})[k] = v
				}
			} else {
				res[fieldArr[0]] = returnMap
			}
			continue
		} else {
			res[field] = err
			continue
		}
	}
	return res
}

// å»æ‰ç»“æ„ä½“åç§°å‰ç¼€
func removeTopStruct(fields map[string]string) map[string]interface{} {
	lowerMap := map[string]string{}
	for field, err := range fields {
		fieldArr := strings.SplitN(field, &amp;#34;.&amp;#34;, 2)
		lowerMap[fieldArr[1]] = err
	}
	res := addValueToMap(lowerMap)
	return res
}

//handlerä¸­è°ƒç”¨çš„é”™è¯¯ç¿»è¯‘æ–¹æ³•
func ValidatorError(err error) map[string]interface{} {
	errs, ok := err.(validator.ValidationErrors)
	if ok {
		return removeTopStruct(errs.Translate(trans))
	}
	return nil
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ä½¿ç”¨&#34;&gt;ä½¿ç”¨ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (c *IndexController) Validator(ctx *gin.Context) {
	req := requests.AdminReq{}
	if err := ctx.ShouldBindJSON(&amp;amp;req); err != nil {
		ctx.JSON(http.StatusBadRequest, gin.H{&amp;#34;error&amp;#34;: xcore.ValidatorError(err)})
		return
	}
	ctx.JSON(http.StatusNotFound, &amp;#34;ok&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Go-GMPæ¨¡å‹</title>
      <link>https://abnerxc.github.io/go/gmp%E6%A8%A1%E5%9E%8B/</link>
      <pubDate>Sun, 13 Jun 2021 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/gmp%E6%A8%A1%E5%9E%8B/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://learnku.com/articles/41728&#34;&gt;https://learnku.com/articles/41728&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;gmp-æ¨¡å‹&#34;&gt;GMP æ¨¡å‹ &lt;a href=&#34;#gmp-%e6%a8%a1%e5%9e%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-gmp-a.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;G= Goroutine åç¨‹ï¼ŒP=Processor å¤„ç†å™¨ï¼Œ M=Thread çº¿ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…¨å±€é˜Ÿåˆ—ï¼ˆGlobal Queueï¼‰ï¼šå­˜æ”¾ç­‰å¾…è¿è¡Œçš„ Gã€‚&lt;/li&gt;
&lt;li&gt;P çš„æœ¬åœ°é˜Ÿåˆ—ï¼šåŒå…¨å±€é˜Ÿåˆ—ç±»ä¼¼ï¼Œå­˜æ”¾çš„ä¹Ÿæ˜¯ç­‰å¾…è¿è¡Œçš„ Gï¼Œå­˜çš„æ•°é‡æœ‰é™ï¼Œä¸è¶…è¿‡ 256 ä¸ªã€‚æ–°å»º Gâ€™æ—¶ï¼ŒGâ€™ä¼˜å…ˆåŠ å…¥åˆ° P çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ™ä¼šæŠŠæœ¬åœ°é˜Ÿåˆ—ä¸­ä¸€åŠçš„ G ç§»åŠ¨åˆ°å…¨å±€é˜Ÿåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;P åˆ—è¡¨ï¼šæ‰€æœ‰çš„ P éƒ½åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºï¼Œå¹¶ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œæœ€å¤šæœ‰ GOMAXPROCS(å¯é…ç½®) ä¸ªã€‚&lt;/li&gt;
&lt;li&gt;Mï¼šçº¿ç¨‹æƒ³è¿è¡Œä»»åŠ¡å°±å¾—è·å– Pï¼Œä» P çš„æœ¬åœ°é˜Ÿåˆ—è·å– Gï¼ŒP é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒM ä¹Ÿä¼šå°è¯•ä»å…¨å±€é˜Ÿåˆ—æ‹¿ä¸€æ‰¹ G æ”¾åˆ° P çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œæˆ–ä»å…¶ä»– P çš„æœ¬åœ°é˜Ÿåˆ—å·ä¸€åŠæ”¾åˆ°è‡ªå·± P çš„æœ¬åœ°é˜Ÿåˆ—ã€‚M è¿è¡Œ Gï¼ŒG æ‰§è¡Œä¹‹åï¼ŒM ä¼šä» P è·å–ä¸‹ä¸€ä¸ª Gï¼Œä¸æ–­é‡å¤ä¸‹å»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Goroutine è°ƒåº¦å™¨å’Œ OS è°ƒåº¦å™¨æ˜¯é€šè¿‡ M ç»“åˆèµ·æ¥çš„ï¼Œæ¯ä¸ª M éƒ½ä»£è¡¨äº† 1 ä¸ªå†…æ ¸çº¿ç¨‹ï¼ŒOS è°ƒåº¦å™¨è´Ÿè´£æŠŠå†…æ ¸çº¿ç¨‹åˆ†é…åˆ° CPU çš„æ ¸ä¸Šæ‰§è¡Œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;æœ‰å…³-p-å’Œ-m-çš„ä¸ªæ•°é—®é¢˜&#34;&gt;æœ‰å…³ P å’Œ M çš„ä¸ªæ•°é—®é¢˜ &lt;a href=&#34;#%e6%9c%89%e5%85%b3-p-%e5%92%8c-m-%e7%9a%84%e4%b8%aa%e6%95%b0%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;Pçš„æ•°é‡ï¼š ç”±å¯åŠ¨æ—¶ç¯å¢ƒå˜é‡ $GOMAXPROCS æˆ–è€…æ˜¯ç”± runtime çš„æ–¹æ³• GOMAXPROCS() å†³å®šã€‚è¿™æ„å‘³ç€åœ¨ç¨‹åºæ‰§è¡Œçš„ä»»æ„æ—¶åˆ»éƒ½åªæœ‰ $GOMAXPROCS ä¸ª goroutine åœ¨åŒæ—¶è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;Mçš„æ•°é‡ï¼š
&lt;ul&gt;
&lt;li&gt;go è¯­è¨€æœ¬èº«çš„é™åˆ¶ï¼šgo ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šè®¾ç½® M çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ 10000. ä½†æ˜¯å†…æ ¸å¾ˆéš¾æ”¯æŒè¿™ä¹ˆå¤šçš„çº¿ç¨‹æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªé™åˆ¶å¯ä»¥å¿½ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;runtime/debug ä¸­çš„ SetMaxThreads å‡½æ•°ï¼Œè®¾ç½® M çš„æœ€å¤§æ•°é‡&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ª M é˜»å¡äº†ï¼Œä¼šåˆ›å»ºæ–°çš„ Mã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;M ä¸ P çš„æ•°é‡æ²¡æœ‰ç»å¯¹å…³ç³»ï¼Œä¸€ä¸ª M é˜»å¡ï¼ŒP å°±ä¼šå»åˆ›å»ºæˆ–è€…åˆ‡æ¢å¦ä¸€ä¸ª Mï¼Œæ‰€ä»¥ï¼Œå³ä½¿ P çš„é»˜è®¤æ•°é‡æ˜¯ 1ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåˆ›å»ºå¾ˆå¤šä¸ª M å‡ºæ¥ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;p-å’Œ-m-ä½•æ—¶ä¼šè¢«åˆ›å»º&#34;&gt;P å’Œ M ä½•æ—¶ä¼šè¢«åˆ›å»º &lt;a href=&#34;#p-%e5%92%8c-m-%e4%bd%95%e6%97%b6%e4%bc%9a%e8%a2%ab%e5%88%9b%e5%bb%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;P ä½•æ—¶åˆ›å»ºï¼šåœ¨ç¡®å®šäº† P çš„æœ€å¤§æ•°é‡ n åï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæ ¹æ®è¿™ä¸ªæ•°é‡åˆ›å»º n ä¸ª Pã€‚&lt;/li&gt;
&lt;li&gt;M ä½•æ—¶åˆ›å»ºï¼šæ²¡æœ‰è¶³å¤Ÿçš„ M æ¥å…³è” P å¹¶è¿è¡Œå…¶ä¸­çš„å¯è¿è¡Œçš„ Gã€‚æ¯”å¦‚æ‰€æœ‰çš„ M æ­¤æ—¶éƒ½é˜»å¡ä½äº†ï¼Œè€Œ P ä¸­è¿˜æœ‰å¾ˆå¤šå°±ç»ªä»»åŠ¡ï¼Œå°±ä¼šå»å¯»æ‰¾ç©ºé—²çš„ Mï¼Œè€Œæ²¡æœ‰ç©ºé—²çš„ï¼Œå°±ä¼šå»åˆ›å»ºæ–°çš„ Mã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥&#34;&gt;è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥ &lt;a href=&#34;#%e8%b0%83%e5%ba%a6%e5%99%a8%e7%9a%84%e8%ae%be%e8%ae%a1%e7%ad%96%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¤ç”¨çº¿ç¨‹ï¼šé¿å…é¢‘ç¹çš„åˆ›å»ºã€é”€æ¯çº¿ç¨‹ï¼Œè€Œæ˜¯å¯¹çº¿ç¨‹çš„å¤ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;work stealing æœºåˆ¶ï¼šå½“æœ¬çº¿ç¨‹æ— å¯è¿è¡Œçš„ G æ—¶ï¼Œå°è¯•ä»å…¶ä»–çº¿ç¨‹ç»‘å®šçš„ P å·å– Gï¼Œè€Œä¸æ˜¯é”€æ¯çº¿ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;hand off æœºåˆ¶ï¼šâ€‹ å½“æœ¬çº¿ç¨‹å› ä¸º G è¿›è¡Œç³»ç»Ÿè°ƒç”¨é˜»å¡æ—¶ï¼Œçº¿ç¨‹é‡Šæ”¾ç»‘å®šçš„ Pï¼ŒæŠŠ P è½¬ç§»ç»™å…¶ä»–ç©ºé—²çš„çº¿ç¨‹æ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ©ç”¨å¹¶è¡Œï¼š&lt;code&gt;GOMAXPROCS&lt;/code&gt; è®¾ç½® P çš„æ•°é‡ï¼Œæœ€å¤šæœ‰ &lt;code&gt;GOMAXPROCS&lt;/code&gt; ä¸ªçº¿ç¨‹åˆ†å¸ƒåœ¨å¤šä¸ª CPU ä¸ŠåŒæ—¶è¿è¡Œã€‚&lt;code&gt;GOMAXPROCS&lt;/code&gt; ä¹Ÿé™åˆ¶äº†å¹¶å‘çš„ç¨‹åº¦ï¼Œæ¯”å¦‚ &lt;code&gt;GOMAXPROCS= æ ¸æ•°/2&lt;/code&gt;ï¼Œåˆ™æœ€å¤šåˆ©ç”¨äº†ä¸€åŠçš„ CPU æ ¸è¿›è¡Œå¹¶è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŠ¢å ï¼šåœ¨ coroutine ä¸­è¦ç­‰å¾…ä¸€ä¸ªåç¨‹ä¸»åŠ¨è®©å‡º CPU æ‰æ‰§è¡Œä¸‹ä¸€ä¸ªåç¨‹ï¼Œ
&lt;code&gt;åœ¨ Go ä¸­ï¼Œä¸€ä¸ª goroutine æœ€å¤šå ç”¨ CPU 10msï¼Œ é˜²æ­¢å…¶ä»– goroutine è¢«é¥¿æ­»ï¼Œè¿™å°±æ˜¯ goroutine ä¸åŒäº coroutine çš„ä¸€ä¸ªåœ°æ–¹&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¨å±€ G é˜Ÿåˆ—ï¼šåœ¨æ–°çš„è°ƒåº¦å™¨ä¸­ä¾ç„¶æœ‰å…¨å±€ G é˜Ÿåˆ—ï¼Œä½†åŠŸèƒ½å·²ç»è¢«å¼±åŒ–äº†ï¼Œå½“ M æ‰§è¡Œ work stealing ä»å…¶ä»– P å·ä¸åˆ° G æ—¶ï¼Œå®ƒå¯ä»¥ä»å…¨å±€ G é˜Ÿåˆ—è·å– Gã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;go-func--è°ƒåº¦æµç¨‹&#34;&gt;go func () è°ƒåº¦æµç¨‹ &lt;a href=&#34;#go-func--%e8%b0%83%e5%ba%a6%e6%b5%81%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-gmp-b.jpeg&#34; alt=&#34;2.jpg&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬é€šè¿‡ go func () æ¥åˆ›å»ºä¸€ä¸ª goroutineï¼›&lt;/li&gt;
&lt;li&gt;æœ‰ä¸¤ä¸ªå­˜å‚¨ G çš„é˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯å±€éƒ¨è°ƒåº¦å™¨ P çš„æœ¬åœ°é˜Ÿåˆ—ã€ä¸€ä¸ªæ˜¯å…¨å±€ G é˜Ÿåˆ—ã€‚æ–°åˆ›å»ºçš„ G ä¼šå…ˆä¿å­˜åœ¨ P çš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœ P çš„æœ¬åœ°é˜Ÿåˆ—å·²ç»æ»¡äº†å°±ä¼šä¿å­˜åœ¨å…¨å±€çš„é˜Ÿåˆ—ä¸­ï¼›
â€‹3. G åªèƒ½è¿è¡Œåœ¨ M ä¸­ï¼Œä¸€ä¸ª M å¿…é¡»æŒæœ‰ä¸€ä¸ª Pï¼ŒM ä¸ P æ˜¯ 1ï¼š1 çš„å…³ç³»ã€‚M ä¼šä» P çš„æœ¬åœ°é˜Ÿåˆ—å¼¹å‡ºä¸€ä¸ªå¯æ‰§è¡ŒçŠ¶æ€çš„ G æ¥æ‰§è¡Œï¼Œå¦‚æœ P çš„æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œå°±ä¼šæƒ³å…¶ä»–çš„ MP ç»„åˆå·å–ä¸€ä¸ªå¯æ‰§è¡Œçš„ G æ¥æ‰§è¡Œï¼›
â€‹4. ä¸€ä¸ª M è°ƒåº¦ G æ‰§è¡Œçš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªå¾ªç¯æœºåˆ¶ï¼›&lt;/li&gt;
&lt;li&gt;å½“ M æ‰§è¡ŒæŸä¸€ä¸ª G æ—¶å€™å¦‚æœå‘ç”Ÿäº† syscall æˆ–åˆ™å…¶ä½™é˜»å¡æ“ä½œï¼ŒM ä¼šé˜»å¡ï¼Œå¦‚æœå½“å‰æœ‰ä¸€äº› G åœ¨æ‰§è¡Œï¼Œruntime ä¼šæŠŠè¿™ä¸ªçº¿ç¨‹ M ä» P ä¸­æ‘˜é™¤ (detach)ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªæ–°çš„æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ (å¦‚æœæœ‰ç©ºé—²çš„çº¿ç¨‹å¯ç”¨å°±å¤ç”¨ç©ºé—²çº¿ç¨‹) æ¥æœåŠ¡äºè¿™ä¸ª Pï¼›&lt;/li&gt;
&lt;li&gt;å½“ M ç³»ç»Ÿè°ƒç”¨ç»“æŸæ—¶å€™ï¼Œè¿™ä¸ª G ä¼šå°è¯•è·å–ä¸€ä¸ªç©ºé—²çš„ P æ‰§è¡Œï¼Œå¹¶æ”¾å…¥åˆ°è¿™ä¸ª P çš„æœ¬åœ°é˜Ÿåˆ—ã€‚å¦‚æœè·å–ä¸åˆ° Pï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹ M å˜æˆä¼‘çœ çŠ¶æ€ï¼Œ åŠ å…¥åˆ°ç©ºé—²çº¿ç¨‹ä¸­ï¼Œç„¶åè¿™ä¸ª G ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ&#34;&gt;è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ &lt;a href=&#34;#%e8%b0%83%e5%ba%a6%e5%99%a8%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-gmp-c.jpeg&#34; alt=&#34;2.jpg&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç‰¹æ®Šçš„-m0-å’Œ-g0&#34;&gt;ç‰¹æ®Šçš„ M0 å’Œ G0 &lt;a href=&#34;#%e7%89%b9%e6%ae%8a%e7%9a%84-m0-%e5%92%8c-g0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;M0 æ˜¯å¯åŠ¨ç¨‹åºåçš„ç¼–å·ä¸º 0 çš„ä¸»çº¿ç¨‹ï¼Œè¿™ä¸ª M å¯¹åº”çš„å®ä¾‹ä¼šåœ¨å…¨å±€å˜é‡ runtime.m0 ä¸­ï¼Œä¸éœ€è¦åœ¨ heap ä¸Šåˆ†é…ï¼ŒM0 è´Ÿè´£æ‰§è¡Œåˆå§‹åŒ–æ“ä½œå’Œå¯åŠ¨ç¬¬ä¸€ä¸ª Gï¼Œ åœ¨ä¹‹å M0 å°±å’Œå…¶ä»–çš„ M ä¸€æ ·äº†ã€‚&lt;/li&gt;
&lt;li&gt;GO æ˜¯æ¯æ¬¡å¯åŠ¨ä¸€ä¸ª M éƒ½ä¼šç¬¬ä¸€ä¸ªåˆ›å»ºçš„ gourtineï¼ŒG0 ä»…ç”¨äºè´Ÿè´£è°ƒåº¦çš„ Gï¼ŒG0 ä¸æŒ‡å‘ä»»ä½•å¯æ‰§è¡Œçš„å‡½æ•°ï¼Œæ¯ä¸ª M éƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„ G0ã€‚åœ¨è°ƒåº¦æˆ–ç³»ç»Ÿè°ƒç”¨æ—¶ä¼šä½¿ç”¨ G0 çš„æ ˆç©ºé—´ï¼Œå…¨å±€å˜é‡çš„ G0 æ˜¯ M0 çš„ G0ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¯è§†åŒ–-gmp-ç¼–ç¨‹&#34;&gt;å¯è§†åŒ– GMP ç¼–ç¨‹ &lt;a href=&#34;#%e5%8f%af%e8%a7%86%e5%8c%96-gmp-%e7%bc%96%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;æ–¹å¼ 1ï¼šgo tool trace&lt;/li&gt;
&lt;li&gt;æ–¹å¼ 2ï¼šDebug trace&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Go-æ·±å…¥è§£æsliceåº•å±‚å®ç°</title>
      <link>https://abnerxc.github.io/go/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90slice%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/</link>
      <pubDate>Sat, 15 May 2021 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90slice%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/</guid>
      <description>&lt;p&gt;åŸæ–‡åœ°å€ï¼šhttps://halfrost.com/go_slice/&lt;/p&gt;
&lt;p&gt;åˆ‡ç‰‡æ˜¯ Go ä¸­çš„ä¸€ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼Œä½¿ç”¨è¿™ç§ç»“æ„å¯ä»¥ç”¨æ¥ç®¡ç†æ•°æ®é›†åˆã€‚åˆ‡ç‰‡çš„è®¾è®¡æƒ³æ³•æ˜¯ç”±åŠ¨æ€æ•°ç»„æ¦‚å¿µè€Œæ¥ï¼Œä¸ºäº†å¼€å‘è€…å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ä½¿ä¸€ä¸ªæ•°æ®ç»“æ„å¯ä»¥è‡ªåŠ¨å¢åŠ å’Œå‡å°‘ã€‚ä½†æ˜¯åˆ‡ç‰‡æœ¬èº«å¹¶ä¸æ˜¯åŠ¨æ€æ•°æ®æˆ–è€…æ•°ç»„æŒ‡é’ˆã€‚åˆ‡ç‰‡å¸¸è§çš„æ“ä½œæœ‰ resliceã€appendã€copyã€‚ä¸æ­¤åŒæ—¶ï¼Œåˆ‡ç‰‡è¿˜å…·æœ‰å¯ç´¢å¼•ï¼Œå¯è¿­ä»£çš„ä¼˜ç§€ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;åˆ‡ç‰‡å’Œæ•°ç»„&#34;&gt;åˆ‡ç‰‡å’Œæ•°ç»„ &lt;a href=&#34;#%e5%88%87%e7%89%87%e5%92%8c%e6%95%b0%e7%bb%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨ Go ä¸­ï¼Œä¸ C æ•°ç»„å˜é‡éšå¼ä½œä¸ºæŒ‡é’ˆä½¿ç”¨ä¸åŒï¼ŒGo æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œèµ‹å€¼å’Œå‡½æ•°ä¼ å‚æ“ä½œéƒ½ä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„æ•°æ®ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	arrayA := [2]int{100, 200}
	var arrayB [2]int

	arrayB = arrayA

	fmt.Printf(&amp;#34;arrayA : %p , %v\n&amp;#34;, &amp;amp;arrayA, arrayA)
	fmt.Printf(&amp;#34;arrayB : %p , %v\n&amp;#34;, &amp;amp;arrayB, arrayB)

	testArray(arrayA)
}

func testArray(x [2]int) {
	fmt.Printf(&amp;#34;func Array : %p , %v\n&amp;#34;, &amp;amp;x, x)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰“å°ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;arrayA : 0xc4200bebf0 , [100 200]
arrayB : 0xc4200bec00 , [100 200]
func Array : 0xc4200bec30 , [100 200]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œä¸‰ä¸ªå†…å­˜åœ°å€éƒ½ä¸åŒï¼Œè¿™ä¹Ÿå°±éªŒè¯äº† Go ä¸­æ•°ç»„èµ‹å€¼å’Œå‡½æ•°ä¼ å‚éƒ½æ˜¯å€¼å¤åˆ¶çš„ã€‚é‚£è¿™ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å‡æƒ³æ¯æ¬¡ä¼ å‚éƒ½ç”¨æ•°ç»„ï¼Œé‚£ä¹ˆæ¯æ¬¡æ•°ç»„éƒ½è¦è¢«å¤åˆ¶ä¸€éã€‚å¦‚æœæ•°ç»„å¤§å°æœ‰ 100ä¸‡ï¼Œåœ¨64ä½æœºå™¨ä¸Šå°±éœ€è¦èŠ±è´¹å¤§çº¦ 800W å­—èŠ‚ï¼Œå³ 8MB å†…å­˜ã€‚è¿™æ ·ä¼šæ¶ˆè€—æ‰å¤§é‡çš„å†…å­˜ã€‚äºæ˜¯ä¹æœ‰äººæƒ³åˆ°ï¼Œå‡½æ•°ä¼ å‚ç”¨æ•°ç»„çš„æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	arrayA := []int{100, 200}
	testArrayPoint(&amp;amp;arrayA)   // 1.ä¼ æ•°ç»„æŒ‡é’ˆ
	arrayB := arrayA[:]
	testArrayPoint(&amp;amp;arrayB)   // 2.ä¼ åˆ‡ç‰‡
	fmt.Printf(&amp;#34;arrayA : %p , %v\n&amp;#34;, &amp;amp;arrayA, arrayA)
}

func testArrayPoint(x *[]int) {
	fmt.Printf(&amp;#34;func Array : %p , %v\n&amp;#34;, x, *x)
	(*x)[1] += 100
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰“å°ç»“æœ:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Array : 0xc4200b0140 , [100 200]
func Array : 0xc4200b0180 , [100 300]
arrayA : 0xc4200b0140 , [100 400]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™ä¹Ÿå°±è¯æ˜äº†æ•°ç»„æŒ‡é’ˆç¡®å®åˆ°è¾¾äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚ç°åœ¨å°±ç®—æ˜¯ä¼ å…¥10äº¿çš„æ•°ç»„ï¼Œä¹Ÿåªéœ€è¦å†æ ˆä¸Šåˆ†é…ä¸€ä¸ª8ä¸ªå­—èŠ‚çš„å†…å­˜ç»™æŒ‡é’ˆå°±å¯ä»¥äº†ã€‚è¿™æ ·æ›´åŠ é«˜æ•ˆçš„åˆ©ç”¨å†…å­˜ï¼Œæ€§èƒ½ä¹Ÿæ¯”ä¹‹å‰çš„å¥½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ä¼ æŒ‡é’ˆä¼šæœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œä»æ‰“å°ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€è¡Œå’Œç¬¬ä¸‰è¡ŒæŒ‡é’ˆåœ°å€éƒ½æ˜¯åŒä¸€ä¸ªï¼Œä¸‡ä¸€åŸæ•°ç»„çš„æŒ‡é’ˆæŒ‡å‘æ›´æ”¹äº†ï¼Œé‚£ä¹ˆå‡½æ•°é‡Œé¢çš„æŒ‡é’ˆæŒ‡å‘éƒ½ä¼šè·Ÿç€æ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;åˆ‡ç‰‡çš„ä¼˜åŠ¿ä¹Ÿå°±è¡¨ç°å‡ºæ¥äº†ã€‚ç”¨åˆ‡ç‰‡ä¼ æ•°ç»„å‚æ•°ï¼Œæ—¢å¯ä»¥è¾¾åˆ°èŠ‚çº¦å†…å­˜çš„ç›®çš„ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°åˆç†å¤„ç†å¥½å…±äº«å†…å­˜çš„é—®é¢˜ã€‚æ‰“å°ç»“æœç¬¬äºŒè¡Œå°±æ˜¯åˆ‡ç‰‡ï¼Œåˆ‡ç‰‡çš„æŒ‡é’ˆå’ŒåŸæ¥æ•°ç»„çš„æŒ‡é’ˆæ˜¯ä¸åŒçš„ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š&lt;/p&gt;
&lt;p&gt;æŠŠç¬¬ä¸€ä¸ªå¤§æ•°ç»„ä¼ é€’ç»™å‡½æ•°ä¼šæ¶ˆè€—å¾ˆå¤šå†…å­˜ï¼Œé‡‡ç”¨åˆ‡ç‰‡çš„æ–¹å¼ä¼ å‚å¯ä»¥é¿å…ä¸Šè¿°é—®é¢˜ã€‚åˆ‡ç‰‡æ˜¯å¼•ç”¨ä¼ é€’ï¼Œæ‰€ä»¥å®ƒä»¬ä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„å†…å­˜å¹¶ä¸”æ¯”ä½¿ç”¨æ•°ç»„æ›´æœ‰æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œä¾æ—§æœ‰åä¾‹ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import &amp;#34;testing&amp;#34;

func array() [1024]int {
	var x [1024]int
	for i := 0; i &amp;lt; len(x); i++ {
		x[i] = i
	}
	return x
}

func slice() []int {
	x := make([]int, 1024)
	for i := 0; i &amp;lt; len(x); i++ {
		x[i] = i
	}
	return x
}

func BenchmarkArray(b *testing.B) {
	for i := 0; i &amp;lt; b.N; i++ {
		array()
	}
}

func BenchmarkSlice(b *testing.B) {
	for i := 0; i &amp;lt; b.N; i++ {
		slice()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬åšä¸€æ¬¡æ€§èƒ½æµ‹è¯•ï¼Œå¹¶ä¸”ç¦ç”¨å†…è”å’Œä¼˜åŒ–ï¼Œæ¥è§‚å¯Ÿåˆ‡ç‰‡çš„å †ä¸Šå†…å­˜åˆ†é…çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  go test -bench . -benchmem -gcflags &amp;#34;-N -l&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¾“å‡ºç»“æœæ¯”è¾ƒâ€œä»¤äººæ„å¤–â€ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkArray-4          500000              3637 ns/op               0 B/op          0 alloc s/op
BenchmarkSlice-4          300000              4055 ns/op            8192 B/op          1 alloc s/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è§£é‡Šä¸€ä¸‹ä¸Šè¿°ç»“æœï¼Œåœ¨æµ‹è¯• Array çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯4æ ¸ï¼Œå¾ªç¯æ¬¡æ•°æ˜¯500000ï¼Œå¹³å‡æ¯æ¬¡æ‰§è¡Œæ—¶é—´æ˜¯3637 nsï¼Œæ¯æ¬¡æ‰§è¡Œå †ä¸Šåˆ†é…å†…å­˜æ€»é‡æ˜¯0ï¼Œåˆ†é…æ¬¡æ•°ä¹Ÿæ˜¯0 ã€‚&lt;/p&gt;
&lt;p&gt;è€Œåˆ‡ç‰‡çš„ç»“æœå°±â€œå·®â€ä¸€ç‚¹ï¼ŒåŒæ ·ä¹Ÿæ˜¯ç”¨çš„æ˜¯4æ ¸ï¼Œå¾ªç¯æ¬¡æ•°æ˜¯300000ï¼Œå¹³å‡æ¯æ¬¡æ‰§è¡Œæ—¶é—´æ˜¯4055 nsï¼Œä½†æ˜¯æ¯æ¬¡æ‰§è¡Œä¸€æ¬¡ï¼Œå †ä¸Šåˆ†é…å†…å­˜æ€»é‡æ˜¯8192ï¼Œåˆ†é…æ¬¡æ•°ä¹Ÿæ˜¯1 ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·å¯¹æ¯”çœ‹æ¥ï¼Œå¹¶éæ‰€æœ‰æ—¶å€™éƒ½é€‚åˆç”¨åˆ‡ç‰‡ä»£æ›¿æ•°ç»„ï¼Œå› ä¸ºåˆ‡ç‰‡åº•å±‚æ•°ç»„å¯èƒ½ä¼šåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œè€Œä¸”å°æ•°ç»„åœ¨æ ˆä¸Šæ‹·è´çš„æ¶ˆè€—ä¹Ÿæœªå¿…æ¯” make æ¶ˆè€—å¤§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;åˆ‡ç‰‡ä¸Šçš„æ•°æ®ç»“æ„&#34;&gt;åˆ‡ç‰‡ä¸Šçš„æ•°æ®ç»“æ„ &lt;a href=&#34;#%e5%88%87%e7%89%87%e4%b8%8a%e7%9a%84%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åˆ‡ç‰‡æœ¬èº«å¹¶ä¸æ˜¯åŠ¨æ€æ•°ç»„æˆ–è€…æ•°ç»„æŒ‡é’ˆã€‚å®ƒå†…éƒ¨å®ç°çš„æ•°æ®ç»“æ„é€šè¿‡æŒ‡é’ˆå¼•ç”¨åº•å±‚æ•°ç»„ï¼Œè®¾å®šç›¸å…³å±æ€§å°†æ•°æ®è¯»å†™æ“ä½œé™å®šåœ¨æŒ‡å®šçš„åŒºåŸŸå†…ã€‚&lt;strong&gt;åˆ‡ç‰‡æœ¬èº«æ˜¯ä¸€ä¸ªåªè¯»å¯¹è±¡ï¼Œå…¶å·¥ä½œæœºåˆ¶ç±»ä¼¼æ•°ç»„æŒ‡é’ˆçš„ä¸€ç§å°è£…ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åˆ‡ç‰‡ï¼ˆsliceï¼‰æ˜¯å¯¹æ•°ç»„ä¸€ä¸ªè¿ç»­ç‰‡æ®µçš„å¼•ç”¨ï¼Œæ‰€ä»¥åˆ‡ç‰‡æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼ˆå› æ­¤æ›´ç±»ä¼¼äº C/C++ ä¸­çš„æ•°ç»„ç±»å‹ï¼Œæˆ–è€… Python ä¸­çš„ list ç±»å‹ï¼‰ã€‚è¿™ä¸ªç‰‡æ®µå¯ä»¥æ˜¯æ•´ä¸ªæ•°ç»„ï¼Œæˆ–è€…æ˜¯ç”±èµ·å§‹å’Œç»ˆæ­¢ç´¢å¼•æ ‡è¯†çš„ä¸€äº›é¡¹çš„å­é›†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»ˆæ­¢ç´¢å¼•æ ‡è¯†çš„é¡¹ä¸åŒ…æ‹¬åœ¨åˆ‡ç‰‡å†…ã€‚åˆ‡ç‰‡æä¾›äº†ä¸€ä¸ªä¸æŒ‡å‘æ•°ç»„çš„åŠ¨æ€çª—å£ã€‚&lt;/p&gt;
&lt;p&gt;ç»™å®šé¡¹çš„åˆ‡ç‰‡ç´¢å¼•å¯èƒ½æ¯”ç›¸å…³æ•°ç»„çš„ç›¸åŒå…ƒç´ çš„ç´¢å¼•å°ã€‚å’Œæ•°ç»„ä¸åŒçš„æ˜¯ï¼Œåˆ‡ç‰‡çš„é•¿åº¦å¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹ï¼Œæœ€å°ä¸º 0 æœ€å¤§ä¸ºç›¸å…³æ•°ç»„çš„é•¿åº¦ï¼šåˆ‡ç‰‡æ˜¯ä¸€ä¸ªé•¿åº¦å¯å˜çš„æ•°ç»„ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type slice struct {
	array unsafe.Pointer
	len   int
	cap   int
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s1.jpeg&#34; alt=&#34;slice_å†…å­˜æ¨¡å‹&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆ‡ç‰‡çš„ç»“æ„ä½“ç”±3éƒ¨åˆ†æ„æˆï¼ŒPointer æ˜¯æŒ‡å‘ä¸€ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼Œlen ä»£è¡¨å½“å‰åˆ‡ç‰‡çš„é•¿åº¦ï¼Œcap æ˜¯å½“å‰åˆ‡ç‰‡çš„å®¹é‡ã€‚cap æ€»æ˜¯å¤§äºç­‰äº len çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s2.jpeg&#34; alt=&#34;57_3.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³ä» slice ä¸­å¾—åˆ°ä¸€å—å†…å­˜åœ°å€ï¼Œå¯ä»¥è¿™æ ·åšï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;s := make([]byte, 200)
ptr := unsafe.Pointer(&amp;amp;s[0])
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœåè¿‡æ¥å‘¢ï¼Ÿä» Go çš„å†…å­˜åœ°å€ä¸­æ„é€ ä¸€ä¸ª sliceã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var ptr unsafe.Pointer
var s1 = struct {
    addr uintptr
    len int
    cap int
}{ptr, length, length}
s := *(*[]byte)(unsafe.Pointer(&amp;amp;s1))
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ„é€ ä¸€ä¸ªè™šæ‹Ÿçš„ç»“æ„ä½“ï¼ŒæŠŠ slice çš„æ•°æ®ç»“æ„æ‹¼å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶è¿˜æœ‰æ›´åŠ ç›´æ¥çš„æ–¹æ³•ï¼Œåœ¨ Go çš„åå°„ä¸­å°±å­˜åœ¨ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„æ•°æ®ç»“æ„ SliceHeaderï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ„é€ ä¸€ä¸ª slice&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var o []byte
sliceHeader := (*reflect.SliceHeader)((unsafe.Pointer(&amp;amp;o)))
sliceHeader.Cap = length
sliceHeader.Len = length
sliceHeader.Data = uintptr(ptr)
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;åˆ›å»ºåˆ‡ç‰‡&#34;&gt;åˆ›å»ºåˆ‡ç‰‡ &lt;a href=&#34;#%e5%88%9b%e5%bb%ba%e5%88%87%e7%89%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;make å‡½æ•°å…è®¸åœ¨è¿è¡ŒæœŸåŠ¨æ€æŒ‡å®šæ•°ç»„é•¿åº¦ï¼Œç»•å¼€äº†æ•°ç»„ç±»å‹å¿…é¡»ä½¿ç”¨ç¼–è¯‘æœŸå¸¸é‡çš„é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºåˆ‡ç‰‡æœ‰ä¸¤ç§å½¢å¼ï¼Œmake åˆ›å»ºåˆ‡ç‰‡ï¼Œç©ºåˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;make-å’Œåˆ‡ç‰‡å­—é¢é‡&#34;&gt;make å’Œåˆ‡ç‰‡å­—é¢é‡ &lt;a href=&#34;#make-%e5%92%8c%e5%88%87%e7%89%87%e5%ad%97%e9%9d%a2%e9%87%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func makeslice(et *_type, len, cap int) slice {
	// æ ¹æ®åˆ‡ç‰‡çš„æ•°æ®ç±»å‹ï¼Œè·å–åˆ‡ç‰‡çš„æœ€å¤§å®¹é‡
	maxElements := maxSliceCap(et.size)
    // æ¯”è¾ƒåˆ‡ç‰‡çš„é•¿åº¦ï¼Œé•¿åº¦å€¼åŸŸåº”è¯¥åœ¨[0,maxElements]ä¹‹é—´
	if len &amp;lt; 0 || uintptr(len) &amp;gt; maxElements {
		panic(errorString(&amp;#34;makeslice: len out of range&amp;#34;))
	}
    // æ¯”è¾ƒåˆ‡ç‰‡çš„å®¹é‡ï¼Œå®¹é‡å€¼åŸŸåº”è¯¥åœ¨[len,maxElements]ä¹‹é—´
	if cap &amp;lt; len || uintptr(cap) &amp;gt; maxElements {
		panic(errorString(&amp;#34;makeslice: cap out of range&amp;#34;))
	}
    // æ ¹æ®åˆ‡ç‰‡çš„å®¹é‡ç”³è¯·å†…å­˜
	p := mallocgc(et.size*uintptr(cap), et, true)
    // è¿”å›ç”³è¯·å¥½å†…å­˜çš„åˆ‡ç‰‡çš„é¦–åœ°å€
	return slice{p, len, cap}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s3.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ç”¨ make å‡½æ•°åˆ›å»ºçš„ä¸€ä¸ª len = 4ï¼Œ cap = 6 çš„åˆ‡ç‰‡ã€‚å†…å­˜ç©ºé—´ç”³è¯·äº†6ä¸ª int ç±»å‹çš„å†…å­˜å¤§å°ã€‚ç”±äº len = 4ï¼Œæ‰€ä»¥åé¢2ä¸ªæš‚æ—¶è®¿é—®ä¸åˆ°ï¼Œä½†æ˜¯å®¹é‡è¿˜æ˜¯åœ¨çš„ã€‚è¿™æ—¶å€™æ•°ç»„é‡Œé¢æ¯ä¸ªå˜é‡éƒ½æ˜¯0 ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† make å‡½æ•°å¯ä»¥åˆ›å»ºåˆ‡ç‰‡ä»¥å¤–ï¼Œå­—é¢é‡ä¹Ÿå¯ä»¥åˆ›å»ºåˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s4.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ˜¯ç”¨å­—é¢é‡åˆ›å»ºçš„ä¸€ä¸ª len = 6ï¼Œcap = 6 çš„åˆ‡ç‰‡ï¼Œè¿™æ—¶å€™æ•°ç»„é‡Œé¢æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½åˆå§‹åŒ–å®Œæˆäº†ã€‚&lt;strong&gt;éœ€è¦æ³¨æ„çš„æ˜¯ [ ] é‡Œé¢ä¸è¦å†™æ•°ç»„çš„å®¹é‡ï¼Œå› ä¸ºå¦‚æœå†™äº†ä¸ªæ•°ä»¥åå°±æ˜¯æ•°ç»„äº†ï¼Œè€Œä¸æ˜¯åˆ‡ç‰‡äº†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s5.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§ç®€å•çš„å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡çš„æ–¹æ³•ã€‚å¦‚ä¸Šå›¾ã€‚ä¸Šå›¾å°± Slice A åˆ›å»ºå‡ºäº†ä¸€ä¸ª len = 3ï¼Œcap = 3 çš„åˆ‡ç‰‡ã€‚ä»åŸæ•°ç»„çš„ç¬¬äºŒä½å…ƒç´ (0æ˜¯ç¬¬ä¸€ä½)å¼€å§‹åˆ‡ï¼Œä¸€ç›´åˆ‡åˆ°ç¬¬å››ä½ä¸ºæ­¢(ä¸åŒ…æ‹¬ç¬¬äº”ä½)ã€‚åŒç†ï¼ŒSlice B åˆ›å»ºå‡ºäº†ä¸€ä¸ª len = 2ï¼Œcap = 4 çš„åˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;nil-å’Œç©ºåˆ‡ç‰‡&#34;&gt;nil å’Œç©ºåˆ‡ç‰‡ &lt;a href=&#34;#nil-%e5%92%8c%e7%a9%ba%e5%88%87%e7%89%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡ä¹Ÿæ˜¯å¸¸ç”¨çš„ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var slice []int
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s6.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;nil åˆ‡ç‰‡è¢«ç”¨åœ¨å¾ˆå¤šæ ‡å‡†åº“å’Œå†…ç½®å‡½æ•°ä¸­ï¼Œæè¿°ä¸€ä¸ªä¸å­˜åœ¨çš„åˆ‡ç‰‡çš„æ—¶å€™ï¼Œå°±éœ€è¦ç”¨åˆ° nil åˆ‡ç‰‡ã€‚æ¯”å¦‚å‡½æ•°åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œè¿”å›çš„åˆ‡ç‰‡å°±æ˜¯ nil åˆ‡ç‰‡ã€‚nil åˆ‡ç‰‡çš„æŒ‡é’ˆæŒ‡å‘ nilã€‚&lt;/p&gt;
&lt;p&gt;ç©ºåˆ‡ç‰‡ä¸€èˆ¬ä¼šç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç©ºçš„é›†åˆã€‚æ¯”å¦‚æ•°æ®åº“æŸ¥è¯¢ï¼Œä¸€æ¡ç»“æœä¹Ÿæ²¡æœ‰æŸ¥åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿”å›ä¸€ä¸ªç©ºåˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;silce := make( []int , 0 )
slice := []int{ }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s7.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç©ºåˆ‡ç‰‡å’Œ nil åˆ‡ç‰‡çš„åŒºåˆ«åœ¨äºï¼Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸æ˜¯nilï¼ŒæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰åˆ†é…ä»»ä½•å†…å­˜ç©ºé—´ï¼Œå³åº•å±‚å…ƒç´ åŒ…å«0ä¸ªå…ƒç´ ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åéœ€è¦è¯´æ˜çš„ä¸€ç‚¹æ˜¯ã€‚ä¸ç®¡æ˜¯ä½¿ç”¨ nil åˆ‡ç‰‡è¿˜æ˜¯ç©ºåˆ‡ç‰‡ï¼Œå¯¹å…¶è°ƒç”¨å†…ç½®å‡½æ•° appendï¼Œlen å’Œ cap çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;åˆ‡ç‰‡æ‰©å®¹&#34;&gt;åˆ‡ç‰‡æ‰©å®¹ &lt;a href=&#34;#%e5%88%87%e7%89%87%e6%89%a9%e5%ae%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é¦–å…ˆçœ‹çœ‹æºç &lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func growslice(et *_type, old slice, cap int) slice {
	if raceenabled {
		callerpc := getcallerpc(unsafe.Pointer(&amp;amp;et))
		racereadrangepc(old.array, uintptr(old.len*int(et.size)), callerpc, funcPC(growslice))
	}
	if msanenabled {
		msanread(old.array, uintptr(old.len*int(et.size)))
	}

	if et.size == 0 {
		// å¦‚æœæ–°è¦æ‰©å®¹çš„å®¹é‡æ¯”åŸæ¥çš„å®¹é‡è¿˜è¦å°ï¼Œè¿™ä»£è¡¨è¦ç¼©å®¹äº†ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥æŠ¥panicäº†ã€‚
		if cap &amp;lt; old.cap {
			panic(errorString(&amp;#34;growslice: cap out of range&amp;#34;))
		}

		// å¦‚æœå½“å‰åˆ‡ç‰‡çš„å¤§å°ä¸º0ï¼Œè¿˜è°ƒç”¨äº†æ‰©å®¹æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„å®¹é‡çš„åˆ‡ç‰‡è¿”å›ã€‚
		return slice{unsafe.Pointer(&amp;amp;zerobase), old.len, cap}
	}

    // è¿™é‡Œå°±æ˜¯æ‰©å®¹çš„ç­–ç•¥
	newcap := old.cap
	doublecap := newcap + newcap
	if cap &amp;gt; doublecap {
		newcap = cap
	} else {
		if old.len &amp;lt; 1024 {
			newcap = doublecap
		} else {
			// Check 0 &amp;lt; newcap to detect overflow
			// and prevent an infinite loop.
			for 0 &amp;lt; newcap &amp;amp;&amp;amp; newcap &amp;lt; cap {
				newcap += newcap / 4
			}
			// Set newcap to the requested cap when
			// the newcap calculation overflowed.
			if newcap &amp;lt;= 0 {
				newcap = cap
			}
		}
	}

	// è®¡ç®—æ–°çš„åˆ‡ç‰‡çš„å®¹é‡ï¼Œé•¿åº¦ã€‚
	var lenmem, newlenmem, capmem uintptr
	const ptrSize = unsafe.Sizeof((*byte)(nil))
	switch et.size {
	case 1:
		lenmem = uintptr(old.len)
		newlenmem = uintptr(cap)
		capmem = roundupsize(uintptr(newcap))
		newcap = int(capmem)
	case ptrSize:
		lenmem = uintptr(old.len) * ptrSize
		newlenmem = uintptr(cap) * ptrSize
		capmem = roundupsize(uintptr(newcap) * ptrSize)
		newcap = int(capmem / ptrSize)
	default:
		lenmem = uintptr(old.len) * et.size
		newlenmem = uintptr(cap) * et.size
		capmem = roundupsize(uintptr(newcap) * et.size)
		newcap = int(capmem / et.size)
	}

	// åˆ¤æ–­éæ³•çš„å€¼ï¼Œä¿è¯å®¹é‡æ˜¯åœ¨å¢åŠ ï¼Œå¹¶ä¸”å®¹é‡ä¸è¶…è¿‡æœ€å¤§å®¹é‡
	if cap &amp;lt; old.cap || uintptr(newcap) &amp;gt; maxSliceCap(et.size) {
		panic(errorString(&amp;#34;growslice: cap out of range&amp;#34;))
	}

	var p unsafe.Pointer
	if et.kind&amp;amp;kindNoPointers != 0 {
		// åœ¨è€çš„åˆ‡ç‰‡åé¢ç»§ç»­æ‰©å……å®¹é‡
		p = mallocgc(capmem, nil, false)
		// å°† lenmem è¿™ä¸ªå¤šä¸ª bytes ä» old.arrayåœ°å€ æ‹·è´åˆ° p çš„åœ°å€å¤„
		memmove(p, old.array, lenmem)
		// å…ˆå°† P åœ°å€åŠ ä¸Šæ–°çš„å®¹é‡å¾—åˆ°æ–°åˆ‡ç‰‡å®¹é‡çš„åœ°å€ï¼Œç„¶åå°†æ–°åˆ‡ç‰‡å®¹é‡åœ°å€åé¢çš„ capmem-newlenmem ä¸ª bytes è¿™å—å†…å­˜åˆå§‹åŒ–ã€‚ä¸ºä¹‹åç»§ç»­ append() æ“ä½œè…¾å‡ºç©ºé—´ã€‚
		memclrNoHeapPointers(add(p, newlenmem), capmem-newlenmem)
	} else {
		// é‡æ–°ç”³è¯·æ–°çš„æ•°ç»„ç»™æ–°åˆ‡ç‰‡
		// é‡æ–°ç”³è¯· capmen è¿™ä¸ªå¤§çš„å†…å­˜åœ°å€ï¼Œå¹¶ä¸”åˆå§‹åŒ–ä¸º0å€¼
		p = mallocgc(capmem, et, true)
		if !writeBarrier.enabled {
			// å¦‚æœè¿˜ä¸èƒ½æ‰“å¼€å†™é”ï¼Œé‚£ä¹ˆåªèƒ½æŠŠ lenmem å¤§å°çš„ bytes å­—èŠ‚ä» old.array æ‹·è´åˆ° p çš„åœ°å€å¤„
			memmove(p, old.array, lenmem)
		} else {
			// å¾ªç¯æ‹·è´è€çš„åˆ‡ç‰‡çš„å€¼
			for i := uintptr(0); i &amp;lt; lenmem; i += et.size {
				typedmemmove(et, add(p, i), add(old.array, i))
			}
		}
	}
	// è¿”å›æœ€ç»ˆæ–°åˆ‡ç‰‡ï¼Œå®¹é‡æ›´æ–°ä¸ºæœ€æ–°æ‰©å®¹ä¹‹åçš„å®¹é‡
	return slice{p, old.len, newcap}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æ‰©å®¹ç­–ç•¥&#34;&gt;æ‰©å®¹ç­–ç•¥ &lt;a href=&#34;#%e6%89%a9%e5%ae%b9%e7%ad%96%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	slice := []int{10, 20, 30, 40}
	newSlice := append(slice, 50)
	fmt.Printf(&amp;#34;Before slice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, slice, &amp;amp;slice, len(slice), cap(slice))
	fmt.Printf(&amp;#34;Before newSlice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, newSlice, &amp;amp;newSlice, len(newSlice), cap(newSlice))
	newSlice[1] += 10
	fmt.Printf(&amp;#34;After slice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, slice, &amp;amp;slice, len(slice), cap(slice))
	fmt.Printf(&amp;#34;After newSlice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, newSlice, &amp;amp;newSlice, len(newSlice), cap(newSlice))
}
//è¾“å‡ºç»“æœ
Before slice = [10 20 30 40], Pointer = 0xc4200b0140, len = 4, cap = 4
Before newSlice = [10 20 30 40 50], Pointer = 0xc4200b0180, len = 5, cap = 8
After slice = [10 20 30 40], Pointer = 0xc4200b0140, len = 4, cap = 4
After newSlice = [10 30 30 40 50], Pointer = 0xc4200b0180, len = 5, cap = 8
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç”¨å›¾è¡¨ç¤º&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s8.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸Šæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹å‡ºï¼Œæ–°çš„åˆ‡ç‰‡å’Œä¹‹å‰çš„åˆ‡ç‰‡å·²ç»ä¸åŒäº†ï¼Œå› ä¸ºæ–°çš„åˆ‡ç‰‡æ›´æ”¹äº†ä¸€ä¸ªå€¼ï¼Œå¹¶æ²¡æœ‰å½±å“åˆ°åŸæ¥çš„æ•°ç»„ï¼Œæ–°åˆ‡ç‰‡æŒ‡å‘çš„æ•°ç»„æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ•°ç»„ã€‚å¹¶ä¸” cap å®¹é‡ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚è¿™ä¹‹é—´ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Go ä¸­åˆ‡ç‰‡æ‰©å®¹çš„ç­–ç•¥æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆåˆ¤æ–­ï¼Œå¦‚æœæ–°ç”³è¯·å®¹é‡ï¼ˆcapï¼‰å¤§äº2å€çš„æ—§å®¹é‡ï¼ˆold.capï¼‰ï¼Œæœ€ç»ˆå®¹é‡ï¼ˆnewcapï¼‰å°±æ˜¯æ–°ç”³è¯·çš„å®¹é‡ï¼ˆcapï¼‰&lt;/li&gt;
&lt;li&gt;å¦åˆ™åˆ¤æ–­ï¼Œå¦‚æœæ—§åˆ‡ç‰‡çš„é•¿åº¦å°äº1024ï¼Œåˆ™æœ€ç»ˆå®¹é‡(newcap)å°±æ˜¯æ—§å®¹é‡(old.cap)çš„ä¸¤å€ï¼Œå³ï¼ˆnewcap=doublecapï¼‰&lt;/li&gt;
&lt;li&gt;å¦åˆ™åˆ¤æ–­ï¼Œå¦‚æœæ—§åˆ‡ç‰‡é•¿åº¦å¤§äºç­‰äº1024ï¼Œåˆ™æœ€ç»ˆå®¹é‡ï¼ˆnewcapï¼‰ä»æ—§å®¹é‡ï¼ˆold.capï¼‰å¼€å§‹å¾ªç¯å¢åŠ åŸæ¥çš„ 1/4ï¼Œå³ï¼ˆnewcap=old.cap,for {newcap += newcap/4}ï¼‰ç›´åˆ°æœ€ç»ˆå®¹é‡ï¼ˆnewcapï¼‰å¤§äºç­‰äºæ–°ç”³è¯·çš„å®¹é‡(cap)ï¼Œå³ï¼ˆnewcap &amp;gt;= capï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ€ç»ˆå®¹é‡ï¼ˆcapï¼‰è®¡ç®—å€¼æº¢å‡ºï¼Œåˆ™æœ€ç»ˆå®¹é‡ï¼ˆcapï¼‰å°±æ˜¯æ–°ç”³è¯·å®¹é‡ï¼ˆcapï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šæ‰©å®¹æ‰©å¤§çš„å®¹é‡éƒ½æ˜¯é’ˆå¯¹åŸæ¥çš„å®¹é‡è€Œè¨€çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹åŸæ¥æ•°ç»„çš„é•¿åº¦è€Œè¨€çš„ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ–°æ•°ç»„-or-è€æ•°ç»„-&#34;&gt;æ–°æ•°ç»„ or è€æ•°ç»„ ï¼Ÿ &lt;a href=&#34;#%e6%96%b0%e6%95%b0%e7%bb%84-or-%e8%80%81%e6%95%b0%e7%bb%84-&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å†è°ˆè°ˆæ‰©å®¹ä¹‹åçš„æ•°ç»„ä¸€å®šæ˜¯æ–°çš„ä¹ˆï¼Ÿè¿™ä¸ªä¸ä¸€å®šï¼Œåˆ†ä¸¤ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;æƒ…å†µä¸€ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	array := [4]int{10, 20, 30, 40}
	slice := array[0:2]
	newSlice := append(slice, 50)
	fmt.Printf(&amp;#34;Before slice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, slice, &amp;amp;slice, len(slice), cap(slice))
	fmt.Printf(&amp;#34;Before newSlice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, newSlice, &amp;amp;newSlice, len(newSlice), cap(newSlice))
	newSlice[1] += 10
	fmt.Printf(&amp;#34;After slice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, slice, &amp;amp;slice, len(slice), cap(slice))
	fmt.Printf(&amp;#34;After newSlice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, newSlice, &amp;amp;newSlice, len(newSlice), cap(newSlice))
	fmt.Printf(&amp;#34;After array = %v\n&amp;#34;, array)
}

//è¾“å‡º
Before slice = [10 20], Pointer = 0xc4200c0040, len = 2, cap = 4
Before newSlice = [10 20 50], Pointer = 0xc4200c0060, len = 3, cap = 4
After slice = [10 30], Pointer = 0xc4200c0040, len = 2, cap = 4
After newSlice = [10 30 50], Pointer = 0xc4200c0060, len = 3, cap = 4
After array = [10 30 50 40]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æŠŠä¸Šè¿°è¿‡ç¨‹ç”¨å›¾è¡¨ç¤ºå‡ºæ¥ï¼Œå¦‚ä¸‹å›¾ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-s9.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ‰“å°çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å®¹ä»¥åå¹¶æ²¡æœ‰æ–°å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæ‰©å®¹å‰åçš„æ•°ç»„éƒ½æ˜¯åŒä¸€ä¸ªï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†æ–°çš„åˆ‡ç‰‡ä¿®æ”¹äº†ä¸€ä¸ªå€¼ï¼Œä¹Ÿå½±å“åˆ°äº†è€çš„åˆ‡ç‰‡äº†ã€‚å¹¶ä¸” append() æ“ä½œä¹Ÿæ”¹å˜äº†åŸæ¥æ•°ç»„é‡Œé¢çš„å€¼ã€‚ä¸€ä¸ª append() æ“ä½œå½±å“äº†è¿™ä¹ˆå¤šåœ°æ–¹ï¼Œå¦‚æœåŸæ•°ç»„ä¸Šæœ‰å¤šä¸ªåˆ‡ç‰‡ï¼Œé‚£ä¹ˆè¿™äº›åˆ‡ç‰‡éƒ½ä¼šè¢«å½±å“ï¼æ— æ„é—´å°±äº§ç”Ÿäº†è«åçš„ bugï¼&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µï¼Œç”±äºåŸæ•°ç»„è¿˜æœ‰å®¹é‡å¯ä»¥æ‰©å®¹ï¼Œæ‰€ä»¥æ‰§è¡Œ append() æ“ä½œä»¥åï¼Œä¼šåœ¨åŸæ•°ç»„ä¸Šç›´æ¥æ“ä½œï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å®¹ä»¥åçš„æ•°ç»„è¿˜æ˜¯æŒ‡å‘åŸæ¥çš„æ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µä¹Ÿæå®¹æ˜“å‡ºç°åœ¨å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡æ—¶å€™ï¼Œç¬¬ä¸‰ä¸ªå‚æ•° cap ä¼ å€¼çš„æ—¶å€™ï¼Œå¦‚æœç”¨å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡ï¼Œcap å¹¶ä¸ç­‰äºæŒ‡å‘æ•°ç»„çš„æ€»å®¹é‡ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µå°±ä¼šå‘ç”Ÿã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice := array[1:2:3]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¸Šé¢è¿™ç§æƒ…å†µéå¸¸å±é™©ï¼Œæåº¦å®¹æ˜“äº§ç”Ÿ bug ã€‚&lt;/strong&gt;
å»ºè®®ç”¨å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡çš„æ—¶å€™ï¼Œcap çš„å€¼ä¸€å®šè¦ä¿æŒæ¸…é†’ï¼Œé¿å…å…±äº«åŸæ•°ç»„å¯¼è‡´çš„ bugã€‚&lt;/p&gt;
&lt;p&gt;æƒ…å†µäºŒï¼š&lt;/p&gt;
&lt;p&gt;æƒ…å†µäºŒå…¶å®å°±æ˜¯åœ¨æ‰©å®¹ç­–ç•¥é‡Œé¢ä¸¾çš„ä¾‹å­ï¼Œåœ¨é‚£ä¸ªä¾‹å­ä¸­ä¹‹æ‰€ä»¥ç”Ÿæˆäº†æ–°çš„åˆ‡ç‰‡ï¼Œæ˜¯å› ä¸ºåŸæ¥æ•°ç»„çš„å®¹é‡å·²ç»è¾¾åˆ°äº†æœ€å¤§å€¼ï¼Œå†æƒ³æ‰©å®¹ï¼Œ Go é»˜è®¤ä¼šå…ˆå¼€ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼ŒæŠŠåŸæ¥çš„å€¼æ‹·è´è¿‡æ¥ï¼Œç„¶åå†æ‰§è¡Œ append() æ“ä½œã€‚è¿™ç§æƒ…å†µä¸æ¯«ä¸å½±å“åŸæ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å»ºè®®å°½é‡é¿å…æƒ…å†µä¸€ï¼Œå°½é‡ä½¿ç”¨æƒ…å†µäºŒï¼Œé¿å… bug äº§ç”Ÿã€‚
ä¸¾ä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {

    s1 := []int{1, 2, 3}
    s2 := s1[1:]
    s2[1] = 4
    fmt.Println(s1)
    s2 = append(s2, 5, 6, 7)
    fmt.Println(s1)
}
//output 
[1 2 4]
[1 2 4]
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;åˆ‡ç‰‡æ‹·è´&#34;&gt;åˆ‡ç‰‡æ‹·è´ &lt;a href=&#34;#%e5%88%87%e7%89%87%e6%8b%b7%e8%b4%9d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Slice ä¸­æ‹·è´æ–¹æ³•æœ‰2ä¸ªã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func slicecopy(to, fm slice, width uintptr) int {
	// å¦‚æœæºåˆ‡ç‰‡æˆ–è€…ç›®æ ‡åˆ‡ç‰‡æœ‰ä¸€ä¸ªé•¿åº¦ä¸º0ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦æ‹·è´ï¼Œç›´æ¥ return 
	if fm.len == 0 || to.len == 0 {
		return 0
	}
	// n è®°å½•ä¸‹æºåˆ‡ç‰‡æˆ–è€…ç›®æ ‡åˆ‡ç‰‡è¾ƒçŸ­çš„é‚£ä¸€ä¸ªçš„é•¿åº¦
	n := fm.len
	if to.len &amp;lt; n {
		n = to.len
	}
	// å¦‚æœå…¥å‚ width = 0ï¼Œä¹Ÿä¸éœ€è¦æ‹·è´äº†ï¼Œè¿”å›è¾ƒçŸ­çš„åˆ‡ç‰‡çš„é•¿åº¦
	if width == 0 {
		return n
	}
	// å¦‚æœå¼€å¯äº†ç«äº‰æ£€æµ‹
	if raceenabled {
		callerpc := getcallerpc(unsafe.Pointer(&amp;amp;to))
		pc := funcPC(slicecopy)
		racewriterangepc(to.array, uintptr(n*int(width)), callerpc, pc)
		racereadrangepc(fm.array, uintptr(n*int(width)), callerpc, pc)
	}
	// å¦‚æœå¼€å¯äº† The memory sanitizer (msan)
	if msanenabled {
		msanwrite(to.array, uintptr(n*int(width)))
		msanread(fm.array, uintptr(n*int(width)))
	}

	size := uintptr(n) * width
	if size == 1 { 
		// TODO: is this still worth it with new memmove impl?
		// å¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆæŒ‡é’ˆç›´æ¥è½¬æ¢å³å¯
		*(*byte)(to.array) = *(*byte)(fm.array) // known to be a byte pointer
	} else {
		// å¦‚æœä¸æ­¢ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå°±æŠŠ size ä¸ª bytes ä» fm.array åœ°å€å¼€å§‹ï¼Œæ‹·è´åˆ° to.array åœ°å€ä¹‹å
		memmove(to.array, fm.array, size)
	}
	return n
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œslicecopy æ–¹æ³•ä¼šæŠŠæºåˆ‡ç‰‡å€¼(å³ fm Slice )ä¸­çš„å…ƒç´ å¤åˆ¶åˆ°ç›®æ ‡åˆ‡ç‰‡(å³ to Slice )ä¸­ï¼Œå¹¶è¿”å›è¢«å¤åˆ¶çš„å…ƒç´ ä¸ªæ•°ï¼Œcopy çš„ä¸¤ä¸ªç±»å‹å¿…é¡»ä¸€è‡´ã€‚slicecopy æ–¹æ³•æœ€ç»ˆçš„å¤åˆ¶ç»“æœå–å†³äºè¾ƒçŸ­çš„é‚£ä¸ªåˆ‡ç‰‡ï¼Œå½“è¾ƒçŸ­çš„åˆ‡ç‰‡å¤åˆ¶å®Œæˆï¼Œæ•´ä¸ªå¤åˆ¶è¿‡ç¨‹å°±å…¨éƒ¨å®Œæˆäº†ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-s10.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¯´åˆ°æ‹·è´ï¼Œåˆ‡ç‰‡ä¸­æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	slice := []int{10, 20, 30, 40}
	for index, value := range slice {
		fmt.Printf(&amp;#34;value = %d , value-addr = %x , slice-addr = %x\n&amp;#34;, value, &amp;amp;value, &amp;amp;slice[index])
	}
}
//è¾“å‡º
value = 10 , value-addr = c4200aedf8 , slice-addr = c4200b0320
value = 20 , value-addr = c4200aedf8 , slice-addr = c4200b0328
value = 30 , value-addr = c4200aedf8 , slice-addr = c4200b0330
value = 40 , value-addr = c4200aedf8 , slice-addr = c4200b0338
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s11.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç”±äº Value æ˜¯å€¼æ‹·è´çš„ï¼Œå¹¶éå¼•ç”¨ä¼ é€’ï¼Œæ‰€ä»¥ç›´æ¥æ”¹ Value æ˜¯è¾¾ä¸åˆ°æ›´æ”¹åŸåˆ‡ç‰‡å€¼çš„ç›®çš„çš„ï¼Œéœ€è¦é€šè¿‡ &amp;amp;slice[index] è·å–çœŸå®çš„åœ°å€ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Go-channelæ€»ç»“</title>
      <link>https://abnerxc.github.io/go/channel%E6%80%BB%E7%BB%93/</link>
      <pubDate>Mon, 15 Mar 2021 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/channel%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;h1 id=&#34;channelçš„ä½¿ç”¨åœºæ™¯&#34;&gt;channelçš„ä½¿ç”¨åœºæ™¯ &lt;a href=&#34;#channel%e7%9a%84%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æŠŠchannelç”¨åœ¨æ•°æ®æµåŠ¨çš„åœ°æ–¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯ä¼ é€’ã€æ¶ˆæ¯è¿‡æ»¤&lt;/li&gt;
&lt;li&gt;ä¿¡å·å¹¿æ’­&lt;/li&gt;
&lt;li&gt;äº‹ä»¶è®¢é˜…ä¸å¹¿æ’­&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ã€å“åº”è½¬å‘&lt;/li&gt;
&lt;li&gt;ä»»åŠ¡åˆ†å‘&lt;/li&gt;
&lt;li&gt;ç»“æœæ±‡æ€»&lt;/li&gt;
&lt;li&gt;å¹¶å‘æ§åˆ¶&lt;/li&gt;
&lt;li&gt;åŒæ­¥ä¸å¼‚æ­¥&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;channelçš„åŸºæœ¬æ“ä½œå’Œæ³¨æ„äº‹é¡¹&#34;&gt;channelçš„åŸºæœ¬æ“ä½œå’Œæ³¨æ„äº‹é¡¹ &lt;a href=&#34;#channel%e7%9a%84%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c%e5%92%8c%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;channel å­˜åœ¨3ç§çŠ¶æ€&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;nil,æœªåˆå§‹åŒ–ï¼Œåˆšåˆšç”³æ˜æˆ–è€…æ‰‹åŠ¨å¤åˆ¶ä¸ºnil&lt;/li&gt;
&lt;li&gt;activeï¼Œæ­£å¸¸è¿è¡Œä¸­çš„å¯è¯»å¯å†™&lt;/li&gt;
&lt;li&gt;closed,å…³é—­æ—¶ï¼Œ&lt;strong&gt;åƒä¸‡ä¸è¦è®¤ä¸ºå…³é—­ä»¥åï¼Œchannelçš„å€¼æ˜¯nil&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;channel å¯è¿›è¡Œ3ç§æ“ä½œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯»&lt;/li&gt;
&lt;li&gt;å†™&lt;/li&gt;
&lt;li&gt;å…³é—­&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;3ç§çŠ¶æ€å­˜åœ¨9ç§æƒ…å†µ&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ“ä½œ&lt;/th&gt;
          &lt;th&gt;nilçš„channel&lt;/th&gt;
          &lt;th&gt;æ­£å¸¸channel&lt;/th&gt;
          &lt;th&gt;å·²å…³é—­channel&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&amp;lt;- ch&lt;/td&gt;
          &lt;td&gt;é˜»å¡&lt;/td&gt;
          &lt;td&gt;æˆåŠŸoré˜»å¡&lt;/td&gt;
          &lt;td&gt;è¯»åˆ°é›¶å€¼&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ch &amp;lt;-&lt;/td&gt;
          &lt;td&gt;é˜»å¡&lt;/td&gt;
          &lt;td&gt;æˆåŠŸoré˜»å¡&lt;/td&gt;
          &lt;td&gt;panic&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;close(ch)&lt;/td&gt;
          &lt;td&gt;panic&lt;/td&gt;
          &lt;td&gt;æˆåŠŸ&lt;/td&gt;
          &lt;td&gt;panic&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¯¹äºnilé€šé“çš„æƒ…å†µï¼Œä¹Ÿå¹¶éå®Œå…¨éµå¾ªä¸Šè¡¨ï¼Œæœ‰1ä¸ªç‰¹æ®Šåœºæ™¯ï¼šå½“nilçš„é€šé“åœ¨selectçš„æŸä¸ªcaseä¸­æ—¶ï¼Œè¿™ä¸ªcaseä¼šé˜»å¡ï¼Œä½†ä¸ä¼šé€ æˆæ­»é”&lt;/p&gt;
&lt;h1 id=&#34;ä½¿ç”¨for-rangeè¯»channel&#34;&gt;ä½¿ç”¨for rangeè¯»channel &lt;a href=&#34;#%e4%bd%bf%e7%94%a8for-range%e8%af%bbchannel&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“éœ€è¦ä¸æ–­ä»channelè¯»å–æ•°æ®æ—¶ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨for-rangeè¯»å–channelï¼Œè¿™æ ·æ—¢å®‰å…¨åˆä¾¿åˆ©ï¼Œå½“channelå…³é—­æ—¶ï¼Œforå¾ªç¯ä¼šè‡ªåŠ¨é€€å‡ºï¼Œæ— éœ€ä¸»åŠ¨ç›‘æµ‹channelæ˜¯å¦å…³é—­ï¼Œå¯ä»¥é˜²æ­¢è¯»å–å·²ç»å…³é—­çš„channelï¼Œé€ æˆè¯»åˆ°æ•°æ®ä¸ºé€šé“æ‰€å­˜å‚¨çš„æ•°æ®ç±»å‹çš„é›¶å€¼ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;for x := range ch{
    fmt.Println(x)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨vok---ch--selectæ“ä½œåˆ¤æ–­channelæ˜¯å¦å…³é—­&#34;&gt;ä½¿ç”¨v,ok := &amp;lt;-ch + selectæ“ä½œåˆ¤æ–­channelæ˜¯å¦å…³é—­ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8vok---ch--select%e6%93%8d%e4%bd%9c%e5%88%a4%e6%96%adchannel%e6%98%af%e5%90%a6%e5%85%b3%e9%97%ad&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;v,ok := &amp;lt;-ch + select&lt;/code&gt;æ“ä½œåˆ¤æ–­channelæ˜¯å¦å…³é—­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;okçš„ç»“æœå’Œå«ä¹‰ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- `true`ï¼šè¯»åˆ°é€šé“æ•°æ®ï¼Œä¸ç¡®å®šæ˜¯å¦å…³é—­ï¼Œå¯èƒ½channelè¿˜æœ‰ä¿å­˜çš„æ•°æ®ï¼Œä½†channelå·²å…³é—­ã€‚
- `false`ï¼šé€šé“å…³é—­ï¼Œæ— æ•°æ®è¯»åˆ°ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»å…³é—­çš„channelè¯»å€¼è¯»åˆ°æ˜¯channelæ‰€ä¼ é€’æ•°æ®ç±»å‹çš„é›¶å€¼ï¼Œè¿™ä¸ªé›¶å€¼æœ‰å¯èƒ½æ˜¯å‘é€è€…å‘é€çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯channelå…³é—­äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;_, ok := &amp;lt;-ch&lt;/code&gt;ä¸selecté…åˆä½¿ç”¨çš„ï¼Œå½“okä¸ºfalseæ—¶ï¼Œä»£è¡¨äº†channelå·²ç»closeã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è§£é‡ŠåŸå› ï¼Œ&lt;code&gt;_,ok := &amp;lt;-ch&lt;/code&gt;å¯¹åº”çš„å‡½æ•°æ˜¯&lt;code&gt;func chanrecv(c *hchan, ep unsafe.Pointer, block bool) (selected, received bool)&lt;/code&gt;ï¼Œå…¥å‚blockå«ä¹‰æ˜¯å½“å‰goroutineæ˜¯å¦å¯é˜»å¡ï¼Œå½“blockä¸ºfalseä»£è¡¨çš„æ˜¯selectæ“ä½œï¼Œä¸å¯é˜»å¡å½“å‰goroutineçš„åœ¨channelæ“ä½œï¼Œå¦åˆ™æ˜¯æ™®é€šæ“ä½œï¼ˆå³&lt;code&gt;_, ok&lt;/code&gt;ä¸åœ¨selectä¸­ï¼‰ã€‚è¿”å›å€¼selectedä»£è¡¨å½“å‰æ“ä½œæ˜¯å¦æˆåŠŸï¼Œä¸»è¦ä¸ºselectæœåŠ¡ï¼Œè¿”å›**receivedä»£è¡¨æ˜¯å¦ä»channelè¯»åˆ°æœ‰æ•ˆå€¼ã€‚**å®ƒæœ‰3ç§è¿”å›å€¼æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;blockä¸ºfalseï¼Œå³æ‰§è¡Œselectæ—¶ï¼Œå¦‚æœchannelä¸ºç©ºï¼Œè¿”å›(false,false)ï¼Œä»£è¡¨selectæ“ä½œå¤±è´¥ï¼Œæ²¡æ¥æ”¶åˆ°å€¼ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œå¦‚æœchannelå·²ç»å…³é—­ï¼Œå¹¶ä¸”æ²¡æœ‰æ•°æ®ï¼Œepå³æ¥æ”¶æ•°æ®çš„å˜é‡è®¾ç½®ä¸ºé›¶å€¼ï¼Œè¿”å›(true,false)ï¼Œä»£è¡¨selectæ“ä½œæˆåŠŸï¼Œä½†channelå·²å…³é—­ï¼Œæ²¡è¯»åˆ°æœ‰æ•ˆå€¼ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œå…¶ä»–è¯»åˆ°æœ‰æ•ˆæ•°æ®çš„æƒ…å†µï¼Œè¿”å›(true,ture)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬è€ƒè™‘_, ok := &amp;lt;-chå’Œselectç»“åˆä½¿ç”¨çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;æƒ…å†µ1ï¼šå½“chanrecvè¿”å›(false,false)æ—¶ï¼Œæœ¬è´¨æ˜¯selectæ“ä½œå¤±è´¥äº†ï¼Œæ‰€ä»¥ç›¸å…³çš„caseä¼šé˜»å¡ï¼Œä¸ä¼šæ‰§è¡Œï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
func main() {
	ch := make(chan int)
	select {
	case v, ok := &amp;lt;-ch:
		fmt.Printf(&amp;#34;v: %v, ok: %v\n&amp;#34;, v, ok)
	default:
		fmt.Println(&amp;#34;nothing&amp;#34;)
	}
}

// ç»“æœï¼š
// nothing
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æƒ…å†µ2ï¼šä¸‹é¢çš„ç»“æœä¼šæ˜¯é›¶å€¼å’Œfalseï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	ch := make(chan int)

	// å¢åŠ å…³é—­
	close(ch)

	select {
	case v, ok := &amp;lt;-ch:
		fmt.Printf(&amp;#34;v: %v, ok: %v\n&amp;#34;, v, ok)
	}
}

// v: 0, ok: false
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æƒ…å†µ3çš„receivedä¸ºtrueï¼Œå³_, okä¸­çš„okä¸ºtrueï¼Œä¸åšè®¨è®ºäº†ï¼Œåªè®¨è®ºokä¸ºfalseçš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;æœ€åokä¸ºfalseçš„æ—¶å€™ï¼Œåªæœ‰æƒ…å†µ2ï¼Œæ­¤æ—¶channelå¿…ç„¶å·²ç»å…³é—­ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åœ¨selectä¸­ç”¨okåˆ¤æ–­channelæ˜¯å¦å·²ç»å…³é—­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	ch := make(chan int, 1)

	// å‘é€1ä¸ªæ•°æ®å…³é—­channel
	ch &amp;lt;- 1
	close(ch)
	print(&amp;#34;close channel\n&amp;#34;)

	// ä¸åœè¯»æ•°æ®ç›´åˆ°channelæ²¡æœ‰æœ‰æ•ˆæ•°æ®
	for {
		select {
		case v, ok := &amp;lt;-ch:
			print(&amp;#34;v: &amp;#34;, v, &amp;#34;, ok:&amp;#34;, ok, &amp;#34;\n&amp;#34;)
			if !ok {
				print(&amp;#34;channel is close\n&amp;#34;)
				return
			}	
		default:
			print(&amp;#34;nothing\n&amp;#34;)
		}
	}
}

// ç»“æœ
// close channel
// v: 1, ok:true
// v: 0, ok:false
// channel is close
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨selectå¤„ç†å¤šä¸ªchannel&#34;&gt;ä½¿ç”¨selectå¤„ç†å¤šä¸ªchannel &lt;a href=&#34;#%e4%bd%bf%e7%94%a8select%e5%a4%84%e7%90%86%e5%a4%9a%e4%b8%aachannel&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
éœ€è¦å¯¹å¤šä¸ªé€šé“è¿›è¡ŒåŒæ—¶å¤„ç†ï¼Œä½†åªå¤„ç†æœ€å…ˆå‘ç”Ÿçš„channelæ—¶&lt;/li&gt;
&lt;li&gt;åŸç†
&lt;code&gt;select&lt;/code&gt;å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªé€šé“çš„æƒ…å†µï¼Œåªå¤„ç†æœªé˜»å¡çš„caseã€‚&lt;strong&gt;å½“é€šé“ä¸ºnilæ—¶ï¼Œå¯¹åº”çš„caseæ°¸è¿œä¸ºé˜»å¡ï¼Œæ— è®ºè¯»å†™ã€‚ç‰¹æ®Šå…³æ³¨ï¼šæ™®é€šæƒ…å†µä¸‹ï¼Œå¯¹nilçš„é€šé“å†™æ“ä½œæ˜¯è¦panicçš„ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// åˆ†é…jobæ—¶ï¼Œå¦‚æœæ”¶åˆ°å…³é—­çš„é€šçŸ¥åˆ™é€€å‡ºï¼Œä¸åˆ†é…job
func (h *Handler) handle(job *Job) {
    select {
    case h.jobCh&amp;lt;-job:
        return 
    case &amp;lt;-h.stopCh:
        return
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨channelçš„å£°æ˜æ§åˆ¶è¯»å†™æƒé™&#34;&gt;ä½¿ç”¨channelçš„å£°æ˜æ§åˆ¶è¯»å†™æƒé™ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8channel%e7%9a%84%e5%a3%b0%e6%98%8e%e6%8e%a7%e5%88%b6%e8%af%bb%e5%86%99%e6%9d%83%e9%99%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœºæ™¯
åç¨‹å¯¹æŸä¸ªé€šé“åªè¯»æˆ–åªå†™æ—¶&lt;/p&gt;
&lt;p&gt;ç›®çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ä»£ç æ›´æ˜“è¯»ã€æ›´æ˜“ç»´æŠ¤ï¼Œ&lt;/li&gt;
&lt;li&gt;é˜²æ­¢åªè¯»åç¨‹å¯¹é€šé“è¿›è¡Œå†™æ•°æ®ï¼Œä½†é€šé“å·²å…³é—­ï¼Œé€ æˆpanicã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨æ³•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœåç¨‹å¯¹æŸä¸ªchannelåªæœ‰å†™æ“ä½œï¼Œåˆ™è¿™ä¸ªchannelå£°æ˜ä¸ºåªå†™ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœåç¨‹å¯¹æŸä¸ªchannelåªæœ‰è¯»æ“ä½œï¼Œåˆ™è¿™ä¸ªchanneå£°æ˜ä¸ºåªè¯»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// åªæœ‰generatorè¿›è¡Œå¯¹outChè¿›è¡Œå†™æ“ä½œï¼Œè¿”å›å£°æ˜
// &amp;lt;-chan intï¼Œå¯ä»¥é˜²æ­¢å…¶ä»–åç¨‹ä¹±ç”¨æ­¤é€šé“ï¼Œé€ æˆéšè—bug
func generator(int n) &amp;lt;-chan int {
    outCh := make(chan int)
    go func(){
        for i:=0;i&amp;lt;n;i++{
            outCh&amp;lt;-i
        }
    }()
    return outCh
}

// consumeråªè¯»inChçš„æ•°æ®ï¼Œå£°æ˜ä¸º&amp;lt;-chan int
// å¯ä»¥é˜²æ­¢å®ƒå‘inChå†™æ•°æ®
func consumer(inCh &amp;lt;-chan int) {
    for x := range inCh {
        fmt.Println(x)
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨ç¼“å†²channelå¢å¼ºå¹¶å‘&#34;&gt;ä½¿ç”¨ç¼“å†²channelå¢å¼ºå¹¶å‘ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e7%bc%93%e5%86%b2channel%e5%a2%9e%e5%bc%ba%e5%b9%b6%e5%8f%91&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
å¼‚æ­¥&lt;/li&gt;
&lt;li&gt;åŸç†
æœ‰ç¼“å†²é€šé“å¯ä¾›å¤šä¸ªåç¨‹åŒæ—¶å¤„ç†ï¼Œåœ¨ä¸€å®šç¨‹åº¦å¯æé«˜å¹¶å‘æ€§ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// æ— ç¼“å†²
ch1 := make(chan int)
ch2 := make(chan int, 0)
// æœ‰ç¼“å†²
ch3 := make(chan int, 1)
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// ä½¿ç”¨5ä¸ª`do`åç¨‹åŒæ—¶å¤„ç†è¾“å…¥æ•°æ®
func test() {
    inCh := generator(100)
    outCh := make(chan int, 10)

    for i := 0; i &amp;lt; 5; i++ {
        go do(inCh, outCh)
    }

    for r := range outCh {
        fmt.Println(r)
    }
}

func do(inCh &amp;lt;-chan int, outCh chan&amp;lt;- int) {
    for v := range inCh {
        outCh &amp;lt;- v * v
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä¸ºæ“ä½œåŠ ä¸Šè¶…æ—¶&#34;&gt;ä¸ºæ“ä½œåŠ ä¸Šè¶…æ—¶ &lt;a href=&#34;#%e4%b8%ba%e6%93%8d%e4%bd%9c%e5%8a%a0%e4%b8%8a%e8%b6%85%e6%97%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
å¼‚æ­¥&lt;/li&gt;
&lt;li&gt;åŸç†
ä½¿ç”¨&lt;code&gt;select&lt;/code&gt;å’Œ&lt;code&gt;time.After&lt;/code&gt;ï¼Œçœ‹æ“ä½œå’Œå®šæ—¶å™¨å“ªä¸ªå…ˆè¿”å›ï¼Œå¤„ç†å…ˆå®Œæˆçš„ï¼Œå°±è¾¾åˆ°äº†è¶…æ—¶æ§åˆ¶çš„æ•ˆæœ&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
func doWithTimeOut(timeout time.Duration) (int, error) {
	select {
	case ret := &amp;lt;-do():
		return ret, nil
	case &amp;lt;-time.After(timeout):
		return 0, errors.New(&amp;#34;timeout&amp;#34;)
	}
}

func do() &amp;lt;-chan int {
	outCh := make(chan int)
	go func() {
		// do work
	}()
	return outCh
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨closechå…³é—­æ‰€æœ‰ä¸‹æ¸¸åç¨‹&#34;&gt;ä½¿ç”¨&lt;code&gt;close(ch)&lt;/code&gt;å…³é—­æ‰€æœ‰ä¸‹æ¸¸åç¨‹ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8closech%e5%85%b3%e9%97%ad%e6%89%80%e6%9c%89%e4%b8%8b%e6%b8%b8%e5%8d%8f%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
é€€å‡ºæ—¶ï¼Œæ˜¾ç¤ºé€šçŸ¥æ‰€æœ‰åç¨‹é€€å‡º&lt;/li&gt;
&lt;li&gt;åŸç†
æ‰€æœ‰è¯»chçš„åç¨‹éƒ½ä¼šæ”¶åˆ°close(ch)çš„ä¿¡å·&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
func (h *Handler) Stop() {
    close(h.stopCh)

    // å¯ä»¥ä½¿ç”¨WaitGroupç­‰å¾…æ‰€æœ‰åç¨‹é€€å‡º
}

// æ”¶åˆ°åœæ­¢åï¼Œä¸å†å¤„ç†è¯·æ±‚
func (h *Handler) loop() error {
    for {
        select {
        case req := &amp;lt;-h.reqCh:
            go handle(req)
        case &amp;lt;-h.stopCh:
            return
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨chan-structä½œä¸ºä¿¡å·channel&#34;&gt;ä½¿ç”¨chan struct{}ä½œä¸ºä¿¡å·channel &lt;a href=&#34;#%e4%bd%bf%e7%94%a8chan-struct%e4%bd%9c%e4%b8%ba%e4%bf%a1%e5%8f%b7channel&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
ä½¿ç”¨channelä¼ é€’ä¿¡å·ï¼Œè€Œä¸æ˜¯ä¼ é€’æ•°æ®æ—¶&lt;/li&gt;
&lt;li&gt;åŸç†
æ²¡æ•°æ®éœ€è¦ä¼ é€’æ—¶ï¼Œä¼ é€’ç©ºstruct&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// ä¸Šä¾‹ä¸­çš„Handler.stopChå°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼ŒstopChå¹¶ä¸éœ€è¦ä¼ é€’ä»»ä½•æ•°æ®
// åªæ˜¯è¦ç»™æ‰€æœ‰åç¨‹å‘é€é€€å‡ºçš„ä¿¡å·
type Handler struct {
    stopCh chan struct{}
    reqCh chan *Request
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨channelä¼ é€’ç»“æ„ä½“çš„æŒ‡é’ˆè€Œéç»“æ„ä½“&#34;&gt;ä½¿ç”¨channelä¼ é€’ç»“æ„ä½“çš„æŒ‡é’ˆè€Œéç»“æ„ä½“ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8channel%e4%bc%a0%e9%80%92%e7%bb%93%e6%9e%84%e4%bd%93%e7%9a%84%e6%8c%87%e9%92%88%e8%80%8c%e9%9d%9e%e7%bb%93%e6%9e%84%e4%bd%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
ä½¿ç”¨channelä¼ é€’ç»“æ„ä½“æ•°æ®æ—¶&lt;/li&gt;
&lt;li&gt;åŸç†
channelæœ¬è´¨ä¸Šä¼ é€’çš„æ˜¯æ•°æ®çš„æ‹·è´ï¼Œæ‹·è´çš„æ•°æ®è¶Šå°ä¼ è¾“æ•ˆç‡è¶Šé«˜ï¼Œä¼ é€’ç»“æ„ä½“æŒ‡é’ˆï¼Œæ¯”ä¼ é€’ç»“æ„ä½“æ›´é«˜æ•ˆ&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;reqCh chan *Request

// å¥½è¿‡
reqCh chan Request
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨channelä¼ é€’channel&#34;&gt;ä½¿ç”¨channelä¼ é€’channel &lt;a href=&#34;#%e4%bd%bf%e7%94%a8channel%e4%bc%a0%e9%80%92channel&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
ä½¿ç”¨åœºæ™¯æœ‰ç‚¹å¤šï¼Œé€šå¸¸æ˜¯ç”¨æ¥è·å–ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;åŸç†
channelå¯ä»¥ç”¨æ¥ä¼ é€’å˜é‡ï¼Œchannelè‡ªèº«ä¹Ÿæ˜¯å˜é‡ï¼Œå¯ä»¥ä¼ é€’è‡ªå·±ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
package main

import (
	&amp;#34;fmt&amp;#34;
	&amp;#34;math/rand&amp;#34;
	&amp;#34;sync&amp;#34;
	&amp;#34;time&amp;#34;
)

func main() {
	reqs := []int{1, 2, 3, 4, 5, 6, 7, 8, 9}

	// å­˜æ”¾ç»“æœçš„channelçš„channel
	outs := make(chan chan int, len(reqs))
	var wg sync.WaitGroup
	wg.Add(len(reqs))
	for _, x := range reqs {
		o := handle(&amp;amp;wg, x)
		outs &amp;lt;- o
	}

	go func() {
		wg.Wait()
		close(outs)
	}()

	// è¯»å–ç»“æœï¼Œç»“æœæœ‰åº
	for o := range outs {
		fmt.Println(&amp;lt;-o)
	}
}

// handle å¤„ç†è¯·æ±‚ï¼Œè€—æ—¶éšæœºæ¨¡æ‹Ÿ
func handle(wg *sync.WaitGroup, a int) chan int {
	out := make(chan int)
	go func() {
		time.Sleep(time.Duration(rand.Intn(3)) * time.Second)
		out &amp;lt;- a
		wg.Done()
	}()
	return out
}
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ”¶é›†æ¥æºï¼š &lt;a href=&#34;http://lessisbetter.site/2019/01/20/golang-channel-all-usage/&#34;&gt;http://lessisbetter.site/2019/01/20/golang-channel-all-usage/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Go-contextè¯¦è§£</title>
      <link>https://abnerxc.github.io/go/context%E8%AF%A6%E8%A7%A3/</link>
      <pubDate>Mon, 15 Mar 2021 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/context%E8%AF%A6%E8%A7%A3/</guid>
      <description>&lt;h1 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯ &lt;a href=&#34;#%e8%83%8c%e6%99%af&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;golangåœ¨1.6.2çš„æ—¶å€™è¿˜æ²¡æœ‰è‡ªå·±çš„contextï¼Œåœ¨1.7çš„ç‰ˆæœ¬ä¸­å°±æŠŠgolang.org/x/net/contextåŒ…è¢«åŠ å…¥åˆ°äº†å®˜æ–¹çš„åº“ä¸­ã€‚golang çš„ ContextåŒ…ï¼Œæ˜¯ä¸“é—¨ç”¨æ¥ç®€åŒ–å¯¹äºå¤„ç†å•ä¸ªè¯·æ±‚çš„å¤šä¸ªgoroutineä¹‹é—´ä¸è¯·æ±‚åŸŸçš„æ•°æ®ã€å–æ¶ˆä¿¡å·ã€æˆªæ­¢æ—¶é—´ç­‰ç›¸å…³æ“ä½œï¼Œè¿™äº›æ“ä½œå¯èƒ½æ¶‰åŠå¤šä¸ª API è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰ä¸€ä¸ªç½‘ç»œè¯·æ±‚Requestï¼Œæ¯ä¸ªRequestéƒ½éœ€è¦å¼€å¯ä¸€ä¸ªgoroutineåšä¸€äº›äº‹æƒ…ï¼Œè¿™äº›goroutineåˆå¯èƒ½ä¼šå¼€å¯å…¶ä»–çš„goroutineã€‚è¿™æ ·çš„è¯ï¼Œ æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Contextï¼Œæ¥è·Ÿè¸ªè¿™äº›goroutineï¼Œå¹¶ä¸”é€šè¿‡Contextæ¥æ§åˆ¶ä»–ä»¬çš„ç›®çš„ï¼Œè¿™å°±æ˜¯Goè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›çš„Contextï¼Œä¸­æ–‡å¯ä»¥ç§°ä¹‹ä¸ºâ€œä¸Šä¸‹æ–‡â€ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªå®é™…ä¾‹å­æ˜¯ï¼Œåœ¨GoæœåŠ¡å™¨ç¨‹åºä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šæœ‰ä¸€ä¸ªgoroutineå»å¤„ç†ã€‚ç„¶è€Œï¼Œå¤„ç†ç¨‹åºå¾€å¾€è¿˜éœ€è¦åˆ›å»ºé¢å¤–çš„goroutineå»è®¿é—®åç«¯èµ„æºï¼Œæ¯”å¦‚æ•°æ®åº“ã€RPCæœåŠ¡ç­‰ã€‚ç”±äºè¿™äº›goroutineéƒ½æ˜¯åœ¨å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥å®ƒä»¬å¾€å¾€éœ€è¦è®¿é—®ä¸€äº›å…±äº«çš„èµ„æºï¼Œæ¯”å¦‚ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€è®¤è¯tokenã€è¯·æ±‚æˆªæ­¢æ—¶é—´ç­‰ã€‚è€Œä¸”å¦‚æœè¯·æ±‚è¶…æ—¶æˆ–è€…è¢«å–æ¶ˆåï¼Œæ‰€æœ‰çš„goroutineéƒ½åº”è¯¥é©¬ä¸Šé€€å‡ºå¹¶ä¸”é‡Šæ”¾ç›¸å…³çš„èµ„æºã€‚è¿™ç§æƒ…å†µä¹Ÿéœ€è¦ç”¨Contextæ¥ä¸ºæˆ‘ä»¬å–æ¶ˆæ‰æ‰€æœ‰goroutine&lt;/p&gt;
&lt;p&gt;å¦‚æœè¦ä½¿ç”¨å¯ä»¥é€šè¿‡ go get golang.org/x/net/context å‘½ä»¤è·å–è¿™ä¸ªåŒ…ã€‚&lt;/p&gt;
&lt;h1 id=&#34;contextåŸç†&#34;&gt;ContextåŸç† &lt;a href=&#34;#context%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Context çš„è°ƒç”¨åº”è¯¥æ˜¯é“¾å¼çš„ï¼Œé€šè¿‡&lt;code&gt;WithCancel&lt;/code&gt;ï¼Œ&lt;code&gt;WithDeadline&lt;/code&gt;ï¼Œ&lt;code&gt;WithTimeout&lt;/code&gt;æˆ–&lt;code&gt;WithValue&lt;/code&gt;æ´¾ç”Ÿå‡ºæ–°çš„ Context.å½“çˆ¶ Context è¢«å–æ¶ˆæ—¶ï¼Œå…¶æ´¾ç”Ÿçš„æ‰€æœ‰ Context éƒ½å°†å–æ¶ˆ.&lt;/p&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;context.WithXXX&lt;/code&gt;éƒ½å°†è¿”å›æ–°çš„ Context å’Œ CancelFunc.è°ƒç”¨ CancelFunc å°†å–æ¶ˆå­ä»£ï¼Œç§»é™¤çˆ¶ä»£å¯¹å­ä»£çš„å¼•ç”¨ï¼Œå¹¶ä¸”åœæ­¢æ‰€æœ‰å®šæ—¶å™¨.æœªèƒ½è°ƒç”¨ CancelFunc å°†æ³„æ¼å­ä»£ï¼Œç›´åˆ°çˆ¶ä»£è¢«å–æ¶ˆæˆ–å®šæ—¶å™¨è§¦å‘.go vetå·¥å…·æ£€æŸ¥æ‰€æœ‰æµç¨‹æ§åˆ¶è·¯å¾„ä¸Šä½¿ç”¨ CancelFuncs.&lt;/p&gt;
&lt;h1 id=&#34;éµå¾ªè§„åˆ™&#34;&gt;éµå¾ªè§„åˆ™ &lt;a href=&#34;#%e9%81%b5%e5%be%aa%e8%a7%84%e5%88%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;éµå¾ªä»¥ä¸‹è§„åˆ™ï¼Œä»¥ä¿æŒåŒ…ä¹‹é—´çš„æ¥å£ä¸€è‡´ï¼Œå¹¶å¯ç”¨é™æ€åˆ†æå·¥å…·ä»¥æ£€æŸ¥ä¸Šä¸‹æ–‡ä¼ æ’­.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸è¦å°† Contexts æ”¾å…¥ç»“æ„ä½“ï¼Œç›¸å&lt;code&gt;context&lt;/code&gt;åº”è¯¥ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ï¼Œå‘½åä¸º&lt;code&gt;ctx. func DoSomethingï¼ˆctx context.Contextï¼Œarg Argï¼‰error { // ... use ctx ... }&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å³ä½¿å‡½æ•°å…è®¸ï¼Œä¹Ÿä¸è¦ä¼ å…¥&lt;code&gt;nil&lt;/code&gt;çš„ Context.å¦‚æœä¸çŸ¥é“ç”¨å“ªç§ Contextï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;context.TODO()&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨contextçš„Valueç›¸å…³æ–¹æ³•åªåº”è¯¥ç”¨äºåœ¨ç¨‹åºå’Œæ¥å£ä¸­ä¼ é€’çš„å’Œè¯·æ±‚ç›¸å…³çš„å…ƒæ•°æ®ï¼Œä¸è¦ç”¨å®ƒæ¥ä¼ é€’ä¸€äº›å¯é€‰çš„å‚æ•°.&lt;/li&gt;
&lt;li&gt;ç›¸åŒçš„ Context å¯ä»¥ä¼ é€’ç»™åœ¨ä¸åŒçš„goroutineï¼›Context æ˜¯å¹¶å‘å®‰å…¨çš„.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;contextåŒ…&#34;&gt;ContextåŒ… &lt;a href=&#34;#context%e5%8c%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Contextç»“æ„&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Context interface {
    // åœ¨Contextè¶…æ—¶æˆ–å–æ¶ˆæ—¶ï¼ˆå³ç»“æŸäº†ï¼‰è¿”å›ä¸€ä¸ªå…³é—­çš„channel
    // å³å¦‚æœå½“å‰Contextè¶…æ—¶æˆ–å–æ¶ˆæ—¶ï¼ŒDoneæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªchannelï¼Œç„¶åå…¶ä»–åœ°æ–¹å°±å¯ä»¥é€šè¿‡åˆ¤æ–­Doneæ–¹æ³•æ˜¯å¦æœ‰è¿”å›ï¼ˆchannelï¼‰ï¼Œå¦‚æœæœ‰åˆ™è¯´æ˜Contextå·²ç»“æŸ
    // æ•…å…¶å¯ä»¥ä½œä¸ºå¹¿æ’­é€šçŸ¥å…¶ä»–ç›¸å…³æ–¹æœ¬Contextå·²ç»“æŸï¼Œè¯·åšç›¸å…³å¤„ç†.
    Done() &amp;lt;-chan struct{}

    // è¿”å›Contextå–æ¶ˆçš„åŸå› 
    Err() error

    // è¿”å›Contextçš„è¶…æ—¶æ—¶é—´ï¼ˆè¶…æ—¶è¿”å›åœºæ™¯ï¼‰
    Deadline() (deadline time.Time, ok bool)

    // å€¼è¿”å›ä¸é”®å…³è”çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›nilã€‚
    Value(key interface{}) interface{}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰€æœ‰æ–¹æ³•&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Background() Context
func TODO() Context

func WithCancel(parent Context) (ctx Context, cancel CancelFunc)
func WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc)
func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc)
func WithValue(parent Context, key, val interface{}) Context
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢å¯ä»¥çœ‹åˆ°Contextæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæƒ³è¦ä½¿ç”¨å°±å¾—å®ç°å…¶æ–¹æ³•.åœ¨contextåŒ…å†…éƒ¨å·²ç»ä¸ºæˆ‘ä»¬å®ç°å¥½äº†ä¸¤ä¸ªç©ºçš„Contextï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨Background()å’ŒTODO()æ–¹æ³•è·å–.ä¸€èˆ¬çš„å°†å®ƒä»¬ä½œä¸ºContextçš„æ ¹ï¼Œå¾€ä¸‹æ´¾ç”Ÿ.&lt;/p&gt;
&lt;h1 id=&#34;withcancel-ä¾‹å­&#34;&gt;WithCancel ä¾‹å­ &lt;a href=&#34;#withcancel-%e4%be%8b%e5%ad%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;WithCancel ä»¥ä¸€ä¸ªæ–°çš„ Done channel è¿”å›ä¸€ä¸ªçˆ¶ Context çš„æ‹·è´.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; func WithCancel(parent Context) (ctx Context, cancel CancelFunc) {
         c := newCancelCtx(parent)
         propagateCancel(parent, &amp;amp;c)
         return &amp;amp;c, func() { c.cancel(true, Canceled) }
     }
     
     // newCancelCtx returns an initialized cancelCtx.
     func newCancelCtx(parent Context) cancelCtx {
         return cancelCtx{
             Context: parent,
             done:    make(chan struct{}),
         }
     }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ­¤ç¤ºä¾‹æ¼”ç¤ºä½¿ç”¨ä¸€ä¸ªå¯å–æ¶ˆçš„ä¸Šä¸‹æ–‡ï¼Œä»¥é˜²æ­¢ goroutine æ³„æ¼.ç¤ºä¾‹å‡½æ•°ç»“æŸæ—¶ï¼Œdefer è°ƒç”¨ cancel æ–¹æ³•ï¼Œgen goroutine å°†è¿”å›è€Œä¸æ³„æ¼.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;context&amp;#34;
    &amp;#34;fmt&amp;#34;
)

func main() {
    gen := func(ctx context.Context) &amp;lt;-chan int {
        dst := make(chan int)
        n := 1
        go func() {
            for {
                select {
                case &amp;lt;-ctx.Done():
                    return // returning not to leak the goroutine
                case dst &amp;lt;- n:
                    n++
                }
            }
        }()
        return dst
    }

    ctx, cancel := context.WithCancel(context.Background())
    defer cancel() // cancel when we are finished consuming integers

    for n := range gen(ctx) {
        fmt.Println(n)
        if n == 5 {
            break
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;withdeadline-ä¾‹å­&#34;&gt;WithDeadline ä¾‹å­ &lt;a href=&#34;#withdeadline-%e4%be%8b%e5%ad%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  func WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc) {
         if cur, ok := parent.Deadline(); ok &amp;amp;&amp;amp; cur.Before(deadline) {
             // The current deadline is already sooner than the new one.
             return WithCancel(parent)
         }
         c := &amp;amp;timerCtx{
             cancelCtx: newCancelCtx(parent),
             deadline:  deadline,
         }
   ......
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œå½“æ´¾ç”Ÿå‡ºçš„å­ Context çš„deadlineåœ¨çˆ¶Contextä¹‹åï¼Œç›´æ¥è¿”å›äº†ä¸€ä¸ªçˆ¶Contextçš„æ‹·è´.æ•…è¯­ä¹‰ä¸Šç­‰æ•ˆä¸ºçˆ¶.&lt;/p&gt;
&lt;p&gt;WithDeadline çš„æœ€åæœŸé™è°ƒæ•´ä¸ºä¸æ™šäº d è¿”å›çˆ¶ä¸Šä¸‹æ–‡çš„å‰¯æœ¬.å¦‚æœçˆ¶æ¯çš„æˆªæ­¢æ—¥æœŸå·²ç»æ—©äº dï¼ŒWithDeadline ï¼ˆçˆ¶ï¼Œdï¼‰ æ˜¯åœ¨è¯­ä¹‰ä¸Šç­‰æ•ˆä¸ºçˆ¶.è¿”å›çš„ä¸Šä¸‹æ–‡å®Œæˆçš„é€šé“å…³é—­çš„æœ€åæœŸé™æœŸæ»¡åï¼Œè¿”å›çš„å–æ¶ˆå‡½æ•°è°ƒç”¨æ—¶ï¼Œæˆ–å½“çˆ¶ä¸Šä¸‹æ–‡å®Œæˆçš„é€šé“å…³é—­ï¼Œä»¥å…ˆå‘ç”Ÿè€…ä¸ºå‡†.&lt;/p&gt;
&lt;p&gt;çœ‹çœ‹å®˜æ–¹çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;context&amp;#34;
    &amp;#34;fmt&amp;#34;
    &amp;#34;time&amp;#34;
)

func main() {
    d := time.Now().Add(50 * time.Millisecond)
    ctx, cancel := context.WithDeadline(context.Background(), d)

    //å³ä½¿ctxå°†ä¼šè¿‡æœŸï¼Œè¿˜æ˜¯æœ€å¥½å°†å…¶è°ƒç”¨
    //åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å…·æœ‰å–æ¶ˆåŠŸèƒ½ã€‚ å¦åˆ™å¯èƒ½ä¼šä½¿
    //ä¸Šä¸‹æ–‡åŠå…¶çˆ¶å¯¹è±¡çš„ç”Ÿå­˜æ—¶é—´è¶…å‡ºäº†å¿…è¦ã€‚
    defer cancel()

    select {
    case &amp;lt;-time.After(1 * time.Second):
        fmt.Println(&amp;#34;overslept&amp;#34;)
    case &amp;lt;-ctx.Done():
        fmt.Println(ctx.Err())
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;withtimeout-ä¾‹å­&#34;&gt;WithTimeout ä¾‹å­ &lt;a href=&#34;#withtimeout-%e4%be%8b%e5%ad%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc) {
         return WithDeadline(parent, time.Now().Add(timeout))
     }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å®˜æ–¹ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;context&amp;#34;
    &amp;#34;fmt&amp;#34;
    &amp;#34;time&amp;#34;
)

func main() {
    // Pass a context with a timeout to tell a blocking function that it
    // should abandon its work after the timeout elapses.
    ctx, cancel := context.WithTimeout(context.Background(), 50*time.Millisecond)
    defer cancel()

    select {
    case &amp;lt;-time.After(1 * time.Second):
        fmt.Println(&amp;#34;overslept&amp;#34;)
    case &amp;lt;-ctx.Done():
        fmt.Println(ctx.Err()) // prints &amp;#34;context deadline exceeded&amp;#34;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;withvalue&#34;&gt;WithValue &lt;a href=&#34;#withvalue&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  func WithValue(parent Context, key, val interface{}) Context {
         if key == nil {
             panic(&amp;#34;nil key&amp;#34;)
         }
         if !reflect.TypeOf(key).Comparable() {
             panic(&amp;#34;key is not comparable&amp;#34;)
         }
         return &amp;amp;valueCtx{parent, key, val}
     }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;WithValue è¿”å›çš„çˆ¶ä¸é”®å…³è”çš„å€¼åœ¨ val çš„å‰¯æœ¬.&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šä¸‹æ–‡å€¼ä»…ä¸ºè¿‡æ¸¡è¿›ç¨‹å’Œ Api çš„è¯·æ±‚èŒƒå›´çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å°†å¯é€‰å‚æ•°ä¼ é€’ç»™å‡½æ•°.&lt;/p&gt;
&lt;p&gt;æä¾›çš„é”®å¿…é¡»æ˜¯å¯æ¯”æ€§å’Œåº”è¯¥ä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹æˆ–ä»»ä½•å…¶ä»–å†…ç½®çš„ç±»å‹ä»¥é¿å…åŒ…ä½¿ç”¨çš„ä¸Šä¸‹æ–‡ä¹‹é—´çš„ç¢°æ’.WithValue ç”¨æˆ·åº”è¯¥å®šä¹‰è‡ªå·±çš„é”®çš„ç±»å‹.ä¸ºäº†é¿å…åˆ†é…åˆ†é…ç»™æ¥å£ {} æ—¶ï¼Œä¸Šä¸‹æ–‡é”®ç»å¸¸æœ‰å…·ä½“ç±»å‹ç»“æ„ {}.å¦å¤–ï¼Œå¯¼å‡ºçš„ä¸Šä¸‹æ–‡å…³é”®å˜é‡é™æ€ç±»å‹åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‡é’ˆæˆ–æ¥å£.&lt;/p&gt;
&lt;p&gt;çœ‹çœ‹å®˜æ–¹ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;context&amp;#34;
    &amp;#34;fmt&amp;#34;
)

func main() {
    type favContextKey string

    f := func(ctx context.Context, k favContextKey) {
        if v := ctx.Value(k); v != nil {
            fmt.Println(&amp;#34;found value:&amp;#34;, v)
            return
        }
        fmt.Println(&amp;#34;key not found:&amp;#34;, k)
    }

    k := favContextKey(&amp;#34;language&amp;#34;)
    ctx := context.WithValue(context.Background(), k, &amp;#34;Go&amp;#34;)

    f(ctx, k)
    f(ctx, favContextKey(&amp;#34;color&amp;#34;))
}
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;æ–‡ç« æ¥æºï¼šhttps://mojotv.cn/2019/06/26/golang-context&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>fridaæ•™ç¨‹</title>
      <link>https://abnerxc.github.io/android/frida%E6%95%99%E7%A8%8B/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/android/frida%E6%95%99%E7%A8%8B/</guid>
      <description>&lt;h1 id=&#34;fridaæ•™ç¨‹&#34;&gt;fridaæ•™ç¨‹ &lt;a href=&#34;#frida%e6%95%99%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;frida&#34;&gt;frida &lt;a href=&#34;#frida&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å‘½ä»¤ï¼š&lt;code&gt;pip install frida&lt;/code&gt;  , ä¸‹è½½åœ°å€ï¼šhttps://github.com/frida/frida&lt;/li&gt;
&lt;li&gt;å‘½ä»¤ï¼š&lt;code&gt;pip install frida-tools&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä¸‹è½½ï¼šfrida-server ï¼ŒæŸ¥çœ‹CPUæ¶æ„ &lt;code&gt;adb shell getprop ro.product.cpu.abi&lt;/code&gt;ï¼Œä¸‹è½½åœ°å€ï¼šhttps:github.com/frida/frida/releases&lt;/li&gt;
&lt;li&gt;å‡çº§ï¼š&lt;code&gt;pip install -U frida frida-tools&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¸è½½  &lt;code&gt;pip uninstall frida frida-tools&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å®‰è£…æŒ‡å®šç‰ˆæœ¬ &lt;code&gt;pip install frida==14.2.18  &amp;amp;&amp;amp;  pip install frida-tools==9.2.4&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è¿æ¥è®¾å¤‡&#34;&gt;è¿æ¥è®¾å¤‡ &lt;a href=&#34;#%e8%bf%9e%e6%8e%a5%e8%ae%be%e5%a4%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;æ¨¡æ‹Ÿå™¨&#34;&gt;æ¨¡æ‹Ÿå™¨ &lt;a href=&#34;#%e6%a8%a1%e6%8b%9f%e5%99%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å‘½ä»¤ï¼š&lt;code&gt;adb kill-server &amp;amp;&amp;amp; adb start-server &amp;amp;&amp;amp;  adb devices&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ¨¡æ‹Ÿå™¨æ‰“å¼€&lt;code&gt;USBè°ƒè¯•&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;adb connect 127.0.0.1:21503(é€é¥æ¨¡æ‹Ÿå™¨ç«¯å£)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;çœŸæœº&#34;&gt;çœŸæœº &lt;a href=&#34;#%e7%9c%9f%e6%9c%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å‘½ä»¤ï¼š&lt;code&gt;adb kill-server &amp;amp;&amp;amp; adb start-server &amp;amp;&amp;amp;  adb devices&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ‰“å¼€&lt;code&gt;USBè°ƒè¯•&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¯åŠ¨frida-server&#34;&gt;å¯åŠ¨frida-server &lt;a href=&#34;#%e5%90%af%e5%8a%a8frida-server&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;ä¸Šä¼ æ–‡ä»¶ï¼š&lt;code&gt;adb push frida-server&lt;/code&gt; åˆ°è·¯å¾„ &lt;code&gt;/data/local/tmp&lt;/code&gt; å¹¶ä¿®æ”¹æƒé™&lt;code&gt;chmod +x frida-server&lt;/code&gt;ï¼Œè¿è¡Œå³å¯&lt;/li&gt;
&lt;li&gt;ç«¯å£è½¬å‘ï¼š&lt;code&gt;adb forward tcp:27042 tcp:27042&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;éªŒè¯ï¼š&lt;code&gt;frida-ps -R&lt;/code&gt;éªŒè¯fridaæ˜¯å¦æ­£å¸¸è·å–è¿œç¨‹è®¾å¤‡è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;è„šæœ¬æ³¨å…¥ï¼š&lt;code&gt;frida -U -l hookssl.js -f com.yiban.app --no-pause&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹é»˜è®¤ç«¯å£å¯åŠ¨&lt;code&gt;frida-server -l 0.0.0.0:1234&lt;/code&gt; ,è½¬å‘åˆ°æœ¬åœ°&lt;code&gt;adb forward tcp:1234 tcp:1234&lt;/code&gt;,æ‰§è¡Œæ–‡ä»¶ &lt;code&gt;frida -H 127.0.0.1:1234 packageNameï¼ˆåŒ…åï¼‰ -l script.js&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;fridaåº”ç”¨&#34;&gt;fridaåº”ç”¨ &lt;a href=&#34;#frida%e5%ba%94%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;frida-dexdumpè„±å£³&#34;&gt;frida-dexdumpè„±å£³ &lt;a href=&#34;#frida-dexdump%e8%84%b1%e5%a3%b3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å®‰è£…ï¼š&lt;code&gt;pip install frida-dexdump&lt;/code&gt; ,ä¸‹è½½åœ°å€ï¼šhttps://github.com/hluwa/frida-dexdump&lt;/li&gt;
&lt;li&gt;è„±å£³å‘½ä»¤ï¼š&lt;code&gt;frida-dexdump -U -d -f åŒ…å -o å­˜æ”¾dexè·¯å¾„&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;objectionæ•™ç¨‹&#34;&gt;Objectionæ•™ç¨‹ &lt;a href=&#34;#objection%e6%95%99%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å®‰è£…&#34;&gt;å®‰è£… &lt;a href=&#34;#%e5%ae%89%e8%a3%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å®‰è£…ï¼š&lt;code&gt;pip install objection==1.11.0&lt;/code&gt;ï¼Œ é€‰æ‹©å®‰è£…ä¸fridaç‰ˆæœ¬ç›¸è¿‘çš„ç‰ˆæœ¬ï¼Œpypiå®˜ç½‘æŸ¥çœ‹Objectionç‰ˆæœ¬,åœ°å€ï¼šhttps://pypi.org/project/objection/ ï¼Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ³¨å…¥&#34;&gt;æ³¨å…¥ &lt;a href=&#34;#%e6%b3%a8%e5%85%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å‘½ä»¤ï¼š&lt;code&gt;objection -g åŒ…å explore&lt;/code&gt;ï¼Œå¦‚æœæŒ‡å®šç«¯å£äº† &lt;code&gt;objection -N -h 127.0.0.1 -p 1234 -g com.ccb.longjiLife explore&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>HttpClientä½¿ç”¨æŠ€å·§</title>
      <link>https://abnerxc.github.io/note/java-httpclient%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/java-httpclient%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</guid>
      <description>&lt;h2 id=&#34;1-è§„èŒƒèƒŒæ™¯&#34;&gt;1. è§„èŒƒèƒŒæ™¯ &lt;a href=&#34;#1-%e8%a7%84%e8%8c%83%e8%83%8c%e6%99%af&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;11-http-clienté€‰æ‹©&#34;&gt;1.1. http clienté€‰æ‹© &lt;a href=&#34;#11-http-client%e9%80%89%e6%8b%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æ— ç‰¹æ®Šæƒ…å†µï¼ˆæ¯”å¦‚ï¼šå•æœºtpsä¸Šåƒï¼‰ï¼Œå»ºè®®é€‰Spring Rest Templateåšé—¨é¢ï¼ŒApache HttpClient 4.xåšå®ç°&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;12-rest-template-è¿è¡Œç¯å¢ƒ&#34;&gt;1.2. rest template è¿è¡Œç¯å¢ƒ &lt;a href=&#34;#12-rest-template-%e8%bf%90%e8%a1%8c%e7%8e%af%e5%a2%83&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;jdk 1.8&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;spring booté¡¹ç›®&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-é…ç½®-rest-template&#34;&gt;2. é…ç½® rest template &lt;a href=&#34;#2-%e9%85%8d%e7%bd%ae-rest-template&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;21-å¼•å…¥jaråŒ…&#34;&gt;2.1. å¼•å…¥jaråŒ… &lt;a href=&#34;#21-%e5%bc%95%e5%85%a5jar%e5%8c%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Spring Rest Templateåœ¨spring-webæ¨¡å—ä¸­å†…ç½®äº†ï¼Œspring bootä¼šè‡ªåŠ¨å¸®ä½ å¼•è¿›æ¥ï¼Œå› æ­¤æ— éœ€å†å¼•å…¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¼•å…¥Apache HttpClient 4.xåŒ…:&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.apache.httpcomponents&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;httpclient&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.5.5&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- å¦‚æœä¸é…å¼‚æ­¥ï¼ˆAsyncRestTemplateï¼‰ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸ªä¾èµ– --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;io.netty&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;netty-all&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.1.5.Final&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;22-ç¼–å†™-yml-æ–‡ä»¶é…ç½®å¯é€‰&#34;&gt;2.2. ç¼–å†™ yml æ–‡ä»¶é…ç½®ï¼ˆå¯é€‰ï¼‰ &lt;a href=&#34;#22-%e7%bc%96%e5%86%99-yml-%e6%96%87%e4%bb%b6%e9%85%8d%e7%bd%ae%e5%8f%af%e9%80%89&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# ymlé…ç½®çš„ä¼˜å…ˆçº§é«˜äºjavaé…ç½®ï¼›å¦‚æœymlé…ç½®å’Œjavaé…ç½®åŒæ—¶å­˜åœ¨ï¼Œåˆ™ymlé…ç½®ä¼šè¦†ç›–javaé…ç½®
####restTemplateçš„ymlé…ç½®å¼€å§‹####
spring:
  restTemplate:
    maxTotalConnect: 1000 #è¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°ï¼Œ0ä»£è¡¨ä¸é™ï¼›å¦‚æœå–0ï¼Œéœ€è¦è€ƒè™‘è¿æ¥æ³„éœ²å¯¼è‡´ç³»ç»Ÿå´©æºƒçš„åæœ
    maxConnectPerRoute: 200
    connectTimeout: 3000
    readTimeout: 5000
    charset: UTF-8
####restTemplateçš„ ymlé…ç½®å¼€å§‹####
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;23-ç¼–å†™javaé…ç½®å¿…å¤‡ä¸å¯çœç•¥&#34;&gt;2.3. ç¼–å†™javaé…ç½®ï¼ˆå¿…å¤‡ï¼Œä¸å¯çœç•¥ï¼‰ &lt;a href=&#34;#23-%e7%bc%96%e5%86%99java%e9%85%8d%e7%bd%ae%e5%bf%85%e5%a4%87%e4%b8%8d%e5%8f%af%e7%9c%81%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//xxxä»£è¡¨ä½ çš„é¡¹ç›®ï¼Œä¾‹å¦‚ï¼š
//com.douyu.wsd.adx.gateway.config
//com.douyu.wsd.venus.config
//å¯ä»¥å†™ä¸€çº§ï¼Œä¹Ÿå¯ä»¥å†™å¤šçº§ï¼Œå…·ä½“è‡ªå·±éšæ„
package com.douyu.wsd.xxx.config;



import java.nio.charset.Charset;
import java.util.LinkedList;
import java.util.List;

import org.apache.http.Header;
import org.apache.http.client.HttpRequestRetryHandler;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.DefaultHttpRequestRetryHandler;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.impl.conn.PoolingHttpClientConnectionManager;
import org.apache.http.message.BasicHeader;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.client.ClientHttpRequestFactory;
import org.springframework.http.client.HttpComponentsClientHttpRequestFactory;
import org.springframework.http.client.Netty4ClientHttpRequestFactory;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.http.converter.StringHttpMessageConverter;
import org.springframework.web.client.AsyncRestTemplate;
import org.springframework.web.client.DefaultResponseErrorHandler;
import org.springframework.web.client.RestTemplate;

@Configuration
@ConfigurationProperties(prefix = &amp;#34;spring.restTemplate&amp;#34;)
@ConditionalOnClass(value = {RestTemplate.class, CloseableHttpClient.class})
public class RestTemplateConfiguration {

    // javaé…ç½®çš„ä¼˜å…ˆçº§ä½äºymlé…ç½®ï¼›å¦‚æœymlé…ç½®ä¸å­˜åœ¨ï¼Œä¼šé‡‡ç”¨javaé…ç½®
    // ####restTemplateçš„ javaé…ç½®å¼€å§‹####

    private int maxTotalConnection = 500; //è¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°

    private int maxConnectionPerRoute = 100; //åŒè·¯ç”±çš„å¹¶å‘æ•°

    private int connectionTimeout = 2 * 1000; //è¿æ¥è¶…æ—¶ï¼Œé»˜è®¤2s

    private int readTimeout = 30 * 1000; //è¯»å–è¶…æ—¶ï¼Œé»˜è®¤30s

    private String charset = &amp;#34;UTF-8&amp;#34;;

    // ####restTemplateçš„ javaé…ç½®ç»“æŸ####

    public void setMaxTotalConnection(int maxTotalConnection) {
        this.maxTotalConnection = maxTotalConnection;
    }

    public void setMaxConnectionPerRoute(int maxConnectionPerRoute) {
        this.maxConnectionPerRoute = maxConnectionPerRoute;
    }

    public void setConnectionTimeout(int connectionTimeout) {
        this.connectionTimeout = connectionTimeout;
    }

    public void setReadTimeout(int readTimeout) {
        this.readTimeout = readTimeout;
    }

    public void setCharset(String charset) {
        this.charset = charset;
    }

    //åˆ›å»ºHTTPå®¢æˆ·ç«¯å·¥å‚
    @Bean(name = &amp;#34;clientHttpRequestFactory&amp;#34;)
    public ClientHttpRequestFactory clientHttpRequestFactory() {
        return createClientHttpRequestFactory(this.connectionTimeout, this.readTimeout);
    }

    //åˆå§‹åŒ–RestTemplate,å¹¶åŠ å…¥springçš„Beanå·¥å‚ï¼Œç”±springç»Ÿä¸€ç®¡ç†
    @Bean(name = &amp;#34;restTemplate&amp;#34;)
    @ConditionalOnMissingBean(RestTemplate.class)
    public RestTemplate restTemplate(ClientHttpRequestFactory factory) {
        return createRestTemplate(factory);
    }

    //åˆå§‹åŒ–æ”¯æŒå¼‚æ­¥çš„RestTemplate,å¹¶åŠ å…¥springçš„Beanå·¥å‚ï¼Œç”±springç»Ÿä¸€ç®¡ç†
    //å¦‚æœä½ ç”¨ä¸åˆ°å¼‚æ­¥ï¼Œåˆ™æ— é¡»åˆ›å»ºè¯¥å¯¹è±¡
    @Bean(name = &amp;#34;asyncRestTemplate&amp;#34;)
    @ConditionalOnMissingBean(AsyncRestTemplate.class)
    public AsyncRestTemplate asyncRestTemplate(RestTemplate restTemplate) {
        final Netty4ClientHttpRequestFactory factory = new Netty4ClientHttpRequestFactory();
        factory.setConnectTimeout(this.connectionTimeout);
        factory.setReadTimeout(this.readTimeout);
        return new AsyncRestTemplate(factory, restTemplate);
    }

    private ClientHttpRequestFactory createClientHttpRequestFactory(int connectionTimeout, int readTimeout) {
        //maxTotalConnection å’Œ maxConnectionPerRoute å¿…é¡»è¦é…
        if (this.maxTotalConnection &amp;lt;= 0) {
            throw new IllegalArgumentException(&amp;#34;invalid maxTotalConnection: &amp;#34; + maxTotalConnection);
        }
        if (this.maxConnectionPerRoute &amp;lt;= 0) {
            throw new IllegalArgumentException(&amp;#34;invalid maxConnectionPerRoute: &amp;#34; + maxTotalConnection);
        }

        //å…¨å±€é»˜è®¤çš„headerå¤´é…ç½®
        List&amp;lt;Header&amp;gt; headers = new LinkedList&amp;lt;&amp;gt;();
        headers.add(new BasicHeader(&amp;#34;Accept-Encoding&amp;#34;, &amp;#34;gzip,deflate&amp;#34;));
        headers.add(new BasicHeader(&amp;#34;Accept-Language&amp;#34;, &amp;#34;zh-CN,zh;q=0.8,en;q=0.6&amp;#34;));

        //ç¦ç”¨è‡ªåŠ¨é‡è¯•ï¼Œéœ€è¦é‡è¯•æ—¶ï¼Œè¯·è‡ªè¡Œæ§åˆ¶
        HttpRequestRetryHandler retryHandler = new DefaultHttpRequestRetryHandler(0, false);

        PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager();
        cm.setMaxTotal(maxTotalConnection);
        cm.setDefaultMaxPerRoute(maxConnectionPerRoute);

        //åˆ›å»ºçœŸæ­£å¤„ç†httpè¯·æ±‚çš„httpClientå®ä¾‹
        CloseableHttpClient httpClient = HttpClients.custom()
                .setDefaultHeaders(headers)
                .setRetryHandler(retryHandler)
                .setConnectionManager(cm)
                .build();

        HttpComponentsClientHttpRequestFactory factory = new HttpComponentsClientHttpRequestFactory(
                httpClient);
        factory.setConnectTimeout(connectionTimeout);
        factory.setReadTimeout(readTimeout);
        return factory;
    }

    private RestTemplate createRestTemplate(ClientHttpRequestFactory factory) {
        RestTemplate restTemplate = new RestTemplate(factory);

        //æˆ‘ä»¬é‡‡ç”¨RestTemplateå†…éƒ¨çš„MessageConverter
        //é‡æ–°è®¾ç½®StringHttpMessageConverterå­—ç¬¦é›†ï¼Œè§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜
        modifyDefaultCharset(restTemplate);

        //è®¾ç½®é”™è¯¯å¤„ç†å™¨
        restTemplate.setErrorHandler(new DefaultResponseErrorHandler());

        return restTemplate;
    }

    private void modifyDefaultCharset(RestTemplate restTemplate) {
        List&amp;lt;HttpMessageConverter&amp;lt;?&amp;gt;&amp;gt; converterList = restTemplate.getMessageConverters();
        HttpMessageConverter&amp;lt;?&amp;gt; converterTarget = null;
        for (HttpMessageConverter&amp;lt;?&amp;gt; item : converterList) {
            if (StringHttpMessageConverter.class == item.getClass()) {
                converterTarget = item;
                break;
            }
        }
        if (null != converterTarget) {
            converterList.remove(converterTarget);
        }
        Charset defaultCharset = Charset.forName(charset);
        converterList.add(1, new StringHttpMessageConverter(defaultCharset));
    }

}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åšå®Œä¸Šè¿°é…ç½®ï¼Œå°±ç”Ÿæˆäº†å¯ç”¨çš„RestTemplateå®ä¾‹&lt;/p&gt;
&lt;p&gt;é‡‡ç”¨ä¸Šè¿°é…ç½®ï¼Œå¯ä»¥åšåˆ°å¼€ç®±å³ç”¨ï¼›è‡ªå·±é…ï¼Œå¯èƒ½ä¼šè¸©äº›å‘ï¼Œæ¯”å¦‚ï¼š&lt;a href=&#34;http://doc.dz11.com/ddse/preview/share/9c0f4c855b09e2b1cf33?sid=187&#34;&gt;spring boot é…ç½®æŠ€å·§&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;3-rest-templateåŸºæœ¬ç”¨æ³•&#34;&gt;3. rest templateåŸºæœ¬ç”¨æ³• &lt;a href=&#34;#3-rest-template%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;31-getæ¼”ç¤º&#34;&gt;3.1. getæ¼”ç¤º &lt;a href=&#34;#31-get%e6%bc%94%e7%a4%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ¼”ç¤ºä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.lang.StringUtils;

import java.net.URLEncoder;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.AsyncRestTemplate;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @Resource
    private AsyncRestTemplate asyncRestTemplate;

    //æœ€ç®€å•çš„getæ“ä½œ
    @RequestMapping(&amp;#34;/get&amp;#34;)
    public String testGet(String keyword) throws Exception {
        String kw = StringUtils.defaultString(URLEncoder.encode(keyword, &amp;#34;UTF-8&amp;#34;));
        String html = restTemplate.getForObject(&amp;#34;https://www.douyu.com/search/?kw=&amp;#34; + kw, String.class);
        return html;//è¿”å›çš„æ˜¯æ–—é±¼ä¸»ç«™çš„html
    }

    //éœ€è¦è‡ªå®šä¹‰headerå¤´çš„getæ“ä½œ
    @RequestMapping(&amp;#34;/get2&amp;#34;)
    public String testGet2(String keyword) throws Exception {
        HttpHeaders headers = new HttpHeaders();
        headers.set(&amp;#34;MyHeaderKey&amp;#34;, &amp;#34;MyHeaderValue&amp;#34;);
        HttpEntity entity = new HttpEntity(headers);

        String kw = StringUtils.defaultString(URLEncoder.encode(keyword, &amp;#34;UTF-8&amp;#34;));
        ResponseEntity&amp;lt;String&amp;gt; response = restTemplate.exchange(&amp;#34;https://www.douyu.com/search/?kw=&amp;#34; + kw, HttpMethod.GET, entity, String.class);
        return response.getBody();//è¿”å›çš„æ˜¯æ–—é±¼ä¸»ç«™çš„html
    }
    
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;32-postè¡¨å•æ¼”ç¤º&#34;&gt;3.2. postè¡¨å•æ¼”ç¤º &lt;a href=&#34;#32-post%e8%a1%a8%e5%8d%95%e6%bc%94%e7%a4%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ¼”ç¤ºä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;

import javax.annotation.Resource;

import com.google.common.collect.ImmutableMap;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/postForm&amp;#34;)
    public String testPostForm(String posid) throws Exception {//æµ‹è¯•ç”¨ä¾‹ï¼šposid=804009
        String url = &amp;#34;http://www.douyu.com/lapi/sign/app/getinfo?aid=android1&amp;amp;client_sys=android&amp;amp;mdid=phone&amp;amp;time=1524495658&amp;amp;token=&amp;amp;auth=789c4f732d6aa4d0a5c8fb33765af8cf&amp;#34;;
        MultiValueMap&amp;lt;String, String&amp;gt; form = new LinkedMultiValueMap&amp;lt;String, String&amp;gt;();
        form.add(&amp;#34;app&amp;#34;, &amp;#34;{\&amp;#34;aname\&amp;#34;:\&amp;#34;æ–—é±¼ç›´æ’­\&amp;#34;,\&amp;#34;pname\&amp;#34;:\&amp;#34;air.tv.douyu.android\&amp;#34;}&amp;#34;);
        form.add(&amp;#34;mdid&amp;#34;, &amp;#34;phone&amp;#34;);
        form.add(&amp;#34;cate1&amp;#34;, &amp;#34;0&amp;#34;);
        form.add(&amp;#34;client_sys&amp;#34;, &amp;#34;ios&amp;#34;);
        form.add(&amp;#34;cate2&amp;#34;, &amp;#34;0&amp;#34;);
        form.add(&amp;#34;auth&amp;#34;, &amp;#34;789c4f732d6aa4d0a5c8fb33765af8cf&amp;#34;);
        form.add(&amp;#34;roomid&amp;#34;, &amp;#34;0&amp;#34;);
        form.add(&amp;#34;posid&amp;#34;, posid);
        form.add(&amp;#34;imei&amp;#34;, &amp;#34;863254010282712&amp;#34;);

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
        //headers.add(&amp;#34;xx&amp;#34;, &amp;#34;yy&amp;#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&amp;lt;MultiValueMap&amp;lt;String, String&amp;gt;&amp;gt; formEntity = new HttpEntity&amp;lt;&amp;gt;(form, headers);
        String json = restTemplate.postForObject(url, formEntity, String.class);
        return json;//è¿”å›çš„æ˜¯å¹¿å‘Šapiçš„json
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;33-postè¯·æ±‚ä½“æ¼”ç¤º&#34;&gt;3.3. postè¯·æ±‚ä½“æ¼”ç¤º &lt;a href=&#34;#33-post%e8%af%b7%e6%b1%82%e4%bd%93%e6%bc%94%e7%a4%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ¼”ç¤ºä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/postBody&amp;#34;)
    public String testPostBody() throws Exception {
        String url = &amp;#34;https://venus.dz11.com/venus/release/pc/checkUpdate&amp;#34;;
        String jsonBody = &amp;#34;{\n&amp;#34;
                + &amp;#34;    \&amp;#34;channelCode\&amp;#34;: \&amp;#34;official\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;appCode\&amp;#34;: \&amp;#34;Douyu_Live_PC_Client\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;versionCode\&amp;#34;: \&amp;#34;201804121\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;versionName\&amp;#34;: \&amp;#34;V5.1.9\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;deviceUid\&amp;#34;: \&amp;#34;02-15-03-59-5C-E2\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;deviceResolution\&amp;#34;: \&amp;#34;1920*1080\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;token\&amp;#34;: \&amp;#34;token\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;webView\&amp;#34;: \&amp;#34;\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;osInfo\&amp;#34;: \&amp;#34;10.0\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;osType\&amp;#34;: \&amp;#34;64\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;cpuInfo\&amp;#34;:\n&amp;#34;
                + &amp;#34;    {\n&amp;#34;
                + &amp;#34;        \&amp;#34;OemId\&amp;#34;: \&amp;#34;0\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorArchitecture\&amp;#34;: \&amp;#34;0\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;PageSize\&amp;#34;: \&amp;#34;4096\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;MinimumApplicationAddress\&amp;#34;: \&amp;#34;00010000\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;MaximumApplicationAddress\&amp;#34;: \&amp;#34;7FFEFFFF\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ActiveProcessorMask\&amp;#34;: \&amp;#34;15\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;NumberOfProcessors\&amp;#34;: \&amp;#34;4\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorType\&amp;#34;: \&amp;#34;586\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;AllocationGranularity\&amp;#34;: \&amp;#34;65536\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorLevel\&amp;#34;: \&amp;#34;6\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorRevision\&amp;#34;: \&amp;#34;40457\&amp;#34;\n&amp;#34;
                + &amp;#34;    },\n&amp;#34;
                + &amp;#34;    \&amp;#34;diskInfo\&amp;#34;: \&amp;#34;931.507GB\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;memoryInfo\&amp;#34;: \&amp;#34;15.8906GB\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;driveInfo\&amp;#34;: \&amp;#34;Intel(R) HD Graphics 630:23.20.16.4973;\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;startTime\&amp;#34;: \&amp;#34;-501420357\&amp;#34;\n&amp;#34;
                + &amp;#34;}\n&amp;#34;;

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        //headers.add(&amp;#34;xx&amp;#34;, &amp;#34;yy&amp;#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&amp;lt;String&amp;gt; bodyEntity = new HttpEntity&amp;lt;&amp;gt;(jsonBody, headers);
        
        //1.ç›´æ¥æ‹¿åŸå§‹jsonä¸²
        String json = restTemplate.postForObject(url, bodyEntity, String.class);
        
        //2.å°†åŸå§‹çš„jsonä¼ è½¬æˆjavaå¯¹è±¡ï¼Œrest templateå¯ä»¥è‡ªåŠ¨å®Œæˆ
        ResultVo resultVo = restTemplate.postForObject(url, bodyEntity, ResultVo.class);
        if (resultVo != null &amp;amp;&amp;amp; resultVo.success()) {
            Object res = resultVo.getData();//dataèŠ‚ç‚¹çš„å®é™…ç±»å‹æ˜¯java.util.LinkedHashMap
            logger.info(&amp;#34;å¤„ç†æˆåŠŸï¼Œè¿”å›æ•°æ®: {}&amp;#34;, resultVo.getData());
        } else {
            logger.info(&amp;#34;å¤„ç†å¤±è´¥ï¼Œå“åº”ç»“æœ: {}&amp;#34;, resultVo);
        }

        return json;//è¿”å›çš„æ˜¯åˆ†åŒ…apiçš„json
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;34-postæ–‡ä»¶ä¸Šä¼ &#34;&gt;3.4. postæ–‡ä»¶ä¸Šä¼  &lt;a href=&#34;#34-post%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;åœºæ™¯è¯´æ˜ï¼šåªé€‚åˆå°æ–‡ä»¶ï¼ˆ20MBä»¥å†…ï¼‰ä¸Šä¼ &lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æ¼”ç¤ºä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.codec.CodecUtils;
import com.douyu.wsd.framework.common.lang.StringUtils;

import java.io.File;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.core.io.FileSystemResource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/postFile&amp;#34;)
    public String testPostBody() throws Exception {
        String filePath = &amp;#34;D:/config.png&amp;#34;;
        
        //é€šè¿‡ç£ç›˜æ–‡ä»¶ä¸Šä¼ ï¼Œå¦‚æœäº§ç”Ÿäº†ä¸´æ—¶æ–‡ä»¶ï¼Œä¸€å®šè¦è®°å¾—åˆ é™¤ï¼Œå¦åˆ™ï¼Œä¸´æ—¶æ–‡ä»¶è¶Šç§¯è¶Šå¤šï¼Œç£ç›˜ä¼šçˆ†
        FileSystemResource resource = new FileSystemResource(new File(filePath));
	
        String url = &amp;#34;http://dev.resuploader.dz11.com/Resource/Dss/put&amp;#34;;
        String appId = &amp;#34;***&amp;#34;;//æµ‹è¯•çš„æ—¶å€™æ¢æˆè‡ªå·±çš„é…ç½®
        String secureKey = &amp;#34;***&amp;#34;;
        String time = String.valueOf(System.currentTimeMillis());
        String pubStr = &amp;#34;1&amp;#34;;
        String tempStr = String.format(&amp;#34;app_id=%s&amp;amp;is_public=%s&amp;amp;time=%s&amp;amp;vframe=0%s&amp;#34;, appId, pubStr, time, secureKey);
        MultiValueMap&amp;lt;String, Object&amp;gt; form = new LinkedMultiValueMap&amp;lt;&amp;gt;();
        form.add(&amp;#34;is_public&amp;#34;, pubStr);
        form.add(&amp;#34;vframe&amp;#34;, &amp;#34;0&amp;#34;);
        form.add(&amp;#34;file&amp;#34;, resource);
        form.add(&amp;#34;app_id&amp;#34;, appId);
        form.add(&amp;#34;time&amp;#34;, time);
        form.add(&amp;#34;sign&amp;#34;, CodecUtils.md5(tempStr));

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.MULTIPART_FORM_DATA);
        //headers.add(&amp;#34;xx&amp;#34;, &amp;#34;yy&amp;#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&amp;lt;MultiValueMap&amp;lt;String, Object&amp;gt;&amp;gt; formEntity = new HttpEntity&amp;lt;&amp;gt;(form, headers);
        String json = restTemplate.postForObject(url, formEntity, String.class);
        return json;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;35-æ–‡ä»¶ä¸‹è½½&#34;&gt;3.5. æ–‡ä»¶ä¸‹è½½ &lt;a href=&#34;#35-%e6%96%87%e4%bb%b6%e4%b8%8b%e8%bd%bd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;åœºæ™¯è¯´æ˜ï¼šåªé€‚åˆå°æ–‡ä»¶ï¼ˆ10MBä»¥å†…ï¼‰ä¸‹è½½&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æ¼”ç¤ºä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.lang.StringUtils;

import java.io.IOException;
import java.io.InputStream;
import java.net.URLEncoder;
import java.util.Collections;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.springframework.core.io.InputStreamResource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/downloadFile&amp;#34;)
    public ResponseEntity testDownloadFile() throws Exception {
        String url = &amp;#34;http://editor.baidu.com/editor/download/BaiduEditor(Online)_5-9-16.exe&amp;#34;;
        HttpHeaders headers = new HttpHeaders();
        headers.setAccept(Collections.singletonList(MediaType.APPLICATION_OCTET_STREAM));
        HttpEntity&amp;lt;String&amp;gt; entity = new HttpEntity&amp;lt;&amp;gt;(headers);
        ResponseEntity&amp;lt;byte[]&amp;gt; response = restTemplate.exchange(url, HttpMethod.GET, entity, byte[].class);
        byte[] bytes = response.getBody();
        long contentLength = bytes != null ? bytes.length : 0;
        headers.setContentLength((int) contentLength);
        headers.setContentDispositionFormData(&amp;#34;baidu.exe&amp;#34;, URLEncoder.encode(&amp;#34;ç™¾åº¦å®‰è£…åŒ….exe&amp;#34;, &amp;#34;UTF-8&amp;#34;));
        return new ResponseEntity&amp;lt;&amp;gt;(response.getBody(), headers, HttpStatus.OK);
    }   
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;36-æ›´å¤šapi&#34;&gt;3.6. æ›´å¤šAPI &lt;a href=&#34;#36-%e6%9b%b4%e5%a4%9aapi&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;h4 id=&#34;361--resttemplate-api-ä¸httpåŠ¨è¯çš„å¯¹è±¡å…³ç³»&#34;&gt;3.6.1.  RestTemplate API ä¸httpåŠ¨è¯çš„å¯¹è±¡å…³ç³»ï¼š &lt;a href=&#34;#361--resttemplate-api-%e4%b8%8ehttp%e5%8a%a8%e8%af%8d%e7%9a%84%e5%af%b9%e8%b1%a1%e5%85%b3%e7%b3%bb&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;| HTTPåŠ¨è¯  | å¯¹åº”çš„RestTemplate API   |
| ++++++-  |:++++++++++++-: |
|DELETE|	delete(String, String&amp;hellip;)
|GET|	getForObject(String, Class, String&amp;hellip;)
|HEAD|	headForHeaders(String, String&amp;hellip;)
|OPTIONS|	optionsForAllow(String, String&amp;hellip;)
|POST|	postForLocation(String, Object, String&amp;hellip;)
|PUT|	put(String, Object, String&amp;hellip;)&lt;/p&gt;
&lt;h4 id=&#34;362--postgetforentity-api-å’Œ-postgetforobject-çš„åŒºåˆ«&#34;&gt;3.6.2.  (post|get)ForEntity API å’Œ (post|get)ForObject çš„åŒºåˆ« &lt;a href=&#34;#362--postgetforentity-api-%e5%92%8c-postgetforobject-%e7%9a%84%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;ForEntity APIæ‹¿åˆ°çš„æ˜¯ResponseEntityï¼Œé€šè¿‡ResponseEntityå¯ä»¥æ‹¿åˆ°çŠ¶æ€ç ï¼Œresponse headerç­‰ä¿¡æ¯

ForObject APIæ‹¿åˆ°çš„æ˜¯javaå¯¹è±¡ï¼Œç”¨åœ¨ä¸å…³å¿ƒresponseçŠ¶æ€ç å’Œheaderçš„åœºåˆä¸­
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;363-getxxxpostxxx-å’Œ-exchange-æ–¹æ³•çš„åŒºåˆ«&#34;&gt;3.6.3. getXXXã€postXXX å’Œ exchange æ–¹æ³•çš„åŒºåˆ« &lt;a href=&#34;#363-getxxxpostxxx-%e5%92%8c-exchange-%e6%96%b9%e6%b3%95%e7%9a%84%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;getXXXã€postXXX ç”¨äºæ¯”è¾ƒç®€å•çš„è°ƒç”¨

exchange ç”¨äºæ¯”è¾ƒå¤æ‚çš„è°ƒç”¨
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;4-rest-templateé«˜é˜¶ç”¨æ³•&#34;&gt;4. rest templateé«˜é˜¶ç”¨æ³• &lt;a href=&#34;#4-rest-template%e9%ab%98%e9%98%b6%e7%94%a8%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;41-å¸¦æ³›å‹çš„å“åº”è§£ç &#34;&gt;4.1. å¸¦æ³›å‹çš„å“åº”è§£ç  &lt;a href=&#34;#41-%e5%b8%a6%e6%b3%9b%e5%9e%8b%e7%9a%84%e5%93%8d%e5%ba%94%e8%a7%a3%e7%a0%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    private static final Logger logger = LoggerFactory.getLogger(TestController.class);

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/postBody&amp;#34;)
    public String testPostBody() throws Exception {//æµ‹è¯•ç”¨ä¾‹ï¼šposid=804009
        String url = &amp;#34;https://venus.dz11.com/venus/release/pc/checkUpdate&amp;#34;;
        String jsonBody = &amp;#34;{\n&amp;#34;
                + &amp;#34;    \&amp;#34;channelCode\&amp;#34;: \&amp;#34;official\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;appCode\&amp;#34;: \&amp;#34;Douyu_Live_PC_Client\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;versionCode\&amp;#34;: \&amp;#34;201804121\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;versionName\&amp;#34;: \&amp;#34;V5.1.9\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;deviceUid\&amp;#34;: \&amp;#34;02-15-03-59-5C-E2\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;deviceResolution\&amp;#34;: \&amp;#34;1920*1080\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;token\&amp;#34;: \&amp;#34;token\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;webView\&amp;#34;: \&amp;#34;\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;osInfo\&amp;#34;: \&amp;#34;10.0\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;osType\&amp;#34;: \&amp;#34;64\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;cpuInfo\&amp;#34;:\n&amp;#34;
                + &amp;#34;    {\n&amp;#34;
                + &amp;#34;        \&amp;#34;OemId\&amp;#34;: \&amp;#34;0\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorArchitecture\&amp;#34;: \&amp;#34;0\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;PageSize\&amp;#34;: \&amp;#34;4096\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;MinimumApplicationAddress\&amp;#34;: \&amp;#34;00010000\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;MaximumApplicationAddress\&amp;#34;: \&amp;#34;7FFEFFFF\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ActiveProcessorMask\&amp;#34;: \&amp;#34;15\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;NumberOfProcessors\&amp;#34;: \&amp;#34;4\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorType\&amp;#34;: \&amp;#34;586\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;AllocationGranularity\&amp;#34;: \&amp;#34;65536\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorLevel\&amp;#34;: \&amp;#34;6\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorRevision\&amp;#34;: \&amp;#34;40457\&amp;#34;\n&amp;#34;
                + &amp;#34;    },\n&amp;#34;
                + &amp;#34;    \&amp;#34;diskInfo\&amp;#34;: \&amp;#34;931.507GB\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;memoryInfo\&amp;#34;: \&amp;#34;15.8906GB\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;driveInfo\&amp;#34;: \&amp;#34;Intel(R) HD Graphics 630:23.20.16.4973;\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;startTime\&amp;#34;: \&amp;#34;-501420357\&amp;#34;\n&amp;#34;
                + &amp;#34;}\n&amp;#34;;

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        HttpEntity&amp;lt;String&amp;gt; bodyEntity = new HttpEntity&amp;lt;&amp;gt;(jsonBody, headers);
        
        //1. ç›´æ¥æ‹¿åŸå§‹çš„jsonä¸²
        String json = restTemplate.postForObject(url, bodyEntity, String.class);

        //2. å°†åŸå§‹jsonä¼ è½¬javaå¯¹è±¡ï¼Œè·Ÿä¸Šæ–‡ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªjavaå¯¹è±¡é‡Œé¢æœ‰æ³›å‹ï¼ˆResultVo&amp;lt;PcUpdateRes&amp;gt;ï¼‰
        //å¤§å®¶å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼ŒæŠŠResultVo&amp;lt;PcUpdateRes&amp;gt;æ¢æˆè‡ªå·±çš„ç±»ï¼Œæ¯”å¦‚ï¼šList&amp;lt;MemberInfo&amp;gt;
        ResponseEntity&amp;lt;ResultVo&amp;lt;PcUpdateRes&amp;gt;&amp;gt; response = restTemplate
                .exchange(url, HttpMethod.POST, bodyEntity, new ParameterizedTypeReference&amp;lt;ResultVo&amp;lt;PcUpdateRes&amp;gt;&amp;gt;() {});
        if (response.getStatusCode().is2xxSuccessful() &amp;amp;&amp;amp; response.getBody() != null &amp;amp;&amp;amp; response.getBody().success()) {
            ResultVo&amp;lt;PcUpdateRes data = &amp;gt; resultVo = response.getBody();
            PcUpdateRes data = resultVo.getData();
            logger.info(&amp;#34;å¤„ç†æˆåŠŸï¼Œè¿”å›æ•°æ®: {}&amp;#34;, data);
        } else {
            logger.info(&amp;#34;å¤„ç†å¤±è´¥ï¼Œå“åº”ç»“æœ: {}&amp;#34;, response);
        }

        return json;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;42-ä¸Šä¼ æ–‡ä»¶æµ&#34;&gt;4.2. ä¸Šä¼ æ–‡ä»¶æµ &lt;a href=&#34;#42-%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6%e6%b5%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.codec.CodecUtils;
import com.douyu.wsd.framework.common.io.IOUtils;
import com.douyu.wsd.framework.common.lang.StringUtils;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.core.io.InputStreamResource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/postFile&amp;#34;)
    public String testPostBody() throws Exception {
        String filePath = &amp;#34;D:/config.png&amp;#34;;
        MultipartFileResource resource = new MultipartFileResource(new FileInputStream(new File(filePath)), &amp;#34;config.png&amp;#34;);
        String url = &amp;#34;http://dev.resuploader.dz11.com/Resource/Dss/put&amp;#34;;
        String appId = &amp;#34;***&amp;#34;;//æµ‹è¯•çš„æ—¶å€™æ¢æˆè‡ªå·±çš„é…ç½®
        String secureKey = &amp;#34;***&amp;#34;;
        String time = String.valueOf(System.currentTimeMillis());
        String pubStr = &amp;#34;1&amp;#34;;
        String tempStr = String.format(&amp;#34;app_id=%s&amp;amp;is_public=%s&amp;amp;time=%s&amp;amp;vframe=0%s&amp;#34;, appId, pubStr, time, secureKey);
        MultiValueMap&amp;lt;String, Object&amp;gt; form = new LinkedMultiValueMap&amp;lt;&amp;gt;();
        form.add(&amp;#34;is_public&amp;#34;, pubStr);
        form.add(&amp;#34;vframe&amp;#34;, &amp;#34;0&amp;#34;);
        form.add(&amp;#34;file&amp;#34;, resource);
        form.add(&amp;#34;app_id&amp;#34;, appId);
        form.add(&amp;#34;time&amp;#34;, time);
        form.add(&amp;#34;sign&amp;#34;, CodecUtils.md5(tempStr));

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.MULTIPART_FORM_DATA);
        //headers.add(&amp;#34;xx&amp;#34;, &amp;#34;yy&amp;#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&amp;lt;MultiValueMap&amp;lt;String, Object&amp;gt;&amp;gt; formEntity = new HttpEntity&amp;lt;&amp;gt;(form, headers);
        String json = restTemplate.postForObject(url, formEntity, String.class);
        return json;
    }

    private class MultipartFileResource extends InputStreamResource {

        private String filename;

        public MultipartFileResource(InputStream inputStream, String filename) {
            super(inputStream);
            this.filename = filename;
        }

        @Override
        public String getFilename() {
            return this.filename;
        }

        @Override
        public long contentLength() throws IOException {
            return -1; // we do not want to generally read the whole stream into memory ...
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;43-å¼‚æ­¥æ“ä½œ&#34;&gt;4.3 å¼‚æ­¥æ“ä½œ &lt;a href=&#34;#43-%e5%bc%82%e6%ad%a5%e6%93%8d%e4%bd%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;AsyncRestTemplate å¯æ”¯æŒå¼‚æ­¥ï¼Œä¸åŒæ­¥APIåŸºæœ¬ä¸€è‡´ï¼Œè¿”å›çš„æ˜¯future:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.TimeUnit;
import javax.annotation.Resource;

import org.springframework.http.ResponseEntity;
import org.springframework.util.concurrent.ListenableFuture;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.AsyncRestTemplate;

@RestController
public class TestController {

    @Resource
    private AsyncRestTemplate asyncRestTemplate;

    @RequestMapping(&amp;#34;/douyu&amp;#34;)
    public String douyu() throws Exception {
        ListenableFuture&amp;lt;ResponseEntity&amp;lt;String&amp;gt;&amp;gt; future = asyncRestTemplate
                .getForEntity(&amp;#34;http://www.douyu.com&amp;#34;, String.class);
        return future.get(2 * 1000, TimeUnit.SECONDS).getBody();
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;44-ä¸åŒçš„è¶…æ—¶æ—¶é—´&#34;&gt;4.4. ä¸åŒçš„è¶…æ—¶æ—¶é—´ &lt;a href=&#34;#44-%e4%b8%8d%e5%90%8c%e7%9a%84%e8%b6%85%e6%97%b6%e6%97%b6%e9%97%b4&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;å‡å¦‚æˆ‘ç¢°åˆ°è¿™ç§åœºæ™¯ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ServiceA | 10s

ServiceB | 25s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ‰3ä¸ªå¥—è·¯å¯è§£å†³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¥—è·¯ä¸€ï¼Œåˆ›å»ºå¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹æœ‰è‡ªå·±çš„è¶…æ—¶æ—¶é—´ï¼Œæ¯”å¦‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    // è¶…æ—¶æ—¶é—´çŸ­çš„å®ä¾‹
    @Bean(name = &amp;#34;clientHttpRequestFactoryA&amp;#34;)
    public ClientHttpRequestFactory clientHttpRequestFactoryA() {
        return createClientHttpRequestFactory(2*1000, 10*1000);
    }

    @Bean(name = &amp;#34;restTemplateA&amp;#34;)
    @ConditionalOnMissingBean(RestTemplate.class)
    public RestTemplate restTemplateA() {
        return createRestTemplate(clientHttpRequestFactoryA());
    }
    
    // è¶…æ—¶æ—¶é—´é•¿çš„å®ä¾‹
    @Bean(name = &amp;#34;clientHttpRequestFactoryB&amp;#34;)
    public ClientHttpRequestFactory clientHttpRequestFactoryB() {
        return createClientHttpRequestFactory(5*1000, 25*1000);
    }

    @Bean(name = &amp;#34;restTemplateB&amp;#34;)
    @ConditionalOnMissingBean(RestTemplate.class)
    public RestTemplate restTemplateB() {
        return createRestTemplate(clientHttpRequestFactoryB());
    }
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å¥—è·¯äºŒï¼ŒAsyncRestTemplate&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ListenableFuture&amp;lt;ResponseEntity&amp;lt;String&amp;gt;&amp;gt; future = asyncRestTemplate
                .getForEntity(&amp;#34;http://www.douyu.com&amp;#34;, String.class);
return future.get(2 * 1000, TimeUnit.SECONDS).getBody();
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å¥—è·¯ä¸‰ï¼Œä¸Š&lt;a href=&#34;https://spring.io/guides/gs/circuit-breaker/&#34;&gt; Circuit Breaker&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;@EnableCircuitBreaker
public class MyApp {
    public static void main(String[] args) {
        SpringApplication.run(MyApp .class, args);
    }
}

@Service
public class MyService {
    private final RestTemplate restTemplate;

    public BookService(RestTemplate rest) {
        this.restTemplate = rest;
    }

    @HystrixCommand(
        fallbackMethod = &amp;#34;fooMethodFallback&amp;#34;,
        commandProperties = { 
            @HystrixProperty(
                 name = &amp;#34;execution.isolation.thread.timeoutInMilliseconds&amp;#34;, 
                 value=&amp;#34;5000&amp;#34;
            )
        }
    )
    public String fooMethod() {
        // Your logic here.
        restTemplate.exchange(...); 
    }

    public String fooMethodFallback(Throwable t) {
        log.error(&amp;#34;Fallback happened&amp;#34;, t);
        return &amp;#34;Sensible Default Here!&amp;#34;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;45-å¦‚ä½•è®¾ç½®è¿æ¥æ± &#34;&gt;4.5. å¦‚ä½•è®¾ç½®è¿æ¥æ±  &lt;a href=&#34;#45-%e5%a6%82%e4%bd%95%e8%ae%be%e7%bd%ae%e8%bf%9e%e6%8e%a5%e6%b1%a0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;è¿æ¥æ± éœ€è¦æœåŠ¡ç«¯æ”¯æŒé•¿è¿æ¥ï¼Œå¹¶éæ‰€æœ‰æœåŠ¡ç«¯éƒ½æ”¯æŒï¼Œå› æ­¤å•ç‹¬å¼€äº†ç¯‡æ–‡ç« ï¼š&lt;a href=&#34;http://doc.dz11.com/ddse/preview/space/14816?sid=29&amp;amp;pid=12940&#34;&gt;RestTemplateå¦‚ä½•é…ç½®é•¿è¿æ¥&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;46-å…¨å±€ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†&#34;&gt;4.6. å…¨å±€ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç† &lt;a href=&#34;#46-%e5%85%a8%e5%b1%80%e7%bb%9f%e4%b8%80%e7%9a%84%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//å®ç°å¼‚å¸¸å¤„ç†æ¥å£
public class CustomErrorHandler extends DefaultResponseErrorHandler {  
  
    @Override  
    public void handleError(ClientHttpResponse response) throws IOException {  
  
    }
    
}  

//å°†è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†å™¨åŠ è¿›å»
@Configuration  
public class RestClientConfig {  
  
    @Bean  
    public RestTemplate restTemplate() {  
        RestTemplate restTemplate = new RestTemplate();  
        restTemplate.setErrorHandler(new CustomErrorHandler());  
        return restTemplate;  
    }  
  
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;5-å°æŠ€å·§&#34;&gt;5. å°æŠ€å·§ &lt;a href=&#34;#5-%e5%b0%8f%e6%8a%80%e5%b7%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;51-å‚æ•°æ¨¡æ¿&#34;&gt;5.1. å‚æ•°æ¨¡æ¿ &lt;a href=&#34;#51-%e5%8f%82%e6%95%b0%e6%a8%a1%e6%9d%bf&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ•°ç»„ä¼ å‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;String result = restTemplate.getForObject(&amp;#34;http://example.com/hotels/{hotel}/bookings/{booking}&amp;#34;, 
    String.class, &amp;#34;42&amp;#34;, &amp;#34;21&amp;#34;);
//å®é™…æ•ˆæœç­‰åŒäºï¼šGET http://example.com/hotels/42/bookings/21
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;mapä¼ å‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Map&amp;lt;String, String&amp;gt; vars = new HashMap&amp;lt;String, String&amp;gt;();
vars.put(&amp;#34;hotel&amp;#34;, &amp;#34;42&amp;#34;);
vars.put(&amp;#34;booking&amp;#34;, &amp;#34;21&amp;#34;);
String result = restTemplate.getForObject(&amp;#34;http://example.com/hotels/{hotel}/bookings/{booking}&amp;#34;, 
    String.class, vars);
//å®é™…æ•ˆæœç­‰åŒäºï¼šGET http://example.com/hotels/42/rooms/42
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;52-æ–‡ä»¶ä¸Šä¼ æ³¨æ„ç‚¹&#34;&gt;5.2. æ–‡ä»¶ä¸Šä¼ æ³¨æ„ç‚¹ &lt;a href=&#34;#52-%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e6%b3%a8%e6%84%8f%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨äº†æœ¬åœ°ä¸´æ—¶æ–‡ä»¶ï¼Œä¸€å®šè¦åœ¨finallyä»£ç å—ä¸­åˆ é™¤ï¼Œå¦åˆ™å¯èƒ½ä¼šæ’‘çˆ†ç£ç›˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;6-faq&#34;&gt;6. FAQ &lt;a href=&#34;#6-faq&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;61-è·å–çŠ¶æ€ç &#34;&gt;6.1. è·å–çŠ¶æ€ç  &lt;a href=&#34;#61-%e8%8e%b7%e5%8f%96%e7%8a%b6%e6%80%81%e7%a0%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨xxForEntityç±»æ–¹æ³•è°ƒç”¨æ¥å£ï¼Œå°†è¿”å›ResponseEntityå¯¹è±¡ï¼Œé€šè¿‡å®ƒèƒ½å–åˆ°çŠ¶æ€ç ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//åˆ¤æ–­æ¥å£è¿”å›æ˜¯å¦ä¸º200
public static Boolean ping(){
    String url = &amp;#34;xxx&amp;#34;;
    try{
        ResponseEntity&amp;lt;String&amp;gt; responseEntity = restTemplate.getForEntity(url, String.class);
        HttpStatus status = responseEntity.getStatusCode();//è·å–è¿”å›çŠ¶æ€
        return status.is2xxSuccessful();//åˆ¤æ–­çŠ¶æ€ç æ˜¯å¦ä¸º2å¼€å¤´çš„
    }catch(Exception e){
        log.error(&amp;#34;å¤„ç†å¤±è´¥: {}&amp;#34;, url, e);
        return false; //502 ,500æ˜¯ä¸èƒ½æ­£å¸¸è¿”å›ç»“æœçš„ï¼Œéœ€è¦catchä½ï¼Œè¿”å›ä¸€ä¸ªfalse
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;62-æˆ‘éœ€è¦æ‰‹å·¥é‡Šæ”¾è¿æ¥å—&#34;&gt;6.2. æˆ‘éœ€è¦æ‰‹å·¥é‡Šæ”¾è¿æ¥å—ï¼Ÿ &lt;a href=&#34;#62-%e6%88%91%e9%9c%80%e8%a6%81%e6%89%8b%e5%b7%a5%e9%87%8a%e6%94%be%e8%bf%9e%e6%8e%a5%e5%90%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ä¸éœ€è¦ï¼Œrest templateä¼šå¸®æˆ‘ä»¬é‡Šæ”¾ï¼Œå…·ä½“è¯·çœ‹ï¼š&lt;a href=&#34;https://stackoverflow.com/questions/40161117/spring-resttemplate-need-to-release-connection&#34;&gt;spring-resttemplate-need-to-release-connection ?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;62-å¦‚ä½•è°ƒè¯•rest-template&#34;&gt;6.2. å¦‚ä½•è°ƒè¯•rest template &lt;a href=&#34;#62-%e5%a6%82%e4%bd%95%e8%b0%83%e8%af%95rest-template&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;å¯ä»¥åœ¨logbacké‡Œå•ç‹¬é…ä¸€ä¸ªdebugçº§åˆ«çš„loggerï¼ŒæŠŠorg.apache.httpä¸‹é¢çš„æ—¥å¿—å®šå‘åˆ°æ§åˆ¶å°ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;logger name=&amp;#34;org.apache.http&amp;#34; level=&amp;#34;DEBUG&amp;#34; additivity=&amp;#34;false&amp;#34;&amp;gt;
    &amp;lt;appender-ref ref=&amp;#34;STDOUT&amp;#34; /&amp;gt;
&amp;lt;/logger&amp;gt;
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>JAVAä»£ç ç”Ÿæˆ</title>
      <link>https://abnerxc.github.io/note/java-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/java-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90/</guid>
      <description>&lt;h1 id=&#34;ä¾èµ–åŒ…ç‰ˆæœ¬&#34;&gt;ä¾èµ–åŒ…ç‰ˆæœ¬ &lt;a href=&#34;#%e4%be%9d%e8%b5%96%e5%8c%85%e7%89%88%e6%9c%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;com.baomidou&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;mybatis-plus-generator&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;3.5.3.1&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.freemarker&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;freemarker&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.3.32&amp;lt;/version&amp;gt; &amp;lt;!-- or latest version --&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;javaä»£ç ç”Ÿæˆ&#34;&gt;Javaä»£ç ç”Ÿæˆ &lt;a href=&#34;#java%e4%bb%a3%e7%a0%81%e7%94%9f%e6%88%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;import com.baomidou.mybatisplus.generator.FastAutoGenerator;
import com.baomidou.mybatisplus.generator.config.OutputFile;
import com.baomidou.mybatisplus.generator.config.rules.DbColumnType;
import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;
import com.baomidou.mybatisplus.generator.config.builder.CustomFile;
import java.sql.Types;
import java.util.*;

public class CodeGeneratorTest {
    public static void main(String[] args) {
        // æ•°æ®åº“é…ç½®
        String url = &amp;#34;jdbc:mysql://127.0.01:3306/test?useUnicode=true&amp;amp;characterEncoding=UTF8&amp;amp;useSSL=false&amp;amp;serverTimezone=Asia/Shanghai&amp;#34;;
        String username = &amp;#34;root&amp;#34;;
        String password = &amp;#34;123456&amp;#34;;

        // è¡¨åé…ç½®
        String[] tableName = {&amp;#34;sys_subject&amp;#34;};
        String[] tablePreFix = {&amp;#34;sys_&amp;#34;, &amp;#34;tpl_&amp;#34;};

        // é¡¹ç›®é…ç½®
        String projectName = &amp;#34;com-server-demo-provider&amp;#34;;
        String basePkg = &amp;#34;com.server.demo.provider&amp;#34;;
        String moduleName = &amp;#34;subject&amp;#34;;
        String author = &amp;#34;abner&amp;#34;;

        String rootPath = System.getProperty(&amp;#34;user.dir&amp;#34;);
        String mainPath = rootPath + &amp;#34;/&amp;#34; + projectName + &amp;#34;/src/main&amp;#34;;

         FastAutoGenerator.create(url, username, password)
                .globalConfig(builder -&amp;gt; {
                    builder.author(author)
                            .fileOverride()
                            .outputDir(mainPath + &amp;#34;/java&amp;#34;);
                })
                .dataSourceConfig(builder -&amp;gt; builder.typeConvertHandler((globalConfig, typeRegistry, metaInfo) -&amp;gt; {
                    int typeCode = metaInfo.getJdbcType().TYPE_CODE;
                    if (typeCode == Types.SMALLINT || typeCode == Types.TINYINT) {  // æ·»åŠ  TINYINT ç±»å‹å¤„ç†
                        return DbColumnType.INTEGER;
                    }
                    return typeRegistry.getColumnType(metaInfo);
                }))
                .packageConfig(builder -&amp;gt; {
                    builder.parent(basePkg)
                            .moduleName(moduleName)
                            .entity(&amp;#34;model.entity&amp;#34;)  // å®ä½“ç±»æ”¾åœ¨modelåŒ…ä¸‹
                            .pathInfo(Collections.singletonMap(OutputFile.xml, mainPath + &amp;#34;/mapper/&amp;#34; + moduleName));
                })
                .strategyConfig(builder -&amp;gt; {
                    builder.addInclude(tableName)
                            .addTablePrefix(tablePreFix);

                    // å®ä½“ç±»é…ç½®
                    builder.entityBuilder()
                            //.superClass(BaseEntity.class)
                            .enableChainModel()
                            .enableLombok()
                            .disableSerialVersionUID()
                            .enableTableFieldAnnotation()
                            // å­—æ®µè¿‡æ»¤é…ç½®ï¼ˆæ’é™¤BaseEntity.classçˆ¶ç±»ä¸­å·²ç»ç»§æ‰¿çš„å­—æ®µï¼Œé˜²æ­¢é‡å¤ç”Ÿæˆè¦†ç›–ï¼‰
                            //.addSuperEntityColumns(&amp;#34;id&amp;#34;, &amp;#34;create_by&amp;#34;, &amp;#34;create_name&amp;#34;,
                                    &amp;#34;create_time&amp;#34;, &amp;#34;modify_by&amp;#34;, &amp;#34;modify_name&amp;#34;,
                                    &amp;#34;modify_time&amp;#34;);

                    // æ–°å¢Controlleré…ç½®
                    builder.controllerBuilder()
                            .enableRestStyle()  // ä½¿ç”¨@RestControlleræ³¨è§£
                            .enableHyphenStyle() // å¯ç”¨é©¼å³°è½¬è¿å­—ç¬¦
                            .formatFileName(&amp;#34;%sController&amp;#34;);

                    // Mapperé…ç½®
                    builder.mapperBuilder()
                            .superClass(BaseMapperX.class)
                            .enableBaseColumnList()
                            .enableMapperAnnotation();

                    // Serviceé…ç½®
                    builder.serviceBuilder()
                            .formatServiceFileName(&amp;#34;%sService&amp;#34;);
                })
                .injectionConfig(builder -&amp;gt; {
                    Map&amp;lt;String, Object&amp;gt; customMap = new HashMap&amp;lt;&amp;gt;();
                    // æ·»åŠ çˆ¶åŒ…è·¯å¾„å˜é‡
                    customMap.put(&amp;#34;packageName&amp;#34;, basePkg + &amp;#34;.&amp;#34; + moduleName);
                    customMap.put(&amp;#34;dtoPackage&amp;#34;, &amp;#34;model.dto&amp;#34;);
                    customMap.put(&amp;#34;voPackage&amp;#34;, &amp;#34;model.vo&amp;#34;);
                    customMap.put(&amp;#34;convertPackage&amp;#34;, &amp;#34;model.convert&amp;#34;);

                    builder.customMap(customMap)
                            // DTOæ¨¡æ¿
                            .customFile(new CustomFile.Builder()
                                    .fileName(&amp;#34;Dto.java&amp;#34;)
                                    .templatePath(&amp;#34;/templates/dto.java.ftl&amp;#34;)
                                    .packageName(&amp;#34;model.dto&amp;#34;)
                                    .build())
                            // VOæ¨¡æ¿
                            .customFile(new CustomFile.Builder()
                                    .fileName(&amp;#34;Vo.java&amp;#34;)
                                    .templatePath(&amp;#34;/templates/vo.java.ftl&amp;#34;)
                                    .packageName(&amp;#34;model.vo&amp;#34;)
                                    .build())
                            // Convertæ¨¡æ¿
                            .customFile(new CustomFile.Builder()
                                    .fileName(&amp;#34;Convert.java&amp;#34;)
                                    .templatePath(&amp;#34;/templates/convert.java.ftl&amp;#34;)
                                    .packageName(&amp;#34;model.convert&amp;#34;)
                                    .build());
                })
                .templateEngine(new FreemarkerTemplateEngine())
                .execute();
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;freemarkeræ¨¡æ¿&#34;&gt;Freemarkeræ¨¡æ¿ &lt;a href=&#34;#freemarker%e6%a8%a1%e6%9d%bf&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;convert.java.ftl&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;package ${packageName}.${convertPackage};

import ${package.Entity}.${entity};
import ${package.Entity?replace(&amp;#34;entity&amp;#34;,&amp;#34;dto&amp;#34;)}.${entity}Dto;
import ${package.Entity?replace(&amp;#34;entity&amp;#34;,&amp;#34;vo&amp;#34;)}.${entity}Vo;
import org.mapstruct.Mapper;
import org.mapstruct.factory.Mappers;
import java.util.List;

@Mapper(componentModel = &amp;#34;spring&amp;#34;)
public interface ${entity}Convert {

${entity}Convert INSTANCE = Mappers.getMapper(${entity}Convert.class);

${entity}Dto entityToDto(${entity} entity);

${entity} dtoToEntity(${entity}Dto dto);

${entity} voToEntity(${entity}Vo vo);

List&amp;lt;${entity}Dto&amp;gt; entityListToDto(List&amp;lt;${entity}&amp;gt; entities);
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;dto.java.ftl&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;package ${packageName}.${dtoPackage};

    import lombok.Data;
    import lombok.experimental.Accessors;

    @Data
    @Accessors(chain = true)
    public class ${table.entityName}Dto {

    }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;vo.java.ftl&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;package ${packageName}.${voPackage};

    import lombok.Data;
    import lombok.experimental.Accessors;

    @Data
    @Accessors(chain = true)
    public class ${table.entityName}Vo {

    }
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>mysqlæ€»ç»“</title>
      <link>https://abnerxc.github.io/note/mysql-%E6%80%BB%E7%BB%93/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/mysql-%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;h1 id=&#34;å®è§‚äº†è§£&#34;&gt;å®è§‚äº†è§£ &lt;a href=&#34;#%e5%ae%8f%e8%a7%82%e4%ba%86%e8%a7%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-a.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;æŸ¥è¯¢ç¼“å­˜&#34;&gt;æŸ¥è¯¢ç¼“å­˜ &lt;a href=&#34;#%e6%9f%a5%e8%af%a2%e7%bc%93%e5%ad%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æˆ‘ä»¬å…ˆé€šè¿‡&lt;code&gt;show variables like &#39;%query_cache%&#39;&lt;/code&gt;æ¥çœ‹ä¸€ä¸‹é»˜è®¤çš„æ•°æ®åº“é…ç½®ï¼Œ&lt;code&gt;query_cache_type=ON&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†ï¼šMYSQLçš„æŸ¥è¯¢ç¼“å­˜å®è´¨ä¸Šæ˜¯ç¼“å­˜SQLçš„hashå€¼å’Œè¯¥SQLçš„æŸ¥è¯¢ç»“æœï¼Œå¦‚æœè¿è¡Œç›¸åŒçš„SQL,æœåŠ¡å™¨ç›´æ¥ä»ç¼“å­˜ä¸­å»æ‰ç»“æœï¼Œè€Œä¸å†å»è§£æï¼Œä¼˜åŒ–ï¼Œå¯»æ‰¾æœ€ä½æˆæœ¬çš„æ‰§è¡Œè®¡åˆ’ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œå¤§å¤§æå‡äº†æŸ¥è¯¢é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;å¼Šç«¯ï¼šæ‰§è¡Œçš„SQLè¯­å¥å¿…é¡»ä¸€æ ·ï¼ˆå¤§å°å†™ï¼Œé—´éš”ç­‰ï¼‰ï¼Œå¦‚æœä¸ä¸€æ ·å°†ä¼šäº§ç”Ÿä¸åŒçš„hashå€¼&lt;/li&gt;
&lt;li&gt;åœºæ™¯ï¼šé€šè¿‡è§‚å¯Ÿäº‘å‚å•†ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯å…³é—­æŸ¥è¯¢ç¼“å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¼•æ“&#34;&gt;å¼•æ“ &lt;a href=&#34;#%e5%bc%95%e6%93%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;myisamå­˜å‚¨å¼•æ“&#34;&gt;MyISAMå­˜å‚¨å¼•æ“ &lt;a href=&#34;#myisam%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;MyISAMåŸºäºISAMå­˜å‚¨å¼•æ“ï¼Œå¹¶å¯¹å…¶è¿›è¡Œæ‰©å±•ã€‚ä½¿ç”¨MyISAMå¼•æ“åˆ›å»ºæ•°æ®åº“ï¼Œå°†äº§ç”Ÿ3ä¸ªæ–‡ä»¶,æ–‡ä»¶çš„åå­—ä»¥è¡¨åå­—å¼€å§‹ï¼Œ&lt;code&gt;æ‰©å±•åä¹‹å¤„æ–‡ä»¶ç±»å‹ï¼šfrmæ–‡ä»¶å­˜å‚¨è¡¨å®šä¹‰ã€æ•°æ®æ–‡ä»¶çš„æ‰©å±•åä¸º.MYDï¼ˆMYDataï¼‰ã€ç´¢å¼•æ–‡ä»¶çš„æ‰©å±•åæ—¶.MYIï¼ˆMYIndexï¼‰&lt;/code&gt;ã€‚MyISAMæ‹¥æœ‰è¾ƒé«˜çš„æ’å…¥ã€æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†&lt;code&gt;ä¸æ”¯æŒäº‹ç‰©&lt;/code&gt;ã€‚MyISAMä¸»è¦ç‰¹æ€§æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤§æ–‡ä»¶ï¼ˆè¾¾åˆ°63ä½æ–‡ä»¶é•¿åº¦ï¼‰åœ¨æ”¯æŒå¤§æ–‡ä»¶çš„æ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿä¸Šè¢«æ”¯æŒ&lt;/li&gt;
&lt;li&gt;å½“æŠŠåˆ é™¤å’Œæ›´æ–°åŠæ’å…¥æ“ä½œæ··åˆä½¿ç”¨çš„æ—¶å€™ï¼ŒåŠ¨æ€å°ºå¯¸çš„è¡Œäº§ç”Ÿæ›´å°‘ç¢ç‰‡ã€‚è¿™è¦é€šè¿‡åˆå¹¶ç›¸é‚»è¢«åˆ é™¤çš„å—ï¼Œä»¥åŠè‹¥ä¸‹ä¸€ä¸ªå—è¢«åˆ é™¤ï¼Œå°±æ‰©å±•åˆ°ä¸‹ä¸€å—è‡ªåŠ¨å®Œæˆ&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªMyISAMè¡¨æœ€å¤§ç´¢å¼•æ•°æ˜¯64ï¼Œè¿™å¯ä»¥é€šè¿‡é‡æ–°ç¼–è¯‘æ¥æ”¹å˜ã€‚æ¯ä¸ªç´¢å¼•æœ€å¤§çš„åˆ—æ•°æ˜¯16&lt;/li&gt;
&lt;li&gt;æœ€å¤§çš„é”®é•¿åº¦æ˜¯1000å­—èŠ‚ï¼Œè¿™ä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¯‘æ¥æ”¹å˜ï¼Œå¯¹äºé”®é•¿åº¦è¶…è¿‡250å­—èŠ‚çš„æƒ…å†µï¼Œä¸€ä¸ªè¶…è¿‡1024å­—èŠ‚çš„é”®å°†è¢«ç”¨ä¸Š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BLOBå’ŒTEXTåˆ—å¯ä»¥è¢«ç´¢å¼•&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;NULLè¢«å…è®¸åœ¨ç´¢å¼•çš„åˆ—ä¸­ï¼Œè¿™ä¸ªå€¼å æ¯ä¸ªé”®çš„0~1ä¸ªå­—èŠ‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰æ•°å­—é”®å€¼ä»¥é«˜å­—èŠ‚ä¼˜å…ˆè¢«å­˜å‚¨ä»¥å…è®¸ä¸€ä¸ªæ›´é«˜çš„ç´¢å¼•å‹ç¼©&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¯ä¸ªMyISAMç±»å‹çš„è¡¨éƒ½æœ‰ä¸€ä¸ªAUTO_INCREMENTçš„å†…éƒ¨åˆ—ï¼Œå½“INSERTå’ŒUPDATEæ“ä½œçš„æ—¶å€™è¯¥åˆ—è¢«æ›´æ–°ï¼ŒåŒæ—¶AUTO_INCREMENTåˆ—å°†è¢«åˆ·æ–°ã€‚æ‰€ä»¥è¯´ï¼ŒMyISAMç±»å‹è¡¨çš„AUTO_INCREMENTåˆ—æ›´æ–°æ¯”InnoDBç±»å‹çš„AUTO_INCREMENTæ›´å¿«&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¯ä»¥æŠŠæ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶æ”¾åœ¨ä¸åŒç›®å½•&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå­—ç¬¦åˆ—å¯ä»¥æœ‰ä¸åŒçš„å­—ç¬¦é›†&lt;/li&gt;
&lt;li&gt;æœ‰VARCHARçš„è¡¨å¯ä»¥å›ºå®šæˆ–åŠ¨æ€è®°å½•é•¿åº¦&lt;/li&gt;
&lt;li&gt;VARCHARå’ŒCHARåˆ—å¯ä»¥å¤šè¾¾64KB&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;innodbå­˜å‚¨å¼•æ“&#34;&gt;InnoDBå­˜å‚¨å¼•æ“ &lt;a href=&#34;#innodb%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;InnoDBä¸åˆ›å»ºç›®å½•ï¼Œä½¿ç”¨InnoDBæ—¶ï¼ŒMySQLå°†åœ¨MySQLæ•°æ®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºibdata1çš„10MBå¤§å°çš„è‡ªåŠ¨æ‰©å±•æ•°æ®æ–‡ä»¶ï¼Œä»¥åŠä¸¤ä¸ªåä¸ºib_logfile0å’Œib_logfile1çš„5MBå¤§å°çš„æ—¥å¿—æ–‡ä»¶
InnoDBæ˜¯äº‹åŠ¡å‹æ•°æ®åº“çš„é¦–é€‰å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡å®‰å…¨è¡¨ï¼ˆACIDï¼‰ï¼Œæ”¯æŒè¡Œé”å®šå’Œå¤–é”®ï¼ŒInnoDBæ˜¯é»˜è®¤çš„MySQLå¼•æ“ã€‚InnoDBä¸»è¦ç‰¹æ€§æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;InnoDBç»™MySQLæä¾›äº†å…·æœ‰æäº¤ã€å›æ»šå’Œå´©æºƒæ¢å¤èƒ½åŠ›çš„äº‹ç‰©å®‰å…¨ï¼ˆACIDå…¼å®¹ï¼‰å­˜å‚¨å¼•æ“ã€‚InnoDBé”å®šåœ¨è¡Œçº§å¹¶ä¸”ä¹Ÿåœ¨SELECTè¯­å¥ä¸­æä¾›ä¸€ä¸ªç±»ä¼¼Oracleçš„éé”å®šè¯»ã€‚è¿™äº›åŠŸèƒ½å¢åŠ äº†å¤šç”¨æˆ·éƒ¨ç½²å’Œæ€§èƒ½ã€‚åœ¨SQLæŸ¥è¯¢ä¸­ï¼Œå¯ä»¥è‡ªç”±åœ°å°†InnoDBç±»å‹çš„è¡¨å’Œå…¶ä»–MySQLçš„è¡¨ç±»å‹æ··åˆèµ·æ¥ï¼Œç”šè‡³åœ¨åŒä¸€ä¸ªæŸ¥è¯¢ä¸­ä¹Ÿå¯ä»¥æ··åˆ&lt;/li&gt;
&lt;li&gt;InnoDBæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ã€‚å®ƒçš„CPUæ•ˆç‡å¯èƒ½æ˜¯ä»»ä½•å…¶ä»–åŸºäºç£ç›˜çš„å…³ç³»å‹æ•°æ®åº“å¼•æ“é”ä¸èƒ½åŒ¹æ•Œçš„&lt;/li&gt;
&lt;li&gt;InnoDBå­˜å‚¨å¼•æ“å®Œå…¨ä¸MySQLæœåŠ¡å™¨æ•´åˆï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¸ºåœ¨ä¸»å†…å­˜ä¸­ç¼“å­˜æ•°æ®å’Œç´¢å¼•è€Œç»´æŒå®ƒè‡ªå·±çš„ç¼“å†²æ± ã€‚InnoDBå°†å®ƒçš„è¡¨å’Œç´¢å¼•åœ¨ä¸€ä¸ªé€»è¾‘è¡¨ç©ºé—´ä¸­ï¼Œè¡¨ç©ºé—´å¯ä»¥åŒ…å«æ•°ä¸ªæ–‡ä»¶ï¼ˆæˆ–åŸå§‹ç£ç›˜æ–‡ä»¶ï¼‰ã€‚è¿™ä¸MyISAMè¡¨ä¸åŒï¼Œæ¯”å¦‚åœ¨MyISAMè¡¨ä¸­æ¯ä¸ªè¡¨è¢«å­˜æ”¾åœ¨åˆ†ç¦»çš„æ–‡ä»¶ä¸­ã€‚InnoDBè¡¨å¯ä»¥æ˜¯ä»»ä½•å°ºå¯¸ï¼Œå³ä½¿åœ¨æ–‡ä»¶å°ºå¯¸è¢«é™åˆ¶ä¸º2GBçš„æ“ä½œç³»ç»Ÿä¸Š&lt;/li&gt;
&lt;li&gt;InnoDBæ”¯æŒå¤–é”®å®Œæ•´æ€§çº¦æŸï¼Œå­˜å‚¨è¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œæ¯å¼ è¡¨çš„å­˜å‚¨éƒ½æŒ‰ä¸»é”®é¡ºåºå­˜æ”¾ï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºåœ¨è¡¨å®šä¹‰æ—¶æŒ‡å®šä¸»é”®ï¼ŒInnoDBä¼šä¸ºæ¯ä¸€è¡Œç”Ÿæˆä¸€ä¸ª6å­—èŠ‚çš„ROWIDï¼Œå¹¶ä»¥æ­¤ä½œä¸ºä¸»é”®&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;mysqlä¸­myisamä¸innodbçš„åŒºåˆ«&#34;&gt;MySQLä¸­myisamä¸innodbçš„åŒºåˆ« &lt;a href=&#34;#mysql%e4%b8%admyisam%e4%b8%8einnodb%e7%9a%84%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;InnoDBæ”¯æŒäº‹ç‰©ï¼Œè€ŒMyISAMä¸æ”¯æŒäº‹ç‰©&lt;/li&gt;
&lt;li&gt;InnoDBæ”¯æŒè¡Œçº§é”ï¼Œè€ŒMyISAMæ”¯æŒè¡¨çº§é”&lt;/li&gt;
&lt;li&gt;InnoDBæ”¯æŒMVCC, è€ŒMyISAMä¸æ”¯æŒ&lt;/li&gt;
&lt;li&gt;InnoDBæ”¯æŒå¤–é”®ï¼Œè€ŒMyISAMä¸æ”¯æŒ&lt;/li&gt;
&lt;li&gt;InnoDBä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œè€ŒMyISAMæ”¯æŒï¼ˆ5.6ç‰ˆæœ¬å·²ç»æ”¯æŒäº†ï¼‰&lt;/li&gt;
&lt;li&gt;MYSQLå¼•æ“çš„æ–‡ä»¶åŒ…å«ï¼ˆ.frm-è¡¨ç»“æ„æ–‡ä»¶ã€.myd-è¡¨æ•°æ®æ–‡ä»¶ï¼Œ.myi-è¡¨ç´¢å¼•æ–‡ä»¶ï¼‰&lt;/li&gt;
&lt;li&gt;InnoDBå¼•æ“åŒ…å«æ–‡ä»¶ï¼ˆ*.frm-è¡¨ç»“æ„æ–‡ä»¶ï¼Œibd-æ•°æ®å’Œç´¢å¼•æ–‡ä»¶ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç´¢å¼•&#34;&gt;ç´¢å¼• &lt;a href=&#34;#%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;èšé›†ç´¢å¼•&#34;&gt;èšé›†ç´¢å¼• &lt;a href=&#34;#%e8%81%9a%e9%9b%86%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;InnoDBçš„ä¸»é”®ç´¢å¼•ä¸è¡Œè®°å½•æ˜¯å­˜å‚¨åœ¨ä¸€èµ·çš„ï¼Œæ•…å«åšèšé›†ç´¢å¼•ï¼ˆClustered Indexï¼‰ï¼š&lt;/p&gt;
&lt;h2 id=&#34;éèšé›†ç´¢å¼•&#34;&gt;éèšé›†ç´¢å¼• &lt;a href=&#34;#%e9%9d%9e%e8%81%9a%e9%9b%86%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;MyISAMçš„ç´¢å¼•ä¸è¡Œè®°å½•æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå«åšéèšé›†ç´¢å¼•ï¼ˆUnClustered Indexï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è”åˆç´¢å¼•&#34;&gt;è”åˆç´¢å¼• &lt;a href=&#34;#%e8%81%94%e5%90%88%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å¤šä¸ªå­—æ®µä¸Šå»ºç«‹çš„ç´¢å¼•ï¼Œèƒ½å¤ŸåŠ é€Ÿå¤æ ¸æŸ¥è¯¢æ¡ä»¶çš„æ£€ç´¢ã€‚æ‰€ä»¥è¯¥ç´¢å¼•ä¹Ÿæœ‰æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œ5.6ç‰ˆæœ¬å»¶ä¼¸å‡ºæ¥çš„&lt;code&gt;ç´¢å¼•ä¸‹æ¨&lt;/code&gt;è§ä¸‹æ–‡&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªè¯´æ˜ï¼Œä¸å¦¨è®¾æœ‰è¡¨ï¼š&lt;code&gt;t(id PK, name KEY, sex, flag);&lt;/code&gt; ç”»å¤–éŸ³ï¼šidæ˜¯èšé›†ç´¢å¼•ï¼Œnameæ˜¯æ™®é€šç´¢å¼•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;mysqlçš„ç´¢å¼•æ–¹æ³•btreeå’Œhashçš„åŒºåˆ«&#34;&gt;mysqlçš„ç´¢å¼•æ–¹æ³•btreeå’Œhashçš„åŒºåˆ« &lt;a href=&#34;#mysql%e7%9a%84%e7%b4%a2%e5%bc%95%e6%96%b9%e6%b3%95btree%e5%92%8chash%e7%9a%84%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;hash
&lt;ol&gt;
&lt;li&gt;memoryå¼•æ“æ‰æ˜¾ç¤ºçš„æ”¯æŒHashç´¢å¼•ï¼ŒinnoDbé»˜è®¤æ˜¯B+æ ‘&lt;/li&gt;
&lt;li&gt;Hash ç´¢å¼•ä»…ä»…èƒ½æ»¡è¶³&amp;quot;=&amp;quot;,&amp;ldquo;IN&amp;quot;å’Œ&amp;rdquo;&amp;lt;= &amp;amp; &amp;gt;=&amp;ldquo;æŸ¥è¯¢ï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;Hash ç´¢å¼•æ— æ³•è¢«ç”¨æ¥é¿å…æ•°æ®çš„æ’åºæ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;Hash ç´¢å¼•ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•é”®æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;Hash ç´¢å¼•åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸èƒ½é¿å…è¡¨æ‰«æã€‚&lt;/li&gt;
&lt;li&gt;Hash ç´¢å¼•é‡åˆ°å¤§é‡Hashå€¼ç›¸ç­‰çš„æƒ…å†µåæ€§èƒ½å¹¶ä¸ä¸€å®šå°±ä¼šæ¯”B-Treeç´¢å¼•é«˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;btree
ä¸hashçš„ç¼ºç‚¹å°±æ˜¯btreeçš„ç‰¹ç‚¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å“ˆå¸Œhashæ¯”æ ‘treeæ›´å¿«ç´¢å¼•ç»“æ„ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆæ ‘å‹&#34;&gt;å“ˆå¸Œ(hash)æ¯”æ ‘(tree)æ›´å¿«ï¼Œç´¢å¼•ç»“æ„ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆæ ‘å‹ï¼Ÿ &lt;a href=&#34;#%e5%93%88%e5%b8%8chash%e6%af%94%e6%a0%91tree%e6%9b%b4%e5%bf%ab%e7%b4%a2%e5%bc%95%e7%bb%93%e6%9e%84%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e8%ae%be%e8%ae%a1%e6%88%90%e6%a0%91%e5%9e%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åŠ é€ŸæŸ¥æ‰¾é€Ÿåº¦çš„æ•°æ®ç»“æ„ï¼Œå¸¸è§çš„æœ‰ä¸¤ç±»ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å“ˆå¸Œï¼Œä¾‹å¦‚HashMapï¼ŒæŸ¥è¯¢/æ’å…¥/ä¿®æ”¹/åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼›&lt;/li&gt;
&lt;li&gt;æ ‘ï¼Œä¾‹å¦‚å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ŒæŸ¥è¯¢/æ’å…¥/ä¿®æ”¹/åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(lg(n))ï¼›&lt;br&gt;
&lt;strong&gt;å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æ˜¯è¯»è¯·æ±‚ï¼Œè¿˜æ˜¯å†™è¯·æ±‚ï¼Œå“ˆå¸Œç±»å‹çš„ç´¢å¼•ï¼Œéƒ½è¦æ¯”æ ‘å‹çš„ç´¢å¼•æ›´å¿«ä¸€äº›ï¼Œé‚£ä¸ºä»€ä¹ˆï¼Œç´¢å¼•ç»“æ„è¦è®¾è®¡æˆæ ‘å‹å‘¢ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç´¢å¼•è®¾è®¡æˆæ ‘å½¢ï¼Œå’ŒSQLçš„éœ€æ±‚ç›¸å…³ã€‚
å¯¹äºè¿™æ ·ä¸€ä¸ªå•è¡ŒæŸ¥è¯¢çš„SQLéœ€æ±‚ï¼š&lt;code&gt;select * from t where name=â€shenjianâ€;&lt;/code&gt;ç¡®å®æ˜¯å“ˆå¸Œç´¢å¼•æ›´å¿«ï¼Œå› ä¸ºæ¯æ¬¡éƒ½åªæŸ¥è¯¢ä¸€æ¡è®°å½•ã€‚&lt;br&gt;
&lt;strong&gt;ç”»å¤–éŸ³ï¼šæ‰€ä»¥ï¼Œå¦‚æœä¸šåŠ¡éœ€æ±‚éƒ½æ˜¯å•è¡Œè®¿é—®ï¼Œä¾‹å¦‚passportï¼Œç¡®å®å¯ä»¥ä½¿ç”¨å“ˆå¸Œç´¢å¼•&lt;/strong&gt;
ä½†æ˜¯å¯¹äºæ’åºæŸ¥è¯¢çš„SQLéœ€æ±‚&lt;code&gt;åˆ†ç»„ï¼šgroup by   æ’åºï¼šorder by   æ¯”è¾ƒï¼š&amp;lt;ã€&amp;gt;  &lt;/code&gt;å“ˆå¸Œå‹çš„ç´¢å¼•ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šé€€åŒ–ä¸ºO(n)ï¼Œè€Œæ ‘å‹çš„â€œæœ‰åºâ€ç‰¹æ€§ï¼Œä¾ç„¶èƒ½å¤Ÿä¿æŒO(log(n)) çš„é«˜æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ•°æ®åº“ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨bæ ‘&#34;&gt;æ•°æ®åº“ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘ï¼Ÿ &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%ba%93%e7%b4%a2%e5%bc%95%e4%b8%ba%e4%bb%80%e4%b9%88%e4%bd%bf%e7%94%a8b%e6%a0%91&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#B+%E6%A0%91&#34;&gt;B+æ ‘äº†è§£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;äºŒå‰æœç´¢æ ‘
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-b.jpeg&#34; alt=&#34;&#34;&gt;
äºŒå‰æœç´¢æ ‘ï¼Œå¦‚ä¸Šå›¾ï¼Œæ˜¯æœ€ä¸ºå¤§å®¶æ‰€ç†ŸçŸ¥çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°±ä¸å±•å¼€ä»‹ç»äº†ï¼Œå®ƒä¸ºä»€ä¹ˆä¸é€‚åˆç”¨ä½œæ•°æ®åº“ç´¢å¼•ï¼Ÿ&lt;br&gt;
(1)å½“æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œæ ‘çš„é«˜åº¦ä¼šæ¯”è¾ƒé«˜ï¼Œæ•°æ®é‡å¤§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢ä¼šæ¯”è¾ƒæ…¢ï¼›&lt;br&gt;
(2)æ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨ä¸€ä¸ªè®°å½•ï¼Œå¯èƒ½å¯¼è‡´ä¸€æ¬¡æŸ¥è¯¢æœ‰å¾ˆå¤šæ¬¡ç£ç›˜IOï¼›&lt;/li&gt;
&lt;li&gt;Bæ ‘
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-c.jpeg&#34; alt=&#34;&#34;&gt;
Bæ ‘ï¼Œå¦‚ä¸Šå›¾ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š&lt;br&gt;
(1)ä¸å†æ˜¯äºŒå‰æœç´¢ï¼Œè€Œæ˜¯må‰æœç´¢ï¼›&lt;br&gt;
(2)å¶å­èŠ‚ç‚¹ï¼Œéå¶å­èŠ‚ç‚¹ï¼Œéƒ½å­˜å‚¨æ•°æ®ï¼›&lt;br&gt;
(3)ä¸­åºéå†ï¼Œå¯ä»¥è·å¾—æ‰€æœ‰èŠ‚ç‚¹ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ ‘è¢«ä½œä¸ºå®ç°ç´¢å¼•çš„æ•°æ®ç»“æ„è¢«åˆ›é€ å‡ºæ¥ï¼Œæ˜¯å› ä¸ºå®ƒèƒ½å¤Ÿå®Œç¾çš„åˆ©ç”¨â€œå±€éƒ¨æ€§åŸç†â€ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢&#34;&gt;ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e5%9b%9e%e8%a1%a8%e6%9f%a5%e8%af%a2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;InnoDBèšé›†ç´¢å¼•å’Œæ™®é€šç´¢å¼•æœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ
InnoDBèšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨è¡Œè®°å½•ï¼Œå› æ­¤ï¼Œ InnoDBå¿…é¡»è¦æœ‰ï¼Œä¸”åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœè¡¨å®šä¹‰äº†PKï¼Œåˆ™PKå°±æ˜¯èšé›†ç´¢å¼•ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœè¡¨æ²¡æœ‰å®šä¹‰PKï¼Œåˆ™ç¬¬ä¸€ä¸ªnot NULL uniqueåˆ—æ˜¯èšé›†ç´¢å¼•ï¼›&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼ŒInnoDBä¼šåˆ›å»ºä¸€ä¸ªéšè—çš„row-idä½œä¸ºèšé›†ç´¢å¼•ï¼›
&lt;em&gt;&lt;strong&gt;æ‰€ä»¥PKæŸ¥è¯¢éå¸¸å¿«ï¼Œç›´æ¥å®šä½è¡Œè®°å½•ã€‚&lt;/strong&gt;&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;InnoDBæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å€¼ã€‚
&lt;em&gt;&lt;strong&gt;æ³¨æ„ï¼Œä¸æ˜¯å­˜å‚¨è¡Œè®°å½•å¤´æŒ‡é’ˆï¼ŒMyISAMçš„ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨è®°å½•æŒ‡é’ˆã€‚&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å›è¡¨æŸ¥è¯¢è¿‡ç¨‹
ä¸¾ä¸ªæ —å­ï¼Œä¸å¦¨è®¾æœ‰è¡¨ï¼št(id PK, name KEY, sex, flag);
è¡¨ä¸­æœ‰å››æ¡è®°å½•ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1, shenjian, m, A
3, zhangsan, m, A
5, lisi, m, A
9, wangwu, f, B
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-d.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸¤ä¸ªB+æ ‘ç´¢å¼•åˆ†åˆ«å¦‚ä¸Šå›¾ï¼š
ã€€ã€€ï¼ˆ1ï¼‰idä¸ºPKï¼Œèšé›†ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨è¡Œè®°å½•ï¼›
ã€€ã€€ï¼ˆ2ï¼‰nameä¸ºKEYï¼Œæ™®é€šç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨PKå€¼ï¼Œå³idï¼›
æ—¢ç„¶ä»æ™®é€šç´¢å¼•æ— æ³•ç›´æ¥å®šä½è¡Œè®°å½•ï¼Œé‚£æ™®é€šç´¢å¼•çš„æŸ¥è¯¢è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ
é€šå¸¸æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰«ç ä¸¤éç´¢å¼•æ ‘ã€‚
ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;select * from t where name=&amp;#39;lisi&amp;#39;;ã€€ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-e.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚çº¢è‰²è·¯å¾„ï¼Œéœ€è¦æ‰«ç ä¸¤éç´¢å¼•æ ‘ï¼š
ï¼ˆ1ï¼‰å…ˆé€šè¿‡æ™®é€šç´¢å¼•å®šä½åˆ°ä¸»é”®å€¼id=5ï¼›
ï¼ˆ2ï¼‰åœ¨é€šè¿‡èšé›†ç´¢å¼•å®šä½åˆ°è¡Œè®°å½•ï¼›
è¿™å°±æ˜¯&lt;code&gt;å›è¡¨æŸ¥è¯¢&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç´¢å¼•è¦†ç›–covering-index&#34;&gt;ç´¢å¼•è¦†ç›–(Covering index)ï¼Ÿ &lt;a href=&#34;#%e7%b4%a2%e5%bc%95%e8%a6%86%e7%9b%96covering-index&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ä»€ä¹ˆæ˜¯ç´¢å¼•è¦†ç›–&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;MySQLå®˜ç½‘ï¼Œç±»ä¼¼çš„è¯´æ³•å‡ºç°åœ¨explainæŸ¥è¯¢è®¡åˆ’ä¼˜åŒ–ç« èŠ‚ï¼Œå³&lt;code&gt;explainçš„è¾“å‡ºç»“æœExtraå­—æ®µä¸ºUsing indexæ—¶ï¼Œèƒ½å¤Ÿè§¦å‘ç´¢å¼•è¦†ç›–&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ç®¡æ˜¯SQL-Serverå®˜ç½‘ï¼Œè¿˜æ˜¯MySQLå®˜ç½‘ï¼Œéƒ½è¡¨è¾¾äº†ï¼š&lt;code&gt;åªéœ€è¦åœ¨ä¸€æ£µç´¢å¼•æ ‘ä¸Šå°±èƒ½è·å–SQLæ‰€éœ€çš„æ‰€æœ‰åˆ—æ•°æ®ï¼Œæ— éœ€å›è¡¨ï¼Œé€Ÿåº¦æ›´å¿«&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å¦‚ä½•å®ç°ç´¢å¼•è¦†ç›–ï¼Ÿ
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-f.jpeg&#34; alt=&#34;&#34;&gt;
èƒ½å¤Ÿå‘½ä¸­nameç´¢å¼•ï¼Œç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†ä¸»é”®idï¼Œé€šè¿‡nameçš„ç´¢å¼•æ ‘å³å¯è·å–idå’Œnameï¼Œæ— éœ€å›è¡¨ï¼Œç¬¦åˆç´¢å¼•è¦†ç›–ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-h.jpeg&#34; alt=&#34;&#34;&gt;
èƒ½å¤Ÿå‘½ä¸­nameç´¢å¼•ï¼Œç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†ä¸»é”®idï¼Œä½†sexå­—æ®µå¿…é¡»å›è¡¨æŸ¥è¯¢æ‰èƒ½è·å–åˆ°ï¼Œä¸ç¬¦åˆç´¢å¼•è¦†ç›–ï¼Œéœ€è¦å†æ¬¡é€šè¿‡idå€¼æ‰«ç èšé›†ç´¢å¼•è·å–sexå­—æ®µï¼Œæ•ˆç‡ä¼šé™ä½ã€‚
å¦‚æœæŠŠ(name)å•åˆ—ç´¢å¼•å‡çº§ä¸º&lt;code&gt;è”åˆç´¢å¼•(name, sex)&lt;/code&gt;å°±ä¸åŒäº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-i.jpeg&#34; alt=&#34;&#34;&gt;
&lt;code&gt;éƒ½èƒ½å¤Ÿå‘½ä¸­ç´¢å¼•è¦†ç›–ï¼Œæ— éœ€å›è¡¨&lt;/code&gt;ã€‚
3.  å“ªäº›åœºæ™¯å¯ä»¥åˆ©ç”¨ç´¢å¼•è¦†ç›–æ¥ä¼˜åŒ–SQLï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…¨è¡¨countæŸ¥è¯¢ä¼˜åŒ– &lt;img src=&#34;https://abnerxc.github.io/img/mysql-j.jpeg&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;åˆ—æŸ¥è¯¢å›è¡¨ä¼˜åŒ–(åŒä¸Šé¢çš„ä¾‹å­)&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;éå¸¸éšè”½çš„å…¨è¡¨æ‰«æä¸èƒ½å‘½ä¸­ç´¢å¼•&#34;&gt;éå¸¸éšè”½çš„å…¨è¡¨æ‰«æï¼Œä¸èƒ½å‘½ä¸­ç´¢å¼• &lt;a href=&#34;#%e9%9d%9e%e5%b8%b8%e9%9a%90%e8%94%bd%e7%9a%84%e5%85%a8%e8%a1%a8%e6%89%ab%e6%8f%8f%e4%b8%8d%e8%83%bd%e5%91%bd%e4%b8%ad%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;code&gt;åˆ—ç±»å‹&lt;/code&gt;ä¸&lt;code&gt;where å€¼ç±»å‹ä¸ç¬¦åˆ&lt;/code&gt;ä¸èƒ½å‘½ä¸­ç´¢å¼•ï¼Œä¼šå¯¼è‡´å…¨è¡¨æ‰«æ&lt;/li&gt;
&lt;li&gt;ç›¸&lt;code&gt;join&lt;/code&gt;çš„ä¸¤ä¸ªè¡¨çš„å­—ç¬¦ç¼–ç ä¸åŒï¼Œä¸èƒ½å‘½ä¸­ç´¢å¼•ï¼Œä¼šå¯¼è‡´è¿ªå¡å°”ç§¯çš„è¿ç®—&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ•°æ®åº“ä¸»é”®ç´¢å¼•ä¸å®œå¤ªé•¿ç‰¹æŒ‡innodb&#34;&gt;æ•°æ®åº“ä¸»é”®ç´¢å¼•ä¸å®œå¤ªé•¿ï¼Ÿï¼Ÿï¼ˆç‰¹æŒ‡InnoDBï¼‰ &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%ba%93%e4%b8%bb%e9%94%ae%e7%b4%a2%e5%bc%95%e4%b8%8d%e5%ae%9c%e5%a4%aa%e9%95%bf%e7%89%b9%e6%8c%87innodb&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;MyISAMå¼•æ“ï¼Œæ— å½±å“ã€‚åŸå› ï¼šè¿›è¡Œæ£€ç´¢æ—¶ï¼Œä¼šå…ˆä»ç´¢å¼•æ ‘å®šä½åˆ°è®°å½•æŒ‡é’ˆï¼Œå†é€šè¿‡æŒ‡é’ˆå®šä½åˆ°å…·ä½“çš„è®°å½•&lt;/li&gt;
&lt;li&gt;InnoDBé€šè¿‡ä¸»é”®ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œèƒ½å¤Ÿç›´æ¥å®šä½åˆ°è¡Œè®°å½•ã€‚ åŸå› ï¼šèº«ä»½è¯å·id_codeæ˜¯ä¸€ä¸ªæ¯”è¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªç´¢å¼•éƒ½å­˜å‚¨è¿™ä¸ªå€¼ï¼Œåœ¨æ•°æ®é‡å¤§ï¼Œå†…å­˜çè´µçš„æƒ…å†µä¸‹ï¼ŒMySQLæœ‰é™çš„ç¼“å†²åŒºï¼Œå­˜å‚¨çš„ç´¢å¼•ä¸æ•°æ®ä¼šå‡å°‘ï¼Œç£ç›˜IOçš„æ¦‚ç‡ä¼šå¢åŠ ã€‚åŒæ—¶ï¼Œç´¢å¼•å ç”¨çš„ç£ç›˜ç©ºé—´ä¹Ÿä¼šå¢åŠ ã€‚&lt;/li&gt;
&lt;li&gt;æ€»ç»“
ï¼ˆ1ï¼‰MyISAMçš„ç´¢å¼•ä¸æ•°æ®åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•å¶å­å­˜å‚¨æŒ‡é’ˆï¼Œä¸»é”®ç´¢å¼•ä¸æ™®é€šç´¢å¼•æ— å¤ªå¤§åŒºåˆ«ï¼›
ï¼ˆ2ï¼‰InnoDBçš„èšé›†ç´¢å¼•å’Œæ•°æ®è¡Œç»Ÿä¸€å­˜å‚¨ï¼Œèšé›†ç´¢å¼•å­˜å‚¨æ•°æ®è¡Œæœ¬èº«ï¼Œæ™®é€šç´¢å¼•å­˜å‚¨ä¸»é”®ï¼›
ï¼ˆ3ï¼‰InnoDBä¸å»ºè®®ä½¿ç”¨å¤ªé•¿å­—æ®µä½œä¸ºPKï¼ˆæ­¤æ—¶å¯ä»¥åŠ å…¥ä¸€ä¸ªè‡ªå¢é”®PKï¼‰ï¼ŒMyISAMåˆ™æ— æ‰€è°“ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;likeæŸ¥è¯¢ä¸€å®šä¸å‘½ä¸­ç´¢å¼•å—&#34;&gt;likeæŸ¥è¯¢ä¸€å®šä¸å‘½ä¸­ç´¢å¼•å—ï¼Ÿ &lt;a href=&#34;#like%e6%9f%a5%e8%af%a2%e4%b8%80%e5%ae%9a%e4%b8%8d%e5%91%bd%e4%b8%ad%e7%b4%a2%e5%bc%95%e5%90%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;mysqlåœ¨ä½¿ç”¨likeæŸ¥è¯¢ï¼Œ%åœ¨æœ€å‰é¢ä¸ä¼šç”¨åˆ°ç´¢å¼•ï¼Œä¸­é—´æˆ–æœ€åæ˜¯ä¼šç”¨åˆ°ç´¢å¼•çš„ï¼Œåªæ˜¯è¶Šé å‰æ‰«æçš„è¡Œæ•°è¶Šå¤š
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-k.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç´¢å¼•ä¸‹æ¨&#34;&gt;ç´¢å¼•ä¸‹æ¨ &lt;a href=&#34;#%e7%b4%a2%e5%bc%95%e4%b8%8b%e6%8e%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;ä¾‹å¦‚å¯¹äºuser_tableè¡¨ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ï¼ˆusername,ageï¼‰è”åˆç´¢å¼•ï¼Œå¦‚æœç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼ŒæŸ¥å‡ºåç§°ä¸­ä»¥â€œå¼ â€å¼€å¤´ä¸”å¹´é¾„å°äºç­‰äº10çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¯­å¥å¦‚ä¸‹ï¼š&amp;ldquo;select * from user_table where username like &amp;lsquo;å¼ %&amp;rsquo; and age &amp;gt; 10&amp;rdquo;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ç´¢å¼•ä¸‹æ¨ï¼šlike â€˜zhang%â€™and age &amp;gt;10 æ£€ç´¢ï¼ŒMySQL5.6ç‰ˆæœ¬ä¹‹å‰ï¼Œä¼šå¯¹åŒ¹é…çš„æ•°æ®è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚5.6ç‰ˆæœ¬åï¼Œä¼šå…ˆè¿‡æ»¤æ‰age&amp;lt;10çš„æ•°æ®ï¼Œå†è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œå‡å°‘å›è¡¨ç‡ï¼Œæå‡æ£€ç´¢é€Ÿåº¦&lt;/li&gt;
&lt;li&gt;æ³¨æ„ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;innodbå¼•æ“çš„è¡¨ï¼Œç´¢å¼•ä¸‹æ¨åªèƒ½ç”¨äºäºŒçº§ç´¢å¼•ã€‚ åŸå› ï¼šinnodbçš„ä¸»é”®ç´¢å¼•æ ‘å¶å­ç»“ç‚¹ä¸Šä¿å­˜çš„æ˜¯å…¨è¡Œæ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ç´¢å¼•ä¸‹æ¨å¹¶ä¸ä¼šèµ·åˆ°å‡å°‘æŸ¥è¯¢å…¨è¡Œæ•°æ®çš„æ•ˆæœã€‚&lt;/li&gt;
&lt;li&gt;ç´¢å¼•ä¸‹æ¨ä¸€èˆ¬å¯ç”¨äºæ‰€æ±‚æŸ¥è¯¢å­—æ®µï¼ˆselectåˆ—ï¼‰ä¸æ˜¯/ä¸å…¨æ˜¯è”åˆç´¢å¼•çš„å­—æ®µï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸ºå¤šæ¡ä»¶æŸ¥è¯¢ä¸”æŸ¥è¯¢æ¡ä»¶å­å¥ï¼ˆwhere/order byï¼‰å­—æ®µå…¨æ˜¯è”åˆç´¢å¼•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;å‡è®¾è¡¨tæœ‰è”åˆç´¢å¼•ï¼ˆa,bï¼‰,ä¸‹é¢è¯­å¥å¯ä»¥ä½¿ç”¨ç´¢å¼•ä¸‹æ¨æé«˜æ•ˆç‡&lt;code&gt;select * from t where a &amp;gt; 2 and b &amp;gt; 10&lt;/code&gt;;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;æ—¥å¿—&#34;&gt;æ—¥å¿— &lt;a href=&#34;#%e6%97%a5%e5%bf%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;mysqlå¤šå°‘ç§æ—¥å¿—&#34;&gt;MySQLå¤šå°‘ç§æ—¥å¿— &lt;a href=&#34;#mysql%e5%a4%9a%e5%b0%91%e7%a7%8d%e6%97%a5%e5%bf%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;é”™è¯¯æ—¥å¿—ï¼šè®°å½•mysqlå¯åŠ¨å’Œè¿è¡Œçš„å‡ºé”™ä¿¡æ¯ï¼Œä¹Ÿè®°å½•ä¸€äº›è­¦å‘Šä¿¡æ¯æˆ–è€…æ­£ç¡®çš„ä¿¡æ¯ï¼Œåœ¨my.cnfä¸­log_erroræŒ‡å®šè·¯å¾„ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰å¯¹æ•°æ®åº“è¯·æ±‚çš„ä¿¡æ¯ï¼Œä¸è®ºè¿™äº›è¯·æ±‚æ˜¯å¦å¾—åˆ°äº†æ­£ç¡®çš„æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šè®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼ˆlog_query_timeï¼‰ï¼Œå°†è¿è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼çš„æ‰€æœ‰SQLè¯­å¥éƒ½è®°å½•åˆ°æ…¢æŸ¥è¯¢çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;äºŒè¿›åˆ¶æ—¥å¿—ï¼šåˆå«åšbin-logæ—¥å¿—ï¼Œçºªå½•æ‰€æœ‰çš„å†™æ“ä½œ(å¢æ”¹åˆ )ï¼Œçºªå½•ä¸€äº›æ‰§è¡Œæ—¶é—´ï¼Œæ‰§è¡Œæ—¶é•¿ï¼Œæ•°æ®å˜æ›´ç­‰ã€‚ä¸»è¦ç”¨äº&lt;code&gt;æ¢å¤ã€å¤åˆ¶ã€å®¡è®¡&lt;/code&gt;ï¼Œç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼mysql-bin.001..ç­‰ä¸€ç³»åˆ—åºå·ã€‚&lt;/li&gt;
&lt;li&gt;ä¸­ç»§æ—¥å¿—ï¼šç†è§£ä¸Šrelay logå¾ˆå¤šæ–¹é¢éƒ½è·Ÿbinary logå·®ä¸å¤šã€‚åŒºåˆ«æ˜¯ï¼šä»æœåŠ¡å™¨I/Oçº¿ç¨‹å°†ä¸»æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—è¯»å–è¿‡æ¥è®°å½•åˆ°ä»æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ï¼Œç„¶åSQLçº¿ç¨‹ä¼šè¯»å–relay-logæ—¥å¿—çš„å†…å®¹å¹¶åº”ç”¨åˆ°ä»æœåŠ¡å™¨ï¼Œä»è€Œä½¿ä»æœåŠ¡å™¨å’Œä¸»æœåŠ¡å™¨çš„æ•°æ®ä¿æŒä¸€è‡´&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æ—¥å¿—ï¼š äº‹åŠ¡æ—¥å¿—æ–‡ä»¶åä¸º&lt;code&gt;ib_logfile0&lt;/code&gt;å’Œ&lt;code&gt;ib_logfile1&lt;/code&gt;ï¼Œé»˜è®¤å­˜æ”¾åœ¨è¡¨ç©ºé—´æ‰€åœ¨ç›®å½•&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;mysql-binlogçš„å‡ ç§æ—¥å¿—å½•å…¥æ ¼å¼ä»¥åŠåŒºåˆ«&#34;&gt;MySQL binlogçš„å‡ ç§æ—¥å¿—å½•å…¥æ ¼å¼ä»¥åŠåŒºåˆ« &lt;a href=&#34;#mysql-binlog%e7%9a%84%e5%87%a0%e7%a7%8d%e6%97%a5%e5%bf%97%e5%bd%95%e5%85%a5%e6%a0%bc%e5%bc%8f%e4%bb%a5%e5%8f%8a%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;æ ¼å¼ï¼š&lt;code&gt;Statement&lt;/code&gt;,&lt;code&gt;Row&lt;/code&gt;ï¼Œ&lt;code&gt;Mixedlevel&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åŒºåˆ«:&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;åŸºäºè¯­å¥çºªå½•ï¼ˆStatement ï¼‰:æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqléƒ½ä¼šè®°å½•åœ¨binlogä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼šåªéœ€è¦è®°å½•æ‰§è¡Œè¯­å¥çš„ç»†èŠ‚å’Œä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œé¿å…äº†è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œåœ¨ä¸€äº›ä¿®æ”¹è®°å½•è¾ƒå¤šçš„æƒ…å†µä¸‹ç›¸æ¯”ROW levelèƒ½å¤§å¤§å‡å°‘binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦IOï¼Œæé«˜æ€§èƒ½ï¼›è¿˜å¯ä»¥ç”¨äºå®æ—¶çš„è¿˜åŸï¼›&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šä¸ºäº†ä¿è¯sqlè¯­å¥èƒ½åœ¨slaveä¸Šæ­£ç¡®æ‰§è¡Œï¼Œå¿…é¡»è®°å½•ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»¥ä¿è¯æ‰€æœ‰è¯­å¥èƒ½åœ¨slaveå¾—åˆ°å’Œåœ¨masterç«¯æ‰§è¡Œæ—¶å€™ç›¸åŒçš„ç»“æœï¼›å¦å¤–ï¼Œä¸»ä»å¤åˆ¶æ—¶ï¼Œå­˜åœ¨éƒ¨åˆ†å‡½æ•°ï¼ˆå¦‚sleepï¼‰åŠå­˜å‚¨è¿‡ç¨‹åœ¨slaveä¸Šä¼šå‡ºç°ä¸masterç»“æœä¸ä¸€è‡´çš„æƒ…å†µï¼Œè€Œç›¸æ¯”Row levelè®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ç»†èŠ‚ï¼Œç»ä¸ä¼šå‘ç”Ÿè¿™ç§ä¸ä¸€è‡´çš„æƒ…å†µ.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åŸºäºè¡Œï¼ˆRowï¼‰ï¼šä»…ä¿å­˜è®°å½•è¢«ä¿®æ”¹ç»†èŠ‚ï¼Œä¸è®°å½•sqlè¯­å¥ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼š èƒ½éå¸¸æ¸…æ™°çš„è®°å½•ä¸‹æ¯è¡Œæ•°æ®çš„ä¿®æ”¹ç»†èŠ‚ï¼Œä¸éœ€è¦è®°å½•ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ï¼Œå› æ­¤ä¸ä¼šå‘ç”ŸæŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„procedureã€functionã€åŠtriggerçš„è°ƒç”¨è§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ï¼Œä»»ä½•æƒ…å†µéƒ½å¯ä»¥è¢«å¤åˆ¶ï¼Œä¸”èƒ½åŠ å¿«ä»åº“é‡æ”¾æ—¥å¿—çš„æ•ˆç‡ï¼Œä¿è¯ä»åº“æ•°æ®çš„ä¸€è‡´æ€§&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹:ç”±äºæ‰€æœ‰çš„æ‰§è¡Œçš„è¯­å¥åœ¨æ—¥å¿—ä¸­éƒ½å°†ä»¥æ¯è¡Œè®°å½•çš„ä¿®æ”¹ç»†èŠ‚æ¥è®°å½•ï¼Œå› æ­¤ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—å†…å®¹ï¼Œå¹²æ‰°å†…å®¹ä¹Ÿè¾ƒå¤šï¼›æ¯”å¦‚ä¸€æ¡updateè¯­å¥ï¼Œå¦‚ä¿®æ”¹å¤šæ¡è®°å½•ï¼Œåˆ™binlogä¸­æ¯ä¸€æ¡ä¿®æ”¹éƒ½ä¼šæœ‰è®°å½•ï¼Œè¿™æ ·é€ æˆbinlogæ—¥å¿—é‡ä¼šå¾ˆå¤§ï¼Œç‰¹åˆ«æ˜¯å½“æ‰§è¡Œalter tableä¹‹ç±»çš„è¯­å¥çš„æ—¶å€™ï¼Œç”±äºè¡¨ç»“æ„ä¿®æ”¹ï¼Œæ¯æ¡è®°å½•éƒ½å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆè¯¥è¡¨æ¯ä¸€æ¡è®°å½•éƒ½ä¼šè®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œå®é™…ç­‰äºé‡å»ºäº†è¡¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;æ··åˆæ¨¡å¼ï¼ˆMixedlevelï¼‰ï¼šæ˜¯ä»¥ä¸Šä¸¤ç§levelçš„æ··åˆä½¿ç”¨
ä¸€èˆ¬çš„è¯­å¥ä¿®æ”¹ä½¿ç”¨statmentæ ¼å¼ä¿å­˜binlogï¼Œå¦‚ä¸€äº›å‡½æ•°ï¼Œstatementæ— æ³•å®Œæˆä¸»ä»å¤åˆ¶çš„æ“ä½œï¼Œåˆ™ é‡‡ç”¨rowæ ¼å¼ä¿å­˜binlog,MySQLä¼šæ ¹æ®æ‰§è¡Œçš„æ¯ä¸€æ¡å…·ä½“çš„sqlè¯­å¥æ¥åŒºåˆ†å¯¹å¾…è®°å½•çš„æ—¥å¿—å½¢å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨Statementå’ŒRowä¹‹é—´é€‰æ‹© ä¸€ç§.æ–°ç‰ˆæœ¬çš„MySQLä¸­é˜Ÿrow levelæ¨¡å¼ä¹Ÿè¢«åšäº†ä¼˜åŒ–ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¿®æ”¹éƒ½ä¼šä»¥row levelæ¥è®°å½•ï¼Œåƒé‡åˆ°è¡¨ç»“æ„å˜æ›´çš„æ—¶å€™å°±ä¼šä»¥statementæ¨¡å¼æ¥è®°å½•ã€‚è‡³äºupdateæˆ–è€…deleteç­‰ä¿®æ”¹æ•°æ®çš„è¯­å¥ï¼Œè¿˜æ˜¯ä¼šè®°å½•æ‰€æœ‰è¡Œçš„ å˜æ›´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...............................................................................
# at 552
#131128 17:50:46 server id 1  end_log_pos 665   Query   thread_id=11    exec_time=0     error_code=0 +++-&amp;gt;æ‰§è¡Œæ—¶é—´:17:50:46ï¼›posç‚¹:665
SET TIMESTAMP=1385632246/*!*/;
update zyyshop.stu set name=&amp;#39;æå››&amp;#39; where id=4              +++-&amp;gt;æ‰§è¡Œçš„SQL
/*!*/;
# at 665
#131128 17:50:46 server id 1  end_log_pos 692   Xid = 1454 +++-&amp;gt;æ‰§è¡Œæ—¶é—´:17:50:46ï¼›posç‚¹:692 
...............................................................................
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;äº‹ç‰©&#34;&gt;äº‹ç‰© &lt;a href=&#34;#%e4%ba%8b%e7%89%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;æ•°æ®åº“äº‹åŠ¡ç‰¹æ€§acid&#34;&gt;æ•°æ®åº“äº‹åŠ¡ç‰¹æ€§(ACID) &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%ba%93%e4%ba%8b%e5%8a%a1%e7%89%b9%e6%80%a7acid&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;åŸå­æ€§ï¼šå³æ­¥éª¤è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥&lt;/li&gt;
&lt;li&gt;ä¸€è‡´æ€§ï¼šå³æ“ä½œçš„æ€»æ•°æ®é‡çŠ¶æ€ä¿è¯ä¸€è‡´ã€‚ä¾‹å¦‚A-&amp;gt;Bè½¬è´¦æ€»æ•°æœ¨å˜åŒ–æ˜¯100ï¼Œä¸å¤šä¹Ÿä¸å°‘&lt;/li&gt;
&lt;li&gt;éš”ç¦»æ€§ï¼šå³æ¯ä¸ªäº‹ç‰©çš„æ“ä½œï¼Œä¸å½±å“å…¶ä»–çš„äº‹ç‰©&lt;/li&gt;
&lt;li&gt;æŒä¹…æ€§ï¼šå³ä¸€æ—¦æäº¤ç»“æœæ°¸ä¹…ä¿å­˜&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;äº‹ç‰©æ˜¯å¦‚ä½•é€šè¿‡æ—¥å¿—å®ç°çš„&#34;&gt;äº‹ç‰©æ˜¯å¦‚ä½•é€šè¿‡æ—¥å¿—å®ç°çš„ &lt;a href=&#34;#%e4%ba%8b%e7%89%a9%e6%98%af%e5%a6%82%e4%bd%95%e9%80%9a%e8%bf%87%e6%97%a5%e5%bf%97%e5%ae%9e%e7%8e%b0%e7%9a%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-l.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;redo_log å®ç°æŒä¹…åŒ–å’ŒåŸå­æ€§ï¼Œè€Œundo_logå®ç°ä¸€è‡´æ€§ï¼ŒäºŒç§æ—¥å¿—å‡å¯ä»¥è§†ä¸ºä¸€ç§æ¢å¤æ“ä½œï¼Œredo_logæ˜¯æ¢å¤æäº¤äº‹åŠ¡ä¿®æ”¹çš„é¡µæ“ä½œï¼Œè€Œundo_logæ˜¯å›æ»šè¡Œè®°å½•åˆ°ç‰¹å®šç‰ˆæœ¬ã€‚äºŒè€…è®°å½•çš„å†…å®¹ä¹Ÿä¸åŒï¼Œredo_logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•é¡µçš„ç‰©ç†ä¿®æ”¹æ“ä½œï¼Œè€Œundo_logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œæ ¹æ®æ¯è¡Œè®°å½•è¿›è¡Œè®°å½•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;äº‹åŠ¡æ—¥å¿—æ˜¯é€šè¿‡redo(é‡åšæ—¥å¿—)å’Œinnodbçš„å­˜å‚¨å¼•æ“æ—¥å¿—ç¼“å†²ï¼ˆInnodb log bufferï¼‰æ¥å®ç°çš„ï¼Œ&lt;/li&gt;
&lt;li&gt;å½“å¼€å§‹ä¸€ä¸ªäº‹åŠ¡çš„æ—¶å€™ï¼Œä¼šè®°å½•è¯¥äº‹åŠ¡çš„lsn(log sequence number)å·;&lt;/li&gt;
&lt;li&gt;å½“äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œä¼šå¾€InnoDBå­˜å‚¨å¼•æ“çš„æ—¥å¿—çš„æ—¥å¿—ç¼“å­˜é‡Œé¢æ’å…¥äº‹åŠ¡æ—¥å¿—ï¼›&lt;/li&gt;
&lt;li&gt;å½“äº‹åŠ¡æäº¤æ—¶ï¼Œå¿…é¡»å°†å­˜å‚¨å¼•æ“çš„æ—¥å¿—ç¼“å†²å†™å…¥ç£ç›˜ï¼ˆé€šè¿‡innodb_flush_log_at_trx_commitæ¥æ§åˆ¶ï¼‰ï¼Œä¹Ÿå°±æ˜¯å†™æ•°æ®å‰ï¼Œéœ€è¦å…ˆå†™æ—¥å¿—ã€‚è¿™ç§æ–¹å¼ç§°ä¸ºâ€œé¢„å†™æ—¥å¿—æ–¹å¼â€&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;äº‹åŠ¡å¹²æ‰°ä¾‹å­&#34;&gt;äº‹åŠ¡å¹²æ‰°ä¾‹å­ &lt;a href=&#34;#%e4%ba%8b%e5%8a%a1%e5%b9%b2%e6%89%b0%e4%be%8b%e5%ad%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;è¯»è„&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- äº‹åŠ¡Aï¼Œå…ˆæ‰§è¡Œï¼Œå¤„äºæœªæäº¤çš„çŠ¶æ€ï¼šinsert into t values(4, wangwu);
- äº‹åŠ¡Bï¼Œåæ‰§è¡Œï¼Œä¹Ÿæœªæäº¤ï¼šselect * from t;
å¦‚æœäº‹åŠ¡Bèƒ½å¤Ÿè¯»å–åˆ°(4, wangwu)è¿™æ¡è®°å½•ï¼Œäº‹åŠ¡Aå°±å¯¹äº‹åŠ¡Bäº§ç”Ÿäº†å½±å“ï¼Œ
è¿™ä¸ªå½±å“å«åšâ€œè¯»è„â€ï¼Œè¯»åˆ°äº†æœªæäº¤äº‹åŠ¡æ“ä½œçš„è®°å½•ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;ä¸å¯é‡å¤è¯»&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- äº‹åŠ¡Aï¼Œå…ˆæ‰§è¡Œï¼šselect * from t where id=1;ç»“æœé›†ä¸ºï¼š1, zhangsan
- äº‹åŠ¡Bï¼Œåæ‰§è¡Œï¼Œå¹¶ä¸”æäº¤ï¼šupdate t set name=xxoo where id=1;commit;
- äº‹åŠ¡Aï¼Œå†æ¬¡æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢ï¼šselect * from t where id=1;ç»“æœé›†ä¸ºï¼š1, xxoo
è¿™æ¬¡æ˜¯å·²æäº¤äº‹åŠ¡Bå¯¹äº‹åŠ¡Aäº§ç”Ÿçš„å½±å“ï¼Œ
è¿™ä¸ªå½±å“å«åšâ€œä¸å¯é‡å¤è¯»â€ï¼Œä¸€ä¸ªäº‹åŠ¡å†…ç›¸åŒçš„æŸ¥è¯¢ï¼Œå¾—åˆ°äº†ä¸åŒçš„ç»“æœã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å¹»è¯»&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- äº‹åŠ¡Aï¼Œå…ˆæ‰§è¡Œï¼šselect * from t where id&amp;gt;3; ç»“æœä¸ºnull
- äº‹åŠ¡Bï¼Œåæ‰§è¡Œï¼Œå¹¶ä¸”æäº¤ï¼šinsert into t values(4, wangwu);commit;
- äº‹åŠ¡Aï¼Œé¦–æ¬¡æŸ¥è¯¢äº†id&amp;gt;3çš„ç»“æœä¸ºNULLï¼Œäºæ˜¯æƒ³æ’å…¥ä¸€æ¡ä¸º4çš„è®°å½•ï¼šinsert into t values(4, xxoo);ç»“æœé›†ä¸ºï¼šError : duplicate key!
è¿™æ¬¡æ˜¯å·²æäº¤äº‹åŠ¡Bå¯¹äº‹åŠ¡Aäº§ç”Ÿçš„å½±å“ï¼Œè¿™ä¸ªå½±å“å«åšâ€œå¹»è¯»â€ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æ•°æ®åº“çš„éš”ç¦»çº§åˆ«&#34;&gt;æ•°æ®åº“çš„éš”ç¦»çº§åˆ« &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e9%9a%94%e7%a6%bb%e7%ba%a7%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;æœªæäº¤è¯»(Read Uncommitted)ï¼ˆSé”ï¼‰: æ­¤æ—¶ï¼Œå¯èƒ½è¯»å–åˆ°ä¸ä¸€è‡´çš„æ•°æ®ï¼Œå³â€œè¯»è„â€ã€‚è¿™æ˜¯å¹¶å‘æœ€é«˜ï¼Œä¸€è‡´æ€§æœ€å·®çš„éš”ç¦»çº§åˆ«ã€‚é«˜å¹¶å‘é‡çš„åœºæ™¯ä¸‹ï¼Œå‡ ä¹ä¸ä¼šä½¿ç”¨&lt;/li&gt;
&lt;li&gt;ä¸²è¡ŒåŒ–(Serializable)ï¼ˆXé”ï¼‰: è¿™ç§äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ‰€æœ‰selectè¯­å¥éƒ½ä¼šè¢«éšå¼çš„è½¬åŒ–ä¸ºselect &amp;hellip; in share mode.è¿™å¯èƒ½å¯¼è‡´ï¼Œå¦‚æœæœ‰æœªæäº¤çš„äº‹åŠ¡æ­£åœ¨ä¿®æ”¹æŸäº›è¡Œï¼Œæ‰€æœ‰è¯»å–è¿™äº›è¡Œçš„selectéƒ½ä¼šè¢«é˜»å¡ä½ã€‚è¿™æ˜¯ä¸€è‡´æ€§æœ€å¥½çš„ï¼Œä½†å¹¶å‘æ€§æœ€å·®çš„éš”ç¦»çº§åˆ«ã€‚å¯ä»¥è§£å†³ è„è¯» ä¸å¯é‡å¤è¯» å’Œ è™šè¯»+++ç›¸å½“äºé”è¡¨,æ‰€ä»¥é«˜å¹¶å‘é‡çš„åœºæ™¯ä¸‹ï¼Œå‡ ä¹ä¸ä¼šä½¿ç”¨&lt;/li&gt;
&lt;li&gt;å¯é‡å¤è¯»(Repeated Read, RR)ï¼ˆXé”ï¼‰ï¼Œè¿™æ˜¯InnoDBé»˜è®¤çš„éš”ç¦»çº§åˆ«
(1) &lt;code&gt;æ™®é€šçš„select&lt;/code&gt;ä½¿ç”¨å¿«ç…§è¯»(snapshot read)ï¼Œè¿™æ˜¯ä¸€ç§ä¸åŠ é”çš„ä¸€è‡´æ€§è¯»(Consistent Nonlocking Read)ï¼Œåº•å±‚ä½¿ç”¨MVCCæ¥å®ç°
(2) &lt;code&gt;åŠ é”çš„select&lt;/code&gt;(select &amp;hellip; in share mode / select &amp;hellip; for update), update, deleteç­‰è¯­å¥ï¼Œå®ƒä»¬çš„é”ï¼Œä¾èµ–äºå®ƒä»¬æ˜¯å¦åœ¨å”¯ä¸€ç´¢å¼•(unique index)ä¸Šä½¿ç”¨äº†å”¯ä¸€çš„æŸ¥è¯¢æ¡ä»¶(unique search condition)ï¼Œæˆ–è€…èŒƒå›´æŸ¥è¯¢æ¡ä»¶(range-type search condition)ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨å”¯ä¸€ç´¢å¼•ä¸Šä½¿ç”¨å”¯ä¸€çš„æŸ¥è¯¢æ¡ä»¶ï¼Œä¼šä½¿ç”¨è®°å½•é”(record lock)ï¼Œè€Œä¸ä¼šå°é”è®°å½•ä¹‹é—´çš„é—´éš”ï¼Œå³ä¸ä¼šä½¿ç”¨é—´éš™é”(gap lock)ä¸ä¸´é”®é”(next-key lock)&lt;/li&gt;
&lt;li&gt;èŒƒå›´æŸ¥è¯¢æ¡ä»¶ï¼Œä¼šä½¿ç”¨é—´éš™é”ä¸ä¸´é”®é”ï¼Œé”ä½ç´¢å¼•è®°å½•ä¹‹é—´çš„èŒƒå›´ï¼Œé¿å…èŒƒå›´é—´æ’å…¥è®°å½•ï¼Œä»¥é¿å…äº§ç”Ÿå¹»å½±è¡Œè®°å½•ï¼Œä»¥åŠé¿å…ä¸å¯é‡å¤çš„è¯»&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¯»å·²æäº¤(Read Committed, RC): è¿™æ˜¯äº’è”ç½‘æœ€å¸¸ç”¨çš„éš”ç¦»çº§åˆ«
&lt;ul&gt;
&lt;li&gt;æ™®é€šè¯»æ˜¯å¿«ç…§è¯»ï¼›&lt;/li&gt;
&lt;li&gt;åŠ é”çš„select, update, deleteç­‰è¯­å¥ï¼Œé™¤äº†åœ¨å¤–é”®çº¦æŸæ£€æŸ¥(foreign-key constraint checking)ä»¥åŠé‡å¤é”®æ£€æŸ¥(duplicate-key checking)æ—¶ä¼šå°é”åŒºé—´ï¼Œå…¶ä»–æ—¶åˆ»éƒ½åªä½¿ç”¨è®°å½•é”ï¼›&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶ï¼Œå…¶ä»–äº‹åŠ¡çš„æ’å…¥ä¾ç„¶å¯ä»¥æ‰§è¡Œï¼Œå°±å¯èƒ½å¯¼è‡´ï¼Œè¯»å–åˆ°å¹»å½±è®°å½•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;mvccè§£é‡Š&#34;&gt;MVCCè§£é‡Š &lt;a href=&#34;#mvcc%e8%a7%a3%e9%87%8a&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;MVCC (Multiversion Concurrency Control)ï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æŠ€æœ¯,å®ƒä½¿å¾—å¤§éƒ¨åˆ†æ”¯æŒè¡Œé”çš„äº‹åŠ¡å¼•æ“ï¼Œä¸å†å•çº¯çš„ä½¿ç”¨è¡Œé”æ¥è¿›è¡Œæ•°æ®åº“çš„å¹¶å‘æ§åˆ¶ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æŠŠæ•°æ®åº“çš„è¡Œé”ä¸è¡Œçš„å¤šä¸ªç‰ˆæœ¬ç»“åˆèµ·æ¥ï¼Œåªéœ€è¦å¾ˆå°çš„å¼€é”€,å°±å¯ä»¥å®ç°éé”å®šè¯»ï¼Œä»è€Œå¤§å¤§æé«˜æ•°æ®åº“ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½&lt;/li&gt;
&lt;li&gt;æ ¸å¿ƒåŸç†
(1) å†™ä»»åŠ¡å‘ç”Ÿæ—¶ï¼Œå°†æ•°æ®å…‹éš†ä¸€ä»½ï¼Œä»¥ç‰ˆæœ¬å·åŒºåˆ†ï¼›
(2) å†™ä»»åŠ¡æ“ä½œæ–°å…‹éš†çš„æ•°æ®ï¼Œç›´è‡³æäº¤ï¼›
(3) å¹¶å‘è¯»ä»»åŠ¡å¯ä»¥ç»§ç»­è¯»å–æ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œä¸è‡³äºé˜»å¡ï¼›
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-m.jpeg&#34; alt=&#34;&#34;&gt;
å¦‚ä¸Šå›¾ï¼š&lt;/li&gt;
&lt;li&gt;æœ€å¼€å§‹æ•°æ®çš„ç‰ˆæœ¬æ˜¯V0ï¼›&lt;/li&gt;
&lt;li&gt;T1æ—¶åˆ»å‘èµ·äº†ä¸€ä¸ªå†™ä»»åŠ¡ï¼Œè¿™æ˜¯æŠŠæ•°æ®cloneäº†ä¸€ä»½ï¼Œè¿›è¡Œä¿®æ”¹ï¼Œç‰ˆæœ¬å˜ä¸ºV1ï¼Œä½†ä»»åŠ¡è¿˜æœªå®Œæˆï¼›&lt;/li&gt;
&lt;li&gt;T2æ—¶åˆ»å¹¶å‘äº†ä¸€ä¸ªè¯»ä»»åŠ¡ï¼Œä¾ç„¶å¯ä»¥è¯»V0ç‰ˆæœ¬çš„æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;T3æ—¶åˆ»åˆå¹¶å‘äº†ä¸€ä¸ªè¯»ä»»åŠ¡ï¼Œä¾ç„¶ä¸ä¼šé˜»å¡ï¼›
å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®å¤šç‰ˆæœ¬ï¼Œé€šè¿‡â€œè¯»å–æ—§ç‰ˆæœ¬æ•°æ®â€èƒ½å¤Ÿæå¤§æé«˜ä»»åŠ¡çš„å¹¶å‘åº¦ã€‚
æé«˜å¹¶å‘çš„æ¼”è¿›æ€è·¯ï¼Œå°±åœ¨å¦‚æ­¤ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ™®é€šé”ï¼Œæœ¬è´¨æ˜¯ä¸²è¡Œæ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;è¯»å†™é”ï¼Œå¯ä»¥å®ç°è¯»è¯»å¹¶å‘&lt;/li&gt;
&lt;li&gt;æ•°æ®å¤šç‰ˆæœ¬ï¼Œå¯ä»¥å®ç°è¯»å†™å¹¶å‘&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é”&#34;&gt;é” &lt;a href=&#34;#%e9%94%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-n.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;é”æœºåˆ¶&#34;&gt;é”æœºåˆ¶ &lt;a href=&#34;#%e9%94%81%e6%9c%ba%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;æ‚²è§‚é”ï¼šåˆ©ç”¨äº†æ•°æ®åº“å†…éƒ¨æä¾›çš„é”æœºåˆ¶ï¼›åœ¨å¹¶å‘è¿‡ç¨‹ä¸­ä¸€æ—¦æœ‰ä¸€ä¸ªäº‹åŠ¡æŒæœ‰äº†æ•°æ®åº“è®°å½•çš„é”ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¸èƒ½å†å¯¹æ•°æ®åº“è¿›è¡Œæ›´æ–°&lt;/li&gt;
&lt;li&gt;ä¹è§‚é”ï¼šä¹è§‚é”æ˜¯ä¸€ç§ä¸ä¼šé˜»å¡å…¶å®ƒçº¿ç¨‹å¹¶å‘çš„æœºåˆ¶ï¼Œå®ƒä¸ä¼šä½¿ç”¨æ•°æ®åº“çš„é”è¿›è¡Œå®ç°ã€‚æ‰€ä»¥å°±ä¸ä¼šå¼•èµ·çº¿ç¨‹çš„é¢‘ç¹æŒ‚èµ·å’Œæ¢å¤ï¼Œè¿™æ ·æ•ˆç‡å°±æé«˜äº†ã€‚å®ƒçš„å®ç°å…³é”®åœ¨äºCASç®—æ³•æˆ–è€…ç‰ˆæœ¬å·æœºåˆ¶ã€‚
&lt;ul&gt;
&lt;li&gt;ç‰ˆæœ¬å·æœºåˆ¶ï¼š
&lt;ol&gt;
&lt;li&gt;å…ˆè¯»taskè¡¨çš„æ•°æ®ï¼ˆå®é™…ä¸Šè¿™ä¸ªè¡¨åªæœ‰ä¸€æ¡è®°å½•ï¼‰ï¼Œå¾—åˆ°versionçš„å€¼ä¸ºversionValue&lt;/li&gt;
&lt;li&gt;update task set value = newValue,version =  versionValue + 1   where version = versionValue;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;CASç®—æ³•ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;é”ç²’åº¦&#34;&gt;é”ç²’åº¦ &lt;a href=&#34;#%e9%94%81%e7%b2%92%e5%ba%a6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;è¡Œé”è¯¦è§£
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-o.jpeg&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;è¡¨é”è¯¦è§£&lt;/li&gt;
&lt;li&gt;é¡µé”è¯¦è§£&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å½“å‰è¯»ä¸å¿«ç…§è¯»&#34;&gt;å½“å‰è¯»ä¸å¿«ç…§è¯» &lt;a href=&#34;#%e5%bd%93%e5%89%8d%e8%af%bb%e4%b8%8e%e5%bf%ab%e7%85%a7%e8%af%bb&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å½“å‰è¯»
ä½¿ç”¨å½“å‰è¯»çš„æ“ä½œä¸»è¦åŒ…æ‹¬ï¼šæ˜¾å¼åŠ é”çš„è¯»æ“ä½œä¸æ’å…¥/æ›´æ–°/åˆ é™¤ç­‰å†™æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;select * from table where ? lock in share mode;
select * from table where ? for update;
insert into table values (â€¦);
update table set ? where ?;
delete from table where ?;
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å¿«ç…§è¯»
å³ä¸åŠ é”è¯»ï¼Œè¯»å–è®°å½•çš„å¿«ç…§ç‰ˆæœ¬è€Œéæœ€æ–°ç‰ˆæœ¬ï¼Œé€šè¿‡MVCCå®ç°ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é”æ¨¡å¼&#34;&gt;é”æ¨¡å¼ &lt;a href=&#34;#%e9%94%81%e6%a8%a1%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;é”æ¨¡å¼&lt;/th&gt;
          &lt;th&gt;é”å®šå†…å®¹&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Record Lock&lt;/td&gt;
          &lt;td&gt;è®°å½•é”,é”å®šä¸€æ¡çºªå½•&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Gap Lock&lt;/td&gt;
          &lt;td&gt;é—´éš™é”,é”å®šä¸€ä¸ªåŒºé—´&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Next-key Lock&lt;/td&gt;
          &lt;td&gt;è®°å½•+é—´éš™é”,é”å®šä¸€ä¸ªåŒºé—´+è®°å½•è¡Œ&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;ç½‘ç»œ&#34;&gt;ç½‘ç»œ &lt;a href=&#34;#%e7%bd%91%e7%bb%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ä¸»ä»å¤åˆ¶åŸç†&#34;&gt;ä¸»ä»å¤åˆ¶åŸç† &lt;a href=&#34;#%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-p.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;mysqlå¯åŠ¨ä»¥åä¼šå­˜åœ¨2ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯sqlThredè¿›ç¨‹ä¸€ä¸ªIOThredè¿›ç¨‹&lt;/li&gt;
&lt;li&gt;åœ¨Slave æœåŠ¡å™¨ä¸Šæ‰§è¡Œsart slaveå‘½ä»¤å¼€å¯ä¸»ä»å¤åˆ¶å¼€å…³ï¼Œå¼€å§‹è¿›è¡Œä¸»ä»å¤åˆ¶&lt;/li&gt;
&lt;li&gt;SlaveæœåŠ¡å™¨çš„IOçº¿ç¨‹ä¼šé€šè¿‡åœ¨masterä¸Šå·²ç»æˆæƒçš„å¤åˆ¶ç”¨æˆ·æƒé™è¯·æ±‚è¿æ¥masteræœåŠ¡å™¨ï¼Œå¹¶è¯·æ±‚ä»æ‰§è¡Œbinlogæ—¥å¿—æ–‡ä»¶çš„æŒ‡å®šä½ç½®ä¹‹åå¼€å§‹å‘é€binlogæ—¥å¿—å†…å®¹&lt;/li&gt;
&lt;li&gt;MasteræœåŠ¡å™¨æ¥æ”¶åˆ°æ¥è‡ªSlaveæœåŠ¡å™¨çš„IOçº¿ç¨‹çš„è¯·æ±‚åï¼ŒäºŒè¿›åˆ¶è½¬å‚¨IOçº¿ç¨‹ä¼šæ ¹æ®SlaveæœåŠ¡å™¨çš„IOçº¿ç¨‹è¯·æ±‚çš„ä¿¡æ¯åˆ†æ‰¹è¯»å–æŒ‡å®šbinlogæ—¥å¿—æ–‡ä»¶æŒ‡å®šä½ç½®ä¹‹åçš„binlogæ—¥å¿—ä¿¡æ¯ï¼Œç„¶åè¿”å›ç»™Slaveç«¯çš„IOçº¿ç¨‹ã€‚è¿”å›çš„ä¿¡æ¯ä¸­é™¤äº†binlogæ—¥å¿—å†…å®¹å¤–ï¼Œè¿˜æœ‰åœ¨masteræœåŠ¡å™¨ç«¯è®°å½•çš„æ–°çš„binlogæ–‡ä»¶åç§°ï¼Œä»¥åŠåœ¨æ–°çš„binlogä¸­çš„ä¸‹ä¸€ä¸ªæŒ‡å®šæ›´æ–°ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;å½“SlaveæœåŠ¡å™¨çš„IOçº¿ç¨‹è·å–åˆ°MasteræœåŠ¡å™¨ä¸ŠIOçº¿ç¨‹å‘é€çš„æ—¥å¿—å†…å®¹ã€æ—¥å¿—æ–‡ä»¶åŠä½ç½®ç‚¹åï¼Œä¼šå°†binlogæ—¥å¿—å†…å®¹ä¾æ¬¡å†™åˆ°Slaveç«¯è‡ªèº«çš„Relay Logï¼ˆå³ä¸­ç»§æ—¥å¿—ï¼‰æ–‡ä»¶ï¼ˆMySQL-relay-bin.xxxï¼‰çš„æœ€æœ«ç«¯ï¼Œå¹¶å°†æ–°çš„binlogæ–‡ä»¶åå’Œä½ç½®è®°å½•åˆ°master-infoæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡è¯»å–masterç«¯æ–°binlogæ—¥å¿—æ—¶èƒ½å‘Šè¯‰MasteræœåŠ¡å™¨ä»æ–°binlogæ—¥å¿—çš„æŒ‡å®šæ–‡ä»¶åŠä½ç½®å¼€å§‹è¯»å–æ–°çš„binlogæ—¥å¿—å†…å®¹&lt;/li&gt;
&lt;li&gt;SlaveæœåŠ¡å™¨ç«¯çš„SQLçº¿ç¨‹ä¼šå®æ—¶æ£€æµ‹æœ¬åœ°Relay Log ä¸­IOçº¿ç¨‹æ–°å¢çš„æ—¥å¿—å†…å®¹ï¼Œç„¶ååŠæ—¶æŠŠRelay LOG æ–‡ä»¶ä¸­çš„å†…å®¹è§£ææˆsqlè¯­å¥ï¼Œå¹¶åœ¨è‡ªèº«SlaveæœåŠ¡å™¨ä¸ŠæŒ‰è§£æSQLè¯­å¥çš„ä½ç½®é¡ºåºæ‰§è¡Œåº”ç”¨è¿™æ ·sqlè¯­å¥ï¼Œå¹¶åœ¨relay-log.infoä¸­è®°å½•å½“å‰åº”ç”¨ä¸­ç»§æ—¥å¿—çš„æ–‡ä»¶åå’Œä½ç½®ç‚¹&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸»ä»å»¶è¿Ÿçš„é—®é¢˜å’Œè§£å†³åŠæ³•&#34;&gt;ä¸»ä»å»¶è¿Ÿçš„é—®é¢˜å’Œè§£å†³åŠæ³• &lt;a href=&#34;#%e4%b8%bb%e4%bb%8e%e5%bb%b6%e8%bf%9f%e7%9a%84%e9%97%ae%e9%a2%98%e5%92%8c%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ä¸»ä»åŒæ­¥çš„å»¶è¿Ÿçš„åŸå› ï¼šæˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªæœåŠ¡å™¨å¼€æ”¾ï¼®ä¸ªé“¾æ¥ç»™å®¢æˆ·ç«¯æ¥è¿æ¥çš„ï¼Œã€€è¿™æ ·æœ‰ä¼šæœ‰å¤§å¹¶å‘çš„æ›´æ–°æ“ä½œ, ä½†æ˜¯ä»æœåŠ¡å™¨çš„é‡Œé¢è¯»å–binlog çš„çº¿ç¨‹ä»…æœ‰ä¸€ä¸ªï¼Œ å½“æŸä¸ªSQLåœ¨ä»æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„æ—¶é—´ç¨é•¿ æˆ–è€…ç”±äºæŸä¸ªSQLè¦è¿›è¡Œé”è¡¨å°±ä¼šå¯¼è‡´ï¼Œä¸»æœåŠ¡å™¨çš„SQLå¤§é‡ç§¯å‹ï¼Œæœªè¢«åŒæ­¥åˆ°ä»æœåŠ¡å™¨é‡Œã€‚è¿™å°±å¯¼è‡´äº†ä¸»ä»ä¸ä¸€è‡´ï¼Œ ä¹Ÿå°±æ˜¯ä¸»ä»å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³åŠæ³•ï¼š
1ï¼‰å®é™…ä¸Šä¸»ä»åŒæ­¥å»¶è¿Ÿæ ¹æœ¬æ²¡æœ‰ä»€ä¹ˆä¸€æ‹›åˆ¶æ•Œçš„åŠæ³•ï¼Œå› ä¸ºæ‰€æœ‰çš„SQLå¿…é¡»éƒ½è¦åœ¨ä»æœåŠ¡å™¨é‡Œé¢æ‰§è¡Œä¸€éï¼Œä½†æ˜¯ä¸»æœåŠ¡å™¨å¦‚æœä¸æ–­çš„æœ‰æ›´æ–°æ“ä½œæºæºä¸æ–­çš„å†™å…¥ï¼Œé‚£ä¹ˆä¸€æ—¦æœ‰å»¶è¿Ÿäº§ç”Ÿï¼Œé‚£ä¹ˆå»¶è¿ŸåŠ é‡çš„å¯èƒ½æ€§å°±ä¼šåŸæ¥è¶Šå¤§ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥åšä¸€äº›ç¼“è§£çš„æªæ–½ã€‚
2ï¼‰æˆ‘ä»¬çŸ¥é“å› ä¸ºä¸»æœåŠ¡å™¨è¦è´Ÿè´£æ›´æ–°æ“ä½œï¼Œä»–å¯¹å®‰å…¨æ€§çš„è¦æ±‚æ¯”ä»æœåŠ¡å™¨é«˜ï¼Œæ‰€æœ‰æœ‰äº›è®¾ç½®å¯ä»¥ä¿®æ”¹ï¼Œæ¯”å¦‚sync_binlog=1ï¼Œinnodb_flush_log_at_trx_commit=1ä¹‹ç±»çš„è®¾ç½®ï¼Œè€Œslaveåˆ™ä¸éœ€è¦è¿™ä¹ˆé«˜çš„æ•°æ®å®‰å…¨ï¼Œå®Œå…¨å¯ä»¥è®²sync_binlogè®¾ç½®ä¸º0æˆ–è€…å…³é—­binlogï¼Œinnodb_flushlogï¼Œinnodb_flush_log_at_trx_commitä¹Ÿå¯ä»¥è®¾ç½®ä¸º0æ¥æé«˜sqlçš„æ‰§è¡Œæ•ˆç‡è¿™ä¸ªèƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜æ•ˆç‡ã€‚å¦å¤–å°±æ˜¯ä½¿ç”¨æ¯”ä¸»åº“æ›´å¥½çš„ç¡¬ä»¶è®¾å¤‡ä½œä¸ºslaveã€‚
3ï¼‰å°±æ˜¯æŠŠï¼Œä¸€å°ä»æœåŠ¡å™¨å½“åº¦ä½œä¸ºå¤‡ä»½ä½¿ç”¨ï¼Œè€Œä¸æä¾›æŸ¥è¯¢ï¼Œé‚£è¾¹ä»–çš„è´Ÿè½½ä¸‹æ¥äº†ï¼Œæ‰§è¡Œrelaylogé‡Œé¢çš„SQLæ•ˆç‡è‡ªç„¶å°±é«˜äº†ã€‚
4ï¼‰å¢åŠ ä»æœåŠ¡å™¨å–½ï¼Œè¿™ä¸ªç›®çš„è¿˜æ˜¯åˆ†æ•£è¯»çš„å‹åŠ›ï¼Œä»è€Œé™ä½æœåŠ¡å™¨è´Ÿè½½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å‹åŠ›æµ‹è¯•&#34;&gt;å‹åŠ›æµ‹è¯• &lt;a href=&#34;#%e5%8e%8b%e5%8a%9b%e6%b5%8b%e8%af%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://imysql.com/tag/%E5%8E%8B%E6%B5%8B&#34;&gt;https://imysql.com/tag/%E5%8E%8B%E6%B5%8B&lt;/a&gt;
æ¯”è¾ƒå¸¸ç”¨çš„MySQLåŸºå‡†å‹åŠ›æµ‹è¯•å·¥å…·æœ‰ tpcc-mysqlã€sysbenchã€mysqlslap ç­‰å‡ ä¸ªã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-q.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;å»¶ä¼¸çŸ¥è¯†ç‚¹&#34;&gt;å»¶ä¼¸çŸ¥è¯†ç‚¹ &lt;a href=&#34;#%e5%bb%b6%e4%bc%b8%e7%9f%a5%e8%af%86%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;mysql-countæ€»ç»“&#34;&gt;MYSQL countæ€»ç»“ &lt;a href=&#34;#mysql-count%e6%80%bb%e7%bb%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;COUNTæœ‰å‡ ç§ç”¨æ³•ï¼Ÿcount(*),count(å¸¸æ•°)ï¼Œcount(åˆ—å)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;COUNT(å­—æ®µå)å’ŒCOUNT(&lt;em&gt;)çš„æŸ¥è¯¢ç»“æœæœ‰ä»€ä¹ˆä¸åŒï¼Ÿä¸ºä»€ä¹ˆã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹å»ºè®®ä½¿ç”¨COUNT(&lt;/em&gt;)
count(&lt;em&gt;)æ˜¯SQL92å®šä¹‰çš„æ ‡å‡†è¯­æ³•ï¼Œcount(&lt;/em&gt;)ä¼šç»Ÿè®¡å€¼ä¸ºnullçš„è¡Œï¼Œcount(åˆ—æ˜)ä¸ä¼šç»Ÿè®¡æ”¹åˆ—ä¸ºnullçš„è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;COUNT(1)å’ŒCOUNT(&lt;em&gt;)ã€count(åˆ—å)ä¹‹é—´æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
COUNT(å¸¸é‡) å’Œ COUNT(&lt;/em&gt;)è¡¨ç¤ºçš„æ˜¯ç›´æ¥æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ•°æ®åº“è¡¨çš„è¡Œæ•°ã€‚è€ŒCOUNT(åˆ—å)è¡¨ç¤ºçš„æ˜¯æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„åˆ—çš„å€¼ä¸ä¸ºNULLçš„è¡Œæ•°ã€‚
é™¤äº†æŸ¥è¯¢å¾—åˆ°ç»“æœé›†æœ‰åŒºåˆ«ä¹‹å¤–ï¼ŒCOUNT(&lt;em&gt;)ç›¸æ¯”COUNT(å¸¸é‡) å’Œ COUNT(åˆ—å)æ¥è®²ï¼ŒCOUNT(&lt;/em&gt;)æ˜¯SQL92å®šä¹‰çš„æ ‡å‡†ç»Ÿè®¡è¡Œæ•°çš„è¯­æ³•ï¼Œå› ä¸ºä»–æ˜¯æ ‡å‡†è¯­æ³•ï¼Œæ‰€ä»¥MySQLæ•°æ®åº“å¯¹ä»–è¿›è¡Œè¿‡å¾ˆå¤šä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;COUNT(1)å’ŒCOUNT(*)ä¹‹é—´çš„æ•ˆç‡å“ªä¸ªæ›´é«˜ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;InnoDB handles SELECT COUNT(*) and SELECT COUNT(1) operations in the same way. There is no performance difference.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç”»é‡ç‚¹ï¼šsame way , no performance differenceã€‚æ‰€ä»¥ï¼Œå¯¹äºCOUNT(1)å’ŒCOUNT(*)ï¼ŒMySQLçš„ä¼˜åŒ–æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œæ ¹æœ¬ä¸å­˜åœ¨è°æ¯”è°å¿«!&lt;/strong&gt;
å»ºè®®ä½¿ç”¨COUNT(*)ï¼å› ä¸ºè¿™ä¸ªæ˜¯SQL92å®šä¹‰çš„æ ‡å‡†ç»Ÿè®¡è¡Œæ•°çš„è¯­æ³•ï¼Œè€Œä¸”æœ¬æ–‡åªæ˜¯åŸºäºMySQLåšäº†åˆ†æï¼Œå…³äºOracleä¸­çš„è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯ä¼—è¯´çº·çº­çš„å‘¢ã€‚&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;
&lt;p&gt;MySQLçš„MyISAMå¼•æ“å¯¹COUNT(&lt;em&gt;)åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ
å› ä¸ºMyISAMçš„é”æ˜¯è¡¨çº§é”ï¼Œæ‰€ä»¥åŒä¸€å¼ è¡¨ä¸Šé¢çš„æ“ä½œéœ€è¦ä¸²è¡Œè¿›è¡Œï¼Œæ‰€ä»¥ï¼ŒMyISAMåšäº†ä¸€ä¸ªç®€å•çš„ä¼˜åŒ–ï¼Œé‚£å°±æ˜¯å®ƒå¯ä»¥æŠŠè¡¨çš„æ€»è¡Œæ•°å•ç‹¬è®°å½•ä¸‹æ¥ï¼Œå¦‚æœä»ä¸€å¼ è¡¨ä¸­ä½¿ç”¨COUNT(&lt;/em&gt;)è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥è¿”å›è¿™ä¸ªè®°å½•ä¸‹æ¥çš„æ•°å€¼å°±å¯ä»¥äº†ï¼Œå½“ç„¶ï¼Œå‰ææ˜¯ä¸èƒ½æœ‰whereæ¡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MySQLçš„InnoDBå¼•æ“å¯¹COUNT(&lt;em&gt;)åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ
åœ¨InnoDBä¸­ï¼Œä½¿ç”¨COUNT(&lt;/em&gt;)æŸ¥è¯¢è¡Œæ•°çš„æ—¶å€™ï¼Œä¸å¯é¿å…çš„è¦è¿›è¡Œæ‰«è¡¨äº†ï¼Œé‚£ä¹ˆï¼Œå°±å¯ä»¥åœ¨æ‰«è¡¨è¿‡ç¨‹ä¸­ä¸‹åŠŸå¤«æ¥ä¼˜åŒ–æ•ˆç‡äº†ã€‚
ä»MySQL 8.0.13å¼€å§‹ï¼Œé’ˆå¯¹InnoDBçš„SELECT COUNT(&lt;em&gt;) FROM tbl_nameè¯­å¥ï¼Œç¡®å®åœ¨æ‰«è¡¨çš„è¿‡ç¨‹ä¸­åšäº†ä¸€äº›ä¼˜åŒ–ã€‚å‰ææ˜¯æŸ¥è¯¢è¯­å¥ä¸­ä¸åŒ…å«WHEREæˆ–GROUP BYç­‰æ¡ä»¶ã€‚
æˆ‘ä»¬çŸ¥é“ï¼ŒCOUNT(&lt;/em&gt;)çš„ç›®çš„åªæ˜¯ä¸ºäº†ç»Ÿè®¡æ€»è¡Œæ•°ï¼Œæ‰€ä»¥ï¼Œä»–æ ¹æœ¬ä¸å…³å¿ƒè‡ªå·±æŸ¥åˆ°çš„å…·ä½“å€¼ï¼Œæ‰€ä»¥ï¼Œä»–å¦‚æœèƒ½å¤Ÿåœ¨æ‰«è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæˆæœ¬è¾ƒä½çš„ç´¢å¼•è¿›è¡Œçš„è¯ï¼Œé‚£å°±å¯ä»¥å¤§å¤§èŠ‚çœæ—¶é—´ã€‚
æˆ‘ä»¬çŸ¥é“ï¼ŒInnoDBä¸­ç´¢å¼•åˆ†ä¸ºèšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰å’Œéèšç°‡ç´¢å¼•ï¼ˆéä¸»é”®ç´¢å¼•ï¼‰ï¼Œèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜çš„æ˜¯æ•´è¡Œè®°å½•ï¼Œè€Œéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜çš„æ˜¯è¯¥è¡Œè®°å½•çš„ä¸»é”®çš„å€¼ã€‚
æ‰€ä»¥ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œéèšç°‡ç´¢å¼•è¦æ¯”èšç°‡ç´¢å¼•å°å¾ˆå¤šï¼Œæ‰€ä»¥MySQLä¼šä¼˜å…ˆé€‰æ‹©æœ€å°çš„éèšç°‡ç´¢å¼•æ¥æ‰«è¡¨ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å»ºè¡¨çš„æ—¶å€™ï¼Œé™¤äº†ä¸»é”®ç´¢å¼•ä»¥å¤–ï¼Œåˆ›å»ºä¸€ä¸ªéä¸»é”®ç´¢å¼•è¿˜æ˜¯æœ‰å¿…è¦çš„ã€‚
è‡³æ­¤ï¼Œæˆ‘ä»¬ä»‹ç»å®Œäº†MySQLæ•°æ®åº“å¯¹äºCOUNT(*)çš„ä¼˜åŒ–ï¼Œè¿™äº›ä¼˜åŒ–çš„å‰æéƒ½æ˜¯æŸ¥è¯¢è¯­å¥ä¸­ä¸åŒ…å«WHEREä»¥åŠGROUP BYæ¡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šé¢æåˆ°çš„MySQLå¯¹COUNT(*)åšçš„ä¼˜åŒ–ï¼Œæœ‰ä¸€ä¸ªå…³é”®çš„å‰ææ˜¯ä»€ä¹ˆï¼Ÿ
æ— whereæ¡ä»¶æˆ–è€…group byç­‰æ¡ä»¶&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯å±€éƒ¨æ€§åŸç†&#34;&gt;ä»€ä¹ˆæ˜¯å±€éƒ¨æ€§åŸç†ï¼Ÿ &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e5%b1%80%e9%83%a8%e6%80%a7%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å±€éƒ¨æ€§åŸç†çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å†…å­˜è¯»å†™å—ï¼Œç£ç›˜è¯»å†™æ…¢ï¼Œè€Œä¸”æ…¢å¾ˆå¤šï¼›&lt;/li&gt;
&lt;li&gt;ç£ç›˜é¢„è¯»ï¼šç£ç›˜è¯»å†™å¹¶ä¸æ˜¯æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æŒ‰é¡µé¢„è¯»ï¼Œä¸€æ¬¡ä¼šè¯»ä¸€é¡µçš„æ•°æ®ï¼Œæ¯æ¬¡åŠ è½½æ›´å¤šçš„æ•°æ®ï¼Œå¦‚æœæœªæ¥è¦è¯»å–çš„æ•°æ®å°±åœ¨è¿™ä¸€é¡µä¸­ï¼Œå¯ä»¥é¿å…æœªæ¥çš„ç£ç›˜IOï¼Œæé«˜æ•ˆç‡ï¼›ï¼ˆé€šå¸¸ï¼Œä¸€é¡µæ•°æ®æ˜¯4Kï¼‰&lt;/li&gt;
&lt;li&gt;å±€éƒ¨æ€§åŸç†ï¼šè½¯ä»¶è®¾è®¡è¦å°½é‡éµå¾ªâ€œæ•°æ®è¯»å–é›†ä¸­â€ä¸â€œä½¿ç”¨åˆ°ä¸€ä¸ªæ•°æ®ï¼Œå¤§æ¦‚ç‡ä¼šä½¿ç”¨å…¶é™„è¿‘çš„æ•°æ®â€ï¼Œè¿™æ ·ç£ç›˜é¢„è¯»èƒ½å……åˆ†æé«˜ç£ç›˜IOï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;bæ ‘ä¸ºä½•é€‚åˆåšç´¢å¼•&#34;&gt;Bæ ‘ä¸ºä½•é€‚åˆåšç´¢å¼•ï¼Ÿ &lt;a href=&#34;#b%e6%a0%91%e4%b8%ba%e4%bd%95%e9%80%82%e5%90%88%e5%81%9a%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ç”±äºæ˜¯måˆ†å‰çš„ï¼Œé«˜åº¦èƒ½å¤Ÿå¤§å¤§é™ä½ï¼›&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨jä¸ªè®°å½•ï¼Œå¦‚æœå°†èŠ‚ç‚¹å¤§å°è®¾ç½®ä¸ºé¡µå¤§å°ï¼Œä¾‹å¦‚4Kï¼Œèƒ½å¤Ÿå……åˆ†çš„åˆ©ç”¨é¢„è¯»çš„ç‰¹æ€§ï¼Œæå¤§å‡å°‘ç£ç›˜IOï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;bæ ‘&#34;&gt;B+æ ‘ &lt;a href=&#34;#b%e6%a0%91&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-r.jpeg&#34; alt=&#34;&#34;&gt;
Bæ ‘çš„æ’å…¥åŠå¹³è¡¡åŒ–æ“ä½œå’Œ2-3æ ‘å¾ˆç›¸ä¼¼ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚ä¸‹é¢æ˜¯å¾€Bæ ‘ä¸­ä¾æ¬¡æ’å…¥
&lt;code&gt;6 10 4 14 5 11 15 3 2 12 1 7 8 8 6 3 6 21 5 15 15 6 32 23 45 65 7 8 6 5 4&lt;/code&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-s.gif&#34; alt=&#34;&#34;&gt;
B+æ ‘ï¼Œå¦‚ä¸Šå›¾ï¼Œä»æ˜¯må‰æœç´¢æ ‘ï¼Œåœ¨Bæ ‘çš„åŸºç¡€ä¸Šï¼Œåšäº†ä¸€äº›æ”¹è¿›ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éå¶å­èŠ‚ç‚¹ä¸å†å­˜å‚¨æ•°æ®ï¼Œæ•°æ®åªå­˜å‚¨åœ¨åŒä¸€å±‚çš„å¶å­èŠ‚ç‚¹ä¸Šï¼›ï¼ˆç”»å¤–éŸ³ï¼šB+æ ‘ä¸­æ ¹åˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„è·¯å¾„é•¿åº¦ä¸€æ ·ï¼Œè€ŒBæ ‘ä¸æ˜¯è¿™æ ·ã€‚ï¼‰&lt;/li&gt;
&lt;li&gt;å¶å­ä¹‹é—´ï¼Œå¢åŠ äº†é“¾è¡¨ï¼Œè·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¸å†éœ€è¦ä¸­åºéå†ï¼›
è¿™äº›æ”¹è¿›è®©B+æ ‘æ¯”Bæ ‘æœ‰æ›´ä¼˜çš„ç‰¹æ€§ï¼š&lt;/li&gt;
&lt;li&gt;èŒƒå›´æŸ¥æ‰¾ï¼Œå®šä½minä¸maxä¹‹åï¼Œä¸­é—´å¶å­èŠ‚ç‚¹ï¼Œå°±æ˜¯ç»“æœé›†ï¼Œä¸ç”¨ä¸­åºå›æº¯ï¼›ï¼ˆç”»å¤–éŸ³ï¼šèŒƒå›´æŸ¥è¯¢åœ¨SQLä¸­ç”¨å¾—å¾ˆå¤šï¼Œè¿™æ˜¯B+æ ‘æ¯”Bæ ‘æœ€å¤§çš„ä¼˜åŠ¿ã€‚ï¼‰&lt;/li&gt;
&lt;li&gt;å¶å­èŠ‚ç‚¹å­˜å‚¨å®é™…è®°å½•è¡Œï¼Œè®°å½•è¡Œç›¸å¯¹æ¯”è¾ƒç´§å¯†çš„å­˜å‚¨ï¼Œé€‚åˆå¤§æ•°æ®é‡&lt;font color=red&gt;ç£ç›˜å­˜å‚¨&lt;/font&gt;ï¼›éå¶å­èŠ‚ç‚¹å­˜å‚¨è®°å½•çš„PKï¼Œç”¨äºæŸ¥è¯¢åŠ é€Ÿï¼Œé€‚åˆ&lt;font color=red&gt;å†…å­˜å­˜å‚¨&lt;/font&gt;ï¼›&lt;/li&gt;
&lt;li&gt;éå¶å­èŠ‚ç‚¹ï¼Œä¸å­˜å‚¨å®é™…è®°å½•ï¼Œè€Œåªå­˜å‚¨è®°å½•çš„KEYçš„è¯ï¼Œé‚£ä¹ˆåœ¨ç›¸åŒå†…å­˜çš„æƒ…å†µä¸‹ï¼ŒB+æ ‘èƒ½å¤Ÿå­˜å‚¨æ›´å¤šç´¢å¼•ï¼›
æœ€åï¼Œé‡åŒ–è¯´ä¸‹ï¼Œä¸ºä»€ä¹ˆmå‰çš„B+æ ‘æ¯”äºŒå‰æœç´¢æ ‘çš„é«˜åº¦å¤§å¤§å¤§å¤§é™ä½ï¼Ÿ
å¤§æ¦‚è®¡ç®—ä¸€ä¸‹ï¼š
(1)å±€éƒ¨æ€§åŸç†ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºä¸€é¡µï¼Œä¸€é¡µ4Kï¼Œå‡è®¾ä¸€ä¸ªKEYæœ‰8å­—èŠ‚ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨500ä¸ªKEYï¼Œå³j=500
(2)må‰æ ‘ï¼Œå¤§æ¦‚m/2&amp;lt;= j &amp;lt;=mï¼Œå³å¯ä»¥å·®ä¸å¤šæ˜¯1000å‰æ ‘
(3)é‚£ä¹ˆï¼š
ä¸€å±‚æ ‘ï¼š1ä¸ªèŠ‚ç‚¹ï¼Œ1&lt;em&gt;500ä¸ªKEYï¼Œå¤§å°4K
äºŒå±‚æ ‘ï¼š1000ä¸ªèŠ‚ç‚¹ï¼Œ1000&lt;/em&gt;500=50Wä¸ªKEYï¼Œå¤§å°1000&lt;em&gt;4K=4M
ä¸‰å±‚æ ‘ï¼š1000&lt;/em&gt;1000ä¸ªèŠ‚ç‚¹ï¼Œ1000&lt;em&gt;1000&lt;/em&gt;500=5äº¿ä¸ªKEYï¼Œå¤§å°1000&lt;em&gt;1000&lt;/em&gt;4K=4G
å¯ä»¥çœ‹åˆ°ï¼Œå­˜å‚¨å¤§é‡çš„æ•°æ®ï¼ˆ5äº¿ï¼‰ï¼Œå¹¶ä¸éœ€è¦å¤ªé«˜æ ‘çš„æ·±åº¦ï¼ˆé«˜åº¦3ï¼‰ï¼Œç´¢å¼•ä¹Ÿä¸æ˜¯å¤ªå å†…å­˜ï¼ˆ4Gï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>redisæ€»ç»“</title>
      <link>https://abnerxc.github.io/note/redis-%E6%80%BB%E7%BB%93/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/redis-%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;h1 id=&#34;redisä¸ºä»€ä¹ˆé‚£ä¹ˆå¿«&#34;&gt;Redisä¸ºä»€ä¹ˆé‚£ä¹ˆå¿« &lt;a href=&#34;#redis%e4%b8%ba%e4%bb%80%e4%b9%88%e9%82%a3%e4%b9%88%e5%bf%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;çº¯å†…å­˜æ“ä½œ&lt;/li&gt;
&lt;li&gt;å•çº¿ç¨‹æ“ä½œï¼Œé¿å…äº†é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨äº†éé˜»å¡I/Oå¤šè·¯å¤ç”¨æœºåˆ¶
æˆ‘ä»¬çš„redis-clientåœ¨æ“ä½œçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿå…·æœ‰ä¸åŒäº‹ä»¶ç±»å‹çš„socketã€‚åœ¨æœåŠ¡ç«¯ï¼Œæœ‰ä¸€æ®µI/0å¤šè·¯å¤ç”¨ç¨‹åºï¼Œå°†å…¶ç½®å…¥é˜Ÿåˆ—ä¹‹ä¸­ã€‚ç„¶åï¼Œæ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼Œä¾æ¬¡å»é˜Ÿåˆ—ä¸­å–ï¼Œè½¬å‘åˆ°ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;redisæ•°æ®ç±»å‹&#34;&gt;Redisæ•°æ®ç±»å‹ &lt;a href=&#34;#redis%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;String,Hash,List,Set,SortedSet&lt;/li&gt;
&lt;li&gt;Pub/Sub&lt;/li&gt;
&lt;li&gt;HyperLogLog(2.8.9ç‰ˆæœ¬æ–°å¢):ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®š çš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚ä½¿ç”¨åœºæ™¯æœ€å¸¸è§çš„å°±æ˜¯è®¡ç®—ç½‘ç«™UVç­‰ï¼Œå¯¹æ•°æ®ç²¾åº¦è¦æ±‚ä¸é«˜&lt;/li&gt;
&lt;li&gt;Geoï¼ˆ3.2ç‰ˆæœ¬æ–°å¢ï¼‰ï¼šGEO(åœ°ç†ä½ç½®)çš„æ”¯æŒï¼Œä¸»è¦æ˜¯å¯¹ç»çº¬åº¦ä¸€ä¸ªä½ç½®è®¡ç®—ç­‰ç‰¹æ€§&lt;/li&gt;
&lt;li&gt;BitMap&lt;/li&gt;
&lt;li&gt;BloomFilter
&lt;img src=&#34;https://abnerxc.github.io/img/redis-i.jpeg&#34; alt=&#34;data-struct&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/redis-j.jpeg&#34; alt=&#34;data-struct&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;redisçš„è¿‡æœŸç­–ç•¥ä»¥åŠå†…å­˜æ·˜æ±°æœºåˆ¶&#34;&gt;Redisçš„è¿‡æœŸç­–ç•¥ä»¥åŠå†…å­˜æ·˜æ±°æœºåˆ¶ &lt;a href=&#34;#redis%e7%9a%84%e8%bf%87%e6%9c%9f%e7%ad%96%e7%95%a5%e4%bb%a5%e5%8f%8a%e5%86%85%e5%ad%98%e6%b7%98%e6%b1%b0%e6%9c%ba%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ä¸‰ç§è¿‡æœŸç­–ç•¥&#34;&gt;ä¸‰ç§è¿‡æœŸç­–ç•¥ &lt;a href=&#34;#%e4%b8%89%e7%a7%8d%e8%bf%87%e6%9c%9f%e7%ad%96%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å®šæ—¶åˆ é™¤ï¼šåœ¨è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´çš„åŒæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨(timer)ï¼Œè®©å®šæ—¶å™¨åœ¨é”®çš„è¿‡æœŸæ—¶é—´æ¥ä¸´æ—¶ï¼Œç«‹å³æ‰§è¡Œå¯¹é”®çš„åˆ é™¤æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;æƒ°æ€§åˆ é™¤ï¼šæ”¾ä»»é”®è¿‡æœŸä¸ç®¡ï¼Œä½†æ˜¯æ¯æ¬¡ä»é”®ç©ºé—´ä¸­è·å–é”®æ—¶ï¼Œéƒ½æ£€æŸ¥å–å¾—çš„é”®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸçš„è¯ï¼Œå°±åˆ é™¤è¯¥é”®ï¼›å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œé‚£å°±è¿”å›è¯¥é”®ï¼›&lt;/li&gt;
&lt;li&gt;å®šæœŸåˆ é™¤ï¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œç¨‹åºå°±å¯¹æ•°æ®åº“è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œåˆ é™¤é‡Œé¢çš„è¿‡æœŸé”®ã€‚è‡³äºåˆ é™¤å¤šå°‘è¿‡æœŸé”®ï¼Œä»¥åŠè¦æ£€æŸ¥å¤šå°‘ä¸ªæ•°æ®åº“ï¼Œåˆ™ç”±ç®—æ³•å†³å®šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redisé‡‡ç”¨çš„æ˜¯å®šæœŸåˆ é™¤+æƒ°æ€§åˆ ç­–ç•¥ã€‚&lt;br&gt;
ä¸ºä»€ä¹ˆä¸ç”¨å®šæ—¶åˆ é™¤ç­–ç•¥ï¼Ÿå®šæ—¶åˆ é™¤ç­–ç•¥éœ€è¦å®šæ—¶å™¨æ¥ç›‘è§†keyï¼Œè¿‡æœŸåˆ™è‡ªåŠ¨åˆ é™¤ã€‚è™½ç„¶å†…å­˜åŠæ—¶é‡Šæ”¾äº†ï¼Œä½†æ˜¯CPUæ¶ˆè€—å¤§ã€‚åœ¨å¤§å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸€ç­–ç•¥å¾—ä¸å¿å¤±&lt;/p&gt;
&lt;p&gt;Redisé‡‡ç”¨çš„æ˜¯å®šæœŸåˆ é™¤+æƒ°æ€§åˆ ç­–ç•¥å·¥ä½œæœºåˆ¶ã€‚&lt;br&gt;
å®šæœŸåˆ é™¤ï¼Œredisé»˜è®¤æ¯100msæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦å­˜åœ¨è¿‡æœŸkeyï¼Œæœ‰åˆ™åˆ é™¤ã€‚éœ€è¦è¯´æ˜çš„æ˜¯rediså¹¶ä¸æ˜¯100msæ£€æŸ¥æ‰€æœ‰çš„keyä¸€æ¬¡ï¼Œè€Œæ˜¯éšæœºè¿›è¡ŒæŠ½å–æ£€æŸ¥ã€‚å› æ­¤ï¼Œæƒ°æ€§åˆ é™¤æ´¾ä¸Šç”¨å¤„ã€‚
æƒ°æ€§åˆ ç­–ç•¥å»¶ä¼¸å‡ºæ¥çš„é—®é¢˜å°±æ˜¯ï¼Œredisç¼“å­˜æ·˜æ±°æœºåˆ¶&lt;/p&gt;
&lt;h2 id=&#34;redis30ç‰ˆæœ¬6ç§ç¼“å­˜æ·˜æ±°æœºåˆ¶&#34;&gt;Redis(3.0ç‰ˆæœ¬)6ç§ç¼“å­˜æ·˜æ±°æœºåˆ¶ &lt;a href=&#34;#redis30%e7%89%88%e6%9c%ac6%e7%a7%8d%e7%bc%93%e5%ad%98%e6%b7%98%e6%b1%b0%e6%9c%ba%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;1.  no-enviction(é©±é€)ï¼šç¦æ­¢é©±é€æ•°æ®ï¼ˆä¸åˆ é™¤æ•°æ®ç­–ç•¥ï¼Œè¾¾åˆ°æœ€å¤§çš„å†…å­˜é™åˆ¶æ—¶ï¼Œå¦‚æœæœ‰æ›´å¤šçš„æ•°æ®å†™å…¥ï¼Œè¿”å›é”™è¯¯ç»™å®¢æˆ·ç«¯ï¼‰
2.  allkeys-lruï¼šæ‰€æœ‰keyé€šç”¨ï¼Œä¼˜å…ˆåˆ é™¤æœ€å°‘ä½¿ç”¨çš„keyï¼ˆless recently used,LRUç®—æ³•ï¼‰
3.  allkeys-random ï¼šæ‰€æœ‰keyé€šç”¨ï¼Œéšæœºåˆ é™¤ä¸€éƒ¨åˆ†key
4.  volatile-lruï¼šåªé™äºè®¾ç½®äº†expireçš„éƒ¨åˆ†ï¼Œä¼˜å…ˆåˆ é™¤æœ€å°‘ä½¿ç”¨çš„keyï¼ˆless recently used,LRUç®—æ³•ï¼‰
5.  volatile-randomï¼šåªé™äºè®¾ç½®äº† expire çš„éƒ¨åˆ†; éšæœºåˆ é™¤ä¸€éƒ¨åˆ†key
6.  volatile-ttlï¼šåªé™äºè®¾ç½®äº† expire çš„éƒ¨åˆ†; ä¼˜å…ˆåˆ é™¤å‰©ä½™æ—¶é—´(time to live,TTL) çŸ­çš„keyã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰è®¾ç½® expire çš„key, ä¸æ»¡è¶³å…ˆå†³æ¡ä»¶(prerequisites); é‚£ä¹ˆ volatile-lru, volatile-random å’Œ volatile-ttl ç­–ç•¥çš„è¡Œä¸º, å’Œ noeviction(ä¸åˆ é™¤) åŸºæœ¬ä¸Šä¸€è‡´ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼šå¦‚æœåˆ†ä¸ºçƒ­æ•°æ®ä¸å†·æ•°æ®, æ¨èä½¿ç”¨allkeys-lruç­–ç•¥ã€‚ ä¹Ÿå°±æ˜¯, å…¶ä¸­ä¸€éƒ¨åˆ†keyç»å¸¸è¢«è¯»å†™. å¦‚æœä¸ç¡®å®šå…·ä½“çš„ä¸šåŠ¡ç‰¹å¾, é‚£ä¹ˆallkeys-lruæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ å¦‚æœéœ€è¦å¾ªç¯è¯»å†™æ‰€æœ‰çš„key, æˆ–è€…å„ä¸ªkeyçš„è®¿é—®é¢‘ç‡å·®ä¸å¤š, å¯ä»¥ä½¿ç”¨allkeys-randomç­–ç•¥, å³è¯»å†™æ‰€æœ‰å…ƒç´ çš„æ¦‚ç‡å·®ä¸å¤šã€‚&lt;/p&gt;
&lt;p&gt;å‡å¦‚è¦è®© Redis æ ¹æ® TTL æ¥ç­›é€‰éœ€è¦åˆ é™¤çš„key, è¯·ä½¿ç”¨volatile-ttlç­–ç•¥ã€‚&lt;/p&gt;
&lt;h1 id=&#34;redisæŒä¹…åŒ–åŸç†&#34;&gt;RedisæŒä¹…åŒ–åŸç† &lt;a href=&#34;#redis%e6%8c%81%e4%b9%85%e5%8c%96%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å¿«ç…§ç‰¹ç‚¹bgsaveåšé•œåƒå…¨é‡æŒä¹…åŒ–&#34;&gt;å¿«ç…§ï¼ˆç‰¹ç‚¹ï¼šbgsaveåšé•œåƒå…¨é‡æŒä¹…åŒ–ï¼‰ &lt;a href=&#34;#%e5%bf%ab%e7%85%a7%e7%89%b9%e7%82%b9bgsave%e5%81%9a%e9%95%9c%e5%83%8f%e5%85%a8%e9%87%8f%e6%8c%81%e4%b9%85%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ç¼ºçœæƒ…å†µä¸‹ï¼ŒRedisæŠŠæ•°æ®å¿«ç…§å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶åä¸ºdump.rdbã€‚ä½ å¯ä»¥é…ç½®Redisçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚æ•°æ®é›†ä¸­æ¯Nç§’é’Ÿæœ‰è¶…è¿‡Mæ¬¡æ›´æ–°ï¼Œå°±å°†æ•°æ®å†™å…¥ç£ç›˜ï¼›æˆ–è€…ä½ å¯ä»¥æ‰‹å·¥è°ƒç”¨å‘½ä»¤SAVEæˆ–BGSAVEã€‚
å·¥ä½œåŸç†:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸»è¿›ç¨‹å¼€å¯ä¸€ä¸ª Redis forksï¼ˆå­è¿›ç¨‹ï¼‰.&lt;/li&gt;
&lt;li&gt;å­è¿›ç¨‹å¼€å§‹å°†æ•°æ®å†™åˆ°ä¸´æ—¶RDBæ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å½“å­è¿›ç¨‹å®Œæˆå†™RDBæ–‡ä»¶ï¼Œç”¨æ–°æ–‡ä»¶æ›¿æ¢è€æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;bgsaveçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä½ ç»™å‡ºä¸¤ä¸ªè¯æ±‡å°±å¯ä»¥äº†ï¼Œforkå’Œcowã€‚forkæ˜¯æŒ‡redisé€šè¿‡åˆ›å»ºå­è¿›ç¨‹æ¥è¿›è¡Œbgsaveæ“ä½œï¼ŒcowæŒ‡çš„æ˜¯copy on writeï¼Œå­è¿›ç¨‹åˆ›å»ºåï¼Œçˆ¶å­è¿›ç¨‹å…±äº«æ•°æ®æ®µï¼Œçˆ¶è¿›ç¨‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ï¼Œå†™è„çš„é¡µé¢æ•°æ®ä¼šé€æ¸å’Œå­è¿›ç¨‹åˆ†ç¦»å¼€æ¥ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/redis-k.jpeg&#34; alt=&#34;fork&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;aofç‰¹ç‚¹aofå¢é‡æŒä¹…åŒ–&#34;&gt;AOFï¼ˆç‰¹ç‚¹ï¼šAOFå¢é‡æŒä¹…åŒ–ï¼‰ &lt;a href=&#34;#aof%e7%89%b9%e7%82%b9aof%e5%a2%9e%e9%87%8f%e6%8c%81%e4%b9%85%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;AOFæŒä¹…åŒ–ä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æœåŠ¡å™¨æ‰€å¤„ç†çš„æ¯ä¸€ä¸ªå†™ã€åˆ é™¤æ“ä½œï¼ŒæŸ¥è¯¢æ“ä½œä¸ä¼šè®°å½•ï¼Œä»¥æ–‡æœ¬çš„æ–¹å¼è®°å½•ï¼Œå¯ä»¥æ‰“å¼€æ–‡ä»¶çœ‹åˆ°è¯¦ç»†çš„æ“ä½œè®°å½•ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/redis-l.jpeg&#34; alt=&#34;aof&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;redisä¸»ä»å¤åˆ¶30å¼€å§‹æ”¯æŒåŸç†&#34;&gt;Redisä¸»ä»å¤åˆ¶(3.0å¼€å§‹æ”¯æŒ)åŸç† &lt;a href=&#34;#redis%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b630%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å…¨é‡åŒæ­¥&#34;&gt;å…¨é‡åŒæ­¥ &lt;a href=&#34;#%e5%85%a8%e9%87%8f%e5%90%8c%e6%ad%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;å½“å¯åŠ¨ä¸€ä¸ªslave nodeçš„æ—¶å€™ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªPSYNCå‘½ä»¤ç»™master&lt;/li&gt;
&lt;li&gt;å¦‚æœè¿™æ˜¯slave nodeé‡æ–°é“¾æ¥masterï¼Œmasterä¼šå°†ç¼ºå°‘çš„æ•°æ®å‘é€ç»™slaveï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é“¾æ¥masterï¼Œåˆ™ä¼šè§¦å‘ä¸€æ¬¡full resynchronization,å¼€å§‹ full resynchronizationçš„æ—¶å€™ï¼Œmasterå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå…ˆå°†ç°æœ‰æ•°æ®ç”Ÿæˆä¸€ä¸ªé›¶æ—¶çš„rdbæ–‡ä»¶ï¼Œç”Ÿæˆæ–‡ä»¶åï¼Œmasterä¼šå°†è¿™ä¸ªrdbæ–‡ä»¶å‘é€ç»™slaveï¼Œslaveä¼šå…ˆæŠŠè¿™ä¸ªrdbæ–‡ä»¶å­˜æ”¾åˆ°æœ¬åœ°ç£ç›˜ï¼Œç„¶ååœ¨åŠ è½½åˆ°å†…å­˜ï¼Œç„¶åmasterä¼šå°†ç”Ÿæˆrdbè¿™æ®µæ—¶é—´å†…æ¥æ”¶åˆ°çš„åœ¨å†…å­˜ä¸­çš„æ•°æ®å‘é€ç»™slaveï¼Œslaveä¹Ÿä¼šæ¥æ”¶è¿™ä»½æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;slaveå¦‚æœè·Ÿmasterç½‘ç»œæ•…éšœï¼Œæ–­å¼€äº†ï¼Œå½“é‡æ–°è¿æ¥ä¸Šä»¥åï¼Œmasterå‘ç°æœ‰å¤šä¸ªslaveéƒ½æ¥é‡æ–°è¿æ¥ï¼Œmasterä¼šç”Ÿæˆä¸€ä¸ªrdbæ–‡ä»¶ï¼Œå°†è¿™ä¸ªæ–‡ä»¶åŒæ—¶å‘é€ä¸ªå¤šä¸ªslave node
&lt;img src=&#34;https://abnerxc.github.io/img/redis-m.jpeg&#34; alt=&#34;full_sync&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸»ä»å¤åˆ¶çš„æ–­ç‚¹ç»­ä¼ &#34;&gt;ä¸»ä»å¤åˆ¶çš„æ–­ç‚¹ç»­ä¼  &lt;a href=&#34;#%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e7%9a%84%e6%96%ad%e7%82%b9%e7%bb%ad%e4%bc%a0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;redisä»2.8å¼€å§‹å°±æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼Œå³å½“slaveä¸masteræ–­å¼€åï¼Œé‡æ–°è¿æ¥æ—¶ï¼Œä¼šç»§ç»­ä»ä¸Šä¸€æ¬¡æ–­å¼€çš„ç‚¹ç»§ç»­ä¼ é€æ•°æ®ï¼Œè€Œä¸æ˜¯full resynchronizationã€‚&lt;/li&gt;
&lt;li&gt;masterä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªbacklogï¼Œmasterå’Œslaveéƒ½ä¼šä¿å­˜ä¸€ä¸ªoffset,slaveè¿˜æœ‰ä¸€ä¸ªmaster id,offsetå°±æ˜¯ä¿å­˜åœ¨backlogä¸­çš„ï¼Œå¦‚æœslaveå’Œmasterç½‘ç»œæ–­å¼€ï¼Œé‡æ–°è¿æ¥åslaveä¼šè®©masterä»replica offsetå¼€å§‹ç»­ä¼ ã€‚ä½†æ˜¯å¦‚æœæ²¡æœ‰æ‰¾åˆ°offsetï¼Œåˆ™ä¼šè§¦å‘full resynchronizationã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ— ç£ç›˜åŒ–å¤åˆ¶&#34;&gt;æ— ç£ç›˜åŒ–å¤åˆ¶ &lt;a href=&#34;#%e6%97%a0%e7%a3%81%e7%9b%98%e5%8c%96%e5%a4%8d%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;masteråœ¨å†…å­˜ä¸­ç›´æ¥åˆ›å»ºrdb,ç„¶åç›´æ¥å‘é€ç»™slave,ä¸ä¼šå­˜å…¥æœ¬åœ°ç£ç›˜&lt;/li&gt;
&lt;li&gt;å‚æ•°é…ç½®&lt;br&gt;
repl-diskless-sync&lt;br&gt;
repl-diskless-sync-delay, ç­‰å¾…ä¸€å®šæ—¶é•¿åœ¨å¤åˆ¶ï¼Œå› ä¸ºè¦ç­‰æ›´å¤šçš„slaveé‡æ–°è¿æ¥&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è¿‡æœŸkeyå¤„ç†&#34;&gt;è¿‡æœŸkeyå¤„ç† &lt;a href=&#34;#%e8%bf%87%e6%9c%9fkey%e5%a4%84%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;slaveä¸ä¼šæœ‰è¿‡æœŸKey,åªæœ‰masteræœ‰è¿‡æœŸkey,å¦‚æœmasterè¿‡æœŸäº†ä¸€ä¸ªå¯ä»¥æˆ–è€…é€šè¿‡LRUç®—æ³•æ·˜æ±°äº†ä¸€ä¸ªkeyï¼Œé‚£ä¹ˆmasterä¼šæ¨¡æ‹Ÿå‘é€ä¸€ä¸ªdelå‘½ä»¤ç»™slave&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;redis-clusteré›†ç¾¤&#34;&gt;Redis-Clusteré›†ç¾¤ &lt;a href=&#34;#redis-cluster%e9%9b%86%e7%be%a4&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/redis-n.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´proxyå±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotä¸Šï¼ˆä¸ä¸€å®šæ˜¯å¹³å‡åˆ†é…ï¼‰,cluster è´Ÿè´£ç»´æŠ¤node&amp;lt;-&amp;gt;slot&amp;lt;-&amp;gt;valueã€‚&lt;/li&gt;
&lt;li&gt;Redisé›†ç¾¤é¢„åˆ†å¥½16384ä¸ªæ¡¶ï¼Œå½“éœ€è¦åœ¨ Redis é›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ª key-value æ—¶ï¼Œæ ¹æ® CRC16(key) mod 16384çš„å€¼ï¼Œå†³å®šå°†ä¸€ä¸ªkeyæ”¾åˆ°å“ªä¸ªæ¡¶ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæ˜¯16384ï¼ˆ2^14ï¼‰ä¸ªï¼Ÿ
åœ¨redisèŠ‚ç‚¹å‘é€å¿ƒè·³åŒ…æ—¶éœ€è¦æŠŠæ‰€æœ‰çš„æ§½æ”¾åˆ°è¿™ä¸ªå¿ƒè·³åŒ…é‡Œï¼Œä»¥ä¾¿è®©èŠ‚ç‚¹çŸ¥é“å½“å‰é›†ç¾¤ä¿¡æ¯ï¼Œ16384=16kï¼Œåœ¨å‘é€å¿ƒè·³åŒ…æ—¶ä½¿ç”¨charè¿›è¡Œbitmapå‹ç¼©åæ˜¯2kï¼ˆ2 * 8 (8 bit) * 1024(1k) = 2Kï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨2kçš„ç©ºé—´åˆ›å»ºäº†16kçš„æ§½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ä½¿ç”¨CRC16ç®—æ³•æœ€å¤šå¯ä»¥åˆ†é…65535ï¼ˆ2^16-1ï¼‰ä¸ªæ§½ä½ï¼Œ65535=65kï¼Œå‹ç¼©åå°±æ˜¯8kï¼ˆ8 * 8 (8 bit) * 1024(1k) = 8Kï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦éœ€è¦8kçš„å¿ƒè·³åŒ…ï¼Œä½œè€…è®¤ä¸ºè¿™æ ·åšä¸å¤ªå€¼å¾—ï¼›å¹¶ä¸”ä¸€èˆ¬æƒ…å†µä¸‹ä¸€ä¸ªredisé›†ç¾¤ä¸ä¼šæœ‰è¶…è¿‡1000ä¸ªmasterèŠ‚ç‚¹ï¼Œæ‰€ä»¥16kçš„æ§½ä½æ˜¯ä¸ªæ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h1 id=&#34;rediså“¨å…µ&#34;&gt;Rediså“¨å…µ &lt;a href=&#34;#redis%e5%93%a8%e5%85%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨Server1 æ‰çº¿åï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/redis-p1.jpeg&#34; alt=&#34;&#34;&gt;
å‡çº§Server2 ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/redis-p2.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Sentinelçš„ä½œç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Master çŠ¶æ€ç›‘æµ‹&lt;/li&gt;
&lt;li&gt;å¦‚æœMaster å¼‚å¸¸ï¼Œåˆ™ä¼šè¿›è¡ŒMaster-slave è½¬æ¢ï¼Œå°†å…¶ä¸­ä¸€ä¸ªSlaveä½œä¸ºMasterï¼Œå°†ä¹‹å‰çš„Masterä½œä¸ºSlave&lt;/li&gt;
&lt;li&gt;Master-Slaveåˆ‡æ¢åï¼Œmaster_redis.confã€slave_redis.confå’Œsentinel.confçš„å†…å®¹éƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå³master_redis.confä¸­ä¼šå¤šä¸€è¡Œslaveofçš„é…ç½®ï¼Œsentinel.confçš„ç›‘æ§ç›®æ ‡ä¼šéšä¹‹è°ƒæ¢&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sentinelçš„å·¥ä½œæ–¹å¼:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¯ä¸ªSentinelä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘å®ƒæ‰€çŸ¥çš„Masterï¼ŒSlaveä»¥åŠå…¶ä»– Sentinel å®ä¾‹å‘é€ä¸€ä¸ª PING å‘½ä»¤&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œ åˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinel æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ªMasterè¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ªMasterçš„æ‰€æœ‰ Sentinel è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤Masterçš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤Masterçš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼Œ åˆ™Masterä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿&lt;/li&gt;
&lt;li&gt;åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª Sentinel ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘å®ƒå·²çŸ¥çš„æ‰€æœ‰Masterï¼ŒSlaveå‘é€ INFO å‘½ä»¤&lt;/li&gt;
&lt;li&gt;å½“Masterè¢« Sentinel æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿æ—¶ï¼ŒSentinel å‘ä¸‹çº¿çš„ Master çš„æ‰€æœ‰ Slave å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinel åŒæ„ Master å·²ç»ä¸‹çº¿ï¼Œ Master çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ Master é‡æ–°å‘ Sentinel çš„ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼Œ Master çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;rediså’Œæ•°æ®åº“åŒå†™ä¸€è‡´æ€§é—®é¢˜&#34;&gt;Rediså’Œæ•°æ®åº“åŒå†™ä¸€è‡´æ€§é—®é¢˜ &lt;a href=&#34;#redis%e5%92%8c%e6%95%b0%e6%8d%ae%e5%ba%93%e5%8f%8c%e5%86%99%e4%b8%80%e8%87%b4%e6%80%a7%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä¸€è‡´æ€§é—®é¢˜æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸è§é—®é¢˜ï¼Œå¯ä»¥åˆ†ä¸ºæœ€ç»ˆä¸€è‡´æ€§å’Œå¼ºä¸€è‡´æ€§ã€‚æ‰€ä»¥å¼„æ¸…è¯‰æ±‚
æ•°æ®åº“å¼ºä¸€è‡´æ€§ï¼Œä¸æ”¾ç¼“å­˜ï¼Œæˆ‘ä»¬æ‰€åšçš„ä¸€åˆ‡åªæ˜¯ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¦å¤–æ— æ³•å®Œå…¨é¿å…ï¼Œè®¨è®ºä¸‰ç§æ›´æ–°ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜&lt;/li&gt;
&lt;li&gt;å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“&lt;/li&gt;
&lt;li&gt;å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜&#34;&gt;å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ &lt;a href=&#34;#%e5%85%88%e6%9b%b4%e6%96%b0%e6%95%b0%e6%8d%ae%e5%ba%93%e5%86%8d%e6%9b%b4%e6%96%b0%e7%bc%93%e5%ad%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¿™å¥—æ–¹æ¡ˆï¼Œå¤§å®¶æ˜¯æ™®éåå¯¹çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæœ‰å¦‚ä¸‹ä¸¤ç‚¹åŸå› ï¼š
åŸå› ä¸€ã€çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶æœ‰è¯·æ±‚Aå’Œè¯·æ±‚Bè¿›è¡Œæ›´æ–°æ“ä½œï¼Œé‚£ä¹ˆä¼šå‡ºç°ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;çº¿ç¨‹Aæ›´æ–°äº†æ•°æ®åº“
çº¿ç¨‹Bæ›´æ–°äº†æ•°æ®åº“
çº¿ç¨‹Bæ›´æ–°äº†ç¼“å­˜
çº¿ç¨‹Aæ›´æ–°äº†ç¼“å­˜
è¿™å°±å‡ºç°è¯·æ±‚Aæ›´æ–°ç¼“å­˜åº”è¯¥æ¯”è¯·æ±‚Bæ›´æ–°ç¼“å­˜æ—©æ‰å¯¹ï¼Œä½†æ˜¯å› ä¸ºç½‘ç»œç­‰åŸå› ï¼ŒBæ¯”Aæ›´æ—©æ›´æ–°äº†ç¼“å­˜ã€‚è¿™å°±å¯¼è‡´äº†è„æ•°æ®ï¼Œå› æ­¤ä¸è€ƒè™‘ï¼
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åŸå› äºŒã€ä¸šåŠ¡åœºæ™¯è€ƒè™‘&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœæ˜¯å†™æ•°æ®åº“åœºæ™¯æ¯”è¾ƒå¤šï¼Œè¯»æ•°æ®åº“åœºæ™¯æ¯”è¾ƒå°‘ä¸šåŠ¡éœ€æ±‚ã€‚&amp;ldquo;å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜&amp;quot;è¿™ç§æ–¹æ¡ˆä¼šå¯¼è‡´ï¼Œæ•°æ®å‹æ ¹è¿˜æ²¡è¯»åˆ°ï¼Œç¼“å­˜å°±è¢«é¢‘ç¹çš„æ›´æ–°æµªè´¹æ€§èƒ½&lt;/li&gt;
&lt;li&gt;å¦‚æœå†™å…¥æ•°æ®åº“æ˜¯ç»è¿‡å¤æ‚è®¡ç®—ä»¥åå†æ›´æ–°æ•°æ®åº“ï¼Œé‚£ä¹ˆæ¯æ¬¡å†™å…¥æ•°æ®åº“åæ›´æ–°ç¼“å­˜ï¼Œæ€§èƒ½å­˜åœ¨æµªè´¹&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“&#34;&gt;å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ &lt;a href=&#34;#%e5%85%88%e5%88%a0%e9%99%a4%e7%bc%93%e5%ad%98%e5%86%8d%e6%9b%b4%e6%96%b0%e6%95%b0%e6%8d%ae%e5%ba%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¯¥æ–¹æ¡ˆä¼šå¯¼è‡´ä¸ä¸€è‡´çš„åŸå› ï¼šåŒæ—¶æœ‰ä¸€ä¸ªè¯·æ±‚Aè¿›è¡Œæ›´æ–°æ“ä½œï¼Œå¦ä¸€ä¸ªè¯·æ±‚Bè¿›è¡ŒæŸ¥è¯¢æ“ä½œã€‚é‚£ä¹ˆå°±ä¼šå‡ºç°ä»¥ä¸‹æƒ…å½¢ï¼š
æƒ…å†µä¸€ï¼šå¤šè¿›ç¨‹è¯»å†™åŸå› &lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;è¯·æ±‚Aè¿›è¡Œå†™æ“ä½œï¼Œåˆ é™¤ç¼“å­˜
è¯·æ±‚BæŸ¥è¯¢å‘ç°ç¼“å­˜ä¸å­˜åœ¨
è¯·æ±‚Bå»æ•°æ®åº“æŸ¥è¯¢å¾—åˆ°æ—§å€¼
è¯·æ±‚Bå°†æ—§å€¼å†™å…¥ç¼“å­˜
è¯·æ±‚Aå°†æ–°å€¼å†™å…¥æ•°æ®åº“
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šè¯‰è¯·æ±‚å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå¦‚æœæ²¡é‡‡ç”¨ç¼“å­˜è¿‡æœŸç­–ç•¥ã€‚åˆ™ç¼“å­˜æ•°æ®ä¸€ç›´æ˜¯è„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æƒ…å†µäºŒï¼šMYSQLä¸»ä»åˆ†ç¦»åŸå› &lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;è¯·æ±‚Aè¿›è¡Œå†™æ“ä½œï¼Œåˆ é™¤ç¼“å­˜ï¼›
è¯·æ±‚Aå°†æ•°æ®å†™å…¥æ•°æ®åº“äº†ï¼›
è¯·æ±‚BæŸ¥è¯¢ç¼“å­˜å‘ç°ï¼Œç¼“å­˜æ²¡æœ‰å€¼ï¼›
è¯·æ±‚Bå»ä»åº“æŸ¥è¯¢ï¼Œè¿™æ—¶ï¼Œè¿˜æ²¡æœ‰å®Œæˆä¸»ä»åŒæ­¥ï¼Œå› æ­¤æŸ¥è¯¢åˆ°çš„æ˜¯æ—§å€¼ï¼›
è¯·æ±‚Bå°†æ—§å€¼å†™å…¥ç¼“å­˜ï¼›
æ•°æ®åº“å®Œæˆä¸»ä»åŒæ­¥ï¼Œä»åº“å˜ä¸ºæ–°å€¼ï¼›
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è§£å†³æ–¹æ¡ˆï¼šé‡‡ç”¨å»¶è¿ŸåŒåˆ ç­–ç•¥ã€‚å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†åˆ é™¤æ•°æ®åº“ï¼Œè¿›ç¨‹ä¼‘çœ 1ç§’å†æ¬¡åˆ é™¤ç¼“å­˜&lt;/p&gt;
&lt;h2 id=&#34;å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜&#34;&gt;å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ &lt;a href=&#34;#%e5%85%88%e6%9b%b4%e6%96%b0%e6%95%b0%e6%8d%ae%e5%ba%93%e5%86%8d%e5%88%a0%e9%99%a4%e7%bc%93%e5%ad%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¿™ç§æƒ…å†µä¸å­˜åœ¨å¹¶å‘é—®é¢˜ä¹ˆï¼Ÿ
ä¸æ˜¯çš„ã€‚å‡è®¾è¿™ä¼šæœ‰ä¸¤ä¸ªè¯·æ±‚ï¼Œä¸€ä¸ªè¯·æ±‚AåšæŸ¥è¯¢æ“ä½œï¼Œä¸€ä¸ªè¯·æ±‚Båšæ›´æ–°æ“ä½œï¼Œé‚£ä¹ˆä¼šæœ‰å¦‚ä¸‹æƒ…å½¢äº§ç”Ÿï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¼“å­˜åˆšå¥½å¤±æ•ˆï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚AæŸ¥è¯¢æ•°æ®åº“ï¼Œå¾—ä¸€ä¸ªæ—§å€¼ï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚Bå°†æ–°å€¼å†™å…¥æ•°æ®åº“ï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚Båˆ é™¤ç¼“å­˜ï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚Aå°†æŸ¥åˆ°çš„æ—§å€¼å†™å…¥ç¼“å­˜ï¼›
okï¼Œå¦‚æœå‘ç”Ÿä¸Šè¿°æƒ…å†µï¼Œç¡®å®æ˜¯ä¼šå‘ç”Ÿè„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆï¼šå‘ç”Ÿä¸Šè¿°æƒ…å†µæœ‰ä¸€ä¸ªå…ˆå¤©æ€§æ¡ä»¶ï¼Œå°±æ˜¯ä¸Šè¿°æ­¥éª¤ï¼ˆ3ï¼‰çš„å†™æ•°æ®åº“æ“ä½œæ¯”æ­¥éª¤ï¼ˆ2ï¼‰çš„è¯»æ•°æ®åº“æ“ä½œè€—æ—¶æ›´çŸ­ï¼Œæ‰æœ‰å¯èƒ½ä½¿å¾—æ­¥éª¤ï¼ˆ4ï¼‰å…ˆäºæ­¥éª¤ï¼ˆ5ï¼‰ã€‚å¯æ˜¯ï¼Œå¤§å®¶æƒ³æƒ³ï¼Œæ•°æ®åº“çš„è¯»æ“ä½œçš„é€Ÿåº¦è¿œå¿«äºå†™æ“ä½œçš„ï¼ˆä¸ç„¶åšè¯»å†™åˆ†ç¦»å¹²å˜›ï¼Œåšè¯»å†™åˆ†ç¦»çš„æ„ä¹‰å°±æ˜¯å› ä¸ºè¯»æ“ä½œæ¯”è¾ƒå¿«ï¼Œè€—èµ„æºå°‘ï¼‰ï¼Œå› æ­¤æ­¥éª¤ï¼ˆ3ï¼‰è€—æ—¶æ¯”æ­¥éª¤ï¼ˆ2ï¼‰æ›´çŸ­ï¼Œè¿™ä¸€æƒ…å½¢å¾ˆéš¾å‡ºç°ã€‚  é¦–å…ˆï¼Œç»™ç¼“å­˜è®¾æœ‰æ•ˆæ—¶é—´æ˜¯ä¸€ç§æ–¹æ¡ˆã€‚å…¶æ¬¡ï¼Œé‡‡ç”¨ç­–ç•¥2ï¼ˆå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼‰é‡Œç»™å‡ºçš„å¼‚æ­¥å»¶æ—¶åˆ é™¤ç­–ç•¥ï¼Œä¿è¯è¯»è¯·æ±‚å®Œæˆä»¥åï¼Œå†è¿›è¡Œåˆ é™¤æ“ä½œã€‚&lt;/p&gt;
&lt;h1 id=&#34;å¦‚ä½•è§£å†³redisçš„å¹¶å‘ç«äº‰keyé—®é¢˜&#34;&gt;å¦‚ä½•è§£å†³redisçš„å¹¶å‘ç«äº‰keyé—®é¢˜ &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3redis%e7%9a%84%e5%b9%b6%e5%8f%91%e7%ab%9e%e4%ba%89key%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åˆ†æ:è¿™ä¸ªé—®é¢˜å¤§è‡´å°±æ˜¯ï¼ŒåŒæ—¶æœ‰å¤šä¸ªå­ç³»ç»Ÿå»setä¸€ä¸ªkeyã€‚è¿™ä¸ªæ—¶å€™è¦æ³¨æ„ä»€ä¹ˆå‘¢ï¼Ÿå¤§å®¶æ€è€ƒè¿‡ä¹ˆã€‚éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œåšä¸»æå‰ç™¾åº¦äº†ä¸€ä¸‹ï¼Œå‘ç°ç­”æ¡ˆåŸºæœ¬éƒ½æ˜¯æ¨èç”¨redisäº‹åŠ¡æœºåˆ¶ã€‚åšä¸»ä¸æ¨èä½¿ç”¨redisçš„äº‹åŠ¡æœºåˆ¶ã€‚å› ä¸ºæˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒï¼ŒåŸºæœ¬éƒ½æ˜¯redisé›†ç¾¤ç¯å¢ƒï¼Œåšäº†æ•°æ®åˆ†ç‰‡æ“ä½œã€‚ä½ ä¸€ä¸ªäº‹åŠ¡ä¸­æœ‰æ¶‰åŠåˆ°å¤šä¸ªkeyæ“ä½œçš„æ—¶å€™ï¼Œè¿™å¤šä¸ªkeyä¸ä¸€å®šéƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªredis-serverä¸Šã€‚å› æ­¤ï¼Œredisçš„äº‹åŠ¡æœºåˆ¶ï¼Œååˆ†é¸¡è‚‹ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå¯¹keyæ“ä½œä¸è¦æ±‚é¡ºåº&lt;br&gt;
è¿™ç§æƒ…å†µä¸‹ï¼Œå‡†å¤‡ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Œè°æŠ¢åˆ°é”è°setå³å¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå¯¹keyæ“ä½œè¦æ±‚é¡ºåº&lt;br&gt;
å‡è®¾æœ‰ä¸€ä¸ªkey1,ç³»ç»ŸAéœ€è¦å°†key1è®¾ç½®ä¸ºvalueA,ç³»ç»ŸBéœ€è¦å°†key1è®¾ç½®ä¸ºvalueB,ç³»ç»ŸCéœ€è¦å°†key1è®¾ç½®ä¸ºvalueC.&lt;br&gt;
æœŸæœ›æŒ‰ç…§key1çš„valueå€¼æŒ‰ç…§ valueAâ€“&amp;gt;valueBâ€“&amp;gt;valueCçš„é¡ºåºå˜åŒ–ã€‚è¿™ç§æ—¶å€™æˆ‘ä»¬åœ¨æ•°æ®å†™å…¥æ•°æ®åº“çš„æ—¶å€™ï¼Œéœ€è¦ä¿å­˜ä¸€ä¸ªæ—¶é—´æˆ³ã€‚å‡è®¾æ—¶é—´æˆ³å¦‚ä¸‹&lt;br&gt;
ç³»ç»ŸA key 1 {valueA 3:00}&lt;br&gt;
ç³»ç»ŸB key 1 {valueB 3:05}&lt;br&gt;
ç³»ç»ŸC key 1 {valueC 3:10}&lt;br&gt;
é‚£ä¹ˆï¼Œå‡è®¾è¿™ä¼šç³»ç»ŸBå…ˆæŠ¢åˆ°é”ï¼Œå°†key1è®¾ç½®ä¸º{valueB 3:05}ã€‚æ¥ä¸‹æ¥ç³»ç»ŸAæŠ¢åˆ°é”ï¼Œå‘ç°è‡ªå·±çš„valueAçš„æ—¶é—´æˆ³æ—©äºç¼“å­˜ä¸­çš„æ—¶é—´æˆ³ï¼Œé‚£å°±ä¸åšsetæ“ä½œäº†ã€‚ä»¥æ­¤ç±»æ¨ã€‚&lt;br&gt;
æˆ–è€…ä½¿ç”¨é˜Ÿåˆ—ï¼Œå°†setæ“ä½œè¿›è¡Œä¸²è”å³å¯&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ&#34;&gt;rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ &lt;a href=&#34;#redis%e5%b8%b8%e8%a7%81%e6%80%a7%e8%83%bd%e9%97%ae%e9%a2%98%e5%92%8c%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;Masterå†™å†…å­˜å¿«ç…§ï¼Œsaveå‘½ä»¤è°ƒåº¦rdbSaveå‡½æ•°ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œå½“å¿«ç…§æ¯”è¾ƒå¤§æ—¶å¯¹æ€§èƒ½å½±å“æ˜¯éå¸¸å¤§çš„ï¼Œä¼šé—´æ–­æ€§æš‚åœæœåŠ¡ï¼Œæ‰€ä»¥Masteræœ€å¥½ä¸è¦å†™å†…å­˜å¿«ç…§ã€‚&lt;/li&gt;
&lt;li&gt;Master AOFæŒä¹…åŒ–ï¼Œå¦‚æœä¸é‡å†™AOFæ–‡ä»¶ï¼Œè¿™ä¸ªæŒä¹…åŒ–æ–¹å¼å¯¹æ€§èƒ½çš„å½±å“æ˜¯æœ€å°çš„ï¼Œä½†æ˜¯AOFæ–‡ä»¶ä¼šä¸æ–­å¢å¤§ï¼ŒAOFæ–‡ä»¶è¿‡å¤§ä¼šå½±å“Masteré‡å¯çš„æ¢å¤é€Ÿåº¦ã€‚Masteræœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å†…å­˜å¿«ç…§å’ŒAOFæ—¥å¿—æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸è¦å¯ç”¨å†…å­˜å¿«ç…§åšæŒä¹…åŒ–,å¦‚æœæ•°æ®æ¯”è¾ƒå…³é”®ï¼ŒæŸä¸ªSlaveå¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;Masterè°ƒç”¨BGREWRITEAOFé‡å†™AOFæ–‡ä»¶ï¼ŒAOFåœ¨é‡å†™çš„æ—¶å€™ä¼šå å¤§é‡çš„CPUå’Œå†…å­˜èµ„æºï¼Œå¯¼è‡´æœåŠ¡loadè¿‡é«˜ï¼Œå‡ºç°çŸ­æš‚æœåŠ¡æš‚åœç°è±¡ã€‚&lt;/li&gt;
&lt;li&gt;Redisä¸»ä»å¤åˆ¶çš„æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒSlaveå’ŒMasteræœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;redis60-å¤šçº¿ç¨‹&#34;&gt;Redis6.0 å¤šçº¿ç¨‹ &lt;a href=&#34;#redis60-%e5%a4%9a%e7%ba%bf%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å…¶å®æœ¬è´¨åªæ˜¯åœ¨ç½‘ç»œIOä¸Šé¢å®ç°äº†å¤šçº¿ç¨‹è¯»å–å’Œå†™å…¥ï¼Œç„¶åè¿›è¡Œæ‰§è¡Œé˜Ÿåˆ—ï¼Œæ‰§è¡Œè¿˜æ˜¯å•çº¿ç¨‹
&lt;img src=&#34;https://abnerxc.github.io/img/redis-q.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;
åŠ å…¥å¤šçº¿ç¨‹ IO ä¹‹åï¼Œæ•´ä½“çš„è¯»æµç¨‹å¦‚ä¸‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»çº¿ç¨‹è´Ÿè´£æ¥æ”¶å»ºè¿è¯·æ±‚ï¼Œè¯»äº‹ä»¶åˆ°æ¥(æ”¶åˆ°è¯·æ±‚)åˆ™æ”¾åˆ°ä¸€ä¸ªå…¨å±€ç­‰å¾…è¯»å¤„ç†é˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;ä¸»çº¿ç¨‹å¤„ç†å®Œè¯»äº‹ä»¶ä¹‹åï¼Œé€šè¿‡ RR(Round Robin) å°†è¿™äº›è¿æ¥åˆ†é…ç»™è¿™äº› IO çº¿ç¨‹ï¼Œç„¶åä¸»çº¿ç¨‹å¿™ç­‰å¾…(spinlock çš„æ•ˆæœ)çŠ¶æ€&lt;/li&gt;
&lt;li&gt;IO çº¿ç¨‹å°†è¯·æ±‚æ•°æ®è¯»å–å¹¶è§£æå®Œæˆ(è¿™é‡Œåªæ˜¯è¯»æ•°æ®å’Œè§£æå¹¶ä¸æ‰§è¡Œ)&lt;/li&gt;
&lt;li&gt;ä¸»çº¿ç¨‹æ‰§è¡Œæ‰€æœ‰å‘½ä»¤å¹¶æ¸…ç©ºæ•´ä¸ªè¯·æ±‚ç­‰å¾…è¯»å¤„ç†é˜Ÿåˆ—(æ‰§è¡Œéƒ¨åˆ†ä¸²è¡Œ)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢çš„è¿™ä¸ªè¿‡ç¨‹æ˜¯å®Œå…¨æ— é”çš„ï¼Œå› ä¸ºåœ¨ IO çº¿ç¨‹å¤„ç†çš„æ—¶ä¸»çº¿ç¨‹ä¼šç­‰å¾…å…¨éƒ¨çš„ IO çº¿ç¨‹å®Œæˆï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°data raceçš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;h1 id=&#34;redisæ–°ç‰¹æ€§&#34;&gt;Redisæ–°ç‰¹æ€§ &lt;a href=&#34;#redis%e6%96%b0%e7%89%b9%e6%80%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Redis Module&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»»ä½•C/C++ç¨‹åºç°åœ¨éƒ½å¯ä»¥è¿è¡Œåœ¨Redisä¸Š&lt;/li&gt;
&lt;li&gt;Modulesæ˜¯ç”¨ä¸€ç§æœ¬åœ°çš„æ–¹å¼æ¥æ‰©å±•Redisçš„æ–°ç”¨ä¾‹å’ŒåŠŸèƒ½&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç°æœ‰çš„æˆ–è€…æ·»åŠ æ–°çš„æ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;äº«å—ç®€å•ï¼Œæ— é™å¯æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§çš„åŒæ—¶ä¿æŒç€redisçš„æœ¬æœºçš„é€Ÿåº¦&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redis Search
é«˜æ€§èƒ½çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ˆFaster, in-memory, highly available full text searchï¼‰ï¼Œå¯ä½œä¸ºRedis Moduleè¿è¡Œåœ¨Redisä¸Šã€‚ä½†æ˜¯å®ƒä¸å…¶ä»–Redisæœç´¢åº“ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸ä½¿ç”¨Rediså†…éƒ¨æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ï¼šé›†åˆã€æ’åºé›†ï¼ˆps.åé¢ä¼šå†™ä¸€ç¯‡åŸºäºRedisçš„æ•°æ®ç»“æ„æ¥è®¾è®¡æœç´¢å¼•æ“ï¼‰ï¼ŒRedisåŸå£°çš„æœç´¢è¿˜æ˜¯æœ‰å¾ˆå¤§çš„å±€é™æ€§ï¼Œç®€å•çš„åˆ†è¯æœç´¢æ˜¯å¯ä»¥æ»¡è¶³ï¼Œä½†æ˜¯åº”ç”¨åˆ°å¤æ‚çš„åœºæ™¯å°±ä¸å¤ªé€‚åˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redis ML
æœºå™¨å­¦ä¹ æ¨¡å‹æœåŠ¡å™¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>å•çº¿ç¨‹çš„redisä¸ºä»€ä¹ˆå¿«</title>
      <link>https://abnerxc.github.io/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/</guid>
      <description>&lt;h1 id=&#34;åŸºæœ¬æ¦‚å¿µ&#34;&gt;åŸºæœ¬æ¦‚å¿µ &lt;a href=&#34;#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Redisæ€§èƒ½å¦‚æ­¤é«˜çš„åŸå› ï¼Œæˆ‘æ€»ç»“äº†å¦‚ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çº¯å†…å­˜æ“ä½œ&lt;/li&gt;
&lt;li&gt;å•çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;é«˜æ•ˆçš„æ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;åˆç†çš„æ•°æ®ç¼–ç &lt;/li&gt;
&lt;li&gt;å…¶ä»–æ–¹é¢çš„ä¼˜åŒ–&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ Redis ä¸­ï¼Œå¸¸ç”¨çš„å‡ ç§æ•°æ®ç»“æ„å’Œåº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Stringï¼šç¼“å­˜ã€è®¡æ•°å™¨ã€åˆ†å¸ƒå¼é”ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;Listï¼šé“¾è¡¨ã€é˜Ÿåˆ—ã€å¾®åšå…³æ³¨äººæ—¶é—´è½´åˆ—è¡¨ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;Hashï¼šç”¨æˆ·ä¿¡æ¯ã€Hash è¡¨ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;Setï¼šå»é‡ã€èµã€è¸©ã€å…±åŒå¥½å‹ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;Zsetï¼šè®¿é—®é‡æ’è¡Œæ¦œã€ç‚¹å‡»é‡æ’è¡Œæ¦œç­‰ã€‚&lt;/li&gt;
&lt;li&gt;HyperLogLog: ç½‘ç«™UV,ç‹¬ç«‹IPè®¡ç®—ç­‰ï¼Œä¸»è¦ä¹Ÿæ˜¯ä¸€äº›å»é‡è®¡ç®—ï¼Œå¯¹æ•°æ®ç²¾åº¦è¦æ±‚ä¸é«˜ï¼Œä¸»è¦ç”±äºè®¡ç®—æ•°æ®ç©ºé—´æ˜¯å›ºå®šçš„&lt;/li&gt;
&lt;li&gt;Geoï¼šGEO(åœ°ç†ä½ç½®)çš„æ”¯æŒï¼Œä¸»è¦æ˜¯å¯¹ç»çº¬åº¦ä¸€ä¸ªä½ç½®è®¡ç®—ç­‰ç‰¹æ€§&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å†…éƒ¨æ•°æ®ç»“æ„&#34;&gt;å†…éƒ¨æ•°æ®ç»“æ„ &lt;a href=&#34;#%e5%86%85%e9%83%a8%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;redisçš„åº•å±‚æ•°æ®ç»“æ„æœ‰ä»¥ä¸‹7ç§ï¼ŒåŒ…æ‹¬&lt;code&gt;ç®€å•åŠ¨æ€å­—ç¬¦ä¸²(SDS)ï¼Œé“¾è¡¨ã€å­—å…¸ã€è·³è·ƒè¡¨ã€æ•´æ•°é›†åˆã€å‹ç¼©åˆ—è¡¨ã€å¯¹è±¡&lt;/code&gt;ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/redis-d.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç®€å•åŠ¨æ€å­—ç¬¦ä¸²sds&#34;&gt;ç®€å•åŠ¨æ€å­—ç¬¦ä¸²(SDS) &lt;a href=&#34;#%e7%ae%80%e5%8d%95%e5%8a%a8%e6%80%81%e5%ad%97%e7%ac%a6%e4%b8%b2sds&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Redis æ˜¯ç”¨ C è¯­è¨€å¼€å‘å®Œæˆçš„ï¼Œä½†åœ¨ Redis å­—ç¬¦ä¸²ä¸­ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ç”¨ä¸€ç§ç§°ä¸º SDSï¼ˆSimple Dynamic Stringï¼‰çš„ç»“æ„ä½“æ¥ä¿å­˜å­—ç¬¦ä¸²ã€‚
åœ¨redisæ•°æ®åº“é‡Œï¼ŒåŒ…å«å­—ç¬¦ä¸²å€¼çš„é”®å€¼å¯¹åœ¨åº•å±‚éƒ½æ˜¯ç”±SDSå®ç°çš„ã€‚é™¤äº†ç”¨æ¥ä¿å­˜æ•°æ®åº“ä¸­çš„å­—ç¬¦ä¸²å€¼ä¹‹å¤–ï¼Œsdsè¿˜è¢«ç”¨æ¥ä½œç¼“å†²åŒºï¼ˆbufferï¼‰ï¼šAOFï¼ˆä¸€ç§æŒä¹…åŒ–ç­–ç•¥ï¼‰æ¨¡å—ä¸­çš„AOFç¼“å†²åŒºï¼Œä»¥åŠå®¢æˆ·ç«¯çŠ¶æ€ä¸­çš„è¾“å…¥ç¼“å†²åŒºï¼Œéƒ½æ˜¯ç”±SDSå®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/redis-e.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct __attribute__ ((__packed__)) sdshdr64 {
    uint64_t len; /*  è®°å½•buffæ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡ */   
    uint64_t free; /* è®°å½•æœªä½¿ç”¨å­—èŠ‚æ•°é‡*/
    char buf[]; /*å­˜å‚¨å®é™…å†…å®¹*/
};
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¾‹å¦‚ï¼šæ‰§è¡Œå‘½ä»¤ set key valueï¼Œkey å’Œ value éƒ½æ˜¯ä¸€ä¸ª SDS ç±»å‹çš„ç»“æ„å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sds-ä¸-c-å­—ç¬¦ä¸²çš„åŒºåˆ«&#34;&gt;SDS ä¸ C å­—ç¬¦ä¸²çš„åŒºåˆ« &lt;a href=&#34;#sds-%e4%b8%8e-c-%e5%ad%97%e7%ac%a6%e4%b8%b2%e7%9a%84%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¸¸æ•°æ—¶é—´å†…è·å¾—å­—ç¬¦ä¸²é•¿åº¦:
C å­—ç¬¦ä¸²æœ¬èº«ä¸è®°å½•é•¿åº¦ä¿¡æ¯ï¼Œæ¯æ¬¡è·å–é•¿åº¦ä¿¡æ¯éƒ½éœ€è¦éå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œå¤æ‚åº¦ä¸º O(n)ï¼›C å­—ç¬¦ä¸²éå†æ—¶é‡åˆ°&amp;rsquo;\0â€˜ æ—¶ç»“æŸã€‚
SDS ä¸­ len å­—æ®µä¿å­˜ç€å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ‰€ä»¥æ€»èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…è·å–å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¤æ‚åº¦æ˜¯ O(1)ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¿å…ç¼“å†²åŒºæº¢å‡º
å‡è®¾åœ¨å†…å­˜ä¸­æœ‰ä¸¤ä¸ªç´§æŒ¨ç€çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œs1=&amp;ldquo;xxxxx&amp;quot;å’Œ s2=&amp;ldquo;yyyyy&amp;rdquo;&lt;br&gt;
ç”±äºåœ¨å†…å­˜ä¸Šç´§ç´§ç›¸è¿ï¼Œå½“æˆ‘ä»¬å¯¹ s1 è¿›è¡Œæ‰©å……çš„æ—¶å€™ï¼Œå°† s1=â€œxxxxxzzzzzâ€åï¼Œç”±äºæ²¡æœ‰è¿›è¡Œç›¸åº”çš„å†…å­˜é‡æ–°åˆ†é…ï¼Œå¯¼è‡´ s1 æŠŠ s2 è¦†ç›–æ‰ï¼Œå¯¼è‡´ s2 è¢«è«åå…¶å¦™çš„ä¿®æ”¹ã€‚&lt;br&gt;
ä½† SDS çš„ API å¯¹ zfc ä¿®æ”¹æ—¶é¦–å…ˆä¼šæ£€æŸ¥ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œè‹¥ä¸å……è¶³åˆ™ä¼šåˆ†é…æ–°ç©ºé—´ï¼Œé¿å…äº†ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‡å°‘å­—ç¬¦ä¸²ä¿®æ”¹æ—¶å¸¦æ¥çš„å†…å­˜é‡æ–°åˆ†é…çš„æ¬¡æ•°&#34;&gt;å‡å°‘å­—ç¬¦ä¸²ä¿®æ”¹æ—¶å¸¦æ¥çš„å†…å­˜é‡æ–°åˆ†é…çš„æ¬¡æ•° &lt;a href=&#34;#%e5%87%8f%e5%b0%91%e5%ad%97%e7%ac%a6%e4%b8%b2%e4%bf%ae%e6%94%b9%e6%97%b6%e5%b8%a6%e6%9d%a5%e7%9a%84%e5%86%85%e5%ad%98%e9%87%8d%e6%96%b0%e5%88%86%e9%85%8d%e7%9a%84%e6%ac%a1%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ç”±äºCè¯­è¨€ä¿®æ”¹å­—ç¬¦éœ€è¦é‡æ–°åˆ†é…ç©ºé—´&lt;br&gt;
è€ŒSDSå®ç°äº†é¢„åˆ†é…å’Œæƒ°æ€§é‡Šæ”¾&lt;br&gt;
é¢„åˆ†é…è§„åˆ™ï¼šSDSç©ºé—´è¿›è¡Œæ‰©å……æ—¶ï¼Œä¼šåˆ†é…è¶³å¤Ÿçš„å†…å­˜ç©ºé—´è¿˜ä¼šåˆ†é…é¢å¤–æœªä½¿ç”¨çš„ç©ºé—´ã€‚å¦‚æœå¯¹ SDS ä¿®æ”¹åï¼Œlen çš„é•¿åº¦å°äº 1Mï¼Œé‚£ä¹ˆç¨‹åºå°†åˆ†é…å’Œ len ç›¸åŒé•¿åº¦çš„æœªä½¿ç”¨ç©ºé—´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ len=10ï¼Œé‡æ–°åˆ†é…åï¼Œbuf çš„å®é™…é•¿åº¦ä¼šå˜ä¸º 10(å·²ä½¿ç”¨ç©ºé—´)+10(é¢å¤–ç©ºé—´)+1(ç©ºå­—ç¬¦)=21ã€‚å¦‚æœå¯¹ SDS ä¿®æ”¹å len é•¿åº¦å¤§äº 1Mï¼Œé‚£ä¹ˆç¨‹åºå°†åˆ†é… 1M çš„æœªä½¿ç”¨ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;æƒ°æ€§ç©ºé—´é‡Šæ”¾ï¼šå½“å¯¹ SDS è¿›è¡Œç¼©çŸ­æ“ä½œæ—¶ï¼Œç¨‹åºå¹¶ä¸ä¼šå›æ”¶å¤šä½™çš„å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯ä½¿ç”¨ free å­—æ®µå°†è¿™äº›å­—èŠ‚æ•°é‡è®°å½•ä¸‹æ¥ä¸é‡Šæ”¾ï¼Œåé¢å¦‚æœéœ€è¦ append æ“ä½œï¼Œåˆ™ç›´æ¥ä½¿ç”¨ free ä¸­æœªä½¿ç”¨çš„ç©ºé—´ï¼Œå‡å°‘äº†å†…å­˜çš„åˆ†é…ã€‚&lt;/p&gt;
&lt;h1 id=&#34;3å­—å…¸hash&#34;&gt;3.å­—å…¸(Hash) &lt;a href=&#34;#3%e5%ad%97%e5%85%b8hash&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Redisåº•å±‚hashç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;typedef struct dict{
      dictType *type;
    void *privdata;
    dictht ht[2];
    int trehashidx;
}


typedef struct dictht{
    //å“ˆå¸Œè¡¨æ•°ç»„
    dectEntrt **table;
    //å“ˆå¸Œè¡¨å¤§å°
    unsigned long size;
    //
    unsigned long sizemask;
    //å“ˆå¸Œè¡¨å·²æœ‰èŠ‚ç‚¹æ•°é‡
    unsigned long used;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é‡è¦çš„ä¸¤ä¸ªå­—æ®µæ˜¯ dictht å’Œ trehashidx&lt;/p&gt;
&lt;h2 id=&#34;rehash&#34;&gt;Rehash &lt;a href=&#34;#rehash&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Rehashè§£é‡Šï¼šéšç€æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼Œ å“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹ä¼šé€æ¸åœ°å¢å¤šæˆ–è€…å‡å°‘ï¼Œ ä¸ºäº†è®©å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­ï¼ˆload factorï¼‰ç»´æŒåœ¨ä¸€ä¸ªåˆç†çš„èŒƒå›´ä¹‹å†…ï¼Œ å½“å“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å¤ªå¤šæˆ–è€…å¤ªå°‘æ—¶ï¼Œ ç¨‹åºéœ€è¦å¯¹å“ˆå¸Œè¡¨çš„å¤§å°è¿›è¡Œç›¸åº”çš„æ‰©å±•æˆ–è€…æ”¶ç¼©ã€‚æ‰©å±•å’Œæ”¶ç¼©å“ˆå¸Œè¡¨çš„å·¥ä½œå¯ä»¥é€šè¿‡æ‰§è¡Œ rehash ï¼ˆé‡æ–°æ•£åˆ—ï¼‰æ“ä½œæ¥å®Œæˆ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç”±ä¸Šæ®µä»£ç ï¼Œæˆ‘ä»¬å¯çŸ¥ dict ä¸­å­˜å‚¨äº†ä¸€ä¸ª dictht çš„æ•°ç»„ï¼Œé•¿åº¦ä¸º 2ï¼Œè¡¨æ˜è¿™ä¸ªæ•°æ®ç»“æ„ä¸­å®é™…å­˜å‚¨ç€ä¸¤ä¸ªå“ˆå¸Œè¡¨ ht[0] å’Œ ht[1]ï¼Œä¸ºä»€ä¹ˆè¦å­˜å‚¨ä¸¤å¼  hash è¡¨å‘¢ï¼Ÿ&lt;br&gt;
å½“ç„¶æ˜¯ä¸ºäº†Rehash,Rehashçš„è¿‡ç¨‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸º ht[1] åˆ†é…ç©ºé—´ã€‚å¦‚æœæ˜¯æ‰©å®¹æ“ä½œï¼Œht[1] çš„å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äº ht[0].used*2 çš„ 2^nï¼›å¦‚æœæ˜¯ç¼©å®¹æ“ä½œï¼Œht[1] çš„å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äº ht[0].used çš„ 2^nã€‚&lt;/li&gt;
&lt;li&gt;å°† ht[0] ä¸­çš„é”®å€¼ Rehash åˆ° ht[1] ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å½“ ht[0] å…¨éƒ¨è¿ç§»åˆ° ht[1] ä¸­åï¼Œé‡Šæ”¾ ht[0]ï¼Œå°† ht[1] ç½®ä¸º ht[0]ï¼Œå¹¶ä¸º ht[1] åˆ›å»ºä¸€å¼ æ–°è¡¨ï¼Œä¸ºä¸‹æ¬¡ Rehash åšå‡†å¤‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ¸è¿›å¼-rehash&#34;&gt;æ¸è¿›å¼ Rehash &lt;a href=&#34;#%e6%b8%90%e8%bf%9b%e5%bc%8f-rehash&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ä¸Šé¢æåˆ°çš„å¦‚æœht[0]å…¨éƒ¨ç§»åŠ¨åˆ°ht[1]ä¸­ï¼Œå¦‚æœæ•°æ®é‡å°å¾ˆå¿«ï¼Œå¦‚æœæ•°æ®é‡å¾ˆå¤§åˆ™ä¼šæœ‰å½±å“ä½¿ç”¨
æ‰€ä»¥redisé‡‡ç”¨äº†åˆ†å¤šæ¬¡ã€æ¸è¿›å¼çš„è¿ç§»ç­–ç•¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸º ht[1] åˆ†é…ç©ºé—´ï¼Œè®©å­—å…¸åŒæ—¶æ‹¥æœ‰ ht[0] å’Œ ht[1] ä¸¤ä¸ªå“ˆå¸Œè¡¨ã€‚&lt;/li&gt;
&lt;li&gt;å­—å…¸ä¸­ç»´æŠ¤ä¸€ä¸ª rehashidxï¼Œå¹¶å°†å®ƒç½®ä¸º 0ï¼Œè¡¨ç¤º Rehash å¼€å§‹ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ Rehash æœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸æ“ä½œæ—¶ï¼Œç¨‹åºè¿˜é¡ºä¾¿å°† ht[0] åœ¨ rehashidx ç´¢å¼•ä¸Šçš„æ‰€æœ‰é”®å€¼å¯¹ rehash åˆ° ht[1] ä¸­ï¼Œå½“ Rehash å®Œæˆåï¼Œå°† rehashidx å±æ€§+1ã€‚å½“å…¨éƒ¨ rehash å®Œæˆåï¼Œå°† rehashidx ç½®ä¸º -1ï¼Œè¡¨ç¤º rehash å®Œæˆã€‚
æ³¨æ„ï¼Œç”±äºç»´æŠ¤äº†ä¸¤å¼  Hash è¡¨ï¼Œæ‰€ä»¥åœ¨ Rehash çš„è¿‡ç¨‹ä¸­å†…å­˜ä¼šå¢é•¿ã€‚å¦å¤–ï¼Œåœ¨ Rehash è¿‡ç¨‹ä¸­ï¼Œå­—å…¸ä¼šåŒæ—¶ä½¿ç”¨ ht[0] å’Œ ht[1]ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥åœ¨åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°æ—¶ä¼šåœ¨ä¸¤å¼ è¡¨ä¸­æ“ä½œï¼Œåœ¨æŸ¥è¯¢æ—¶ä¼šå…ˆåœ¨ç¬¬ä¸€å¼ è¡¨ä¸­æŸ¥è¯¢ï¼Œå¦‚æœç¬¬ä¸€å¼ è¡¨ä¸­æ²¡æœ‰ï¼Œåˆ™ä¼šåœ¨ç¬¬äºŒå¼ è¡¨ä¸­æŸ¥è¯¢ã€‚ä½†æ–°å¢æ—¶ä¸€å¾‹ä¼šåœ¨ ht[1] ä¸­è¿›è¡Œï¼Œç¡®ä¿ ht[0] ä¸­çš„æ•°æ®åªä¼šå‡å°‘ä¸ä¼šå¢åŠ ã€‚&lt;/p&gt;
&lt;h1 id=&#34;4-zsetåº•å±‚&#34;&gt;4. Zsetåº•å±‚ &lt;a href=&#34;#4-zset%e5%ba%95%e5%b1%82&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;zsetåº•å±‚çš„å­˜å‚¨ç»“æ„åŒ…æ‹¬ziplistæˆ–skiplistï¼Œåœ¨åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ä½¿ç”¨ziplistï¼Œå…¶ä»–æ—¶å€™ä½¿ç”¨skiplistï¼Œä¸¤ä¸ªæ¡ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰åºé›†åˆä¿å­˜çš„å…ƒç´ æ•°é‡å°äº128ä¸ª&lt;/li&gt;
&lt;li&gt;æœ‰åºé›†åˆä¿å­˜çš„æ‰€æœ‰å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ziplistä½œä¸ºzsetçš„åº•å±‚å­˜å‚¨ç»“æ„æ—¶å€™ï¼Œæ¯ä¸ªé›†åˆå…ƒç´ ä½¿ç”¨ä¸¤ä¸ªç´§æŒ¨åœ¨ä¸€èµ·çš„å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹æ¥ä¿å­˜ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¿å­˜å…ƒç´ çš„æˆå‘˜ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¿å­˜å…ƒç´ çš„åˆ†å€¼ã€‚&lt;/p&gt;
&lt;p&gt;å½“skiplistä½œä¸ºzsetçš„åº•å±‚å­˜å‚¨ç»“æ„çš„æ—¶å€™ï¼Œä½¿ç”¨skiplistæŒ‰åºä¿å­˜å…ƒç´ åŠåˆ†å€¼ï¼Œä½¿ç”¨dictæ¥ä¿å­˜å…ƒç´ å’Œåˆ†å€¼çš„æ˜ å°„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;ziplistæ•°æ®ç»“æ„
&lt;img src=&#34;https://abnerxc.github.io/img/redis-f.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;&lt;/p&gt;
&lt;p&gt;skiplistæ•°æ®ç»“æ„
â€ƒskiplistä½œä¸ºzsetçš„å­˜å‚¨ç»“æ„ï¼Œæ•´ä½“å­˜å‚¨ç»“æ„å¦‚ä¸‹å›¾ï¼Œæ ¸å¿ƒç‚¹ä¸»è¦æ˜¯åŒ…æ‹¬ä¸€ä¸ªdictå¯¹è±¡å’Œä¸€ä¸ªskiplistå¯¹è±¡ã€‚dictä¿å­˜key/valueï¼Œkeyä¸ºå…ƒç´ ï¼Œvalueä¸ºåˆ†å€¼ï¼›skiplistä¿å­˜çš„æœ‰åºçš„å…ƒç´ åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ åŒ…æ‹¬å…ƒç´ å’Œåˆ†å€¼ã€‚ä¸¤ç§æ•°æ®ç»“æ„ä¸‹çš„å…ƒç´ æŒ‡å‘ç›¸åŒçš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/redis-g.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;5-setåº•å±‚&#34;&gt;5. Setåº•å±‚ &lt;a href=&#34;#5-set%e5%ba%95%e5%b1%82&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;setçš„åº•å±‚å­˜å‚¨intsetå’Œhashtableæ˜¯å­˜åœ¨ç¼–ç è½¬æ¢çš„ï¼Œä½¿ç”¨intsetå­˜å‚¨å¿…é¡»æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå¦åˆ™ä½¿ç”¨hashtableï¼Œæ¡ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»“åˆå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ•´æ•°å€¼&lt;/li&gt;
&lt;li&gt;é›†åˆå¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡ä¸è¶…è¿‡512ä¸ª&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;typedef struct intset {
    // ç¼–ç æ–¹å¼
    uint32_t encoding;
    // é›†åˆåŒ…å«çš„å…ƒç´ æ•°é‡
    uint32_t length;
    // ä¿å­˜å…ƒç´ çš„æ•°ç»„
    int8_t contents[];
} intset;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;setçš„å•ä¸ªå…ƒç´ çš„æ·»åŠ è¿‡ç¨‹ï¼Œé¦–å…ˆå¦‚æœå·²ç»æ˜¯hashtableçš„ç¼–ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èµ°æ­£å¸¸çš„hashtableçš„å…ƒç´ æ·»åŠ ï¼Œå¦‚æœåŸæ¥æ˜¯intsetçš„æƒ…å†µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œå¦‚ä¸‹åˆ¤æ–­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœèƒ½å¤Ÿè½¬æˆintçš„å¯¹è±¡ï¼ˆisObjectRepresentableAsLongLongï¼‰ï¼Œé‚£ä¹ˆå°±ç”¨intsetä¿å­˜ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœç”¨intsetä¿å­˜çš„æ—¶å€™ï¼Œå¦‚æœé•¿åº¦è¶…è¿‡512ï¼ˆREDIS_SET_MAX_INTSET_ENTRIESï¼‰å°±è½¬ä¸ºhashtableç¼–ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;liståº•å±‚&#34;&gt;Liståº•å±‚ &lt;a href=&#34;#list%e5%ba%95%e5%b1%82&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;redis listæ•°æ®ç»“æ„åº•å±‚é‡‡ç”¨å‹ç¼©åˆ—è¡¨ziplistæˆ–linkedlistä¸¤ç§æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œé¦–å…ˆä»¥ziplistè¿›è¡Œå­˜å‚¨ï¼Œåœ¨ä¸æ»¡è¶³ziplistçš„å­˜å‚¨è¦æ±‚åè½¬æ¢ä¸ºlinkedliståˆ—è¡¨ã€‚
â€ƒå½“åˆ—è¡¨å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œåˆ—è¡¨å¯¹è±¡ä½¿ç”¨ziplistè¿›è¡Œå­˜å‚¨ï¼Œå¦åˆ™ç”¨linkedlistå­˜å‚¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚&lt;/li&gt;
&lt;li&gt;åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡å°äº512ä¸ªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç¼–ç è½¬åŒ–&#34;&gt;ç¼–ç è½¬åŒ– &lt;a href=&#34;#%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Redis ä½¿ç”¨å¯¹è±¡ï¼ˆredisObjectï¼‰æ¥è¡¨ç¤ºæ•°æ®åº“ä¸­çš„é”®å€¼ï¼Œå½“æˆ‘ä»¬åœ¨ Redis ä¸­åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹æ—¶ï¼Œè‡³å°‘åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯ç”¨åšé”®å€¼å¯¹çš„é”®å¯¹è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯é”®å€¼å¯¹çš„å€¼å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚æˆ‘ä»¬æ‰§è¡Œ SET MSG XXX æ—¶ï¼Œé”®å€¼å¯¹çš„é”®æ˜¯ä¸€ä¸ªåŒ…å«äº†å­—ç¬¦ä¸²â€œMSGâ€œçš„å¯¹è±¡ï¼Œé”®å€¼å¯¹çš„å€¼å¯¹è±¡æ˜¯åŒ…å«å­—ç¬¦ä¸²â€XXXâ€çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;redisObject çš„ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;typedef struct redisObject{
    //ç±»å‹
   unsigned type:4;
   //ç¼–ç 
   unsigned encoding:4;
   //æŒ‡å‘åº•å±‚æ•°æ®ç»“æ„çš„æŒ‡é’ˆ
   void *ptr;
    //...
 }robj;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­ type å­—æ®µè®°å½•äº†å¯¹è±¡çš„ç±»å‹ï¼ŒåŒ…å«å­—ç¬¦ä¸²å¯¹è±¡ã€åˆ—è¡¨å¯¹è±¡ã€å“ˆå¸Œå¯¹è±¡ã€é›†åˆå¯¹è±¡ã€æœ‰åºé›†åˆå¯¹è±¡ã€‚&lt;br&gt;
ptr æŒ‡é’ˆå­—æ®µæŒ‡å‘å¯¹è±¡åº•å±‚å®ç°çš„æ•°æ®ç»“æ„ï¼Œè€Œè¿™äº›æ•°æ®ç»“æ„æ˜¯ç”± encoding å­—æ®µå†³å®šçš„ï¼Œæ¯ç§å¯¹è±¡è‡³å°‘æœ‰ä¸¤ç§æ•°æ®ç¼–ç ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/redis-h.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;
å¯ä»¥é€šè¿‡ object encoding key æ¥æŸ¥çœ‹å¯¹è±¡æ‰€ä½¿ç”¨&lt;/p&gt;
&lt;h2 id=&#34;string-å¯¹è±¡çš„ç¼–ç è½¬åŒ–&#34;&gt;String å¯¹è±¡çš„ç¼–ç è½¬åŒ– &lt;a href=&#34;#string-%e5%af%b9%e8%b1%a1%e7%9a%84%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;String å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ int æˆ– rawï¼Œå¯¹äº String ç±»å‹çš„é”®å€¼ï¼Œå¦‚æœæˆ‘ä»¬å­˜å‚¨çš„æ˜¯çº¯æ•°å­—ï¼ŒRedis åº•å±‚é‡‡ç”¨çš„æ˜¯ int ç±»å‹çš„ç¼–ç ï¼Œå¦‚æœå…¶ä¸­åŒ…æ‹¬éæ•°å­—ï¼Œåˆ™ä¼šç«‹å³è½¬ä¸º raw ç¼–ç ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;127.0.0.1:6379&amp;gt; set str 1
OK
127.0.0.1:6379&amp;gt; object encoding str
&amp;#34;int&amp;#34;
127.0.0.1:6379&amp;gt; set str 1a
OK
127.0.0.1:6379&amp;gt; object encoding str
&amp;#34;raw&amp;#34;
127.0.0.1:6379&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;list-å¯¹è±¡çš„ç¼–ç è½¬åŒ–&#34;&gt;List å¯¹è±¡çš„ç¼–ç è½¬åŒ– &lt;a href=&#34;#list-%e5%af%b9%e8%b1%a1%e7%9a%84%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;List å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ziplist æˆ– linkedlistï¼Œå¯¹äº List ç±»å‹çš„é”®å€¼ï¼Œå½“åˆ—è¡¨å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œé‡‡ç”¨ ziplist ç¼–ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦éƒ½å°äº 64 å­—èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ ä¸ªæ•°å°äº 512 ä¸ªã€‚
å¦‚æœä¸æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„ä»»æ„ä¸€ä¸ªï¼Œå°±ä¼šè½¬åŒ–ä¸º linkedlist ç¼–ç ã€‚æ³¨æ„ï¼šè¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåœ¨ redis.conf ä¸­ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;list-max-ziplist-entries 512
list-max-ziplist-value 64
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;set-ç±»å‹çš„ç¼–ç è½¬åŒ–&#34;&gt;Set ç±»å‹çš„ç¼–ç è½¬åŒ– &lt;a href=&#34;#set-%e7%b1%bb%e5%9e%8b%e7%9a%84%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Set å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ intset æˆ– hashtableï¼Œintset ç¼–ç çš„ç»“æ„å¯¹è±¡ä½¿ç”¨æ•´æ•°é›†åˆä½œä¸ºåº•å±‚å®ç°ï¼ŒæŠŠæ‰€æœ‰å…ƒç´ éƒ½ä¿å­˜åœ¨ä¸€ä¸ªæ•´æ•°é›†åˆé‡Œé¢ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;127.0.0.1:6379&amp;gt; sadd set 1 2 3
(integer) 3
127.0.0.1:6379&amp;gt; object encoding set
&amp;#34;intset&amp;#34;
127.0.0.1:6379&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœ set é›†åˆä¸­ä¿å­˜äº†éæ•´æ•°ç±»å‹çš„æ•°æ®æ—¶ï¼ŒRedis ä¼šå°† intset è½¬åŒ–ä¸º hashtableï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;127.0.0.1:6379&amp;gt; sadd set 1 2 3
(integer) 3
127.0.0.1:6379&amp;gt; object encoding set
&amp;#34;intset&amp;#34;
127.0.0.1:6379&amp;gt; sadd set a
(integer) 1
127.0.0.1:6379&amp;gt; object encoding set
&amp;#34;hashtable&amp;#34;
 127.0.0.1:6379&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å½“ Set å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œå¯¹è±¡é‡‡ç”¨ intset ç¼–ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿å­˜çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ•´æ•°å€¼ï¼ˆå°æ•°ä¸è¡Œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Set å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å…ƒç´ ä¸ªæ•°å°äº 512 ä¸ªã€‚
ä¸èƒ½æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„ä»»æ„ä¸€ä¸ªï¼ŒSet éƒ½ä¼šé‡‡ç”¨ hashtable å­˜å‚¨ã€‚æ³¨æ„ï¼šç¬¬ä¸¤ä¸ªæ¡ä»¶æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåœ¨ redis.conf ä¸­ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;set-max-intset-entries 512
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;hash-å¯¹è±¡çš„ç¼–ç è½¬åŒ–&#34;&gt;Hash å¯¹è±¡çš„ç¼–ç è½¬åŒ– &lt;a href=&#34;#hash-%e5%af%b9%e8%b1%a1%e7%9a%84%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Hash å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ ziplist æˆ– hashtableï¼Œå½“ Hash ä»¥ ziplist ç¼–ç å­˜å‚¨çš„æ—¶å€™ï¼Œä¿å­˜åŒä¸€é”®å€¼å¯¹çš„ä¸¤ä¸ªèŠ‚ç‚¹æ€»æ˜¯ç´§æŒ¨åœ¨ä¸€èµ·ï¼Œé”®èŠ‚ç‚¹åœ¨å‰ï¼Œå€¼èŠ‚ç‚¹åœ¨åï¼š
å½“ Hash å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼ŒHash å¯¹è±¡é‡‡ç”¨ ziplist ç¼–ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hash å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰é”®å€¼å¯¹çš„é”®å’Œå€¼çš„å­—ç¬¦ä¸²é•¿åº¦å‡å°äº 64 å­—èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;Hash å¯¹è±¡ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å°äº 512 ä¸ªã€‚
å¦‚æœä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶çš„ä»»æ„ä¸€ä¸ªï¼Œziplist å°±ä¼šè½¬åŒ–ä¸º hashtable ç¼–ç ã€‚æ³¨æ„ï¼šè¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåœ¨ redis.conf ä¸­ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;hash-max-ziplist-entries 512
hash-max-ziplist-value 64
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;zset-å¯¹è±¡çš„ç¼–ç è½¬åŒ–&#34;&gt;Zset å¯¹è±¡çš„ç¼–ç è½¬åŒ– &lt;a href=&#34;#zset-%e5%af%b9%e8%b1%a1%e7%9a%84%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Zset å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ ziplist æˆ– zkiplistï¼Œå½“é‡‡ç”¨ ziplist ç¼–ç å­˜å‚¨æ—¶ï¼Œæ¯ä¸ªé›†åˆå…ƒç´ ä½¿ç”¨ä¸¤ä¸ªç´§æŒ¨åœ¨ä¸€èµ·çš„å‹ç¼©åˆ—è¡¨æ¥å­˜å‚¨ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨å…ƒç´ çš„æˆå‘˜ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹å­˜å‚¨å…ƒç´ çš„åˆ†å€¼ï¼Œå¹¶ä¸”æŒ‰åˆ†å€¼å¤§å°ä»å°åˆ°å¤§æœ‰åºæ’åˆ—ã€‚&lt;/p&gt;
&lt;p&gt;å½“ Zset å¯¹è±¡åŒæ—¶æ»¡è¶³ä¸€ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œé‡‡ç”¨ ziplist ç¼–ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Zset ä¿å­˜çš„å…ƒç´ ä¸ªæ•°å°äº 128ã€‚&lt;/li&gt;
&lt;li&gt;Zset å…ƒç´ çš„æˆå‘˜é•¿åº¦éƒ½å°äº 64 å­—èŠ‚ã€‚
å¦‚æœä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶çš„ä»»æ„ä¸€ä¸ªï¼Œziplist å°±ä¼šè½¬åŒ–ä¸º zkiplist ç¼–ç ã€‚æ³¨æ„ï¼šè¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåœ¨ redis.conf ä¸­ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;zset-max-ziplist-entries 128
zset-max-ziplist-value 64
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿çš„è§£å†³æ–¹æ³•</title>
      <link>https://abnerxc.github.io/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</guid>
      <description>&lt;h1 id=&#34;1ç¼“å­˜ç©¿é€&#34;&gt;1.ç¼“å­˜ç©¿é€ &lt;a href=&#34;#1%e7%bc%93%e5%ad%98%e7%a9%bf%e9%80%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶éœ€è¦ä»æ•°æ®åº“æŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æ•°æ®åº“æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚åœ¨æµé‡å¤§æ—¶ï¼Œå¯èƒ½DBå°±æŒ‚æ‰äº†ï¼Œè¦æ˜¯æœ‰äººåˆ©ç”¨ä¸å­˜åœ¨çš„keyé¢‘ç¹æ”»å‡»æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™å°±æ˜¯æ¼æ´ã€‚&lt;br&gt;
ä¾‹å¦‚ä¸‹å›¾:&lt;br&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/redis-a.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;11è§£å†³åŠæ³•&#34;&gt;1.1è§£å†³åŠæ³• &lt;a href=&#34;#11%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å°†ä¸å­˜åœ¨çš„keyè®¾ç½®é»˜è®¤çš„å€¼&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰äººåˆ©ç”¨IDæ”»å‡»åº”ç”¨ï¼Œå¯ä»¥å°†è¿™ä¸ªkeyé¢„å…ˆè®¾ç½®ä¸€ä¸ªnullæˆ–è€…ç¨‹åºå¯åˆ¤æ–­çš„å€¼ï¼Œå†³å®šåº”ç”¨æ˜¯å¦è¿›è¡Œä¸‹é¢çš„æ‰§è¡Œã€‚å½“ç¼“å­˜å¤±æ•ˆæˆ–è€…ç¼“å­˜keyç»è¿‡è½®è®­ä»¥åä¸å†ä¸ºç©ºï¼Œåˆ™è¿›è¡Œç¨‹åºçš„åç»­æ‰§è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¸ƒéš†è¿‡æ»¤å™¨&lt;/p&gt;
&lt;p&gt;ç®€å•çš„è¯´ï¼Œbloomç®—æ³•ç±»ä¼¼ä¸€ä¸ªhash set,ç”¨æ¥åˆ¤æ–­æŸä¸ªå…ƒç´ çš„keyæ˜¯å¦å­˜åœ¨é›†åˆä¸­ã€‚å’Œä¸€èˆ¬çš„hash setä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªç®—æ³•æ— éœ€å­˜å‚¨keyçš„å€¼ï¼Œå€¼éœ€è¦kä¸ªæ¯”ç‰¹ä½ï¼Œæ¯ä¸ªå­˜åœ¨ä¸€ä¸ªæ ‡å¿—ï¼Œç”¨æ¥åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨é›†åˆä¸­ã€‚&lt;br&gt;
ç®—æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é¦–å…ˆéœ€è¦kä¸ªhasnå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°å¯ä»¥æŠŠkeyæ•£åˆ—æˆä¸º1ä¸ªæ•´æ•°&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–æ—¶ï¼Œéœ€è¦ä¸€ä¸ªé•¿åº¦ä¸ºnæ¯”ç‰¹çš„æ•°ç»„ï¼Œæ¯ä¸ªæ¯”ç‰¹ä½åˆå§‹åŒ–ä¸º0&lt;/li&gt;
&lt;li&gt;æŸä¸ªkeyåŠ å…¥é›†åˆæ—¶ï¼Œç”¨kä¸ªhashå‡½æ•°è®¡ç®—å‡ºkä¸ªæ•£åˆ—å€¼ï¼Œå¹¶æŠŠæ•°ç»„ä¸­å¯¹åº”çš„æ¯”ç‰¹ä½è®¾ç½®ä¸º1&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦åœ¨é›†åˆæ—¶ï¼Œç”¨kä¸ªhashå‡½æ•°è®¡ç®—å‡ºkä¸ªæ•£åˆ—å€¼ï¼Œå¹¶æŸ¥è¯¢æ•°ç»„ä¸­å¯¹åº”çš„æ¯”ç‰¹ä½ï¼Œå¦‚æœæ‰€æœ‰çš„æ¯”ç‰¹ä½éƒ½æ˜¯1ï¼Œåˆ™è®¤ä¸ºåœ¨é›†åˆä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¼˜ç‚¹:ä¸éœ€è¦å­˜å‚¨keyï¼ŒèŠ‚çœç©ºé—´&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç®—æ³•åˆ¤æ–­keyåœ¨é›†åˆæ—¶ï¼Œæœ‰ä¸€å®šçš„æ¦‚ç‡keyå…¶å®ä¸åœ¨é›†åˆä¸­&lt;/li&gt;
&lt;li&gt;æ— æ³•åˆ é™¤&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;2ç¼“å­˜é›ªå´©&#34;&gt;2.ç¼“å­˜é›ªå´© &lt;a href=&#34;#2%e7%bc%93%e5%ad%98%e9%9b%aa%e5%b4%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¤§é‡çš„keyè®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´åœ¨ç¼“å­˜åœ¨åŒä¸€æ—¶åˆ»å¤±æ•ˆï¼Œé€ æˆDBçš„è¯·æ±‚å¤§ã€å‹åŠ›å¤§ï¼Œå¼•èµ·é›ªå´©&lt;/p&gt;
&lt;h2 id=&#34;21è§£å†³åŠæ³•&#34;&gt;2.1è§£å†³åŠæ³• &lt;a href=&#34;#21%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ä»ä¸šåŠ¡å±‚é¢ã€‚å¯ä»¥ç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ä¸ŠåŠ ä¸Šä¸€ä¸ªéšæœºå€¼ï¼Œä½¿å¾—æ¯ä¸ªkeyçš„è¿‡æœŸæ—¶é—´åˆ†å¸ƒå¼€æ¥ï¼Œä¸ä¼šé›†ä¸­åœ¨åŒä¸€æ—¶åˆ»&lt;/p&gt;
&lt;h1 id=&#34;3-ç¼“å­˜å‡»ç©¿å¹¶å‘&#34;&gt;3. ç¼“å­˜å‡»ç©¿ï¼ˆå¹¶å‘ï¼‰ &lt;a href=&#34;#3-%e7%bc%93%e5%ad%98%e5%87%bb%e7%a9%bf%e5%b9%b6%e5%8f%91&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä¸€ä¸ªå­˜åœ¨çš„keyï¼Œåœ¨ç¼“å­˜è¿‡æœŸçš„ä¸€åˆ»ï¼ŒåŒæ—¶æœ‰å¤§é‡çš„è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šå‡»ç©¿åˆ°DBï¼Œé€ æˆç¬æ—¶DBè¯·æ±‚é‡å¤§ã€å‹åŠ›éª¤å¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;31è§£å†³åŠæ³•&#34;&gt;3.1è§£å†³åŠæ³• &lt;a href=&#34;#31%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨äº’æ–¥é”ï¼šè®©ä¸€ä¸ªçº¿ç¨‹æ„å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ç­‰å¾…æ„å»ºç¼“å­˜çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œä»æ–°ä»ç¼“å­˜ä¸­è·å–æ•°æ®å°±è¡Œï¼ˆå¦‚ä¸‹å›¾ï¼‰
&lt;img src=&#34;https://abnerxc.github.io/img/redis-b.jpeg&#34; alt=&#34;&#34;&gt;
å¦‚æœæ˜¯å•æœºï¼Œå¯ä»¥ç”¨synchronizeæˆ–è€…lockæ¥å¤„ç†ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼ç¯å¢ƒå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼ˆmemcachedçš„addã€redisçš„setnx,zookeeperçš„æ·»åŠ èŠ‚ç‚¹ï¼‰,å½“ç¼“å­˜æ„å»ºå®Œæˆä»¥åé‡Šæ”¾åˆ†å¸ƒå¼é”&lt;/li&gt;
&lt;li&gt;åå°åˆ·æ–°ï¼šå®šä¹‰ä¸ªJobä¸“é—¨ä¸»åŠ¨åˆ·æ–°ç¼“å­˜ï¼Œæ¯”å¦‚ç¼“å­˜30åˆ†é’Ÿï¼Œé‚£ä¹ˆJobå¯ä»¥è®¾ç½®æ¯éš”29åˆ†é’Ÿå®šæ—¶å°†DBæ•°æ®åˆ·æ–°ç¼“å­˜ä¸­ã€‚&lt;code&gt;è¿™ç§æ–¹æ¡ˆé€‚åˆkeyç›¸å¯¹å›ºå®šï¼Œcacheç²’åº¦è¾ƒå¤§&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥æ›´æ–°ï¼šå°†ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼ˆç»å¯¹æ—¶é—´ï¼‰ä¸€èµ·ä¿å­˜åˆ°ç¼“å­˜ä¸­ï¼ˆå¯ä»¥æ˜¯keyæ‹¼æ¥ï¼Œæˆ–è€…valueä¸­å­˜æ”¾å­—æ®µï¼‰ï¼Œåœ¨æ¯æ¬¡åªéœ€getæ“ä½œä»¥åéƒ½å°†getå‡ºæ¥çš„ç¼“å­˜ä¸å½“å‰ç³»ç»Ÿæ—¶é—´è¿›è¡Œæ¯”è¾ƒï¼Œç¼“å­˜æ—¶é—´-å½“å‰æ—¶é—´&amp;lt;=1åˆ†é’Ÿï¼ˆè‡ªå®šä¹‰æ—¶é—´é˜ˆå€¼ï¼‰ï¼Œåˆ™ä¸»åŠ¨æ›´æ–°ç¼“å­˜&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;4-å¦‚ä½•è§£å†³ç¼“å­˜å•æœºçƒ­ç‚¹é—®é¢˜&#34;&gt;4. å¦‚ä½•è§£å†³ç¼“å­˜å•æœºçƒ­ç‚¹é—®é¢˜ &lt;a href=&#34;#4-%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e7%bc%93%e5%ad%98%e5%8d%95%e6%9c%ba%e7%83%ad%e7%82%b9%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åˆ†å¸ƒå¼ç¼“å­˜ä¸€è‡´æ€§hashç®—æ³•è§£å†³&lt;br&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/redis-c.jpeg&#34; alt=&#34;&#34;&gt;&lt;br&gt;
ç®€å•æ¦‚è¿°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€è‡´æ€§hashç®—æ³•é€šè¿‡æ„é€ ä¸€ä¸ªé•¿åº¦ä¸º2^32çš„æ•´æ•°ç¯&lt;/li&gt;
&lt;li&gt;æ ¹æ®èŠ‚ç‚¹åï¼ˆæˆ–è€…æœåŠ¡å™¨IPç­‰ä¿¡æ¯ï¼‰çš„hashå€¼å°†ç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹æ”¾ç½®åœ¨è¿™ä¸ªç¯ä¸Š&lt;/li&gt;
&lt;li&gt;è®¡ç®—éœ€è¦ç¼“å­˜çš„keyçš„hashå€¼ï¼Œé¡ºæ—¶é’ˆæ‰¾åˆ°æœ€è¿‘çš„çš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå°†æ•°æ®å­˜æ”¾åœ¨è¯¥èŠ‚ç‚¹ä¸Š&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>é€†å‘ç¯å¢ƒ-æ‚</title>
      <link>https://abnerxc.github.io/android/%E5%85%A5%E9%97%A8/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/android/%E5%85%A5%E9%97%A8/</guid>
      <description>&lt;h1 id=&#34;usbæ‰¾ä¸åˆ°è®¾å¤‡&#34;&gt;USBæ‰¾ä¸åˆ°è®¾å¤‡ &lt;a href=&#34;#usb%e6%89%be%e4%b8%8d%e5%88%b0%e8%ae%be%e5%a4%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;windows-ç¯å¢ƒ&#34;&gt;windows ç¯å¢ƒ &lt;a href=&#34;#windows-%e7%8e%af%e5%a2%83&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;æ‰¾ä¸åˆ°è®¾å¤‡:å³é”®ç”µè„‘å±æ€§-&amp;gt;è®¾å¤‡ç®¡ç†å™¨-&amp;gt;ä¾¿æºè®¾å¤‡-&amp;gt;å±æ€§-&amp;gt;è¯¦ç»†ä¿¡æ¯-&amp;gt;å±æ€§ï¼ˆç¡¬ä»¶idï¼‰,æŠŠç¡¬ä»¶idå¤åˆ¶åˆ°C:\Users\xxxx.android\adb_usb.iniæ–‡ä»¶ä¸­,å¡«å…¥&lt;code&gt;0x12345&lt;/code&gt;,12345æ›¿æ¢æˆè®¾å¤‡ID,ç„¶åé‡å¯adbæœåŠ¡&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;macosç¯å¢ƒ&#34;&gt;macOSç¯å¢ƒ &lt;a href=&#34;#macos%e7%8e%af%e5%a2%83&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;æ‰§è¡Œ&lt;code&gt;system_profiler SPUSBDataType&lt;/code&gt;é‡Œé¢æ‰¾åˆ°Androidçš„Vendor ID&lt;/li&gt;
&lt;li&gt;å°†vendor idçš„å€¼å†™å…¥ /User/ä½ å¯¹åº”çš„ç”¨æˆ·æ–‡ä»¶å¤¹/.android/adb_usb.iniæ–‡ä»¶ã€‚è‹¥è¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªã€‚&lt;/li&gt;
&lt;li&gt;adb kill-server &amp;amp;&amp;amp; adb start-server &amp;amp;&amp;amp;  adb devices&lt;/li&gt;
&lt;li&gt;åä¸ºæ‰‹æœºæ— æ³•è¯†åˆ«ï¼šhttps://www.jianshu.com/p/8c19fb78a680&lt;/li&gt;
&lt;li&gt;é¦–å…ˆå…³é—­mac&lt;code&gt;sip&lt;/code&gt;é»‘è‹¹æœåœ¨recoveryæ¨¡å¼ä¸‹å»å…³é—­ä¹Ÿå¯ä»¥,macå¤œç¥abdæ‰¾ä¸åˆ°,æ‰¾åˆ°appåŒ…ä¸‹é¢çš„adbå‘½ä»¤ï¼š&lt;code&gt;/appåŒ…è·¯å¾„/adb connect 127.0.0.1:62001&lt;/code&gt; è¿æ¥ä»¥åï¼Œå¯ä»¥å‘ç°è®¾å¤‡äº†&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;é¢å…·rootéšè—&#34;&gt;é¢å…·rootéšè— &lt;a href=&#34;#%e9%9d%a2%e5%85%b7root%e9%9a%90%e8%97%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼šç§»é™¤ç³»ç»Ÿçš„æ”¯ä»˜APPæ£€æŸ¥ï¼Œä¾‹å¦‚miuiçš„&lt;code&gt;æ‰‹æœºç®¡å®¶-&amp;gt;æ”¯ä»˜ä¿æŠ¤ä¸­å¿ƒ&lt;/code&gt;å…³é—­APPä¿æŠ¤ï¼Œ&lt;/li&gt;
&lt;li&gt;æ–¹æ¡ˆä¸€ï¼šé¢å…·è®¾ç½®ï¼Œæ–°ç‰ˆçš„magiskå·²å¢åŠ äº†zygiskæ’é™¤åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ’é™¤åˆ—è¡¨å»æ’é™¤éœ€è¦éšè—çš„åº”ç”¨ï¼Œæ‰“å¼€magiskï¼Œç‚¹å³ä¸Šè§’çš„è®¾ç½®å›¾æ ‡ï¼Œåœ¨è®¾ç½®é‡Œæ‰¾åˆ°zygiskæ‰“å¼€ï¼Œç„¶åæ‰“å¼€éµå¾ªæ’é™¤åˆ—è¡¨ï¼Œåœ¨é…ç½®æ’é™¤åˆ—è¡¨é‡ŒæŠŠéœ€è¦éšè—çš„åº”ç”¨æ‰“ä¸Šé’©ã€‚&lt;/li&gt;
&lt;li&gt;æ–¹æ¡ˆäºŒï¼š(å»ºè®®ä½¿ç”¨é€‚ç”¨APPæ›´å¹¿)å¦‚æœæœ‰äº›APPè¿˜æ˜¯æ— æ³•éšè—ï¼Œé¢å…·é‡Œé¢å®‰è£…&lt;code&gt;Shamiko&lt;/code&gt;æ’ä»¶ï¼Œ&lt;code&gt;https://github.com/LSPosed/LSPosed.github.io/releases&lt;/code&gt; ï¼Œåœ¨ä½¿ç”¨Magiskå®˜æ–¹ç‰ˆ24+å¼€å¯Zygiskå’Œéµå®ˆæ’é™¤åˆ—è¡¨éšè—rootä¹‹åï¼Œæ’é™¤åˆ—è¡¨å†…è¢«éšè—rootäº†çš„appå°±æ²¡æ³•åœ¨LSPæ¨¡å—å†…å‹¾é€‰äº†ï¼Œä¼šæ˜¾ç¤ºåœ¨æ’é™¤åˆ—è¡¨å†…ï¼Œç„¶åå‘ˆç°è‰²çŠ¶æ€æ— æ³•å‹¾é€‰ã€‚&lt;code&gt;ä½¿ç”¨Shamikoçš„æ—¶å€™å¿…é¡»å…³é—­éµå®ˆæ’é™¤åˆ—è¡¨è¿™ä¸ªå¼€å…³ã€‚&lt;/code&gt;,åç»­åœ¨é…ç½®æ’é™¤åˆ—è¡¨é‡ŒæŠŠéœ€è¦éšè—çš„åº”ç”¨æ‰“ä¸Šé’©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é¢å…·rootåè¿‡ç¯å¢ƒæ£€æµ‹&#34;&gt;é¢å…·rootåè¿‡ç¯å¢ƒæ£€æµ‹ &lt;a href=&#34;#%e9%9d%a2%e5%85%b7root%e5%90%8e%e8%bf%87%e7%8e%af%e5%a2%83%e6%a3%80%e6%b5%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;å…³é—­magiskçš„Zygiskå¼€å…³ï¼Œåˆ·å…¥&lt;code&gt;Zygisk-Next&lt;/code&gt;æ¨¡å—ï¼Œä»£æ›¿é¢å…·çš„Zygiskæ¨¡å—ï¼Œé‡å¯æ‰‹æœº&lt;/li&gt;
&lt;li&gt;åˆ·å…¥&lt;code&gt;Shamiko&lt;/code&gt;æ¨¡å—ï¼Œé‡å¯æ‰‹æœº&lt;/li&gt;
&lt;li&gt;åˆ·å…¥&lt;code&gt;LSPosed&lt;/code&gt;æ¡†æ¶æ¨¡å—ï¼Œé‡å¯æ‰‹æœº&lt;/li&gt;
&lt;li&gt;åˆ·å…¥&lt;code&gt;PlayIntegrityFix&lt;/code&gt;æ¨¡å—,æ³¨æ„è¿™ä¸ªæ¨¡å—éœ€è¦å¼€å¯ç¿»å¢™ï¼Œéšè—bootloaderç¯å¢ƒæ£€æµ‹ï¼Œé‡å¯æ‰‹æœº&lt;/li&gt;
&lt;li&gt;ç„¶ååœ¨&lt;code&gt;magisk&lt;/code&gt;æ’é™¤åˆ—è¡¨å»æ’é™¤éœ€è¦éšè—çš„åº”ç”¨,å¦‚&lt;code&gt;momoæ£€æµ‹&lt;/code&gt;å°±å¯ä»¥è¿‡äº†&lt;/li&gt;
&lt;li&gt;ã€æ³¨æ„ï¼šå¦‚æœTEEå—æŸã€‘ï¼šåˆ·å…¥&lt;code&gt;Tricky-Store&lt;/code&gt;å’Œ&lt;code&gt;TrickyAddonModule&lt;/code&gt;å¢å¼ºæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—å¯ä»¥è§£å†³æŸäº›è®¾å¤‡ä¸Šå¯†é’¥è¯æ˜ä¸å®Œæ•´æˆ–æŸåçš„é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æŠ“åŒ…&#34;&gt;æŠ“åŒ… &lt;a href=&#34;#%e6%8a%93%e5%8c%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ç®€å•appç½‘é¡µè°ƒè¯•&#34;&gt;ç®€å•APPç½‘é¡µè°ƒè¯• &lt;a href=&#34;#%e7%ae%80%e5%8d%95app%e7%bd%91%e9%a1%b5%e8%b0%83%e8%af%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;chromeæµè§ˆå™¨è¾“å…¥ï¼š&lt;code&gt;chrome://inspect/#devices&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å®‰å“å¼€å¯USBè°ƒè¯•&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è¯ä¹¦å®‰è£…&#34;&gt;è¯ä¹¦å®‰è£… &lt;a href=&#34;#%e8%af%81%e4%b9%a6%e5%ae%89%e8%a3%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;è¯´æ˜ï¼šå®‰å“7.0ä»¥ä¸Šï¼Œéœ€è¦è§£é”BLå’Œrootæƒé™&lt;/li&gt;
&lt;li&gt;Charlesé…ç½® &lt;code&gt;help-&amp;gt;SSL Proxying-&amp;gt;install charels root cer&lt;/code&gt;  å®‰è£…ç”µè„‘è¯ä¹¦ï¼Œmacè¯ä¹¦æŸ¥çœ‹è¯¦æƒ… ä¿¡ä»»è¯ä¹¦&lt;/li&gt;
&lt;li&gt;ä¿å­˜è¯ä¹¦é…ç½® &lt;code&gt;help-&amp;gt;SSL Proxying-&amp;gt;save charels root cer&lt;/code&gt;  å®‰è£…ç”µè„‘è¯ä¹¦ï¼Œmacè¯ä¹¦æŸ¥çœ‹è¯¦æƒ… ä¿¡ä»»è¯ä¹¦&lt;/li&gt;
&lt;li&gt;è½¬æ¢è¯ä¹¦ï¼š&lt;code&gt;openssl x509 -inform DER -in charles-ssl-proxying-certificate.cer -out imac.crt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¤šæ ¼å¼è½¬æ¢å‘½ä»¤:&lt;code&gt;openssl x509 -inform PEM -outform DER -in {yourcert.pem} -out {yourcert.crt}&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;charlesæ— æ³•ä¸‹è½½è¯ä¹¦:è¯ä¹¦ä¿å­˜åˆ°æœ¬åœ°,adb push æ–‡ä»¶è·¯å¾„  &lt;code&gt;/sdcard/Download&lt;/code&gt;; è®¾ç½®â€”æ›´å¤šè®¾ç½®â€”ç³»ç»Ÿå®‰å…¨â€”åŠ å¯†ä¸å‡­æ®â€”ä»å­˜å‚¨è®¾å¤‡å®‰è£…è¯ä¹¦ï¼Œå…ˆæ¸…é™¤æ‰€æœ‰å‡­æ®ï¼Œåé€‰æ‹©SDå¡å®‰è£…&lt;/li&gt;
&lt;li&gt;å®‰è£…è¯ä¹¦ï¼š
&lt;ul&gt;
&lt;li&gt;è¿›å…¥ä»¥ä¸‹ç›®å½•ï¼š&lt;code&gt;/data/misc/user/0/cacerts-added&lt;/code&gt; å¯ä»¥çœ‹åˆ°åˆšæ‰å®‰è£…çš„è¯ä¹¦&lt;code&gt;.0&lt;/code&gt;ç»“å°¾çš„&lt;/li&gt;
&lt;li&gt;å°†systemåˆ†åŒºæŒ‚åœ¨ä¸ºå¯è¯»å†™ &lt;code&gt;mount -o rw,remount /system&lt;/code&gt; , å¦‚æœæœ‰çš„ç‰ˆæœ¬æŠ¥é”™å¯ä»¥æ›¿æ¢ &lt;code&gt;mount -o rw,remount /&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cp /data/misc/user/0/cacerts-added/xx.0  /system/etc/security/cacerts/&lt;/code&gt; ,å¹¶å°†æƒé™æ”¹æˆ644,ï¼ˆ&lt;code&gt;chmod -R 644 /system/etc/security/cacerts/xx.0&lt;/code&gt;ï¼‰,é‡å¯è®¾å¤‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®Œæˆä»¥ä¸Šé…ç½®ï¼Œå¤§éƒ¨åˆ†APPå¯ä»¥æŠ“åŒ…äº†ï¼Œå¦‚æœå‡ºç°åæŠ“åŒ…ï¼Œçœ‹ä¸‹é¢è§£å†³åŠæ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åæŠ“åŒ…è§£å†³iptables--redsocks2--charles-é€æ˜ä»£ç†æŠ“åŒ…&#34;&gt;(åæŠ“åŒ…è§£å†³)iptables + redsocks2 + Charles é€æ˜ä»£ç†æŠ“åŒ… &lt;a href=&#34;#%e5%8f%8d%e6%8a%93%e5%8c%85%e8%a7%a3%e5%86%b3iptables--redsocks2--charles-%e9%80%8f%e6%98%8e%e4%bb%a3%e7%90%86%e6%8a%93%e5%8c%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å…ˆæ‰“å¼€ä½ çš„APPï¼Œç„¶å&lt;code&gt;ps -ef | grep com.xxx.xxxxx&lt;/code&gt;å‘½ä»¤æ‰¾åˆ°æœ‰ä½ çš„åº”ç”¨åŒ…åé‚£ä¸€è¡Œï¼Œç¬¬ä¸€åˆ—å°±æ˜¯uid
é€šå¸¸ä½ çœ‹åˆ°çš„æ˜¯u0_a428è¿™æ ·çš„ï¼Œé‚£ä¹ˆåé¢çš„å‘½ä»¤ï¼Œuidç›¸å…³çš„å¯ä»¥å†™æˆ&lt;code&gt;u0_a428&lt;/code&gt;ï¼Œä¹Ÿå¯ä»¥å†™æˆ&lt;code&gt;10428&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€æ˜ä»£ç†ä¸‹è½½ï¼Œ&lt;code&gt;https://fh0.github.io/assets/android-redsocks2.tgz&lt;/code&gt; , æŠŠredsocks.confå’Œredsocks2_arm64æ¨é€åˆ°æ‰‹æœº&lt;code&gt;/data/local/tmp&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;redsocks.confé…ç½®å¦‚ä¸‹ ,å…¶ä¸­&lt;code&gt;bind&lt;/code&gt;å°±æ˜¯é€æ˜ä»£ç†åœ°å€ï¼Œ&lt;code&gt;relay&lt;/code&gt;å°±æ˜¯Charlesçš„ä»£ç†åœ°å€ ,æ³¨æ„é…ç½®æ–‡ä»¶çš„æ¯ä¸€å¯¹&lt;code&gt;{}&lt;/code&gt;åé¢éƒ½åº”è¯¥æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œå¦åˆ™ä¼šæç¤º&lt;code&gt;unclosed section&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;base {
    log_debug = off;
    log_info = on;
    log = stderr;
    daemon = off;
    redirector = iptables;
} 

redsocks {
    bind = &amp;#34;127.0.0.1:16677&amp;#34;; #æœ¬åœ°é€æ˜ä»£ç†åœ°å€
    relay = &amp;#34;192.168.3.141:7777&amp;#34;;  # Charles Socks-Proxyä»£ç†åœ°å€
    type = socks5;
    autoproxy = 0;
    timeout = 13;
} 
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;æ¨é€&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;adb push redsocks2_arm64 /data/local/tmp/
adb push redsocks.conf /data/local/tmp/
adb shell 
su
chmod +x /data/local/tmp/redsocks2_arm64
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;iptablesé…ç½®ï¼š
&lt;ul&gt;
&lt;li&gt;ä¿å­˜å¼€æœºåçš„iptablesæ–¹æ³•:&lt;code&gt;iptables-save &amp;gt; /data/local/tmp/iptables.rules&lt;/code&gt;;&lt;/li&gt;
&lt;li&gt;æ¢å¤æ–¹æ³•ï¼š &lt;code&gt;é‡å¯æ‰‹æœº&lt;/code&gt;ï¼Œ&lt;/li&gt;
&lt;li&gt;é…ç½®è½¬å‘
&lt;ul&gt;
&lt;li&gt;(å…¨è½¬å‘)é…ç½®å…¨è½¬å‘&lt;code&gt;iptables -t nat -A OUTPUT -p tcp ! -d 127.0.0.1 -m owner --uid-owner 10172 --dport 0:65535 -j DNAT --to-destination 127.0.0.1:16677&lt;/code&gt;, ä½œç”¨æ˜¯ï¼šå°†uidä¸º10428æ‰€è¯·æ±‚çš„åœ¨0-65535ç«¯å£ä¸Šçš„tcpæµé‡ï¼Œè½¬å‘åˆ°127.0.0.1:16677ï¼Œä½†æ˜¯æ’é™¤äº†æ¥è‡ª127.0.0.1çš„è¯·æ±‚&lt;/li&gt;
&lt;li&gt;(æŒ‰ç«¯å£è½¬å‘)é…ç½®ç«¯å£æŠ“åŒ…,å¦‚80ï¼Œ443&lt;code&gt;iptables -t nat -A OUTPUT -p tcp ! -d 127.0.0.1 -m owner --uid-owner 10172 -m multiport --dports 80,443 -j DNAT --to-destination 127.0.0.1:16677&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ é™¤è§„åˆ™&lt;code&gt;iptables -t nat -D OUTPUT -p tcp ! -d 127.0.0.1 -m owner --uid-owner 10172 --dport 0:65535 -j DNAT --to-destination 127.0.0.1:16677&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¯åŠ¨ &lt;code&gt;cd /data/local/tmp/ &amp;amp;&amp;amp; ./redsocks2_arm64&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹ä»£ç†å·¥å…·çš„socksä»£ç†æµé‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¸¸ç”¨å·¥å…·ä¸‹è½½åœ°å€&#34;&gt;å¸¸ç”¨å·¥å…·ä¸‹è½½åœ°å€ &lt;a href=&#34;#%e5%b8%b8%e7%94%a8%e5%b7%a5%e5%85%b7%e4%b8%8b%e8%bd%bd%e5%9c%b0%e5%9d%80&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;æ— éœ€rootæ²™ç®±æŠ“åŒ…å·¥å…·:https://github.com/android-hacker/VirtualXposed&lt;/li&gt;
&lt;li&gt;JustTrustMe:https://github.com/Fuzion24/JustTrustMe&lt;/li&gt;
&lt;li&gt;å®‰è£…æåŸºåŠ©æ‰‹apk:https://github.com/liuran001/GJZS&lt;/li&gt;
&lt;li&gt;SSLUnpinning:https://github.com/ac-pm/SSLUnpinning_Xposed\&lt;/li&gt;
&lt;li&gt;frida: &lt;a href=&#34;https://github.com/frida/frida/releases&#34;&gt;https://github.com/frida/frida/releases&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åç¼–è¯‘å·¥å…·ï¼šhttps://github.com/iBotPeaches/Apktool/releases&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;macå®‰è£…é›†åˆå·¥å…·&#34;&gt;macå®‰è£…é›†åˆå·¥å…· &lt;a href=&#34;#mac%e5%ae%89%e8%a3%85%e9%9b%86%e5%90%88%e5%b7%a5%e5%85%b7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;adb &lt;code&gt;brew cask install android-platform-tools&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;java-sdkå®‰è£…&lt;/li&gt;
&lt;li&gt;å®‰å“sdk-tools: &lt;a href=&#34;https://www.androiddevtools.cn/&#34;&gt;https://www.androiddevtools.cn/&lt;/a&gt; ä¸‹è½½build-tools&lt;/li&gt;
&lt;li&gt;jadx-gui: &lt;code&gt;brew install jadx å¯åŠ¨æ–¹æ³•ï¼šjadx-gui&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;scrcpy: è¿œç¨‹æŠ•å±å®‰å“æ‰‹æœº &lt;a href=&#34;https://github.com/Genymobile/scrcpy&#34;&gt;https://github.com/Genymobile/scrcpy&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç‰¹åˆ«macåœ¨pdè™šæ‹Ÿæœºå®‰è£…win10ä¸­çš„æ¨¡æ‹Ÿå™¨&#34;&gt;ç‰¹åˆ«ï¼šmacåœ¨PDè™šæ‹Ÿæœºå®‰è£…win10ä¸­çš„æ¨¡æ‹Ÿå™¨ &lt;a href=&#34;#%e7%89%b9%e5%88%abmac%e5%9c%a8pd%e8%99%9a%e6%8b%9f%e6%9c%ba%e5%ae%89%e8%a3%85win10%e4%b8%ad%e7%9a%84%e6%a8%a1%e6%8b%9f%e5%99%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;winç®¡ç†å‘˜è¿è¡Œ win10 è½¬å‘ç«¯å£&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;netsh interface portproxy add v4tov4 5555 127.0.0.1 5555 #æ¨¡æ‹Ÿå™¨ç«¯å£è½¬å‘åˆ°å¤–ç½‘
netsh interface portproxy del v4tov4 listenport=5555 #åˆ é™¤ç«¯å£è½¬å‘

#firdaæŠ“åŒ…
adb.exe forward tcp:27042 tcp:27042
adb.exe forward tcp:27043 tcp:27043
netsh interface portproxy add v4tov4 27042 127.0.0.1 27042 #firdaæŠ“åŒ…è½¬å‘å¤–ç½‘
netsh interface portproxy add v4tov4 27043 127.0.0.1 27043 #firdaæŠ“åŒ…è½¬å‘å¤–ç½‘

é›·ç”µæ¨¡æ‹Ÿå™¨
emulator-5554   device  å®é™…ç«¯å£ï¼š5555
emulator-5556   device  å®é™…ç«¯å£ï¼š5557  ï¼Œé›·ç”µæ˜¯+2çš„ç«¯å£é€’å¢
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;winæŸ¥çœ‹ç«¯å£è½¬å‘
&lt;code&gt;netsh interface portproxy show all&lt;/code&gt;
mac è¿œç¨‹è¿æ¥pdä¸­win10çš„æ¨¡æ‹Ÿå™¨
&lt;code&gt;adb connect 192.168.0.3:62001&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;adbå¯¼å‡ºå‘½ä»¤&#34;&gt;adbå¯¼å‡ºå‘½ä»¤ &lt;a href=&#34;#adb%e5%af%bc%e5%87%ba%e5%91%bd%e4%bb%a4&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;æ‰“å°å‡ºæ¥æ‰€æœ‰å®‰è£…åˆ°æ‰‹æœºä¸Šçš„APPåŒ…å : &lt;code&gt;adb  pm list package&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ‰¾å‡ºå®‰è£…åçš„åŒ…ååº”ç”¨çš„apkæ‰€åœ¨ä½ç½® : &lt;code&gt;adb  pm path com.ccb.longjiLife&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä¸‹è½½ï¼š&lt;code&gt;adb pull /data/app/com.ccb.longjiLife-MXDTkEBGW2u_cAwg20D4JQ==/base.apk  /Users/abner/Downloads/apk&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;åˆ·å…¥twrpæ“ä½œ&#34;&gt;åˆ·å…¥twrpæ“ä½œ &lt;a href=&#34;#%e5%88%b7%e5%85%a5twrp%e6%93%8d%e4%bd%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;çº¢ç±³note9-5gç‰ˆæœ¬æ“ä½œ&#34;&gt;çº¢ç±³note9 5Gç‰ˆæœ¬æ“ä½œ &lt;a href=&#34;#%e7%ba%a2%e7%b1%b3note9-5g%e7%89%88%e6%9c%ac%e6%93%8d%e4%bd%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;æ‰‹æœºè¿›å…¥fastboot&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;adb reboot bootloader
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åˆ·å…¥ TWRP&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;fastboot flash recovery /Users/abner/Downloads/RedmiNote95g-twrp.img
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;ä¸ºé˜²æ­¢é‡å¯æ‰‹æœº MIUI è‡ªåŠ¨æ›¿æ¢å›å®˜æ–¹ Recoveryï¼ŒæŒ‰ä½æ‰‹æœº&lt;code&gt;éŸ³é‡ä¸Šé”®&lt;/code&gt;ï¼Œå‘½ä»¤è¡ŒåŒæ—¶æ‰§è¡Œ&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;fastboot reboot recovery
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;åœ¨è¿›å…¥ TWRP åï¼ŒæŒ‚è½½â€œç³»ç»Ÿåˆ†åŒºä¸ºåªè¯»â€ã€‚è¿™é‡Œæ»‘åŠ¨æŒ‰é’®ä»¥å…è®¸ä¿®æ”¹ ï¼Œä¸ç„¶ä¸èƒ½ç¦æ­¢ MIUI æ›¿æ¢å›å®˜æ–¹ Recoveryã€‚&lt;/li&gt;
&lt;li&gt;ä¸‹è½½&lt;a href=&#34;https://github.com/topjohnwu/Magisk&#34;&gt;Magisk zipåŒ…&lt;/a&gt;ï¼Œä¸‹è½½apkæ–‡ä»¶ä¿®æ”¹ä¸ºzipåç¼€ï¼Œå¹¶æ¨é€åˆ°æ‰‹æœºï¼Œå¿…é¡»åœ¨&lt;code&gt;external_sd&lt;/code&gt;è·¯å¾„ä¸‹ä¸å¯ä»¥ä¿®æ”¹ï¼Œå› ä¸ºsdcardç›®å½•åŠ å¯†æ˜¯ä¹±ç &lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;adb push Magisk-v28.1.zip /external_sd/
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;ä¹±ç è§£å†³ï¼ŒåŒæ¸…dataçš„cacheï¼Œç„¶åå®‰è£…Magisk-v28.1.zipã€‚ç”±äº MIUI åœ¨å¯åŠ¨æ—¶ä¼šæ£€æŸ¥ System åˆ†åŒºå®Œæ•´æ€§ï¼Œä¸Šä¸€æ­¥ TWRP ä¿®æ”¹äº† System åˆ†åŒºï¼Œéœ€è¦é€šè¿‡åˆ·å…¥ Magisk ç§»é™¤å¯åŠ¨éªŒè¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Go modules è¯¦è§£</title>
      <link>https://abnerxc.github.io/go/mod%E8%AF%A6%E8%A7%A3/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/mod%E8%AF%A6%E8%A7%A3/</guid>
      <description>&lt;h1 id=&#34;go-modçš„ä»‹ç»&#34;&gt;go modçš„ä»‹ç» &lt;a href=&#34;#go-mod%e7%9a%84%e4%bb%8b%e7%bb%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æˆ‘ä»¬ä»¥å‰ç”¨ go get è·å–ä¾èµ–å…¶å®æ˜¯æœ‰æ½œåœ¨å±é™©çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ç¡®å®šæœ€æ–°ç‰ˆä¾èµ–æ˜¯å¦ä¼šç ´åæ‰æˆ‘ä»¬é¡¹ç›®å¯¹ä¾èµ–åŒ…çš„ä½¿ç”¨æ–¹å¼ï¼Œå³å½“å‰é¡¹ç›®å¯èƒ½ä¼šå‡ºç°ä¸å…¼å®¹æœ€æ–°ä¾èµ–åŒ…çš„é—®é¢˜ã€‚éšç€ go1.11 çš„å‘å¸ƒï¼Œgo ç»™æˆ‘ä»¬å¸¦æ¥äº† module æ–°ç‰¹æ€§ï¼Œè¿™æ˜¯ Go è¯­è¨€æ–°çš„ä¸€å¥—ä¾èµ–ç®¡ç†ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ$GOPATH é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸æ”¯æŒ go mudules çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;code&gt;$ export GO111MODULE=on&lt;/code&gt;,è¿™ä¹Ÿè¡¨æ˜äº† go è¦åˆ©ç”¨ modules æœºåˆ¶æ¶ˆç­ $GOPATH çš„å†³å¿ƒå•Šï¼&lt;/p&gt;
&lt;p&gt;GO111MODULEå¯ä»¥è®¾ç½®ä¸ºä¸‰ä¸ªå­—ç¬¦ä¸²å€¼ä¹‹ä¸€ï¼šoffï¼Œonæˆ–autoï¼ˆé»˜è®¤å€¼ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;off : goå‘½ä»¤ä»ä¸ä½¿ç”¨æ–°æ¨¡å—æ”¯æŒã€‚å®ƒæŸ¥æ‰¾vendor ç›®å½•å’ŒGOPATHä»¥æŸ¥æ‰¾ä¾èµ–å…³ç³»;ä¹Ÿå°±æ˜¯ç»§ç»­ä½¿ç”¨â€œGOPATHæ¨¡å¼â€ã€‚&lt;/li&gt;
&lt;li&gt;on : goå‘½ä»¤éœ€è¦ä½¿ç”¨æ¨¡å—ï¼Œgo ä¼šå¿½ç•¥ $GOPATH å’Œ vendor æ–‡ä»¶å¤¹ï¼Œåªæ ¹æ®go.modä¸‹è½½ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;auto æˆ–æœªè®¾ç½®: goå‘½ä»¤æ ¹æ®å½“å‰ç›®å½•å¯ç”¨æˆ–ç¦ç”¨æ¨¡å—æ”¯æŒã€‚ä»…å½“å½“å‰ç›®å½•ä½äº$GOPATH/srcä¹‹å¤–å¹¶ä¸”å…¶æœ¬èº«åŒ…å«go.modæ–‡ä»¶æˆ–ä½äºåŒ…å«go.modæ–‡ä»¶çš„ç›®å½•ä¸‹æ—¶ï¼Œæ‰å¯ç”¨æ¨¡å—æ”¯æŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¼”ç¤ºä½¿ç”¨æ•™ç¨‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºé¡¹ç›®,ä¸ºäº†é…åˆ go modules æœºåˆ¶ï¼Œæˆ‘ä»¬ $GOPATH ä»¥å¤–çš„ç›®å½•åˆ›å»ºä¸€ä¸ª testmod çš„åŒ…ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ mkdir testmod
$ cd testmod

$ echo &amp;#39;package testmod
		import &amp;#34;fmt&amp;#34;
	func Hi(name string) string {
        return fmt.Sprintf(&amp;#34;Hi, %s&amp;#34;, name)
}&amp;#39; &amp;gt;&amp;gt; testmod.go
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;åˆå§‹åŒ–module&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ go mod init github.com/objcoding/testmod
#è¿™é‡Œå¦‚æœæ˜¯ä»gitä¸‹æ¥çš„ï¼Œå¯ä»¥ç›´æ¥è¿›å…¥é¡¹ç›®é‡Œé¢æ‰§è¡Œgo init
go: creating new go.mod: module github.com/objcoding/testmod
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;æ¨é€åˆ° github ä»“åº“&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git init
$ git add *
$ git commit -am &amp;#34;First commit&amp;#34;
$ git push -u origin master
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;go-mudules-ç‰ˆæœ¬è§„åˆ™&#34;&gt;go mudules ç‰ˆæœ¬è§„åˆ™ &lt;a href=&#34;#go-mudules-%e7%89%88%e6%9c%ac%e8%a7%84%e5%88%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;go modules æ˜¯ä¸€ä¸ªç‰ˆæœ¬åŒ–ä¾èµ–ç®¡ç†ç³»ç»Ÿï¼Œç‰ˆæœ¬éœ€è¦éµå¾ªä¸€äº›è§„åˆ™ï¼Œæ¯”å¦‚ç‰ˆæœ¬å·éœ€è¦éµå¾ªä»¥ä¸‹æ ¼å¼ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vX.Y.Z-pre.0.yyyymmddhhmmss-abcdefabcdef
vX.0.0-yyyymmddhhmmss-abcdefabcdef
vX.Y.(Z+1)-0.yyyymmddhhmmss-abcdefabcdef
vX.Y.Z
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;vX.Y.Z æ˜¯æˆ‘ä»¬ä»“åº“æ‰“çš„æ ‡ç­¾ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ go modules æ˜¯æ ¹æ®ä»“åº“æ ‡ç­¾æ¥ç¡®å®šç‰ˆæœ¬å·çš„ï¼Œå› æ­¤æˆ‘ä»¬å‘å¸ƒç‰ˆæœ¬æ—¶ï¼Œéœ€è¦ç»™æˆ‘ä»¬çš„ä»“åº“æ‰“ä¸Šä¸€ä¸ªæ ‡ç­¾ç‰ˆæœ¬å·ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯ç‰ˆæœ¬å· + æ—¶é—´æˆ³ +hashï¼Œæˆ‘ä»¬è‡ªå·±æŒ‡å®šç‰ˆæœ¬æ—¶åªéœ€è¦æŒ‡å®šç‰ˆæœ¬å·å³å¯ï¼Œæ²¡æœ‰ç‰ˆæœ¬ tag çš„åˆ™éœ€è¦æ‰¾åˆ°å¯¹åº” commit çš„æ—¶é—´å’Œ hash å€¼ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„è§„åˆ™æ˜¯ï¼Œç‰ˆæœ¬ 0 å’Œ 1ï¼Œæœ€å¥½éœ€è¦æœ‰ä¸åŒçš„ä¾èµ–è·¯å¾„ï¼Œå¦‚ï¼šv1.0.0 å’Œ v2.0.0 æ˜¯æœ‰ä¸åŒçš„ä¾èµ–è·¯å¾„ï¼Œä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬è§„åˆ™ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å‘å¸ƒç‰ˆæœ¬&#34;&gt;å‘å¸ƒç‰ˆæœ¬ &lt;a href=&#34;#%e5%8f%91%e5%b8%83%e7%89%88%e6%9c%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;äº†è§£äº† go modules çš„ç‰ˆæœ¬è§„åˆ™åï¼Œç°åœ¨æˆ‘ä»¬å‘å¸ƒä¸€ä¸‹è¯¥é¡¹ç›®çš„ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git tag v1.0.0
$ git push --tags
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ—¶æˆ‘ä»¬æœ€å¥½è¿˜éœ€è¦åˆ›å»ºä¸€æ¡ v1 åˆ†æ”¯ï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨å…¶å®ƒåˆ†æ”¯å†™ä»£ç ä¸ä¼šå½±å“åˆ° v1.0.0 ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git checkout -b v1
$ git push -u origin v1
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;å‡çº§ç‰ˆæœ¬&#34;&gt;å‡çº§ç‰ˆæœ¬ &lt;a href=&#34;#%e5%8d%87%e7%ba%a7%e7%89%88%e6%9c%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git commit -m &amp;#34;update testmod&amp;#34; testmod.go
$ git tag v1.0.1
$ git push --tags origin v1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬çš„ é¡¹ç›®å·²ç»å‡çº§åˆ° v1.0.1 ç‰ˆæœ¬äº†ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¤šç§æ–¹å¼è·å–è¿™ä¸ªç‰ˆæœ¬ä¾èµ–ï¼Œgo1.11 ä¸­ï¼Œgo get æ‹¥æœ‰äº†å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è·å– v1.01 ç‰ˆæœ¬ä¾èµ–ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ go get github.com/objcoding/testmod@v1.0.1
æˆ–è€…
$ go mod edit -require=&amp;#34;github.com/objcoding/testmod@v1.0.1&amp;#34;
$ go mod tidy
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;go mod edit -require å¯ä»¥ä¸»åŠ¨ä¿®æ”¹ go.md æ–‡ä»¶ä¸­ä¾èµ–çš„ç‰ˆæœ¬å·ï¼Œç„¶åé€šè¿‡ go mod tidy å¯¹ç‰ˆæœ¬è¿›è¡Œæ›´æ–°ï¼Œå®ƒä¼šè‡ªåŠ¨æ¸…ç†æ‰ä¸éœ€è¦çš„ä¾èµ–é¡¹ï¼ŒåŒæ—¶å¯ä»¥å°†ä¾èµ–é¡¹æ›´æ–°åˆ°å½“å‰ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸»è¦ç‰ˆæœ¬å‡çº§&#34;&gt;ä¸»è¦ç‰ˆæœ¬å‡çº§ &lt;a href=&#34;#%e4%b8%bb%e8%a6%81%e7%89%88%e6%9c%ac%e5%8d%87%e7%ba%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä¸Šé¢ç‰ˆæœ¬è§„åˆ™è¯´äº†ï¼Œç‰ˆæœ¬ 0 å’Œ 1ï¼Œå³å¤§ç‰ˆæœ¬æ›´æ–°ï¼Œæœ€å¥½éœ€è¦æœ‰ä¸åŒçš„ä¾èµ–è·¯å¾„ï¼Œå¦‚ï¼šv1.0.0 å’Œ v2.0.0 æ˜¯æœ‰ä¸åŒçš„ä¾èµ–è·¯å¾„ï¼Œé‚£ä¹ˆç”¨ go modules æ€ä¹ˆå®ç°å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ go.mod æ–‡ä»¶ç¬¬ä¸€è¡Œæ·»åŠ æ–°è·¯å¾„ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ cd testmod
$ echo &amp;#39;module github.com/objcoding/testmod/v2&amp;#39; &amp;gt;&amp;gt; go.mod
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬ä¿®æ”¹ testmod å‡½æ•° Hi()ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ cd testmod

$ echo &amp;#39;package testmod
import (
	&amp;#34;fmt&amp;#34;
	&amp;#34;errors&amp;#34;
)
func Hi(name, lang string) (string, error) {
	switch lang {
	case &amp;#34;en&amp;#34;:
		return fmt.Sprintf(&amp;#34;Hi, %s!&amp;#34;, name), nil
	default:
		return &amp;#34;&amp;#34;, errors.New(&amp;#34;unknown language&amp;#34;)
	}
}&amp;#39; &amp;gt;&amp;gt; testmod.go
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ—¶ï¼ŒHi() æ–¹æ³•å°†ä¸å…¼å®¹ v1 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ª v2.0.0 ç‰ˆæœ¬ï¼Œè¿˜æ˜¯è€æ ·å­ï¼Œæˆ‘ä»¬æœ€å¥½åœ¨ v2.0.0 ç‰ˆæœ¬æ–°å»ºä¸€æ¡ v2 åˆ†åˆ†æ”¯ï¼Œå°† v2.0.0 ç‰ˆæœ¬çš„ä»£ç å†™åˆ°è¿™æ¡åˆ†æ”¯ä¸­ï¼ˆè¿™åªæ˜¯ä¸€ä¸ªè§„èŒƒï¼Œå®é™…ä¸Šä½ å°†ä»£ç ä¹Ÿå†™åˆ°ä»»ä½•åˆ†æ”¯ä¸­éƒ½è¡Œï¼Œgoå¹¶æ²¡æœ‰è¿™ä¸ªè§„èŒƒï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git add *
$ git checkout -b v2
$ git commit testmod.go -m &amp;#34;v2.0.0&amp;#34;
$ git tag v2.0.0
$ git push --tags origin v2
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬ä¿®æ”¹ä»£ç ä¸­çš„ç‰ˆæœ¬import,ä¸ºv2&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main
import (
    &amp;#34;fmt&amp;#34;
  	&amp;#34;github.com/objcoding/testmod/v2&amp;#34;
)
func main() {
    fmt.Println(testmod.Hi(&amp;#34;zch&amp;#34;, &amp;#34;en&amp;#34;))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åæ‰§è¡Œ&lt;code&gt;go mod tidy&lt;/code&gt;ï¼Œgo mod ä¼šè‡ªåŠ¨æ›´æ–°åˆ°v2.0.0ç‰ˆæœ¬&lt;/p&gt;
&lt;h1 id=&#34;go-modules-å‘½ä»¤å¤§å…¨&#34;&gt;go modules å‘½ä»¤å¤§å…¨ &lt;a href=&#34;#go-modules-%e5%91%bd%e4%bb%a4%e5%a4%a7%e5%85%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go help modules

go modå‘½ä»¤

download    download modules to local cache (ä¸‹è½½ä¾èµ–çš„moduleåˆ°æœ¬åœ°cache))
edit        edit go.mod from tools or scripts (ç¼–è¾‘go.modæ–‡ä»¶)
graph       print module requirement graph (æ‰“å°æ¨¡å—ä¾èµ–å›¾))
init        initialize new module in current directory (å†å½“å‰æ–‡ä»¶å¤¹ä¸‹åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„module, åˆ›å»ºgo.modæ–‡ä»¶))
tidy        add missing and remove unused modules (å¢åŠ ä¸¢å¤±çš„moduleï¼Œå»æ‰æœªç”¨çš„module)
vendor      make vendored copy of dependencies (å°†ä¾èµ–å¤åˆ¶åˆ°vendorä¸‹)
verify      verify dependencies have expected content (æ ¡éªŒä¾èµ–)
why         explain why packages or modules are needed (è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–)

åˆå§‹åŒ–mod

go mod init [module]å¯ä»¥åˆ›å»ºä¸€ä¸ªgo.modï¼Œåªæœ‰ä¸€è¡Œä¿¡æ¯moduleã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;go-ç¿»å¢™&#34;&gt;go ç¿»å¢™ &lt;a href=&#34;#go-%e7%bf%bb%e5%a2%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;swagå®‰è£…ä¸ºä¾‹&lt;/p&gt;
&lt;p&gt;mac/linux swag å®‰è£…&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-code&#34; data-lang=&#34;code&#34;&gt;## 127.0.0.1:1087 æ˜¯ ssrçš„hhtpä»£ç†
$ git config --global http.proxy &amp;#34;127.0.0.1:1087&amp;#34;
$ http_proxy=127.0.0.1:1087 go get -u -v github.com/swaggo/swag/cmd/swag
$ git config --global --unset-all http.proxy
$ git config --global --unset-all https.proxy
$ cd $GOPATH/src/github.com/swaggo/swag/cmd/swag
$ go install
$ swag -v #éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;window goget.batæ–‡ä»¶&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;@echo off

set http_proxy=socks5://127.0.0.1:1080
set https_proxy=socks5://127.0.0.1:1080

go get -u -v %*

echo ...

pause
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;git bashä¸Šç”¨goget.bat urlå°±è¡Œäº†~&lt;/p&gt;
&lt;h1 id=&#34;è‡ªå»ºgoproxy-server&#34;&gt;è‡ªå»ºGOPROXY server &lt;a href=&#34;#%e8%87%aa%e5%bb%bagoproxy-server&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é¡¹ç›®åœ°å€ &lt;a href=&#34;https://github.com/gomods/athens&#34;&gt;https://github.com/gomods/athens&lt;/a&gt;
Athenså¯ä»¥ç”¨æ¥åœ¨å…¬å¸å†…éƒ¨å»ºç«‹è‡ªå·±çš„ç§æœ‰go modæœåŠ¡å™¨ï¼Œæˆ–è€…åœ¨å…¬ç½‘å»ºç«‹ä¸€ä¸ªå¯¹å¤–å…¬å¼€çš„GOPROXY serverã€‚&lt;/p&gt;
&lt;h1 id=&#34;å¯ç”¨é•œåƒ&#34;&gt;å¯ç”¨é•œåƒ &lt;a href=&#34;#%e5%8f%af%e7%94%a8%e9%95%9c%e5%83%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;é˜¿é‡Œäº‘:https://mirrors.aliyun.com/goproxy/&lt;/li&gt;
&lt;li&gt;goä»£ç†:https://goproxy.io&lt;/li&gt;
&lt;li&gt;goä»£ç†:https://goproxy.cn&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Go-logæ—¥å¿—</title>
      <link>https://abnerxc.github.io/go/log%E6%97%A5%E5%BF%97/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/log%E6%97%A5%E5%BF%97/</guid>
      <description>&lt;h1 id=&#34;æ—¥å¿—ä½¿ç”¨&#34;&gt;æ—¥å¿—ä½¿ç”¨ &lt;a href=&#34;#%e6%97%a5%e5%bf%97%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;oè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›äº†æ ‡å‡†çš„logåŒ…ï¼Œæ¥è·Ÿè¸ªæ—¥å¿—çš„è®°å½•ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æ—¥å¿—åŒ…logçš„ä½¿ç”¨&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	log.Println(&amp;#34;è¿™æ˜¯ç™¾åº¦åœ°å€:&amp;#34;,&amp;#34;http://www.baidu.com&amp;#34;)
	log.Printf(&amp;#34;è¿™æ˜¯ç™¾åº¦åœ°å€åŸŸåï¼š%s\n&amp;#34;,&amp;#34;baidu.com&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2019/08/28 13:18:44 è¿™æ˜¯ç™¾åº¦åœ°å€: http://www.baidu.com
2019/08/28 13:18:44 è¿™æ˜¯ç™¾åº¦åœ°å€åŸŸåï¼šbaidu.com
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æœ‰äº†æ—¶é—´äº†ï¼Œæˆ‘ä»¬è¿˜æƒ³è¦æ›´å¤šçš„ä¿¡æ¯ï¼Œå¿…ç„¶å‘ç”Ÿçš„æºä»£ç è¡Œå·ç­‰ï¼Œå¯¹æ­¤æ—¥å¿—åŒ…log ä¸ºæˆ‘ä»¬æä¾›äº†å¯å®šåˆ¶åŒ–çš„é…åˆ¶ï¼Œè®©æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šåˆ¶æ—¥å¿—çš„æŠ¬å¤´ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func init(){
	log.SetFlags(log.Ldate|log.Lshortfile)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;init&lt;/code&gt;å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨&lt;code&gt;main&lt;/code&gt;å‡½æ•°æ‰§è¡Œä¹‹å‰å°±å¯ä»¥åˆå§‹åŒ–ï¼Œå¯ä»¥å¸®æˆ‘ä»¬åšä¸€äº›é…ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬è‡ªå®šä¹‰æ—¥å¿—çš„æŠ¬å¤´ä¿¡æ¯ä¸ºæ—¶é—´+æ–‡ä»¶å+æºä»£ç æ‰€åœ¨è¡Œå·ã€‚ä¹Ÿå°±æ˜¯&lt;code&gt;log.Ldate|log.Lshortfile,&lt;/code&gt;ä¸­é—´æ˜¯ä¸€ä¸ªä½è¿ç®—ç¬¦&lt;code&gt;|&lt;/code&gt;ï¼Œç„¶åé€šè¿‡å‡½æ•°&lt;code&gt;log.SetFlags&lt;/code&gt;è¿›è¡Œè®¾ç½®ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2017/04/29 main.go:10: é£é›ªæ— æƒ…çš„åšå®¢: http://www.flysnow.org
2017/04/29 main.go:11: é£é›ªæ— æƒ…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šflysnow_org
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çœ‹çœ‹&lt;code&gt;log&lt;/code&gt;åŒ…ä¸ºæˆ‘ä»¬æä¾›äº†é‚£äº›å¯ä»¥å®šä¹‰çš„é€‰é¡¹å¸¸é‡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const (
	Ldate         = 1 &amp;lt;&amp;lt; iota     //æ—¥æœŸç¤ºä¾‹ï¼š 2009/01/23
	Ltime                         //æ—¶é—´ç¤ºä¾‹: 01:23:23
	Lmicroseconds                 //æ¯«ç§’ç¤ºä¾‹: 01:23:23.123123.
	Llongfile                     //ç»å¯¹è·¯å¾„å’Œè¡Œå·: /a/b/c/d.go:23
	Lshortfile                    //æ–‡ä»¶å’Œè¡Œå·: d.go:23.
	LUTC                          //æ—¥æœŸæ—¶é—´è½¬ä¸º0æ—¶åŒºçš„
	LstdFlags     = Ldate | Ltime //Goæä¾›çš„æ ‡å‡†æŠ¬å¤´ä¿¡æ¯
)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ˜¯logåŒ…å®šä¹‰çš„ä¸€äº›æŠ¬å¤´ä¿¡æ¯ï¼Œæœ‰æ—¥æœŸã€æ—¶é—´ã€æ¯«ç§’æ—¶é—´ã€ç»å¯¹è·¯å¾„å’Œè¡Œå·ã€æ–‡ä»¶åå’Œè¡Œå·ç­‰ï¼Œåœ¨ä¸Šé¢éƒ½æœ‰æ³¨é‡Šè¯´æ˜ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœè®¾ç½®äº†&lt;code&gt;Lmicroseconds&lt;/code&gt;ï¼Œé‚£ä¹ˆ&lt;code&gt;Ltime&lt;/code&gt;å°±ä¸ç”Ÿæ•ˆäº†ï¼›è®¾ç½®äº†&lt;code&gt;Lshortfile&lt;/code&gt;ï¼Œ &lt;code&gt;Llongfile&lt;/code&gt;ä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œå¤§å®¶è‡ªå·±å¯ä»¥æµ‹è¯•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;LUTC&lt;/code&gt;æ¯”è¾ƒç‰¹æ®Šï¼Œå¦‚æœæˆ‘ä»¬é…ç½®äº†æ—¶é—´æ ‡ç­¾ï¼Œé‚£ä¹ˆå¦‚æœè®¾ç½®äº†LUTCçš„è¯ï¼Œå°±ä¼šæŠŠè¾“å‡ºçš„æ—¥æœŸæ—¶é—´è½¬ä¸º0æ—¶åŒºçš„æ—¥æœŸæ—¶é—´æ˜¾ç¤ºã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;log.SetFlags(log.Ldate|log.Ltime |log.LUTC)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é‚£ä¹ˆå¯¹æˆ‘ä»¬ä¸œå…«åŒºçš„æ—¶é—´æ¥è¯´ï¼Œå°±ä¼šå‡å»8ä¸ªå°æ—¶ï¼Œæˆ‘ä»¬çœ‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2017/04/29 05:46:29 é£é›ªæ— æƒ…çš„åšå®¢: http://www.flysnow.org
2017/04/29 05:46:29 é£é›ªæ— æƒ…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šflysnow_org
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æœ€åä¸€ä¸ª&lt;code&gt;LstdFlags&lt;/code&gt;è¡¨ç¤ºæ ‡å‡†çš„æ—¥å¿—æŠ¬å¤´ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤çš„ï¼ŒåŒ…å«æ—¥æœŸå’Œå…·ä½“æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æœ‰å¾ˆå¤šä¸šåŠ¡ï¼Œæ¯ä¸ªä¸šåŠ¡éƒ½éœ€è¦è®°å½•æ—¥å¿—ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•ï¼Œèƒ½åŒºåˆ†è¿™äº›ä¸šåŠ¡å‘¢ï¼Ÿè¿™æ ·æˆ‘ä»¬åœ¨æŸ¥æ‰¾æ—¥å¿—çš„æ—¶å€™ï¼Œå°±æ–¹ä¾¿å¤šäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºè¿™ç§æƒ…å†µï¼ŒGoè¯­è¨€ä¹Ÿå¸®æˆ‘ä»¬è€ƒè™‘åˆ°äº†ï¼Œè¿™å°±æ˜¯è®¾ç½®æ—¥å¿—çš„å‰ç¼€ï¼Œæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·ä¸­å¿ƒç³»ç»Ÿçš„æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè®¾ç½®ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func init(){
	log.SetPrefix(&amp;#34;ã€UserCenterã€‘&amp;#34;)
	log.SetFlags(log.LstdFlags | log.Lshortfile |log.LUTC)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€šè¿‡&lt;code&gt;log.SetPrefix&lt;/code&gt;å¯ä»¥æŒ‡å®šè¾“å‡ºæ—¥å¿—çš„å‰ç¼€ï¼Œè¿™é‡Œæˆ‘ä»¬æŒ‡å®šä¸º&lt;code&gt;ã€UserCenterã€‘&lt;/code&gt;ï¼Œç„¶åå°±å¯ä»¥çœ‹åˆ°æ—¥å¿—çš„æ‰“å°è¾“å‡ºå·²ç»æ¸…æ™°çš„æ ‡è®°å‡ºæˆ‘ä»¬çš„è¿™äº›æ—¥å¿—æ˜¯å±äºå“ªäº›ä¸šåŠ¡çš„å•¦ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ã€UserCenterã€‘2017/04/29 05:53:26 main.go:11: é£é›ªæ— æƒ…çš„åšå®¢: http://www.flysnow.org
ã€UserCenterã€‘2017/04/29 05:53:26 main.go:12: é£é›ªæ— æƒ…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šflysnow_org
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;log&lt;/code&gt;åŒ…é™¤äº†æœ‰&lt;code&gt;Print&lt;/code&gt;ç³»åˆ—çš„å‡½æ•°ï¼Œè¿˜æœ‰&lt;code&gt;Fatal&lt;/code&gt;ä»¥åŠ&lt;code&gt;Panic&lt;/code&gt;ç³»åˆ—çš„å‡½æ•°ï¼Œå…¶ä¸­&lt;code&gt;Fatal&lt;/code&gt;è¡¨ç¤ºç¨‹åºé‡åˆ°äº†è‡´å‘½çš„é”™è¯¯ï¼Œéœ€è¦é€€å‡ºï¼Œè¿™æ—¶å€™ä½¿ç”¨&lt;code&gt;Fatal&lt;/code&gt;è®°å½•æ—¥å¿—åï¼Œç„¶åç¨‹åºé€€å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´Fatalç›¸å½“äºå…ˆè°ƒç”¨&lt;code&gt;Print&lt;/code&gt;æ‰“å°æ—¥å¿—ï¼Œç„¶åå†è°ƒç”¨&lt;code&gt;os.Exit(1)&lt;/code&gt;é€€å‡ºç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;åŒç†&lt;code&gt;Panic&lt;/code&gt;ç³»åˆ—çš„å‡½æ•°ä¹Ÿä¸€æ ·ï¼Œè¡¨ç¤ºå…ˆä½¿ç”¨&lt;code&gt;Print&lt;/code&gt;è®°å½•æ—¥å¿—ï¼Œç„¶åè°ƒç”¨&lt;code&gt;panic()&lt;/code&gt;å‡½æ•°æŠ›å‡ºä¸€ä¸ªææ…Œï¼Œè¿™æ—¶å€™é™¤éä½¿ç”¨&lt;code&gt;recover()&lt;/code&gt;å‡½æ•°ï¼Œå¦åˆ™ç¨‹åºå°±ä¼šæ‰“å°é”™è¯¯å †æ ˆä¿¡æ¯ï¼Œç„¶åç¨‹åºç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè´´ä¸‹è¿™å‡ ä¸ªç³»åˆ—å‡½æ•°çš„æºä»£ç ï¼Œæ›´å¥½ç†è§£ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Println(v ...interface{}) {
	std.Output(2, fmt.Sprintln(v...))
}

func Fatalln(v ...interface{}) {
	std.Output(2, fmt.Sprintln(v...))
	os.Exit(1)
}

func Panicln(v ...interface{}) {
	s := fmt.Sprintln(v...)
	std.Output(2, s)
	panic(s)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;å®ç°åŸç†&#34;&gt;å®ç°åŸç† &lt;a href=&#34;#%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é€šè¿‡ä¸Šé¢çš„æºä»£ç ï¼Œæˆ‘ä»¬å‘ç°ï¼Œæ—¥å¿—åŒ…&lt;code&gt;log&lt;/code&gt;çš„è¿™äº›å‡½æ•°éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå…³é”®çš„è¾“å‡ºæ—¥å¿—å°±åœ¨äº&lt;code&gt;std.Output&lt;/code&gt;æ–¹æ³•&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func New(out io.Writer, prefix string, flag int) *Logger {
	return &amp;amp;Logger{out: out, prefix: prefix, flag: flag}
}

var std = New(os.Stderr, &amp;#34;&amp;#34;, LstdFlags)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»ä»¥ä¸Šæºä»£ç å¯ä»¥çœ‹å‡ºï¼Œå˜é‡&lt;code&gt;std&lt;/code&gt;å…¶å®æ˜¯ä¸€ä¸ª&lt;code&gt;*Logger&lt;/code&gt;ï¼Œé€šè¿‡&lt;code&gt;log.New&lt;/code&gt;å‡½æ•°åˆ›å»ºï¼Œé»˜è®¤è¾“å‡ºåˆ°&lt;code&gt;os.Stderr&lt;/code&gt;è®¾å¤‡ï¼Œå‰ç¼€ä¸ºç©ºï¼Œæ—¥å¿—æŠ¬å¤´ä¿¡æ¯ä¸ºæ ‡å‡†æŠ¬å¤´&lt;code&gt;LstdFlags&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;os.Stderr&lt;/code&gt;å¯¹åº”çš„æ˜¯UNIXé‡Œçš„æ ‡å‡†é”™è¯¯è­¦å‘Šä¿¡æ¯çš„è¾“å‡ºè®¾å¤‡ï¼ŒåŒæ—¶è¢«ä½œä¸ºé»˜è®¤çš„æ—¥å¿—è¾“å‡ºç›®çš„åœ°ã€‚åˆæ¬¡ä¹‹å¤–ï¼Œè¿˜æœ‰æ ‡å‡†è¾“å‡ºè®¾å¤‡&lt;code&gt;os.Stdout&lt;/code&gt;ä»¥åŠæ ‡å‡†è¾“å…¥è®¾å¤‡&lt;code&gt;os.Stdin&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var (
	Stdin  = NewFile(uintptr(syscall.Stdin), &amp;#34;/dev/stdin&amp;#34;)
	Stdout = NewFile(uintptr(syscall.Stdout), &amp;#34;/dev/stdout&amp;#34;)
	Stderr = NewFile(uintptr(syscall.Stderr), &amp;#34;/dev/stderr&amp;#34;)
)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯å®šä¹‰çš„UNIXçš„æ ‡å‡†çš„ä¸‰ç§è®¾å¤‡ï¼Œåˆ†åˆ«ç”¨äºè¾“å…¥ã€è¾“å‡ºå’Œè­¦å‘Šé”™è¯¯ä¿¡æ¯ã€‚ç†è§£äº†&lt;code&gt;os.Stderr&lt;/code&gt;ï¼Œç°åœ¨æˆ‘ä»¬çœ‹ä¸‹&lt;code&gt;Logger&lt;/code&gt;è¿™ä¸ªç»“æ„ä½“ï¼Œæ—¥å¿—çš„ä¿¡æ¯å’Œæ“ä½œï¼Œéƒ½æ˜¯é€šè¿‡è¿™ä¸ª&lt;code&gt;Logger&lt;/code&gt;æ“ä½œçš„ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Logger struct {
	mu     sync.Mutex // å­—æ®µmuæ˜¯ä¸€ä¸ªäº’æ–¥é”ï¼Œä¸»è¦æ˜¯æ˜¯ä¿è¯è¿™ä¸ªæ—¥å¿—è®°å½•å™¨Loggeråœ¨å¤šgoroutineä¸‹ä¹Ÿæ˜¯å®‰å…¨çš„
	prefix string     // å­—æ®µprefixæ˜¯æ¯ä¸€è¡Œæ—¥å¿—çš„å‰ç¼€
	flag   int        // å­—æ®µflagæ˜¯æ—¥å¿—æŠ¬å¤´ä¿¡æ¯
	out    io.Writer  // å­—æ®µoutæ˜¯æ—¥å¿—è¾“å‡ºçš„ç›®çš„åœ°ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯os.Stderrã€‚
	buf    []byte     // å­—æ®µbufæ˜¯ä¸€æ¬¡æ—¥å¿—è¾“å‡ºæ–‡æœ¬ç¼“å†²ï¼Œæœ€ç»ˆä¼šè¢«å†™åˆ°outé‡Œã€‚
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;äº†è§£äº†ç»“æ„ä½“&lt;code&gt;Logger&lt;/code&gt;çš„å­—æ®µï¼Œç°åœ¨å°±å¯ä»¥çœ‹ä¸‹å®ƒæœ€é‡è¦çš„æ–¹æ³•&lt;code&gt;Output&lt;/code&gt;äº†ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¾“å‡ºæ ¼å¼åŒ–å¥½çš„æ—¥å¿—ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (l *Logger) Output(calldepth int, s string) error {
	now := time.Now() // get this early.
	var file string
	var line int
	//åŠ é”ï¼Œä¿è¯å¤šgoroutineä¸‹çš„å®‰å…¨
	l.mu.Lock()
	defer l.mu.Unlock()
	//å¦‚æœé…ç½®äº†è·å–æ–‡ä»¶å’Œè¡Œå·çš„è¯
	if l.flag&amp;amp;(Lshortfile|Llongfile) != 0 {
		//å› ä¸ºruntime.Callerä»£ä»·æ¯”è¾ƒå¤§ï¼Œå…ˆä¸åŠ é”
		l.mu.Unlock()
		var ok bool
		_, file, line, ok = runtime.Caller(calldepth)
		if !ok {
			file = &amp;#34;???&amp;#34;
			line = 0
		}
		//è·å–åˆ°è¡Œå·ç­‰ä¿¡æ¯åï¼Œå†åŠ é”ï¼Œä¿è¯å®‰å…¨
		l.mu.Lock()
	}
	//æŠŠæˆ‘ä»¬çš„æ—¥å¿—ä¿¡æ¯å’Œè®¾ç½®çš„æ—¥å¿—æŠ¬å¤´è¿›è¡Œæ‹¼æ¥
	l.buf = l.buf[:0]
	l.formatHeader(&amp;amp;l.buf, now, file, line)
	l.buf = append(l.buf, s...)
	if len(s) == 0 || s[len(s)-1] != &amp;#39;\n&amp;#39; {
		l.buf = append(l.buf, &amp;#39;\n&amp;#39;)
	}
	//è¾“å‡ºæ‹¼æ¥å¥½çš„ç¼“å†²bufé‡Œçš„æ—¥å¿—ä¿¡æ¯åˆ°ç›®çš„åœ°
	_, err := l.out.Write(l.buf)
	return err
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ•´ä¸ªä»£ç æ¯”è¾ƒç®€æ´ï¼Œä¸ºäº†å¤šgoroutineå®‰å…¨äº’æ–¥é”ä¹Ÿç”¨ä¸Šäº†ï¼Œä½†æ˜¯åœ¨è·å–è°ƒç”¨å †æ ˆä¿¡æ¯çš„æ—¶å€™ï¼Œåˆè¦å…ˆè§£é”ï¼Œå› ä¸ºè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒé‡ã€‚è·å–åˆ°æ–‡ä»¶ã€è¡Œå·ç­‰ä¿¡æ¯åï¼Œç»§ç»­åŠ äº’æ–¥é”ä¿è¯å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;åé¢çš„å°±æ¯”è¾ƒç®€å•äº†ï¼Œ&lt;code&gt;formatHeader&lt;/code&gt;æ–¹æ³•ä¸»è¦æ˜¯æ ¼å¼åŒ–æ—¥å¿—æŠ¬å¤´ä¿¡æ¯ï¼Œç„¶åå­˜å‚¨åœ¨bufè¿™ä¸ªç¼“å†²ä¸­ï¼Œæœ€åå†æŠŠæˆ‘ä»¬è‡ªå·±çš„æ—¥å¿—ä¿¡æ¯æ‹¼æ¥åˆ°ç¼“å†²bufçš„åé¢ï¼Œç„¶åä¸ºä¸€æ¬¡logæ—¥å¿—è¾“å‡ºè¿½åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œè¿™æ ·æ¯æ¬¡æ—¥å¿—è¾“å‡ºéƒ½æ˜¯ä¸€è¡Œä¸€è¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†æœ€ç»ˆçš„æ—¥å¿—ä¿¡æ¯&lt;code&gt;buf&lt;/code&gt;ï¼Œç„¶åæŠŠå®ƒå†™åˆ°è¾“å‡ºçš„ç›®çš„åœ°outé‡Œå°±å¯ä»¥äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªå®ç°äº†&lt;code&gt;io.Writer&lt;/code&gt;æ¥å£çš„ç±»å‹ï¼Œåªè¦å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œéƒ½å¯ä»¥å½“ä½œè¾“å‡ºç›®çš„åœ°ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (l *Logger) SetOutput(w io.Writer) {
	l.mu.Lock()
	defer l.mu.Unlock()
	l.out = w
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;log&lt;/code&gt;åŒ…çš„&lt;code&gt;SetOutput&lt;/code&gt;å‡½æ•°ï¼Œå¯ä»¥è®¾ç½®è¾“å‡ºç›®çš„åœ°ã€‚è¿™é‡Œç¨å¾®ç®€å•ä»‹ç»ä¸‹&lt;code&gt;runtime.Caller&lt;/code&gt;ï¼Œå®ƒå¯ä»¥è·å–è¿è¡Œæ—¶æ–¹æ³•çš„è°ƒç”¨ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Caller(skip int) (pc uintptr, file string, line int, ok bool)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å‚æ•°&lt;code&gt;skip&lt;/code&gt;è¡¨ç¤ºè·³è¿‡æ ˆå¸§æ•°ï¼Œ&lt;code&gt;0&lt;/code&gt;è¡¨ç¤ºä¸è·³è¿‡ï¼Œä¹Ÿå°±æ˜¯&lt;code&gt;runtime.Caller&lt;/code&gt;çš„è°ƒç”¨è€…ã€‚&lt;code&gt;1&lt;/code&gt;çš„è¯å°±æ˜¯å†å‘ä¸Šä¸€å±‚ï¼Œè¡¨ç¤ºè°ƒç”¨è€…çš„è°ƒç”¨è€…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;log&lt;/code&gt;æ—¥å¿—åŒ…é‡Œä½¿ç”¨çš„æ˜¯&lt;code&gt;2&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºæˆ‘ä»¬åœ¨æºä»£ç ä¸­è°ƒç”¨&lt;code&gt;log.Print&lt;/code&gt;ã€&lt;code&gt;log.Fatal&lt;/code&gt;å’Œ&lt;code&gt;log.Panic&lt;/code&gt;è¿™äº›å‡½æ•°çš„è°ƒç”¨è€…ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥&lt;code&gt;main&lt;/code&gt;å‡½æ•°è°ƒç”¨&lt;code&gt;log.Println&lt;/code&gt;ä¸ºä¾‹ï¼Œæ˜¯&lt;code&gt;main-&amp;gt;log.Println-&amp;gt;*Logger.Output-&amp;gt;runtime.Caller&lt;/code&gt;è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ ˆï¼Œæ‰€ä»¥è¿™æ—¶å€™ï¼Œskipçš„å€¼åˆ†åˆ«ä»£è¡¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;0è¡¨ç¤º*Logger.Outputä¸­è°ƒç”¨runtime.Callerçš„æºä»£ç æ–‡ä»¶å’Œè¡Œå·&lt;/li&gt;
&lt;li&gt;1è¡¨ç¤ºlog.Printlnä¸­è°ƒç”¨*Logger.Outputçš„æºä»£ç æ–‡ä»¶å’Œè¡Œå·&lt;/li&gt;
&lt;li&gt;2è¡¨ç¤ºmainä¸­è°ƒç”¨log.Printlnçš„æºä»£ç æ–‡ä»¶å’Œè¡Œå·&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‰€ä»¥è¿™ä¹Ÿæ˜¯&lt;code&gt;log&lt;/code&gt;åŒ…é‡Œçš„è¿™ä¸ª&lt;code&gt;skip&lt;/code&gt;çš„å€¼ä¸ºä»€ä¹ˆä¸€ç›´æ˜¯2çš„åŸå› ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å®šåˆ¶è‡ªå·±çš„æ—¥å¿—&#34;&gt;å®šåˆ¶è‡ªå·±çš„æ—¥å¿— &lt;a href=&#34;#%e5%ae%9a%e5%88%b6%e8%87%aa%e5%b7%b1%e7%9a%84%e6%97%a5%e5%bf%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é€šè¿‡ä¸Šé¢çš„æºç åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“æ—¥å¿—è®°å½•çš„æ ¹æœ¬å°±åœ¨äºä¸€ä¸ªæ—¥å¿—è®°å½•å™¨&lt;code&gt;Logger&lt;/code&gt;ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šåˆ¶è‡ªå·±çš„æ—¥å¿—ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºä¸åŒçš„&lt;code&gt;Logger&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var (
	Info *log.Logger
	Warning *log.Logger
	Error * log.Logger
)

func init(){
	errFile,err:=os.OpenFile(&amp;#34;errors.log&amp;#34;,os.O_CREATE|os.O_WRONLY|os.O_APPEND,0666)
	if err!=nil{
		log.Fatalln(&amp;#34;æ‰“å¼€æ—¥å¿—æ–‡ä»¶å¤±è´¥ï¼š&amp;#34;,err)
	}

	Info = log.New(os.Stdout,&amp;#34;Info:&amp;#34;,log.Ldate | log.Ltime | log.Lshortfile)
	Warning = log.New(os.Stdout,&amp;#34;Warning:&amp;#34;,log.Ldate | log.Ltime | log.Lshortfile)
	Error = log.New(io.MultiWriter(os.Stderr,errFile),&amp;#34;Error:&amp;#34;,log.Ldate | log.Ltime | log.Lshortfile)

}

func main() {
	Info.Println(&amp;#34;é£é›ªæ— æƒ…çš„åšå®¢:&amp;#34;,&amp;#34;http://www.flysnow.org&amp;#34;)
	Warning.Printf(&amp;#34;é£é›ªæ— æƒ…çš„å¾®ä¿¡å…¬ä¼—å·ï¼š%s\n&amp;#34;,&amp;#34;flysnow_org&amp;#34;)
	Error.Println(&amp;#34;æ¬¢è¿å…³æ³¨ç•™è¨€&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬æ ¹æ®æ—¥å¿—çº§åˆ«å®šä¹‰äº†ä¸‰ç§ä¸åŒçš„&lt;code&gt;Logger&lt;/code&gt;ï¼Œåˆ†åˆ«ä¸º&lt;code&gt;Info&lt;/code&gt;,&lt;code&gt;Warning&lt;/code&gt;,&lt;code&gt;Error&lt;/code&gt;ï¼Œç”¨äºä¸åŒçº§åˆ«æ—¥å¿—çš„è¾“å‡ºã€‚è¿™ä¸‰ç§æ—¥å¿—è®°å½•å™¨éƒ½æ˜¯ä½¿ç”¨&lt;code&gt;log.New&lt;/code&gt;å‡½æ•°è¿›è¡Œåˆ›å»ºã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œåˆ›å»º&lt;code&gt;Logger&lt;/code&gt;çš„æ—¶å€™ï¼Œ&lt;code&gt;Info&lt;/code&gt;å’Œ&lt;code&gt;Warning&lt;/code&gt;éƒ½æ¯”è¾ƒæ­£å¸¸ï¼Œ&lt;code&gt;Error&lt;/code&gt;è¿™é‡Œé‡‡ç”¨äº†å¤šä¸ªç›®çš„åœ°è¾“å‡ºï¼Œè¿™é‡Œå¯ä»¥åŒæ—¶æŠŠé”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°&lt;code&gt;os.Stderr&lt;/code&gt;ä»¥åŠæˆ‘ä»¬åˆ›å»ºçš„&lt;code&gt;errors.log&lt;/code&gt;æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;io.MultiWriter&lt;/code&gt;å‡½æ•°å¯ä»¥åŒ…è£…å¤šä¸ª&lt;code&gt;io.Writer&lt;/code&gt;ä¸ºä¸€ä¸ª&lt;code&gt;io.Writer&lt;/code&gt;ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¾¾åˆ°åŒæ—¶å¯¹å¤šä¸ª&lt;code&gt;io.Writer&lt;/code&gt;è¾“å‡ºæ—¥å¿—çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;io.MultiWriter&lt;/code&gt;çš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œå®šä¹‰ä¸€ä¸ªç±»å‹å®ç°&lt;code&gt;io.Writer&lt;/code&gt;ï¼Œç„¶ååœ¨å®ç°çš„&lt;code&gt;Write&lt;/code&gt;æ–¹æ³•é‡Œå¾ªç¯è°ƒç”¨è¦åŒ…è£…çš„å¤šä¸ª&lt;code&gt;Writer&lt;/code&gt;æ¥å£çš„&lt;code&gt;Write&lt;/code&gt;æ–¹æ³•å³å¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (t *multiWriter) Write(p []byte) (n int, err error) {
	for _, w := range t.writers {
		n, err = w.Write(p)
		if err != nil {
			return
		}
		if n != len(p) {
			err = ErrShortWrite
			return
		}
	}
	return len(p), nil
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬é€šè¿‡å®šä¹‰äº†å¤šä¸ªLoggeræ¥åŒºåˆ†ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼Œä½¿ç”¨æ¯”è¾ƒéº»çƒ¦ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„logæ¡†æ¶ï¼Œä¹Ÿå¯ä»¥è‡ªå®šåŒ…è£…å®šä¹‰ï¼Œç›´æ¥é€šè¿‡ä¸åŒçº§åˆ«çš„æ–¹æ³•æ¥è®°å½•ä¸åŒçº§åˆ«çš„æ—¥å¿—ï¼Œè¿˜å¯ä»¥è®¾ç½®è®°å½•æ—¥å¿—çš„çº§åˆ«ç­‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ”¶é›†æ¥æºï¼šhttps://www.flysnow.org&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Golang sync åŒ…çš„ç›¸å…³ä½¿ç”¨æ–¹æ³•</title>
      <link>https://abnerxc.github.io/go/sync/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/sync/</guid>
      <description>&lt;h1 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦é”&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦é” &lt;a href=&#34;#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e9%94%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹æˆ–åç¨‹åŒæ—¶å»ä¿®æ”¹ä¸€ä¸ªå˜é‡ï¼Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;fmt&amp;#34;
    &amp;#34;sync&amp;#34;
    &amp;#34;time&amp;#34;
)

func main() {
    var a = 0

    // å¯åŠ¨ 100 ä¸ªåç¨‹ï¼Œéœ€è¦è¶³å¤Ÿå¤§
    // var lock sync.Mutex
    for i := 0; i &amp;lt; 100; i++ {
        go func(idx int) {
            // lock.Lock()
            // defer lock.Unlock()
            a += 1
            fmt.Printf(&amp;#34;goroutine %d, a=%d\n&amp;#34;, idx, a)
        }(i)
    }

    // ç­‰å¾… 1s ç»“æŸä¸»ç¨‹åº
    // ç¡®ä¿æ‰€æœ‰åç¨‹æ‰§è¡Œå®Œ
    time.Sleep(time.Second)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è§‚å¯Ÿæ‰“å°ç»“æœï¼Œæ˜¯å¦å‡ºç° a çš„å€¼æ˜¯ç›¸åŒçš„æƒ…å†µï¼ˆæœªå‡ºç°åˆ™é‡è¯•æˆ–è°ƒå¤§åç¨‹æ•°ï¼‰ï¼Œç­”æ¡ˆï¼šæ˜¯çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› æ˜¯ï¼Œåç¨‹ä¾æ¬¡æ‰§è¡Œï¼šä»å¯„å­˜å™¨è¯»å– a çš„å€¼ -&amp;gt; ç„¶ååšåŠ æ³•è¿ç®— -&amp;gt; æœ€åå†™ä¼šå¯„å­˜å™¨ã€‚è¯•æƒ³ï¼Œæ­¤æ—¶ä¸€ä¸ªåç¨‹å–å‡º a çš„å€¼ 3ï¼Œæ­£åœ¨åšåŠ æ³•è¿ç®—ï¼ˆè¿˜æœªå†™å›å¯„å­˜å™¨ï¼‰ã€‚åŒæ—¶å¦ä¸€ä¸ªåç¨‹æ­¤æ—¶å»å–ï¼Œå–å‡ºäº†åŒæ ·çš„ a çš„å€¼ 3ã€‚æœ€ç»ˆå¯¼è‡´çš„ç»“æœæ˜¯ï¼Œä¸¤ä¸ªåç¨‹äº§å‡ºçš„ç»“æœç›¸åŒï¼Œa ç›¸å½“äºåªå¢åŠ äº† 1ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œé”çš„æ¦‚å¿µå°±æ˜¯ï¼Œæˆ‘æ­£åœ¨å¤„ç† aï¼ˆé”å®šï¼‰ï¼Œä½ ä»¬è°éƒ½åˆ«å’Œæˆ‘æŠ¢ï¼Œç­‰æˆ‘å¤„ç†å®Œäº†ï¼ˆè§£é”ï¼‰ï¼Œä½ ä»¬å†å¤„ç†ã€‚è¿™æ ·å°±å®ç°äº†ï¼ŒåŒæ—¶å¤„ç† a çš„åç¨‹åªæœ‰ä¸€ä¸ªï¼Œå°±å®ç°äº†åŒæ­¥ã€‚&lt;/p&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;ä»€ä¹ˆæ˜¯äº’æ–¥é”-mutex&#34;&gt;ä»€ä¹ˆæ˜¯äº’æ–¥é” Mutexï¼Ÿ &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e4%ba%92%e6%96%a5%e9%94%81-mutex&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»€ä¹ˆæ˜¯äº’æ–¥é”ï¼Ÿå®ƒæ˜¯é”çš„ä¸€ç§å…·ä½“å®ç°ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (m *Mutex) Lock()
func (m *Mutex) Unlock()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨é¦–æ¬¡ä½¿ç”¨åä¸è¦å¤åˆ¶è¯¥äº’æ–¥é”ã€‚å¯¹ä¸€ä¸ªæœªé”å®šçš„äº’æ–¥é”è§£é”å°†ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªäº’æ–¥é”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ª goroutine é”å®šï¼Œå…¶å®ƒ goroutine å°†é˜»å¡ç›´åˆ°äº’æ–¥é”è¢«è§£é”ï¼ˆé‡æ–°äº‰æŠ¢å¯¹äº’æ–¥é”çš„é”å®šï¼‰ã€‚å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;fmt&amp;#34;
    &amp;#34;sync&amp;#34;
    &amp;#34;time&amp;#34;
)

func main() {
    ch := make(chan struct{}, 2)

    var l sync.Mutex
    go func() {
        l.Lock()
        defer l.Unlock()
        fmt.Println(&amp;#34;goroutine1: æˆ‘ä¼šé”å®šå¤§æ¦‚ 2s&amp;#34;)
        time.Sleep(time.Second * 2)
        fmt.Println(&amp;#34;goroutine1: æˆ‘è§£é”äº†ï¼Œä½ ä»¬å»æŠ¢å§&amp;#34;)
        ch &amp;lt;- struct{}{}
    }()

    go func() {
        fmt.Println(&amp;#34;groutine2: ç­‰å¾…è§£é”&amp;#34;)
        l.Lock()
        defer l.Unlock()
        fmt.Println(&amp;#34;goroutine2: å“ˆå“ˆï¼Œæˆ‘é”å®šäº†&amp;#34;)
        ch &amp;lt;- struct{}{}
    }()

    // ç­‰å¾… goroutine æ‰§è¡Œç»“æŸ
    for i := 0; i &amp;lt; 2; i++ {
        &amp;lt;-ch
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼Œå¹³æ—¶æ‰€è¯´çš„é”å®šï¼Œå…¶å®å°±æ˜¯å»é”å®šäº’æ–¥é”ï¼Œè€Œä¸æ˜¯è¯´å»é”å®šä¸€æ®µä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°æœ‰é”çš„åœ°æ–¹æ—¶ï¼Œå®ƒè·å–ä¸åˆ°äº’æ–¥é”çš„é”å®šï¼Œä¼šé˜»å¡åœ¨é‚£é‡Œï¼Œä»è€Œè¾¾åˆ°æ§åˆ¶åŒæ­¥çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;ä»€ä¹ˆæ˜¯è¯»å†™é”-rwmutex&#34;&gt;ä»€ä¹ˆæ˜¯è¯»å†™é” RWMutex? &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e8%af%bb%e5%86%99%e9%94%81-rwmutex&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é‚£ä¹ˆä»€ä¹ˆæ˜¯è¯»å†™é”å‘¢ï¼Ÿå®ƒæ˜¯é’ˆå¯¹è¯»å†™æ“ä½œçš„äº’æ–¥é”ï¼Œè¯»å†™é”ä¸äº’æ–¥é”æœ€å¤§çš„ä¸åŒå°±æ˜¯å¯ä»¥åˆ†åˆ«å¯¹ è¯»ã€å†™ è¿›è¡Œé”å®šã€‚ä¸€èˆ¬ç”¨åœ¨å¤§é‡è¯»æ“ä½œã€å°‘é‡å†™æ“ä½œçš„æƒ…å†µï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (rw *RWMutex) Lock()
func (rw *RWMutex) Unlock()

func (rw *RWMutex) RLock()
func (rw *RWMutex) RUnlock()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç”±äºè¿™é‡Œéœ€è¦åŒºåˆ†è¯»å†™é”å®šï¼Œæˆ‘ä»¬è¿™æ ·å®šä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»é”å®šï¼ˆRLockï¼‰ï¼Œå¯¹è¯»æ“ä½œè¿›è¡Œé”å®š&lt;/li&gt;
&lt;li&gt;è¯»è§£é”ï¼ˆRUnlockï¼‰ï¼Œå¯¹è¯»é”å®šè¿›è¡Œè§£é”&lt;/li&gt;
&lt;li&gt;å†™é”å®šï¼ˆLockï¼‰ï¼Œå¯¹å†™æ“ä½œè¿›è¡Œé”å®š&lt;/li&gt;
&lt;li&gt;å†™è§£é”ï¼ˆUnlockï¼‰ï¼Œå¯¹å†™é”å®šè¿›è¡Œè§£é”&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨é¦–æ¬¡ä½¿ç”¨ä¹‹åï¼Œä¸è¦å¤åˆ¶è¯¥è¯»å†™é”ã€‚ä¸è¦æ··ç”¨é”å®šå’Œè§£é”ï¼Œå¦‚ï¼šLock å’Œ RUnlockã€RLock å’Œ Unlockã€‚å› ä¸ºå¯¹æœªè¯»é”å®šçš„è¯»å†™é”è¿›è¡Œè¯»è§£é”æˆ–å¯¹æœªå†™é”å®šçš„è¯»å†™é”è¿›è¡Œå†™è§£é”å°†ä¼šå¼•èµ·è¿è¡Œæ—¶é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•ç†è§£è¯»å†™é”å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª goroutine èƒ½å¤Ÿè·å¾—å†™é”å®šã€‚&lt;/li&gt;
&lt;li&gt;åŒæ—¶å¯ä»¥æœ‰ä»»æ„å¤šä¸ª gorouinte è·å¾—è¯»é”å®šã€‚&lt;/li&gt;
&lt;li&gt;åŒæ—¶åªèƒ½å­˜åœ¨å†™é”å®šæˆ–è¯»é”å®šï¼ˆè¯»å’Œå†™äº’æ–¥ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æœ‰ä¸€ä¸ª goroutine è·å¾—å†™é”å®šï¼Œå…¶å®ƒæ— è®ºæ˜¯è¯»é”å®šè¿˜æ˜¯å†™é”å®šéƒ½å°†é˜»å¡ç›´åˆ°å†™è§£é”ï¼›å½“æœ‰ä¸€ä¸ª goroutine è·å¾—è¯»é”å®šï¼Œå…¶å®ƒè¯»é”å®šä»»ç„¶å¯ä»¥ç»§ç»­ï¼›å½“æœ‰ä¸€ä¸ªæˆ–ä»»æ„å¤šä¸ªè¯»é”å®šï¼Œå†™é”å®šå°†ç­‰å¾…æ‰€æœ‰è¯»é”å®šè§£é”ä¹‹åæ‰èƒ½å¤Ÿè¿›è¡Œå†™é”å®šã€‚æ‰€ä»¥è¯´è¿™é‡Œçš„è¯»é”å®šï¼ˆRLockï¼‰ç›®çš„å…¶å®æ˜¯å‘Šè¯‰å†™é”å®šï¼šæœ‰å¾ˆå¤šäººæ­£åœ¨è¯»å–æ•°æ®ï¼Œä½ ç»™æˆ‘ç«™ä¸€è¾¹å»ï¼Œç­‰å®ƒä»¬è¯»ï¼ˆè¯»è§£é”ï¼‰å®Œä½ å†æ¥å†™ï¼ˆå†™é”å®šï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;fmt&amp;#34;
    &amp;#34;math/rand&amp;#34;
    &amp;#34;sync&amp;#34;
)

var count int
var rw sync.RWMutex

func main() {
    ch := make(chan struct{}, 10)
    for i := 0; i &amp;lt; 5; i++ {
        go read(i, ch)
    }
    for i := 0; i &amp;lt; 5; i++ {
        go write(i, ch)
    }

    for i := 0; i &amp;lt; 10; i++ {
        &amp;lt;-ch
    }
}

func read(n int, ch chan struct{}) {
    rw.RLock()
    fmt.Printf(&amp;#34;goroutine %d è¿›å…¥è¯»æ“ä½œ...\n&amp;#34;, n)
    v := count
    fmt.Printf(&amp;#34;goroutine %d è¯»å–ç»“æŸï¼Œå€¼ä¸ºï¼š%d\n&amp;#34;, n, v)
    rw.RUnlock()
    ch &amp;lt;- struct{}{}
}

func write(n int, ch chan struct{}) {
    rw.Lock()
    fmt.Printf(&amp;#34;goroutine %d è¿›å…¥å†™æ“ä½œ...\n&amp;#34;, n)
    v := rand.Intn(1000)
    count = v
    fmt.Printf(&amp;#34;goroutine %d å†™å…¥ç»“æŸï¼Œæ–°å€¼ä¸ºï¼š%d\n&amp;#34;, n, v)
    rw.Unlock()
    ch &amp;lt;- struct{}{}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;waitgroup-ä¾‹å­&#34;&gt;WaitGroup ä¾‹å­ &lt;a href=&#34;#waitgroup-%e4%be%8b%e5%ad%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;WaitGroup ç”¨äºç­‰å¾…ä¸€ç»„ goroutine ç»“æŸï¼Œç”¨æ³•å¾ˆç®€å•ã€‚å®ƒæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (wg *WaitGroup) Add(delta int)
func (wg *WaitGroup) Done()
func (wg *WaitGroup) Wait()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Add ç”¨æ¥æ·»åŠ  goroutine çš„ä¸ªæ•°ã€‚Done æ‰§è¡Œä¸€æ¬¡æ•°é‡å‡ 1ã€‚Wait ç”¨æ¥ç­‰å¾…ç»“æŸï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;fmt&amp;#34;
    &amp;#34;sync&amp;#34;
    &amp;#34;time&amp;#34;
)

func main() {
    var wg sync.WaitGroup

    for i := 0; i &amp;lt; 5; i++ {
        // è®¡æ•°åŠ  1
        wg.Add(1)
        go func(i int) {
            // è®¡æ•°å‡ 1
            defer wg.Done()
            time.Sleep(time.Second * time.Duration(i))
            fmt.Printf(&amp;#34;goroutine%d ç»“æŸ\n&amp;#34;, i)
        }(i)
    }

    // ç­‰å¾…æ‰§è¡Œç»“æŸ
    wg.Wait()
    fmt.Println(&amp;#34;æ‰€æœ‰ goroutine æ‰§è¡Œç»“æŸ&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;æ³¨æ„ï¼Œwg.Add() æ–¹æ³•ä¸€å®šè¦åœ¨ goroutine å¼€å§‹å‰æ‰§è¡Œå“¦ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;cond-æ¡ä»¶å˜é‡&#34;&gt;Cond æ¡ä»¶å˜é‡ &lt;a href=&#34;#cond-%e6%9d%a1%e4%bb%b6%e5%8f%98%e9%87%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Cond å®ç°ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œå³ç­‰å¾…æˆ–å®£å¸ƒäº‹ä»¶å‘ç”Ÿçš„ goroutines çš„ä¼šåˆç‚¹ï¼Œå®ƒä¼šä¿å­˜ä¸€ä¸ªé€šçŸ¥åˆ—è¡¨ã€‚åŸºæœ¬æ€æƒ³æ˜¯å½“æŸä¸­çŠ¶æ€è¾¾æˆï¼Œgoroutine å°†ä¼šç­‰å¾…ï¼ˆWaitï¼‰åœ¨é‚£é‡Œï¼Œå½“æŸä¸ªæ—¶åˆ»çŠ¶æ€æ”¹å˜æ—¶é€šè¿‡é€šçŸ¥çš„æ–¹å¼ï¼ˆBroadcastï¼ŒSignalï¼‰çš„æ–¹å¼é€šçŸ¥ç­‰å¾…çš„ goroutineã€‚è¿™æ ·ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„ goroutine å”¤é†’ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œæ»¡è¶³æ¡ä»¶çš„é‡æ–°è¿›å…¥ç­‰å¾…åºåˆ—ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Cond struct {
    noCopy noCopy
  
    // L is held while observing or changing the condition
    L Locker
  
    notify  notifyList // é€šçŸ¥åˆ—è¡¨
    checker copyChecker
}
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func NewCond(l Locker) *Cond
func (c *Cond) Broadcast()
func (c *Cond) Signal()
func (c *Cond) Wait()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Wait æ–¹æ³•ã€Signal æ–¹æ³•å’Œ Broadcast æ–¹æ³•ã€‚å®ƒä»¬åˆ†åˆ«ä»£è¡¨äº†ç­‰å¾…é€šçŸ¥ã€å•å‘é€šçŸ¥å’Œå¹¿æ’­é€šçŸ¥çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Wait æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (c *Cond) Wait() {
    c.checker.check()
    t := runtime_notifyListAdd(&amp;amp;c.notify)
    c.L.Unlock()
    runtime_notifyListWait(&amp;amp;c.notify, t)
    c.L.Lock()
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å®ƒçš„æ“ä½œä¸ºï¼šåŠ å…¥åˆ°é€šçŸ¥åˆ—è¡¨ -&amp;gt; è§£é” L -&amp;gt; ç­‰å¾…é€šçŸ¥ -&amp;gt; é”å®š Lã€‚å…¶ä½¿ç”¨æ–¹æ³•æ˜¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;c.L.Lock()
for !condition() {
    c.Wait()
}
... make use of condition ...
c.L.Unlock()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸¾ä¸ªä¾‹å­:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// Package main provides ...
package main

import (
    &amp;#34;fmt&amp;#34;
    &amp;#34;sync&amp;#34;
    &amp;#34;time&amp;#34;
)

var count int = 4

func main() {
    ch := make(chan struct{}, 5)

    // æ–°å»º cond
    var l sync.Mutex
    cond := sync.NewCond(&amp;amp;l)

    for i := 0; i &amp;lt; 5; i++ {
        go func(i int) {
            // äº‰æŠ¢äº’æ–¥é”çš„é”å®š
            cond.L.Lock()
            defer func() {
                cond.L.Unlock()
                ch &amp;lt;- struct{}{}
            }()

            // æ¡ä»¶æ˜¯å¦è¾¾æˆ
            for count &amp;gt; i {
                cond.Wait()
                fmt.Printf(&amp;#34;æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ goroutine%d\n&amp;#34;, i)
            }
            
            fmt.Printf(&amp;#34;goroutine%d æ‰§è¡Œç»“æŸ\n&amp;#34;, i)
        }(i)
    }

    // ç¡®ä¿æ‰€æœ‰ goroutine å¯åŠ¨å®Œæˆ
    time.Sleep(time.Millisecond * 20)
    
    // é”å®šä¸€ä¸‹
    fmt.Println(&amp;#34;broadcast...&amp;#34;)
    cond.L.Lock()
    count -= 1
    cond.Broadcast()
    cond.L.Unlock()

    time.Sleep(time.Second)
    fmt.Println(&amp;#34;signal...&amp;#34;)
    cond.L.Lock()
    count -= 2
    cond.Signal()
    cond.L.Unlock()

    time.Sleep(time.Second)
    fmt.Println(&amp;#34;broadcast...&amp;#34;)
    cond.L.Lock()
    count -= 1
    cond.Broadcast()
    cond.L.Unlock()

    for i := 0; i &amp;lt; 5; i++ {
        &amp;lt;-ch
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;pool-ä¸´æ—¶å¯¹è±¡æ± &#34;&gt;Pool ä¸´æ—¶å¯¹è±¡æ±  &lt;a href=&#34;#pool-%e4%b8%b4%e6%97%b6%e5%af%b9%e8%b1%a1%e6%b1%a0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;sync.Pool å¯ä»¥ä½œä¸ºä¸´æ—¶å¯¹è±¡çš„ä¿å­˜å’Œå¤ç”¨çš„é›†åˆã€‚å…¶ç»“æ„ä¸ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Pool struct {
    noCopy noCopy

    local     unsafe.Pointer // local fixed-size per-P pool, actual type is [P]poolLocal
    localSize uintptr        // size of the local array

    // New optionally specifies a function to generate
    // a value when Get would otherwise return nil.
    // It may not be changed concurrently with calls to Get.
    New func() interface{}
}

func (p *Pool) Get() interface{}
func (p *Pool) Put(x interface{})
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ–°é”® Pool éœ€è¦æä¾›ä¸€ä¸ª New æ–¹æ³•ï¼Œç›®çš„æ˜¯å½“è·å–ä¸åˆ°ä¸´æ—¶å¯¹è±¡æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªï¼ˆä¸ä¼šä¸»åŠ¨åŠ å…¥åˆ° Pool ä¸­ï¼‰ï¼ŒGet å’Œ Put æ–¹æ³•éƒ½å¾ˆå¥½ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;æ·±å…¥äº†è§£è¿‡ Go çš„åŒå­¦åº”è¯¥çŸ¥é“ï¼ŒGo çš„é‡è¦ç»„æˆç»“æ„ä¸º Mã€Pã€Gã€‚Pool å®é™…ä¸Šä¼šä¸ºæ¯ä¸€ä¸ªæ“ä½œå®ƒçš„ goroutine ç›¸å…³è”çš„ P éƒ½ç”Ÿæˆä¸€ä¸ªæœ¬åœ°æ± ã€‚å¦‚æœä»æœ¬åœ°æ±  Get å¯¹è±¡çš„æ—¶å€™ï¼Œæœ¬åœ°æ± æ²¡æœ‰ï¼Œåˆ™ä¼šä»å…¶å®ƒçš„ P æœ¬åœ°æ± è·å–ã€‚å› æ­¤ï¼ŒPool çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼šå¯ä»¥æŠŠç”±å…¶ä¸­çš„å¯¹è±¡å€¼äº§ç”Ÿçš„å­˜å‚¨å‹åŠ›è¿›è¡Œåˆ†æ‘Šã€‚&lt;/p&gt;
&lt;p&gt;å®ƒæœ‰ç€ä»¥ä¸‹ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pool ä¸­çš„å¯¹è±¡åœ¨ä»…æœ‰ Pool æœ‰ç€å”¯ä¸€ç´¢å¼•çš„æƒ…å†µä¸‹å¯èƒ½ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆå–å†³äºä¸‹ä¸€æ¬¡ GC æ‰§è¡Œçš„æ—¶é—´ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;goroutines åç¨‹å®‰å…¨ï¼Œå¯ä»¥åŒæ—¶è¢«å¤šä¸ªåç¨‹ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;GC çš„æ‰§è¡Œä¸€èˆ¬ä¼šä½¿ Pool ä¸­çš„å¯¹è±¡å…¨éƒ¨ç§»é™¤ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é‚£ä¹ˆ Pool éƒ½é€‚ç”¨äºä»€ä¹ˆåœºæ™¯å‘¢ï¼Ÿä»å®ƒçš„ç‰¹ç‚¹æ¥è¯´ï¼Œé€‚ç”¨ä¸æ— çŠ¶æ€çš„å¯¹è±¡çš„å¤ç”¨ï¼Œè€Œä¸é€‚ç”¨ä¸å¦‚è¿æ¥æ± ä¹‹ç±»çš„ã€‚åœ¨ fmt åŒ…ä¸­æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ä½¿ç”¨æ± çš„ä¾‹å­ï¼Œå®ƒç»´æŠ¤ä¸€ä¸ªåŠ¨æ€å¤§å°çš„ä¸´æ—¶è¾“å‡ºç¼“å†²åŒºã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;bytes&amp;#34;
    &amp;#34;io&amp;#34;
    &amp;#34;os&amp;#34;
    &amp;#34;sync&amp;#34;
    &amp;#34;time&amp;#34;
)

var bufPool = sync.Pool{
    New: func() interface{} {
        return new(bytes.Buffer)
    },
}

func timeNow() time.Time {
    return time.Unix(1136214245, 0)
}

func Log(w io.Writer, key, val string) {
    // è·å–ä¸´æ—¶å¯¹è±¡ï¼Œæ²¡æœ‰çš„è¯ä¼šè‡ªåŠ¨åˆ›å»º
    b := bufPool.Get().(*bytes.Buffer)
    b.Reset()
    b.WriteString(timeNow().UTC().Format(time.RFC3339))
    b.WriteByte(&amp;#39; &amp;#39;)
    b.WriteString(key)
    b.WriteByte(&amp;#39;=&amp;#39;)
    b.WriteString(val)
    w.Write(b.Bytes())
    // å°†ä¸´æ—¶å¯¹è±¡æ”¾å›åˆ° Pool ä¸­
    bufPool.Put(b)
}

func main() {
    Log(os.Stdout, &amp;#34;path&amp;#34;, &amp;#34;/search?q=flowers&amp;#34;)
}

æ‰“å°ç»“æœï¼š
2006-01-02T15:04:05Z path=/search?q=flowers
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;once-æ‰§è¡Œä¸€æ¬¡&#34;&gt;Once æ‰§è¡Œä¸€æ¬¡ &lt;a href=&#34;#once-%e6%89%a7%e8%a1%8c%e4%b8%80%e6%ac%a1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä½¿ç”¨ sync.Once å¯¹è±¡å¯ä»¥ä½¿å¾—å‡½æ•°å¤šæ¬¡è°ƒç”¨åªæ‰§è¡Œä¸€æ¬¡ã€‚å…¶ç»“æ„ä¸ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Once struct {
    m    Mutex
    done uint32
}

func (o *Once) Do(f func())
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç”¨ done æ¥è®°å½•æ‰§è¡Œæ¬¡æ•°ï¼Œç”¨ m æ¥ä¿è¯ä¿è¯ä»…è¢«æ‰§è¡Œä¸€æ¬¡ã€‚åªæœ‰ä¸€ä¸ª Do æ–¹æ³•ï¼Œè°ƒç”¨æ‰§è¡Œã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GoåŸºç¡€-iota</title>
      <link>https://abnerxc.github.io/go/base1.iota/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/base1.iota/</guid>
      <description>&lt;p&gt;&lt;code&gt;iota-goè¯­è¨€ä¸­çš„å¸¸é‡è®¡æ•°å™¨ï¼Œåªèƒ½åœ¨å¸¸é‡è¡¨è¾¾å¼ä¸­ä½¿ç”¨&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;iotaåªèƒ½åœ¨å¸¸é‡çš„è¡¨è¾¾å¼ä¸­ä½¿ç”¨&#34;&gt;iotaåªèƒ½åœ¨å¸¸é‡çš„è¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚ &lt;a href=&#34;#iota%e5%8f%aa%e8%83%bd%e5%9c%a8%e5%b8%b8%e9%87%8f%e7%9a%84%e8%a1%a8%e8%be%be%e5%bc%8f%e4%b8%ad%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;fmt.Println(iota) 
ç¼–è¯‘é”™è¯¯ï¼š undefined: iota
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æ¯æ¬¡-const-å‡ºç°æ—¶éƒ½ä¼šè®©-iota-åˆå§‹åŒ–ä¸º0è‡ªå¢é•¿&#34;&gt;æ¯æ¬¡ const å‡ºç°æ—¶ï¼Œéƒ½ä¼šè®© iota åˆå§‹åŒ–ä¸º0.ã€è‡ªå¢é•¿ã€‘ &lt;a href=&#34;#%e6%af%8f%e6%ac%a1-const-%e5%87%ba%e7%8e%b0%e6%97%b6%e9%83%bd%e4%bc%9a%e8%ae%a9-iota-%e5%88%9d%e5%a7%8b%e5%8c%96%e4%b8%ba0%e8%87%aa%e5%a2%9e%e9%95%bf&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const a = iota // a=0
const (
  b = iota          //b=0
  c                      //c=1
)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æšä¸¾ç±»å‹å®šä¹‰&#34;&gt;æšä¸¾ç±»å‹å®šä¹‰ &lt;a href=&#34;#%e6%9e%9a%e4%b8%be%e7%b1%bb%e5%9e%8b%e5%ae%9a%e4%b9%89&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Weekday int
const (
    Sunday Weekday = iota
    Monday
    Tuesday
    Wednesday
    Thursday
    Friday
    Saturday
)

//å¯ä»¥ç±»ä¼¼è°ƒç”¨æšä¸¾ç±»ä¸€æ ·è°ƒç”¨
println(Weekday(Saturday))   


func (d Weekday) String() string {
    return [...]string{&amp;#34;Sunday&amp;#34;, &amp;#34;Monday&amp;#34;, &amp;#34;Tuesday&amp;#34;, &amp;#34;Wednesday&amp;#34;}[d]
}


var d Weekday = Monday
fmt.Print(d)
switch d {
case Sunday:
    fmt.Println(&amp;#34; goes up.&amp;#34;)
case Monday:
    fmt.Println(&amp;#34; goes down.&amp;#34;)
default:
    fmt.Println(&amp;#34; stays put.&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å¯è·³è¿‡çš„å€¼&#34;&gt;å¯è·³è¿‡çš„å€¼ &lt;a href=&#34;#%e5%8f%af%e8%b7%b3%e8%bf%87%e7%9a%84%e5%80%bc&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type AudioOutput int
const (
    OutMute AudioOutput = iota // 0
    OutMono                       // 1
    OutStereo                     // 2
    _
    _
    OutSurround                // 5
)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ä½æ©ç è¡¨è¾¾å¼&#34;&gt;ä½æ©ç è¡¨è¾¾å¼ &lt;a href=&#34;#%e4%bd%8d%e6%8e%a9%e7%a0%81%e8%a1%a8%e8%be%be%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;iota å¯ä»¥åšæ›´å¤šäº‹æƒ…ï¼Œè€Œä¸ä»…ä»…æ˜¯ incrementã€‚æ›´ç²¾ç¡®åœ°è¯´ï¼Œiota æ€»æ˜¯ç”¨äº incrementï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨äºè¡¨è¾¾å¼ï¼Œåœ¨å¸¸é‡ä¸­çš„å­˜å‚¨ç»“æœå€¼ã€‚&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const (
    IgEggs Allergen = 1 &amp;lt;&amp;lt; iota // 1 &amp;lt;&amp;lt; 0 which is 00000001
    IgChocolate                             // 1 &amp;lt;&amp;lt; 1 which is 00000010
    IgNuts                                       // 1 &amp;lt;&amp;lt; 2 which is 00000100
    IgStrawberries                        // 1 &amp;lt;&amp;lt; 3 which is 00001000
    IgShellfish                                // 1 &amp;lt;&amp;lt; 4 which is 00010000
)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å®šä¹‰bitå•ä½&#34;&gt;å®šä¹‰bitå•ä½ &lt;a href=&#34;#%e5%ae%9a%e4%b9%89bit%e5%8d%95%e4%bd%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type ByteSize float64
const (
    _           = iota                   // ignore first value by assigning to blank identifier
    KB ByteSize = 1 &amp;lt;&amp;lt; (10 * iota)       // 1 &amp;lt;&amp;lt; (10*1)
    MB                                   // 1 &amp;lt;&amp;lt; (10*2)
    GB                                   // 1 &amp;lt;&amp;lt; (10*3)
    TB                                   // 1 &amp;lt;&amp;lt; (10*4)
    PB                                   // 1 &amp;lt;&amp;lt; (10*5)
    EB                                   // 1 &amp;lt;&amp;lt; (10*6)
    ZB                                   // 1 &amp;lt;&amp;lt; (10*7)
    YB                                   // 1 &amp;lt;&amp;lt; (10*8)
)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å®šä¹‰åœ¨ä¸€è¡Œçš„æƒ…å†µiota-åœ¨ä¸‹ä¸€è¡Œå¢é•¿è€Œä¸æ˜¯ç«‹å³å–å¾—å®ƒçš„å¼•ç”¨&#34;&gt;å®šä¹‰åœ¨ä¸€è¡Œçš„æƒ…å†µ(iota åœ¨ä¸‹ä¸€è¡Œå¢é•¿ï¼Œè€Œä¸æ˜¯ç«‹å³å–å¾—å®ƒçš„å¼•ç”¨) &lt;a href=&#34;#%e5%ae%9a%e4%b9%89%e5%9c%a8%e4%b8%80%e8%a1%8c%e7%9a%84%e6%83%85%e5%86%b5iota-%e5%9c%a8%e4%b8%8b%e4%b8%80%e8%a1%8c%e5%a2%9e%e9%95%bf%e8%80%8c%e4%b8%8d%e6%98%af%e7%ab%8b%e5%8d%b3%e5%8f%96%e5%be%97%e5%ae%83%e7%9a%84%e5%bc%95%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;æ³¨æ„ä»–ä»¬æ˜¯é€—å·åˆ†éš”å¸¸é‡ï¼Œå¹¶ä¸æ˜¯æ¢è¡Œ&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœºæ™¯ä¸€&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const (
    Apple, Banana = iota , iota 
    Cherimoya, Durian
    Elderberry, Fig
)
// Apple: 0, Banana: 0,
// Cherimoya: 1, Durian: 1, 
// Elderberry: 2, Fig: 2
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åœºæ™¯äºŒ,æ¯ä¸€æ¢è¡Œéƒ½æŒ‰ç…§å‰ä¸€è¡Œçš„è¡¨è¾¾å¼è¿›è¡Œå¢åŠ &lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const (
    Apple, Banana = iota+1 , iota+1 
    Cherimoya, Durian
    Elderberry, Fig
)
// Apple: 1, Banana: 1,
// Cherimoya: 2, Durian: 2, 
// Elderberry: 3, Fig: 3
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ä¸­é—´æ’é˜Ÿ&#34;&gt;ä¸­é—´æ’é˜Ÿ &lt;a href=&#34;#%e4%b8%ad%e9%97%b4%e6%8f%92%e9%98%9f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const (
    i = iota
    j = 3.14
    k = iota
    l
)
é‚£ä¹ˆæ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯ i=0,j=3.14,k=2,l=3
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>GoåŸºç¡€-ä¿¡é“</title>
      <link>https://abnerxc.github.io/go/base5.channel/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/base5.channel/</guid>
      <description>&lt;p&gt;ä¿¡é“æ˜¯åç¨‹ä¹‹é—´é€šä¿¡çš„ç®¡é“ï¼Œä»ä¸€ç«¯å‘é€æ•°æ®ï¼Œå¦ä¸€ç«¯æ¥æ”¶æ•°æ®ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¿¡é“å£°æ˜&#34;&gt;ä¿¡é“å£°æ˜ &lt;a href=&#34;#%e4%bf%a1%e9%81%93%e5%a3%b0%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;var c chan int&lt;/code&gt;,å£°æ˜äº† nil ä¿¡é“ã€‚nil ä¿¡é“æ²¡ä»€ä¹ˆä½œç”¨ï¼Œæ—¢ä¸èƒ½å‘é€æ•°æ®ä¹Ÿä¸èƒ½æ¥å—æ•°æ®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;c:=make(chan int)&lt;/code&gt;,ä½¿ç”¨ make å‡½æ•°åˆ›å»ºäº†å¯ç”¨çš„ä¿¡é“ cã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;è¯»å†™æ•°æ®&#34;&gt;è¯»å†™æ•°æ® &lt;a href=&#34;#%e8%af%bb%e5%86%99%e6%95%b0%e6%8d%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;c := make(chan int)
// å†™æ•°æ®
c &amp;lt;- data   

// è¯»æ•°æ®
variable &amp;lt;- c  // æ–¹å¼ä¸€
&amp;lt;- c              // æ–¹å¼äºŒ
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;è§£å†³ç”Ÿäº§ç¯å¢ƒä½¿ç”¨timesleep&#34;&gt;è§£å†³ç”Ÿäº§ç¯å¢ƒä½¿ç”¨timeSleep &lt;a href=&#34;#%e8%a7%a3%e5%86%b3%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e4%bd%bf%e7%94%a8timesleep&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func printHello(c chan bool) {
    fmt.Println(&amp;#34;hello world goroutine&amp;#34;)
    &amp;lt;- c    // è¯»å–ä¿¡é“çš„æ•°æ®
}
 
func main() {
    c := make(chan bool)
    go printHello(c)
    c &amp;lt;- true    // main åç¨‹é˜»å¡
    fmt.Println(&amp;#34;main goroutine&amp;#34;)
}
//output
hello world goroutine
main goroutine
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;æ­»é”åªè¯»ä¸å†™æˆ–è€…åªè¯»ä¸å†™&#34;&gt;æ­»é”ï¼ˆåªè¯»ä¸å†™æˆ–è€…åªè¯»ä¸å†™ï¼‰ &lt;a href=&#34;#%e6%ad%bb%e9%94%81%e5%8f%aa%e8%af%bb%e4%b8%8d%e5%86%99%e6%88%96%e8%80%85%e5%8f%aa%e8%af%bb%e4%b8%8d%e5%86%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
    c := make(chan bool)
    c &amp;lt;- true    // åªå†™ä¸è¯»
    fmt.Println(&amp;#34;main goroutine&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;å…³é—­ä¿¡é“ä¸-for-loop&#34;&gt;å…³é—­ä¿¡é“ä¸ for loop &lt;a href=&#34;#%e5%85%b3%e9%97%ad%e4%bf%a1%e9%81%93%e4%b8%8e-for-loop&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func printNums(ch chan int) {
    for i := 0; i &amp;lt; 10; i++ {
        ch &amp;lt;- i
    }
    close(ch)
}

func main() {
    ch := make(chan int)
    go printNums(ch)
    for {
        v, ok := &amp;lt;-ch
        if ok == false {     // é€šè¿‡ ok åˆ¤æ–­ä¿¡é“æ˜¯å¦å…³é—­
            fmt.Println(v, ok)
            break
        }
        fmt.Println(v, ok)
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;ç¼“å†²ä¿¡é“å’Œæ™®é€šä¿¡é“&#34;&gt;ç¼“å†²ä¿¡é“å’Œæ™®é€šä¿¡é“ &lt;a href=&#34;#%e7%bc%93%e5%86%b2%e4%bf%a1%e9%81%93%e5%92%8c%e6%99%ae%e9%80%9a%e4%bf%a1%e9%81%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;æ™®é€šä¿¡é“æ˜¯&lt;code&gt;æ— ç¼“å†²çš„ï¼Œè¯»å†™ä¿¡é“ä¼šç«‹é©¬é˜»å¡å½“å‰åç¨‹&lt;/code&gt;ã€‚å¯¹äºç¼“å†²ä¿¡é“ï¼Œå†™ä¸ä¼šé˜»å¡å½“å‰ä¿¡é“ç›´åˆ°ä¿¡é“æ»¡äº†ï¼ŒåŒç†ï¼Œè¯»æ“ä½œä¹Ÿä¸ä¼šé˜»å¡å½“å‰ä¿¡é“é™¤éä¿¡é“æ²¡æ•°æ®&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“ &lt;a href=&#34;#%e6%80%bb%e7%bb%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;{% post_link Go/channelæ€»ç»“ [channelæ€»ç»“]%}&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GoåŸºç¡€-åˆ‡ç‰‡</title>
      <link>https://abnerxc.github.io/go/base3.%E5%88%87%E7%89%87/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/base3.%E5%88%87%E7%89%87/</guid>
      <description>&lt;h1 id=&#34;å†…éƒ¨å®ç°&#34;&gt;å†…éƒ¨å®ç° &lt;a href=&#34;#%e5%86%85%e9%83%a8%e5%ae%9e%e7%8e%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åˆ‡ç‰‡æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œå®ƒçš„åº•å±‚æ˜¯æ•°ç»„ï¼Œå®ƒè‡ªå·±æœ¬èº«éå¸¸å°ï¼Œå¯ä»¥ç†è§£ä¸ºå¯¹åº•å±‚æ•°ç»„çš„æŠ½è±¡
åˆ‡ç‰‡å¯¹è±¡éå¸¸å°ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯åªæœ‰3ä¸ªå­—æ®µçš„æ•°æ®ç»“æ„ï¼šä¸€ä¸ªæ˜¯æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆï¼Œä¸€ä¸ªæ˜¯åˆ‡ç‰‡çš„é•¿åº¦ï¼Œä¸€ä¸ªæ˜¯åˆ‡ç‰‡çš„å®¹é‡&lt;/p&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;å£°æ˜å’Œåˆå§‹åŒ–&#34;&gt;å£°æ˜å’Œåˆå§‹åŒ– &lt;a href=&#34;#%e5%a3%b0%e6%98%8e%e5%92%8c%e5%88%9d%e5%a7%8b%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice:=make([]int,5)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨å†…ç½®çš„makeå‡½æ•°æ—¶ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šåˆ‡ç‰‡çš„é•¿åº¦ï¼Œä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ—¶5ï¼Œè¿™æ—¶å€™åˆ‡ç‰‡çš„å®¹é‡ä¹Ÿæ˜¯5ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬æŒ‡å®šåˆ‡ç‰‡çš„å®¹é‡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice:=make([]int,5,10)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åˆ›å»ºçš„åˆ‡ç‰‡é•¿åº¦æ˜¯5ï¼Œå®¹é‡æ˜¯10,éœ€è¦æ³¨æ„çš„è¿™ä¸ªå®¹é‡10å…¶å®å¯¹åº”çš„æ˜¯åˆ‡ç‰‡åº•å±‚æ•°ç»„çš„ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºåˆ‡ç‰‡çš„åº•å±‚æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥åˆ›å»ºåˆ‡ç‰‡æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šå­—é¢å€¼çš„è¯ï¼Œé»˜è®¤å€¼å°±æ˜¯æ•°ç»„çš„å…ƒç´ çš„é›¶å€¼ã€‚è¿™é‡Œæˆ‘ä»¬æ‰€ä»¥æŒ‡å®šäº†å®¹é‡æ˜¯10ï¼Œä½†æ˜¯æˆ‘ä»¬åªèƒ½è®¿é—®5ä¸ªå…ƒç´ ï¼Œå› ä¸ºåˆ‡ç‰‡çš„é•¿åº¦æ˜¯5ï¼Œå‰©ä¸‹çš„5ä¸ªå…ƒç´ ï¼Œéœ€è¦åˆ‡ç‰‡æ‰©å……åæ‰å¯ä»¥è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å®¹é‡å¿…é¡»&amp;gt;=é•¿åº¦ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½åˆ›å»ºé•¿åº¦å¤§äºå®¹é‡çš„åˆ‡ç‰‡çš„ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice:=[]int{1,2,3,4,5}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸åˆ›å»ºæ•°ç»„éå¸¸åƒï¼Œåªä¸è¿‡ä¸ç”¨æŒ‡å®š&lt;code&gt;[]&lt;/code&gt;ä¸­çš„å€¼ï¼Œè¿™æ—¶å€™åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡æ˜¯ç›¸ç­‰çš„ï¼Œå¹¶ä¸”ä¼šæ ¹æ®æˆ‘ä»¬æŒ‡å®šçš„å­—é¢é‡æ¨å¯¼å‡ºæ¥&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice:=[]int{4:1}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ˜¯æŒ‡å®šäº†ç¬¬5ä¸ªå…ƒç´ ä¸º1ï¼Œå…¶ä»–å…ƒç´ éƒ½æ˜¯é»˜è®¤å€¼0ã€‚è¿™æ—¶å€™åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¹Ÿæ˜¯ä¸€æ ·çš„&lt;/p&gt;
&lt;h1 id=&#34;æ•°ç»„å’Œåˆ‡ç‰‡çš„å¾®å°å·®åˆ«&#34;&gt;æ•°ç»„å’Œåˆ‡ç‰‡çš„å¾®å°å·®åˆ« &lt;a href=&#34;#%e6%95%b0%e7%bb%84%e5%92%8c%e5%88%87%e7%89%87%e7%9a%84%e5%be%ae%e5%b0%8f%e5%b7%ae%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//æ•°ç»„
var arr [5]int
//åˆ‡ç‰‡
var slice []int


//æ•°ç»„
array:=[5]int{4:1}
//åˆ‡ç‰‡
slice:=[]int{4:1}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;nilåˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡&#34;&gt;nilåˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡ &lt;a href=&#34;#nil%e5%88%87%e7%89%87%e5%92%8c%e7%a9%ba%e5%88%87%e7%89%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//nilåˆ‡ç‰‡
var nilSlice []int
//ç©ºåˆ‡ç‰‡
slice:=[]int{}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;åŸºäºç°æœ‰åˆ‡ç‰‡æˆ–è€…æ•°ç»„åˆ›å»º&#34;&gt;åŸºäºç°æœ‰åˆ‡ç‰‡æˆ–è€…æ•°ç»„åˆ›å»º &lt;a href=&#34;#%e5%9f%ba%e4%ba%8e%e7%8e%b0%e6%9c%89%e5%88%87%e7%89%87%e6%88%96%e8%80%85%e6%95%b0%e7%bb%84%e5%88%9b%e5%bb%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice := []int{1, 2, 3, 4, 5}
slice1 := slice[:]
slice2 := slice[0:]
slice3 := slice[:5]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨[i:j]è¿™æ ·çš„æ“ä½œç¬¦å³å¯ï¼Œå¥¹è¡¨ç¤ºä»¥iç´¢å¼•å¼€å§‹ï¼Œåˆ°jç´¢å¼•ç»“æŸ,æˆªå–åŸæ•°ç»„æˆ–è€…åˆ‡ç‰‡ï¼Œåˆ›å»ºè€Œæˆçš„æ–°åˆ‡ç‰‡ï¼Œæ–°åˆ‡ç‰‡çš„å€¼åŒ…å«åŸåˆ‡ç‰‡çš„iç´¢å¼•ï¼Œä½†æ˜¯ä¸åŒ…å«jç´¢å¼•ã€‚&lt;code&gt;slice[i:j)&lt;/code&gt;åŒ…å«i,ä¸åŒ…å«j
ç¬¬3ä¸ªç”¨æ¥é™å®šæ–°åˆ‡ç‰‡çš„å®¹é‡ï¼Œå…¶ç”¨æ³•ä¸º&lt;code&gt;slice[i:j:k]&lt;/code&gt;,kç”¨æ¥é™å®šåˆ‡ç‰‡çš„å®¹é‡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice := []int{1, 2, 3, 4, 5}
newSlice := slice[1:2:3]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸€ä¸ªé•¿åº¦ä¸º2-1=1ï¼Œå®¹é‡ä¸º3-1=2çš„æ–°åˆ‡ç‰‡,ä¸è¿‡ç¬¬ä¸‰ä¸ªç´¢å¼•ï¼Œä¸èƒ½è¶…è¿‡åŸåˆ‡ç‰‡çš„æœ€å¤§ç´¢å¼•å€¼5&lt;/p&gt;
&lt;h1 id=&#34;åœ¨å‡½æ•°é—´ä¼ é€’åˆ‡ç‰‡&#34;&gt;åœ¨å‡½æ•°é—´ä¼ é€’åˆ‡ç‰‡ &lt;a href=&#34;#%e5%9c%a8%e5%87%bd%e6%95%b0%e9%97%b4%e4%bc%a0%e9%80%92%e5%88%87%e7%89%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	slice := []int{1, 2, 3, 4, 5}
	fmt.Printf(&amp;#34;%p\n&amp;#34;, &amp;amp;slice)
	modify(slice)
	fmt.Println(slice)
}

func modify(slice []int) {
	fmt.Printf(&amp;#34;%p\n&amp;#34;, &amp;amp;slice)
	slice[1] = 10
}

0xc420082060
0xc420082080
[1 10 3 4 5]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è§‚å¯Ÿå‘ç°ï¼Œè¿™ä¸¤ä¸ªåˆ‡ç‰‡çš„åœ°å€ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥ç¡®è®¤åˆ‡ç‰‡åœ¨å‡½æ•°é—´ä¼ é€’æ˜¯å¤åˆ¶çš„ã€‚è€Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªç´¢å¼•çš„å€¼åï¼Œå‘ç°åŸåˆ‡ç‰‡çš„å€¼ä¹Ÿè¢«ä¿®æ”¹äº†ï¼Œè¯´æ˜å®ƒä»¬å…±ç”¨ä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GoåŸºç¡€-åŸºæœ¬ç±»å‹</title>
      <link>https://abnerxc.github.io/go/base0.%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/base0.%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</guid>
      <description>&lt;h1 id=&#34;å†…å»ºç±»å‹ç§ç±»&#34;&gt;å†…å»ºç±»å‹ç§ç±» &lt;a href=&#34;#%e5%86%85%e5%bb%ba%e7%b1%bb%e5%9e%8b%e7%a7%8d%e7%b1%bb&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;boolï¼šå¸ƒå°”ç±»å‹,å¯é€‰ true|false,é»˜è®¤åˆå§‹åŒ–é›¶å€¼ false&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•´å‹
8bit=1å­—èŠ‚ï¼Œint(8)è¡¨ç¤º8ä¸ªbitä½&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;ç±»å‹&lt;/th&gt;
          &lt;th&gt;å­—èŠ‚&lt;/th&gt;
          &lt;th&gt;å–å€¼&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;(u)int(8)&lt;/td&gt;
          &lt;td&gt;2^0=1&lt;/td&gt;
          &lt;td&gt;2^8=-127~128&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;(u)int(16)&lt;/td&gt;
          &lt;td&gt;2^1=2&lt;/td&gt;
          &lt;td&gt;2^16&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;(u)int(32)&lt;/td&gt;
          &lt;td&gt;2^2=4&lt;/td&gt;
          &lt;td&gt;2^32&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;(u)int(64)&lt;/td&gt;
          &lt;td&gt;2^3=8&lt;/td&gt;
          &lt;td&gt;2^64&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;(u)int&lt;/td&gt;
          &lt;td&gt;è·Ÿéšæ“ä½œç³»ç»Ÿä½æ•°(32or64ä½)&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;uintptr:ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ— ç¬¦å·æ•´å‹ï¼Œ ç”¨æ¥è¡¨ç¤ºä»»æ„åœ°å€;ä¸€ä¸ªuintptræ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä¸æ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚æŠŠä¸€ä¸ªPointerè½¬æ¢ä¸ºuintptråï¼Œå®é™…æ˜¯å‰¥ç¦»äº†åŸæœ‰çš„æŒ‡é’ˆçš„è¯­ä¹‰ï¼Œåªå–äº†åœ°å€çš„æ•´æ•°å€¼ã€‚&lt;code&gt;p = unsafe.Pointer( uintptr ( p ) + offset )&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;byte(uint8) , rune(int32)ï¼Œstring&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;byte :æœ€åŸºç¡€å­—èŠ‚ç±»å‹,æ˜¯ uint8 ç±»å‹çš„åˆ«å&lt;/li&gt;
&lt;li&gt;rune : Go ä¸­çš„å­—ç¬¦ç±»å‹,æ˜¯ int32 çš„åˆ«å&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;string
å€¼ç”¨ &amp;quot;&amp;quot; æˆ–è€… `` åŒ…æ‹¬, `` å¯åŒ…å«å¤šè¡Œå­—ç¬¦ä¸²,å­—ç¬¦ä¸²çš„å†…å®¹åœ¨åˆå§‹åŒ–åï¼Œä¸èƒ½è¢«ä¿®æ”¹ï¼Œä½†å¯é‡æ–°å®Œå…¨èµ‹å€¼ï¼Œå­—ç¬¦ä¸²çš„æ“ä½œä¸æ•°ç»„ç›¸åŒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;float32 , float64 , complex64 , complex128
8bit=1å­—èŠ‚ï¼Œfloat32è¡¨ç¤º32ä¸ªbitä½ï¼Œåˆšå¥½4ä¸ªå­—èŠ‚&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;ç±»å‹&lt;/th&gt;
          &lt;th&gt;å­—èŠ‚&lt;/th&gt;
          &lt;th&gt;å–å€¼&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;float32&lt;/td&gt;
          &lt;td&gt;4&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;float64&lt;/td&gt;
          &lt;td&gt;8&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;complex64&lt;/td&gt;
          &lt;td&gt;8&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;complex128&lt;/td&gt;
          &lt;td&gt;16&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;å†…å»ºç±»å‹ç‰¹ç‚¹&#34;&gt;å†…å»ºç±»å‹ç‰¹ç‚¹ &lt;a href=&#34;#%e5%86%85%e5%bb%ba%e7%b1%bb%e5%9e%8b%e7%89%b9%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;ç±»å‹è½¬æ¢åªæœ‰æ˜¾ç¤ºè½¬æ¢,ä¸å­˜åœ¨ä»»ä½•å½¢å¼çš„éšå¼ç±»å‹è½¬æ¢&lt;/li&gt;
&lt;li&gt;è™½ç„¶æä¾›æŒ‡é’ˆç±»å‹,ä½†æŒ‡é’ˆæœ¬èº«ä¸èƒ½è¿›è¡Œä»»ä½•å½¢å¼çš„è®¡ç®—&lt;/li&gt;
&lt;li&gt;å˜é‡å£°æ˜åæœ‰é»˜è®¤åˆå§‹åŒ–é›¶å€¼,å˜é‡é›¶å€¼è§†å…·ä½“ç±»å‹è€Œå®š&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;initå‡½æ•°ç‰¹ç‚¹&#34;&gt;initå‡½æ•°ç‰¹ç‚¹ &lt;a href=&#34;#init%e5%87%bd%e6%95%b0%e7%89%b9%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;ä¸»è¦ä½œç”¨
&lt;ul&gt;
&lt;li&gt;åˆå§‹åŒ–ä¸èƒ½é‡‡ç”¨åˆå§‹åŒ–è¡¨è¾¾å¼åˆå§‹åŒ–çš„å˜é‡ã€‚&lt;/li&gt;
&lt;li&gt;ç¨‹åºè¿è¡Œå‰çš„æ³¨å†Œã€‚&lt;/li&gt;
&lt;li&gt;å®ç°sync.OnceåŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å…¶ä»–&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç‰¹ç‚¹&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;init() å‡½æ•°æ˜¯ç”¨äºç¨‹åºæ‰§è¡Œå‰åšåŒ…çš„åˆå§‹åŒ–çš„å‡½æ•°ï¼Œæ¯”å¦‚åˆå§‹åŒ–åŒ…é‡Œçš„å˜é‡ç­‰;&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªåŒ…å¯ä»¥å‡ºçº¿å¤šä¸ª init() å‡½æ•°,ä¸€ä¸ªæºæ–‡ä»¶ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ª init() å‡½æ•°ï¼›&lt;/li&gt;
&lt;li&gt;åŒä¸€ä¸ªåŒ…ä¸­å¤šä¸ª init() å‡½æ•°çš„æ‰§è¡Œé¡ºåºæ²¡æœ‰æ˜ç¡®å®šä¹‰ï¼Œä½†æ˜¯ä¸åŒåŒ…çš„initå‡½æ•°æ˜¯æ ¹æ®åŒ…å¯¼å…¥çš„ä¾èµ–å…³ç³»å†³å®šçš„ï¼ˆçœ‹ä¸‹å›¾ï¼‰;&lt;/li&gt;
&lt;li&gt;init() å‡½æ•°åœ¨ä»£ç ä¸­ä¸èƒ½è¢«æ˜¾ç¤ºè°ƒç”¨ã€ä¸èƒ½è¢«å¼•ç”¨ï¼ˆèµ‹å€¼ç»™å‡½æ•°å˜é‡ï¼‰ï¼Œå¦åˆ™å‡ºç°ç¼–è¯‘é”™è¯¯;&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªåŒ…è¢«å¼•ç”¨å¤šæ¬¡ï¼Œå¦‚ A import B,C import B,A import Cï¼ŒB è¢«å¼•ç”¨å¤šæ¬¡ï¼Œä½† B åŒ…åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼›&lt;/li&gt;
&lt;li&gt;å¼•å…¥åŒ…ï¼Œä¸å¯å‡ºç°æ­»å¾ªåã€‚å³ A import B,B import Aï¼Œè¿™ç§æƒ…å†µç¼–è¯‘å¤±è´¥ï¼›
&lt;img src=&#34;https://abnerxc.github.io/img/go-inipack.jpeg&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;typeçš„ä½¿ç”¨&#34;&gt;.(type)çš„ä½¿ç”¨ &lt;a href=&#34;#type%e7%9a%84%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ç±»å‹é€‰æ‹©ï¼Œç±»å‹é€‰æ‹©çš„è¯­æ³•å½¢å¦‚ï¼ši.(type)ï¼Œå…¶ä¸­ i æ˜¯æ¥å£ï¼Œtype æ˜¯å›ºå®šå…³é”®å­—ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;code&gt;åªæœ‰æ¥å£ç±»å‹æ‰å¯ä»¥ä½¿ç”¨ç±»å‹é€‰æ‹©&lt;/code&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GoåŸºç¡€-å­—ç¬¦ä¸²é«˜æ•ˆæ‹¼</title>
      <link>https://abnerxc.github.io/go/base2.%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%AB%98%E6%95%88%E6%8B%BC%E6%8E%A5/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/base2.%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%AB%98%E6%95%88%E6%8B%BC%E6%8E%A5/</guid>
      <description>&lt;h1 id=&#34;å·æ‹¼æ¥&#34;&gt;+å·æ‹¼æ¥ &lt;a href=&#34;#%e5%8f%b7%e6%8b%bc%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è¿™ç§æ‹¼æ¥æœ€ç®€å•ï¼Œä¹Ÿæœ€å®¹æ˜“è¢«æˆ‘ä»¬ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯ä¸é™ç¼–ç¨‹è¯­è¨€çš„ï¼Œæ¯”å¦‚Goè¯­è¨€æœ‰ï¼ŒJavaä¹Ÿæœ‰ï¼Œå®ƒä»¬æ˜¯+å·è¿ç®—ç¬¦ï¼Œåœ¨è¿è¡Œæ—¶è®¡ç®—çš„ã€‚ç°åœ¨æ¼”ç¤ºä¸‹è¿™ç§æ‹¼æ¥çš„ä»£ç ï¼Œè™½ç„¶æ¯”è¾ƒç®€å•ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringPlus() string{
	var s string
	s+=&amp;#34;æ˜µç§°&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;é£é›ªæ— æƒ…&amp;#34;+&amp;#34;\n&amp;#34;
	s+=&amp;#34;åšå®¢&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;http://www.flysnow.org/&amp;#34;+&amp;#34;\n&amp;#34;
	s+=&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;flysnow_org&amp;#34;
	return s
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥è‡ªå·±å†™ä¸ªç”¨ä¾‹æµ‹è¯•ä¸‹ï¼Œå¯ä»¥æ‰“å°å‡ºå’Œæˆ‘ä»¬ä¾‹å­ä¸­ä¸€æ ·çš„å†…å®¹ã€‚é‚£ä¹ˆè¿™ç§æœ€å¸¸è§çš„å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼æ€§èƒ½æ€ä¹ˆæ ·çš„å‘¢ï¼Œæˆ‘ä»¬æµ‹è¯•ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func BenchmarkStringPlus(b *testing.B) {
	for i:=0;i&amp;lt;b.N;i++{
		StringPlus()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿è¡Œ&lt;code&gt;go test -bench=. -benchmem&lt;/code&gt; æŸ¥çœ‹æ€§èƒ½è¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringPlus-8   20000000    108 ns/op   144 B/op    2 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ¯æ¬¡æ“ä½œéœ€è¦108ns,è¿›è¡Œ2æ¬¡å†…å­˜åˆ†é…ï¼Œåˆ†é…114å­—èŠ‚çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;fmt-æ‹¼æ¥&#34;&gt;fmt æ‹¼æ¥ &lt;a href=&#34;#fmt-%e6%8b%bc%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è¿™ç§æ‹¼æ¥ï¼Œå€ŸåŠ©äº&lt;code&gt;fmt.Sprint&lt;/code&gt;ç³»åˆ—å‡½æ•°è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åè¿”å›æ‹¼æ¥çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringFmt() string{
	return fmt.Sprint(&amp;#34;æ˜µç§°&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;é£é›ªæ— æƒ…&amp;#34;,&amp;#34;\n&amp;#34;,&amp;#34;åšå®¢&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;http://www.flysnow.org/&amp;#34;,&amp;#34;\n&amp;#34;,&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;flysnow_org&amp;#34;)
}

func BenchmarkStringFmt(b *testing.B) {
	for i:=0;i&amp;lt;b.N;i++{
		StringFmt()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿è¡ŒæŸ¥çœ‹æµ‹è¯•ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringFmt-8    5000000     385 ns/op   80 B/op     1 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;font color=red&gt;è™½ç„¶æ¯æ¬¡æ“ä½œå†…å­˜åˆ†é…åªæœ‰1æ¬¡ï¼Œåˆ†é…80å­—èŠ‚ä¹Ÿä¸å¤šï¼Œä½†æ˜¯æ¯æ¬¡æ“ä½œè€—æ—¶å¤ªé•¿ï¼Œæ€§èƒ½è¿œæ²¡æœ‰&lt;code&gt;+&lt;/code&gt;å·æ“ä½œå¿«ã€‚&lt;/font&gt;&lt;/p&gt;
&lt;h1 id=&#34;join-æ‹¼æ¥&#34;&gt;Join æ‹¼æ¥ &lt;a href=&#34;#join-%e6%8b%bc%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è¿™ä¸ªæ˜¯åˆ©ç”¨&lt;code&gt;strings.Join&lt;/code&gt;å‡½æ•°è¿›è¡Œæ‹¼æ¥ï¼Œæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè½¬æ¢ä¸ºä¸€ä¸ªæ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringJoin() string{
	s:=[]string{&amp;#34;æ˜µç§°&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;é£é›ªæ— æƒ…&amp;#34;,&amp;#34;\n&amp;#34;,&amp;#34;åšå®¢&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;http://www.flysnow.org/&amp;#34;,&amp;#34;\n&amp;#34;,&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;flysnow_org&amp;#34;}
	return strings.Join(s,&amp;#34;&amp;#34;)
}

func BenchmarkStringJoin(b *testing.B) {
	for i:=0;i&amp;lt;b.N;i++{
		StringJoin()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠæ€§èƒ½æµ‹è¯•çš„ä»£ç æ”¾ä¸€èµ·äº†ï¼Œç°åœ¨çœ‹çœ‹æ€§èƒ½æµ‹è¯•çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringJoin-8   10000000    177 ns/op   160 B/op    2 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;font color=red&gt;æ•´ä½“å’Œ&lt;code&gt;+&lt;/code&gt;æ“ä½œç›¸å·®ä¸äº†å¤ªå¤šï¼Œå¤§æ¦‚ä½0.5å€çš„æ ·å­ã€‚&lt;/font&gt;&lt;/p&gt;
&lt;h1 id=&#34;buffer-æ‹¼æ¥&#34;&gt;buffer æ‹¼æ¥ &lt;a href=&#34;#buffer-%e6%8b%bc%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è¿™ç§è¢«ç”¨çš„ä¹Ÿå¾ˆå¤šï¼Œä½¿ç”¨çš„æ˜¯&lt;code&gt;bytes.Buffer&lt;/code&gt;è¿›è¡Œçš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå®ƒæ˜¯éå¸¸çµæ´»çš„ä¸€ä¸ªç»“æ„ä½“ï¼Œä¸æ­¢å¯ä»¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œè¿˜æ˜¯å¯ä»¥&lt;code&gt;byte,rune&lt;/code&gt;ç­‰ï¼Œå¹¶ä¸”å®ç°äº†&lt;code&gt;io.Writer&lt;/code&gt;æ¥å£ï¼Œå†™å…¥ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringBuffer() string {
	var b bytes.Buffer
	b.WriteString(&amp;#34;æ˜µç§°&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;é£é›ªæ— æƒ…&amp;#34;)
	b.WriteString(&amp;#34;\n&amp;#34;)
	b.WriteString(&amp;#34;åšå®¢&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;http://www.flysnow.org/&amp;#34;)
	b.WriteString(&amp;#34;\n&amp;#34;)
	b.WriteString(&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;flysnow_org&amp;#34;)
	return b.String()
}

func BenchmarkStringBuffer(b *testing.B) {
	for i:=0;i&amp;lt;b.N;i++{
		StringBuffer()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çœ‹çœ‹ä»–çš„æ€§èƒ½ï¼Œè¿è¡Œè¾“å‡ºå³å¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringBuffer-8     5000000     291 ns/op   336 B/op    3 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¥½åƒå¹¶ä¸æ˜¯å¤ªå¥½,å’Œæœ€å·®çš„fmtæ‹¼æ¥å·®ä¸å¤šï¼Œå’Œ&lt;code&gt;+&lt;/code&gt;å·ï¼ŒJoinæ‹¼æ¥å·®å¥½è¿œï¼Œå†…å­˜åˆ†é…ä¹Ÿæ¯”è¾ƒå¤šã€‚æ¯æ¬¡æ“ä½œè€—æ—¶ä¹Ÿå¾ˆé•¿ã€‚&lt;/p&gt;
&lt;h1 id=&#34;builder-æ‹¼æ¥&#34;&gt;builder æ‹¼æ¥ &lt;a href=&#34;#builder-%e6%8b%bc%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä¸ºäº†æ”¹è¿›bufferæ‹¼æ¥çš„æ€§èƒ½ï¼Œä»go 1.10 ç‰ˆæœ¬å¼€å§‹ï¼Œå¢åŠ äº†ä¸€ä¸ªbuilderç±»å‹ï¼Œç”¨äºæå‡å­—ç¬¦ä¸²æ‹¼æ¥çš„æ€§èƒ½ã€‚å®ƒçš„ä½¿ç”¨å’Œbufferå‡ ä¹ä¸€æ ·ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringBuilder() string {
	var b strings.Builder
	b.WriteString(&amp;#34;æ˜µç§°&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;é£é›ªæ— æƒ…&amp;#34;)
	b.WriteString(&amp;#34;\n&amp;#34;)
	b.WriteString(&amp;#34;åšå®¢&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;http://www.flysnow.org/&amp;#34;)
	b.WriteString(&amp;#34;\n&amp;#34;)
	b.WriteString(&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;flysnow_org&amp;#34;)
	return b.String()
}

func BenchmarkStringBuilder(b *testing.B) {
	for i:=0;i&amp;lt;b.N;i++{
		StringBuilder()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å®˜æ–¹éƒ½è¯´æ¯”bufferæ€§èƒ½å¥½äº†ï¼Œæˆ‘ä»¬çœ‹çœ‹æ€§èƒ½æµ‹è¯•çš„ç»“æœã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringBuilder-8    10000000    170 ns/op   232 B/op    4 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çš„ç¡®æå‡äº†ï¼Œæå‡äº†ä¸€å€ï¼Œè™½ç„¶æ¯æ¬¡åˆ†é…çš„å†…å­˜æ¬¡æ•°æœ‰ç‚¹å¤šï¼Œä½†æ˜¯æ¯æ¬¡åˆ†é…çš„å†…å­˜å¤§å°æ¯”bufferè¦å°‘ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€§èƒ½å¯¹æ¯”&#34;&gt;æ€§èƒ½å¯¹æ¯” &lt;a href=&#34;#%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯å¸¸ç”¨çš„å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ï¼Œç°åœ¨æˆ‘ä»¬æŠŠè¿™äº›æµ‹è¯•ç»“æœï¼Œæ±‡æ€»åˆ°ä¸€èµ·ï¼Œå¯¹æ¯”ä¸‹çœ‹çœ‹,å› ä¸ºBenchmarkçš„æµ‹è¯•ï¼Œå¯¹äºæ€§èƒ½åªæ˜¾ç¤ºï¼Œæˆ‘æŠŠæµ‹è¯•çš„æ—¶é—´è®¾ç½®ä¸º3sï¼ˆç§’ï¼‰ï¼ŒæŠŠæ—¶é—´æ‹‰é•¿ä¾¿äºå¯¹æ¯”æµ‹è¯•ï¼ŒåŒæ—¶ç”Ÿæˆäº†cpu profileæ–‡ä»¶ï¼Œç”¨äºæ€§èƒ½åˆ†æã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œ&lt;code&gt;go test xx.go -bench=. -benchmem -benchtime=3s -cpuprofile=profile.out&lt;/code&gt;å¾—åˆ°å¦‚ä¸‹æµ‹è¯•ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;StringPlus-8    50000000    112 ns/op   144 B/op    2 allocs/op
StringFmt-8     20000000    344 ns/op   80 B/op     1 allocs/op
StringJoin-8    30000000    171 ns/op   160 B/op    2 allocs/op
StringBuffer-8  20000000    302 ns/op   336 B/op    3 allocs/op
StringBuilder-8 30000000    171 ns/op   232 B/op    4 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬é€šè¿‡&lt;code&gt;go tool pprof profile.out&lt;/code&gt; çœ‹ä¸‹æˆ‘ä»¬è¾“å‡ºçš„cpu profileä¿¡æ¯ã€‚è¿™é‡Œä¸»è¦ä½¿ç”¨topå‘½ä»¤ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Showing top 15 nodes out of 89
      flat  flat%   sum%        cum   cum%
    11.99s 42.55% 42.55%     11.99s 42.55%  runtime.kevent
     6.30s 22.36% 64.90%      6.30s 22.36%  runtime.pthread_cond_wait
     1.65s  5.86% 70.76%      1.65s  5.86%  runtime.pthread_cond_signal
     1.11s  3.94% 74.70%      1.11s  3.94%  runtime.usleep
     1.10s  3.90% 78.60%      1.10s  3.90%  runtime.pthread_cond_timedwait_relative_np
     0.58s  2.06% 80.66%      0.62s  2.20%  runtime.wbBufFlush1
     0.51s  1.81% 82.47%      0.51s  1.81%  runtime.memmove
     0.44s  1.56% 84.03%      1.81s  6.42%  fmt.(*pp).printArg
     0.39s  1.38% 85.42%      2.36s  8.37%  fmt.(*pp).doPrint
     0.36s  1.28% 86.69%      0.70s  2.48%  fmt.(*buffer).WriteString (inline)
     0.34s  1.21% 87.90%      0.93s  3.30%  runtime.mallocgc
     0.20s  0.71% 88.61%      1.20s  4.26%  fmt.(*fmt).fmtS
     0.18s  0.64% 89.25%      0.18s  0.64%  fmt.(*fmt).truncate
     0.16s  0.57% 89.82%      0.16s  0.57%  runtime.memclrNoHeapPointers
     0.15s  0.53% 90.35%      1.35s  4.79%  fmt.(*pp).fmtString
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å‰15ä¸ªï¼Œå¯ä»¥çœ‹åˆ°fmtæ‹¼æ¥çš„æ–¹å¼æ˜¯æœ€å·®çš„ï¼Œå› ä¸ºfmté‡Œå¾ˆå¤šæ–¹æ³•è€—æ—¶æ’åœ¨äº†æœ€å‰é¢ã€‚bufferçš„WriteStringæ–¹æ³•ä¹Ÿæ¯”è¾ƒè€—æ—¶ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šçš„TOPå¯èƒ½è¿˜ä¸æ˜¯å¤ªç›´è§‚ï¼Œå¦‚æœå¤§å®¶çœ‹ç«ç„°å›¾çš„è¯ï¼Œå°±ä¼šæ›´æ¸…æ™°ã€‚æ€§èƒ½æœ€å¥½çš„æ˜¯&lt;code&gt;+&lt;/code&gt;å·æ‹¼æ¥ã€Joinæ‹¼æ¥ï¼Œæœ€æ…¢çš„æ˜¯fmtæ‹¼æ¥ï¼Œè¿™é‡Œçš„builderå’Œbufferæ‹¼æ¥å·®ä¸å¤šï¼Œå¹¶æ²¡æœ‰å‘æŒ¥å‡ºå…¶èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ç–‘é—®&#34;&gt;ç–‘é—® &lt;a href=&#34;#%e7%96%91%e9%97%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»æ•´ä¸ªæ€§èƒ½çš„æµ‹è¯•å’Œåˆ†ææ¥çœ‹ï¼Œæˆ‘ä»¬æœŸå¾…çš„builderå¹¶æ²¡æœ‰å‘æŒ¥å‡ºæ¥ï¼Œè¿™æ˜¯ä¸æ˜¯æ„å‘³ç€builderä¸å®ç”¨äº†å‘¢ï¼Ÿè¿˜ä¸å¦‚+å·å’ŒJoinæ‹¼æ¥å‘¢ï¼Ÿç»§ç»­æ¥ç€åˆ†æ,çŒœæµ‹å¯èƒ½åŸå› å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‹¼æ¥çš„å­—ç¬¦ä¸²å¤§å°&lt;/li&gt;
&lt;li&gt;æ‹¼æ¥çš„å­—ç¬¦ä¸²æ•°é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ‹¼æ¥å‡½æ•°æ”¹é€ &#34;&gt;æ‹¼æ¥å‡½æ•°æ”¹é€  &lt;a href=&#34;#%e6%8b%bc%e6%8e%a5%e5%87%bd%e6%95%b0%e6%94%b9%e9%80%a0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å‰é¢æåˆ°äº†2ç§å¯èƒ½çš„çŒœæµ‹ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²çš„æ•°é‡å’Œæ‹¼æ¥å­—ç¬¦ä¸²çš„å¤§å°ï¼Œç°åœ¨æˆ‘ä»¬å°±å¼€å§‹è¯æ˜è¿™ä¸¤ç§æƒ…å†µï¼Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠåŸæ¥çš„æ‹¼æ¥å‡½æ•°ä¿®æ”¹ä¸€ä¸‹ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ª[]stringç±»å‹çš„å‚æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹åˆ‡ç‰‡æ•°ç»„è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºæ‰€æœ‰çš„æ‹¼æ¥æ–¹æ³•çš„æ”¹é€ åå®ç°ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringPlus(p []string) string{
	var s string
	l:=len(p)
	for i:=0;i&amp;lt;l;i++{
		s+=p[i]
	}
	return s
}

func StringFmt(p []interface{}) string{
	return fmt.Sprint(p...)
}

func StringJoin(p []string) string{
	return strings.Join(p,&amp;#34;&amp;#34;)
}

func StringBuffer(p []string) string {
	var b bytes.Buffer
	l:=len(p)
	for i:=0;i&amp;lt;l;i++{
		b.WriteString(p[i])
	}
	return b.String()
}

func StringBuilder(p []string) string {
	var b strings.Builder
	l:=len(p)
	for i:=0;i&amp;lt;l;i++{
		b.WriteString(p[i])
	}
	return b.String()
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;æµ‹è¯•ç”¨ä¾‹&#34;&gt;æµ‹è¯•ç”¨ä¾‹ &lt;a href=&#34;#%e6%b5%8b%e8%af%95%e7%94%a8%e4%be%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»¥ä¸Šçš„å­—ç¬¦ä¸²æ‹¼æ¥å‡½æ•°ä¿®æ”¹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ ä¸åŒå¤§å°çš„åˆ‡ç‰‡è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥æµ‹è¯•äº†ã€‚ä¸ºäº†æ¨¡æ‹Ÿä¸Šæ¬¡çš„æ•ˆæœï¼Œæˆ‘ä»¬å…ˆç”¨10ä¸ªåˆ‡ç‰‡å¤§å°çš„å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥æµ‹è¯•ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const BLOG  = &amp;#34;http://www.flysnow.org/&amp;#34;

func initStrings(N int) []string{
	s:=make([]string,N)
	for i:=0;i&amp;lt;N;i++{
		s[i]=BLOG
	}
	return s;
}

func initStringi(N int) []interface{}{
	s:=make([]interface{},N)
	for i:=0;i&amp;lt;N;i++{
		s[i]=BLOG
	}
	return s;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ˜¯ä¸¤ä¸ªæ„å»ºæµ‹è¯•ç”¨ä¾‹åˆ‡ç‰‡æ•°ç»„çš„å‡½æ•°ï¼Œå¯ä»¥ç”ŸæˆNä¸ªå¤§å°çš„åˆ‡ç‰‡ã€‚ç¬¬äºŒä¸ªinitStringiå‡½æ•°è¿”å›çš„æ˜¯[]interface{}ï¼Œè¿™æ˜¯ä¸“é—¨ä¸ºStringFmt(p []interface{})æ‹¼æ¥å‡½æ•°å‡†å¤‡çš„ï¼Œå‡å°‘ç±»å‹ä¹‹é—´çš„è½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†è¿™ä¸¤ä¸ªç”Ÿæˆæµ‹è¯•ç”¨ä¾‹çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»ºæˆ‘ä»¬çš„Goè¯­è¨€æ€§èƒ½æµ‹è¯•äº†ï¼Œæˆ‘ä»¬å…ˆæµ‹è¯•10ä¸ªå¤§å°çš„åˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func BenchmarkStringPlus10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringPlus(p)
	}
}

func BenchmarkStringFmt10(b *testing.B) {
	p:= initStringi(10)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringFmt(p)
	}
}

func BenchmarkStringJoin10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringJoin(p)
	}
}

func BenchmarkStringBuffer10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuffer(p)
	}
}

func BenchmarkStringBuilder10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuilder(p)
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨æ¯ä¸ªæ€§èƒ½æµ‹è¯•å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šè°ƒç”¨b.ResetTimer()ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…æµ‹è¯•ç”¨ä¾‹å‡†å¤‡æ—¶é—´ä¸åŒï¼Œå¸¦æ¥çš„æ€§èƒ½æµ‹è¯•æ•ˆæœåå·®é—®é¢˜
æˆ‘ä»¬è¿è¡Œ&lt;code&gt;go test -bench=. -run=NONE -benchmem&lt;/code&gt; æŸ¥çœ‹ç»“æœã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringPlus10-8     3000000     593 ns/op   1312 B/op   9 allocs/op
BenchmarkStringFmt10-8      5000000     335 ns/op   240 B/op    1 allocs/op
BenchmarkStringJoin10-8     10000000    200 ns/op   480 B/op    2 allocs/op
BenchmarkStringBuffer10-8   3000000     452 ns/op   864 B/op    4 allocs/op
BenchmarkStringBuilder10-8  10000000    231 ns/op   480 B/op    4 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€šè¿‡è¿™æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code&gt;+&lt;/code&gt;å·æ‹¼æ¥ä¸å†å…·æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºstringæ˜¯ä¸å¯å˜çš„ï¼Œæ¯æ¬¡æ‹¼æ¥éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„&lt;code&gt;string&lt;/code&gt;,ä¹Ÿå°±æ˜¯ä¼šè¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œæˆ‘ä»¬ç°åœ¨æ˜¯10ä¸ªå¤§å°çš„åˆ‡ç‰‡ï¼Œæ¯æ¬¡æ“ä½œè¦è¿›è¡Œ9æ¬¡è¿›è¡Œåˆ†é…ï¼Œå ç”¨å†…å­˜ï¼Œæ‰€ä»¥æ¯æ¬¡æ“ä½œæ—¶é—´éƒ½æ¯”è¾ƒé•¿ï¼Œè‡ªç„¶æ€§èƒ½å°±ä½ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ç« ä¸Šé¢å…³äº&lt;code&gt;+&lt;/code&gt;æ‹¼æ¥è¿˜æœ‰å°è±¡ï¼Œ&lt;code&gt;+&lt;/code&gt;åŠ å·æ‹¼æ¥çš„æ€§èƒ½æµ‹è¯•ä¸­æ˜¾ç¤ºçš„åªæœ‰2æ¬¡å†…å­˜åˆ†é…ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨äº†å¥½å¤šä¸ª&lt;code&gt;+&lt;/code&gt;çš„ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringPlus() string{
	var s string
	s+=&amp;#34;æ˜µç§°&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;é£é›ªæ— æƒ…&amp;#34;+&amp;#34;\n&amp;#34;
	s+=&amp;#34;åšå®¢&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;http://www.flysnow.org/&amp;#34;+&amp;#34;\n&amp;#34;
	s+=&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;flysnow_org&amp;#34;
	return s
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å†æ¥å›é¡¾ä¸‹è¿™æ®µä»£ç ï¼Œçš„ç¡®æ˜¯æœ‰å¾ˆå¤š+çš„ï¼Œä½†æ˜¯åªæœ‰2æ¬¡å†…å­˜åˆ†é…ï¼Œæˆ‘ä»¬å¯ä»¥å¤§èƒ†çŒœæµ‹,æ˜¯3æ¬¡s+=å¯¼è‡´çš„ï¼Œæ­£å¸¸å’Œæˆ‘ä»¬ä»Šå¤©æµ‹è¯•çš„10ä¸ªé•¿åº¦çš„åˆ‡ç‰‡ï¼Œåªæœ‰9æ¬¡å†…å­˜åˆ†é…ä¸€æ ·ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡è¿è¡Œå¦‚ä¸‹å‘½ä»¤çœ‹ä¸‹Goç¼–è¯‘å™¨å¯¹è¿™æ®µä»£ç çš„ä¼˜åŒ–ï¼š&lt;code&gt;go build -gcflags=&amp;quot;-m -m&amp;quot; main.go&lt;/code&gt;,è¾“å‡ºä¸­æœ‰å¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;can inline StringPlus as: func() string { var s string; s = &amp;lt;N&amp;gt;; s += &amp;#34;æ˜µç§°:é£é›ªæ— æƒ…\n&amp;#34;; s += &amp;#34;åšå®¢:http://www.flysnow.org/\n&amp;#34;; s += &amp;#34;å¾®ä¿¡å…¬ä¼—å·:flysnow_org&amp;#34;; return s }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç°åœ¨ä¸€ç›®äº†ç„¶äº†ï¼Œå…¶å®æ˜¯ç¼–è¯‘å™¨å¸®æˆ‘ä»¬æŠŠå­—ç¬¦ä¸²åšäº†ä¼˜åŒ–ï¼Œåªå‰©ä¸‹3ä¸ª&lt;code&gt;s+=&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡ï¼Œé‡‡ç”¨é•¿åº¦ä¸º10ä¸ªåˆ‡ç‰‡è¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå¾ˆæ˜æ˜¾æµ‹è¯•å‡ºäº†Builderè¦æ¯”Bufferæ€§èƒ½å¥½å¾ˆå¤šï¼Œè¿™ä¸ªé—®é¢˜åŸå› ä¸»è¦è¿˜æ˜¯&lt;code&gt;[]byte&lt;/code&gt;å’Œ&lt;code&gt;string&lt;/code&gt;ä¹‹é—´çš„è½¬æ¢ï¼Œ&lt;code&gt;Builder&lt;/code&gt;æ°æ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (b *Builder) String() string {
	return *(*string)(unsafe.Pointer(&amp;amp;b.buf))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¾ˆé«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h1 id=&#34;100ä¸ªå­—ç¬¦ä¸²&#34;&gt;100ä¸ªå­—ç¬¦ä¸² &lt;a href=&#34;#100%e4%b8%aa%e5%ad%97%e7%ac%a6%e4%b8%b2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬æµ‹è¯•ä¸‹100ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥çš„æƒ…å†µï¼Œå¯¹äºæˆ‘ä»¬ä¸Šé¢çš„ä»£ç ï¼Œè¦æ”¹é€ éå¸¸å®¹æ˜“ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºæµ‹è¯•ä»£ç ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func BenchmarkStringPlus100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringPlus(p)
	}
}

func BenchmarkStringFmt100(b *testing.B) {
	p:= initStringi(100)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringFmt(p)
	}
}

func BenchmarkStringJoin100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringJoin(p)
	}
}

func BenchmarkStringBuffer100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuffer(p)
	}
}

func BenchmarkStringBuilder100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuilder(p)
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç°åœ¨è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼Œçœ‹çœ‹100ä¸ªå­—ç¬¦ä¸²è¿æ¥çš„æ€§èƒ½æ€ä¹ˆæ ·ï¼Œå“ªä¸ªå‡½æ•°æœ€é«˜æ•ˆã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringPlus100-8    100000  19711 ns/op     123168 B/op     99 allocs/op
BenchmarkStringFmt100-8     500000  2615 ns/op      2304 B/op       1 allocs/op
BenchmarkStringJoin100-8    1000000 1516 ns/op      4608 B/op       2 allocs/op
BenchmarkStringBuffer100-8  500000  2333 ns/op      8112 B/op       7 allocs/op
BenchmarkStringBuilder100-8 1000000 1714 ns/op      6752 B/op       8 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;+&lt;/code&gt;å·å’Œæˆ‘ä»¬ä¸Šé¢åˆ†æå¾—ä¸€æ ·ï¼Œè¿™æ¬¡æ˜¯99æ¬¡å†…å­˜åˆ†é…ï¼Œæ€§èƒ½ä½“éªŒè¶Šæ¥è¶Šå·®ï¼Œåœ¨åé¢çš„æµ‹è¯•ä¸­ï¼Œä¼šæ’é™¤æ‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;fmt&lt;/code&gt;å’Œ&lt;code&gt;bufrer&lt;/code&gt;å·²ç»çš„æ€§èƒ½ä¹Ÿæ²¡æœ‰æå‡ï¼Œç»§ç»­èµ°ä½ã€‚å‰©ä¸‹æ¯”è¾ƒåšæŒºçš„æ˜¯&lt;code&gt;Join&lt;/code&gt;å’Œ&lt;code&gt;Builder&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h1 id=&#34;1000-ä¸ªå­—ç¬¦ä¸²&#34;&gt;1000 ä¸ªå­—ç¬¦ä¸²ã€‚ &lt;a href=&#34;#1000-%e4%b8%aa%e5%ad%97%e7%ac%a6%e4%b8%b2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æµ‹è¯•ç”¨åŠ›å’Œä¸Šé¢ç« èŠ‚çš„å¤§åŒå°å¼‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥çœ‹æµ‹è¯•ç»“æœã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringPlus1000-8       1000    1611985 ns/op   12136228 B/op   999 allocs/op
BenchmarkStringFmt1000-8        50000   28510 ns/op     24590 B/op      1 allocs/op
BenchmarkStringJoin1000-8       100000  15050 ns/op     49152 B/op      2 allocs/op
BenchmarkStringBuffer1000-8     100000  23534 ns/op     122544 B/op     11 allocs/op
BenchmarkStringBuilder1000-8    100000  17996 ns/op     96224 B/op      16 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ•´ä½“å’Œ100ä¸ªå­—ç¬¦ä¸²çš„æ—¶å€™å·®ä¸å¤šï¼Œè¡¨ç°å¥½çš„è¿˜æ˜¯&lt;code&gt;Join&lt;/code&gt;å’Œ&lt;code&gt;Builder&lt;/code&gt;ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½¿ç”¨ä¾§é‡ç‚¹æœ‰äº›ä¸ä¸€æ ·ï¼Œ å¦‚æœæœ‰ç°æˆçš„æ•°ç»„ã€åˆ‡ç‰‡é‚£ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨&lt;code&gt;Join&lt;/code&gt;,ä½†æ˜¯å¦‚æœæ²¡æœ‰ï¼Œå¹¶ä¸”è¿½æ±‚çµæ´»æ€§æ‹¼æ¥ï¼Œè¿˜æ˜¯é€‰æ‹©&lt;code&gt;Builder&lt;/code&gt;ã€‚ &lt;code&gt;Join&lt;/code&gt;è¿˜æ˜¯å®šä½äºæœ‰ç°æˆåˆ‡ç‰‡ã€æ•°ç»„çš„ï¼ˆæ¯•ç«Ÿæ‹¼æ¥æˆæ•°ç»„ä¹Ÿè¦æ—¶é—´ï¼‰ï¼Œå¹¶ä¸”ä½¿ç”¨å›ºå®šæ–¹å¼è¿›è¡Œåˆ†è§£çš„ï¼Œæ¯”å¦‚é€—å·ã€ç©ºæ ¼ç­‰ï¼Œå±€é™æ¯”è¾ƒå¤§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å°ç»“&#34;&gt;å°ç»“ &lt;a href=&#34;#%e5%b0%8f%e7%bb%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è‡³äº10000ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥æˆ‘è¿™é‡Œå°±ä¸åšæµ‹è¯•äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¯•è¯•ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å¤§åŒå°å¼‚çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»æœ€è¿‘çš„è¿™ä¸¤ç¯‡æ–‡ç« çš„åˆ†ææ¥çœ‹ï¼Œæˆ‘ä»¬å¤§æ¦‚å¯ä»¥æ€»ç»“å‡ºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;è¿æ¥é€‚ç”¨äºçŸ­å°çš„ã€å¸¸é‡å­—ç¬¦ä¸²ï¼ˆæ˜ç¡®çš„ï¼Œéå˜é‡ï¼‰ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬ä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Joinæ˜¯æ¯”è¾ƒç»Ÿä¸€çš„æ‹¼æ¥ï¼Œä¸å¤ªçµæ´»&lt;/li&gt;
&lt;li&gt;fmtå’ŒbufferåŸºæœ¬ä¸Šä¸æ¨è&lt;/li&gt;
&lt;li&gt;builderä»æ€§èƒ½å’Œçµæ´»æ€§ä¸Šï¼Œéƒ½æ˜¯ä¸Šä½³çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;builder-æ…¢åœ¨å“ª&#34;&gt;Builder æ…¢åœ¨å“ª &lt;a href=&#34;#builder-%e6%85%a2%e5%9c%a8%e5%93%aa&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨å‰é¢å¯ä»¥çœ‹å‡ºæ¥å°‘é‡æ‹¼æ¥ï¼Œ&lt;code&gt;builder&lt;/code&gt;å¹¶ä¸æ˜æ˜¾ï¼Œé‚£ä¹ˆåˆ°åº•æ…¢åœ¨å“ªé‡Œå‘¢ï¼Ÿæ—¢ç„¶è¦ä¼˜åŒ–Builderæ‹¼æ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬èµ·ç çŸ¥é“ä»–æ…¢åœ¨å“ªï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨æˆ‘ä»¬ä¸Šç¯‡æ–‡ç« çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿è¡Œçœ‹ä¸‹æ€§èƒ½ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Builder10-8     5000000     258 ns/op       480 B/op        4 allocs/op
Builder100-8    1000000     2012 ns/op      6752 B/op       8 allocs/op
Builder1000-8   100000      21016 ns/op     96224 B/op      16 allocs/op
Builder10000-8  10000       195098 ns/op    1120226 B/op    25 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é’ˆå¯¹æ—¢ç„¶è¦ä¼˜åŒ–&lt;code&gt;Builder&lt;/code&gt;æ‹¼æ¥,é‡‡å–äº†10ã€100ã€1000ã€10000å››ç§ä¸åŒæ•°é‡çš„å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥æµ‹è¯•ã€‚æˆ‘ä»¬å‘ç°æ¯æ¬¡æ“ä½œéƒ½æœ‰ä¸åŒæ¬¡æ•°çš„å†…å­˜åˆ†é…ï¼Œå†…å­˜åˆ†é…è¶Šå¤šï¼Œè¶Šæ…¢ï¼Œå¦‚æœå¼•èµ·GCï¼Œå°±æ›´æ…¢äº†ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆä¼˜åŒ–è¿™ä¸ªï¼Œå‡å°‘å†…å­˜åˆ†é…çš„æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å†…å­˜åˆ†é…ä¼˜åŒ–&#34;&gt;å†…å­˜åˆ†é…ä¼˜åŒ– &lt;a href=&#34;#%e5%86%85%e5%ad%98%e5%88%86%e9%85%8d%e4%bc%98%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é€šè¿‡cpuprofileï¼ŒæŸ¥çœ‹ç”Ÿæˆçš„ç«ç„°å›¾å¯ä»¥å¾—çŸ¥ï¼Œ&lt;code&gt;runtime.growslice&lt;/code&gt;å‡½æ•°ä¼šè¢«é¢‘ç¹çš„è°ƒç”¨ï¼Œå¹¶ä¸”æ—¶é—´å æ¯”ä¹Ÿæ¯”è¾ƒé•¿ã€‚æˆ‘ä»¬æŸ¥çœ‹&lt;code&gt;Builder.WriteString&lt;/code&gt;çš„æºä»£ç ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (b *Builder) WriteString(s string) (int, error) {
	b.copyCheck()
	b.buf = append(b.buf, s...)
	return len(s), nil
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥è‚¯å®šæ˜¯&lt;code&gt;append&lt;/code&gt;æ–¹æ³•è§¦å‘äº†&lt;code&gt;runtime.growslice&lt;/code&gt;ï¼Œå› ä¸º&lt;code&gt;b.buf&lt;/code&gt;çš„å®¹é‡&lt;code&gt;cap&lt;/code&gt;ä¸è¶³ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨&lt;code&gt;runtime.growslice&lt;/code&gt;æ‰©å……&lt;code&gt;b.buf&lt;/code&gt;çš„å®¹é‡ï¼Œç„¶åæ‰å¯ä»¥è¿½åŠ æ–°çš„å…ƒç´ &lt;code&gt;s...&lt;/code&gt;ã€‚æ‰©å®¹å®¹é‡è‡ªç„¶ä¼šæ¶‰åŠåˆ°å†…å­˜çš„åˆ†é…ï¼Œè€Œä¸”è¿½åŠ çš„å†…å®¹è¶Šå¤šï¼Œå†…å­˜åˆ†é…çš„æ¬¡æ•°è¶Šå¤šï¼Œè¿™å’Œæˆ‘ä»¬ä¸Šé¢æ€§èƒ½æµ‹è¯•çš„æ•°æ®æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶é—®é¢˜çš„åŸå› æ‰¾åˆ°äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¼˜åŒ–äº†ï¼Œæ ¸å¿ƒæ‰‹æ®µå°±æ˜¯å‡å°‘&lt;code&gt;runtime.growslice&lt;/code&gt;è°ƒç”¨ï¼Œç”šè‡³ä¸è°ƒç”¨ã€‚ç…§ç€è¿™ä¸ªæ€è·¯çš„è¯ï¼Œæˆ‘ä»¬å°±è¦æå‰ä¸º&lt;code&gt;b.buf&lt;/code&gt;åˆ†é…å¥½å®¹é‡&lt;code&gt;cap&lt;/code&gt;ã€‚å¹¸å¥½&lt;code&gt;Builder&lt;/code&gt;ä¸ºæˆ‘ä»¬æä¾›äº†æ‰©å……å®¹é‡çš„æ–¹æ³•&lt;code&gt;Grow&lt;/code&gt;ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œ&lt;code&gt;WriteString&lt;/code&gt;ä¹‹å‰ï¼Œå…ˆé€šè¿‡&lt;code&gt;Grow&lt;/code&gt;æ–¹æ³•ï¼Œæ‰©å……å¥½å®¹é‡å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¼€å§‹æ”¹é€ æˆ‘ä»¬çš„StringBuilderå‡½æ•°ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringBuilder(p []string,cap int) string {
	var b strings.Builder
	l:=len(p)
	b.Grow(cap)
	for i:=0;i&amp;lt;l;i++{
		b.WriteString(p[i])
	}
	return b.String()
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¢åŠ ä¸€ä¸ªå‚æ•°&lt;code&gt;cap&lt;/code&gt;ï¼Œè®©ä½¿ç”¨è€…å‘Šè¯‰æˆ‘ä»¬éœ€è¦çš„å®¹é‡å¤§å°ã€‚&lt;code&gt;Grow&lt;/code&gt;æ–¹æ³•çš„å®ç°éå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªé€šè¿‡&lt;code&gt;make&lt;/code&gt;å‡½æ•°ï¼Œæ‰©å……&lt;code&gt;b.buf&lt;/code&gt;å¤§å°ï¼Œç„¶åå†æ‹·è´&lt;code&gt;b.buf&lt;/code&gt;çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (b *Builder) grow(n int) {
	buf := make([]byte, len(b.buf), 2*cap(b.buf)+n)
	copy(buf, b.buf)
	b.buf = buf
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é‚£ä¹ˆç°åœ¨æˆ‘ä»¬çš„æ€§èƒ½æµ‹è¯•ç”¨ä¾‹å˜æˆå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func BenchmarkStringBuilder10(b *testing.B) {
	p:= initStrings(10)
	cap:=10*len(BLOG)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuilder(p,cap)
	}
}

func BenchmarkStringBuilder1000(b *testing.B) {
	p:= initStrings(1000)
	cap:=1000*len(BLOG)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuilder(p,cap)
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸ºäº†è¯´æ˜æƒ…å†µå’Œç®€çŸ­ä»£ç ï¼Œè¿™é‡Œåªæœ‰10å’Œ1000ä¸ªå…ƒç´ çš„ç”¨ä¾‹ï¼Œå…¶ä»–ç±»ä¼¼ã€‚ä¸ºäº†æŠŠæ€§èƒ½ä¼˜åŒ–åˆ°æè‡´ï¼Œæˆ‘ä¸€æ¬¡æ€§æŠŠéœ€è¦çš„å®¹é‡åˆ†é…è¶³å¤Ÿã€‚ç°åœ¨æˆ‘ä»¬å†è¿è¡Œæ€§èƒ½ï¼ˆBenchmarkï¼‰æµ‹è¯•ä»£ç ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Builder10-8     10000000    123 ns/op       352 B/op    1 allocs/op
Builder100-8    2000000     898 ns/op       2688 B/op   1 allocs/op
Builder1000-8   200000      7729 ns/op      24576 B/op  1 allocs/op
Builder10000-8  20000       78678 ns/op     237568 B/op 1 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ€§èƒ½è¶³è¶³ç¿»äº†1å€å¤šï¼Œåªæœ‰1æ¬¡å†…å­˜åˆ†é…ï¼Œæ¯æ¬¡æ“ä½œå ç”¨çš„å†…å­˜ä¹Ÿå‡å°‘äº†ä¸€åŠå¤šï¼Œé™ä½äº†GCã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“ &lt;a href=&#34;#%e6%80%bb%e7%bb%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;èƒŒåçš„åŸç†ä¹Ÿéå¸¸æ¸…æ¥šï¼Œå°±æ˜¯é¢„å…ˆåˆ†é…å†…å­˜ï¼Œå‡å°‘appendè¿‡ç¨‹ä¸­çš„å†…å­˜é‡æ–°åˆ†é…å’Œæ•°æ®æ‹·è´ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æå‡å¾ˆå¤šçš„æ€§èƒ½ã€‚æ‰€ä»¥å¯¹äºå¯ä»¥é¢„è§çš„é•¿åº¦çš„åˆ‡ï¼Œéƒ½å¯ä»¥æå‰ç”³è¯·ç”³è¯·å¥½å†…å­˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ”¶é›†æ¥æºï¼šhttps://www.flysnow.org&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Goçš„pprofä½¿ç”¨æŠ€å·§</title>
      <link>https://abnerxc.github.io/go/pprof/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/pprof/</guid>
      <description>&lt;h1 id=&#34;1å®‰è£…æ˜“ç”¨çš„pprof&#34;&gt;1.å®‰è£…æ˜“ç”¨çš„pprof &lt;a href=&#34;#1%e5%ae%89%e8%a3%85%e6%98%93%e7%94%a8%e7%9a%84pprof&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;golangè‡ªå¸¦çš„profåŒ…æ˜¯runtime/pprofï¼Œè¿™ä¸ªæ˜¯ä½çº§åˆ«çš„ï¼Œéœ€è¦ä½ æ‰‹åŠ¨åšä¸€äº›è®¾ç½®ç­‰ç­‰å‘¨è¾¹å·¥ä½œï¼Œä¸åˆ©äºæˆ‘ä»¬å¿«é€Ÿä¸Šæ‰‹ï¼Œåˆ©ç”¨pprofå¸®åŠ©æˆ‘ä»¬è§£å†³å®é™…çš„é—®é¢˜ã€‚è¿™é‡Œæ¨èdavecheneyå°è£…çš„pprofï¼Œå®ƒå¯ä»¥1è¡Œä»£ç ï¼Œè®©ä½ ç”¨ä¸Špprofï¼Œä¸“å¿ƒè§£å†³è‡ªå·±çš„ä»£ç é—®é¢˜ï¼Œä¸‹è½½ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go get github.com/pkg/profile
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;2å®‰è£…graphviz&#34;&gt;2.å®‰è£…graphviz &lt;a href=&#34;#2%e5%ae%89%e8%a3%85graphviz&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;pprofç”Ÿæˆçš„profæ–‡ä»¶æ—¶äºŒè¿›åˆ¶çš„ï¼Œéœ€è¦æŠŠè¿™ä¸ªäºŒè¿›åˆ¶çš„æ–‡ä»¶è½¬æ¢ä¸ºæˆ‘ä»¬äººç±»å¯è¯»çš„ï¼Œgraphvizå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠäºŒè¿›åˆ¶çš„profæ–‡ä»¶è½¬æ¢ä¸ºå›¾åƒã€‚Macå®‰è£…ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;brew install graphviz
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;3ä¿®æ”¹mainå‡½æ•°&#34;&gt;3.ä¿®æ”¹mainå‡½æ•° &lt;a href=&#34;#3%e4%bf%ae%e6%94%b9main%e5%87%bd%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åªéœ€è¦ä¸ºhi.goå¢åŠ è¿™ä¸€è¡Œï¼Œdefer profile.Start().Stop()ï¼Œç¨‹åºè¿è¡Œæ—¶ï¼Œé»˜è®¤å°±ä¼šè®°å½•cpuæ•°æ®&lt;/p&gt;
&lt;h1 id=&#34;4ç¼–è¯‘è¿è¡Œä½ çš„å‡½æ•°&#34;&gt;4.ç¼–è¯‘è¿è¡Œä½ çš„å‡½æ•° &lt;a href=&#34;#4%e7%bc%96%e8%af%91%e8%bf%90%e8%a1%8c%e4%bd%a0%e7%9a%84%e5%87%bd%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
	&amp;#34;fmt&amp;#34;
	&amp;#34;github.com/pkg/profile&amp;#34;
)

func main() {
	defer profile.Start().Stop()
	sl:=makeSlice()
	fmt.Printf(&amp;#34;sum=%d\n&amp;#34;,sumSlice(sl))
}

func makeSlice() []int {
	sl := make([]int, 10000000)
	for idx := range sl {
		sl[idx] = idx
	}
	return sl
}

func sumSlice(sl []int) int {
	sum := 0
	for _, x := range sl {
		sum += x
	}
	return sum
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿è¡Œä»£ç &lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go build hi.go
./hi
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åº”å½“çœ‹åˆ°ç±»ä¼¼çš„ç»“æœï¼Œå®ƒè¾“å‡ºäº†ç”Ÿæˆçš„cpu.pprofçš„è·¯å¾„ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2019/02/26 23:24:22 profile: cpu profiling enabled, /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile152894194/cpu.pprof  
sum=49999995000000  
2019/02/26 23:24:22 profile: cpu profiling disabled, /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile152894194/cpu.pprof  
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;5å¯è§†åŒ–prof&#34;&gt;5.å¯è§†åŒ–prof &lt;a href=&#34;#5%e5%8f%af%e8%a7%86%e5%8c%96prof&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¯è§†åŒ–æœ‰å¤šç§æ–¹å¼ï¼Œå¯ä»¥è½¬æ¢ä¸ºtextã€pdfã€svgç­‰ç­‰ã€‚textå‘½ä»¤æ˜¯&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go tool pprof --text /path/to/yourbinary /var/path/to/cpu.pprof
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go tool pprof --text ./hi /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile626723859/cpu.pprof
File: hi
Type: cpu
Time: Feb 26, 2019 at 11:29pm (CST)
Duration: 203.53ms, Total samples = 100ms (49.13%)
Showing nodes accounting for 100ms, 100% of 100ms total
      flat  flat%   sum%        cum   cum%
      60ms 60.00% 60.00%       60ms 60.00%  runtime.usleep
      30ms 30.00% 90.00%       30ms 30.00%  main.makeSlice
      10ms 10.00%   100%       10ms 10.00%  runtime.nanotime
         0     0%   100%       30ms 30.00%  main.main
         0     0%   100%       10ms 10.00%  runtime.gcBgMarkWorker
         0     0%   100%       70ms 70.00%  runtime.gcBgMarkWorker.func2
         0     0%   100%       70ms 70.00%  runtime.gcDrain
         0     0%   100%       30ms 30.00%  runtime.main
         0     0%   100%       70ms 70.00%  runtime.markroot
         0     0%   100%       70ms 70.00%  runtime.markroot.func1
         0     0%   100%       60ms 60.00%  runtime.mstart
         0     0%   100%       60ms 60.00%  runtime.osyield
         0     0%   100%       70ms 70.00%  runtime.scang
         0     0%   100%       70ms 70.00%  runtime.systemstack
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç”Ÿæˆpdfå›¾&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; go tool pprof --pdf ./hi /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile626723859/cpu.pprof &amp;gt; cpu.pdf
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;6è·å–å†…å­˜ppfo&#34;&gt;6.è·å–å†…å­˜ppfo &lt;a href=&#34;#6%e8%8e%b7%e5%8f%96%e5%86%85%e5%ad%98ppfo&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¦‚æœä½ æŒæ¡äº†cpu pprofï¼Œmem pprofè½»è€Œæ˜“ä¸¾å°±èƒ½æ‹¿ä¸‹ï¼Œåªéœ€è¦æ”¹1è¡Œä»£ç ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;defer profile.Start(profile.MemProfile).Stop()
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Goè¯­è¨€ç¼–ç¨‹æ¨¡å¼</title>
      <link>https://abnerxc.github.io/go/go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F/</guid>
      <description>&lt;h1 id=&#34;æ€§èƒ½æç¤º&#34;&gt;æ€§èƒ½æç¤º &lt;a href=&#34;#%e6%80%a7%e8%83%bd%e6%8f%90%e7%a4%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœéœ€è¦æŠŠæ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ strconv.Itoa() æ¯” fmt.Sprintf() è¦å¿«ä¸€å€å·¦å³ã€‚&lt;/li&gt;
&lt;li&gt;å°½å¯èƒ½é¿å…æŠŠStringè½¬æˆ[]Byte ï¼Œè¿™ä¸ªè½¬æ¢ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœåœ¨ for-loop é‡Œå¯¹æŸä¸ª Slice ä½¿ç”¨ append()ï¼Œè¯·å…ˆæŠŠ Slice çš„å®¹é‡æ‰©å……åˆ°ä½ï¼Œè¿™æ ·å¯ä»¥é¿å…å†…å­˜é‡æ–°åˆ†é…ä»¥åŠç³»ç»Ÿè‡ªåŠ¨æŒ‰ 2 çš„ N æ¬¡æ–¹å¹‚è¿›è¡Œæ‰©å±•ä½†åˆç”¨ä¸åˆ°çš„æƒ…å†µï¼Œä»è€Œé¿å…æµªè´¹å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨StringBuffer æˆ–æ˜¯StringBuild æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œæ€§èƒ½ä¼šæ¯”ä½¿ç”¨ + æˆ– +=é«˜ä¸‰åˆ°å››ä¸ªæ•°é‡çº§ã€‚&lt;/li&gt;
&lt;li&gt;å°½å¯èƒ½ä½¿ç”¨å¹¶å‘çš„ goroutineï¼Œç„¶åä½¿ç”¨ sync.WaitGroup æ¥åŒæ­¥åˆ†ç‰‡æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;é¿å…åœ¨çƒ­ä»£ç ä¸­è¿›è¡Œå†…å­˜åˆ†é…ï¼Œè¿™æ ·ä¼šå¯¼è‡´ gc å¾ˆå¿™ã€‚å°½å¯èƒ½ä½¿ç”¨ sync.Pool æ¥é‡ç”¨å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ lock-free çš„æ“ä½œï¼Œé¿å…ä½¿ç”¨ mutexï¼Œå°½å¯èƒ½ä½¿ç”¨ sync/AtomicåŒ…&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ I/O ç¼“å†²ï¼ŒI/O æ˜¯ä¸ªéå¸¸éå¸¸æ…¢çš„æ“ä½œï¼Œä½¿ç”¨ bufio.NewWrite() å’Œ bufio.NewReader() å¯ä»¥å¸¦æ¥æ›´é«˜çš„æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºåœ¨ for-loop é‡Œçš„å›ºå®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸€å®šè¦ä½¿ç”¨ regexp.Compile() ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ã€‚æ€§èƒ½ä¼šæå‡ä¸¤ä¸ªæ•°é‡çº§ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ éœ€è¦æ›´é«˜æ€§èƒ½çš„åè®®ï¼Œå°±è¦è€ƒè™‘ä½¿ç”¨ protobuf æˆ– msgp è€Œä¸æ˜¯ JSONï¼Œå› ä¸º JSON çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–é‡Œä½¿ç”¨äº†åå°„ã€‚&lt;/li&gt;
&lt;li&gt;ä½ åœ¨ä½¿ç”¨ Map çš„æ—¶å€™ï¼Œä½¿ç”¨æ•´å‹çš„ key ä¼šæ¯”å­—ç¬¦ä¸²çš„è¦å¿«ï¼Œå› ä¸ºæ•´å‹æ¯”è¾ƒæ¯”å­—ç¬¦ä¸²æ¯”è¾ƒè¦å¿«ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ¥å£ç¼–ç¨‹&#34;&gt;æ¥å£ç¼–ç¨‹ &lt;a href=&#34;#%e6%8e%a5%e5%8f%a3%e7%bc%96%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
type Country struct {
    Name string
}

type City struct {
    Name string
}

type Printable interface {
    PrintStr()
}
func (c Country) PrintStr() {
    fmt.Println(c.Name)
}
func (c City) PrintStr() {
    fmt.Println(c.Name)
}

c1 := Country {&amp;#34;China&amp;#34;}
c2 := City {&amp;#34;Beijing&amp;#34;}
c1.PrintStr()
c2.PrintStr()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ®µä»£ç ä¸­ä½¿ç”¨äº†ä¸€ä¸ª Printable çš„æ¥å£ï¼Œè€Œ Country å’Œ City éƒ½å®ç°äº†æ¥å£æ–¹æ³• PrintStr() æŠŠè‡ªå·±è¾“å‡ºã€‚ç„¶è€Œï¼Œè¿™äº›ä»£ç éƒ½æ˜¯ä¸€æ ·çš„ï¼Œèƒ½ä¸èƒ½çœæ‰å‘¢ï¼Ÿå…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œç»“æ„ä½“åµŒå…¥â€çš„æ–¹å¼æ¥å®Œæˆè¿™ä¸ªäº‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
type WithName struct {
    Name string
}

type Country struct {
    WithName
}

type City struct {
    WithName
}

type Printable interface {
    PrintStr()
}

func (w WithName) PrintStr() {
    fmt.Println(w.Name)
}

c1 := Country {WithName{ &amp;#34;China&amp;#34;}}
c2 := City { WithName{&amp;#34;Beijing&amp;#34;}}
c1.PrintStr()
c2.PrintStr()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¼•å…¥ä¸€ä¸ªå« WithNameçš„ç»“æ„ä½“ï¼Œä½†æ˜¯è¿™ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™å˜å¾—æœ‰ç‚¹ä¹±ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•å‘¢ï¼Ÿå†æ¥çœ‹å¦å¤–ä¸€ä¸ªè§£ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
type Country struct {
    Name string
}

type City struct {
    Name string
}

type Stringable interface {
    ToString() string
}
func (c Country) ToString() string {
    return &amp;#34;Country = &amp;#34; + c.Name
}
func (c City) ToString() string{
    return &amp;#34;City = &amp;#34; + c.Name
}

func PrintStr(p Stringable) {
    fmt.Println(p.ToString())
}

d1 := Country {&amp;#34;USA&amp;#34;}
d2 := City{&amp;#34;Los Angeles&amp;#34;}
PrintStr(d1)
PrintStr(d2)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå«Stringable çš„æ¥å£ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªæ¥å£æŠŠâ€œä¸šåŠ¡ç±»å‹â€ Country å’Œ City å’Œâ€œæ§åˆ¶é€»è¾‘â€ Print() ç»™è§£è€¦äº†ã€‚äºæ˜¯ï¼Œåªè¦å®ç°äº†Stringable æ¥å£ï¼Œéƒ½å¯ä»¥ä¼ ç»™ PrintStr() æ¥ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ¥å£å®Œæ•´æ€§æ£€æŸ¥&#34;&gt;æ¥å£å®Œæ•´æ€§æ£€æŸ¥ &lt;a href=&#34;#%e6%8e%a5%e5%8f%a3%e5%ae%8c%e6%95%b4%e6%80%a7%e6%a3%80%e6%9f%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
type Shape interface {
    Sides() int
    Area() int
}
type Square struct {
    len int
}
func (s* Square) Sides() int {
    return 4
}
func main() {
    s := Square{len: 5}
    fmt.Printf(&amp;#34;%d\n&amp;#34;,s.Sides())
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼ŒSquare å¹¶æ²¡æœ‰å®ç° Shape æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œç¨‹åºè™½ç„¶å¯ä»¥è·‘é€šï¼Œä½†æ˜¯è¿™æ ·çš„ç¼–ç¨‹æ–¹å¼å¹¶ä¸ä¸¥è°¨ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¼ºåˆ¶å®ç°æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var _ Shape = (*Square)(nil)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å£°æ˜ä¸€ä¸ª _ å˜é‡ï¼ˆæ²¡äººç”¨ï¼‰ä¼šæŠŠä¸€ä¸ª nil çš„ç©ºæŒ‡é’ˆä» Square è½¬æˆ Shapeï¼Œè¿™æ ·ï¼Œå¦‚æœæ²¡æœ‰å®ç°å®Œç›¸å…³çš„æ¥å£æ–¹æ³•ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;cannot use (*Square)(nil) (type *Square) as type Shape in assignment: *Square does not implement Shape (missing Area method)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;functional-options-ç¼–ç¨‹æ¨¡å¼&#34;&gt;Functional Options ç¼–ç¨‹æ¨¡å¼ &lt;a href=&#34;#functional-options-%e7%bc%96%e7%a8%8b%e6%a8%a1%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
	&amp;#34;crypto/tls&amp;#34;
	&amp;#34;fmt&amp;#34;
	&amp;#34;time&amp;#34;
)

type Option func(*Server)

type Server struct {
	Addr     string
	Port     int
	Protocol string
	Timeout  time.Duration
	MaxConns int
	TLS      *tls.Config
}

func Protocol(p string) Option {
	return func(s *Server) {
		s.Protocol = p
	}
}
func Timeout(timeout time.Duration) Option {
	return func(s *Server) {
		s.Timeout = timeout
	}
}
func MaxConns(maxconns int) Option {
	return func(s *Server) {
		s.MaxConns = maxconns
	}
}
func TLS(tls *tls.Config) Option {
	return func(s *Server) {
		s.TLS = tls
	}
}
func NewService(addr string, port int, options ...func(*Server)) (*Server, error) {
	srv := Server{
		Addr:     addr,
		Port:     port,
		Protocol: &amp;#34;tcp&amp;#34;,
		Timeout:  30 * time.Second,
		MaxConns: 1000,
		TLS:      nil,
	}
	for _, option := range options {
		option(&amp;amp;srv)
	} //...
	return &amp;amp;srv, nil
}

func main() {
	server, _ := NewService(&amp;#34;localhost&amp;#34;, 80, Protocol(&amp;#34;ftp&amp;#34;),Timeout(5*10))
	fmt.Println(server)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;mapreducefilter-æ¨¡å¼&#34;&gt;Map,Reduce,Filter æ¨¡å¼ &lt;a href=&#34;#mapreducefilter-%e6%a8%a1%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
type Employee struct {
    Name     string
    Age      int
    Vacation int
    Salary   int
}

var list = []Employee{
    {&amp;#34;Hao&amp;#34;, 44, 0, 8000},
    {&amp;#34;Bob&amp;#34;, 34, 10, 5000},
    {&amp;#34;Alice&amp;#34;, 23, 5, 9000},
    {&amp;#34;Jack&amp;#34;, 26, 0, 4000},
    {&amp;#34;Tom&amp;#34;, 48, 9, 7500},
    {&amp;#34;Marry&amp;#34;, 29, 0, 6000},
    {&amp;#34;Mike&amp;#34;, 32, 8, 4000},
}


func EmployeeCountIf(list []Employee, fn func(e *Employee) bool) int {
    count := 0
    for i, _ := range list {
        if fn(&amp;amp;list[i]) {
            count += 1
        }
    }
    return count
}

func EmployeeFilterIn(list []Employee, fn func(e *Employee) bool) []Employee {
    var newList []Employee
    for i, _ := range list {
        if fn(&amp;amp;list[i]) {
            newList = append(newList, list[i])
        }
    }
    return newList
}

func EmployeeSumIf(list []Employee, fn func(e *Employee) int) int {
    var sum = 0
    for i, _ := range list {
        sum += fn(&amp;amp;list[i])
    }
    return sum
}

//ç»Ÿè®¡æœ‰å¤šå°‘å‘˜å·¥å¤§äº 40 å²

old := EmployeeCountIf(list, func(e *Employee) bool {
    return e.Age &amp;gt; 40
})
fmt.Printf(&amp;#34;old people: %d\n&amp;#34;, old)
//old people: 2
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title></title>
      <link>https://abnerxc.github.io/go/base4.%E6%8E%A5%E5%8F%A3/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://abnerxc.github.io/go/base4.%E6%8E%A5%E5%8F%A3/</guid>
      <description>&lt;p&gt;title = &amp;lsquo;GoåŸºç¡€-æ¥å£&amp;rsquo;
date = 2019-01-15T18:35:11+08:00
draft = false
categories=[&amp;lsquo;Go&amp;rsquo;]&lt;/p&gt;
&lt;h1 id=&#34;ä»€ä¹ˆæ˜¯æ¥å£&#34;&gt;ä»€ä¹ˆæ˜¯æ¥å£ &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨ä¸€äº›é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä¾‹å¦‚ Javaã€PHP ç­‰ï¼Œæ¥å£å®šä¹‰äº†å¯¹è±¡çš„è¡Œä¸ºï¼ŒåªæŒ‡å®šäº†å¯¹è±¡åº”è¯¥åšä»€ä¹ˆã€‚è¡Œä¸ºçš„å…·ä½“å®ç°å–å†³äºå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Go è¯­è¨€ä¸­ï¼Œæ¥å£æ˜¯ä¸€ç»„æ–¹æ³•çš„é›†åˆï¼Œä½†ä¸åŒ…å«æ–¹æ³•çš„å®ç°ã€æ˜¯æŠ½è±¡çš„ï¼Œæ¥å£ä¸­ä¹Ÿä¸èƒ½åŒ…å«å˜é‡ã€‚å½“ä¸€ä¸ªç±»å‹ T æä¾›äº†æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•çš„å®šä¹‰æ—¶ï¼Œå°±è¯´ T å®ç°äº†æ¥å£ã€‚æ¥å£æŒ‡å®šç±»å‹åº”è¯¥æœ‰å“ªäº›æ–¹æ³•ï¼Œç±»å‹å†³å®šå¦‚ä½•å»å®ç°è¿™äº›æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ¥å£å£°æ˜&#34;&gt;æ¥å£å£°æ˜ &lt;a href=&#34;#%e6%8e%a5%e5%8f%a3%e5%a3%b0%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Shape interface {
    Area() float32
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç å®šä¹‰äº†æ¥å£ç±»å‹ Shapeï¼Œæ¥å£ä¸­åŒ…å«äº†ä¸€ä¸ªä¸å¸¦å‚æ•°ã€è¿”å›å€¼ä¸º float32  çš„æ–¹æ³• Area()ã€‚ä»»ä½•å®ç°äº†æ–¹æ³• Area() çš„ç±»å‹ Tï¼Œæˆ‘ä»¬å°±è¯´å®ƒå®ç°äº†æ¥å£ Shapeã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
    var s Shape
    fmt.Println(&amp;#34;value of s is&amp;#34;, s)
    fmt.Printf(&amp;#34;type of s is %T\n&amp;#34;, s)
}

//output
value of s is &amp;lt;nil&amp;gt;
type of s is &amp;lt;nil&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;æ¥å£çš„ç±»å‹å€¼&#34;&gt;æ¥å£çš„ç±»å‹å€¼ &lt;a href=&#34;#%e6%8e%a5%e5%8f%a3%e7%9a%84%e7%b1%bb%e5%9e%8b%e5%80%bc&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;é™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹&#34;&gt;é™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹ &lt;a href=&#34;#%e9%9d%99%e6%80%81%e7%b1%bb%e5%9e%8b%e5%92%8c%e5%8a%a8%e6%80%81%e7%b1%bb%e5%9e%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å˜é‡çš„ç±»å‹åœ¨å£°æ˜æ—¶æŒ‡å®šã€ä¸”ä¸èƒ½æ”¹å˜ï¼Œç§°ä¸º&lt;code&gt;é™æ€ç±»å‹&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¥å£ç±»å‹çš„é™æ€å€¼å°±æ˜¯æ¥å£æœ¬èº«ã€‚&lt;/li&gt;
&lt;li&gt;æ¥å£æ²¡æœ‰é™æ€å€¼ï¼Œå®ƒæŒ‡å‘çš„æ˜¯åŠ¨æ€å€¼ã€‚&lt;/li&gt;
&lt;li&gt;æ¥å£ç±»å‹çš„å˜é‡å­˜çš„æ˜¯å®ç°æ¥å£çš„ç±»å‹çš„å€¼ã€‚è¯¥å€¼å°±æ˜¯æ¥å£çš„åŠ¨æ€å€¼ï¼Œå®ç°æ¥å£çš„ç±»å‹å°±æ˜¯æ¥å£çš„åŠ¨æ€ç±»å‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Iname interface {
    Mname()
}

type St1 struct {}
func (St1) Mname() {}
type St2 struct {}
func (St2) Mname() {}

func main() {
    var i Iname = St1{}
    fmt.Printf(&amp;#34;type is %T\n&amp;#34;,i)
    fmt.Printf(&amp;#34;value is %v\n&amp;#34;,i)
    i = St2{}
    fmt.Printf(&amp;#34;type is %T\n&amp;#34;,i)
    fmt.Printf(&amp;#34;value is %v\n&amp;#34;,i)
}
//output 
type is main.St1
value is {}
type is main.St2
value is {}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å˜é‡&lt;code&gt;i&lt;/code&gt;çš„é™æ€ç±»å‹æ˜¯&lt;code&gt;Iname&lt;/code&gt;,æ˜¯ä¸èƒ½æ”¹å˜çš„ã€‚åŠ¨æ€ç±»å‹å´æ˜¯ä¸å›ºå®šçš„ã€‚ç¬¬ä¸€æ¬¡åˆ†é…æ˜¯ &lt;code&gt;St1&lt;/code&gt; ç¬¬äºŒæ¬¡æ˜¯&lt;code&gt;St2&lt;/code&gt;,åŠ¨æ€å€¼éƒ½æ˜¯&lt;code&gt;ç©ºç»“æ„ä½“&lt;/code&gt;
æœ‰æ—¶å€™ï¼Œæ¥å£çš„åŠ¨æ€ç±»å‹åˆç§°ä¸º&lt;code&gt;å…·ä½“ç±»å‹&lt;/code&gt;ï¼Œå½“è®¿é—®çš„æ—¶å€™ï¼Œè¿”å›çš„æ˜¯åº•å±‚çš„åŠ¨æ€å€¼ç±»å‹&lt;/p&gt;
&lt;h2 id=&#34;nilå€¼&#34;&gt;nilå€¼ &lt;a href=&#34;#nil%e5%80%bc&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Iname interface {
    Mname()
}
type St struct {}
func (St) Mname() {}
func main() {
    var t *St
    if t == nil {
        fmt.Println(&amp;#34;t is nil&amp;#34;)
    } else {
        fmt.Println(&amp;#34;t is not nil&amp;#34;)
    }
    var i Iname = t
    fmt.Printf(&amp;#34;%T\n&amp;#34;, i)
    if i == nil {
        fmt.Println(&amp;#34;i is nil&amp;#34;)
    } else {
        fmt.Println(&amp;#34;i is not nil&amp;#34;)
    }
    fmt.Printf(&amp;#34;i is nil pointer:%v&amp;#34;,i == (*St)(nil))
}
//output
t is nil
*main.St
i is not nil
i is nil pointer:true
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;å½“ä¸”ä»…å½“åŠ¨æ€å€¼å’ŒåŠ¨æ€ç±»å‹éƒ½ä¸º nil æ—¶ï¼Œæ¥å£ç±»å‹å€¼æ‰ä¸º nil&lt;/code&gt;ã€‚ä¸Šé¢çš„ä»£ç ï¼Œç»™å˜é‡ i  èµ‹å€¼ä¹‹åï¼Œi çš„åŠ¨æ€å€¼æ˜¯ nilï¼Œä½†æ˜¯åŠ¨æ€ç±»å‹å´æ˜¯ *Stï¼Œ i æ˜¯ä¸€ä¸ª nil æŒ‡é’ˆï¼Œæ‰€ä»¥æ¡ä»¶ä¸æˆç«‹ã€‚&lt;/p&gt;
&lt;p&gt;Goè¯­è¨€è§„èŒƒï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; var x interface{}  // x is nil and has static type interface{}
 var v *T           // v has value nil, static type *T
 x = 42             // x has value 42 and dynamic type int
 x = v              // x has value (*T)(nil) and dynamic type *T
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;å®ç°æ¥å£&#34;&gt;å®ç°æ¥å£ &lt;a href=&#34;#%e5%ae%9e%e7%8e%b0%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Shape interface {
    Area() float32
}

type Rect struct {
    width  float32
    height float32
}
//ç»“æ„ä½“å®ç°äº†æ¥å£
func (r Rect) Area() float32 {
    return r.width * r.height
}

func main() {
    var s Shape
    s = Rect{5.0, 4.0}
    r := Rect{5.0, 4.0}
    fmt.Printf(&amp;#34;type of s is %T\n&amp;#34;, s)
    fmt.Printf(&amp;#34;value of s is %v\n&amp;#34;, s)
    fmt.Println(&amp;#34;area of rectange s&amp;#34;, s.Area())
    fmt.Println(&amp;#34;s == r is&amp;#34;, s == r)
}
//output
type of s is main.Rect
value of s is {5 4}
area of rectange s 20
s == r is true
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ç©ºæ¥å£&#34;&gt;ç©ºæ¥å£ &lt;a href=&#34;#%e7%a9%ba%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Println(a ...interface{}) (n int, err error) {}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type MyString string
type Rect struct {
    width  float32
    height float32
}
func explain(i interface{}) {
    fmt.Printf(&amp;#34;type of s is %T\n&amp;#34;, i)
    fmt.Printf(&amp;#34;value of s is %v\n\n&amp;#34;, i)
}
func main() {
    ms := MyString(&amp;#34;Seekload&amp;#34;)
    r := Rect{5.0, 4.0}
    explain(ms)
    explain(r)
}
//output
type of s is main.MyString
value of s is Seekload

type of s is main.Rect
value of s is {5 4}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç ï¼Œåˆ›å»ºäº†è‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ç±»å‹ MyString ã€ç»“æ„ä½“ Rect å’Œ explain() å‡½æ•°ã€‚explain() å‡½æ•°çš„å½¢å‚æ˜¯ç©ºæ¥å£ï¼Œæ‰€ä»¥å¯ä»¥æ¥æ”¶ä»»æ„ç±»å‹çš„å€¼ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å®ç°å¤šä¸ªæ¥å£&#34;&gt;å®ç°å¤šä¸ªæ¥å£ &lt;a href=&#34;#%e5%ae%9e%e7%8e%b0%e5%a4%9a%e4%b8%aa%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Shape interface {
	Area() float32
}
 
type Object interface {
	Perimeter() float32
}

type Circle struct {
	radius float32
}

func (c Circle) Area() float32 {
    return math.Pi * (c.radius * c.radius)
}

func (c Circle) Perimeter() float32 {
   return 2 * math.Pi * c.radius
}

func main() {
    c := Circle{3}
    var s Shape = c
    var p Object = c
    fmt.Println(&amp;#34;area: &amp;#34;, s.Area())
    fmt.Println(&amp;#34;perimeter: &amp;#34;, p.Perimeter())
}
//output
area:  28.274334
perimeter:  18.849556
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœä¿®æ”¹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;fmt.Println(&amp;#34;area: &amp;#34;, p.Area())
fmt.Println(&amp;#34;perimeter: &amp;#34;, s.Perimeter())
//output
p.Area undefined (type Object has no field or method Area)
s.Perimeter undefined (type Shape has no field or method Perimeter)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å› ä¸º s çš„é™æ€ç±»å‹æ˜¯ Shapeï¼Œè€Œ p çš„é™æ€ç±»å‹æ˜¯ Objectï¼Œæ­¤é—®é¢˜å¯ä»¥ä½¿ç”¨&lt;code&gt;ç±»å‹æ–­è¨€&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç±»å‹æ–­è¨€&#34;&gt;ç±»å‹æ–­è¨€ &lt;a href=&#34;#%e7%b1%bb%e5%9e%8b%e6%96%ad%e8%a8%80&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ç±»å‹æ–­è¨€å¯ä»¥ç”¨æ¥è·å–æ¥å£çš„åº•å±‚å€¼ï¼Œé€šå¸¸çš„è¯­æ³•ï¼š&lt;code&gt;i.(Type)&lt;/code&gt;ï¼Œå…¶ä¸­ i æ˜¯æ¥å£ï¼ŒType æ˜¯ç±»å‹æˆ–æ¥å£ã€‚ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹ i çš„åŠ¨æ€ç±»å‹ä¸ Type æ˜¯å¦ä¸€è‡´ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Shape interface {
	Area() float32
}
 
type Object interface {
	Perimeter() float32
}

type Circle struct {
	radius float32
}

func (c Circle) Area() float32 {
    return math.Pi * (c.radius * c.radius)
}

func (c Circle) Perimeter() float32 {
   return 2 * math.Pi * c.radius
}

func main() {
    var s Shape = Circle{3}
    c := s.(Circle)
    var p Object = c
    fmt.Printf(&amp;#34;%T\n&amp;#34;,c)
    fmt.Printf(&amp;#34;%v\n&amp;#34;,c)
    fmt.Println(&amp;#34;area: &amp;#34;, c.Area())
    fmt.Println(&amp;#34;perimeter: &amp;#34;, c.Perimeter())
}
//output
main.Circle
{3}
area:  28.274334
perimeter:  18.849556
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ c è®¿é—®æ¥å£ s çš„åº•å±‚å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ c åˆ†åˆ«è°ƒç”¨æ–¹æ³• Area() å’Œ Perimeter()ï¼Œè¿™å°±è§£å†³äº†ä¸Šé¢é‡åˆ°çš„é—®é¢˜ã€‚
&lt;code&gt;åœ¨è¯­æ³• i.(Type) ä¸­ï¼Œå¦‚æœ Type æ²¡æœ‰å®ç° i æ‰€å±çš„æ¥å£ï¼Œç¼–è¯‘çš„æ—¶å€™ä¼šæŠ¥é”™ï¼›æˆ–è€… i çš„åŠ¨æ€å€¼ä¸æ˜¯ Typeï¼Œåˆ™ä¼šæŠ¥ panic é”™è¯¯&lt;/code&gt;ã€‚æ€ä¹ˆè§£å†³å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•:&lt;code&gt;value, ok := i.(Type)&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç±»å‹é€‰æ‹©&#34;&gt;ç±»å‹é€‰æ‹© &lt;a href=&#34;#%e7%b1%bb%e5%9e%8b%e9%80%89%e6%8b%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func switchType(i interface{}) {
     switch i.(type) {
     case string:
         fmt.Printf(&amp;#34;string and value is %s\n&amp;#34;, i.(string))
     case int:
         fmt.Printf(&amp;#34;int and value is %d\n&amp;#34;, i.(int))
     default:
         fmt.Printf(&amp;#34;Unknown type\n&amp;#34;)
     }
}
func main() {
    switchType(&amp;#34;Seekload&amp;#34;)
    switchType(27)
    switchType(true)
}
//output
string and value is Seekload
int and value is 27
Unknown type
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;æ³¨æ„ï¼šåªæœ‰æ¥å£ç±»å‹æ‰å¯ä»¥è¿›è¡Œç±»å‹é€‰æ‹©&lt;/code&gt;ã€‚å…¶ä»–ç±»å‹ï¼Œä¾‹å¦‚ intã€stringç­‰æ˜¯ä¸èƒ½&lt;/p&gt;
&lt;h1 id=&#34;æ¥å£åµŒå¥—&#34;&gt;æ¥å£åµŒå¥— &lt;a href=&#34;#%e6%8e%a5%e5%8f%a3%e5%b5%8c%e5%a5%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Go è¯­è¨€ä¸­ï¼Œæ¥å£ä¸èƒ½å»å®ç°åˆ«çš„æ¥å£ä¹Ÿä¸èƒ½ç»§æ‰¿ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åµŒå¥—æ¥å£åˆ›å»ºæ–°æ¥å£&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Math interface {
	Shape
	Object
}
type Shape interface {
	Area() float32
}

type Object interface {
	Perimeter() float32
}

type Circle struct {
	radius float32
}

func (c Circle) Area() float32 {
	return math.Pi * (c.radius * c.radius)
}

func (c Circle) Perimeter() float32 {
	return 2 * math.Pi * c.radius
}

func main() {
    c := Circle{3}
    var m Math = c
    fmt.Printf(&amp;#34;%T\n&amp;#34;, m )
    fmt.Println(&amp;#34;area: &amp;#34;, m.Area())
    fmt.Println(&amp;#34;perimeter: &amp;#34;, m.Perimeter())
}
//output
main.Circle
area:  28.274334
perimeter:  18.849556
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç ï¼Œé€šè¿‡åµŒå¥—æ¥å£ Shape å’Œ Objectï¼Œåˆ›å»ºäº†æ–°çš„æ¥å£ Mathã€‚ä»»ä½•ç±»å‹å¦‚æœå®ç°äº†æ¥å£ Shape å’Œ Object å®šä¹‰çš„æ–¹æ³•ï¼Œåˆ™è¯´ç±»å‹ä¹Ÿå®ç°äº†æ¥å£ Mathï¼Œä¾‹å¦‚æˆ‘ä»¬åˆ›å»ºçš„ç»“æ„ä½“ Circleã€‚
ä¸»å‡½æ•°é‡Œé¢ï¼Œå®šä¹‰äº†æ¥å£ç±»å‹çš„å˜é‡ mï¼ŒåŠ¨æ€ç±»å‹æ˜¯ç»“æ„ä½“ Circleï¼Œæ³¨æ„ä¸‹æ–¹æ³• Area å’Œ  Perimeter çš„è°ƒç”¨æ–¹å¼ï¼Œç±»ä¼¼ä¸è®¿é—®åµŒå¥—ç»“æ„ä½“çš„æˆå‘˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…å’Œå€¼æ¥æ”¶è€…å®ç°æ¥å£&#34;&gt;ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…å’Œå€¼æ¥æ”¶è€…å®ç°æ¥å£ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e6%8c%87%e9%92%88%e6%8e%a5%e6%94%b6%e8%80%85%e5%92%8c%e5%80%bc%e6%8e%a5%e6%94%b6%e8%80%85%e5%ae%9e%e7%8e%b0%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Shape interface {
	Area() float32
}
type Circle struct {
	radius float32
}
type Square struct {
	side float32
}
func (c Circle) Area() float32 {
	return math.Pi * (c.radius * c.radius)
}

func (s *Square) Area() float32 {
	return s.side*s.side
}
func main() {
    var s Shape
    c1 := Circle{3}
    s = c1
    fmt.Printf(&amp;#34;%v\n&amp;#34;,s.Area())

    c2 := Circle{4}
    s = &amp;amp;c2
    fmt.Printf(&amp;#34;%v\n&amp;#34;,s.Area())

    c3 := Square{3}
    //s = c3
    s = &amp;amp;c3
    fmt.Printf(&amp;#34;%v\n&amp;#34;,s.Area())
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç ï¼Œç»“æ„ä½“ Circle é€šè¿‡å€¼æ¥æ”¶è€…å®ç°äº†æ¥å£ Shapeã€‚å€¼æ¥æ”¶è€…çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨å€¼æˆ–è€…æŒ‡é’ˆè°ƒç”¨ï¼Œæ‰€ä»¥ä¸Šé¢çš„ c1 å’Œ c2 çš„è°ƒç”¨æ–¹å¼æ˜¯åˆæ³•çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç»“æ„ä½“ Square é€šè¿‡æŒ‡é’ˆæ¥æ”¶è€…å®ç°äº†æ¥å£ Shapeã€‚å¦‚æœå°†ä¸Šæ–¹æ³¨é‡Šéƒ¨åˆ†æ‰“å¼€çš„è¯ï¼Œç¼–è¯‘å°±ä¼šå‡ºé”™ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cannot use c3 (type Square) as type Shape in assignment:
Square does not implement Shape (Area method has pointer receiver)
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
  </channel>
</rss>
