<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Goes on Abnerçš„åšå®¢</title>
    <link>https://abnerxc.github.io/go/</link>
    <description>Recent content in Goes on Abnerçš„åšå®¢</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Sat, 21 Sep 2024 10:46:12 +0800</lastBuildDate><atom:link href="https://abnerxc.github.io/go/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Goä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨æ€»ç»“</title>
      <link>https://abnerxc.github.io/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/</link>
      <pubDate>Sat, 21 Sep 2024 10:46:12 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;åŸæ–‡ï¼šhttps://www.yuque.com/aceld/golang/zhzanb&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;è§†é¢‘é“¾æ¥åœ°å€ï¼šhttps://www.bilibili.com/video/BV1wz4y1y7Kd&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åƒåœ¾å›æ”¶(Garbage Collectionï¼Œç®€ç§°GC)æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­æä¾›çš„è‡ªåŠ¨çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œè‡ªåŠ¨é‡Šæ”¾ä¸éœ€è¦çš„å†…å­˜å¯¹è±¡ï¼Œè®©å‡ºå­˜å‚¨å™¨èµ„æºã€‚GCè¿‡ç¨‹ä¸­æ— éœ€ç¨‹åºå‘˜æ‰‹åŠ¨æ‰§è¡Œã€‚GCæœºåˆ¶åœ¨ç°ä»£å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒï¼ŒGCèƒ½åŠ›çš„æ€§èƒ½ä¸ä¼˜åŠ£ä¹Ÿæ˜¯ä¸åŒè¯­è¨€ä¹‹é—´å¯¹æ¯”åº¦æŒ‡æ ‡ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Go V1.3ä¹‹å‰çš„æ ‡è®°-æ¸…æ‰«(mark and sweep)&lt;/li&gt;
&lt;li&gt;Go V1.5çš„ä¸‰è‰²å¹¶å‘æ ‡è®°æ³•&lt;/li&gt;
&lt;li&gt;Go V1.5çš„ä¸‰è‰²æ ‡è®°ä¸ºä»€ä¹ˆéœ€è¦STW&lt;/li&gt;
&lt;li&gt;Go V1.5çš„ä¸‰è‰²æ ‡è®°ä¸ºä»€ä¹ˆéœ€è¦å±éšœæœºåˆ¶(â€œå¼º-å¼±â€ ä¸‰è‰²ä¸å˜å¼ã€æ’å…¥å±éšœã€åˆ é™¤å±éšœ )&lt;/li&gt;
&lt;li&gt;Go V1.8æ··åˆå†™å±éšœæœºåˆ¶&lt;/li&gt;
&lt;li&gt;Go V1.8æ··åˆå†™å±éšœæœºåˆ¶çš„å…¨åœºæ™¯åˆ†æ&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¸€go-v13ä¹‹å‰çš„æ ‡è®°-æ¸…é™¤mark-and-sweepç®—æ³•&#34;&gt;ä¸€ã€Go V1.3ä¹‹å‰çš„æ ‡è®°-æ¸…é™¤(mark and sweep)ç®—æ³• &lt;a href=&#34;#%e4%b8%80go-v13%e4%b9%8b%e5%89%8d%e7%9a%84%e6%a0%87%e8%ae%b0-%e6%b8%85%e9%99%a4mark-and-sweep%e7%ae%97%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;æ ‡è®°-æ¸…é™¤mark-and-sweepçš„åŸç†&#34;&gt;æ ‡è®°-æ¸…é™¤(mark and sweep)çš„åŸç† &lt;a href=&#34;#%e6%a0%87%e8%ae%b0-%e6%b8%85%e9%99%a4mark-and-sweep%e7%9a%84%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æ­¤ç®—æ³•ä¸»è¦æœ‰ä¸¤ä¸ªä¸»è¦çš„æ­¥éª¤ï¼š&lt;code&gt;æ ‡è®°(Mark phase)&lt;/code&gt;å’Œ&lt;code&gt;æ¸…é™¤(Sweep phase)&lt;/code&gt;
&lt;strong&gt;ç¬¬ä¸€æ­¥&lt;/strong&gt;ï¼Œæš‚åœç¨‹åºä¸šåŠ¡é€»è¾‘, åˆ†ç±»å‡ºå¯è¾¾å’Œä¸å¯è¾¾çš„å¯¹è±¡ï¼Œç„¶ååšä¸Šæ ‡è®°ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC1.png&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸­è¡¨ç¤ºæ˜¯ç¨‹åºä¸å¯¹è±¡çš„å¯è¾¾å…³ç³»ï¼Œç›®å‰ç¨‹åºçš„å¯è¾¾å¯¹è±¡æœ‰å¯¹è±¡1-2-3ï¼Œå¯¹è±¡4-7ç­‰äº”ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒæ­¥&lt;/strong&gt;, å¼€å§‹æ ‡è®°ï¼Œç¨‹åºæ‰¾å‡ºå®ƒæ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ï¼Œå¹¶åšä¸Šæ ‡è®°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC2.png&#34; alt=&#34;gc&#34;&gt;
æ‰€ä»¥å¯¹è±¡1-2-3ã€å¯¹è±¡4-7ç­‰äº”ä¸ªå¯¹è±¡è¢«åšä¸Šæ ‡è®°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸‰æ­¥&lt;/strong&gt;,  æ ‡è®°å®Œäº†ä¹‹åï¼Œç„¶åå¼€å§‹æ¸…é™¤æœªæ ‡è®°çš„å¯¹è±¡. ç»“æœå¦‚ä¸‹ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC3.png&#34; alt=&#34;gc&#34;&gt;
æ“ä½œéå¸¸ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦é¢å¤–æ³¨æ„ï¼šmark and sweepç®—æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œéœ€è¦ç¨‹åºæš‚åœï¼å³ STW(stop the world)ï¼ŒSTWçš„è¿‡ç¨‹ä¸­ï¼ŒCPUä¸æ‰§è¡Œç”¨æˆ·ä»£ç ï¼Œå…¨éƒ¨ç”¨äºåƒåœ¾å›æ”¶ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„å½±å“å¾ˆå¤§ï¼Œæ‰€ä»¥STWä¹Ÿæ˜¯ä¸€äº›å›æ”¶æœºåˆ¶æœ€å¤§çš„éš¾é¢˜å’Œå¸Œæœ›ä¼˜åŒ–çš„ç‚¹ã€‚æ‰€ä»¥åœ¨æ‰§è¡Œç¬¬ä¸‰æ­¥çš„è¿™æ®µæ—¶é—´ï¼Œç¨‹åºä¼šæš‚å®šåœæ­¢ä»»ä½•å·¥ä½œï¼Œå¡åœ¨é‚£ç­‰å¾…å›æ”¶æ‰§è¡Œå®Œæ¯•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬å››æ­¥&lt;/strong&gt;, åœæ­¢æš‚åœï¼Œè®©ç¨‹åºç»§ç»­è·‘ã€‚ç„¶åå¾ªç¯é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°processç¨‹åºç”Ÿå‘½å‘¨æœŸç»“æŸã€‚&lt;/p&gt;
&lt;h1 id=&#34;äºŒæ ‡è®°-æ¸…é™¤mark-and-sweepçš„ç¼ºç‚¹&#34;&gt;äºŒã€æ ‡è®°-æ¸…é™¤(mark and sweep)çš„ç¼ºç‚¹ &lt;a href=&#34;#%e4%ba%8c%e6%a0%87%e8%ae%b0-%e6%b8%85%e9%99%a4mark-and-sweep%e7%9a%84%e7%bc%ba%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æ ‡è®°æ¸…é™¤ç®—æ³•æ˜äº†ï¼Œè¿‡ç¨‹é²œæ˜å¹²è„†ï¼Œä½†æ˜¯ä¹Ÿæœ‰éå¸¸ä¸¥é‡çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;STWï¼Œstop the worldï¼›è®©ç¨‹åºæš‚åœï¼Œç¨‹åºå‡ºç°å¡é¡¿ &lt;code&gt;(é‡è¦é—®é¢˜)&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æ ‡è®°éœ€è¦æ‰«ææ•´ä¸ªheapï¼›&lt;/li&gt;
&lt;li&gt;æ¸…é™¤æ•°æ®ä¼šäº§ç”Ÿheapç¢ç‰‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Go V1.3ç‰ˆæœ¬ä¹‹å‰å°±æ˜¯ä»¥ä¸Šæ¥å®æ–½çš„,  åœ¨æ‰§è¡ŒGCçš„åŸºæœ¬æµç¨‹å°±æ˜¯é¦–å…ˆå¯åŠ¨STWæš‚åœï¼Œç„¶åæ‰§è¡Œæ ‡è®°ï¼Œå†æ‰§è¡Œæ•°æ®å›æ”¶ï¼Œæœ€ååœæ­¢STWï¼Œå¦‚å›¾æ‰€ç¤ºã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-STW1.png&#34; alt=&#34;gc&#34;&gt;
ä»ä¸Šå›¾æ¥çœ‹ï¼Œå…¨éƒ¨çš„GCæ—¶é—´éƒ½æ˜¯åŒ…è£¹åœ¨STWèŒƒå›´ä¹‹å†…çš„ï¼Œè¿™æ ·è²Œä¼¼ç¨‹åºæš‚åœçš„æ—¶é—´è¿‡é•¿ï¼Œå½±å“ç¨‹åºçš„è¿è¡Œæ€§èƒ½ã€‚æ‰€ä»¥Go V1.3 åšäº†ç®€å•çš„ä¼˜åŒ–,å°†STWçš„æ­¥éª¤æå‰, å‡å°‘STWæš‚åœçš„æ—¶é—´èŒƒå›´.å¦‚ä¸‹æ‰€ç¤º
&lt;img src=&#34;https://abnerxc.github.io/img/go-STW2.png&#34; alt=&#34;gc&#34;&gt;
ä¸Šå›¾ä¸»è¦æ˜¯å°†STWçš„æ­¥éª¤æå‰äº†ä¸€æ­¥ï¼Œå› ä¸ºåœ¨Sweepæ¸…é™¤çš„æ—¶å€™ï¼Œå¯ä»¥ä¸éœ€è¦STWåœæ­¢ï¼Œå› ä¸ºè¿™äº›å¯¹è±¡å·²ç»æ˜¯ä¸å¯è¾¾å¯¹è±¡äº†ï¼Œä¸ä¼šå‡ºç°å›æ”¶å†™å†²çªç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æ— è®ºæ€ä¹ˆä¼˜åŒ–ï¼ŒGo V1.3éƒ½é¢ä¸´è¿™ä¸ªä¸€ä¸ªé‡è¦é—®é¢˜ï¼Œå°±æ˜¯mark-and-sweep ç®—æ³•ä¼šæš‚åœæ•´ä¸ªç¨‹åº ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸‰go-v15çš„ä¸‰è‰²å¹¶å‘æ ‡è®°æ³•&#34;&gt;ä¸‰ã€Go V1.5çš„ä¸‰è‰²å¹¶å‘æ ‡è®°æ³• &lt;a href=&#34;#%e4%b8%89go-v15%e7%9a%84%e4%b8%89%e8%89%b2%e5%b9%b6%e5%8f%91%e6%a0%87%e8%ae%b0%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Golangä¸­çš„åƒåœ¾å›æ”¶ä¸»è¦åº”ç”¨ä¸‰è‰²æ ‡è®°æ³•ï¼ŒGCè¿‡ç¨‹å’Œå…¶ä»–ç”¨æˆ·goroutineå¯å¹¶å‘è¿è¡Œï¼Œä½†éœ€è¦ä¸€å®šæ—¶é—´çš„&lt;strong&gt;STW(stop the world)&lt;/strong&gt;ï¼Œæ‰€è°“&lt;strong&gt;ä¸‰è‰²æ ‡è®°æ³•&lt;/strong&gt;å®é™…ä¸Šå°±æ˜¯é€šè¿‡ä¸‰ä¸ªé˜¶æ®µçš„æ ‡è®°æ¥ç¡®å®šæ¸…æ¥šçš„å¯¹è±¡éƒ½æœ‰å“ªäº›ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„è¿‡ç¨‹ã€‚
&lt;strong&gt;ç¬¬ä¸€æ­¥&lt;/strong&gt; , æ¯æ¬¡æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œé»˜è®¤çš„é¢œè‰²éƒ½æ˜¯æ ‡è®°ä¸ºâ€œç™½è‰²â€ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC4.png&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„ç¨‹åºå¯æŠµè¾¾çš„å†…å­˜å¯¹è±¡å…³ç³»å¦‚å·¦å›¾æ‰€ç¤ºï¼Œå³è¾¹çš„æ ‡è®°è¡¨ï¼Œæ˜¯ç”¨æ¥è®°å½•ç›®å‰æ¯ä¸ªå¯¹è±¡çš„æ ‡è®°é¢œè‰²åˆ†ç±»ã€‚è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰€è°“â€œç¨‹åºâ€ï¼Œåˆ™æ˜¯ä¸€äº›å¯¹è±¡çš„æ ¹èŠ‚ç‚¹é›†åˆã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚æœå°†â€œç¨‹åºâ€å±•å¼€ï¼Œä¼šå¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¡¨ç°å½¢å¼ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC5.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒæ­¥&lt;/strong&gt;, æ¯æ¬¡GCå›æ”¶å¼€å§‹, ä¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†æ‰€æœ‰å¯¹è±¡ï¼ŒæŠŠéå†åˆ°çš„å¯¹è±¡ä»ç™½è‰²é›†åˆæ”¾å…¥â€œç°è‰²â€é›†åˆå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC6.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œ è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬æ¬¡éå†æ˜¯ä¸€æ¬¡éå†ï¼Œéé€’å½’å½¢å¼ï¼Œæ˜¯ä»ç¨‹åºæŠ½æ¬¡å¯æŠµè¾¾çš„å¯¹è±¡éå†ä¸€å±‚ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“å‰å¯æŠµè¾¾çš„å¯¹è±¡æ˜¯å¯¹è±¡1å’Œå¯¹è±¡4ï¼Œé‚£ä¹ˆè‡ªç„¶æœ¬è½®éå†ç»“æŸï¼Œå¯¹è±¡1å’Œå¯¹è±¡4å°±ä¼šè¢«æ ‡è®°ä¸ºç°è‰²ï¼Œç°è‰²æ ‡è®°è¡¨å°±ä¼šå¤šå‡ºè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸‰æ­¥&lt;/strong&gt;, éå†ç°è‰²é›†åˆï¼Œå°†ç°è‰²å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ä»ç™½è‰²é›†åˆæ”¾å…¥ç°è‰²é›†åˆï¼Œä¹‹åå°†æ­¤ç°è‰²å¯¹è±¡æ”¾å…¥é»‘è‰²é›†åˆï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC7.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ¬¡éå†æ˜¯åªæ‰«æç°è‰²å¯¹è±¡ï¼Œå°†ç°è‰²å¯¹è±¡çš„ç¬¬ä¸€å±‚éå†å¯æŠµè¾¾çš„å¯¹è±¡ç”±ç™½è‰²å˜ä¸ºç°è‰²ï¼Œå¦‚ï¼šå¯¹è±¡2ã€å¯¹è±¡7. è€Œä¹‹å‰çš„ç°è‰²å¯¹è±¡1å’Œå¯¹è±¡4åˆ™ä¼šè¢«æ ‡è®°ä¸ºé»‘è‰²ï¼ŒåŒæ—¶ç”±ç°è‰²æ ‡è®°è¡¨ç§»åŠ¨åˆ°é»‘è‰²æ ‡è®°è¡¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬å››æ­¥&lt;/strong&gt;, é‡å¤ç¬¬ä¸‰æ­¥, ç›´åˆ°ç°è‰²ä¸­æ— ä»»ä½•å¯¹è±¡ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC8.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC9.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬å…¨éƒ¨çš„å¯è¾¾å¯¹è±¡éƒ½éå†å®Œåï¼Œç°è‰²æ ‡è®°è¡¨å°†ä¸å†å­˜åœ¨ç°è‰²å¯¹è±¡ï¼Œç›®å‰å…¨éƒ¨å†…å­˜çš„æ•°æ®åªæœ‰ä¸¤ç§é¢œè‰²ï¼Œé»‘è‰²å’Œç™½è‰²ã€‚é‚£ä¹ˆé»‘è‰²å¯¹è±¡å°±æ˜¯æˆ‘ä»¬ç¨‹åºé€»è¾‘å¯è¾¾ï¼ˆéœ€è¦çš„ï¼‰å¯¹è±¡ï¼Œè¿™äº›æ•°æ®æ˜¯ç›®å‰æ”¯æ’‘ç¨‹åºæ­£å¸¸ä¸šåŠ¡è¿è¡Œçš„ï¼Œæ˜¯åˆæ³•çš„æœ‰ç”¨æ•°æ®ï¼Œä¸å¯åˆ é™¤ï¼Œç™½è‰²çš„å¯¹è±¡æ˜¯å…¨éƒ¨ä¸å¯è¾¾å¯¹è±¡ï¼Œç›®å‰ç¨‹åºé€»è¾‘å¹¶ä¸ä¾èµ–ä»–ä»¬ï¼Œé‚£ä¹ˆç™½è‰²å¯¹è±¡å°±æ˜¯å†…å­˜ä¸­ç›®å‰çš„åƒåœ¾æ•°æ®ï¼Œéœ€è¦è¢«æ¸…é™¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äº”æ­¥&lt;/strong&gt;: å›æ”¶æ‰€æœ‰çš„ç™½è‰²æ ‡è®°è¡¨çš„å¯¹è±¡. ä¹Ÿå°±æ˜¯å›æ”¶åƒåœ¾ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚
ä»¥ä¸Šæˆ‘ä»¬å°†å…¨éƒ¨çš„ç™½è‰²å¯¹è±¡è¿›è¡Œåˆ é™¤å›æ”¶ï¼Œ
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC10.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;å‰©ä¸‹çš„å°±æ˜¯å…¨éƒ¨ä¾èµ–çš„é»‘è‰²å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šä¾¿æ˜¯&lt;code&gt;ä¸‰è‰²å¹¶å‘æ ‡è®°æ³•&lt;/code&gt;ï¼Œä¸éš¾çœ‹å‡ºï¼Œæˆ‘ä»¬ä¸Šé¢å·²ç»æ¸…æ¥šçš„ä½“ç°&lt;code&gt;ä¸‰è‰²&lt;/code&gt;çš„ç‰¹æ€§ã€‚ä½†æ˜¯è¿™é‡Œé¢å¯èƒ½ä¼šæœ‰å¾ˆå¤šå¹¶å‘æµç¨‹å‡ä¼šè¢«æ‰«æï¼Œæ‰§è¡Œå¹¶å‘æµç¨‹çš„å†…å­˜å¯èƒ½ç›¸äº’ä¾èµ–ï¼Œä¸ºäº†åœ¨GCè¿‡ç¨‹ä¸­ä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œæˆ‘ä»¬åœ¨å¼€å§‹ä¸‰è‰²æ ‡è®°ä¹‹å‰å°±ä¼šåŠ ä¸ŠSTWï¼Œåœ¨æ‰«æç¡®å®šé»‘ç™½å¯¹è±¡ä¹‹åå†æ”¾å¼€STWã€‚ä½†æ˜¯å¾ˆæ˜æ˜¾è¿™æ ·çš„GCæ‰«æçš„æ€§èƒ½å®åœ¨æ˜¯å¤ªä½äº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å››æ²¡æœ‰stwçš„ä¸‰è‰²æ ‡è®°æ³•&#34;&gt;å››ã€æ²¡æœ‰STWçš„ä¸‰è‰²æ ‡è®°æ³• &lt;a href=&#34;#%e5%9b%9b%e6%b2%a1%e6%9c%89stw%e7%9a%84%e4%b8%89%e8%89%b2%e6%a0%87%e8%ae%b0%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å…ˆæŠ›ç –å¼•ç‰ï¼Œæˆ‘ä»¬åŠ å…¥å¦‚æœæ²¡æœ‰STWï¼Œé‚£ä¹ˆä¹Ÿå°±ä¸ä¼šå†å­˜åœ¨æ€§èƒ½ä¸Šçš„é—®é¢˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å‡è®¾å¦‚æœä¸‰è‰²æ ‡è®°æ³•ä¸åŠ å…¥STWä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ
æˆ‘ä»¬è¿˜æ˜¯åŸºäºä¸Šè¿°çš„ä¸‰è‰²å¹¶å‘æ ‡è®°æ³•æ¥è¯´, ä»–æ˜¯ä¸€å®šè¦ä¾èµ–STWçš„. å› ä¸ºå¦‚æœä¸æš‚åœç¨‹åº, ç¨‹åºçš„é€»è¾‘æ”¹å˜å¯¹è±¡å¼•ç”¨å…³ç³», è¿™ç§åŠ¨ä½œå¦‚æœåœ¨æ ‡è®°é˜¶æ®µåšäº†ä¿®æ”¹ï¼Œä¼šå½±å“æ ‡è®°ç»“æœçš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªåœºæ™¯ï¼Œå¦‚æœä¸‰è‰²æ ‡è®°æ³•, æ ‡è®°è¿‡ç¨‹ä¸ä½¿ç”¨STWå°†ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…?&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æŠŠåˆå§‹çŠ¶æ€è®¾ç½®ä¸ºå·²ç»ç»å†äº†ç¬¬ä¸€è½®æ‰«æï¼Œç›®å‰é»‘è‰²çš„æœ‰å¯¹è±¡1å’Œå¯¹è±¡4ï¼Œ ç°è‰²çš„æœ‰å¯¹è±¡2å’Œå¯¹è±¡7ï¼Œå…¶ä»–çš„ä¸ºç™½è‰²å¯¹è±¡ï¼Œä¸”å¯¹è±¡2æ˜¯é€šè¿‡æŒ‡é’ˆpæŒ‡å‘å¯¹è±¡3çš„ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC11.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¦‚æœä¸‰è‰²æ ‡è®°è¿‡ç¨‹ä¸å¯åŠ¨STWï¼Œé‚£ä¹ˆåœ¨GCæ‰«æè¿‡ç¨‹ä¸­ï¼Œä»»æ„çš„å¯¹è±¡å‡å¯èƒ½å‘ç”Ÿè¯»å†™æ“ä½œï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨è¿˜æ²¡æœ‰æ‰«æåˆ°å¯¹è±¡2çš„æ—¶å€™ï¼Œå·²ç»æ ‡è®°ä¸ºé»‘è‰²çš„å¯¹è±¡4ï¼Œæ­¤æ—¶åˆ›å»ºæŒ‡é’ˆqï¼Œå¹¶ä¸”æŒ‡å‘ç™½è‰²çš„å¯¹è±¡3ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC12.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸æ­¤åŒæ—¶ç°è‰²çš„å¯¹è±¡2å°†æŒ‡é’ˆpç§»é™¤ï¼Œé‚£ä¹ˆç™½è‰²çš„å¯¹è±¡3å®åˆ™å°±æ˜¯è¢«æŒ‚åœ¨äº†å·²ç»æ‰«æå®Œæˆçš„é»‘è‰²çš„å¯¹è±¡4ä¸‹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC13.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åæˆ‘ä»¬æ­£å¸¸æŒ‡å‘ä¸‰è‰²æ ‡è®°çš„ç®—æ³•é€»è¾‘ï¼Œå°†æ‰€æœ‰ç°è‰²çš„å¯¹è±¡æ ‡è®°ä¸ºé»‘è‰²ï¼Œé‚£ä¹ˆå¯¹è±¡2å’Œå¯¹è±¡7å°±è¢«æ ‡è®°æˆäº†é»‘è‰²ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC14.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå°±æ‰§è¡Œäº†ä¸‰è‰²æ ‡è®°çš„æœ€åä¸€æ­¥ï¼Œå°†æ‰€æœ‰ç™½è‰²å¯¹è±¡å½“åšåƒåœ¾è¿›è¡Œå›æ”¶ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC15.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æœ€åæˆ‘ä»¬æ‰å‘ç°ï¼Œæœ¬æ¥æ˜¯å¯¹è±¡4åˆæ³•å¼•ç”¨çš„å¯¹è±¡3ï¼Œå´è¢«GCç»™â€œè¯¯æ€â€å›æ”¶æ‰äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼Œåœ¨ä¸‰è‰²æ ‡è®°æ³•ä¸­ï¼Œæ˜¯ä¸å¸Œæœ›è¢«å‘ç”Ÿçš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¡ä»¶1: ä¸€ä¸ªç™½è‰²å¯¹è±¡è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨&lt;code&gt;(ç™½è‰²è¢«æŒ‚åœ¨é»‘è‰²ä¸‹)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ¡ä»¶2: ç°è‰²å¯¹è±¡ä¸å®ƒä¹‹é—´çš„å¯è¾¾å…³ç³»çš„ç™½è‰²å¯¹è±¡é­åˆ°ç ´å&lt;code&gt;(ç°è‰²åŒæ—¶ä¸¢äº†è¯¥ç™½è‰²)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœå½“ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼Œå°±ä¼šå‡ºç°å¯¹è±¡ä¸¢å¤±ç°è±¡!&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”ï¼Œå¦‚å›¾æ‰€ç¤ºçš„åœºæ™¯ä¸­ï¼Œå¦‚æœç¤ºä¾‹ä¸­çš„ç™½è‰²å¯¹è±¡3è¿˜æœ‰å¾ˆå¤šä¸‹æ¸¸å¯¹è±¡çš„è¯, ä¹Ÿä¼šä¸€å¹¶éƒ½æ¸…ç†æ‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢è¿™ç§ç°è±¡çš„å‘ç”Ÿï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯STWï¼Œç›´æ¥ç¦æ­¢æ‰å…¶ä»–ç”¨æˆ·ç¨‹åºå¯¹å¯¹è±¡å¼•ç”¨å…³ç³»çš„å¹²æ‰°ï¼Œä½†æ˜¯STWçš„è¿‡ç¨‹æœ‰æ˜æ˜¾çš„èµ„æºæµªè´¹ï¼Œå¯¹æ‰€æœ‰çš„ç”¨æˆ·ç¨‹åºéƒ½æœ‰å¾ˆå¤§å½±å“ã€‚é‚£ä¹ˆæ˜¯å¦å¯ä»¥åœ¨ä¿è¯å¯¹è±¡ä¸ä¸¢å¤±çš„æƒ…å†µä¸‹åˆç†çš„å°½å¯èƒ½çš„æé«˜GCæ•ˆç‡ï¼Œå‡å°‘STWæ—¶é—´å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬åªè¦ä½¿ç”¨ä¸€ç§æœºåˆ¶ï¼Œå°è¯•å»ç ´åä¸Šé¢çš„ä¸¤ä¸ªå¿…è¦æ¡ä»¶å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;äº”å±éšœæœºåˆ¶&#34;&gt;äº”ã€å±éšœæœºåˆ¶ &lt;a href=&#34;#%e4%ba%94%e5%b1%8f%e9%9a%9c%e6%9c%ba%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å¼º-å¼±-ä¸‰è‰²ä¸å˜å¼&#34;&gt;â€œå¼º-å¼±â€ ä¸‰è‰²ä¸å˜å¼ &lt;a href=&#34;#%e5%bc%ba-%e5%bc%b1-%e4%b8%89%e8%89%b2%e4%b8%8d%e5%8f%98%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;å¼ºä¸‰è‰²ä¸å˜å¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸å­˜åœ¨é»‘è‰²å¯¹è±¡å¼•ç”¨åˆ°ç™½è‰²å¯¹è±¡çš„æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC16.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¼ºä¸‰è‰²ä¸å˜è‰²å®é™…ä¸Šæ˜¯å¼ºåˆ¶æ€§çš„ä¸å…è®¸é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°æœ‰ç™½è‰²å¯¹è±¡è¢«è¯¯åˆ çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¼±ä¸‰è‰²ä¸å˜å¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨çš„ç™½è‰²å¯¹è±¡éƒ½å¤„äºç°è‰²ä¿æŠ¤çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC17.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¼±ä¸‰è‰²ä¸å˜å¼å¼ºè°ƒï¼Œé»‘è‰²å¯¹è±¡å¯ä»¥å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªç™½è‰²å¯¹è±¡å¿…é¡»å­˜åœ¨å…¶ä»–ç°è‰²å¯¹è±¡å¯¹å®ƒçš„å¼•ç”¨ï¼Œæˆ–è€…å¯è¾¾å®ƒçš„é“¾è·¯ä¸Šæ¸¸å­˜åœ¨ç°è‰²å¯¹è±¡ã€‚ è¿™æ ·å®åˆ™æ˜¯é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼Œç™½è‰²å¯¹è±¡å¤„äºä¸€ä¸ªå±é™©è¢«åˆ é™¤çš„çŠ¶æ€ï¼Œä½†æ˜¯ä¸Šæ¸¸ç°è‰²å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥ä¿æŠ¤è¯¥ç™½è‰²å¯¹è±¡ï¼Œä½¿å…¶å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†éµå¾ªä¸Šè¿°çš„ä¸¤ä¸ªæ–¹å¼ï¼ŒGCç®—æ³•æ¼”è¿›åˆ°ä¸¤ç§å±éšœæ–¹å¼ï¼Œä»–ä»¬â€œæ’å…¥å±éšœâ€, â€œåˆ é™¤å±éšœâ€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ’å…¥å±éšœ&#34;&gt;æ’å…¥å±éšœ &lt;a href=&#34;#%e6%8f%92%e5%85%a5%e5%b1%8f%e9%9a%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å…·ä½“æ“ä½œ: åœ¨Aå¯¹è±¡å¼•ç”¨Bå¯¹è±¡çš„æ—¶å€™ï¼ŒBå¯¹è±¡è¢«æ ‡è®°ä¸ºç°è‰²ã€‚(å°†BæŒ‚åœ¨Aä¸‹æ¸¸ï¼ŒBå¿…é¡»è¢«æ ‡è®°ä¸ºç°è‰²)
æ»¡è¶³: &lt;code&gt;å¼ºä¸‰è‰²ä¸å˜å¼&lt;/code&gt;. (ä¸å­˜åœ¨é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡çš„æƒ…å†µäº†ï¼Œ å› ä¸ºç™½è‰²ä¼šå¼ºåˆ¶å˜æˆç°è‰²)
ä¼ªç :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(å½“å‰ä¸‹æ¸¸å¯¹è±¡slot, æ–°ä¸‹æ¸¸å¯¹è±¡ptr) {   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  //1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  æ ‡è®°ç°è‰²(æ–°ä¸‹æ¸¸å¯¹è±¡ptr)   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  //2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  å½“å‰ä¸‹æ¸¸å¯¹è±¡slot = æ–°ä¸‹æ¸¸å¯¹è±¡ptr  				  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœºæ™¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(nil, B)   //A ä¹‹å‰æ²¡æœ‰ä¸‹æ¸¸ï¼Œ æ–°æ·»åŠ ä¸€ä¸ªä¸‹æ¸¸å¯¹è±¡Bï¼Œ Bè¢«æ ‡è®°ä¸ºç°è‰²
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(C, B)     //A å°†ä¸‹æ¸¸å¯¹è±¡C æ›´æ¢ä¸ºBï¼Œ  Bè¢«æ ‡è®°ä¸ºç°è‰²
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ®µä¼ªç é€»è¾‘å°±æ˜¯å†™å±éšœ,. æˆ‘ä»¬çŸ¥é“,é»‘è‰²å¯¹è±¡çš„å†…å­˜æ§½æœ‰ä¸¤ç§ä½ç½®, æ ˆå’Œå †. æ ˆç©ºé—´çš„ç‰¹ç‚¹æ˜¯å®¹é‡å°,ä½†æ˜¯è¦æ±‚ç›¸åº”é€Ÿåº¦å¿«,å› ä¸ºå‡½æ•°è°ƒç”¨å¼¹å‡ºé¢‘ç¹ä½¿ç”¨, æ‰€ä»¥â€œæ’å…¥å±éšœâ€æœºåˆ¶,åœ¨æ ˆç©ºé—´çš„å¯¹è±¡æ“ä½œä¸­ä¸ä½¿ç”¨. è€Œä»…ä»…ä½¿ç”¨åœ¨å †ç©ºé—´å¯¹è±¡çš„æ“ä½œä¸­.&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨å‡ å¼ å›¾ï¼Œæ¥æ¨¡æ‹Ÿæ•´ä¸ªä¸€ä¸ªè¯¦ç»†çš„è¿‡ç¨‹ï¼Œ å¸Œæœ›æ‚¨èƒ½å¤Ÿæ›´å¯è§‚çš„çœ‹æ¸…æ™°æ•´ä½“æµç¨‹ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-2.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-3.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-4.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-5.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-6.jpeg&#34; alt=&#34;gc&#34;&gt;
ä½†æ˜¯å¦‚æœæ ˆä¸æ·»åŠ ,å½“å…¨éƒ¨ä¸‰è‰²æ ‡è®°æ‰«æä¹‹å,æ ˆä¸Šæœ‰å¯èƒ½ä¾ç„¶å­˜åœ¨ç™½è‰²å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µ(å¦‚ä¸Šå›¾çš„å¯¹è±¡9).  æ‰€ä»¥è¦å¯¹æ ˆé‡æ–°è¿›è¡Œä¸‰è‰²æ ‡è®°æ‰«æ, ä½†è¿™æ¬¡ä¸ºäº†å¯¹è±¡ä¸ä¸¢å¤±, è¦å¯¹æœ¬æ¬¡æ ‡è®°æ‰«æå¯åŠ¨STWæš‚åœ. ç›´åˆ°æ ˆç©ºé—´çš„ä¸‰è‰²æ ‡è®°ç»“æŸ.
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-7.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-8.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-9.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;æœ€åå°†æ ˆå’Œå †ç©ºé—´ æ‰«æå‰©ä½™çš„å…¨éƒ¨ ç™½è‰²èŠ‚ç‚¹æ¸…é™¤.  è¿™æ¬¡STWå¤§çº¦çš„æ—¶é—´åœ¨10~100msé—´.
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC18-10.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;åˆ é™¤å±éšœ&#34;&gt;åˆ é™¤å±éšœ &lt;a href=&#34;#%e5%88%a0%e9%99%a4%e5%b1%8f%e9%9a%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å…·ä½“æ“ä½œ: è¢«åˆ é™¤çš„å¯¹è±¡ï¼Œå¦‚æœè‡ªèº«ä¸ºç°è‰²æˆ–è€…ç™½è‰²ï¼Œé‚£ä¹ˆè¢«æ ‡è®°ä¸ºç°è‰²ã€‚
æ»¡è¶³: &lt;code&gt;å¼±ä¸‰è‰²ä¸å˜å¼&lt;/code&gt;. (ä¿æŠ¤ç°è‰²å¯¹è±¡åˆ°ç™½è‰²å¯¹è±¡çš„è·¯å¾„ä¸ä¼šæ–­)
ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(å½“å‰ä¸‹æ¸¸å¯¹è±¡slotï¼Œ æ–°ä¸‹æ¸¸å¯¹è±¡ptr) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  //1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  if (å½“å‰ä¸‹æ¸¸å¯¹è±¡slotæ˜¯ç°è‰² || å½“å‰ä¸‹æ¸¸å¯¹è±¡slotæ˜¯ç™½è‰²) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  		æ ‡è®°ç°è‰²(å½“å‰ä¸‹æ¸¸å¯¹è±¡slot)     //slotä¸ºè¢«åˆ é™¤å¯¹è±¡ï¼Œ æ ‡è®°ä¸ºç°è‰²
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  //2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  å½“å‰ä¸‹æ¸¸å¯¹è±¡slot = æ–°ä¸‹æ¸¸å¯¹è±¡ptr
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœºæ™¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(B, nil)   //Aå¯¹è±¡ï¼Œåˆ é™¤Bå¯¹è±¡çš„å¼•ç”¨ã€‚  Bè¢«Aåˆ é™¤ï¼Œè¢«æ ‡è®°ä¸ºç°(å¦‚æœBä¹‹å‰ä¸ºç™½)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A.æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(B, C)		 //Aå¯¹è±¡ï¼Œæ›´æ¢ä¸‹æ¸¸Bå˜æˆCã€‚   Bè¢«Aåˆ é™¤ï¼Œè¢«æ ‡è®°ä¸ºç°(å¦‚æœBä¹‹å‰ä¸ºç™½)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨å‡ å¼ å›¾ï¼Œæ¥æ¨¡æ‹Ÿæ•´ä¸ªä¸€ä¸ªè¯¦ç»†çš„è¿‡ç¨‹ï¼Œ å¸Œæœ›æ‚¨èƒ½å¤Ÿæ›´å¯è§‚çš„çœ‹æ¸…æ™°æ•´ä½“æµç¨‹ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-2.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-3.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-4.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-5.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-6.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC19-7.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼çš„å›æ”¶ç²¾åº¦ä½ï¼Œä¸€ä¸ªå¯¹è±¡å³ä½¿è¢«åˆ é™¤äº†æœ€åä¸€ä¸ªæŒ‡å‘å®ƒçš„æŒ‡é’ˆä¹Ÿä¾æ—§å¯ä»¥æ´»è¿‡è¿™ä¸€è½®ï¼Œåœ¨ä¸‹ä¸€è½®GCä¸­è¢«æ¸…ç†æ‰ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…­go-v18çš„æ··åˆå†™å±éšœhybrid-write-barrieræœºåˆ¶&#34;&gt;å…­ã€Go V1.8çš„æ··åˆå†™å±éšœ(hybrid write barrier)æœºåˆ¶ &lt;a href=&#34;#%e5%85%adgo-v18%e7%9a%84%e6%b7%b7%e5%90%88%e5%86%99%e5%b1%8f%e9%9a%9chybrid-write-barrier%e6%9c%ba%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æ’å…¥å†™å±éšœå’Œåˆ é™¤å†™å±éšœçš„çŸ­æ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ’å…¥å†™å±éšœï¼šç»“æŸæ—¶éœ€è¦STWæ¥é‡æ–°æ‰«ææ ˆï¼Œæ ‡è®°æ ˆä¸Šå¼•ç”¨çš„ç™½è‰²å¯¹è±¡çš„å­˜æ´»ï¼›&lt;/li&gt;
&lt;li&gt;åˆ é™¤å†™å±éšœï¼šå›æ”¶ç²¾åº¦ä½ï¼ŒGCå¼€å§‹æ—¶STWæ‰«æå †æ ˆæ¥è®°å½•åˆå§‹å¿«ç…§ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šä¿æŠ¤å¼€å§‹æ—¶åˆ»çš„æ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Go V1.8ç‰ˆæœ¬å¼•å…¥äº†æ··åˆå†™å±éšœæœºåˆ¶ï¼ˆhybrid write barrierï¼‰ï¼Œé¿å…äº†å¯¹æ ˆre-scançš„è¿‡ç¨‹ï¼Œæå¤§çš„å‡å°‘äº†STWçš„æ—¶é—´ã€‚ç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ··åˆå†™å±éšœè§„åˆ™&#34;&gt;æ··åˆå†™å±éšœè§„åˆ™ &lt;a href=&#34;#%e6%b7%b7%e5%90%88%e5%86%99%e5%b1%8f%e9%9a%9c%e8%a7%84%e5%88%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å…·ä½“æ“ä½œ:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;1.  GCå¼€å§‹å°†æ ˆä¸Šçš„å¯¹è±¡å…¨éƒ¨æ‰«æå¹¶æ ‡è®°ä¸ºé»‘è‰²(ä¹‹åä¸å†è¿›è¡Œç¬¬äºŒæ¬¡é‡å¤æ‰«æï¼Œæ— éœ€STW)ï¼Œ
2.  GCæœŸé—´ï¼Œä»»ä½•åœ¨æ ˆä¸Šåˆ›å»ºçš„æ–°å¯¹è±¡ï¼Œå‡ä¸ºé»‘è‰²ã€‚
3.  è¢«åˆ é™¤çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ã€‚
4.  è¢«æ·»åŠ çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ»¡è¶³: å˜å½¢çš„&lt;code&gt;å¼±ä¸‰è‰²ä¸å˜å¼&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ·»åŠ ä¸‹æ¸¸å¯¹è±¡(å½“å‰ä¸‹æ¸¸å¯¹è±¡slot, æ–°ä¸‹æ¸¸å¯¹è±¡ptr) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	//1 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		æ ‡è®°ç°è‰²(å½“å‰ä¸‹æ¸¸å¯¹è±¡slot)    //åªè¦å½“å‰ä¸‹æ¸¸å¯¹è±¡è¢«ç§»èµ°ï¼Œå°±æ ‡è®°ç°è‰²
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	//2 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	æ ‡è®°ç°è‰²(æ–°ä¸‹æ¸¸å¯¹è±¡ptr)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  		
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	//3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	å½“å‰ä¸‹æ¸¸å¯¹è±¡slot = æ–°ä¸‹æ¸¸å¯¹è±¡ptr
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬æ³¨æ„ï¼Œ å±éšœæŠ€æœ¯æ˜¯ä¸åœ¨æ ˆä¸Šåº”ç”¨çš„ï¼Œå› ä¸ºè¦ä¿è¯æ ˆçš„è¿è¡Œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;æ··åˆå†™å±éšœçš„å…·ä½“åœºæ™¯åˆ†æ&#34;&gt;æ··åˆå†™å±éšœçš„å…·ä½“åœºæ™¯åˆ†æ &lt;a href=&#34;#%e6%b7%b7%e5%90%88%e5%86%99%e5%b1%8f%e9%9a%9c%e7%9a%84%e5%85%b7%e4%bd%93%e5%9c%ba%e6%99%af%e5%88%86%e6%9e%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨å‡ å¼ å›¾ï¼Œæ¥æ¨¡æ‹Ÿæ•´ä¸ªä¸€ä¸ªè¯¦ç»†çš„è¿‡ç¨‹ï¼Œ å¸Œæœ›æ‚¨èƒ½å¤Ÿæ›´å¯è§‚çš„çœ‹æ¸…æ™°æ•´ä½“æµç¨‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„æ··åˆå†™å±éšœæ˜¯Gcçš„ä¸€ç§å±éšœæœºåˆ¶ï¼Œæ‰€ä»¥åªæ˜¯å½“ç¨‹åºæ‰§è¡ŒGCçš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘è¿™ç§æœºåˆ¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;GCå¼€å§‹ï¼šæ‰«ææ ˆåŒºï¼Œå°†å¯è¾¾å¯¹è±¡å…¨éƒ¨æ ‡è®°ä¸ºé»‘
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC20-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC20-2.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åœºæ™¯ä¸€-å¯¹è±¡è¢«ä¸€ä¸ªå †å¯¹è±¡åˆ é™¤å¼•ç”¨æˆä¸ºæ ˆå¯¹è±¡çš„ä¸‹æ¸¸&#34;&gt;åœºæ™¯ä¸€ï¼š å¯¹è±¡è¢«ä¸€ä¸ªå †å¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæˆä¸ºæ ˆå¯¹è±¡çš„ä¸‹æ¸¸ &lt;a href=&#34;#%e5%9c%ba%e6%99%af%e4%b8%80-%e5%af%b9%e8%b1%a1%e8%a2%ab%e4%b8%80%e4%b8%aa%e5%a0%86%e5%af%b9%e8%b1%a1%e5%88%a0%e9%99%a4%e5%bc%95%e7%94%a8%e6%88%90%e4%b8%ba%e6%a0%88%e5%af%b9%e8%b1%a1%e7%9a%84%e4%b8%8b%e6%b8%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//å‰æï¼šå †å¯¹è±¡4-&amp;gt;å¯¹è±¡7 = å¯¹è±¡7ï¼›  //å¯¹è±¡7 è¢« å¯¹è±¡4å¼•ç”¨
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ ˆå¯¹è±¡1-&amp;gt;å¯¹è±¡7 = å †å¯¹è±¡7ï¼›  //å°†å †å¯¹è±¡7 æŒ‚åœ¨ æ ˆå¯¹è±¡1 ä¸‹æ¸¸
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å †å¯¹è±¡4-&amp;gt;å¯¹è±¡7 = nullï¼›    //å¯¹è±¡4 åˆ é™¤å¼•ç”¨ å¯¹è±¡7
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC21-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC21-2.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åœºæ™¯äºŒ-å¯¹è±¡è¢«ä¸€ä¸ªæ ˆå¯¹è±¡åˆ é™¤å¼•ç”¨æˆä¸ºå¦ä¸€ä¸ªæ ˆå¯¹è±¡çš„ä¸‹æ¸¸&#34;&gt;åœºæ™¯äºŒï¼š å¯¹è±¡è¢«ä¸€ä¸ªæ ˆå¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæˆä¸ºå¦ä¸€ä¸ªæ ˆå¯¹è±¡çš„ä¸‹æ¸¸ &lt;a href=&#34;#%e5%9c%ba%e6%99%af%e4%ba%8c-%e5%af%b9%e8%b1%a1%e8%a2%ab%e4%b8%80%e4%b8%aa%e6%a0%88%e5%af%b9%e8%b1%a1%e5%88%a0%e9%99%a4%e5%bc%95%e7%94%a8%e6%88%90%e4%b8%ba%e5%8f%a6%e4%b8%80%e4%b8%aa%e6%a0%88%e5%af%b9%e8%b1%a1%e7%9a%84%e4%b8%8b%e6%b8%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;new æ ˆå¯¹è±¡9ï¼›
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å¯¹è±¡8-&amp;gt;å¯¹è±¡3 = å¯¹è±¡9ï¼›      //å°†æ ˆå¯¹è±¡3 æŒ‚åœ¨ æ ˆå¯¹è±¡9 ä¸‹æ¸¸
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å¯¹è±¡2-&amp;gt;å¯¹è±¡3 = nullï¼›      //å¯¹è±¡2 åˆ é™¤å¼•ç”¨ å¯¹è±¡3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC22-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC22-2.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC22-3.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åœºæ™¯ä¸‰å¯¹è±¡è¢«ä¸€ä¸ªå †å¯¹è±¡åˆ é™¤å¼•ç”¨æˆä¸ºå¦ä¸€ä¸ªå †å¯¹è±¡çš„ä¸‹æ¸¸&#34;&gt;åœºæ™¯ä¸‰ï¼šå¯¹è±¡è¢«ä¸€ä¸ªå †å¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæˆä¸ºå¦ä¸€ä¸ªå †å¯¹è±¡çš„ä¸‹æ¸¸ &lt;a href=&#34;#%e5%9c%ba%e6%99%af%e4%b8%89%e5%af%b9%e8%b1%a1%e8%a2%ab%e4%b8%80%e4%b8%aa%e5%a0%86%e5%af%b9%e8%b1%a1%e5%88%a0%e9%99%a4%e5%bc%95%e7%94%a8%e6%88%90%e4%b8%ba%e5%8f%a6%e4%b8%80%e4%b8%aa%e5%a0%86%e5%af%b9%e8%b1%a1%e7%9a%84%e4%b8%8b%e6%b8%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å †å¯¹è±¡10-&amp;gt;å¯¹è±¡7 = å †å¯¹è±¡7ï¼›       //å°†å †å¯¹è±¡7 æŒ‚åœ¨ å †å¯¹è±¡10 ä¸‹æ¸¸
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å †å¯¹è±¡4-&amp;gt;å¯¹è±¡7 = nullï¼›         //å¯¹è±¡4 åˆ é™¤å¼•ç”¨ å¯¹è±¡7
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC23-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC23-2.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC23-3.jpeg&#34; alt=&#34;gc&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åœºæ™¯å››å¯¹è±¡ä»ä¸€ä¸ªæ ˆå¯¹è±¡åˆ é™¤å¼•ç”¨æˆä¸ºå¦ä¸€ä¸ªå †å¯¹è±¡çš„ä¸‹æ¸¸&#34;&gt;åœºæ™¯å››ï¼šå¯¹è±¡ä»ä¸€ä¸ªæ ˆå¯¹è±¡åˆ é™¤å¼•ç”¨ï¼Œæˆä¸ºå¦ä¸€ä¸ªå †å¯¹è±¡çš„ä¸‹æ¸¸ &lt;a href=&#34;#%e5%9c%ba%e6%99%af%e5%9b%9b%e5%af%b9%e8%b1%a1%e4%bb%8e%e4%b8%80%e4%b8%aa%e6%a0%88%e5%af%b9%e8%b1%a1%e5%88%a0%e9%99%a4%e5%bc%95%e7%94%a8%e6%88%90%e4%b8%ba%e5%8f%a6%e4%b8%80%e4%b8%aa%e5%a0%86%e5%af%b9%e8%b1%a1%e7%9a%84%e4%b8%8b%e6%b8%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä¼ªä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ ˆå¯¹è±¡1-&amp;gt;å¯¹è±¡2=null //å¯¹è±¡1åˆ é™¤å¼•ç”¨å¯¹è±¡2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å †å¯¹è±¡4-&amp;gt;å¯¹è±¡2=æ ˆå¯¹è±¡2 //å¯¹è±¡4æ·»åŠ ä¸‹æ¸¸æ ˆå¯¹è±¡2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å †å¯¹è±¡4-&amp;gt;å¯¹è±¡7=null //å¯¹è±¡4åˆ é™¤å¼•ç”¨å¯¹è±¡7
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-GC24-1.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC24-2.jpeg&#34; alt=&#34;gc&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/go-GC24-3.jpeg&#34; alt=&#34;gc&#34;&gt;
Golangä¸­çš„æ··åˆå†™å±éšœæ»¡è¶³å¼±ä¸‰è‰²ä¸å˜å¼ï¼Œç»“åˆäº†åˆ é™¤å†™å±éšœå’Œæ’å…¥å†™å±éšœçš„ä¼˜ç‚¹ï¼Œåªéœ€è¦åœ¨å¼€å§‹æ—¶å¹¶å‘æ‰«æå„ä¸ªgoroutineçš„æ ˆï¼Œä½¿å…¶å˜é»‘å¹¶ä¸€ç›´ä¿æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦STWï¼Œè€Œæ ‡è®°ç»“æŸåï¼Œå› ä¸ºæ ˆåœ¨æ‰«æåå§‹ç»ˆæ˜¯é»‘è‰²çš„ï¼Œä¹Ÿæ— éœ€å†è¿›è¡Œre-scanæ“ä½œäº†ï¼Œå‡å°‘äº†STWçš„æ—¶é—´ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“ &lt;a href=&#34;#%e6%80%bb%e7%bb%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;GoV1.3- æ™®é€šæ ‡è®°æ¸…é™¤æ³•ï¼Œæ•´ä½“è¿‡ç¨‹éœ€è¦å¯åŠ¨STWï¼Œæ•ˆç‡æä½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GoV1.5- ä¸‰è‰²æ ‡è®°æ³•ï¼Œ å †ç©ºé—´å¯åŠ¨å†™å±éšœï¼Œæ ˆç©ºé—´ä¸å¯åŠ¨ï¼Œå…¨éƒ¨æ‰«æä¹‹åï¼Œéœ€è¦é‡æ–°æ‰«æä¸€æ¬¡æ ˆ(éœ€è¦STW)ï¼Œæ•ˆç‡æ™®é€š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GoV1.8-ä¸‰è‰²æ ‡è®°æ³•ï¼Œæ··åˆå†™å±éšœæœºåˆ¶ï¼Œ æ ˆç©ºé—´ä¸å¯åŠ¨ï¼Œå †ç©ºé—´å¯åŠ¨ã€‚æ•´ä¸ªè¿‡ç¨‹å‡ ä¹ä¸éœ€è¦STWï¼Œæ•ˆç‡è¾ƒé«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Goä¸­makeä¸newåŒºåˆ«</title>
      <link>https://abnerxc.github.io/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/</link>
      <pubDate>Fri, 20 Sep 2024 10:46:12 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/</guid>
      <description>&lt;h1 id=&#34;å˜é‡çš„å£°æ˜&#34;&gt;å˜é‡çš„å£°æ˜ &lt;a href=&#34;#%e5%8f%98%e9%87%8f%e7%9a%84%e5%a3%b0%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡çš„å£°æ˜æˆ‘ä»¬å¯ä»¥é€šè¿‡varå…³é”®å­—ï¼Œç„¶åå°±å¯ä»¥åœ¨ç¨‹åºä¸­ä½¿ç”¨ã€‚å½“æˆ‘ä»¬ä¸æŒ‡å®šå˜é‡çš„é»˜è®¤å€¼æ—¶ï¼Œè¿™äº›å˜é‡çš„é»˜è®¤å€¼æ˜¯ä»–ä»¬çš„é›¶å€¼ï¼Œæ¯”å¦‚intç±»å‹çš„é›¶å€¼æ˜¯&lt;code&gt;0&lt;/code&gt;,stringç±»å‹çš„é›¶å€¼æ˜¯&lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt;ï¼Œå¼•ç”¨ç±»å‹çš„é›¶å€¼æ˜¯&lt;code&gt;nil&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä¾‹å­ä¸­çš„ä¸¤ç§ç±»å‹çš„å£°æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¯¹å…¶è¿›è¡Œèµ‹å€¼è¾“å‡ºã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ¢æˆæŒ‡é’ˆç±»å‹å‘¢ï¼Ÿ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;=&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ go run test1.go 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;panic: runtime error: invalid memory address or nil pointer dereference
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;signal SIGSEGV: segmentation violation code&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;0x1 addr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;0x0 pc&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;0x4849df&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;goroutine &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;running&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;main.main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	/home/itheima/go/src/golang_deeper/make_new/t
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¿™ä¸ªæç¤ºä¸­å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬ä¸å…‰è¦å£°æ˜å®ƒï¼Œè¿˜è¦ä¸ºå®ƒåˆ†é…å†…å®¹ç©ºé—´ï¼Œå¦åˆ™æˆ‘ä»¬çš„å€¼æ”¾åœ¨å“ªé‡Œå»å‘¢ï¼Ÿè¿™å°±æ˜¯ä¸Šé¢é”™è¯¯æç¤ºçš„åŸå› ã€‚&lt;/p&gt;
&lt;h1 id=&#34;new&#34;&gt;new &lt;a href=&#34;#new&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¯¹äºä¸Šé¢çš„é—®é¢˜æˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿæ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†æ²¡æœ‰ä¸ºå…¶åˆ†é…å†…å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨newåˆ†é…ä¸€ä¸ªå§ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;=new(&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;=&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨newå…³é”®å­—ï¼Œä¸ºå¼•ç”¨ç±»å‹å˜é‡åˆ†é…å†…å­˜ï¼Œç„¶åå°±å¯ä»¥è¿›è¡Œèµ‹å€¼äº†ã€‚ç°åœ¨å†è¿è¡Œç¨‹åºï¼ŒPASSï¼Œæ‰“å°10ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;sync&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;user&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;lock&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Mutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;age&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;u&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; new(&lt;span style=&#34;color:#a6e22e&#34;&gt;user&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;//é»˜è®¤ç»™uåˆ†é…åˆ°å†…å­˜å…¨éƒ¨ä¸º0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;u&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lock&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()  &lt;span style=&#34;color:#75715e&#34;&gt;//å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå› ä¸ºlockä¸º0,æ˜¯å¼€é”çŠ¶æ€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;u&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å¼ ä¸‰&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;u&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lock&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;u&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ go run test2.go 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;amp;&lt;span style=&#34;color:#f92672&#34;&gt;{{&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; 0&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; å¼ ä¸‰ 0&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°±æ˜¯newï¼Œå®ƒè¿”å›çš„æ°¸è¿œæ˜¯ç±»å‹çš„æŒ‡é’ˆï¼ŒæŒ‡å‘åˆ†é…ç±»å‹çš„å†…å­˜åœ°å€ã€‚&lt;/p&gt;
&lt;h1 id=&#34;make&#34;&gt;make &lt;a href=&#34;#make&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;makeä¹Ÿæ˜¯ç”¨äºå†…å­˜åˆ†é…çš„ï¼Œä½†æ˜¯å’Œnewä¸åŒã€‚å®ƒåªç”¨äº&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;map&lt;/li&gt;
&lt;li&gt;chan&lt;/li&gt;
&lt;li&gt;slice
çš„å†…å­˜åˆ›å»ºï¼Œè€Œä¸”å®ƒè¿”å›çš„ç±»å‹å°±æ˜¯è¿™ä¸‰ä¸ªç±»å‹æœ¬èº«ï¼Œè€Œä¸æ˜¯ä»–ä»¬çš„æŒ‡é’ˆç±»å‹ï¼Œå› ä¸ºè¿™ä¸‰ç§ç±»å‹å°±æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¿…è¦è¿”å›ä»–ä»¬çš„æŒ‡é’ˆäº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;makeä¸newçš„å¼‚åŒ&#34;&gt;makeä¸newçš„å¼‚åŒ &lt;a href=&#34;#make%e4%b8%8enew%e7%9a%84%e5%bc%82%e5%90%8c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åŒï¼šå †ç©ºé—´åˆ†é…
ä¸åŒï¼šmake: åªç”¨äºsliceã€mapä»¥åŠchannelçš„åˆå§‹åŒ–ï¼Œ æ— å¯æ›¿ä»£ï¼›new: ç”¨äºç±»å‹å†…å­˜åˆ†é…(åˆå§‹åŒ–å€¼ä¸º0)ï¼Œ ä¸å¸¸ç”¨&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</title>
      <link>https://abnerxc.github.io/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/</link>
      <pubDate>Thu, 19 Sep 2024 17:50:03 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;åŸæ–‡åœ°å€ï¼šhttps://www.yuque.com/aceld/golang/ga6pb1&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;ä¸€åˆ†æç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸cpuåˆ©ç”¨ç‡æƒ…å†µ&#34;&gt;ä¸€ã€åˆ†æç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸CPUåˆ©ç”¨ç‡æƒ…å†µ &lt;a href=&#34;#%e4%b8%80%e5%88%86%e6%9e%90%e7%a8%8b%e5%ba%8f%e7%9a%84%e8%bf%90%e8%a1%8c%e6%97%b6%e9%97%b4%e4%b8%8ecpu%e5%88%a9%e7%94%a8%e7%8e%87%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;shellå†…ç½®timeæŒ‡ä»¤&#34;&gt;shellå†…ç½®timeæŒ‡ä»¤ &lt;a href=&#34;#shell%e5%86%85%e7%bd%aetime%e6%8c%87%e4%bb%a4&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªæ–¹æ³•ä¸ç®—æ–°é¢–ï¼Œä½†æ˜¯ç¡®å¾ˆå®ç”¨ã€‚ &lt;code&gt;time&lt;/code&gt;æ˜¯Unix/Linuxå†…ç½®å¤šå‘½ä»¤ï¼Œä½¿ç”¨æ—¶ä¸€èˆ¬ä¸ç”¨ä¼ è¿‡å¤šå‚æ•°ï¼Œç›´æ¥è·Ÿä¸Šéœ€è¦è°ƒè¯•å¤šç¨‹åºå³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;time go run main.go 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ–æ³¢é‚£å¥‘æ•°åˆ—ç¬¬30é¡¹çš„å€¼ä¸ºï¼š &lt;span style=&#34;color:#ae81ff&#34;&gt;55&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;real	0m0.843s
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;user	0m0.216s
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sys	0m0.389s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢æ˜¯ä½¿ç”¨timeå¯¹ go run main.goå¯¹æ‰§è¡Œç¨‹åºåšäº†æ€§èƒ½åˆ†æï¼Œå¾—åˆ°3ä¸ªæŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;real:ä»ç¨‹åºå¼€å§‹åˆ°ç»“æŸï¼Œå®é™…åº¦è¿‡çš„æ—¶é—´ï¼›&lt;/li&gt;
&lt;li&gt;user:ç¨‹åºåœ¨ç”¨æˆ·æ€åº¦è¿‡çš„æ—¶é—´ï¼›&lt;/li&gt;
&lt;li&gt;sys:ç¨‹åºåœ¨ç³»ç»Ÿæ€åº¦è¿‡æ—¶é—´ã€‚
ä¸€èˆ¬æƒ…å†µä¸‹ real &amp;gt;= user + sysï¼Œå› ä¸ºç³»ç»Ÿè¿˜æœ‰å…¶å®ƒè¿›ç¨‹(åˆ‡æ¢å…¶ä»–è¿›ç¨‹ä¸­é—´å¯¹äºæœ¬è¿›ç¨‹ä¼šæœ‰ç©ºç™½æœŸ)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;usrbintimeæŒ‡ä»¤&#34;&gt;/usr/bin/timeæŒ‡ä»¤ &lt;a href=&#34;#usrbintime%e6%8c%87%e4%bb%a4&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªæŒ‡ä»¤æ¯”å†…ç½®çš„timeæ›´åŠ è¯¦ç»†ä¸€äº›ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦ç”¨ç»å¯¹è·¯å¾„ï¼Œè€Œä¸”è¦åŠ ä¸Šå‚æ•°&lt;code&gt;-v&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ /usr/bin/time -v go run main.go  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Command being timed: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;go run main.go&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	User time &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;seconds&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: 0.12
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	System time &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;seconds&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: 0.06
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Percent of CPU this job got: 115%
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Elapsed &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;wall clock&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; time &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;h:mm:ss or m:ss&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: 0:00.16
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Average shared text size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Average unshared data size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Average stack size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Average total size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Maximum resident set size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;41172&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Average resident set size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;kbytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Major &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;requiring I/O&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; page faults: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Minor &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;reclaiming a frame&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; page faults: &lt;span style=&#34;color:#ae81ff&#34;&gt;15880&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Voluntary context switches: &lt;span style=&#34;color:#ae81ff&#34;&gt;897&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Involuntary context switches: &lt;span style=&#34;color:#ae81ff&#34;&gt;183&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Swaps: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	File system inputs: &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	File system outputs: &lt;span style=&#34;color:#ae81ff&#34;&gt;2664&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Socket messages sent: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Socket messages received: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Signals delivered: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Page size &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;bytes&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;4096&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	Exit status: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;äºŒåˆ†ægolangç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ&#34;&gt;äºŒã€åˆ†ægolangç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ &lt;a href=&#34;#%e4%ba%8c%e5%88%86%e6%9e%90golang%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%86%85%e5%ad%98%e4%bd%bf%e7%94%a8%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å†…å­˜å ç”¨æƒ…å†µæŸ¥çœ‹&#34;&gt;å†…å­˜å ç”¨æƒ…å†µæŸ¥çœ‹ &lt;a href=&#34;#%e5%86%85%e5%ad%98%e5%8d%a0%e7%94%a8%e6%83%85%e5%86%b5%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬å…ˆå†™ä¸€æ®µdemoä¾‹å­ä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop begin.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop end.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Start.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;force gc.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GC&lt;/span&gt;() &lt;span style=&#34;color:#75715e&#34;&gt;//å¼ºåˆ¶è°ƒç”¨gcå›æ”¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Done.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3600&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;//ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¼–è¯‘&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go build -o snippet_mem &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ./snippet_mem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨./snippet_memè¿›ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå†å¼€ä¸€ä¸ªçª—å£ï¼Œé€šè¿‡&lt;code&gt;top&lt;/code&gt;å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜å ç”¨æƒ…å†µ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;top -p &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;pidof snippet_mem&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¾—åˆ°ç»“æœå¦‚ä¸‹
&lt;img src=&#34;https://abnerxc.github.io/img/godebug1.png&#34; alt=&#34;godebug1&#34;&gt;
æˆ‘ä»¬çœ‹å‡ºæ¥ï¼Œæ²¡æœ‰é€€å‡ºçš„snippet_memè¿›ç¨‹æœ‰çº¦830mçš„å†…å­˜è¢«å ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ç›´è§‚ä¸Šæ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºåœ¨test()å‡½æ•°æ‰§è¡Œå®Œåï¼Œåˆ‡ç‰‡contanerçš„å†…å­˜åº”è¯¥è¢«é‡Šæ”¾ï¼Œä¸åº”è¯¥å ç”¨830Mé‚£ä¹ˆå¤§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨godebugä¸gctraceæ¥åˆ†æç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ&#34;&gt;ä½¿ç”¨GODEBUGä¸gctraceæ¥åˆ†æç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8godebug%e4%b8%8egctrace%e6%9d%a5%e5%88%86%e6%9e%90%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%86%85%e5%ad%98%e4%bd%bf%e7%94%a8%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æ‰§è¡Œsnippet_memç¨‹åºä¹‹å‰æ·»åŠ ç¯å¢ƒå˜é‡GODEBUG=&amp;lsquo;gctrace=1&amp;rsquo;æ¥è·Ÿè¸ªæ‰“å°åƒåœ¾å›æ”¶å™¨ä¿¡æ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;GODEBUG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;gctrace=1&amp;#39;&lt;/span&gt; ./snippet_mem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¾ç½®gctrace=1ä¼šä½¿å¾—åƒåœ¾å›æ”¶å™¨åœ¨æ¯æ¬¡å›æ”¶æ—¶æ±‡æ€»æ‰€å›æ”¶å†…å­˜çš„å¤§å°ä»¥åŠè€—æ—¶ï¼Œ
å¹¶å°†è¿™äº›å†…å®¹æ±‡æ€»æˆå•è¡Œå†…å®¹æ‰“å°åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºä¸­ã€‚
æ ¼å¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc # @#s #%: #+#+# ms clock, #+#/#/#+# ms cpu, #-&amp;gt;#-&amp;gt;# MB, # MB goal, # P
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å«ä¹‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc #        GCæ¬¡æ•°çš„ç¼–å·ï¼Œæ¯æ¬¡GCæ—¶é€’å¢
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;@#s         è·ç¦»ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶çš„æ—¶é—´
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;#%          GCå ç”¨çš„æ‰§è¡Œæ—¶é—´ç™¾åˆ†æ¯”
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;#+...+#     GCä½¿ç”¨çš„æ—¶é—´
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;#-&amp;gt;#-&amp;gt;# MB  GCå¼€å§‹ï¼Œç»“æŸï¼Œä»¥åŠå½“å‰æ´»è·ƒå †å†…å­˜çš„å¤§å°ï¼Œå•ä½M
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# MB goal   å…¨å±€å †å†…å­˜å¤§å°
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# P         ä½¿ç”¨processorçš„æ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 15 @0.123s 4%: 0.051+43+0.003 ms clock, 0.83+0/44/0+0.057 ms cpu, 277-&amp;gt;277-&amp;gt;94 MB, 277 MB goal, 0 MB stacks, 0 MB globals, 16 P
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥æ¡ä¿¡æ¯å«ä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;gc 15&lt;/code&gt;:Gc è°ƒè¯•ç¼–å·ä¸º15&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@0.123s&lt;/code&gt;:æ­¤æ—¶ç¨‹åºå·²ç»æ‰§è¡Œäº†0.123s&lt;/li&gt;
&lt;li&gt;&lt;code&gt;4%:&lt;/code&gt;:0.123sä¸­å…¶ä¸­gcæ¨¡å—å ç”¨äº†4%çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0.051+43+0.003 ms clock&lt;/code&gt;:åƒåœ¾å›æ”¶çš„æ—¶é—´ï¼Œåˆ†åˆ«ä¸ºSTWï¼ˆstop-the-worldï¼‰æ¸…æ‰«çš„æ—¶é—´+å¹¶å‘æ ‡è®°å’Œæ‰«æçš„æ—¶é—´+STWæ ‡è®°çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0.83+0/44/0+0.057 ms cpu&lt;/code&gt;: åƒåœ¾å›æ”¶å ç”¨cpuæ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;277-&amp;gt;277-&amp;gt;94 MB&lt;/code&gt;: GCå¼€å§‹å‰å †å†…å­˜277Mï¼Œ GCç»“æŸåå †å†…å­˜277Mï¼Œå½“å‰æ´»è·ƒçš„å †å†…å­˜94M&lt;/li&gt;
&lt;li&gt;&lt;code&gt;277 MB goal&lt;/code&gt;: å…¨å±€å †å†…å­˜å¤§å°277M&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 MB stacks&lt;/code&gt;: æ ˆå†…å­˜å¤§å°0M&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 MB globals&lt;/code&gt;: å…¨å±€å˜é‡å†…å­˜å¤§å°0M&lt;/li&gt;
&lt;li&gt;&lt;code&gt;16 P&lt;/code&gt;: ä½¿ç”¨processorçš„æ•°é‡16&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äº†è§£äº†GCçš„è°ƒè¯•ä¿¡æ¯è¯»æ³•åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æœ¬æ¬¡GCçš„ç»“æœã€‚
æ‰§è¡ŒGODEBUGè°ƒè¯•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;GODEBUG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;gctrace=1&amp;#39;&lt;/span&gt; ./snippet_mem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2024/09/19 21:04:09  ===&amp;gt; loop begin.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 1 @0.003s 2%: 0.040+2.0+0.012 ms clock, 0.81+0/2.1/0+0.24 ms cpu, 4-&amp;gt;4-&amp;gt;1 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 2 @0.006s 4%: 0.027+8.1+0.14 ms clock, 0.55+0/6.6/0+2.9 ms cpu, 4-&amp;gt;5-&amp;gt;3 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 3 @0.015s 4%: 0.026+2.9+0.010 ms clock, 0.52+0/2.9/0+0.21 ms cpu, 7-&amp;gt;7-&amp;gt;2 MB, 8 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 4 @0.019s 22%: 0.050+1.1+5.2 ms clock, 1.0+0/1.1/0+105 ms cpu, 6-&amp;gt;10-&amp;gt;7 MB, 6 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 5 @0.026s 17%: 0.028+10+0.014 ms clock, 0.56+0/10/0+0.29 ms cpu, 19-&amp;gt;19-&amp;gt;6 MB, 19 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 6 @0.037s 12%: 0.031+14+0.067 ms clock, 0.63+0/4.5/0.001+1.3 ms cpu, 14-&amp;gt;24-&amp;gt;18 MB, 14 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 7 @0.067s 8%: 0.037+44+0.21 ms clock, 0.75+0/44/0+4.2 ms cpu, 46-&amp;gt;46-&amp;gt;28 MB, 46 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 8 @0.116s 7%: 0.035+25+0.028 ms clock, 0.71+0/24/0+0.57 ms cpu, 72-&amp;gt;72-&amp;gt;44 MB, 72 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 9 @0.150s 6%: 0.036+53+0.059 ms clock, 0.72+0/53/0+1.1 ms cpu, 113-&amp;gt;113-&amp;gt;38 MB, 113 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 10 @0.204s 6%: 0.079+9.0+0.011 ms clock, 1.5+0/8.9/0+0.23 ms cpu, 86-&amp;gt;86-&amp;gt;48 MB, 86 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 11 @0.213s 6%: 0.10+19+0.23 ms clock, 2.1+0/19/0+4.6 ms cpu, 108-&amp;gt;108-&amp;gt;108 MB, 108 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 12 @0.283s 5%: 0.025+40+0.024 ms clock, 0.50+0/40/0+0.48 ms cpu, 277-&amp;gt;277-&amp;gt;169 MB, 277 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 13 @0.408s 4%: 0.035+101+0.006 ms clock, 0.70+0/101/0+0.12 ms cpu, 433-&amp;gt;433-&amp;gt;147 MB, 433 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 14 @0.510s 4%: 0.011+18+0.005 ms clock, 0.22+0/18/0+0.10 ms cpu, 330-&amp;gt;330-&amp;gt;183 MB, 330 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 15 @0.529s 4%: 0.010+36+0.011 ms clock, 0.20+0/36/0+0.22 ms cpu, 413-&amp;gt;413-&amp;gt;229 MB, 413 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2024/09/19 21:04:10  ===&amp;gt; loop end.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2024/09/19 21:04:10 force gc.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 16 @0.566s 4%: 0.022+116+0.004 ms clock, 0.45+0/116/0+0.094 ms cpu, 516-&amp;gt;516-&amp;gt;0 MB, 516 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 17 @0.682s 4%: 0.080+0.17+0.073 ms clock, 1.6+0/0.15/0+1.4 ms cpu, 0-&amp;gt;0-&amp;gt;0 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P (forced)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2024/09/19 21:04:10 Done.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;GC forced
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gc 18 @121.392s 0%: 0.029+0.29+0.004 ms clock, 0.59+0/0.31/0+0.093 ms cpu, 0-&amp;gt;0-&amp;gt;0 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ†æ&lt;/p&gt;
&lt;p&gt;å…ˆçœ‹åœ¨test()å‡½æ•°æ‰§è¡Œå®Œåç«‹å³æ‰“å°çš„gc 16é‚£è¡Œçš„ä¿¡æ¯ã€‚516-&amp;gt;516-&amp;gt;0 MB, 516 MB goalè¡¨ç¤ºåƒåœ¾å›æ”¶å™¨å·²ç»æŠŠ516Mçš„å†…å­˜æ ‡è®°ä¸ºéæ´»è·ƒçš„å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;å†çœ‹ä¸‹ä¸€ä¸ªè®°å½•gc 17è¡Œ0-&amp;gt;0-&amp;gt;0 MB, 4 MB goalè¡¨ç¤ºåƒåœ¾å›æ”¶å™¨ä¸­çš„å…¨å±€å †å†…å­˜å¤§å°ç”±888Mä¸‹é™ä¸º4Mã€‚&lt;/p&gt;
&lt;p&gt;ç»“è®º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨test()å‡½æ•°æ‰§è¡Œå®Œåï¼Œdemoç¨‹åºä¸­çš„åˆ‡ç‰‡å®¹å™¨æ‰€ç”³è¯·çš„å †ç©ºé—´éƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶äº†ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ­¤æ—¶åœ¨topæŒ‡ä»¤æŸ¥è¯¢å†…å­˜çš„æ—¶å€™ï¼Œå¦‚æœä¾ç„¶æ˜¯800+MBï¼Œè¯´æ˜åƒåœ¾å›æ”¶å™¨å›æ”¶äº†åº”ç”¨å±‚çš„å†…å­˜åï¼Œ&lt;code&gt;ï¼ˆå¯èƒ½ï¼‰å¹¶ä¸ä¼šç«‹å³å°†å†…å­˜å½’è¿˜ç»™ç³»ç»Ÿ&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;runtimereadmemstats&#34;&gt;runtime.ReadMemStats &lt;a href=&#34;#runtimereadmemstats&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æ¥ä¸‹æ¥æ¢å¦ä¸€ç§æ–¹å¼æŸ¥çœ‹å†…å­˜çš„æ–¹å¼ åˆ©ç”¨ &lt;code&gt;runtime&lt;/code&gt;åº“é‡Œçš„&lt;code&gt;ReadMemStats()&lt;/code&gt;æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MemStats&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadMemStats&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop begin.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ( &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop end.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [Start].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [force gc].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GC&lt;/span&gt;() &lt;span style=&#34;color:#75715e&#34;&gt;//å¼ºåˆ¶è°ƒç”¨gcå›æ”¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [Done].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3600&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;//ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ï¼Œ å°è£…äº†ä¸€ä¸ªå‡½æ•°&lt;code&gt;readMemStats()&lt;/code&gt;ï¼Œè¿™é‡Œé¢ä¸»è¦æ˜¯è°ƒç”¨runtimeä¸­çš„&lt;code&gt;ReadMemStats()&lt;/code&gt;æ–¹æ³•è·å¾—å†…å­˜ä¿¡æ¯ï¼Œç„¶åé€šè¿‡&lt;code&gt;log&lt;/code&gt;æ‰“å°å‡ºæ¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;.&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; [&lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt;].
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;71280&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;66633728&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;66600960&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;loop&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;begin&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;132535744&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;336756736&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;155721728&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;loop&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;end&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;598300600&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;609181696&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;434323456&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; [&lt;span style=&#34;color:#a6e22e&#34;&gt;force&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gc&lt;/span&gt;].
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; [&lt;span style=&#34;color:#a6e22e&#34;&gt;Done&lt;/span&gt;].
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;55840&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207427072&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;434266112&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;38&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;56656&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207394304&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;434266112&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;56912&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207394304&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1206493184&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;58&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;57488&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207394304&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1206493184&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;08&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;57616&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207394304&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1206493184&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;c2020&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;22&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;=&amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;57744&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1207394304&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;1206493184&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;by&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Allocï¼šå·²åˆ†é…ä½†å°šæœªé‡Šæ”¾çš„å†…å­˜å­—èŠ‚æ•°ï¼ŒåŒ…æ‹¬å †å†…å­˜å’Œæ ˆå†…å­˜ç­‰&lt;/li&gt;
&lt;li&gt;HeapIdleï¼šå½“å‰æœªä½¿ç”¨ä½†ä»ç„¶ä¿ç•™ç»™å †çš„å†…å­˜å­—èŠ‚æ•°ï¼ˆå³å¯ä»¥å¿«é€Ÿé‡æ–°ä½¿ç”¨çš„å†…å­˜ï¼‰&lt;/li&gt;
&lt;li&gt;HeapReleasedï¼šå·²å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼ˆä½†æœªæ¥å¯èƒ½å†æ¬¡ç”³è¯·ï¼‰çš„å †å†…å­˜å­—èŠ‚æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œæ‰“å°&lt;code&gt;[Done]&lt;/code&gt;.ä¹‹åé‚£æ¡traceä¿¡æ¯ï¼ŒAllocå·²ç»ä¸‹é™ï¼Œå³å†…å­˜å·²è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚åœ¨2025/09/19 21:17:31å’Œ2020/03/02 18:21:48çš„ä¸¤æ¡traceä¿¡æ¯ä¸­ï¼ŒHeapReleasedå¼€å§‹ä¸Šå‡ï¼Œå³åƒåœ¾å›æ”¶å™¨æŠŠå†…å­˜å½’è¿˜ç»™ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ›´å¤šMemStatsè¯´æ˜ï¼š&lt;a href=&#34;https://pkg.go.dev/runtime#MemStats&#34;&gt;https://pkg.go.dev/runtime#MemStats&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;pprofå·¥å…·&#34;&gt;pprofå·¥å…· &lt;a href=&#34;#pprof%e5%b7%a5%e5%85%b7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;pprofå·¥å…·æ”¯æŒç½‘é¡µä¸ŠæŸ¥çœ‹å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œéœ€è¦åœ¨ä»£ç ä¸­æ·»åŠ ä¸€ä¸ªåç¨‹å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å®Œæ•´ç¤ºä¾‹ä»£ç :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http/pprof&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MemStats&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadMemStats&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Alloc&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HeapIdle&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ms&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HeapReleased&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop begin.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;container&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ( &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop end.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//å¯åŠ¨pprof&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.0.0.0:10000&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [Start].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [force gc].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GC&lt;/span&gt;() &lt;span style=&#34;color:#75715e&#34;&gt;//å¼ºåˆ¶è°ƒç”¨gcå›æ”¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; [Done].&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;readMemStats&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3600&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;//ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—®ï¼šhttp://127.0.0.1:10000/debug/pprof/heap?debug=1 æŸ¥çœ‹&lt;/p&gt;
&lt;p&gt;æµè§ˆå™¨çš„å†…å®¹å…¶ä¸­æœ‰ä¸€éƒ¨åˆ†å¦‚ä¸‹ï¼Œè®°å½•äº†ç›®å‰çš„å†…å­˜æƒ…å†µ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# runtime.MemStats
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Alloc = 393328
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# TotalAlloc = 1503610448
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Sys = 991758840
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Lookups = 0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Mallocs = 1023
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Frees = 233
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapAlloc = 393328
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapSys = 985137152
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapIdle = 984096768
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapInuse = 1040384
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapReleased = 984006656
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# HeapObjects = 790
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Stack = 524288 / 524288
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# MSpan = 75680 / 81600
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# MCache = 24000 / 31200
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# BuckHashSys = 1450271
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# GCSys = 3206184
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# OtherSys = 1328145
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# NextGC = 4194304
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# LastGC = 1758288816398705240
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;ä¸‰åˆ†ægolangç¨‹åºçš„cpuæ€§èƒ½æƒ…å†µ&#34;&gt;ä¸‰ã€åˆ†æGolangç¨‹åºçš„CPUæ€§èƒ½æƒ…å†µ &lt;a href=&#34;#%e4%b8%89%e5%88%86%e6%9e%90golang%e7%a8%8b%e5%ba%8f%e7%9a%84cpu%e6%80%a7%e8%83%bd%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;cpuæ€§èƒ½æµ‹è¯•ä»£ç &#34;&gt;CPUæ€§èƒ½æµ‹è¯•ä»£ç  &lt;a href=&#34;#cpu%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e4%bb%a3%e7%a0%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bytes&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;math/rand&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http/pprof&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop begin.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;genSomeBytes&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; ===&amp;gt; loop end.&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;genSomeBytes&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Buffer&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;buff&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Buffer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20000&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;buff&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Write&lt;/span&gt;([]&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;{&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; byte(&lt;span style=&#34;color:#a6e22e&#34;&gt;rand&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Intn&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;))})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;buff&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;test&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//å¯åŠ¨pprof&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.0.0.0:10000&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ä½¿ç”¨pprof-webç•Œé¢æŸ¥çœ‹&#34;&gt;ä½¿ç”¨pprof-Webç•Œé¢æŸ¥çœ‹ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8pprof-web%e7%95%8c%e9%9d%a2%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æµè§ˆå™¨è®¿é—®: http://127.0.0.1:10000/debug/pprof/
&lt;img src=&#34;https://abnerxc.github.io/img/godebug2.png&#34; alt=&#34;godebug2&#34;&gt;
æˆ‘ä»¬å¯ä»¥ç›´æ¥ç‚¹å‡»ç½‘é¡µçš„profile,æµè§ˆå™¨ä¼šç»™æˆ‘ä»¬ä¸‹è½½ä¸€ä¸ªprofileæ–‡ä»¶.&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨pprofå·¥å…·æŸ¥çœ‹&#34;&gt;ä½¿ç”¨pprofå·¥å…·æŸ¥çœ‹ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8pprof%e5%b7%a5%e5%85%b7%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å°†ä¸‹è½½çš„profileæ–‡ä»¶å’Œgoçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸€èµ·æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go tool pprof &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;binary&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;profile&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;binary:goå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;profile:webç•Œé¢ä¸‹è½½çš„profileæ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go tool pprof ./democpu profile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;File: democpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Type: cpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Time: Mar 3, 2020 at 11:18pm (CST)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Duration: 30.13s, Total samples = 6.27s (20.81%)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Entering interactive mode (type &amp;#34;help&amp;#34; for commands, &amp;#34;o&amp;#34; for options)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;helpå¯ä»¥æŸ¥çœ‹ä¸€äº›æŒ‡ä»¤,æˆ‘ä¹ˆå¯ä»¥é€šè¿‡topæ¥æŸ¥çœ‹cpuçš„æ€§èƒ½æƒ…å†µ.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof) top
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Showing nodes accounting for 5090ms, 81.18% of 6270ms total
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Dropped 80 nodes (cum &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;&lt;/span&gt;= 31.35ms)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Showing top 10 nodes out of 60
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      flat  flat%   sum%        cum   cum%
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    1060ms 16.91% 16.91%     2170ms 34.61%  math/rand.(*lockedSource).Int63
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     850ms 13.56% 30.46%      850ms 13.56%  sync.(*Mutex).Unlock (inline)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     710ms 11.32% 41.79%     2950ms 47.05%  math/rand.(*Rand).Int31n
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     570ms  9.09% 50.88%      990ms 15.79%  bytes.(*Buffer).Write
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     530ms  8.45% 59.33%      540ms  8.61%  syscall.Syscall
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     370ms  5.90% 65.23%      370ms  5.90%  runtime.procyield
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     270ms  4.31% 69.54%     4490ms 71.61%  main.genSomeBytes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     250ms  3.99% 73.52%     3200ms 51.04%  math/rand.(*Rand).Intn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     250ms  3.99% 77.51%      250ms  3.99%  runtime.memmove
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     230ms  3.67% 81.18%      690ms 11.00%  runtime.suspendG
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œé¢æœ‰å‡ åˆ—æ•°æ®,éœ€è¦è¯´æ˜ä¸€ä¸‹.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;flatï¼šå½“å‰å‡½æ•°å ç”¨CPUçš„è€—æ—¶&lt;/li&gt;
&lt;li&gt;flat%ï¼š:å½“å‰å‡½æ•°å ç”¨CPUçš„è€—æ—¶ç™¾åˆ†æ¯”&lt;/li&gt;
&lt;li&gt;sum%ï¼šå‡½æ•°å ç”¨CPUçš„è€—æ—¶ç´¯è®¡ç™¾åˆ†æ¯”&lt;/li&gt;
&lt;li&gt;cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨CPUçš„æ€»è€—æ—¶&lt;/li&gt;
&lt;li&gt;cum%ï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨CPUçš„æ€»è€—æ—¶ç™¾åˆ†æ¯”&lt;/li&gt;
&lt;li&gt;æœ€åä¸€åˆ—ï¼šå‡½æ•°åç§°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é€šè¿‡go-tool-pprofå¾—åˆ°profileæ–‡ä»¶&#34;&gt;é€šè¿‡go tool pprofå¾—åˆ°profileæ–‡ä»¶ &lt;a href=&#34;#%e9%80%9a%e8%bf%87go-tool-pprof%e5%be%97%e5%88%b0profile%e6%96%87%e4%bb%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;webä¸‹è½½çš„é»˜è®¤æ˜¯30s,é€šè¿‡ä¸‹é¢å‘½ä»¤å¯ä»¥å¾—åˆ°60sçš„profileæ–‡ä»¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go tool pprof http://localhost:10000/debug/pprof/profile?seconds&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;60&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; go tool pprof http://localhost:10000/debug/pprof/profile?seconds=60
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Fetching profile over HTTP from http://localhost:10000/debug/pprof/profile?seconds=60
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Saved profile in /home/abner/pprof/pprof.procpu.samples.cpu.001.pb.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;File: procpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Type: cpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Time: Sep 19, 2024 at 10:28pm (CST)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Duration: 60.16s, Total samples = 18.90s (31.42%)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Entering interactive mode (type &amp;#34;help&amp;#34; for commands, &amp;#34;o&amp;#34; for options)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof) top
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Showing nodes accounting for 14990ms, 79.31% of 18900ms total
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Dropped 191 nodes (cum &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;&lt;/span&gt;= 94.50ms)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Showing top 10 nodes out of 74
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      flat  flat%   sum%        cum   cum%
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    3650ms 19.31% 19.31%     8440ms 44.66%  math/rand.(*Rand).Int31n
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    2960ms 15.66% 34.97%     2960ms 15.66%  internal/runtime/syscall.Syscall6
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    2770ms 14.66% 49.63%     2770ms 14.66%  internal/chacha8rand.block
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    1190ms  6.30% 55.93%     3050ms 16.14%  bytes.(*Buffer).Write
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    1160ms  6.14% 62.06%     1160ms  6.14%  runtime.memmove
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     780ms  4.13% 66.19%    14010ms 74.13%  main.genSomeBytes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     780ms  4.13% 70.32%     3970ms 21.01%  runtime.rand
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     660ms  3.49% 73.81%     9100ms 48.15%  math/rand.(*Rand).Intn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     550ms  2.91% 76.72%    10130ms 53.60%  math/rand.Intn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     490ms  2.59% 79.31%     4790ms 25.34%  math/rand.(*Rand).Int63 (inline)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof) 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å¯è§†åŒ–æŸ¥çœ‹&#34;&gt;å¯è§†åŒ–æŸ¥çœ‹ &lt;a href=&#34;#%e5%8f%af%e8%a7%86%e5%8c%96%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¾“å…¥web&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go tool pprof ./democpu profile
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;File: democpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Type: cpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Time: Mar 3, 2020 at 11:18pm (CST)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Duration: 30.13s, Total samples = 6.27s (20.81%)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Entering interactive mode (type &amp;#34;help&amp;#34; for commands, &amp;#34;o&amp;#34; for options)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(pprof) web
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œå¦‚æœæŠ¥æ‰¾ä¸åˆ°graphvizå·¥å…·,éœ€è¦å®‰è£…ä¸€ä¸‹
Ubuntuå®‰è£…:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install graphviz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Macå®‰è£…:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;brew install graphviz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Winå®‰è£…:
ä¸‹è½½https://graphviz.gitlab.io/_pages/Download/Download_windows.html
å°†graphvizå®‰è£…ç›®å½•ä¸‹çš„binæ–‡ä»¶å¤¹æ·»åŠ åˆ°Pathç¯å¢ƒå˜é‡ä¸­ã€‚ åœ¨ç»ˆç«¯è¾“å…¥dot -versionæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/godebug3.png&#34; alt=&#34;godebug3&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GRPCç¬”è®°</title>
      <link>https://abnerxc.github.io/go/grpc%E6%80%BB%E7%BB%93/</link>
      <pubDate>Mon, 22 Jul 2024 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/grpc%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;h1 id=&#34;å®‰è£…protobuf&#34;&gt;å®‰è£…Protobuf &lt;a href=&#34;#%e5%ae%89%e8%a3%85protobuf&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;ä¸‹è½½&lt;a href=&#34;https://github.com/protocolbuffers/protobuf/releases&#34;&gt;Protocol Buffers&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®ç¯å¢ƒå˜é‡ï¼Œmacoså¦‚ä¸‹:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;export PATH&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$PATH:$JAVA_HOME/bin:&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;go env GOPATH&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;/bin:/Users/abner/tools/platform-tools:/Users/abner/tools/apache-maven-3.9.11/bin:/Users/abner/tools/protoc-32.0-osx-x86_64/bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;æ‰§è¡Œsource ~/.zshrc 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æœ€åç»ˆç«¯è¾“å…¥&lt;code&gt;protoc&lt;/code&gt; éªŒè¯&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å®‰è£…gRPCæ ¸å¿ƒåº“&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go get google.golang.org/grpc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;ä¸Šé¢å®‰è£…çš„æ˜¯protocolç¼–è¯‘å™¨,ä»–å¯ä»¥ç”Ÿæˆä¸åŒè¯­è¨€ä»£ç ã€‚æ¥ç€å®‰è£…goè¯­è¨€çš„ä»£ç ç”Ÿæˆå·¥å…·&lt;code&gt;protoc-gen-go&lt;/code&gt;ï¼Œå…¶ä»–è¯­è¨€è‡ªè¡Œç ”ç©¶&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;protoæ–‡ä»¶ç¼–å†™&#34;&gt;protoæ–‡ä»¶ç¼–å†™ &lt;a href=&#34;#proto%e6%96%87%e4%bb%b6%e7%bc%96%e5%86%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//è¿™æ˜¯åœ¨è¯´æ˜ä½¿ç”¨çš„æ˜¯proto3è¯­æ³•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;syntax &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;proto3&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//è¿™äº‹åœ¨è¯´æ˜ç”Ÿæˆçš„è·¯å¾„,è¿™é‡Œçš„.è¡¨ç¤ºå½“å‰ç›®å½•,serviceä»£ç ç”Ÿæˆçš„goæ–‡ä»¶åŒ…åæ˜¯service
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;option go_package &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;.;service&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å®šä¹‰æœåŠ¡Greeterï¼Œè¿™ä¸ªæœåŠ¡ä¸­æœ‰ä¸€ä¸ªrpcæ–¹æ³•SayHelloï¼Œè¯·æ±‚å‚æ•°æ˜¯HelloRequestï¼Œè¿”å›å‚æ•°æ˜¯HelloReplyã€‚ä¸€ä¸ªæ–‡ä»¶å¯ä»¥å®šä¹‰å¤šä¸ªserviceæœåŠ¡ï¼Œå¯ä»¥æŠŠä¸€ç»„ç›¸å…³çš„
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;service Greeter &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  rpc SayHello &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; returns &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;HelloReply&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// è¯·æ±‚å‚æ•°
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;message HelloRequest &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  string reqName &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å“åº”å‚æ•°
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;message HelloReply &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  string respMsg &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¼–å†™å®Œä¸Šé¢å†…å®¹åï¼Œåœ¨æ–‡ä»¶ç›®å½•æ‰§è¡Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protoc --go_out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;.  greeter.proto
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protoc --go-grpc_out&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;.  greeter.proto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;protoæ–‡ä»¶ä»‹ç»&#34;&gt;protoæ–‡ä»¶ä»‹ç» &lt;a href=&#34;#proto%e6%96%87%e4%bb%b6%e4%bb%8b%e7%bb%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;message&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;message: protobufä¸­å®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ç±»å‹æ˜¯é€šè¿‡å…³é”®å­—messageå­—æ®µæŒ‡å®šçš„ã€‚ç±»ä¼¼c++ä¸­çš„class,javaä¸­çš„class,goä¸­çš„structï¼Œä¸€ä¸ªprotoæ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªæ¶ˆæ¯ç±»å‹&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å­—æ®µè§„åˆ™&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;required: è¡¨ç¤ºå­—æ®µå¿…é¡»èµ‹å€¼,å¦åˆ™ç¼–è¯‘ä¸è¿‡ã€‚åœ¨proto3ä¸­ï¼Œrequiredå­—æ®µå·²å¼ƒç”¨
optional: è¡¨ç¤ºå­—æ®µå¯ä»¥ä¸èµ‹å€¼ã€‚åœ¨proto3ä¸­ï¼Œrequiredã€optionalå­—æ®µå·²éƒ½å·²ç»é»˜è®¤optional
repeated: è¡¨ç¤ºå­—æ®µå¯ä»¥é‡å¤èµ‹å€¼,åœ¨goä¸­ä¼šè¢«å®šä¹‰ä¸ºåˆ‡ç‰‡&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¶ˆæ¯å·&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨æ¶ˆæ¯ä½“çš„å®šä¹‰ä¸­ï¼Œæ¯ä¸ªå­—æ®µéƒ½å¿…é¡»è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ï¼Œæ ‡è¯†ä»[1,2^29-1]èŒƒå›´å†…çš„ä¸€ä¸ªæ•´æ•°&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åµŒå¥—æ¶ˆæ¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯ä»¥åœ¨å…¶ä»–æ¶ˆæ¯ç±»å‹ä¸­å®šä¹‰ä½¿ç”¨æ¶ˆæ¯ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;message Father &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    message Son &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        string name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        int32 age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        repeated int32 weight &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 3;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    repeated Son sons &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœè¦åœ¨å¤–éƒ¨ä½¿ç”¨è¿™ä¸ªæ¶ˆæ¯ç±»å‹ï¼Œéœ€è¦Father.Sonçš„å½¢å¼ä½¿ç”¨ã€‚å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;message Family &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Father.Son one &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æœåŠ¡å®šä¹‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨protoæ–‡ä»¶ä¸­å®šä¹‰æœåŠ¡ï¼ŒæœåŠ¡ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½å¯¹åº”ä¸€ä¸ªRPCæ–¹æ³•ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;service GoodsService &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    rpc Serarch&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;SearchRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; returns &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;SearchResponse&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;æœåŠ¡ç«¯ç¼–å†™&#34;&gt;æœåŠ¡ç«¯ç¼–å†™ &lt;a href=&#34;#%e6%9c%8d%e5%8a%a1%e7%ab%af%e7%bc%96%e5%86%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;server.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;demo/grpc/pb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runtime&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const port &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:50051&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type ServerDemo struct &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	pb.UnimplementedGreeterServer
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;s *ServerDemo&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, req *pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;resp *pb.HelloReply, err error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	msg :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fmt.Sprintf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hello,%s[rpc-server,os=%s,nowNanosecond=%d]&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		req.ReqName, runtime.GOOS, time.Now&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;.Nanosecond&lt;span style=&#34;color:#f92672&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &amp;amp;pb.HelloReply&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;RespMsg: msg&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	listen, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net.Listen&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, port&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		panic&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	newServer :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.NewServer&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	pb.RegisterGreeterServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;newServer, &amp;amp;ServerDemo&lt;span style=&#34;color:#f92672&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	err &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; newServer.Serve&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;listen&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	fmt.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;å®¢æˆ·ç«¯ç¼–å†™&#34;&gt;å®¢æˆ·ç«¯ç¼–å†™ &lt;a href=&#34;#%e5%ae%a2%e6%88%b7%e7%ab%af%e7%bc%96%e5%86%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;client.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;demo/grpc/pb&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	address     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;localhost:50051&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	defaultName &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;kaola&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	conn, e :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.Dial&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;address, grpc.WithInsecure&lt;span style=&#34;color:#f92672&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; e !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		panic&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;e&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	defer conn.Close&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	c :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pb.NewGreeterClient&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;conn&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	reply, e :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; c.SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;context.Background&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;, &amp;amp;pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;ReqName: defaultName&lt;span style=&#34;color:#f92672&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; e !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		log.Fatal&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;e&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	fmt.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;reply.RespMsg&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;è®¤è¯&#34;&gt;è®¤è¯ &lt;a href=&#34;#%e8%ae%a4%e8%af%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;gRPCé»˜è®¤å†…ç½®äº†ä¸¤ç§è®¤è¯æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SSL/TLSè®¤è¯æ–¹å¼&lt;/li&gt;
&lt;li&gt;åŸºäºTokençš„è®¤è¯æ–¹å¼
åŒæ—¶ï¼ŒgRPCæä¾›äº†æ¥å£ç”¨äºæ‰©å±•è‡ªå®šä¹‰è®¤è¯æ–¹å¼
é¡¹ç›®è·¯é¢ç»“æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” client/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // æœåŠ¡ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” proto/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.proto   // protoæè¿°æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.pb.go   // protoç¼–è¯‘åæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ssltlsè®¤è¯&#34;&gt;SSL/TLSè®¤è¯ &lt;a href=&#34;#ssltls%e8%ae%a4%e8%af%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¿™é‡Œç›´æ¥æ‰©å±•helloé¡¹ç›®ï¼Œå®ç°TLSè®¤è¯æœºåˆ¶&lt;/p&gt;
&lt;p&gt;é¦–å…ˆéœ€è¦å‡†å¤‡è¯ä¹¦ï¼Œåœ¨helloç›®å½•æ–°å»ºkeysç›®å½•ç”¨äºå­˜æ”¾è¯ä¹¦æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯ä¹¦åˆ¶ä½œ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åˆ¶ä½œç§é’¥ (.key)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Key considerations for algorithm &amp;#34;RSA&amp;#34; â‰¥ 2048-bit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ openssl genrsa -out server.key &lt;span style=&#34;color:#ae81ff&#34;&gt;2048&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Key considerations for algorithm &amp;#34;ECDSA&amp;#34; â‰¥ secp384r1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# List ECDSA the supported curves (openssl ecparam -list_curves)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ openssl ecparam -genkey -name secp384r1 -out server.key
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‡ªç­¾åå…¬é’¥(x509) (PEM-encodings .pem|.crt)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ openssl req -new -x509 -sha256 -key server.key -out server.pem -days &lt;span style=&#34;color:#ae81ff&#34;&gt;3650&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‡ªå®šä¹‰ä¿¡æ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-----
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Country Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; letter code&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;AU&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:CN
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;State or Province Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;full name&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Some-State&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:XxXx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Locality Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;eg, city&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;:XxXx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Organization Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;eg, company&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Internet Widgits Pty Ltd&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:XX Co. Ltd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Organizational Unit Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;eg, section&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;:Dev
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Common Name &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;e.g. server FQDN or YOUR name&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;:server name
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Email Address &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;:xxx@xxx.com
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›®å½•ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” hello-tls/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” client/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // æœåŠ¡ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” keys/                 // è¯ä¹¦ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.key
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.pem
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” proto/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.proto   // protoæè¿°æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.pb.go   // protoç¼–è¯‘åæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ä»£ç 
ä¿®æ”¹æœåŠ¡ç«¯ä»£ç ï¼šserver/main.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // å¼•å…¥grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å®šä¹‰helloServiceå¹¶å®ç°çº¦å®šçš„æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type helloService struct&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// HelloService HelloæœåŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;var HelloService &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; helloService&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// SayHello å®ç°HelloæœåŠ¡æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;h helloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, in *pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;*pb.HelloResponse, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; new&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;pb.HelloResponse&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp.Message &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fmt.Sprintf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello %s.&amp;#34;&lt;/span&gt;, in.Name&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; resp, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net.Listen&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, Address&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to listen: %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewServerTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.key&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to generate credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // å®ä¾‹åŒ–grpc Server, å¹¶å¼€å¯TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.NewServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;grpc.Creds&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æ³¨å†ŒHelloService
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb.RegisterHelloServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;s, HelloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Listen on &amp;#34;&lt;/span&gt; + Address + &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; with TLS&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s.Serve&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;listen&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡ç«¯åœ¨å®ä¾‹åŒ–grpc Serveræ—¶ï¼Œå¯é…ç½®å¤šç§é€‰é¡¹ï¼ŒTLSè®¤è¯æ˜¯å…¶ä¸­ä¹‹ä¸€&lt;/p&gt;
&lt;p&gt;å®¢æˆ·ç«¯æ·»åŠ TLSè®¤è¯ï¼šclient/main.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt; // å¼•å…¥protoåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // å¼•å…¥grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // TLSè¿æ¥
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewClientTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;server name&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to create TLS credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    conn, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.Dial&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Address, grpc.WithTransportCredentials&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    defer conn.Close&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // åˆå§‹åŒ–å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    c :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pb.NewHelloClient&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;conn&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // è°ƒç”¨æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    req :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;amp;pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;Name: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gRPC&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    res, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; c.SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;context.Background&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;, req&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;res.Message&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®¢æˆ·ç«¯æ·»åŠ TLSè®¤è¯çš„æ–¹å¼å’ŒæœåŠ¡ç«¯ç±»ä¼¼ï¼Œåœ¨åˆ›å»ºè¿æ¥Dialæ—¶ï¼ŒåŒæ ·å¯ä»¥é…ç½®å¤šç§é€‰é¡¹ï¼Œåé¢çš„ç¤ºä¾‹ä¸­ä¼šçœ‹åˆ°æ›´å¤šçš„é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;tokenè®¤è¯&#34;&gt;Tokenè®¤è¯ &lt;a href=&#34;#token%e8%ae%a4%e8%af%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å†è¿›ä¸€æ­¥ï¼Œç»§ç»­æ‰©å±•hello-tlsé¡¹ç›®ï¼Œå®ç°TLS + Tokenè®¤è¯æœºåˆ¶ï¼Œä¹Ÿå¯ä»¥ä¸éœ€è¦TLSï¼Œä»…ä½¿ç”¨tokenã€‚ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨TLS + Tokenè®¤è¯æœºåˆ¶
ç›®å½•ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” hello_token/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” client/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // æœåŠ¡ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” keys/             // è¯ä¹¦ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.key
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.pem
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” proto/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.proto   // protoæè¿°æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.pb.go   // protoç¼–è¯‘åæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ä»£ç &lt;/p&gt;
&lt;p&gt;å…ˆä¿®æ”¹å®¢æˆ·ç«¯å®ç°ï¼šclient/main.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt; // å¼•å…¥protoåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // å¼•å…¥grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // OpenTLS æ˜¯å¦å¼€å¯TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    OpenTLS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// customCredential è‡ªå®šä¹‰è®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type customCredential struct&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// GetRequestMetadata å®ç°è‡ªå®šä¹‰è®¤è¯æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;c customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; GetRequestMetadata&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, uri ...string&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;map&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;string, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; map&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appid&amp;#34;&lt;/span&gt;:  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;101010&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appkey&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;i am key&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// RequireTransportSecurity è‡ªå®šä¹‰è®¤è¯æ˜¯å¦å¼€å¯TLS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;c customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; RequireTransportSecurity&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; bool &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; OpenTLS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var err error
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var opts &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;grpc.DialOption
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; OpenTLS &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        // TLSè¿æ¥
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewClientTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;server name&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to create TLS credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithTransportCredentials&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithInsecure&lt;span style=&#34;color:#f92672&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // ä½¿ç”¨è‡ªå®šä¹‰è®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithPerRPCCredentials&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;new&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    conn, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.Dial&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Address, opts...&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    defer conn.Close&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // åˆå§‹åŒ–å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    c :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pb.NewHelloClient&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;conn&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // è°ƒç”¨æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    req :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;amp;pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;Name: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gRPC&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    res, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; c.SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;context.Background&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;, req&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;res.Message&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª&lt;code&gt;customCredential&lt;/code&gt;ç»“æ„ï¼Œå¹¶å®ç°äº†ä¸¤ä¸ªæ–¹æ³•&lt;code&gt;GetRequestMetadata&lt;/code&gt;å’Œ&lt;code&gt;RequireTransportSecurity&lt;/code&gt;ã€‚è¿™æ˜¯gRPCæä¾›çš„è‡ªå®šä¹‰è®¤è¯æ–¹å¼ï¼Œæ¯æ¬¡RPCè°ƒç”¨éƒ½ä¼šä¼ è¾“è®¤è¯ä¿¡æ¯ã€‚&lt;code&gt;customCredential&lt;/code&gt;å…¶å®æ˜¯å®ç°äº†&lt;code&gt;grpc/credential&lt;/code&gt;åŒ…å†…çš„&lt;code&gt;PerRPCCredentials&lt;/code&gt;æ¥å£ã€‚æ¯æ¬¡è°ƒç”¨ï¼Œtokenä¿¡æ¯ä¼šé€šè¿‡è¯·æ±‚çš„metadataä¼ è¾“åˆ°æœåŠ¡ç«¯ã€‚ä¸‹é¢å…·ä½“çœ‹ä¸€ä¸‹æœåŠ¡ç«¯å¦‚ä½•è·å–metadataä¸­çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹server/main.goä¸­çš„SayHelloæ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/codes&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // å¼•å…¥grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/metadata&amp;#34;&lt;/span&gt; // å¼•å…¥grpc metaåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å®šä¹‰helloServiceå¹¶å®ç°çº¦å®šçš„æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type helloService struct&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// HelloService ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;var HelloService &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; helloService&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// SayHello å®ç°HelloæœåŠ¡æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;h helloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, in *pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;*pb.HelloResponse, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // è§£æmetadaä¸­çš„ä¿¡æ¯å¹¶éªŒè¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    md, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; metadata.FromContext&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; nil, grpc.Errorf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;codes.Unauthenticated, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;æ— Tokenè®¤è¯ä¿¡æ¯&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appid  string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appkey string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; val, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; md&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appid&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; val&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; val, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; md&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appkey&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appkey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; val&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; appid !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;101010&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; appkey !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;i am key&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; nil, grpc.Errorf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;codes.Unauthenticated, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Tokenè®¤è¯ä¿¡æ¯æ— æ•ˆ: appid=%s, appkey=%s&amp;#34;&lt;/span&gt;, appid, appkey&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; new&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;pb.HelloResponse&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp.Message &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fmt.Sprintf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello %s.\nToken info: appid=%s,appkey=%s&amp;#34;&lt;/span&gt;, in.Name, appid, appkey&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; resp, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net.Listen&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, Address&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;failed to listen: %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewServerTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.key&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to generate credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // å®ä¾‹åŒ–grpc Server, å¹¶å¼€å¯TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.NewServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;grpc.Creds&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æ³¨å†ŒHelloService
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb.RegisterHelloServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;s, HelloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Listen on &amp;#34;&lt;/span&gt; + Address + &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; with TLS + Token&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s.Serve&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;listen&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡ç«¯å¯ä»¥ä»contextä¸­è·å–æ¯æ¬¡è¯·æ±‚çš„metadataï¼Œä»ä¸­è¯»å–å®¢æˆ·ç«¯å‘é€çš„tokenä¿¡æ¯å¹¶éªŒè¯æœ‰æ•ˆæ€§ã€‚
&lt;code&gt;google.golang.org/grpc/credentials/oauth&lt;/code&gt;åŒ…å·²å®ç°äº†ç”¨äºGoogle APIçš„oauthå’ŒjwtéªŒè¯çš„æ–¹æ³•ï¼Œä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚å®ç°åˆé€‚çš„éªŒè¯æ–¹å¼ã€‚&lt;/p&gt;
&lt;h1 id=&#34;interceptor-æ‹¦æˆªå™¨&#34;&gt;Interceptor æ‹¦æˆªå™¨ &lt;a href=&#34;#interceptor-%e6%8b%a6%e6%88%aa%e5%99%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;grpcæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½æä¾›äº†interceptoråŠŸèƒ½ï¼ŒåŠŸèƒ½ç±»ä¼¼middlewareï¼Œå¾ˆé€‚åˆåœ¨è¿™é‡Œå¤„ç†éªŒè¯ã€æ—¥å¿—ç­‰æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è‡ªå®šä¹‰Tokenè®¤è¯çš„ç¤ºä¾‹ä¸­ï¼Œè®¤è¯ä¿¡æ¯æ˜¯ç”±æ¯ä¸ªæœåŠ¡ä¸­çš„æ–¹æ³•å¤„ç†å¹¶è®¤è¯çš„ï¼Œå¦‚æœæœ‰å¤§é‡çš„æ¥å£æ–¹æ³•ï¼Œè¿™ç§å§¿åŠ¿å°±å¤ªä¸ä¼˜é›…äº†ï¼Œæ¯ä¸ªæ¥å£å®ç°éƒ½è¦å…ˆå¤„ç†è®¤è¯ä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™interceptorå°±å¯ä»¥ç”¨æ¥è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œåœ¨è¯·æ±‚è¢«è½¬åˆ°å…·ä½“æ¥å£ä¹‹å‰å¤„ç†è®¤è¯ä¿¡æ¯ï¼Œä¸€å¤„è®¤è¯ï¼Œåˆ°å¤„æ— å¿§ã€‚ åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªè¯·æ±‚æ—¥å¿—ï¼Œè®°å½•è¯·æ±‚ç›¸å…³çš„å‚æ•°å’Œè€—æ—¶ç­‰ç­‰ã€‚ä¿®æ”¹hello_tokené¡¹ç›®å®ç°ï¼š
ç›®å½•ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” hello_interceptor/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” client/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // æœåŠ¡ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” keys/             // è¯ä¹¦ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.key
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server.pem
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” proto/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.proto   // protoæè¿°æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.pb.go   // protoç¼–è¯‘åæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ä»£ç 
æœåŠ¡ç«¯interceptorï¼š hello_interceptor/server/main.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/codes&amp;#34;&lt;/span&gt;       // grpc å“åº”çŠ¶æ€ç 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/metadata&amp;#34;&lt;/span&gt; // grpc metadataåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å®šä¹‰helloServiceå¹¶å®ç°çº¦å®šçš„æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type helloService struct&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// HelloService HelloæœåŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;var HelloService &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; helloService&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// SayHello å®ç°HelloæœåŠ¡æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;h helloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, in *pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;*pb.HelloResponse, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; new&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;pb.HelloResponse&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    resp.Message &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fmt.Sprintf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello %s.&amp;#34;&lt;/span&gt;, in.Name&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; resp, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; net.Listen&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, Address&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to listen: %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var opts &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;grpc.ServerOption
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewServerTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.key&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to generate credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.Creds&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æ³¨å†Œinterceptor
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.UnaryInterceptor&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;interceptor&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // å®ä¾‹åŒ–grpc Server
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.NewServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts...&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æ³¨å†ŒHelloService
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb.RegisterHelloServer&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;s, HelloService&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Listen on &amp;#34;&lt;/span&gt; + Address + &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; with TLS + Token + Interceptor&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    s.Serve&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;listen&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// auth éªŒè¯Token
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func auth&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; error &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    md, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; metadata.FromContext&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; grpc.Errorf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;codes.Unauthenticated, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;æ— Tokenè®¤è¯ä¿¡æ¯&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appid  string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appkey string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; val, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; md&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appid&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; val&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; val, ok :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; md&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appkey&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;; ok &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        appkey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; val&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;0&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; appid !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;101010&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; appkey !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;i am key&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; grpc.Errorf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;codes.Unauthenticated, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Tokenè®¤è¯ä¿¡æ¯æ— æ•ˆ: appid=%s, appkey=%s&amp;#34;&lt;/span&gt;, appid, appkey&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// interceptor æ‹¦æˆªå™¨
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func interceptor&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, req interface&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;interface&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; auth&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; nil, err
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // ç»§ç»­å¤„ç†è¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; handler&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx, req&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ç°å®¢æˆ·ç«¯interceptorï¼šhello_intercepror/client/main.go&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;package main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;import &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pb &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt; // å¼•å…¥protoåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/credentials&amp;#34;&lt;/span&gt; // å¼•å…¥grpcè®¤è¯åŒ…
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;const &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // Address gRPCæœåŠ¡åœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // OpenTLS æ˜¯å¦å¼€å¯TLSè®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    OpenTLS &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// customCredential è‡ªå®šä¹‰è®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;type customCredential struct&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// GetRequestMetadata å®ç°è‡ªå®šä¹‰è®¤è¯æ¥å£
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;c customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; GetRequestMetadata&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, uri ...string&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;map&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;string, error&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; map&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;string&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appid&amp;#34;&lt;/span&gt;:  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;101010&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;appkey&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;i am key&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;, nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// RequireTransportSecurity è‡ªå®šä¹‰è®¤è¯æ˜¯å¦å¼€å¯TLS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;c customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; RequireTransportSecurity&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; bool &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; OpenTLS
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var err error
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    var opts &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;grpc.DialOption
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; OpenTLS &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        // TLSè¿æ¥
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        creds, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; credentials.NewClientTLSFromFile&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;../../keys/server.pem&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;server name&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            grpclog.Fatalf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Failed to create TLS credentials %v&amp;#34;&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithTransportCredentials&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;creds&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithInsecure&lt;span style=&#34;color:#f92672&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æŒ‡å®šè‡ªå®šä¹‰è®¤è¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithPerRPCCredentials&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;new&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;customCredential&lt;span style=&#34;color:#f92672&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // æŒ‡å®šå®¢æˆ·ç«¯interceptor
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    opts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; append&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;opts, grpc.WithUnaryInterceptor&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;interceptor&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    conn, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; grpc.Dial&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Address, opts...&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    defer conn.Close&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // åˆå§‹åŒ–å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    c :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pb.NewHelloClient&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;conn&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    // è°ƒç”¨æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    req :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;amp;pb.HelloRequest&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;Name: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gRPC&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    res, err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; c.SayHello&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;context.Background&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;, req&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; err !&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nil &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        grpclog.Fatalln&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Println&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;res.Message&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// interceptor å®¢æˆ·ç«¯æ‹¦æˆªå™¨
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func interceptor&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx context.Context, method string, req, reply interface&lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, cc *grpc.ClientConn, invoker grpc.UnaryInvoker, opts ...grpc.CallOption&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; error &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    start :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; time.Now&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    err :&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; invoker&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ctx, method, req, reply, cc, opts...&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    grpclog.Printf&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;method=%s req=%v rep=%v duration=%s error=%v\n&amp;#34;&lt;/span&gt;, method, req, reply, time.Since&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;start&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, err&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; err
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;å†…ç½®trace&#34;&gt;å†…ç½®Trace &lt;a href=&#34;#%e5%86%85%e7%bd%aetrace&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;grpcå†…ç½®äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¯·æ±‚è¿½è¸ªï¼ŒåŸºäº&lt;code&gt;golang.org/x/net/trace&lt;/code&gt;åŒ…å®ç°ï¼Œé»˜è®¤æ˜¯å¼€å¯çŠ¶æ€ï¼Œå¯ä»¥æŸ¥çœ‹äº‹ä»¶å’Œè¯·æ±‚æ—¥å¿—ï¼Œå¯¹äºåŸºæœ¬çš„è¯·æ±‚çŠ¶æ€æŸ¥çœ‹è°ƒè¯•ä¹Ÿæ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œä»¥æœåŠ¡ç«¯å¼€å¯trace serverä¸ºä¾‹ï¼Œä¿®æ”¹helloé¡¹ç›®æœåŠ¡ç«¯ä»£ç ï¼š
ç›®å½•ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” hello_trace/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” client/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” server/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” main.go   // æœåŠ¡ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|â€”â€” proto/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    |â€”â€” hello/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.proto   // protoæè¿°æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        |â€”â€” hello.pb.go   // protoç¼–è¯‘åæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹ä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;pb&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;github.com/jergoo/go-grpc-example/proto/hello&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å¼•å…¥ç¼–è¯‘ç”Ÿæˆçš„åŒ…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/context&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;golang.org/x/net/trace&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google.golang.org/grpc/grpclog&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Address gRPCæœåŠ¡åœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Address&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:50052&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// å®šä¹‰helloServiceå¹¶å®ç°çº¦å®šçš„æ¥å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;helloService&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// HelloService HelloæœåŠ¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;HelloService&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;helloService&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// SayHello å®ç°HelloæœåŠ¡æ¥å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;h&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;helloService&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;SayHello&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ctx&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;context&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Context&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;pb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HelloRequest&lt;/span&gt;) (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;pb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HelloResponse&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;error&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;resp&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; new(&lt;span style=&#34;color:#a6e22e&#34;&gt;pb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HelloResponse&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;resp&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Message&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sprintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello %s.&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;in&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Name&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;resp&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;listen&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Listen&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;Address&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;grpclog&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatalf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;failed to listen: %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å®ä¾‹åŒ–grpc Server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;grpc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewServer&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// æ³¨å†ŒHelloService&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;pb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RegisterHelloServer&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;HelloService&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å¼€å¯trace&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;startTrace&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;grpclog&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Listen on &amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Address&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Serve&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;listen&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;startTrace&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;trace&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;AuthRequest&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;req&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Request&lt;/span&gt;) (&lt;span style=&#34;color:#66d9ef&#34;&gt;any&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;sensitive&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:50051&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;grpclog&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Trace listen on 50051&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬å¼€å¯ä¸€ä¸ªhttpæœåŠ¡ç›‘å¬50051ç«¯å£ï¼Œç”¨æ¥æŸ¥çœ‹grpcè¯·æ±‚çš„traceä¿¡æ¯&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç«¯äº‹ä»¶æŸ¥çœ‹&#34;&gt;æœåŠ¡ç«¯äº‹ä»¶æŸ¥çœ‹ &lt;a href=&#34;#%e6%9c%8d%e5%8a%a1%e7%ab%af%e4%ba%8b%e4%bb%b6%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è®¿é—®ï¼šlocalhost:50051/debug/eventsï¼Œç»“æœå¦‚å›¾ï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/grpc_trace_events.jpg&#34; alt=&#34;grpc-trace-events&#34;&gt;
å¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯æ³¨å†Œçš„æœåŠ¡å’ŒæœåŠ¡æ­£å¸¸å¯åŠ¨çš„äº‹ä»¶ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¯·æ±‚æ—¥å¿—ä¿¡æ¯æŸ¥çœ‹&#34;&gt;è¯·æ±‚æ—¥å¿—ä¿¡æ¯æŸ¥çœ‹ &lt;a href=&#34;#%e8%af%b7%e6%b1%82%e6%97%a5%e5%bf%97%e4%bf%a1%e6%81%af%e6%9f%a5%e7%9c%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è®¿é—®ï¼šlocalhost:50051/debug/requestsï¼Œç»“æœå¦‚å›¾ï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/grpc_trace_requests.jpg&#34; alt=&#34;grpc-trace-events&#34;&gt;
è¿™é‡Œå¯ä»¥æ˜¾ç¤ºæœ€è¿‘çš„è¯·æ±‚çŠ¶æ€ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„æœåŠ¡ã€å‚æ•°ã€è€—æ—¶ã€å“åº”ï¼Œå¯¹äºç®€å•çš„çŠ¶æ€æŸ¥çœ‹è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œé»˜è®¤å€¼æ˜¾ç¤ºæœ€è¿‘10æ¡è®°å½•ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Goçš„deferæ€»ç»“</title>
      <link>https://abnerxc.github.io/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/</link>
      <pubDate>Fri, 15 Mar 2024 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;h1 id=&#34;ä¸€deferæ‰§è¡Œé¡ºåº&#34;&gt;ä¸€ã€deferæ‰§è¡Œé¡ºåº &lt;a href=&#34;#%e4%b8%80defer%e6%89%a7%e8%a1%8c%e9%a1%ba%e5%ba%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¤šä¸ªdeferå‡ºç°çš„æ—¶å€™ï¼Œ&lt;strong&gt;å®ƒæ˜¯ä¸€ä¸ªâ€œæ ˆâ€çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯å…ˆè¿›åå‡º&lt;/strong&gt;ã€‚ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå†™åœ¨å‰é¢çš„deferä¼šæ¯”å†™åœ¨åé¢çš„deferè°ƒç”¨çš„æ™šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func1&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func2&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func3&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func1&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func2&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;B&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;func3&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-defer1.jpeg&#34; alt=&#34;go-defer&#34;&gt;
è¾“å‡ºç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;C
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;B
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;A
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;äºŒdeferä¸returnè°å…ˆè°å&#34;&gt;äºŒã€deferä¸returnè°å…ˆè°å &lt;a href=&#34;#%e4%ba%8cdefer%e4%b8%8ereturn%e8%b0%81%e5%85%88%e8%b0%81%e5%90%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;deferFunc&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer func called&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;returnFunc&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;return func called&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;returnAndDefer&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;deferFunc&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;returnFunc&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;returnAndDefer&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œç»“æœä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;return func called
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer func called
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“è®ºä¸ºï¼šreturnä¹‹åçš„è¯­å¥å…ˆæ‰§è¡Œï¼Œdeferåçš„è¯­å¥åæ‰§è¡Œ&lt;/p&gt;
&lt;h1 id=&#34;ä¸‰å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ–&#34;&gt;ä¸‰ã€å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ– &lt;a href=&#34;#%e4%b8%89%e5%87%bd%e6%95%b0%e7%9a%84%e8%bf%94%e5%9b%9e%e5%80%bc%e5%88%9d%e5%a7%8b%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DeferFunc1&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) (&lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;t = &amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;DeferFunc11&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// output t=0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯æ˜ï¼Œåªè¦å£°æ˜å‡½æ•°çš„è¿”å›å€¼å˜é‡åç§°ï¼Œå°±ä¼šåœ¨å‡½æ•°åˆå§‹åŒ–æ—¶å€™ä¸ºä¹‹èµ‹å€¼ä¸º0ï¼Œè€Œä¸”åœ¨å‡½æ•°ä½“ä½œç”¨åŸŸå¯è§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å››æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ&#34;&gt;å››ã€æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ &lt;a href=&#34;#%e5%9b%9b%e6%9c%89%e5%90%8d%e5%87%bd%e6%95%b0%e8%bf%94%e5%9b%9e%e5%80%bc%e9%81%87%e8%a7%81defer%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;returnButDefer&lt;/span&gt;() (&lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {  &lt;span style=&#34;color:#75715e&#34;&gt;//tåˆå§‹åŒ–0ï¼Œ å¹¶ä¸”ä½œç”¨åŸŸä¸ºè¯¥å‡½æ•°å…¨åŸŸ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;returnButDefer&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// output t=10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥returnButDefer()æœ¬åº”çš„è¿”å›å€¼æ˜¯1ï¼Œä½†æ˜¯åœ¨returnä¹‹åï¼Œåˆè¢«deferçš„åŒ¿åfuncå‡½æ•°æ‰§è¡Œï¼Œæ‰€ä»¥t=t*10è¢«æ‰§è¡Œï¼Œæœ€åreturnButDefer()è¿”å›ç»™ä¸Šå±‚main()çš„ç»“æœä¸º10&lt;/p&gt;
&lt;h1 id=&#34;äº”deferé‡è§panic&#34;&gt;äº”ã€deferé‡è§panic &lt;a href=&#34;#%e4%ba%94defer%e9%81%87%e8%a7%81panic&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æ ¹æ®çŸ¥è¯†ç‚¹2ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œdeferé‡è§returnæƒ…å†µå¦‚ä¸‹ï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/go-defer2.jpeg&#34; alt=&#34;go-defer2&#34;&gt;
é‚£ä¹ˆï¼Œé‡åˆ°panicæ—¶ï¼Œéå†æœ¬åç¨‹çš„deferé“¾è¡¨ï¼Œå¹¶æ‰§è¡Œdeferã€‚åœ¨æ‰§è¡Œdeferè¿‡ç¨‹ä¸­:é‡åˆ°recoveråˆ™åœæ­¢panicï¼Œè¿”å›recoverå¤„ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰é‡åˆ°recoverï¼Œéå†å®Œæœ¬åç¨‹çš„deferé“¾è¡¨åï¼Œå‘stderræŠ›å‡ºpanicä¿¡æ¯ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-defer3.jpeg&#34; alt=&#34;go-defer3&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;deferé‡è§panicä½†æ˜¯å¹¶ä¸æ•è·å¼‚å¸¸çš„æƒ…å†µ&#34;&gt;deferé‡è§panicï¼Œä½†æ˜¯å¹¶ä¸æ•è·å¼‚å¸¸çš„æƒ…å†µ &lt;a href=&#34;#defer%e9%81%87%e8%a7%81panic%e4%bd%86%e6%98%af%e5%b9%b6%e4%b8%8d%e6%8d%95%e8%8e%b7%e5%bc%82%e5%b8%b8%e7%9a%84%e6%83%85%e5%86%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;defer_call&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main æ­£å¸¸ç»“æŸ&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;defer_call&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹å‰1&amp;#34;&lt;/span&gt;) }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹å‰2&amp;#34;&lt;/span&gt;) }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å¼‚å¸¸å†…å®¹&amp;#34;&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;//è§¦å‘deferå‡ºæ ˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹åï¼Œæ°¸è¿œæ‰§è¡Œä¸åˆ°&amp;#34;&lt;/span&gt;) }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// output
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer: panic ä¹‹å‰2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer: panic ä¹‹å‰1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;panic: å¼‚å¸¸å†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//... å¼‚å¸¸å †æ ˆä¿¡æ¯
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;deferé‡è§panicå¹¶æ•è·å¼‚å¸¸&#34;&gt;deferé‡è§panicï¼Œå¹¶æ•è·å¼‚å¸¸ &lt;a href=&#34;#defer%e9%81%87%e8%a7%81panic%e5%b9%b6%e6%8d%95%e8%8e%b7%e5%bc%82%e5%b8%b8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;defer_call&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main æ­£å¸¸ç»“æŸ&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;defer_call&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹å‰1, æ•è·å¼‚å¸¸&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; recover(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹å‰2, ä¸æ•è·&amp;#34;&lt;/span&gt;) }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å¼‚å¸¸å†…å®¹&amp;#34;&lt;/span&gt;)  &lt;span style=&#34;color:#75715e&#34;&gt;//è§¦å‘deferå‡ºæ ˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer: panic ä¹‹å, æ°¸è¿œæ‰§è¡Œä¸åˆ°&amp;#34;&lt;/span&gt;) }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer: panic ä¹‹å‰2, ä¸æ•è·
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer: panic ä¹‹å‰1, æ•è·å¼‚å¸¸
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;å¼‚å¸¸å†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;main æ­£å¸¸ç»“æŸ
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;defer æœ€å¤§çš„åŠŸèƒ½æ˜¯ panic åä¾ç„¶æœ‰æ•ˆ
æ‰€ä»¥deferå¯ä»¥ä¿è¯ä½ çš„ä¸€äº›èµ„æºä¸€å®šä¼šè¢«å…³é—­ï¼Œä»è€Œé¿å…ä¸€äº›å¼‚å¸¸å‡ºç°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…­deferä¸­åŒ…å«panic&#34;&gt;å…­ã€deferä¸­åŒ…å«panic &lt;a href=&#34;#%e5%85%addefer%e4%b8%ad%e5%8c%85%e5%90%abpanic&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;()  {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; recover(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fatal&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;defer panic&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;panic&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;defer panic
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ†æ
&lt;strong&gt;panicä»…æœ‰æœ€åä¸€ä¸ªå¯ä»¥è¢«revoveræ•è·ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è§¦å‘&lt;code&gt;panic(&amp;quot;panic&amp;quot;)&lt;/code&gt;ådeferé¡ºåºå‡ºæ ˆæ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„deferä¸­ ä¼šæœ‰panic(&amp;ldquo;defer panic&amp;rdquo;)å¼‚å¸¸è¯­å¥ï¼Œè¿™ä¸ªå¼‚å¸¸å°†ä¼šè¦†ç›–æ‰mainä¸­çš„å¼‚å¸¸panic(&amp;ldquo;panic&amp;rdquo;)ï¼Œæœ€åè¿™ä¸ªå¼‚å¸¸è¢«ç¬¬äºŒä¸ªæ‰§è¡Œçš„deferæ•è·åˆ°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸ƒdeferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•°&#34;&gt;ä¸ƒã€deferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•° &lt;a href=&#34;#%e4%b8%83defer%e4%b8%8b%e7%9a%84%e5%87%bd%e6%95%b0%e5%8f%82%e6%95%b0%e5%8c%85%e5%90%ab%e5%ad%90%e5%87%bd%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;function&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœ:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;3
4
2
1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åˆ†æï¼š
è¿™é‡Œï¼Œæœ‰4ä¸ªå‡½æ•°ï¼Œä»–ä»¬çš„indexåºå·åˆ†åˆ«ä¸º1ï¼Œ2ï¼Œ3ï¼Œ4ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆè¿™4ä¸ªå‡½æ•°çš„å…ˆåæ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œé¢æœ‰ä¸¤ä¸ªdeferï¼Œ æ‰€ä»¥deferä¸€å…±ä¼šå‹æ ˆä¸¤æ¬¡ï¼Œå…ˆè¿›æ ˆ1ï¼Œåè¿›æ ˆ2ã€‚ é‚£ä¹ˆåœ¨å‹æ ˆfunction1çš„æ—¶å€™ï¼Œéœ€è¦è¿åŒå‡½æ•°åœ°å€ã€å‡½æ•°å½¢å‚ä¸€åŒè¿›æ ˆï¼Œé‚£ä¹ˆä¸ºäº†å¾—åˆ°function1çš„ç¬¬äºŒä¸ªå‚æ•°çš„ç»“æœï¼Œæ‰€ä»¥å°±éœ€è¦å…ˆæ‰§è¡Œfunction3å°†ç¬¬äºŒä¸ªå‚æ•°ç®—å‡ºï¼Œé‚£ä¹ˆfunction3å°±è¢«ç¬¬ä¸€ä¸ªæ‰§è¡Œã€‚åŒç†å‹æ ˆfunction2ï¼Œå°±éœ€è¦æ‰§è¡Œfunction4ç®—å‡ºfunction2ç¬¬äºŒä¸ªå‚æ•°çš„å€¼ã€‚ç„¶åå‡½æ•°ç»“æŸï¼Œå…ˆå‡ºæ ˆfuction2ã€å†å‡ºæ ˆfunction1.&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥é¡ºåºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;deferå‹æ ˆfunction1ï¼Œå‹æ ˆå‡½æ•°åœ°å€ã€å½¢å‚1ã€å½¢å‚2(è°ƒç”¨function3) &amp;ndash;&amp;gt; æ‰“å°3&lt;/li&gt;
&lt;li&gt;deferå‹æ ˆfunction2ï¼Œå‹æ ˆå‡½æ•°åœ°å€ã€å½¢å‚1ã€å½¢å‚2(è°ƒç”¨function4) &amp;ndash;&amp;gt; æ‰“å°4&lt;/li&gt;
&lt;li&gt;deferå‡ºæ ˆfunction2, è°ƒç”¨function2 &amp;ndash;&amp;gt; æ‰“å°2&lt;/li&gt;
&lt;li&gt;deferå‡ºæ ˆfunction1, è°ƒç”¨function1&amp;ndash;&amp;gt; æ‰“å°1&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å…«deferä¸­çš„å‘&#34;&gt;å…«ã€deferä¸­çš„å‘ &lt;a href=&#34;#%e5%85%abdefer%e4%b8%ad%e7%9a%84%e5%9d%91&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;defer-nilå‡½æ•°&#34;&gt;defer nilå‡½æ•° &lt;a href=&#34;#defer-nil%e5%87%bd%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() = &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runs&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;runs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;panic&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;runtime&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;error&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;invalid&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;memory&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;address&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;or&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;pointer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dereference&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åä¸º func çš„å‡½æ•°ä¸€ç›´è¿è¡Œè‡³ç»“æŸï¼Œç„¶å defer å‡½æ•°ä¼šè¢«æ‰§è¡Œä¸”ä¼šå› ä¸ºå€¼ä¸º nil è€Œäº§ç”Ÿ panic å¼‚å¸¸ã€‚ç„¶è€Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œrun() çš„å£°æ˜æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºåœ¨å¤–å›´å‡½æ•°è¿è¡Œå®Œæˆåå®ƒæ‰ä¼šè¢«è°ƒç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¾ªç¯ä¸­ä½¿ç”¨defer&#34;&gt;å¾ªç¯ä¸­ä½¿ç”¨defer &lt;a href=&#34;#%e5%be%aa%e7%8e%af%e4%b8%ad%e4%bd%bf%e7%94%a8defer&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;æ…é‡åœ¨å¾ªç¯ä¸­ä½¿ç”¨defer&lt;/code&gt;ï¼Œå› ä¸ºç»“æœå‡ºäººæ„æ–™&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func demo(){
	for{
		row,err:=db.Query(&amp;#34;select .....&amp;#34;)
		if err!=nil{
			...
		}
		defer row.close()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œdefer row.Close() åœ¨å¾ªç¯ä¸­çš„å»¶è¿Ÿå‡½æ•°ä¼šåœ¨å‡½æ•°ç»“æŸè¿‡åè¿è¡Œï¼Œè€Œä¸æ˜¯æ¯æ¬¡ for å¾ªç¯ç»“æŸä¹‹åã€‚è¿™äº›å»¶è¿Ÿå‡½æ•°ä¼šä¸åœåœ°å †ç§¯åˆ°å»¶è¿Ÿè°ƒç”¨æ ˆä¸­ï¼Œæœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆ1ï¼šä¸ä½¿ç”¨defer&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;demo&lt;/span&gt;(){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;row&lt;/span&gt;,&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Query&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;select .....&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;row&lt;/span&gt;.close()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§£å†³æ–¹æ¡ˆ2ï¼šç§»äº¤ç»™å‡½æ•°
è¿™æ ·æ¯æ¬¡åŒ¿åå‡½æ•°æ‰§è¡Œå®Œï¼Œä¼šæ‰§è¡Œdefer&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;demo&lt;/span&gt;(){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;row&lt;/span&gt;,&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Query&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;select .....&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;row&lt;/span&gt;.close()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å»¶è¿Ÿè°ƒç”¨å«æœ‰é—­åŒ…çš„å‡½æ•°&#34;&gt;å»¶è¿Ÿè°ƒç”¨å«æœ‰é—­åŒ…çš„å‡½æ•° &lt;a href=&#34;#%e5%bb%b6%e8%bf%9f%e8%b0%83%e7%94%a8%e5%90%ab%e6%9c%89%e9%97%ad%e5%8c%85%e7%9a%84%e5%87%bd%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;database&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;database&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;connect&lt;/span&gt;() (&lt;span style=&#34;color:#a6e22e&#34;&gt;disconnect&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;connect&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;disconnect&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//è¿è¡Œ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;database&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;connect&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;query db...&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;query&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;connect&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€ç»ˆ disconnect å¹¶æ²¡æœ‰è¾“å‡ºï¼Œæœ€ååªæœ‰ connect ï¼Œè¿™æ˜¯ä¸€ä¸ª bugï¼Œæœ€ç»ˆçš„æƒ…å†µæ˜¯ connect() æ‰§è¡Œç»“æŸåï¼Œå…¶æ‰§è¡ŒåŸŸå¾—ä»¥è¢«ä¿å­˜èµ·æ¥ï¼Œä½†å†…éƒ¨çš„é—­åŒ…å¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;database&lt;/span&gt;{}  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;close&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;connect&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; close()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;query db...&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åœ¨æ‰§è¡Œå—ä¸­ä½¿ç”¨-defer&#34;&gt;åœ¨æ‰§è¡Œå—ä¸­ä½¿ç”¨ defer &lt;a href=&#34;#%e5%9c%a8%e6%89%a7%e8%a1%8c%e5%9d%97%e4%b8%ad%e4%bd%bf%e7%94%a8-defer&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æƒ³è¦åœ¨æ‰§è¡Œå—æ‰§è¡Œç»“æŸåæ‰§è¡Œåœ¨å—å†…å»¶è¿Ÿè°ƒç”¨çš„å‡½æ•°ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ï¼Œå®ƒä»¬åªä¼šåœ¨å—æ‰€å±çš„å‡½æ•°æ‰§è¡Œç»“æŸåæ‰è¢«æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µé€‚ç”¨äºæ‰€æœ‰çš„ä»£ç å—é™¤äº†ä¸Šæ–‡çš„å‡½æ•°å—ä¾‹å¦‚ï¼Œforï¼Œswitch ç­‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;block: defer runs&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;block: ends&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main: ends&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;block&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;ends&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;ends&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;block&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;runs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§£å†³æ–¹æ¡ˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;func: defer runs&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;func: ends&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;main: ends&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>åŸºäºScratchåˆ›å»ºæœ€å°ä¸”å®‰å…¨çš„golang dockeré•œåƒ</title>
      <link>https://abnerxc.github.io/go/%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83/</link>
      <pubDate>Mon, 12 Sep 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83/</guid>
      <description>&lt;h1 id=&#34;golangæ‰“åŒ…é•œåƒå¯¹æ¯”&#34;&gt;golangæ‰“åŒ…é•œåƒå¯¹æ¯” &lt;a href=&#34;#golang%e6%89%93%e5%8c%85%e9%95%9c%e5%83%8f%e5%af%b9%e6%af%94&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»dockerå®˜æ–¹ä¸‹è½½äº†é•œåƒä»¥åï¼Œå‘ç°ä¸€ä¸ªè¿è¡Œgoçš„ç¯å¢ƒéœ€è¦779M,æˆ‘å¾—é¡¹ç›®æ‰3~4Mï¼Œè¿™æ˜¯ä¸å¯ä»¥æ¥å—çš„&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ docker image list
golang    latest       1c1309ff8e0d        10 days ago         779MB
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å°±ç®—ä½¿ç”¨alpineé•œåƒä¹Ÿæœ‰269M&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ docker image list
golang     alpine      bbab7aea1231        7 weeks ago         269MB
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;äºæ˜¯æ‰“ç®—è‡ªå·±æ„å»ºgolangè¿è¡Œçš„æœ€å°é•œåƒ.&lt;/p&gt;
&lt;h1 id=&#34;dockerçš„multi-stage-builds&#34;&gt;dockerçš„Multi-stage builds &lt;a href=&#34;#docker%e7%9a%84multi-stage-builds&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¤šé˜¶æ®µæ„å»ºæ˜¯éœ€è¦Docker 17.05æˆ–æ›´é«˜ç‰ˆæœ¬çš„æ–°åŠŸèƒ½ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°docker scratch imageï¼ŒZero Bytes Imageã€‚éå¸¸é€‚åˆåµŒå…¥æˆ‘ä»¬çš„é™æ€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆä¸Šä»£ç ,ä¾‹å­è¯´æ˜&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;FROM        golang:alpine AS builder
MAINTAINER  Chen Xu &amp;lt;abner510@126.com&amp;gt;
RUN         apk update &amp;amp;&amp;amp; apk add --no-cache git ca-certificates tzdata &amp;amp;&amp;amp; update-ca-certificates &amp;amp;&amp;amp; adduser -D -g &amp;#39;&amp;#39; appuser
ENV         GOPROXY https://mirrors.aliyun.com/goproxy/
ENV         GO111MODULE on
WORKDIR     /go/cache
ADD         go.mod .
ADD         go.sum .
RUN         go mod download
WORKDIR     /go/src/ginx
ADD        . /go/src/ginx
RUN         CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -installsuffix cgo -ldflags=&amp;#34;-w -s&amp;#34; -o server

#å®¹å™¨æ„å»º
FROM        scratch AS prod
COPY        --from=builder /etc/passwd /etc/passwd
COPY        --from=builder /usr/share/zoneinfo /usr/share/zoneinfo
COPY        --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/
COPY        --from=builder /go/src/ginx/config /app/config
COPY        --from=builder /go/src/ginx/server /app
USER        appuser
EXPOSE      9000
CMD         [&amp;#34;/app/server&amp;#34;, &amp;#34;-e=prod&amp;#34;]
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ä»£ç ç¤ºä¾‹è¯´æ˜&#34;&gt;ä»£ç ç¤ºä¾‹è¯´æ˜ &lt;a href=&#34;#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b%e8%af%b4%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;æ·»åŠ sslè¯ä¹¦æ”¯æŒhttpså’Œæ—¶åŒº&#34;&gt;æ·»åŠ SSLè¯ä¹¦æ”¯æŒHTTPSå’Œæ—¶åŒº &lt;a href=&#34;#%e6%b7%bb%e5%8a%a0ssl%e8%af%81%e4%b9%a6%e6%94%af%e6%8c%81https%e5%92%8c%e6%97%b6%e5%8c%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apk add --no-cache git ca-certificates tzdata &amp;amp;&amp;amp; update-ca-certificates
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;æ·»åŠ è¿è¡Œgolangçš„ç”¨æˆ·&#34;&gt;æ·»åŠ è¿è¡Œgolangçš„ç”¨æˆ· &lt;a href=&#34;#%e6%b7%bb%e5%8a%a0%e8%bf%90%e8%a1%8cgolang%e7%9a%84%e7%94%a8%e6%88%b7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;adduser -D -g &amp;#39;&amp;#39; appuser
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;go-modæ¨¡å¼é¡¹ç›®åŒ…ç®¡ç†åŠ å¿«æ„å»ºé€Ÿåº¦&#34;&gt;go modæ¨¡å¼é¡¹ç›®åŒ…ç®¡ç†ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦ &lt;a href=&#34;#go-mod%e6%a8%a1%e5%bc%8f%e9%a1%b9%e7%9b%ae%e5%8c%85%e7%ae%a1%e7%90%86%e5%8a%a0%e5%bf%ab%e6%9e%84%e5%bb%ba%e9%80%9f%e5%ba%a6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ENV         GOPROXY https://goproxy.io   #è®¾ç½®ä»£ç†ï¼Œå›½å†…çš„å¢™ä½ æ‡‚çš„
ENV         GO111MODULE on  #å¼€å¯go mod æ¨¡å¼  ï¼Œè€ç‰ˆæœ¬GO111MODULE=auto é»˜è®¤æ˜¯è‡ªåŠ¨
WORKDIR     /go/cache  # è®¾ç½®åŒ…çš„ä¸‹è½½ç›®å½•
ADD         go.mod .
ADD         go.sum .
RUN         go mod download
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-alilog.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;cgoç¼–è¯‘ä½¿ç”¨&#34;&gt;CGOç¼–è¯‘ä½¿ç”¨ &lt;a href=&#34;#cgo%e7%bc%96%e8%af%91%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ç”±äºscratchæ˜¯ç©ºé•œåƒï¼Œ&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -installsuffix cgo -ldflags=&amp;#34;-w -s&amp;#34; -o server
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CGO_ENABLED=0&lt;/code&gt; ï¼ŒCGO_ENABLED æ˜¯å› ä¸º äº¤å‰ç¼–è¯‘ä¸æ”¯æŒ CGOï¼Œæˆ‘ä»¬è¿™é‡Œç¦ç”¨å®ƒ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-a -installsuffix cgo&lt;/code&gt; , &lt;code&gt;-a&lt;/code&gt;:å¼ºåˆ¶é‡æ–°ç¼–è¯‘ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸åˆ©ç”¨ç¼“å­˜æˆ–å·²ç¼–è¯‘å¥½çš„éƒ¨åˆ†æ–‡ä»¶ï¼Œç›´æ¥æ‰€æœ‰åŒ…éƒ½æ˜¯æœ€æ–°çš„ä»£ç é‡æ–°ç¼–è¯‘å’Œå…³è”; &lt;code&gt;installsuffix&lt;/code&gt;:åœ¨è½¯ä»¶åŒ…å®‰è£…çš„ç›®å½•ä¸­å¢åŠ åç¼€æ ‡è¯†ï¼Œä»¥ä¿æŒè¾“å‡ºä¸é»˜è®¤ç‰ˆæœ¬åˆ†å¼€&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åˆ¶ä½œgolangè¿è¡Œçš„å®¹å™¨&#34;&gt;åˆ¶ä½œgolangè¿è¡Œçš„å®¹å™¨ &lt;a href=&#34;#%e5%88%b6%e4%bd%9cgolang%e8%bf%90%e8%a1%8c%e7%9a%84%e5%ae%b9%e5%99%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;FROM        scratch AS prod #é•œåƒç‰ˆæœ¬
COPY        --from=builder /etc/passwd /etc/passwd  #è¿™é‡Œéœ€è¦ä½¿ç”¨appuerè´¦å·ä¿¡æ¯
COPY        --from=builder /usr/share/zoneinfo /usr/share/zoneinfo #æ—¶åŒº
COPY        --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ #SSLè¯ä¹¦æ–‡ä»¶
COPY        --from=builder /go/src/ginx/config /app/config #åº”ç”¨é…ç½®æ–‡ä»¶
COPY        --from=builder /go/src/ginx/server /app #åº”ç”¨äºŒè¿›åˆ¶æ–‡ä»¶
USER        appuser #è¿è¡Œç”¨æˆ·
EXPOSE      9000 #æš´éœ²ç«¯å£
CMD         [&amp;#34;/app/server&amp;#34;, &amp;#34;-e=prod&amp;#34;] #è¿è¡Œåº”ç”¨ï¼Œä¼ å…¥è¿è¡Œå‚æ•°
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;é˜¿é‡Œäº‘åŠ é€Ÿç¿»å¢™é€Ÿåº¦&#34;&gt;é˜¿é‡Œäº‘åŠ é€Ÿç¿»å¢™é€Ÿåº¦ &lt;a href=&#34;#%e9%98%bf%e9%87%8c%e4%ba%91%e5%8a%a0%e9%80%9f%e7%bf%bb%e5%a2%99%e9%80%9f%e5%ba%a6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;1ã€åˆ›å»ºé•œåƒä»“åº“
&lt;img src=&#34;https://abnerxc.github.io/img/go-aliset1.jpeg&#34; alt=&#34;&#34;&gt;
2ã€é€‰æ‹©ä»“åº“&lt;code&gt;ç®¡ç†&lt;/code&gt;ï¼Œè¿›è¡Œé…ç½®ä»“åº“
3ã€é€‰æ‹©gitä»“åº“ç‰ˆæœ¬ï¼Œè¿™é‡Œæœ¬äººæ˜¯æ”¾åœ¨githubä¸Šï¼Œæ‰€ä»¥é€‰æ‹©githubï¼Œè¿›è¡Œæˆæƒï¼Œé€‰æ‹©è‡ªå·±çš„ä»“åº“å’Œé¡¹ç›®ï¼Œé…ç½®å¦‚ä¸‹å…·ä½“dockerfileæ–‡ä»¶æ ¹æ®è‡ªå·±ä»“åº“è·¯å¾„é…ç½®
&lt;img src=&#34;https://abnerxc.github.io/img/go-aliset2.jpeg&#34; alt=&#34;&#34;&gt;
4ã€é€‰æ‹©æ„å»ºå³å¯&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Go-é”™è¯¯(error)å¤„ç†æ–¹æ¡ˆ</title>
      <link>https://abnerxc.github.io/go/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88/</link>
      <pubDate>Thu, 21 Jul 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88/</guid>
      <description>&lt;h1 id=&#34;erroræ¥å£&#34;&gt;erroræ¥å£ &lt;a href=&#34;#error%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;code&gt;error&lt;/code&gt;å…¶å®æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå†…ç½®çš„ï¼Œçœ‹ä¸‹ä»–çš„å®šä¹‰&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// The error built-in interface type is the conventional interface for
// representing an error condition, with the nil value representing no error.
type error interface {
	Error() string
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å®ƒåªæœ‰ä¸€ä¸ªæ–¹æ³• &lt;code&gt;Error&lt;/code&gt;ï¼Œåªè¦å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯å®ç°äº†&lt;code&gt;error&lt;/code&gt;ã€‚ç°åœ¨æˆ‘ä»¬è‡ªå·±å®šä¹‰ä¸€ä¸ªé”™è¯¯è¯•è¯•ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type fileError struct {
}

func (fe *fileError) Error() string {
	return &amp;#34;æ–‡ä»¶é”™è¯¯&amp;#34;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;è‡ªå®šä¹‰-error&#34;&gt;è‡ªå®šä¹‰ error &lt;a href=&#34;#%e8%87%aa%e5%ae%9a%e4%b9%89-error&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è‡ªå®šä¹‰äº†ä¸€ä¸ª&lt;code&gt;fileError&lt;/code&gt;ç±»å‹ï¼Œå®ç°äº†&lt;code&gt;error&lt;/code&gt;æ¥å£ã€‚ç°åœ¨æµ‹è¯•ä¸‹çœ‹çœ‹æ•ˆæœã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	conent, err := openFile()
	if err != nil {
		fmt.Println(err)
	} else {
		fmt.Println(string(conent))
	}
}

//åªæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯
func openFile() ([]byte, error) {
	return nil, &amp;amp;fileError{}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿è¡Œæ¨¡æ‹Ÿçš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°&lt;code&gt;æ–‡ä»¶é”™è¯¯&lt;/code&gt;çš„é€šçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½é‡åˆ°å¾ˆå¤šé”™è¯¯ï¼Œä»–ä»¬çš„åŒºåˆ«æ˜¯é”™è¯¯ä¿¡æ¯ä¸ä¸€æ ·ï¼Œä¸€ç§åšæ³•æ˜¯æ¯ç§é”™è¯¯éƒ½ç±»ä¼¼ä¸Šé¢ä¸€æ ·å®šä¹‰ä¸€ä¸ªé”™è¯¯ç±»å‹ï¼Œä½†æ˜¯è¿™æ ·å¤ªéº»çƒ¦äº†ã€‚æˆ‘ä»¬å‘ç°&lt;code&gt;Error&lt;/code&gt;è¿”å›çš„å…¶å®æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸‹ï¼Œè®©è¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥è®¾ç½®å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type fileError struct {
	s string
}

func (fe *fileError) Error() string {
	return fe.s
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ ·æ”¹é€ åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å£°æ˜&lt;code&gt;fileError&lt;/code&gt;çš„æ—¶å€™ï¼Œè®¾ç½®å¥½è¦æç¤ºçš„é”™è¯¯æ–‡å­—ï¼Œå°±å¯ä»¥æ»¡è¶³æˆ‘ä»¬ä¸åŒçš„éœ€è¦äº†ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//åªæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯
func openFile() ([]byte, error) {
	return nil, &amp;amp;fileError{&amp;#34;æ–‡ä»¶é”™è¯¯ï¼Œè‡ªå®šä¹‰&amp;#34;}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¿®æ”¹fileErrorçš„åå­—ï¼Œå†åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œä¾¿äºæˆ‘ä»¬åˆ›å»ºä¸åŒçš„é”™è¯¯ç±»å‹ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//blog:www.flysnow.org
//wechat:flysnow_org
func New(text string) error {
	return &amp;amp;errorString{text}
}

type errorString struct {
	s string
}

func (e *errorString) Error() string {
	return e.s
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥é€šè¿‡&lt;code&gt;New&lt;/code&gt;å‡½æ•°ï¼Œè¾…åŠ©æˆ‘ä»¬åˆ›å»ºä¸åŒçš„é”™è¯¯äº†ï¼Œè¿™å…¶å®å°±æ˜¯æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„&lt;code&gt;errors.New&lt;/code&gt;å‡½æ•°ï¼Œè¢«æˆ‘ä»¬ä¸€æ­¥æ­¥å‰–ææ¼”åŒ–è€Œæ¥&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ä¸Šé¢çš„æ–¹æ¡ˆåªæ˜¯è§£å†³äº†æ–‡æ¡ˆæç¤ºçš„é”™è¯¯è‡ªå®šä¹‰ï¼Œèƒ½å¦åƒPHPé‚£æ ·æŒ‡å®šåˆ°é”™è¯¯çš„æ–‡ä»¶è¡Œæ•°ï¼Œå…·ä½“æ˜¯å“ªä¸€ä¸ªæ–¹æ³•é”™è¯¯å‘¢&lt;/p&gt;
&lt;h1 id=&#34;æ¨èçš„æ–¹æ¡ˆ&#34;&gt;æ¨èçš„æ–¹æ¡ˆ &lt;a href=&#34;#%e6%8e%a8%e8%8d%90%e7%9a%84%e6%96%b9%e6%a1%88&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å› ä¸ºGoè¯­è¨€æä¾›çš„é”™è¯¯å¤ªç®€å•äº†ï¼Œä»¥è‡³äºç®€å•çš„æˆ‘ä»¬æ— æ³•æ›´å¥½çš„å¤„ç†é—®é¢˜ï¼Œç”šè‡³ä¸èƒ½ä¸ºæˆ‘ä»¬å¤„ç†é”™è¯¯ï¼Œæä¾›æ›´æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ‰€ä»¥è¯ç”Ÿäº†å¾ˆå¤šå¯¹é”™è¯¯å¤„ç†çš„åº“ï¼Œ&lt;code&gt;github.com/pkg/errors&lt;/code&gt;æ˜¯æ¯”è¾ƒç®€æ´çš„ä¸€æ ·ï¼Œå¹¶ä¸”åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå—åˆ°äº†å¤§é‡å¼€å‘è€…çš„æ¬¢è¿ï¼Œä½¿ç”¨è€…å¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;å®ƒçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œå¦‚æœæˆ‘ä»¬è¦æ–°ç”Ÿæˆä¸€ä¸ªé”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;New&lt;/code&gt;å‡½æ•°,ç”Ÿæˆçš„é”™è¯¯ï¼Œè‡ªå¸¦è°ƒç”¨å †æ ˆä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func New(message string) error
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœæœ‰ä¸€ä¸ªç°æˆçš„&lt;code&gt;error&lt;/code&gt;ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä»–è¿›è¡Œå†æ¬¡åŒ…è£…å¤„ç†ï¼Œè¿™æ—¶å€™æœ‰ä¸‰ä¸ªå‡½æ•°å¯ä»¥é€‰æ‹©ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//åªé™„åŠ æ–°çš„ä¿¡æ¯
func WithMessage(err error, message string) error

//åªé™„åŠ è°ƒç”¨å †æ ˆä¿¡æ¯
func WithStack(err error) error

//åŒæ—¶é™„åŠ å †æ ˆå’Œä¿¡æ¯
func Wrap(err error, message string) error
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶å®ä¸Šé¢çš„åŒ…è£…ï¼Œå¾ˆç±»ä¼¼äºJavaçš„å¼‚å¸¸åŒ…è£…ï¼Œè¢«åŒ…è£…çš„errorï¼Œå…¶å®å°±æ˜¯Cause,åœ¨å‰é¢çš„ç« èŠ‚æåˆ°é”™è¯¯çš„æ ¹æœ¬åŸå› ï¼Œå°±æ˜¯è¿™ä¸ªCauseã€‚æ‰€ä»¥è¿™ä¸ªé”™è¯¯å¤„ç†åº“ä¸ºæˆ‘ä»¬æä¾›äº†Causeå‡½æ•°è®©æˆ‘ä»¬å¯ä»¥è·å¾—æœ€æ ¹æœ¬çš„é”™è¯¯åŸå› ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Cause(err error) error {
	type causer interface {
		Cause() error
	}

	for err != nil {
		cause, ok := err.(causer)
		if !ok {
			break
		}
		err = cause.Cause()
	}
	return err
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;for&lt;/code&gt;å¾ªç¯ä¸€ç›´æ‰¾åˆ°æœ€æ ¹æœ¬ï¼ˆæœ€åº•å±‚ï¼‰çš„é‚£ä¸ª&lt;code&gt;error&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šçš„é”™è¯¯æˆ‘ä»¬éƒ½åŒ…è£…å¥½äº†ï¼Œä¹Ÿæ”¶é›†å¥½äº†ï¼Œé‚£ä¹ˆæ€ä¹ˆæŠŠä»–ä»¬é‡Œé¢å­˜å‚¨çš„å †æ ˆã€é”™è¯¯åŸå› ç­‰è¿™äº›ä¿¡æ¯æ‰“å°å‡ºæ¥å‘¢ï¼Ÿå…¶å®ï¼Œè¿™ä¸ªé”™è¯¯å¤„ç†åº“çš„é”™è¯¯ç±»å‹ï¼Œéƒ½å®ç°äº†&lt;code&gt;Formatter&lt;/code&gt;æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡&lt;code&gt;fmt.Printf&lt;/code&gt;å‡½æ•°è¾“å‡ºå¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;%s,%v //åŠŸèƒ½ä¸€æ ·ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œä¸åŒ…å«å †æ ˆ
%q //è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯å¸¦å¼•å·ï¼Œä¸åŒ…å«å †æ ˆ
%+v //è¾“å‡ºé”™è¯¯ä¿¡æ¯å’Œå †æ ˆ
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Goç›¸å¯¹è·¯å¾„é—®é¢˜</title>
      <link>https://abnerxc.github.io/go/%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/</link>
      <pubDate>Tue, 03 May 2022 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/</guid>
      <description>&lt;h2 id=&#34;é—®é¢˜&#34;&gt;é—®é¢˜ &lt;a href=&#34;#%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;1ã€ go run æˆ‘ä»¬ä¸Šç§»ç›®å½•å±‚çº§ï¼Œåˆ° $GOPATH/src ä¸‹ï¼Œæ‰§è¡Œ go run gin-blog/main.go&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[$]# go run gin-blog/main.go
Fail to parse &amp;#39;conf/app.yam&amp;#39;: open conf/app.ini: no such file or directory
exit status 1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2ã€ go buildï¼Œæ‰§è¡Œ ./gin-blog/main&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[$]# ./gin-blog/main
 Fail to parse &amp;#39;conf/app.ini&amp;#39;: open conf/app.ini: no such file or directory
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯• &lt;a href=&#34;#%e6%b5%8b%e8%af%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ç¼–å†™è·å–å½“å‰è·¯å¾„çš„æ–¹æ³•&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import (
	&amp;#34;path/filepath&amp;#34;
	&amp;#34;os&amp;#34;
	&amp;#34;os/exec&amp;#34;
	&amp;#34;string&amp;#34;
)

func GetAppPath() string {
    file, _ := exec.LookPath(os.Args[0])
    path, _ := filepath.Abs(file)
    index := strings.LastIndex(path, string(os.PathSeparator))

    return path[:index]
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰§è¡Œ&lt;code&gt;go run&lt;/code&gt; å¾—åˆ°&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ go run main.go
C:\Users\abnerï¼ˆ~1\AppData\Local\Temp\go-build536365654\b001\exe
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å‰–æ&#34;&gt;å‰–æ &lt;a href=&#34;#%e5%89%96%e6%9e%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬èšç„¦åœ¨ &lt;code&gt;go run&lt;/code&gt; çš„è¾“å‡ºç»“æœä¸Šï¼Œå‘ç°å®ƒæ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶çš„åœ°å€ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨go help runä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;A Go source file is defined to be a file ending in a literal &amp;#34;.go&amp;#34; suffix.
ä¹Ÿå°±æ˜¯ go run æ‰§è¡Œæ—¶ä¼šå°†æ–‡ä»¶æ”¾åˆ° /tmp/go-build... ç›®å½•ä¸‹ï¼Œç¼–è¯‘å¹¶è¿è¡Œ
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å› æ­¤&lt;code&gt;go run main.go&lt;/code&gt;å‡ºç°/tmp/go-build536365654/b001/exeç»“æœä¹Ÿä¸å¥‡æ€ªäº†ï¼Œå› ä¸ºå®ƒå·²ç»è·‘åˆ°ä¸´æ—¶ç›®å½•ä¸‹å»æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶äº†&lt;/p&gt;
&lt;p&gt;è¿™å°±å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³æƒ³ï¼Œä¼šå‡ºç°å“ªäº›é—®é¢˜å‘¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾èµ–ç›¸å¯¹è·¯å¾„çš„æ–‡ä»¶ï¼Œå‡ºç°è·¯å¾„å‡ºé”™çš„é—®é¢˜&lt;/li&gt;
&lt;li&gt;&lt;code&gt;go run&lt;/code&gt; å’Œ &lt;code&gt;go build&lt;/code&gt; ä¸ä¸€æ ·ï¼Œä¸€ä¸ªåˆ°ä¸´æ—¶ç›®å½•ä¸‹æ‰§è¡Œï¼Œä¸€ä¸ªå¯æ‰‹åŠ¨åœ¨ç¼–è¯‘åçš„ç›®å½•ä¸‹æ‰§è¡Œï¼Œè·¯å¾„çš„å¤„ç†æ–¹å¼ä¼šä¸åŒ&lt;/li&gt;
&lt;li&gt;ä¸æ–­go runï¼Œä¸æ–­äº§ç”Ÿæ–°çš„ä¸´æ—¶æ–‡ä»¶
è¿™å…¶å®å°±æ˜¯æ ¹æœ¬åŸå› äº†ï¼Œå› ä¸º go run å’Œ go build çš„ç¼–è¯‘æ–‡ä»¶æ‰§è¡Œè·¯å¾„å¹¶ä¸åŒï¼Œæ‰§è¡Œçš„å±‚çº§ä¹Ÿæœ‰å¯èƒ½ä¸ä¸€æ ·ï¼Œè‡ªç„¶è€Œç„¶å°±å‡ºç°å„ç§è¯»å–ä¸åˆ°çš„å¥‡æ€ªé—®é¢˜äº†&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è§£å†³æ–¹æ¡ˆ&#34;&gt;è§£å†³æ–¹æ¡ˆ &lt;a href=&#34;#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ä¸€ã€è·å–ç¼–è¯‘åå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
1.	å°†é…ç½®æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ä¸GetAppPath()çš„ç»“æœç›¸æ‹¼æ¥ï¼Œå¯è§£å†³go build main.goçš„å¯æ‰§è¡Œæ–‡ä»¶è·¨ç›®å½•æ‰§è¡Œçš„é—®é¢˜ï¼ˆå¦‚ï¼š./src/gin-blog/mainï¼‰
2.	é€šè¿‡ä¼ é€’å‚æ•°æŒ‡å®šç»å¯¹è·¯å¾„ï¼Œå¯è§£å†³go runçš„é—®é¢˜
äºŒã€å¢åŠ os.Getwd()è¿›è¡Œå¤šå±‚åˆ¤æ–­
å‚è§ &lt;a href=&#34;https://github.com/astaxie/beego/blob/develop/config/config.go&#34;&gt;beego&lt;/a&gt; è¯»å– app.conf çš„ä»£ç &lt;/p&gt;
&lt;p&gt;è¯¥å†™æ³•å¯å…¼å®¹ go build å’Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ &lt;code&gt;go run&lt;/code&gt; ï¼Œä½†æ˜¯è‹¥è·¨ç›®å½•æ‰§è¡Œ &lt;code&gt;go run&lt;/code&gt; å°±ä¸è¡Œ
ä¸‰ã€é…ç½®å…¨å±€ç³»ç»Ÿå˜é‡
æˆ‘ä»¬å¯ä»¥é€šè¿‡os.Getenvæ¥è·å–ç³»ç»Ÿå…¨å±€å˜é‡ï¼Œç„¶åä¸ç›¸å¯¹è·¯å¾„è¿›è¡Œæ‹¼æ¥&lt;/p&gt;
&lt;p&gt;1ã€ è®¾ç½®é¡¹ç›®å·¥ä½œåŒº&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®¾ç½®é¡¹ç›®ï¼ˆåº”ç”¨ï¼‰çš„å·¥ä½œè·¯å¾„ï¼Œç„¶åä¸é…ç½®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ç­‰ç›¸å¯¹è·¯å¾„è¿›è¡Œæ‹¼æ¥ï¼Œè¾¾åˆ°ç›¸å¯¹çš„ç»å¯¹è·¯å¾„æ¥ä¿è¯è·¯å¾„ä¸€è‡´&lt;/p&gt;
&lt;p&gt;å‚è§ gogs è¯»å–GOGS_WORK_DIRè¿›è¡Œæ‹¼æ¥çš„ä»£ç &lt;/p&gt;
&lt;p&gt;2ã€ åˆ©ç”¨ç³»ç»Ÿè‡ªå¸¦å˜é‡&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡ç³»ç»Ÿè‡ªå¸¦çš„å…¨å±€å˜é‡ï¼Œä¾‹å¦‚$HOMEç­‰ï¼Œå°†é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨$HOME/confæˆ–/etc/confä¸‹&lt;/p&gt;
&lt;p&gt;è¿™æ ·å­å°±èƒ½æ›´åŠ å›ºå®šçš„å­˜æ”¾é…ç½®æ–‡ä»¶ï¼Œä¸éœ€è¦é¢å¤–å»è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;h2 id=&#34;æ‹“å±•&#34;&gt;æ‹“å±• &lt;a href=&#34;#%e6%8b%93%e5%b1%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;go test&lt;/code&gt; åœ¨ä¸€äº›åœºæ™¯ä¸‹ä¹Ÿä¼šé‡åˆ°è·¯å¾„é—®é¢˜ï¼Œå› ä¸º&lt;code&gt;go test&lt;/code&gt;åªèƒ½å¤Ÿåœ¨å½“å‰ç›®å½•æ‰§è¡Œï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ï¼Œä½ çš„æ‰§è¡Œç›®å½•å·²ç»æ˜¯æµ‹è¯•ç›®å½•äº†&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé‡‡ç”¨è·å–å¤–éƒ¨å‚æ•°çš„åŠæ³•ï¼Œç”¨ os.args æ—¶ï¼Œgo test -args å’Œ go runã€go build ä¼šæœ‰å‘½ä»¤è¡Œå‚æ•°ä½ç½®çš„ä¸ä¸€è‡´é—®é¢˜&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>gin_validator</title>
      <link>https://abnerxc.github.io/go/gin_validator/</link>
      <pubDate>Sun, 13 Jun 2021 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/gin_validator/</guid>
      <description>&lt;h1 id=&#34;æ¦‚è¿°&#34;&gt;æ¦‚è¿° &lt;a href=&#34;#%e6%a6%82%e8%bf%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨æ¥å£å¼€å‘ç»å¸¸ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜æ˜¯åç«¯éœ€è¦å†™å¤§é‡çš„ç¹çä»£ç è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œæ‰€ä»¥å°±æƒ³ç€æœ‰æ²¡æœ‰åƒå‰ç«¯æ ¡éªŒä¸€æ ·å†™è§„åˆ™è¿›è¡ŒåŒ¹é…æ ¡éªŒï¼Œç„¶åå°±å‘ç°äº†validatoråŒ…ï¼Œä¸€ä¸ªæ¯”è¾ƒå¼ºå¤§çš„æ ¡éªŒå·¥å…·åŒ…ä¸‹é¢æ˜¯ä¸€äº›å­¦ä¹ æ€»ç»“ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥æŸ¥çœ‹&lt;a href=&#34;https://github.com/go-playground/validator&#34;&gt;validator&lt;/a&gt;
åŒ…ä¸‹è½½ï¼šgo get github.com/go-playground/validator/v10&lt;/p&gt;
&lt;h1 id=&#34;æ“ä½œç¬¦è¯´æ˜&#34;&gt;æ“ä½œç¬¦è¯´æ˜ &lt;a href=&#34;#%e6%93%8d%e4%bd%9c%e7%ac%a6%e8%af%b4%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ ‡è®°&lt;/th&gt;
          &lt;th&gt;æ ‡è®°è¯´æ˜&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;,&lt;/td&gt;
          &lt;td&gt;å¤šæ“ä½œç¬¦åˆ†å‰²&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;|&lt;/td&gt;
          &lt;td&gt;æˆ–æ“ä½œç¬¦&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;è·³è¿‡éªŒè¯å­—æ®µ&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;å¸¸ç”¨æ ‡è®°è¯´æ˜&#34;&gt;å¸¸ç”¨æ ‡è®°è¯´æ˜ &lt;a href=&#34;#%e5%b8%b8%e7%94%a8%e6%a0%87%e8%ae%b0%e8%af%b4%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ ‡è®°&lt;/th&gt;
          &lt;th&gt;æ ‡è®°è¯´æ˜&lt;/th&gt;
          &lt;th&gt;ä¾‹&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;required&lt;/td&gt;
          &lt;td&gt;å¿…å¡«&lt;/td&gt;
          &lt;td&gt;Fieldæˆ–Structvalidate:&amp;ldquo;required&amp;rdquo;,å¦‚æœint,0ä½œä¸ºç‰¹æ®Šå¯é€šè¿‡*intåˆ¤æ–­&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;omitempty&lt;/td&gt;
          &lt;td&gt;ç©ºæ—¶å¿½ç•¥&lt;/td&gt;
          &lt;td&gt;Fieldæˆ–Structvalidate:&amp;ldquo;omitempty&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;len&lt;/td&gt;
          &lt;td&gt;é•¿åº¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;len=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;eq&lt;/td&gt;
          &lt;td&gt;ç­‰äº&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;eq=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gt&lt;/td&gt;
          &lt;td&gt;å¤§äº&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;gt=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gte&lt;/td&gt;
          &lt;td&gt;å¤§äºç­‰äº&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;gte=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;lt&lt;/td&gt;
          &lt;td&gt;å°äº&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;lt=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;lte&lt;/td&gt;
          &lt;td&gt;å°äºç­‰äº&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;lte=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;eqfield&lt;/td&gt;
          &lt;td&gt;åŒä¸€ç»“æ„ä½“å­—æ®µç›¸ç­‰&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;eqfield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;nefield&lt;/td&gt;
          &lt;td&gt;åŒä¸€ç»“æ„ä½“å­—æ®µä¸ç›¸ç­‰&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;nefield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gtfield&lt;/td&gt;
          &lt;td&gt;å¤§äºåŒä¸€ç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;gtfield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gtefield&lt;/td&gt;
          &lt;td&gt;å¤§äºç­‰äºåŒä¸€ç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;gtefield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ltfield&lt;/td&gt;
          &lt;td&gt;å°äºåŒä¸€ç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;ltfield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ltefield&lt;/td&gt;
          &lt;td&gt;å°äºç­‰äºåŒä¸€ç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;ltefield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;eqcsfield&lt;/td&gt;
          &lt;td&gt;è·¨ä¸åŒç»“æ„ä½“å­—æ®µç›¸ç­‰&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;eqcsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;necsfield&lt;/td&gt;
          &lt;td&gt;è·¨ä¸åŒç»“æ„ä½“å­—æ®µä¸ç›¸ç­‰&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;necsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gtcsfield&lt;/td&gt;
          &lt;td&gt;å¤§äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;gtcsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;gtecsfield&lt;/td&gt;
          &lt;td&gt;å¤§äºç­‰äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;gtecsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ltcsfield&lt;/td&gt;
          &lt;td&gt;å°äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;ltcsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ltecsfield&lt;/td&gt;
          &lt;td&gt;å°äºç­‰äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Struct1.Fieldvalidate:&amp;ldquo;ltecsfield=Struct2.Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;min&lt;/td&gt;
          &lt;td&gt;æœ€å¤§å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;min=1&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;max&lt;/td&gt;
          &lt;td&gt;æœ€å°å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;max=2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;structonly&lt;/td&gt;
          &lt;td&gt;ä»…éªŒè¯ç»“æ„ä½“ï¼Œä¸éªŒè¯ä»»ä½•ç»“æ„ä½“å­—æ®µ&lt;/td&gt;
          &lt;td&gt;Structvalidate:&amp;ldquo;structonly&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;nostructlevel&lt;/td&gt;
          &lt;td&gt;ä¸è¿è¡Œä»»ä½•ç»“æ„çº§åˆ«çš„éªŒè¯&lt;/td&gt;
          &lt;td&gt;Structvalidate:&amp;ldquo;nostructlevel&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;dive&lt;/td&gt;
          &lt;td&gt;å‘ä¸‹å»¶ä¼¸éªŒè¯ï¼Œå¤šå±‚å‘ä¸‹éœ€è¦å¤šä¸ªdiveæ ‡è®°&lt;/td&gt;
          &lt;td&gt;[][]stringvalidate:&amp;ldquo;gt=0,dive,len=1,dive,required&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;diveKeys&amp;amp;EndKeys&lt;/td&gt;
          &lt;td&gt;ä¸diveåŒæ—¶ä½¿ç”¨ï¼Œç”¨äºå¯¹mapå¯¹è±¡çš„é”®çš„å’Œå€¼çš„éªŒè¯ï¼Œkeysä¸ºé”®ï¼Œendkeysä¸ºå€¼&lt;/td&gt;
          &lt;td&gt;map[string]stringvalidate:&amp;ldquo;gt=0,dive,keys,eq=1|eq=2,endkeys,required&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;required_with&lt;/td&gt;
          &lt;td&gt;å…¶ä»–å­—æ®µå…¶ä¸­ä¸€ä¸ªä¸ä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;required_with=Field1Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;required_with_all&lt;/td&gt;
          &lt;td&gt;å…¶ä»–æ‰€æœ‰å­—æ®µä¸ä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;required_with_all=Field1Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;required_without&lt;/td&gt;
          &lt;td&gt;å…¶ä»–å­—æ®µå…¶ä¸­ä¸€ä¸ªä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º&lt;/td&gt;
          &lt;td&gt;Field`validate:&amp;ldquo;required_without=Field1Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;required_without_all&lt;/td&gt;
          &lt;td&gt;å…¶ä»–æ‰€æœ‰å­—æ®µä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;required_without_all=Field1Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;isdefault&lt;/td&gt;
          &lt;td&gt;æ˜¯é»˜è®¤å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;isdefault=0&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;oneof&lt;/td&gt;
          &lt;td&gt;å…¶ä¸­ä¹‹ä¸€&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;oneof=579&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;containsfield&lt;/td&gt;
          &lt;td&gt;å­—æ®µåŒ…å«å¦ä¸€ä¸ªå­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;containsfield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;excludesfield&lt;/td&gt;
          &lt;td&gt;å­—æ®µä¸åŒ…å«å¦ä¸€ä¸ªå­—æ®µ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;excludesfield=Field2&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;unique&lt;/td&gt;
          &lt;td&gt;æ˜¯å¦å”¯ä¸€ï¼Œé€šå¸¸ç”¨äºåˆ‡ç‰‡æˆ–ç»“æ„ä½“&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;unique&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;alphanum&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«ASCIIå­—æ¯æ•°å­—å­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;alphanum&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;alphaunicode&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«unicodeå­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;alphaunicode&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;alphanumunicode&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«unicodeå­—æ¯æ•°å­—å­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;alphanumunicode&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;numeric&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«åŸºæœ¬çš„æ•°å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;numeric&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;hexadecimal&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„åå…­è¿›åˆ¶&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;hexadecimal&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;hexcolor&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„åå…­è¿›åˆ¶é¢œè‰²&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;hexcolor&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;lowercase&lt;/td&gt;
          &lt;td&gt;ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«å°å†™å­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;lowercase&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;uppercase&lt;/td&gt;
          &lt;td&gt;ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«å¤§å†™å­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;uppercase&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;email&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼åŒ…å«ä¸€ä¸ªæœ‰æ•ˆçš„ç”µå­é‚®ä»¶&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;email&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;json&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦ä¸ºæœ‰æ•ˆçš„JSON&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;json&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;file&lt;/td&gt;
          &lt;td&gt;ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„ï¼Œä»¥åŠè¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºè®¡ç®—æœºä¸Š&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;file&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;url&lt;/td&gt;
          &lt;td&gt;ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„url&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;url&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;uri&lt;/td&gt;
          &lt;td&gt;ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„uri&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;uri&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;base64&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„base64å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;base64&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;contains&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼åŒ…å«å­å­—ç¬¦ä¸²å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;contains=@&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;containsany&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼åŒ…å«å­å­—ç¬¦ä¸²å€¼ä¸­çš„ä»»ä½•å­—ç¬¦&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;containsany=abc&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;containsrune&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼åŒ…å«æä¾›çš„ç‰¹æ®Šç¬¦å·å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;containsrune=â˜¢&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;excludes&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼ä¸åŒ…å«å­å­—ç¬¦ä¸²å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;excludes=@&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;excludesall&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼ä¸åŒ…å«ä»»ä½•å­å­—ç¬¦ä¸²å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;excludesall=abc&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;excludesrune&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼ä¸åŒ…å«æä¾›çš„ç‰¹æ®Šç¬¦å·å€¼&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;containsrune=â˜¢&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;startswith&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²ä»¥æä¾›çš„å­—ç¬¦ä¸²å€¼å¼€å§‹&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;startswith=abc&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;endswith&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²ä»¥æä¾›çš„å­—ç¬¦ä¸²å€¼ç»“æŸ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;endswith=abc&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ip&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„IPåœ°å€&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;ip&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ipv4&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ipv4åœ°å€&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;ipv4&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;datetime&lt;/td&gt;
          &lt;td&gt;å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„æ—¥æœŸ&lt;/td&gt;
          &lt;td&gt;Fieldvalidate:&amp;ldquo;datetime&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;ä½¿ç”¨ç¤ºä¾‹&#34;&gt;ä½¿ç”¨ç¤ºä¾‹ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ä½¿ç”¨æ³¨æ„&#34;&gt;ä½¿ç”¨æ³¨æ„ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e6%b3%a8%e6%84%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;å½“æœç´¢æ¡ä»¶ä¸ç‰¹æ®Šæ ‡è®°å†²çªæ—¶,å¦‚ï¼šé€—å·ï¼ˆ,ï¼‰ï¼Œæˆ–æ“ä½œï¼ˆ|ï¼‰ï¼Œä¸­æ¨ªçº¿ï¼ˆ-ï¼‰ç­‰åˆ™éœ€è¦ä½¿ç”¨ UTF-8åå…­è¿›åˆ¶è¡¨ç¤ºå½¢å¼&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Test struct {
   Field1 string  `validate:&amp;#34;excludesall=|&amp;#34;`    // é”™è¯¯
   Field2 string `validate:&amp;#34;excludesall=0x7C&amp;#34;` // æ­£ç¡®.
}
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å¯é€šè¿‡validationErrors := errs.(validator.ValidationErrors)è·å–é”™è¯¯å¯¹è±¡è‡ªå®šä¹‰è¿”å›å“åº”é”™è¯¯&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰æ ¡éªŒç»“æœç¿»è¯‘&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// åˆå§‹åŒ–ç¿»è¯‘å™¨
func validateInit() {
	zh_ch := zh.New()
	uni := ut.New(zh_ch)               // ä¸‡èƒ½ç¿»è¯‘å™¨ï¼Œä¿å­˜æ‰€æœ‰çš„è¯­è¨€ç¯å¢ƒå’Œç¿»è¯‘æ•°æ®
	Trans, _ = uni.GetTranslator(&amp;#34;zh&amp;#34;) // ç¿»è¯‘å™¨
	Validate = validator.New()
	_ = zh_translations.RegisterDefaultTranslations(Validate, Trans)
	// æ·»åŠ é¢å¤–ç¿»è¯‘
	_ = Validate.RegisterTranslation(&amp;#34;required_without&amp;#34;, Trans, func(ut ut.Translator) error {
		return ut.Add(&amp;#34;required_without&amp;#34;, &amp;#34;{0} ä¸ºå¿…å¡«å­—æ®µ!&amp;#34;, true)
	}, func(ut ut.Translator, fe validator.FieldError) string {
		t, _ := ut.T(&amp;#34;required_without&amp;#34;, fe.Field())
		return t
	})
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ä½¿ç”¨ç¤ºä¾‹-1&#34;&gt;ä½¿ç”¨ç¤ºä¾‹ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b-1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main
import (
   &amp;#34;fmt&amp;#34;
   &amp;#34;github.com/go-playground/validator/v10&amp;#34;
)
// å®ä¾‹åŒ–éªŒè¯å¯¹è±¡
var validate = validator.New()
func main() {
   // ç»“æ„ä½“éªŒè¯
   type Inner struct {
      String string `validate:&amp;#34;contains=111&amp;#34;`
   }
   inner := &amp;amp;Inner{String: &amp;#34;11@&amp;#34;}
   errs := validate.Struct(inner)
   if errs != nil {
      fmt.Println(errs.Error())
   }
   // å˜é‡éªŒè¯
   m := map[string]string{&amp;#34;&amp;#34;: &amp;#34;&amp;#34;, &amp;#34;val3&amp;#34;: &amp;#34;val3&amp;#34;}
   errs = validate.Var(m, &amp;#34;required,dive,keys,required,endkeys,required&amp;#34;)
   if errs != nil {
      fmt.Println(errs.Error())
   }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ginæ¡†æ¶ä¸­ä½¿ç”¨éªŒè¯å™¨&#34;&gt;ginæ¡†æ¶ä¸­ä½¿ç”¨éªŒè¯å™¨ &lt;a href=&#34;#gin%e6%a1%86%e6%9e%b6%e4%b8%ad%e4%bd%bf%e7%94%a8%e9%aa%8c%e8%af%81%e5%99%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å®šä¹‰é”™è¯¯ç¿»è¯‘å™¨&#34;&gt;å®šä¹‰é”™è¯¯ç¿»è¯‘å™¨ &lt;a href=&#34;#%e5%ae%9a%e4%b9%89%e9%94%99%e8%af%af%e7%bf%bb%e8%af%91%e5%99%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package xcore

import (
	&amp;#34;fmt&amp;#34;
	&amp;#34;github.com/gin-gonic/gin/binding&amp;#34;
	&amp;#34;reflect&amp;#34;
	&amp;#34;strings&amp;#34;
	//ginè¡¨å•éªŒè¯
	&amp;#34;github.com/go-playground/locales/en&amp;#34;
	&amp;#34;github.com/go-playground/locales/zh&amp;#34;
	&amp;#34;github.com/go-playground/universal-translator&amp;#34;
	&amp;#34;github.com/go-playground/validator/v10&amp;#34;
	enTranslations &amp;#34;github.com/go-playground/validator/v10/translations/en&amp;#34;
	zhTranslations &amp;#34;github.com/go-playground/validator/v10/translations/zh&amp;#34;
)

// å®šä¹‰ä¸€ä¸ªå…¨å±€ç¿»è¯‘å™¨
var trans ut.Translator

// InitTrans åˆå§‹åŒ–ç¿»è¯‘å™¨
func InitTrans(locale string) (err error) {
	//ä¿®æ”¹ginæ¡†æ¶ä¸­çš„Validatorå±æ€§ï¼Œå®ç°è‡ªå®šåˆ¶
	if v, ok := binding.Validator.Engine().(*validator.Validate); ok {
		// æ³¨å†Œä¸€ä¸ªè·å–json tagçš„è‡ªå®šä¹‰æ–¹æ³•
		v.RegisterTagNameFunc(func(fld reflect.StructField) string {
			name := strings.SplitN(fld.Tag.Get(&amp;#34;json&amp;#34;), &amp;#34;,&amp;#34;, 2)[0]
			if name == &amp;#34;-&amp;#34; {
				return &amp;#34;&amp;#34;
			}
			return name
		})

		zhT := zh.New() //ä¸­æ–‡ç¿»è¯‘å™¨
		enT := en.New() //è‹±æ–‡ç¿»è¯‘å™¨

		// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¤‡ç”¨ï¼ˆfallbackï¼‰çš„è¯­è¨€ç¯å¢ƒ
		// åé¢çš„å‚æ•°æ˜¯åº”è¯¥æ”¯æŒçš„è¯­è¨€ç¯å¢ƒï¼ˆæ”¯æŒå¤šä¸ªï¼‰
		// uni := ut.New(zhT, zhT) ä¹Ÿæ˜¯å¯ä»¥çš„
		uni := ut.New(enT, zhT, enT)

		// locale é€šå¸¸å–å†³äº http è¯·æ±‚å¤´çš„ &amp;#39;Accept-Language&amp;#39;
		var ok bool
		// ä¹Ÿå¯ä»¥ä½¿ç”¨ uni.FindTranslator(...) ä¼ å…¥å¤šä¸ªlocaleè¿›è¡ŒæŸ¥æ‰¾
		trans, ok = uni.GetTranslator(locale)
		if !ok {
			return fmt.Errorf(&amp;#34;uni.GetTranslator(%s) failed&amp;#34;, locale)
		}

		// æ·»åŠ é¢å¤–ç¿»è¯‘
		_ = v.RegisterTranslation(&amp;#34;required_with&amp;#34;, trans, func(ut ut.Translator) error {
			return ut.Add(&amp;#34;required_with&amp;#34;, &amp;#34;{0} ä¸ºå¿…å¡«å­—æ®µ!&amp;#34;, true)
		}, func(ut ut.Translator, fe validator.FieldError) string {
			t, _ := ut.T(&amp;#34;required_with&amp;#34;, fe.Field())
			return t
		})
		_ = v.RegisterTranslation(&amp;#34;required_without&amp;#34;, trans, func(ut ut.Translator) error {
			return ut.Add(&amp;#34;required_without&amp;#34;, &amp;#34;{0} ä¸ºå¿…å¡«å­—æ®µ!&amp;#34;, true)
		}, func(ut ut.Translator, fe validator.FieldError) string {
			t, _ := ut.T(&amp;#34;required_without&amp;#34;, fe.Field())
			return t
		})
		_ = v.RegisterTranslation(&amp;#34;required_without_all&amp;#34;, trans, func(ut ut.Translator) error {
			return ut.Add(&amp;#34;required_without_all&amp;#34;, &amp;#34;{0} ä¸ºå¿…å¡«å­—æ®µ!&amp;#34;, true)
		}, func(ut ut.Translator, fe validator.FieldError) string {
			t, _ := ut.T(&amp;#34;required_without_all&amp;#34;, fe.Field())
			return t
		})

		// æ³¨å†Œç¿»è¯‘å™¨
		switch locale {
		case &amp;#34;en&amp;#34;:
			err = enTranslations.RegisterDefaultTranslations(v, trans)
		case &amp;#34;zh&amp;#34;:
			err = zhTranslations.RegisterDefaultTranslations(v, trans)
		default:
			err = enTranslations.RegisterDefaultTranslations(v, trans)
		}
		return
	}
	return
}

func addValueToMap(fields map[string]string) map[string]interface{} {
	res := make(map[string]interface{})
	for field, err := range fields {
		fieldArr := strings.SplitN(field, &amp;#34;.&amp;#34;, 2)
		if len(fieldArr) &amp;gt; 1 {
			NewFields := map[string]string{fieldArr[1]: err}
			returnMap := addValueToMap(NewFields)
			if res[fieldArr[0]] != nil {
				for k, v := range returnMap {
					res[fieldArr[0]].(map[string]interface{})[k] = v
				}
			} else {
				res[fieldArr[0]] = returnMap
			}
			continue
		} else {
			res[field] = err
			continue
		}
	}
	return res
}

// å»æ‰ç»“æ„ä½“åç§°å‰ç¼€
func removeTopStruct(fields map[string]string) map[string]interface{} {
	lowerMap := map[string]string{}
	for field, err := range fields {
		fieldArr := strings.SplitN(field, &amp;#34;.&amp;#34;, 2)
		lowerMap[fieldArr[1]] = err
	}
	res := addValueToMap(lowerMap)
	return res
}

//handlerä¸­è°ƒç”¨çš„é”™è¯¯ç¿»è¯‘æ–¹æ³•
func ValidatorError(err error) map[string]interface{} {
	errs, ok := err.(validator.ValidationErrors)
	if ok {
		return removeTopStruct(errs.Translate(trans))
	}
	return nil
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ä½¿ç”¨&#34;&gt;ä½¿ç”¨ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (c *IndexController) Validator(ctx *gin.Context) {
	req := requests.AdminReq{}
	if err := ctx.ShouldBindJSON(&amp;amp;req); err != nil {
		ctx.JSON(http.StatusBadRequest, gin.H{&amp;#34;error&amp;#34;: xcore.ValidatorError(err)})
		return
	}
	ctx.JSON(http.StatusNotFound, &amp;#34;ok&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Go-GMPæ¨¡å‹</title>
      <link>https://abnerxc.github.io/go/gmp%E6%A8%A1%E5%9E%8B/</link>
      <pubDate>Sun, 13 Jun 2021 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/gmp%E6%A8%A1%E5%9E%8B/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://learnku.com/articles/41728&#34;&gt;https://learnku.com/articles/41728&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;gmp-æ¨¡å‹&#34;&gt;GMP æ¨¡å‹ &lt;a href=&#34;#gmp-%e6%a8%a1%e5%9e%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-gmp-a.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;G= Goroutine åç¨‹ï¼ŒP=Processor å¤„ç†å™¨ï¼Œ M=Thread çº¿ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…¨å±€é˜Ÿåˆ—ï¼ˆGlobal Queueï¼‰ï¼šå­˜æ”¾ç­‰å¾…è¿è¡Œçš„ Gã€‚&lt;/li&gt;
&lt;li&gt;P çš„æœ¬åœ°é˜Ÿåˆ—ï¼šåŒå…¨å±€é˜Ÿåˆ—ç±»ä¼¼ï¼Œå­˜æ”¾çš„ä¹Ÿæ˜¯ç­‰å¾…è¿è¡Œçš„ Gï¼Œå­˜çš„æ•°é‡æœ‰é™ï¼Œä¸è¶…è¿‡ 256 ä¸ªã€‚æ–°å»º Gâ€™æ—¶ï¼ŒGâ€™ä¼˜å…ˆåŠ å…¥åˆ° P çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ™ä¼šæŠŠæœ¬åœ°é˜Ÿåˆ—ä¸­ä¸€åŠçš„ G ç§»åŠ¨åˆ°å…¨å±€é˜Ÿåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;P åˆ—è¡¨ï¼šæ‰€æœ‰çš„ P éƒ½åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºï¼Œå¹¶ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œæœ€å¤šæœ‰ GOMAXPROCS(å¯é…ç½®) ä¸ªã€‚&lt;/li&gt;
&lt;li&gt;Mï¼šçº¿ç¨‹æƒ³è¿è¡Œä»»åŠ¡å°±å¾—è·å– Pï¼Œä» P çš„æœ¬åœ°é˜Ÿåˆ—è·å– Gï¼ŒP é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒM ä¹Ÿä¼šå°è¯•ä»å…¨å±€é˜Ÿåˆ—æ‹¿ä¸€æ‰¹ G æ”¾åˆ° P çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œæˆ–ä»å…¶ä»– P çš„æœ¬åœ°é˜Ÿåˆ—å·ä¸€åŠæ”¾åˆ°è‡ªå·± P çš„æœ¬åœ°é˜Ÿåˆ—ã€‚M è¿è¡Œ Gï¼ŒG æ‰§è¡Œä¹‹åï¼ŒM ä¼šä» P è·å–ä¸‹ä¸€ä¸ª Gï¼Œä¸æ–­é‡å¤ä¸‹å»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Goroutine è°ƒåº¦å™¨å’Œ OS è°ƒåº¦å™¨æ˜¯é€šè¿‡ M ç»“åˆèµ·æ¥çš„ï¼Œæ¯ä¸ª M éƒ½ä»£è¡¨äº† 1 ä¸ªå†…æ ¸çº¿ç¨‹ï¼ŒOS è°ƒåº¦å™¨è´Ÿè´£æŠŠå†…æ ¸çº¿ç¨‹åˆ†é…åˆ° CPU çš„æ ¸ä¸Šæ‰§è¡Œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;æœ‰å…³-p-å’Œ-m-çš„ä¸ªæ•°é—®é¢˜&#34;&gt;æœ‰å…³ P å’Œ M çš„ä¸ªæ•°é—®é¢˜ &lt;a href=&#34;#%e6%9c%89%e5%85%b3-p-%e5%92%8c-m-%e7%9a%84%e4%b8%aa%e6%95%b0%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;Pçš„æ•°é‡ï¼š ç”±å¯åŠ¨æ—¶ç¯å¢ƒå˜é‡ $GOMAXPROCS æˆ–è€…æ˜¯ç”± runtime çš„æ–¹æ³• GOMAXPROCS() å†³å®šã€‚è¿™æ„å‘³ç€åœ¨ç¨‹åºæ‰§è¡Œçš„ä»»æ„æ—¶åˆ»éƒ½åªæœ‰ $GOMAXPROCS ä¸ª goroutine åœ¨åŒæ—¶è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;Mçš„æ•°é‡ï¼š
&lt;ul&gt;
&lt;li&gt;go è¯­è¨€æœ¬èº«çš„é™åˆ¶ï¼šgo ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šè®¾ç½® M çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ 10000. ä½†æ˜¯å†…æ ¸å¾ˆéš¾æ”¯æŒè¿™ä¹ˆå¤šçš„çº¿ç¨‹æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªé™åˆ¶å¯ä»¥å¿½ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;runtime/debug ä¸­çš„ SetMaxThreads å‡½æ•°ï¼Œè®¾ç½® M çš„æœ€å¤§æ•°é‡&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ª M é˜»å¡äº†ï¼Œä¼šåˆ›å»ºæ–°çš„ Mã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;M ä¸ P çš„æ•°é‡æ²¡æœ‰ç»å¯¹å…³ç³»ï¼Œä¸€ä¸ª M é˜»å¡ï¼ŒP å°±ä¼šå»åˆ›å»ºæˆ–è€…åˆ‡æ¢å¦ä¸€ä¸ª Mï¼Œæ‰€ä»¥ï¼Œå³ä½¿ P çš„é»˜è®¤æ•°é‡æ˜¯ 1ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåˆ›å»ºå¾ˆå¤šä¸ª M å‡ºæ¥ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;p-å’Œ-m-ä½•æ—¶ä¼šè¢«åˆ›å»º&#34;&gt;P å’Œ M ä½•æ—¶ä¼šè¢«åˆ›å»º &lt;a href=&#34;#p-%e5%92%8c-m-%e4%bd%95%e6%97%b6%e4%bc%9a%e8%a2%ab%e5%88%9b%e5%bb%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;P ä½•æ—¶åˆ›å»ºï¼šåœ¨ç¡®å®šäº† P çš„æœ€å¤§æ•°é‡ n åï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæ ¹æ®è¿™ä¸ªæ•°é‡åˆ›å»º n ä¸ª Pã€‚&lt;/li&gt;
&lt;li&gt;M ä½•æ—¶åˆ›å»ºï¼šæ²¡æœ‰è¶³å¤Ÿçš„ M æ¥å…³è” P å¹¶è¿è¡Œå…¶ä¸­çš„å¯è¿è¡Œçš„ Gã€‚æ¯”å¦‚æ‰€æœ‰çš„ M æ­¤æ—¶éƒ½é˜»å¡ä½äº†ï¼Œè€Œ P ä¸­è¿˜æœ‰å¾ˆå¤šå°±ç»ªä»»åŠ¡ï¼Œå°±ä¼šå»å¯»æ‰¾ç©ºé—²çš„ Mï¼Œè€Œæ²¡æœ‰ç©ºé—²çš„ï¼Œå°±ä¼šå»åˆ›å»ºæ–°çš„ Mã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥&#34;&gt;è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥ &lt;a href=&#34;#%e8%b0%83%e5%ba%a6%e5%99%a8%e7%9a%84%e8%ae%be%e8%ae%a1%e7%ad%96%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¤ç”¨çº¿ç¨‹ï¼šé¿å…é¢‘ç¹çš„åˆ›å»ºã€é”€æ¯çº¿ç¨‹ï¼Œè€Œæ˜¯å¯¹çº¿ç¨‹çš„å¤ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;work stealing æœºåˆ¶ï¼šå½“æœ¬çº¿ç¨‹æ— å¯è¿è¡Œçš„ G æ—¶ï¼Œå°è¯•ä»å…¶ä»–çº¿ç¨‹ç»‘å®šçš„ P å·å– Gï¼Œè€Œä¸æ˜¯é”€æ¯çº¿ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;hand off æœºåˆ¶ï¼šâ€‹ å½“æœ¬çº¿ç¨‹å› ä¸º G è¿›è¡Œç³»ç»Ÿè°ƒç”¨é˜»å¡æ—¶ï¼Œçº¿ç¨‹é‡Šæ”¾ç»‘å®šçš„ Pï¼ŒæŠŠ P è½¬ç§»ç»™å…¶ä»–ç©ºé—²çš„çº¿ç¨‹æ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ©ç”¨å¹¶è¡Œï¼š&lt;code&gt;GOMAXPROCS&lt;/code&gt; è®¾ç½® P çš„æ•°é‡ï¼Œæœ€å¤šæœ‰ &lt;code&gt;GOMAXPROCS&lt;/code&gt; ä¸ªçº¿ç¨‹åˆ†å¸ƒåœ¨å¤šä¸ª CPU ä¸ŠåŒæ—¶è¿è¡Œã€‚&lt;code&gt;GOMAXPROCS&lt;/code&gt; ä¹Ÿé™åˆ¶äº†å¹¶å‘çš„ç¨‹åº¦ï¼Œæ¯”å¦‚ &lt;code&gt;GOMAXPROCS= æ ¸æ•°/2&lt;/code&gt;ï¼Œåˆ™æœ€å¤šåˆ©ç”¨äº†ä¸€åŠçš„ CPU æ ¸è¿›è¡Œå¹¶è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŠ¢å ï¼šåœ¨ coroutine ä¸­è¦ç­‰å¾…ä¸€ä¸ªåç¨‹ä¸»åŠ¨è®©å‡º CPU æ‰æ‰§è¡Œä¸‹ä¸€ä¸ªåç¨‹ï¼Œ
&lt;code&gt;åœ¨ Go ä¸­ï¼Œä¸€ä¸ª goroutine æœ€å¤šå ç”¨ CPU 10msï¼Œ é˜²æ­¢å…¶ä»– goroutine è¢«é¥¿æ­»ï¼Œè¿™å°±æ˜¯ goroutine ä¸åŒäº coroutine çš„ä¸€ä¸ªåœ°æ–¹&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¨å±€ G é˜Ÿåˆ—ï¼šåœ¨æ–°çš„è°ƒåº¦å™¨ä¸­ä¾ç„¶æœ‰å…¨å±€ G é˜Ÿåˆ—ï¼Œä½†åŠŸèƒ½å·²ç»è¢«å¼±åŒ–äº†ï¼Œå½“ M æ‰§è¡Œ work stealing ä»å…¶ä»– P å·ä¸åˆ° G æ—¶ï¼Œå®ƒå¯ä»¥ä»å…¨å±€ G é˜Ÿåˆ—è·å– Gã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;go-func--è°ƒåº¦æµç¨‹&#34;&gt;go func () è°ƒåº¦æµç¨‹ &lt;a href=&#34;#go-func--%e8%b0%83%e5%ba%a6%e6%b5%81%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-gmp-b.jpeg&#34; alt=&#34;2.jpg&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬é€šè¿‡ go func () æ¥åˆ›å»ºä¸€ä¸ª goroutineï¼›&lt;/li&gt;
&lt;li&gt;æœ‰ä¸¤ä¸ªå­˜å‚¨ G çš„é˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯å±€éƒ¨è°ƒåº¦å™¨ P çš„æœ¬åœ°é˜Ÿåˆ—ã€ä¸€ä¸ªæ˜¯å…¨å±€ G é˜Ÿåˆ—ã€‚æ–°åˆ›å»ºçš„ G ä¼šå…ˆä¿å­˜åœ¨ P çš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœ P çš„æœ¬åœ°é˜Ÿåˆ—å·²ç»æ»¡äº†å°±ä¼šä¿å­˜åœ¨å…¨å±€çš„é˜Ÿåˆ—ä¸­ï¼›
â€‹3. G åªèƒ½è¿è¡Œåœ¨ M ä¸­ï¼Œä¸€ä¸ª M å¿…é¡»æŒæœ‰ä¸€ä¸ª Pï¼ŒM ä¸ P æ˜¯ 1ï¼š1 çš„å…³ç³»ã€‚M ä¼šä» P çš„æœ¬åœ°é˜Ÿåˆ—å¼¹å‡ºä¸€ä¸ªå¯æ‰§è¡ŒçŠ¶æ€çš„ G æ¥æ‰§è¡Œï¼Œå¦‚æœ P çš„æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œå°±ä¼šæƒ³å…¶ä»–çš„ MP ç»„åˆå·å–ä¸€ä¸ªå¯æ‰§è¡Œçš„ G æ¥æ‰§è¡Œï¼›
â€‹4. ä¸€ä¸ª M è°ƒåº¦ G æ‰§è¡Œçš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªå¾ªç¯æœºåˆ¶ï¼›&lt;/li&gt;
&lt;li&gt;å½“ M æ‰§è¡ŒæŸä¸€ä¸ª G æ—¶å€™å¦‚æœå‘ç”Ÿäº† syscall æˆ–åˆ™å…¶ä½™é˜»å¡æ“ä½œï¼ŒM ä¼šé˜»å¡ï¼Œå¦‚æœå½“å‰æœ‰ä¸€äº› G åœ¨æ‰§è¡Œï¼Œruntime ä¼šæŠŠè¿™ä¸ªçº¿ç¨‹ M ä» P ä¸­æ‘˜é™¤ (detach)ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªæ–°çš„æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ (å¦‚æœæœ‰ç©ºé—²çš„çº¿ç¨‹å¯ç”¨å°±å¤ç”¨ç©ºé—²çº¿ç¨‹) æ¥æœåŠ¡äºè¿™ä¸ª Pï¼›&lt;/li&gt;
&lt;li&gt;å½“ M ç³»ç»Ÿè°ƒç”¨ç»“æŸæ—¶å€™ï¼Œè¿™ä¸ª G ä¼šå°è¯•è·å–ä¸€ä¸ªç©ºé—²çš„ P æ‰§è¡Œï¼Œå¹¶æ”¾å…¥åˆ°è¿™ä¸ª P çš„æœ¬åœ°é˜Ÿåˆ—ã€‚å¦‚æœè·å–ä¸åˆ° Pï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹ M å˜æˆä¼‘çœ çŠ¶æ€ï¼Œ åŠ å…¥åˆ°ç©ºé—²çº¿ç¨‹ä¸­ï¼Œç„¶åè¿™ä¸ª G ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ&#34;&gt;è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ &lt;a href=&#34;#%e8%b0%83%e5%ba%a6%e5%99%a8%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-gmp-c.jpeg&#34; alt=&#34;2.jpg&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç‰¹æ®Šçš„-m0-å’Œ-g0&#34;&gt;ç‰¹æ®Šçš„ M0 å’Œ G0 &lt;a href=&#34;#%e7%89%b9%e6%ae%8a%e7%9a%84-m0-%e5%92%8c-g0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;M0 æ˜¯å¯åŠ¨ç¨‹åºåçš„ç¼–å·ä¸º 0 çš„ä¸»çº¿ç¨‹ï¼Œè¿™ä¸ª M å¯¹åº”çš„å®ä¾‹ä¼šåœ¨å…¨å±€å˜é‡ runtime.m0 ä¸­ï¼Œä¸éœ€è¦åœ¨ heap ä¸Šåˆ†é…ï¼ŒM0 è´Ÿè´£æ‰§è¡Œåˆå§‹åŒ–æ“ä½œå’Œå¯åŠ¨ç¬¬ä¸€ä¸ª Gï¼Œ åœ¨ä¹‹å M0 å°±å’Œå…¶ä»–çš„ M ä¸€æ ·äº†ã€‚&lt;/li&gt;
&lt;li&gt;GO æ˜¯æ¯æ¬¡å¯åŠ¨ä¸€ä¸ª M éƒ½ä¼šç¬¬ä¸€ä¸ªåˆ›å»ºçš„ gourtineï¼ŒG0 ä»…ç”¨äºè´Ÿè´£è°ƒåº¦çš„ Gï¼ŒG0 ä¸æŒ‡å‘ä»»ä½•å¯æ‰§è¡Œçš„å‡½æ•°ï¼Œæ¯ä¸ª M éƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„ G0ã€‚åœ¨è°ƒåº¦æˆ–ç³»ç»Ÿè°ƒç”¨æ—¶ä¼šä½¿ç”¨ G0 çš„æ ˆç©ºé—´ï¼Œå…¨å±€å˜é‡çš„ G0 æ˜¯ M0 çš„ G0ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¯è§†åŒ–-gmp-ç¼–ç¨‹&#34;&gt;å¯è§†åŒ– GMP ç¼–ç¨‹ &lt;a href=&#34;#%e5%8f%af%e8%a7%86%e5%8c%96-gmp-%e7%bc%96%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;æ–¹å¼ 1ï¼šgo tool trace&lt;/li&gt;
&lt;li&gt;æ–¹å¼ 2ï¼šDebug trace&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Go-æ·±å…¥è§£æsliceåº•å±‚å®ç°</title>
      <link>https://abnerxc.github.io/go/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90slice%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/</link>
      <pubDate>Sat, 15 May 2021 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90slice%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/</guid>
      <description>&lt;p&gt;åŸæ–‡åœ°å€ï¼šhttps://halfrost.com/go_slice/&lt;/p&gt;
&lt;p&gt;åˆ‡ç‰‡æ˜¯ Go ä¸­çš„ä¸€ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼Œä½¿ç”¨è¿™ç§ç»“æ„å¯ä»¥ç”¨æ¥ç®¡ç†æ•°æ®é›†åˆã€‚åˆ‡ç‰‡çš„è®¾è®¡æƒ³æ³•æ˜¯ç”±åŠ¨æ€æ•°ç»„æ¦‚å¿µè€Œæ¥ï¼Œä¸ºäº†å¼€å‘è€…å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ä½¿ä¸€ä¸ªæ•°æ®ç»“æ„å¯ä»¥è‡ªåŠ¨å¢åŠ å’Œå‡å°‘ã€‚ä½†æ˜¯åˆ‡ç‰‡æœ¬èº«å¹¶ä¸æ˜¯åŠ¨æ€æ•°æ®æˆ–è€…æ•°ç»„æŒ‡é’ˆã€‚åˆ‡ç‰‡å¸¸è§çš„æ“ä½œæœ‰ resliceã€appendã€copyã€‚ä¸æ­¤åŒæ—¶ï¼Œåˆ‡ç‰‡è¿˜å…·æœ‰å¯ç´¢å¼•ï¼Œå¯è¿­ä»£çš„ä¼˜ç§€ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;åˆ‡ç‰‡å’Œæ•°ç»„&#34;&gt;åˆ‡ç‰‡å’Œæ•°ç»„ &lt;a href=&#34;#%e5%88%87%e7%89%87%e5%92%8c%e6%95%b0%e7%bb%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨ Go ä¸­ï¼Œä¸ C æ•°ç»„å˜é‡éšå¼ä½œä¸ºæŒ‡é’ˆä½¿ç”¨ä¸åŒï¼ŒGo æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œèµ‹å€¼å’Œå‡½æ•°ä¼ å‚æ“ä½œéƒ½ä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„æ•°æ®ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	arrayA := [2]int{100, 200}
	var arrayB [2]int

	arrayB = arrayA

	fmt.Printf(&amp;#34;arrayA : %p , %v\n&amp;#34;, &amp;amp;arrayA, arrayA)
	fmt.Printf(&amp;#34;arrayB : %p , %v\n&amp;#34;, &amp;amp;arrayB, arrayB)

	testArray(arrayA)
}

func testArray(x [2]int) {
	fmt.Printf(&amp;#34;func Array : %p , %v\n&amp;#34;, &amp;amp;x, x)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰“å°ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;arrayA : 0xc4200bebf0 , [100 200]
arrayB : 0xc4200bec00 , [100 200]
func Array : 0xc4200bec30 , [100 200]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œä¸‰ä¸ªå†…å­˜åœ°å€éƒ½ä¸åŒï¼Œè¿™ä¹Ÿå°±éªŒè¯äº† Go ä¸­æ•°ç»„èµ‹å€¼å’Œå‡½æ•°ä¼ å‚éƒ½æ˜¯å€¼å¤åˆ¶çš„ã€‚é‚£è¿™ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å‡æƒ³æ¯æ¬¡ä¼ å‚éƒ½ç”¨æ•°ç»„ï¼Œé‚£ä¹ˆæ¯æ¬¡æ•°ç»„éƒ½è¦è¢«å¤åˆ¶ä¸€éã€‚å¦‚æœæ•°ç»„å¤§å°æœ‰ 100ä¸‡ï¼Œåœ¨64ä½æœºå™¨ä¸Šå°±éœ€è¦èŠ±è´¹å¤§çº¦ 800W å­—èŠ‚ï¼Œå³ 8MB å†…å­˜ã€‚è¿™æ ·ä¼šæ¶ˆè€—æ‰å¤§é‡çš„å†…å­˜ã€‚äºæ˜¯ä¹æœ‰äººæƒ³åˆ°ï¼Œå‡½æ•°ä¼ å‚ç”¨æ•°ç»„çš„æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	arrayA := []int{100, 200}
	testArrayPoint(&amp;amp;arrayA)   // 1.ä¼ æ•°ç»„æŒ‡é’ˆ
	arrayB := arrayA[:]
	testArrayPoint(&amp;amp;arrayB)   // 2.ä¼ åˆ‡ç‰‡
	fmt.Printf(&amp;#34;arrayA : %p , %v\n&amp;#34;, &amp;amp;arrayA, arrayA)
}

func testArrayPoint(x *[]int) {
	fmt.Printf(&amp;#34;func Array : %p , %v\n&amp;#34;, x, *x)
	(*x)[1] += 100
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰“å°ç»“æœ:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Array : 0xc4200b0140 , [100 200]
func Array : 0xc4200b0180 , [100 300]
arrayA : 0xc4200b0140 , [100 400]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™ä¹Ÿå°±è¯æ˜äº†æ•°ç»„æŒ‡é’ˆç¡®å®åˆ°è¾¾äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚ç°åœ¨å°±ç®—æ˜¯ä¼ å…¥10äº¿çš„æ•°ç»„ï¼Œä¹Ÿåªéœ€è¦å†æ ˆä¸Šåˆ†é…ä¸€ä¸ª8ä¸ªå­—èŠ‚çš„å†…å­˜ç»™æŒ‡é’ˆå°±å¯ä»¥äº†ã€‚è¿™æ ·æ›´åŠ é«˜æ•ˆçš„åˆ©ç”¨å†…å­˜ï¼Œæ€§èƒ½ä¹Ÿæ¯”ä¹‹å‰çš„å¥½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ä¼ æŒ‡é’ˆä¼šæœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œä»æ‰“å°ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€è¡Œå’Œç¬¬ä¸‰è¡ŒæŒ‡é’ˆåœ°å€éƒ½æ˜¯åŒä¸€ä¸ªï¼Œä¸‡ä¸€åŸæ•°ç»„çš„æŒ‡é’ˆæŒ‡å‘æ›´æ”¹äº†ï¼Œé‚£ä¹ˆå‡½æ•°é‡Œé¢çš„æŒ‡é’ˆæŒ‡å‘éƒ½ä¼šè·Ÿç€æ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;åˆ‡ç‰‡çš„ä¼˜åŠ¿ä¹Ÿå°±è¡¨ç°å‡ºæ¥äº†ã€‚ç”¨åˆ‡ç‰‡ä¼ æ•°ç»„å‚æ•°ï¼Œæ—¢å¯ä»¥è¾¾åˆ°èŠ‚çº¦å†…å­˜çš„ç›®çš„ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°åˆç†å¤„ç†å¥½å…±äº«å†…å­˜çš„é—®é¢˜ã€‚æ‰“å°ç»“æœç¬¬äºŒè¡Œå°±æ˜¯åˆ‡ç‰‡ï¼Œåˆ‡ç‰‡çš„æŒ‡é’ˆå’ŒåŸæ¥æ•°ç»„çš„æŒ‡é’ˆæ˜¯ä¸åŒçš„ã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š&lt;/p&gt;
&lt;p&gt;æŠŠç¬¬ä¸€ä¸ªå¤§æ•°ç»„ä¼ é€’ç»™å‡½æ•°ä¼šæ¶ˆè€—å¾ˆå¤šå†…å­˜ï¼Œé‡‡ç”¨åˆ‡ç‰‡çš„æ–¹å¼ä¼ å‚å¯ä»¥é¿å…ä¸Šè¿°é—®é¢˜ã€‚åˆ‡ç‰‡æ˜¯å¼•ç”¨ä¼ é€’ï¼Œæ‰€ä»¥å®ƒä»¬ä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„å†…å­˜å¹¶ä¸”æ¯”ä½¿ç”¨æ•°ç»„æ›´æœ‰æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œä¾æ—§æœ‰åä¾‹ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import &amp;#34;testing&amp;#34;

func array() [1024]int {
	var x [1024]int
	for i := 0; i &amp;lt; len(x); i++ {
		x[i] = i
	}
	return x
}

func slice() []int {
	x := make([]int, 1024)
	for i := 0; i &amp;lt; len(x); i++ {
		x[i] = i
	}
	return x
}

func BenchmarkArray(b *testing.B) {
	for i := 0; i &amp;lt; b.N; i++ {
		array()
	}
}

func BenchmarkSlice(b *testing.B) {
	for i := 0; i &amp;lt; b.N; i++ {
		slice()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬åšä¸€æ¬¡æ€§èƒ½æµ‹è¯•ï¼Œå¹¶ä¸”ç¦ç”¨å†…è”å’Œä¼˜åŒ–ï¼Œæ¥è§‚å¯Ÿåˆ‡ç‰‡çš„å †ä¸Šå†…å­˜åˆ†é…çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  go test -bench . -benchmem -gcflags &amp;#34;-N -l&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¾“å‡ºç»“æœæ¯”è¾ƒâ€œä»¤äººæ„å¤–â€ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkArray-4          500000              3637 ns/op               0 B/op          0 alloc s/op
BenchmarkSlice-4          300000              4055 ns/op            8192 B/op          1 alloc s/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è§£é‡Šä¸€ä¸‹ä¸Šè¿°ç»“æœï¼Œåœ¨æµ‹è¯• Array çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯4æ ¸ï¼Œå¾ªç¯æ¬¡æ•°æ˜¯500000ï¼Œå¹³å‡æ¯æ¬¡æ‰§è¡Œæ—¶é—´æ˜¯3637 nsï¼Œæ¯æ¬¡æ‰§è¡Œå †ä¸Šåˆ†é…å†…å­˜æ€»é‡æ˜¯0ï¼Œåˆ†é…æ¬¡æ•°ä¹Ÿæ˜¯0 ã€‚&lt;/p&gt;
&lt;p&gt;è€Œåˆ‡ç‰‡çš„ç»“æœå°±â€œå·®â€ä¸€ç‚¹ï¼ŒåŒæ ·ä¹Ÿæ˜¯ç”¨çš„æ˜¯4æ ¸ï¼Œå¾ªç¯æ¬¡æ•°æ˜¯300000ï¼Œå¹³å‡æ¯æ¬¡æ‰§è¡Œæ—¶é—´æ˜¯4055 nsï¼Œä½†æ˜¯æ¯æ¬¡æ‰§è¡Œä¸€æ¬¡ï¼Œå †ä¸Šåˆ†é…å†…å­˜æ€»é‡æ˜¯8192ï¼Œåˆ†é…æ¬¡æ•°ä¹Ÿæ˜¯1 ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·å¯¹æ¯”çœ‹æ¥ï¼Œå¹¶éæ‰€æœ‰æ—¶å€™éƒ½é€‚åˆç”¨åˆ‡ç‰‡ä»£æ›¿æ•°ç»„ï¼Œå› ä¸ºåˆ‡ç‰‡åº•å±‚æ•°ç»„å¯èƒ½ä¼šåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œè€Œä¸”å°æ•°ç»„åœ¨æ ˆä¸Šæ‹·è´çš„æ¶ˆè€—ä¹Ÿæœªå¿…æ¯” make æ¶ˆè€—å¤§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;åˆ‡ç‰‡ä¸Šçš„æ•°æ®ç»“æ„&#34;&gt;åˆ‡ç‰‡ä¸Šçš„æ•°æ®ç»“æ„ &lt;a href=&#34;#%e5%88%87%e7%89%87%e4%b8%8a%e7%9a%84%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åˆ‡ç‰‡æœ¬èº«å¹¶ä¸æ˜¯åŠ¨æ€æ•°ç»„æˆ–è€…æ•°ç»„æŒ‡é’ˆã€‚å®ƒå†…éƒ¨å®ç°çš„æ•°æ®ç»“æ„é€šè¿‡æŒ‡é’ˆå¼•ç”¨åº•å±‚æ•°ç»„ï¼Œè®¾å®šç›¸å…³å±æ€§å°†æ•°æ®è¯»å†™æ“ä½œé™å®šåœ¨æŒ‡å®šçš„åŒºåŸŸå†…ã€‚&lt;strong&gt;åˆ‡ç‰‡æœ¬èº«æ˜¯ä¸€ä¸ªåªè¯»å¯¹è±¡ï¼Œå…¶å·¥ä½œæœºåˆ¶ç±»ä¼¼æ•°ç»„æŒ‡é’ˆçš„ä¸€ç§å°è£…ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åˆ‡ç‰‡ï¼ˆsliceï¼‰æ˜¯å¯¹æ•°ç»„ä¸€ä¸ªè¿ç»­ç‰‡æ®µçš„å¼•ç”¨ï¼Œæ‰€ä»¥åˆ‡ç‰‡æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼ˆå› æ­¤æ›´ç±»ä¼¼äº C/C++ ä¸­çš„æ•°ç»„ç±»å‹ï¼Œæˆ–è€… Python ä¸­çš„ list ç±»å‹ï¼‰ã€‚è¿™ä¸ªç‰‡æ®µå¯ä»¥æ˜¯æ•´ä¸ªæ•°ç»„ï¼Œæˆ–è€…æ˜¯ç”±èµ·å§‹å’Œç»ˆæ­¢ç´¢å¼•æ ‡è¯†çš„ä¸€äº›é¡¹çš„å­é›†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»ˆæ­¢ç´¢å¼•æ ‡è¯†çš„é¡¹ä¸åŒ…æ‹¬åœ¨åˆ‡ç‰‡å†…ã€‚åˆ‡ç‰‡æä¾›äº†ä¸€ä¸ªä¸æŒ‡å‘æ•°ç»„çš„åŠ¨æ€çª—å£ã€‚&lt;/p&gt;
&lt;p&gt;ç»™å®šé¡¹çš„åˆ‡ç‰‡ç´¢å¼•å¯èƒ½æ¯”ç›¸å…³æ•°ç»„çš„ç›¸åŒå…ƒç´ çš„ç´¢å¼•å°ã€‚å’Œæ•°ç»„ä¸åŒçš„æ˜¯ï¼Œåˆ‡ç‰‡çš„é•¿åº¦å¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹ï¼Œæœ€å°ä¸º 0 æœ€å¤§ä¸ºç›¸å…³æ•°ç»„çš„é•¿åº¦ï¼šåˆ‡ç‰‡æ˜¯ä¸€ä¸ªé•¿åº¦å¯å˜çš„æ•°ç»„ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type slice struct {
	array unsafe.Pointer
	len   int
	cap   int
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s1.jpeg&#34; alt=&#34;slice_å†…å­˜æ¨¡å‹&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆ‡ç‰‡çš„ç»“æ„ä½“ç”±3éƒ¨åˆ†æ„æˆï¼ŒPointer æ˜¯æŒ‡å‘ä¸€ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼Œlen ä»£è¡¨å½“å‰åˆ‡ç‰‡çš„é•¿åº¦ï¼Œcap æ˜¯å½“å‰åˆ‡ç‰‡çš„å®¹é‡ã€‚cap æ€»æ˜¯å¤§äºç­‰äº len çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s2.jpeg&#34; alt=&#34;57_3.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³ä» slice ä¸­å¾—åˆ°ä¸€å—å†…å­˜åœ°å€ï¼Œå¯ä»¥è¿™æ ·åšï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;s := make([]byte, 200)
ptr := unsafe.Pointer(&amp;amp;s[0])
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœåè¿‡æ¥å‘¢ï¼Ÿä» Go çš„å†…å­˜åœ°å€ä¸­æ„é€ ä¸€ä¸ª sliceã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var ptr unsafe.Pointer
var s1 = struct {
    addr uintptr
    len int
    cap int
}{ptr, length, length}
s := *(*[]byte)(unsafe.Pointer(&amp;amp;s1))
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ„é€ ä¸€ä¸ªè™šæ‹Ÿçš„ç»“æ„ä½“ï¼ŒæŠŠ slice çš„æ•°æ®ç»“æ„æ‹¼å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶è¿˜æœ‰æ›´åŠ ç›´æ¥çš„æ–¹æ³•ï¼Œåœ¨ Go çš„åå°„ä¸­å°±å­˜åœ¨ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„æ•°æ®ç»“æ„ SliceHeaderï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ„é€ ä¸€ä¸ª slice&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var o []byte
sliceHeader := (*reflect.SliceHeader)((unsafe.Pointer(&amp;amp;o)))
sliceHeader.Cap = length
sliceHeader.Len = length
sliceHeader.Data = uintptr(ptr)
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;åˆ›å»ºåˆ‡ç‰‡&#34;&gt;åˆ›å»ºåˆ‡ç‰‡ &lt;a href=&#34;#%e5%88%9b%e5%bb%ba%e5%88%87%e7%89%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;make å‡½æ•°å…è®¸åœ¨è¿è¡ŒæœŸåŠ¨æ€æŒ‡å®šæ•°ç»„é•¿åº¦ï¼Œç»•å¼€äº†æ•°ç»„ç±»å‹å¿…é¡»ä½¿ç”¨ç¼–è¯‘æœŸå¸¸é‡çš„é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºåˆ‡ç‰‡æœ‰ä¸¤ç§å½¢å¼ï¼Œmake åˆ›å»ºåˆ‡ç‰‡ï¼Œç©ºåˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;make-å’Œåˆ‡ç‰‡å­—é¢é‡&#34;&gt;make å’Œåˆ‡ç‰‡å­—é¢é‡ &lt;a href=&#34;#make-%e5%92%8c%e5%88%87%e7%89%87%e5%ad%97%e9%9d%a2%e9%87%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func makeslice(et *_type, len, cap int) slice {
	// æ ¹æ®åˆ‡ç‰‡çš„æ•°æ®ç±»å‹ï¼Œè·å–åˆ‡ç‰‡çš„æœ€å¤§å®¹é‡
	maxElements := maxSliceCap(et.size)
    // æ¯”è¾ƒåˆ‡ç‰‡çš„é•¿åº¦ï¼Œé•¿åº¦å€¼åŸŸåº”è¯¥åœ¨[0,maxElements]ä¹‹é—´
	if len &amp;lt; 0 || uintptr(len) &amp;gt; maxElements {
		panic(errorString(&amp;#34;makeslice: len out of range&amp;#34;))
	}
    // æ¯”è¾ƒåˆ‡ç‰‡çš„å®¹é‡ï¼Œå®¹é‡å€¼åŸŸåº”è¯¥åœ¨[len,maxElements]ä¹‹é—´
	if cap &amp;lt; len || uintptr(cap) &amp;gt; maxElements {
		panic(errorString(&amp;#34;makeslice: cap out of range&amp;#34;))
	}
    // æ ¹æ®åˆ‡ç‰‡çš„å®¹é‡ç”³è¯·å†…å­˜
	p := mallocgc(et.size*uintptr(cap), et, true)
    // è¿”å›ç”³è¯·å¥½å†…å­˜çš„åˆ‡ç‰‡çš„é¦–åœ°å€
	return slice{p, len, cap}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s3.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ç”¨ make å‡½æ•°åˆ›å»ºçš„ä¸€ä¸ª len = 4ï¼Œ cap = 6 çš„åˆ‡ç‰‡ã€‚å†…å­˜ç©ºé—´ç”³è¯·äº†6ä¸ª int ç±»å‹çš„å†…å­˜å¤§å°ã€‚ç”±äº len = 4ï¼Œæ‰€ä»¥åé¢2ä¸ªæš‚æ—¶è®¿é—®ä¸åˆ°ï¼Œä½†æ˜¯å®¹é‡è¿˜æ˜¯åœ¨çš„ã€‚è¿™æ—¶å€™æ•°ç»„é‡Œé¢æ¯ä¸ªå˜é‡éƒ½æ˜¯0 ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† make å‡½æ•°å¯ä»¥åˆ›å»ºåˆ‡ç‰‡ä»¥å¤–ï¼Œå­—é¢é‡ä¹Ÿå¯ä»¥åˆ›å»ºåˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s4.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ˜¯ç”¨å­—é¢é‡åˆ›å»ºçš„ä¸€ä¸ª len = 6ï¼Œcap = 6 çš„åˆ‡ç‰‡ï¼Œè¿™æ—¶å€™æ•°ç»„é‡Œé¢æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½åˆå§‹åŒ–å®Œæˆäº†ã€‚&lt;strong&gt;éœ€è¦æ³¨æ„çš„æ˜¯ [ ] é‡Œé¢ä¸è¦å†™æ•°ç»„çš„å®¹é‡ï¼Œå› ä¸ºå¦‚æœå†™äº†ä¸ªæ•°ä»¥åå°±æ˜¯æ•°ç»„äº†ï¼Œè€Œä¸æ˜¯åˆ‡ç‰‡äº†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s5.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§ç®€å•çš„å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡çš„æ–¹æ³•ã€‚å¦‚ä¸Šå›¾ã€‚ä¸Šå›¾å°± Slice A åˆ›å»ºå‡ºäº†ä¸€ä¸ª len = 3ï¼Œcap = 3 çš„åˆ‡ç‰‡ã€‚ä»åŸæ•°ç»„çš„ç¬¬äºŒä½å…ƒç´ (0æ˜¯ç¬¬ä¸€ä½)å¼€å§‹åˆ‡ï¼Œä¸€ç›´åˆ‡åˆ°ç¬¬å››ä½ä¸ºæ­¢(ä¸åŒ…æ‹¬ç¬¬äº”ä½)ã€‚åŒç†ï¼ŒSlice B åˆ›å»ºå‡ºäº†ä¸€ä¸ª len = 2ï¼Œcap = 4 çš„åˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;nil-å’Œç©ºåˆ‡ç‰‡&#34;&gt;nil å’Œç©ºåˆ‡ç‰‡ &lt;a href=&#34;#nil-%e5%92%8c%e7%a9%ba%e5%88%87%e7%89%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡ä¹Ÿæ˜¯å¸¸ç”¨çš„ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var slice []int
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s6.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;nil åˆ‡ç‰‡è¢«ç”¨åœ¨å¾ˆå¤šæ ‡å‡†åº“å’Œå†…ç½®å‡½æ•°ä¸­ï¼Œæè¿°ä¸€ä¸ªä¸å­˜åœ¨çš„åˆ‡ç‰‡çš„æ—¶å€™ï¼Œå°±éœ€è¦ç”¨åˆ° nil åˆ‡ç‰‡ã€‚æ¯”å¦‚å‡½æ•°åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œè¿”å›çš„åˆ‡ç‰‡å°±æ˜¯ nil åˆ‡ç‰‡ã€‚nil åˆ‡ç‰‡çš„æŒ‡é’ˆæŒ‡å‘ nilã€‚&lt;/p&gt;
&lt;p&gt;ç©ºåˆ‡ç‰‡ä¸€èˆ¬ä¼šç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç©ºçš„é›†åˆã€‚æ¯”å¦‚æ•°æ®åº“æŸ¥è¯¢ï¼Œä¸€æ¡ç»“æœä¹Ÿæ²¡æœ‰æŸ¥åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿”å›ä¸€ä¸ªç©ºåˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;silce := make( []int , 0 )
slice := []int{ }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s7.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç©ºåˆ‡ç‰‡å’Œ nil åˆ‡ç‰‡çš„åŒºåˆ«åœ¨äºï¼Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸æ˜¯nilï¼ŒæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰åˆ†é…ä»»ä½•å†…å­˜ç©ºé—´ï¼Œå³åº•å±‚å…ƒç´ åŒ…å«0ä¸ªå…ƒç´ ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åéœ€è¦è¯´æ˜çš„ä¸€ç‚¹æ˜¯ã€‚ä¸ç®¡æ˜¯ä½¿ç”¨ nil åˆ‡ç‰‡è¿˜æ˜¯ç©ºåˆ‡ç‰‡ï¼Œå¯¹å…¶è°ƒç”¨å†…ç½®å‡½æ•° appendï¼Œlen å’Œ cap çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;åˆ‡ç‰‡æ‰©å®¹&#34;&gt;åˆ‡ç‰‡æ‰©å®¹ &lt;a href=&#34;#%e5%88%87%e7%89%87%e6%89%a9%e5%ae%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é¦–å…ˆçœ‹çœ‹æºç &lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func growslice(et *_type, old slice, cap int) slice {
	if raceenabled {
		callerpc := getcallerpc(unsafe.Pointer(&amp;amp;et))
		racereadrangepc(old.array, uintptr(old.len*int(et.size)), callerpc, funcPC(growslice))
	}
	if msanenabled {
		msanread(old.array, uintptr(old.len*int(et.size)))
	}

	if et.size == 0 {
		// å¦‚æœæ–°è¦æ‰©å®¹çš„å®¹é‡æ¯”åŸæ¥çš„å®¹é‡è¿˜è¦å°ï¼Œè¿™ä»£è¡¨è¦ç¼©å®¹äº†ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥æŠ¥panicäº†ã€‚
		if cap &amp;lt; old.cap {
			panic(errorString(&amp;#34;growslice: cap out of range&amp;#34;))
		}

		// å¦‚æœå½“å‰åˆ‡ç‰‡çš„å¤§å°ä¸º0ï¼Œè¿˜è°ƒç”¨äº†æ‰©å®¹æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„å®¹é‡çš„åˆ‡ç‰‡è¿”å›ã€‚
		return slice{unsafe.Pointer(&amp;amp;zerobase), old.len, cap}
	}

    // è¿™é‡Œå°±æ˜¯æ‰©å®¹çš„ç­–ç•¥
	newcap := old.cap
	doublecap := newcap + newcap
	if cap &amp;gt; doublecap {
		newcap = cap
	} else {
		if old.len &amp;lt; 1024 {
			newcap = doublecap
		} else {
			// Check 0 &amp;lt; newcap to detect overflow
			// and prevent an infinite loop.
			for 0 &amp;lt; newcap &amp;amp;&amp;amp; newcap &amp;lt; cap {
				newcap += newcap / 4
			}
			// Set newcap to the requested cap when
			// the newcap calculation overflowed.
			if newcap &amp;lt;= 0 {
				newcap = cap
			}
		}
	}

	// è®¡ç®—æ–°çš„åˆ‡ç‰‡çš„å®¹é‡ï¼Œé•¿åº¦ã€‚
	var lenmem, newlenmem, capmem uintptr
	const ptrSize = unsafe.Sizeof((*byte)(nil))
	switch et.size {
	case 1:
		lenmem = uintptr(old.len)
		newlenmem = uintptr(cap)
		capmem = roundupsize(uintptr(newcap))
		newcap = int(capmem)
	case ptrSize:
		lenmem = uintptr(old.len) * ptrSize
		newlenmem = uintptr(cap) * ptrSize
		capmem = roundupsize(uintptr(newcap) * ptrSize)
		newcap = int(capmem / ptrSize)
	default:
		lenmem = uintptr(old.len) * et.size
		newlenmem = uintptr(cap) * et.size
		capmem = roundupsize(uintptr(newcap) * et.size)
		newcap = int(capmem / et.size)
	}

	// åˆ¤æ–­éæ³•çš„å€¼ï¼Œä¿è¯å®¹é‡æ˜¯åœ¨å¢åŠ ï¼Œå¹¶ä¸”å®¹é‡ä¸è¶…è¿‡æœ€å¤§å®¹é‡
	if cap &amp;lt; old.cap || uintptr(newcap) &amp;gt; maxSliceCap(et.size) {
		panic(errorString(&amp;#34;growslice: cap out of range&amp;#34;))
	}

	var p unsafe.Pointer
	if et.kind&amp;amp;kindNoPointers != 0 {
		// åœ¨è€çš„åˆ‡ç‰‡åé¢ç»§ç»­æ‰©å……å®¹é‡
		p = mallocgc(capmem, nil, false)
		// å°† lenmem è¿™ä¸ªå¤šä¸ª bytes ä» old.arrayåœ°å€ æ‹·è´åˆ° p çš„åœ°å€å¤„
		memmove(p, old.array, lenmem)
		// å…ˆå°† P åœ°å€åŠ ä¸Šæ–°çš„å®¹é‡å¾—åˆ°æ–°åˆ‡ç‰‡å®¹é‡çš„åœ°å€ï¼Œç„¶åå°†æ–°åˆ‡ç‰‡å®¹é‡åœ°å€åé¢çš„ capmem-newlenmem ä¸ª bytes è¿™å—å†…å­˜åˆå§‹åŒ–ã€‚ä¸ºä¹‹åç»§ç»­ append() æ“ä½œè…¾å‡ºç©ºé—´ã€‚
		memclrNoHeapPointers(add(p, newlenmem), capmem-newlenmem)
	} else {
		// é‡æ–°ç”³è¯·æ–°çš„æ•°ç»„ç»™æ–°åˆ‡ç‰‡
		// é‡æ–°ç”³è¯· capmen è¿™ä¸ªå¤§çš„å†…å­˜åœ°å€ï¼Œå¹¶ä¸”åˆå§‹åŒ–ä¸º0å€¼
		p = mallocgc(capmem, et, true)
		if !writeBarrier.enabled {
			// å¦‚æœè¿˜ä¸èƒ½æ‰“å¼€å†™é”ï¼Œé‚£ä¹ˆåªèƒ½æŠŠ lenmem å¤§å°çš„ bytes å­—èŠ‚ä» old.array æ‹·è´åˆ° p çš„åœ°å€å¤„
			memmove(p, old.array, lenmem)
		} else {
			// å¾ªç¯æ‹·è´è€çš„åˆ‡ç‰‡çš„å€¼
			for i := uintptr(0); i &amp;lt; lenmem; i += et.size {
				typedmemmove(et, add(p, i), add(old.array, i))
			}
		}
	}
	// è¿”å›æœ€ç»ˆæ–°åˆ‡ç‰‡ï¼Œå®¹é‡æ›´æ–°ä¸ºæœ€æ–°æ‰©å®¹ä¹‹åçš„å®¹é‡
	return slice{p, old.len, newcap}
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æ‰©å®¹ç­–ç•¥&#34;&gt;æ‰©å®¹ç­–ç•¥ &lt;a href=&#34;#%e6%89%a9%e5%ae%b9%e7%ad%96%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	slice := []int{10, 20, 30, 40}
	newSlice := append(slice, 50)
	fmt.Printf(&amp;#34;Before slice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, slice, &amp;amp;slice, len(slice), cap(slice))
	fmt.Printf(&amp;#34;Before newSlice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, newSlice, &amp;amp;newSlice, len(newSlice), cap(newSlice))
	newSlice[1] += 10
	fmt.Printf(&amp;#34;After slice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, slice, &amp;amp;slice, len(slice), cap(slice))
	fmt.Printf(&amp;#34;After newSlice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, newSlice, &amp;amp;newSlice, len(newSlice), cap(newSlice))
}
//è¾“å‡ºç»“æœ
Before slice = [10 20 30 40], Pointer = 0xc4200b0140, len = 4, cap = 4
Before newSlice = [10 20 30 40 50], Pointer = 0xc4200b0180, len = 5, cap = 8
After slice = [10 20 30 40], Pointer = 0xc4200b0140, len = 4, cap = 4
After newSlice = [10 30 30 40 50], Pointer = 0xc4200b0180, len = 5, cap = 8
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç”¨å›¾è¡¨ç¤º&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s8.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸Šæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹å‡ºï¼Œæ–°çš„åˆ‡ç‰‡å’Œä¹‹å‰çš„åˆ‡ç‰‡å·²ç»ä¸åŒäº†ï¼Œå› ä¸ºæ–°çš„åˆ‡ç‰‡æ›´æ”¹äº†ä¸€ä¸ªå€¼ï¼Œå¹¶æ²¡æœ‰å½±å“åˆ°åŸæ¥çš„æ•°ç»„ï¼Œæ–°åˆ‡ç‰‡æŒ‡å‘çš„æ•°ç»„æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ•°ç»„ã€‚å¹¶ä¸” cap å®¹é‡ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚è¿™ä¹‹é—´ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Go ä¸­åˆ‡ç‰‡æ‰©å®¹çš„ç­–ç•¥æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆåˆ¤æ–­ï¼Œå¦‚æœæ–°ç”³è¯·å®¹é‡ï¼ˆcapï¼‰å¤§äº2å€çš„æ—§å®¹é‡ï¼ˆold.capï¼‰ï¼Œæœ€ç»ˆå®¹é‡ï¼ˆnewcapï¼‰å°±æ˜¯æ–°ç”³è¯·çš„å®¹é‡ï¼ˆcapï¼‰&lt;/li&gt;
&lt;li&gt;å¦åˆ™åˆ¤æ–­ï¼Œå¦‚æœæ—§åˆ‡ç‰‡çš„é•¿åº¦å°äº1024ï¼Œåˆ™æœ€ç»ˆå®¹é‡(newcap)å°±æ˜¯æ—§å®¹é‡(old.cap)çš„ä¸¤å€ï¼Œå³ï¼ˆnewcap=doublecapï¼‰&lt;/li&gt;
&lt;li&gt;å¦åˆ™åˆ¤æ–­ï¼Œå¦‚æœæ—§åˆ‡ç‰‡é•¿åº¦å¤§äºç­‰äº1024ï¼Œåˆ™æœ€ç»ˆå®¹é‡ï¼ˆnewcapï¼‰ä»æ—§å®¹é‡ï¼ˆold.capï¼‰å¼€å§‹å¾ªç¯å¢åŠ åŸæ¥çš„ 1/4ï¼Œå³ï¼ˆnewcap=old.cap,for {newcap += newcap/4}ï¼‰ç›´åˆ°æœ€ç»ˆå®¹é‡ï¼ˆnewcapï¼‰å¤§äºç­‰äºæ–°ç”³è¯·çš„å®¹é‡(cap)ï¼Œå³ï¼ˆnewcap &amp;gt;= capï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ€ç»ˆå®¹é‡ï¼ˆcapï¼‰è®¡ç®—å€¼æº¢å‡ºï¼Œåˆ™æœ€ç»ˆå®¹é‡ï¼ˆcapï¼‰å°±æ˜¯æ–°ç”³è¯·å®¹é‡ï¼ˆcapï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šæ‰©å®¹æ‰©å¤§çš„å®¹é‡éƒ½æ˜¯é’ˆå¯¹åŸæ¥çš„å®¹é‡è€Œè¨€çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹åŸæ¥æ•°ç»„çš„é•¿åº¦è€Œè¨€çš„ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ–°æ•°ç»„-or-è€æ•°ç»„-&#34;&gt;æ–°æ•°ç»„ or è€æ•°ç»„ ï¼Ÿ &lt;a href=&#34;#%e6%96%b0%e6%95%b0%e7%bb%84-or-%e8%80%81%e6%95%b0%e7%bb%84-&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å†è°ˆè°ˆæ‰©å®¹ä¹‹åçš„æ•°ç»„ä¸€å®šæ˜¯æ–°çš„ä¹ˆï¼Ÿè¿™ä¸ªä¸ä¸€å®šï¼Œåˆ†ä¸¤ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;æƒ…å†µä¸€ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	array := [4]int{10, 20, 30, 40}
	slice := array[0:2]
	newSlice := append(slice, 50)
	fmt.Printf(&amp;#34;Before slice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, slice, &amp;amp;slice, len(slice), cap(slice))
	fmt.Printf(&amp;#34;Before newSlice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, newSlice, &amp;amp;newSlice, len(newSlice), cap(newSlice))
	newSlice[1] += 10
	fmt.Printf(&amp;#34;After slice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, slice, &amp;amp;slice, len(slice), cap(slice))
	fmt.Printf(&amp;#34;After newSlice = %v, Pointer = %p, len = %d, cap = %d\n&amp;#34;, newSlice, &amp;amp;newSlice, len(newSlice), cap(newSlice))
	fmt.Printf(&amp;#34;After array = %v\n&amp;#34;, array)
}

//è¾“å‡º
Before slice = [10 20], Pointer = 0xc4200c0040, len = 2, cap = 4
Before newSlice = [10 20 50], Pointer = 0xc4200c0060, len = 3, cap = 4
After slice = [10 30], Pointer = 0xc4200c0040, len = 2, cap = 4
After newSlice = [10 30 50], Pointer = 0xc4200c0060, len = 3, cap = 4
After array = [10 30 50 40]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æŠŠä¸Šè¿°è¿‡ç¨‹ç”¨å›¾è¡¨ç¤ºå‡ºæ¥ï¼Œå¦‚ä¸‹å›¾ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-s9.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ‰“å°çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å®¹ä»¥åå¹¶æ²¡æœ‰æ–°å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæ‰©å®¹å‰åçš„æ•°ç»„éƒ½æ˜¯åŒä¸€ä¸ªï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†æ–°çš„åˆ‡ç‰‡ä¿®æ”¹äº†ä¸€ä¸ªå€¼ï¼Œä¹Ÿå½±å“åˆ°äº†è€çš„åˆ‡ç‰‡äº†ã€‚å¹¶ä¸” append() æ“ä½œä¹Ÿæ”¹å˜äº†åŸæ¥æ•°ç»„é‡Œé¢çš„å€¼ã€‚ä¸€ä¸ª append() æ“ä½œå½±å“äº†è¿™ä¹ˆå¤šåœ°æ–¹ï¼Œå¦‚æœåŸæ•°ç»„ä¸Šæœ‰å¤šä¸ªåˆ‡ç‰‡ï¼Œé‚£ä¹ˆè¿™äº›åˆ‡ç‰‡éƒ½ä¼šè¢«å½±å“ï¼æ— æ„é—´å°±äº§ç”Ÿäº†è«åçš„ bugï¼&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µï¼Œç”±äºåŸæ•°ç»„è¿˜æœ‰å®¹é‡å¯ä»¥æ‰©å®¹ï¼Œæ‰€ä»¥æ‰§è¡Œ append() æ“ä½œä»¥åï¼Œä¼šåœ¨åŸæ•°ç»„ä¸Šç›´æ¥æ“ä½œï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å®¹ä»¥åçš„æ•°ç»„è¿˜æ˜¯æŒ‡å‘åŸæ¥çš„æ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µä¹Ÿæå®¹æ˜“å‡ºç°åœ¨å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡æ—¶å€™ï¼Œç¬¬ä¸‰ä¸ªå‚æ•° cap ä¼ å€¼çš„æ—¶å€™ï¼Œå¦‚æœç”¨å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡ï¼Œcap å¹¶ä¸ç­‰äºæŒ‡å‘æ•°ç»„çš„æ€»å®¹é‡ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µå°±ä¼šå‘ç”Ÿã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice := array[1:2:3]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ä¸Šé¢è¿™ç§æƒ…å†µéå¸¸å±é™©ï¼Œæåº¦å®¹æ˜“äº§ç”Ÿ bug ã€‚&lt;/strong&gt;
å»ºè®®ç”¨å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡çš„æ—¶å€™ï¼Œcap çš„å€¼ä¸€å®šè¦ä¿æŒæ¸…é†’ï¼Œé¿å…å…±äº«åŸæ•°ç»„å¯¼è‡´çš„ bugã€‚&lt;/p&gt;
&lt;p&gt;æƒ…å†µäºŒï¼š&lt;/p&gt;
&lt;p&gt;æƒ…å†µäºŒå…¶å®å°±æ˜¯åœ¨æ‰©å®¹ç­–ç•¥é‡Œé¢ä¸¾çš„ä¾‹å­ï¼Œåœ¨é‚£ä¸ªä¾‹å­ä¸­ä¹‹æ‰€ä»¥ç”Ÿæˆäº†æ–°çš„åˆ‡ç‰‡ï¼Œæ˜¯å› ä¸ºåŸæ¥æ•°ç»„çš„å®¹é‡å·²ç»è¾¾åˆ°äº†æœ€å¤§å€¼ï¼Œå†æƒ³æ‰©å®¹ï¼Œ Go é»˜è®¤ä¼šå…ˆå¼€ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼ŒæŠŠåŸæ¥çš„å€¼æ‹·è´è¿‡æ¥ï¼Œç„¶åå†æ‰§è¡Œ append() æ“ä½œã€‚è¿™ç§æƒ…å†µä¸æ¯«ä¸å½±å“åŸæ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å»ºè®®å°½é‡é¿å…æƒ…å†µä¸€ï¼Œå°½é‡ä½¿ç”¨æƒ…å†µäºŒï¼Œé¿å… bug äº§ç”Ÿã€‚
ä¸¾ä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {

    s1 := []int{1, 2, 3}
    s2 := s1[1:]
    s2[1] = 4
    fmt.Println(s1)
    s2 = append(s2, 5, 6, 7)
    fmt.Println(s1)
}
//output 
[1 2 4]
[1 2 4]
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;åˆ‡ç‰‡æ‹·è´&#34;&gt;åˆ‡ç‰‡æ‹·è´ &lt;a href=&#34;#%e5%88%87%e7%89%87%e6%8b%b7%e8%b4%9d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Slice ä¸­æ‹·è´æ–¹æ³•æœ‰2ä¸ªã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func slicecopy(to, fm slice, width uintptr) int {
	// å¦‚æœæºåˆ‡ç‰‡æˆ–è€…ç›®æ ‡åˆ‡ç‰‡æœ‰ä¸€ä¸ªé•¿åº¦ä¸º0ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦æ‹·è´ï¼Œç›´æ¥ return 
	if fm.len == 0 || to.len == 0 {
		return 0
	}
	// n è®°å½•ä¸‹æºåˆ‡ç‰‡æˆ–è€…ç›®æ ‡åˆ‡ç‰‡è¾ƒçŸ­çš„é‚£ä¸€ä¸ªçš„é•¿åº¦
	n := fm.len
	if to.len &amp;lt; n {
		n = to.len
	}
	// å¦‚æœå…¥å‚ width = 0ï¼Œä¹Ÿä¸éœ€è¦æ‹·è´äº†ï¼Œè¿”å›è¾ƒçŸ­çš„åˆ‡ç‰‡çš„é•¿åº¦
	if width == 0 {
		return n
	}
	// å¦‚æœå¼€å¯äº†ç«äº‰æ£€æµ‹
	if raceenabled {
		callerpc := getcallerpc(unsafe.Pointer(&amp;amp;to))
		pc := funcPC(slicecopy)
		racewriterangepc(to.array, uintptr(n*int(width)), callerpc, pc)
		racereadrangepc(fm.array, uintptr(n*int(width)), callerpc, pc)
	}
	// å¦‚æœå¼€å¯äº† The memory sanitizer (msan)
	if msanenabled {
		msanwrite(to.array, uintptr(n*int(width)))
		msanread(fm.array, uintptr(n*int(width)))
	}

	size := uintptr(n) * width
	if size == 1 { 
		// TODO: is this still worth it with new memmove impl?
		// å¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆæŒ‡é’ˆç›´æ¥è½¬æ¢å³å¯
		*(*byte)(to.array) = *(*byte)(fm.array) // known to be a byte pointer
	} else {
		// å¦‚æœä¸æ­¢ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå°±æŠŠ size ä¸ª bytes ä» fm.array åœ°å€å¼€å§‹ï¼Œæ‹·è´åˆ° to.array åœ°å€ä¹‹å
		memmove(to.array, fm.array, size)
	}
	return n
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œslicecopy æ–¹æ³•ä¼šæŠŠæºåˆ‡ç‰‡å€¼(å³ fm Slice )ä¸­çš„å…ƒç´ å¤åˆ¶åˆ°ç›®æ ‡åˆ‡ç‰‡(å³ to Slice )ä¸­ï¼Œå¹¶è¿”å›è¢«å¤åˆ¶çš„å…ƒç´ ä¸ªæ•°ï¼Œcopy çš„ä¸¤ä¸ªç±»å‹å¿…é¡»ä¸€è‡´ã€‚slicecopy æ–¹æ³•æœ€ç»ˆçš„å¤åˆ¶ç»“æœå–å†³äºè¾ƒçŸ­çš„é‚£ä¸ªåˆ‡ç‰‡ï¼Œå½“è¾ƒçŸ­çš„åˆ‡ç‰‡å¤åˆ¶å®Œæˆï¼Œæ•´ä¸ªå¤åˆ¶è¿‡ç¨‹å°±å…¨éƒ¨å®Œæˆäº†ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/go-s10.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¯´åˆ°æ‹·è´ï¼Œåˆ‡ç‰‡ä¸­æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	slice := []int{10, 20, 30, 40}
	for index, value := range slice {
		fmt.Printf(&amp;#34;value = %d , value-addr = %x , slice-addr = %x\n&amp;#34;, value, &amp;amp;value, &amp;amp;slice[index])
	}
}
//è¾“å‡º
value = 10 , value-addr = c4200aedf8 , slice-addr = c4200b0320
value = 20 , value-addr = c4200aedf8 , slice-addr = c4200b0328
value = 30 , value-addr = c4200aedf8 , slice-addr = c4200b0330
value = 40 , value-addr = c4200aedf8 , slice-addr = c4200b0338
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/go-s11.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç”±äº Value æ˜¯å€¼æ‹·è´çš„ï¼Œå¹¶éå¼•ç”¨ä¼ é€’ï¼Œæ‰€ä»¥ç›´æ¥æ”¹ Value æ˜¯è¾¾ä¸åˆ°æ›´æ”¹åŸåˆ‡ç‰‡å€¼çš„ç›®çš„çš„ï¼Œéœ€è¦é€šè¿‡ &amp;amp;slice[index] è·å–çœŸå®çš„åœ°å€ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Go-channelæ€»ç»“</title>
      <link>https://abnerxc.github.io/go/channel%E6%80%BB%E7%BB%93/</link>
      <pubDate>Mon, 15 Mar 2021 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/channel%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;h1 id=&#34;channelçš„ä½¿ç”¨åœºæ™¯&#34;&gt;channelçš„ä½¿ç”¨åœºæ™¯ &lt;a href=&#34;#channel%e7%9a%84%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æŠŠchannelç”¨åœ¨æ•°æ®æµåŠ¨çš„åœ°æ–¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯ä¼ é€’ã€æ¶ˆæ¯è¿‡æ»¤&lt;/li&gt;
&lt;li&gt;ä¿¡å·å¹¿æ’­&lt;/li&gt;
&lt;li&gt;äº‹ä»¶è®¢é˜…ä¸å¹¿æ’­&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ã€å“åº”è½¬å‘&lt;/li&gt;
&lt;li&gt;ä»»åŠ¡åˆ†å‘&lt;/li&gt;
&lt;li&gt;ç»“æœæ±‡æ€»&lt;/li&gt;
&lt;li&gt;å¹¶å‘æ§åˆ¶&lt;/li&gt;
&lt;li&gt;åŒæ­¥ä¸å¼‚æ­¥&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;channelçš„åŸºæœ¬æ“ä½œå’Œæ³¨æ„äº‹é¡¹&#34;&gt;channelçš„åŸºæœ¬æ“ä½œå’Œæ³¨æ„äº‹é¡¹ &lt;a href=&#34;#channel%e7%9a%84%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c%e5%92%8c%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;channel å­˜åœ¨3ç§çŠ¶æ€&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;nil,æœªåˆå§‹åŒ–ï¼Œåˆšåˆšç”³æ˜æˆ–è€…æ‰‹åŠ¨å¤åˆ¶ä¸ºnil&lt;/li&gt;
&lt;li&gt;activeï¼Œæ­£å¸¸è¿è¡Œä¸­çš„å¯è¯»å¯å†™&lt;/li&gt;
&lt;li&gt;closed,å…³é—­æ—¶ï¼Œ&lt;strong&gt;åƒä¸‡ä¸è¦è®¤ä¸ºå…³é—­ä»¥åï¼Œchannelçš„å€¼æ˜¯nil&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;channel å¯è¿›è¡Œ3ç§æ“ä½œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯»&lt;/li&gt;
&lt;li&gt;å†™&lt;/li&gt;
&lt;li&gt;å…³é—­&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;3ç§çŠ¶æ€å­˜åœ¨9ç§æƒ…å†µ&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ“ä½œ&lt;/th&gt;
          &lt;th&gt;nilçš„channel&lt;/th&gt;
          &lt;th&gt;æ­£å¸¸channel&lt;/th&gt;
          &lt;th&gt;å·²å…³é—­channel&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&amp;lt;- ch&lt;/td&gt;
          &lt;td&gt;é˜»å¡&lt;/td&gt;
          &lt;td&gt;æˆåŠŸoré˜»å¡&lt;/td&gt;
          &lt;td&gt;è¯»åˆ°é›¶å€¼&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ch &amp;lt;-&lt;/td&gt;
          &lt;td&gt;é˜»å¡&lt;/td&gt;
          &lt;td&gt;æˆåŠŸoré˜»å¡&lt;/td&gt;
          &lt;td&gt;panic&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;close(ch)&lt;/td&gt;
          &lt;td&gt;panic&lt;/td&gt;
          &lt;td&gt;æˆåŠŸ&lt;/td&gt;
          &lt;td&gt;panic&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¯¹äºnilé€šé“çš„æƒ…å†µï¼Œä¹Ÿå¹¶éå®Œå…¨éµå¾ªä¸Šè¡¨ï¼Œæœ‰1ä¸ªç‰¹æ®Šåœºæ™¯ï¼šå½“nilçš„é€šé“åœ¨selectçš„æŸä¸ªcaseä¸­æ—¶ï¼Œè¿™ä¸ªcaseä¼šé˜»å¡ï¼Œä½†ä¸ä¼šé€ æˆæ­»é”&lt;/p&gt;
&lt;h1 id=&#34;ä½¿ç”¨for-rangeè¯»channel&#34;&gt;ä½¿ç”¨for rangeè¯»channel &lt;a href=&#34;#%e4%bd%bf%e7%94%a8for-range%e8%af%bbchannel&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“éœ€è¦ä¸æ–­ä»channelè¯»å–æ•°æ®æ—¶ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨for-rangeè¯»å–channelï¼Œè¿™æ ·æ—¢å®‰å…¨åˆä¾¿åˆ©ï¼Œå½“channelå…³é—­æ—¶ï¼Œforå¾ªç¯ä¼šè‡ªåŠ¨é€€å‡ºï¼Œæ— éœ€ä¸»åŠ¨ç›‘æµ‹channelæ˜¯å¦å…³é—­ï¼Œå¯ä»¥é˜²æ­¢è¯»å–å·²ç»å…³é—­çš„channelï¼Œé€ æˆè¯»åˆ°æ•°æ®ä¸ºé€šé“æ‰€å­˜å‚¨çš„æ•°æ®ç±»å‹çš„é›¶å€¼ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;for x := range ch{
    fmt.Println(x)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨vok---ch--selectæ“ä½œåˆ¤æ–­channelæ˜¯å¦å…³é—­&#34;&gt;ä½¿ç”¨v,ok := &amp;lt;-ch + selectæ“ä½œåˆ¤æ–­channelæ˜¯å¦å…³é—­ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8vok---ch--select%e6%93%8d%e4%bd%9c%e5%88%a4%e6%96%adchannel%e6%98%af%e5%90%a6%e5%85%b3%e9%97%ad&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;v,ok := &amp;lt;-ch + select&lt;/code&gt;æ“ä½œåˆ¤æ–­channelæ˜¯å¦å…³é—­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;okçš„ç»“æœå’Œå«ä¹‰ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- `true`ï¼šè¯»åˆ°é€šé“æ•°æ®ï¼Œä¸ç¡®å®šæ˜¯å¦å…³é—­ï¼Œå¯èƒ½channelè¿˜æœ‰ä¿å­˜çš„æ•°æ®ï¼Œä½†channelå·²å…³é—­ã€‚
- `false`ï¼šé€šé“å…³é—­ï¼Œæ— æ•°æ®è¯»åˆ°ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»å…³é—­çš„channelè¯»å€¼è¯»åˆ°æ˜¯channelæ‰€ä¼ é€’æ•°æ®ç±»å‹çš„é›¶å€¼ï¼Œè¿™ä¸ªé›¶å€¼æœ‰å¯èƒ½æ˜¯å‘é€è€…å‘é€çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯channelå…³é—­äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;_, ok := &amp;lt;-ch&lt;/code&gt;ä¸selecté…åˆä½¿ç”¨çš„ï¼Œå½“okä¸ºfalseæ—¶ï¼Œä»£è¡¨äº†channelå·²ç»closeã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è§£é‡ŠåŸå› ï¼Œ&lt;code&gt;_,ok := &amp;lt;-ch&lt;/code&gt;å¯¹åº”çš„å‡½æ•°æ˜¯&lt;code&gt;func chanrecv(c *hchan, ep unsafe.Pointer, block bool) (selected, received bool)&lt;/code&gt;ï¼Œå…¥å‚blockå«ä¹‰æ˜¯å½“å‰goroutineæ˜¯å¦å¯é˜»å¡ï¼Œå½“blockä¸ºfalseä»£è¡¨çš„æ˜¯selectæ“ä½œï¼Œä¸å¯é˜»å¡å½“å‰goroutineçš„åœ¨channelæ“ä½œï¼Œå¦åˆ™æ˜¯æ™®é€šæ“ä½œï¼ˆå³&lt;code&gt;_, ok&lt;/code&gt;ä¸åœ¨selectä¸­ï¼‰ã€‚è¿”å›å€¼selectedä»£è¡¨å½“å‰æ“ä½œæ˜¯å¦æˆåŠŸï¼Œä¸»è¦ä¸ºselectæœåŠ¡ï¼Œè¿”å›**receivedä»£è¡¨æ˜¯å¦ä»channelè¯»åˆ°æœ‰æ•ˆå€¼ã€‚**å®ƒæœ‰3ç§è¿”å›å€¼æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;blockä¸ºfalseï¼Œå³æ‰§è¡Œselectæ—¶ï¼Œå¦‚æœchannelä¸ºç©ºï¼Œè¿”å›(false,false)ï¼Œä»£è¡¨selectæ“ä½œå¤±è´¥ï¼Œæ²¡æ¥æ”¶åˆ°å€¼ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œå¦‚æœchannelå·²ç»å…³é—­ï¼Œå¹¶ä¸”æ²¡æœ‰æ•°æ®ï¼Œepå³æ¥æ”¶æ•°æ®çš„å˜é‡è®¾ç½®ä¸ºé›¶å€¼ï¼Œè¿”å›(true,false)ï¼Œä»£è¡¨selectæ“ä½œæˆåŠŸï¼Œä½†channelå·²å…³é—­ï¼Œæ²¡è¯»åˆ°æœ‰æ•ˆå€¼ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œå…¶ä»–è¯»åˆ°æœ‰æ•ˆæ•°æ®çš„æƒ…å†µï¼Œè¿”å›(true,ture)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬è€ƒè™‘_, ok := &amp;lt;-chå’Œselectç»“åˆä½¿ç”¨çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;æƒ…å†µ1ï¼šå½“chanrecvè¿”å›(false,false)æ—¶ï¼Œæœ¬è´¨æ˜¯selectæ“ä½œå¤±è´¥äº†ï¼Œæ‰€ä»¥ç›¸å…³çš„caseä¼šé˜»å¡ï¼Œä¸ä¼šæ‰§è¡Œï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
func main() {
	ch := make(chan int)
	select {
	case v, ok := &amp;lt;-ch:
		fmt.Printf(&amp;#34;v: %v, ok: %v\n&amp;#34;, v, ok)
	default:
		fmt.Println(&amp;#34;nothing&amp;#34;)
	}
}

// ç»“æœï¼š
// nothing
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æƒ…å†µ2ï¼šä¸‹é¢çš„ç»“æœä¼šæ˜¯é›¶å€¼å’Œfalseï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	ch := make(chan int)

	// å¢åŠ å…³é—­
	close(ch)

	select {
	case v, ok := &amp;lt;-ch:
		fmt.Printf(&amp;#34;v: %v, ok: %v\n&amp;#34;, v, ok)
	}
}

// v: 0, ok: false
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æƒ…å†µ3çš„receivedä¸ºtrueï¼Œå³_, okä¸­çš„okä¸ºtrueï¼Œä¸åšè®¨è®ºäº†ï¼Œåªè®¨è®ºokä¸ºfalseçš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;æœ€åokä¸ºfalseçš„æ—¶å€™ï¼Œåªæœ‰æƒ…å†µ2ï¼Œæ­¤æ—¶channelå¿…ç„¶å·²ç»å…³é—­ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åœ¨selectä¸­ç”¨okåˆ¤æ–­channelæ˜¯å¦å·²ç»å…³é—­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	ch := make(chan int, 1)

	// å‘é€1ä¸ªæ•°æ®å…³é—­channel
	ch &amp;lt;- 1
	close(ch)
	print(&amp;#34;close channel\n&amp;#34;)

	// ä¸åœè¯»æ•°æ®ç›´åˆ°channelæ²¡æœ‰æœ‰æ•ˆæ•°æ®
	for {
		select {
		case v, ok := &amp;lt;-ch:
			print(&amp;#34;v: &amp;#34;, v, &amp;#34;, ok:&amp;#34;, ok, &amp;#34;\n&amp;#34;)
			if !ok {
				print(&amp;#34;channel is close\n&amp;#34;)
				return
			}	
		default:
			print(&amp;#34;nothing\n&amp;#34;)
		}
	}
}

// ç»“æœ
// close channel
// v: 1, ok:true
// v: 0, ok:false
// channel is close
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨selectå¤„ç†å¤šä¸ªchannel&#34;&gt;ä½¿ç”¨selectå¤„ç†å¤šä¸ªchannel &lt;a href=&#34;#%e4%bd%bf%e7%94%a8select%e5%a4%84%e7%90%86%e5%a4%9a%e4%b8%aachannel&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
éœ€è¦å¯¹å¤šä¸ªé€šé“è¿›è¡ŒåŒæ—¶å¤„ç†ï¼Œä½†åªå¤„ç†æœ€å…ˆå‘ç”Ÿçš„channelæ—¶&lt;/li&gt;
&lt;li&gt;åŸç†
&lt;code&gt;select&lt;/code&gt;å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªé€šé“çš„æƒ…å†µï¼Œåªå¤„ç†æœªé˜»å¡çš„caseã€‚&lt;strong&gt;å½“é€šé“ä¸ºnilæ—¶ï¼Œå¯¹åº”çš„caseæ°¸è¿œä¸ºé˜»å¡ï¼Œæ— è®ºè¯»å†™ã€‚ç‰¹æ®Šå…³æ³¨ï¼šæ™®é€šæƒ…å†µä¸‹ï¼Œå¯¹nilçš„é€šé“å†™æ“ä½œæ˜¯è¦panicçš„ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// åˆ†é…jobæ—¶ï¼Œå¦‚æœæ”¶åˆ°å…³é—­çš„é€šçŸ¥åˆ™é€€å‡ºï¼Œä¸åˆ†é…job
func (h *Handler) handle(job *Job) {
    select {
    case h.jobCh&amp;lt;-job:
        return 
    case &amp;lt;-h.stopCh:
        return
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨channelçš„å£°æ˜æ§åˆ¶è¯»å†™æƒé™&#34;&gt;ä½¿ç”¨channelçš„å£°æ˜æ§åˆ¶è¯»å†™æƒé™ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8channel%e7%9a%84%e5%a3%b0%e6%98%8e%e6%8e%a7%e5%88%b6%e8%af%bb%e5%86%99%e6%9d%83%e9%99%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœºæ™¯
åç¨‹å¯¹æŸä¸ªé€šé“åªè¯»æˆ–åªå†™æ—¶&lt;/p&gt;
&lt;p&gt;ç›®çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ä»£ç æ›´æ˜“è¯»ã€æ›´æ˜“ç»´æŠ¤ï¼Œ&lt;/li&gt;
&lt;li&gt;é˜²æ­¢åªè¯»åç¨‹å¯¹é€šé“è¿›è¡Œå†™æ•°æ®ï¼Œä½†é€šé“å·²å…³é—­ï¼Œé€ æˆpanicã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨æ³•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœåç¨‹å¯¹æŸä¸ªchannelåªæœ‰å†™æ“ä½œï¼Œåˆ™è¿™ä¸ªchannelå£°æ˜ä¸ºåªå†™ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœåç¨‹å¯¹æŸä¸ªchannelåªæœ‰è¯»æ“ä½œï¼Œåˆ™è¿™ä¸ªchanneå£°æ˜ä¸ºåªè¯»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// åªæœ‰generatorè¿›è¡Œå¯¹outChè¿›è¡Œå†™æ“ä½œï¼Œè¿”å›å£°æ˜
// &amp;lt;-chan intï¼Œå¯ä»¥é˜²æ­¢å…¶ä»–åç¨‹ä¹±ç”¨æ­¤é€šé“ï¼Œé€ æˆéšè—bug
func generator(int n) &amp;lt;-chan int {
    outCh := make(chan int)
    go func(){
        for i:=0;i&amp;lt;n;i++{
            outCh&amp;lt;-i
        }
    }()
    return outCh
}

// consumeråªè¯»inChçš„æ•°æ®ï¼Œå£°æ˜ä¸º&amp;lt;-chan int
// å¯ä»¥é˜²æ­¢å®ƒå‘inChå†™æ•°æ®
func consumer(inCh &amp;lt;-chan int) {
    for x := range inCh {
        fmt.Println(x)
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨ç¼“å†²channelå¢å¼ºå¹¶å‘&#34;&gt;ä½¿ç”¨ç¼“å†²channelå¢å¼ºå¹¶å‘ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e7%bc%93%e5%86%b2channel%e5%a2%9e%e5%bc%ba%e5%b9%b6%e5%8f%91&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
å¼‚æ­¥&lt;/li&gt;
&lt;li&gt;åŸç†
æœ‰ç¼“å†²é€šé“å¯ä¾›å¤šä¸ªåç¨‹åŒæ—¶å¤„ç†ï¼Œåœ¨ä¸€å®šç¨‹åº¦å¯æé«˜å¹¶å‘æ€§ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// æ— ç¼“å†²
ch1 := make(chan int)
ch2 := make(chan int, 0)
// æœ‰ç¼“å†²
ch3 := make(chan int, 1)
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// ä½¿ç”¨5ä¸ª`do`åç¨‹åŒæ—¶å¤„ç†è¾“å…¥æ•°æ®
func test() {
    inCh := generator(100)
    outCh := make(chan int, 10)

    for i := 0; i &amp;lt; 5; i++ {
        go do(inCh, outCh)
    }

    for r := range outCh {
        fmt.Println(r)
    }
}

func do(inCh &amp;lt;-chan int, outCh chan&amp;lt;- int) {
    for v := range inCh {
        outCh &amp;lt;- v * v
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä¸ºæ“ä½œåŠ ä¸Šè¶…æ—¶&#34;&gt;ä¸ºæ“ä½œåŠ ä¸Šè¶…æ—¶ &lt;a href=&#34;#%e4%b8%ba%e6%93%8d%e4%bd%9c%e5%8a%a0%e4%b8%8a%e8%b6%85%e6%97%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
å¼‚æ­¥&lt;/li&gt;
&lt;li&gt;åŸç†
ä½¿ç”¨&lt;code&gt;select&lt;/code&gt;å’Œ&lt;code&gt;time.After&lt;/code&gt;ï¼Œçœ‹æ“ä½œå’Œå®šæ—¶å™¨å“ªä¸ªå…ˆè¿”å›ï¼Œå¤„ç†å…ˆå®Œæˆçš„ï¼Œå°±è¾¾åˆ°äº†è¶…æ—¶æ§åˆ¶çš„æ•ˆæœ&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
func doWithTimeOut(timeout time.Duration) (int, error) {
	select {
	case ret := &amp;lt;-do():
		return ret, nil
	case &amp;lt;-time.After(timeout):
		return 0, errors.New(&amp;#34;timeout&amp;#34;)
	}
}

func do() &amp;lt;-chan int {
	outCh := make(chan int)
	go func() {
		// do work
	}()
	return outCh
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨closechå…³é—­æ‰€æœ‰ä¸‹æ¸¸åç¨‹&#34;&gt;ä½¿ç”¨&lt;code&gt;close(ch)&lt;/code&gt;å…³é—­æ‰€æœ‰ä¸‹æ¸¸åç¨‹ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8closech%e5%85%b3%e9%97%ad%e6%89%80%e6%9c%89%e4%b8%8b%e6%b8%b8%e5%8d%8f%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
é€€å‡ºæ—¶ï¼Œæ˜¾ç¤ºé€šçŸ¥æ‰€æœ‰åç¨‹é€€å‡º&lt;/li&gt;
&lt;li&gt;åŸç†
æ‰€æœ‰è¯»chçš„åç¨‹éƒ½ä¼šæ”¶åˆ°close(ch)çš„ä¿¡å·&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
func (h *Handler) Stop() {
    close(h.stopCh)

    // å¯ä»¥ä½¿ç”¨WaitGroupç­‰å¾…æ‰€æœ‰åç¨‹é€€å‡º
}

// æ”¶åˆ°åœæ­¢åï¼Œä¸å†å¤„ç†è¯·æ±‚
func (h *Handler) loop() error {
    for {
        select {
        case req := &amp;lt;-h.reqCh:
            go handle(req)
        case &amp;lt;-h.stopCh:
            return
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨chan-structä½œä¸ºä¿¡å·channel&#34;&gt;ä½¿ç”¨chan struct{}ä½œä¸ºä¿¡å·channel &lt;a href=&#34;#%e4%bd%bf%e7%94%a8chan-struct%e4%bd%9c%e4%b8%ba%e4%bf%a1%e5%8f%b7channel&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
ä½¿ç”¨channelä¼ é€’ä¿¡å·ï¼Œè€Œä¸æ˜¯ä¼ é€’æ•°æ®æ—¶&lt;/li&gt;
&lt;li&gt;åŸç†
æ²¡æ•°æ®éœ€è¦ä¼ é€’æ—¶ï¼Œä¼ é€’ç©ºstruct&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// ä¸Šä¾‹ä¸­çš„Handler.stopChå°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼ŒstopChå¹¶ä¸éœ€è¦ä¼ é€’ä»»ä½•æ•°æ®
// åªæ˜¯è¦ç»™æ‰€æœ‰åç¨‹å‘é€é€€å‡ºçš„ä¿¡å·
type Handler struct {
    stopCh chan struct{}
    reqCh chan *Request
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨channelä¼ é€’ç»“æ„ä½“çš„æŒ‡é’ˆè€Œéç»“æ„ä½“&#34;&gt;ä½¿ç”¨channelä¼ é€’ç»“æ„ä½“çš„æŒ‡é’ˆè€Œéç»“æ„ä½“ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8channel%e4%bc%a0%e9%80%92%e7%bb%93%e6%9e%84%e4%bd%93%e7%9a%84%e6%8c%87%e9%92%88%e8%80%8c%e9%9d%9e%e7%bb%93%e6%9e%84%e4%bd%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
ä½¿ç”¨channelä¼ é€’ç»“æ„ä½“æ•°æ®æ—¶&lt;/li&gt;
&lt;li&gt;åŸç†
channelæœ¬è´¨ä¸Šä¼ é€’çš„æ˜¯æ•°æ®çš„æ‹·è´ï¼Œæ‹·è´çš„æ•°æ®è¶Šå°ä¼ è¾“æ•ˆç‡è¶Šé«˜ï¼Œä¼ é€’ç»“æ„ä½“æŒ‡é’ˆï¼Œæ¯”ä¼ é€’ç»“æ„ä½“æ›´é«˜æ•ˆ&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;reqCh chan *Request

// å¥½è¿‡
reqCh chan Request
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ä½¿ç”¨channelä¼ é€’channel&#34;&gt;ä½¿ç”¨channelä¼ é€’channel &lt;a href=&#34;#%e4%bd%bf%e7%94%a8channel%e4%bc%a0%e9%80%92channel&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœºæ™¯
ä½¿ç”¨åœºæ™¯æœ‰ç‚¹å¤šï¼Œé€šå¸¸æ˜¯ç”¨æ¥è·å–ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;åŸç†
channelå¯ä»¥ç”¨æ¥ä¼ é€’å˜é‡ï¼Œchannelè‡ªèº«ä¹Ÿæ˜¯å˜é‡ï¼Œå¯ä»¥ä¼ é€’è‡ªå·±ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
package main

import (
	&amp;#34;fmt&amp;#34;
	&amp;#34;math/rand&amp;#34;
	&amp;#34;sync&amp;#34;
	&amp;#34;time&amp;#34;
)

func main() {
	reqs := []int{1, 2, 3, 4, 5, 6, 7, 8, 9}

	// å­˜æ”¾ç»“æœçš„channelçš„channel
	outs := make(chan chan int, len(reqs))
	var wg sync.WaitGroup
	wg.Add(len(reqs))
	for _, x := range reqs {
		o := handle(&amp;amp;wg, x)
		outs &amp;lt;- o
	}

	go func() {
		wg.Wait()
		close(outs)
	}()

	// è¯»å–ç»“æœï¼Œç»“æœæœ‰åº
	for o := range outs {
		fmt.Println(&amp;lt;-o)
	}
}

// handle å¤„ç†è¯·æ±‚ï¼Œè€—æ—¶éšæœºæ¨¡æ‹Ÿ
func handle(wg *sync.WaitGroup, a int) chan int {
	out := make(chan int)
	go func() {
		time.Sleep(time.Duration(rand.Intn(3)) * time.Second)
		out &amp;lt;- a
		wg.Done()
	}()
	return out
}
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ”¶é›†æ¥æºï¼š &lt;a href=&#34;http://lessisbetter.site/2019/01/20/golang-channel-all-usage/&#34;&gt;http://lessisbetter.site/2019/01/20/golang-channel-all-usage/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Go-contextè¯¦è§£</title>
      <link>https://abnerxc.github.io/go/context%E8%AF%A6%E8%A7%A3/</link>
      <pubDate>Mon, 15 Mar 2021 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/context%E8%AF%A6%E8%A7%A3/</guid>
      <description>&lt;h1 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯ &lt;a href=&#34;#%e8%83%8c%e6%99%af&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;golangåœ¨1.6.2çš„æ—¶å€™è¿˜æ²¡æœ‰è‡ªå·±çš„contextï¼Œåœ¨1.7çš„ç‰ˆæœ¬ä¸­å°±æŠŠgolang.org/x/net/contextåŒ…è¢«åŠ å…¥åˆ°äº†å®˜æ–¹çš„åº“ä¸­ã€‚golang çš„ ContextåŒ…ï¼Œæ˜¯ä¸“é—¨ç”¨æ¥ç®€åŒ–å¯¹äºå¤„ç†å•ä¸ªè¯·æ±‚çš„å¤šä¸ªgoroutineä¹‹é—´ä¸è¯·æ±‚åŸŸçš„æ•°æ®ã€å–æ¶ˆä¿¡å·ã€æˆªæ­¢æ—¶é—´ç­‰ç›¸å…³æ“ä½œï¼Œè¿™äº›æ“ä½œå¯èƒ½æ¶‰åŠå¤šä¸ª API è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰ä¸€ä¸ªç½‘ç»œè¯·æ±‚Requestï¼Œæ¯ä¸ªRequestéƒ½éœ€è¦å¼€å¯ä¸€ä¸ªgoroutineåšä¸€äº›äº‹æƒ…ï¼Œè¿™äº›goroutineåˆå¯èƒ½ä¼šå¼€å¯å…¶ä»–çš„goroutineã€‚è¿™æ ·çš„è¯ï¼Œ æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Contextï¼Œæ¥è·Ÿè¸ªè¿™äº›goroutineï¼Œå¹¶ä¸”é€šè¿‡Contextæ¥æ§åˆ¶ä»–ä»¬çš„ç›®çš„ï¼Œè¿™å°±æ˜¯Goè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›çš„Contextï¼Œä¸­æ–‡å¯ä»¥ç§°ä¹‹ä¸ºâ€œä¸Šä¸‹æ–‡â€ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªå®é™…ä¾‹å­æ˜¯ï¼Œåœ¨GoæœåŠ¡å™¨ç¨‹åºä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šæœ‰ä¸€ä¸ªgoroutineå»å¤„ç†ã€‚ç„¶è€Œï¼Œå¤„ç†ç¨‹åºå¾€å¾€è¿˜éœ€è¦åˆ›å»ºé¢å¤–çš„goroutineå»è®¿é—®åç«¯èµ„æºï¼Œæ¯”å¦‚æ•°æ®åº“ã€RPCæœåŠ¡ç­‰ã€‚ç”±äºè¿™äº›goroutineéƒ½æ˜¯åœ¨å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥å®ƒä»¬å¾€å¾€éœ€è¦è®¿é—®ä¸€äº›å…±äº«çš„èµ„æºï¼Œæ¯”å¦‚ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€è®¤è¯tokenã€è¯·æ±‚æˆªæ­¢æ—¶é—´ç­‰ã€‚è€Œä¸”å¦‚æœè¯·æ±‚è¶…æ—¶æˆ–è€…è¢«å–æ¶ˆåï¼Œæ‰€æœ‰çš„goroutineéƒ½åº”è¯¥é©¬ä¸Šé€€å‡ºå¹¶ä¸”é‡Šæ”¾ç›¸å…³çš„èµ„æºã€‚è¿™ç§æƒ…å†µä¹Ÿéœ€è¦ç”¨Contextæ¥ä¸ºæˆ‘ä»¬å–æ¶ˆæ‰æ‰€æœ‰goroutine&lt;/p&gt;
&lt;p&gt;å¦‚æœè¦ä½¿ç”¨å¯ä»¥é€šè¿‡ go get golang.org/x/net/context å‘½ä»¤è·å–è¿™ä¸ªåŒ…ã€‚&lt;/p&gt;
&lt;h1 id=&#34;contextåŸç†&#34;&gt;ContextåŸç† &lt;a href=&#34;#context%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Context çš„è°ƒç”¨åº”è¯¥æ˜¯é“¾å¼çš„ï¼Œé€šè¿‡&lt;code&gt;WithCancel&lt;/code&gt;ï¼Œ&lt;code&gt;WithDeadline&lt;/code&gt;ï¼Œ&lt;code&gt;WithTimeout&lt;/code&gt;æˆ–&lt;code&gt;WithValue&lt;/code&gt;æ´¾ç”Ÿå‡ºæ–°çš„ Context.å½“çˆ¶ Context è¢«å–æ¶ˆæ—¶ï¼Œå…¶æ´¾ç”Ÿçš„æ‰€æœ‰ Context éƒ½å°†å–æ¶ˆ.&lt;/p&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;context.WithXXX&lt;/code&gt;éƒ½å°†è¿”å›æ–°çš„ Context å’Œ CancelFunc.è°ƒç”¨ CancelFunc å°†å–æ¶ˆå­ä»£ï¼Œç§»é™¤çˆ¶ä»£å¯¹å­ä»£çš„å¼•ç”¨ï¼Œå¹¶ä¸”åœæ­¢æ‰€æœ‰å®šæ—¶å™¨.æœªèƒ½è°ƒç”¨ CancelFunc å°†æ³„æ¼å­ä»£ï¼Œç›´åˆ°çˆ¶ä»£è¢«å–æ¶ˆæˆ–å®šæ—¶å™¨è§¦å‘.go vetå·¥å…·æ£€æŸ¥æ‰€æœ‰æµç¨‹æ§åˆ¶è·¯å¾„ä¸Šä½¿ç”¨ CancelFuncs.&lt;/p&gt;
&lt;h1 id=&#34;éµå¾ªè§„åˆ™&#34;&gt;éµå¾ªè§„åˆ™ &lt;a href=&#34;#%e9%81%b5%e5%be%aa%e8%a7%84%e5%88%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;éµå¾ªä»¥ä¸‹è§„åˆ™ï¼Œä»¥ä¿æŒåŒ…ä¹‹é—´çš„æ¥å£ä¸€è‡´ï¼Œå¹¶å¯ç”¨é™æ€åˆ†æå·¥å…·ä»¥æ£€æŸ¥ä¸Šä¸‹æ–‡ä¼ æ’­.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸è¦å°† Contexts æ”¾å…¥ç»“æ„ä½“ï¼Œç›¸å&lt;code&gt;context&lt;/code&gt;åº”è¯¥ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ï¼Œå‘½åä¸º&lt;code&gt;ctx. func DoSomethingï¼ˆctx context.Contextï¼Œarg Argï¼‰error { // ... use ctx ... }&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å³ä½¿å‡½æ•°å…è®¸ï¼Œä¹Ÿä¸è¦ä¼ å…¥&lt;code&gt;nil&lt;/code&gt;çš„ Context.å¦‚æœä¸çŸ¥é“ç”¨å“ªç§ Contextï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;context.TODO()&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨contextçš„Valueç›¸å…³æ–¹æ³•åªåº”è¯¥ç”¨äºåœ¨ç¨‹åºå’Œæ¥å£ä¸­ä¼ é€’çš„å’Œè¯·æ±‚ç›¸å…³çš„å…ƒæ•°æ®ï¼Œä¸è¦ç”¨å®ƒæ¥ä¼ é€’ä¸€äº›å¯é€‰çš„å‚æ•°.&lt;/li&gt;
&lt;li&gt;ç›¸åŒçš„ Context å¯ä»¥ä¼ é€’ç»™åœ¨ä¸åŒçš„goroutineï¼›Context æ˜¯å¹¶å‘å®‰å…¨çš„.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;contextåŒ…&#34;&gt;ContextåŒ… &lt;a href=&#34;#context%e5%8c%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Contextç»“æ„&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Context interface {
    // åœ¨Contextè¶…æ—¶æˆ–å–æ¶ˆæ—¶ï¼ˆå³ç»“æŸäº†ï¼‰è¿”å›ä¸€ä¸ªå…³é—­çš„channel
    // å³å¦‚æœå½“å‰Contextè¶…æ—¶æˆ–å–æ¶ˆæ—¶ï¼ŒDoneæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªchannelï¼Œç„¶åå…¶ä»–åœ°æ–¹å°±å¯ä»¥é€šè¿‡åˆ¤æ–­Doneæ–¹æ³•æ˜¯å¦æœ‰è¿”å›ï¼ˆchannelï¼‰ï¼Œå¦‚æœæœ‰åˆ™è¯´æ˜Contextå·²ç»“æŸ
    // æ•…å…¶å¯ä»¥ä½œä¸ºå¹¿æ’­é€šçŸ¥å…¶ä»–ç›¸å…³æ–¹æœ¬Contextå·²ç»“æŸï¼Œè¯·åšç›¸å…³å¤„ç†.
    Done() &amp;lt;-chan struct{}

    // è¿”å›Contextå–æ¶ˆçš„åŸå› 
    Err() error

    // è¿”å›Contextçš„è¶…æ—¶æ—¶é—´ï¼ˆè¶…æ—¶è¿”å›åœºæ™¯ï¼‰
    Deadline() (deadline time.Time, ok bool)

    // å€¼è¿”å›ä¸é”®å…³è”çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›nilã€‚
    Value(key interface{}) interface{}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ‰€æœ‰æ–¹æ³•&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Background() Context
func TODO() Context

func WithCancel(parent Context) (ctx Context, cancel CancelFunc)
func WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc)
func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc)
func WithValue(parent Context, key, val interface{}) Context
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢å¯ä»¥çœ‹åˆ°Contextæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæƒ³è¦ä½¿ç”¨å°±å¾—å®ç°å…¶æ–¹æ³•.åœ¨contextåŒ…å†…éƒ¨å·²ç»ä¸ºæˆ‘ä»¬å®ç°å¥½äº†ä¸¤ä¸ªç©ºçš„Contextï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨Background()å’ŒTODO()æ–¹æ³•è·å–.ä¸€èˆ¬çš„å°†å®ƒä»¬ä½œä¸ºContextçš„æ ¹ï¼Œå¾€ä¸‹æ´¾ç”Ÿ.&lt;/p&gt;
&lt;h1 id=&#34;withcancel-ä¾‹å­&#34;&gt;WithCancel ä¾‹å­ &lt;a href=&#34;#withcancel-%e4%be%8b%e5%ad%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;WithCancel ä»¥ä¸€ä¸ªæ–°çš„ Done channel è¿”å›ä¸€ä¸ªçˆ¶ Context çš„æ‹·è´.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; func WithCancel(parent Context) (ctx Context, cancel CancelFunc) {
         c := newCancelCtx(parent)
         propagateCancel(parent, &amp;amp;c)
         return &amp;amp;c, func() { c.cancel(true, Canceled) }
     }
     
     // newCancelCtx returns an initialized cancelCtx.
     func newCancelCtx(parent Context) cancelCtx {
         return cancelCtx{
             Context: parent,
             done:    make(chan struct{}),
         }
     }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ­¤ç¤ºä¾‹æ¼”ç¤ºä½¿ç”¨ä¸€ä¸ªå¯å–æ¶ˆçš„ä¸Šä¸‹æ–‡ï¼Œä»¥é˜²æ­¢ goroutine æ³„æ¼.ç¤ºä¾‹å‡½æ•°ç»“æŸæ—¶ï¼Œdefer è°ƒç”¨ cancel æ–¹æ³•ï¼Œgen goroutine å°†è¿”å›è€Œä¸æ³„æ¼.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;context&amp;#34;
    &amp;#34;fmt&amp;#34;
)

func main() {
    gen := func(ctx context.Context) &amp;lt;-chan int {
        dst := make(chan int)
        n := 1
        go func() {
            for {
                select {
                case &amp;lt;-ctx.Done():
                    return // returning not to leak the goroutine
                case dst &amp;lt;- n:
                    n++
                }
            }
        }()
        return dst
    }

    ctx, cancel := context.WithCancel(context.Background())
    defer cancel() // cancel when we are finished consuming integers

    for n := range gen(ctx) {
        fmt.Println(n)
        if n == 5 {
            break
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;withdeadline-ä¾‹å­&#34;&gt;WithDeadline ä¾‹å­ &lt;a href=&#34;#withdeadline-%e4%be%8b%e5%ad%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  func WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc) {
         if cur, ok := parent.Deadline(); ok &amp;amp;&amp;amp; cur.Before(deadline) {
             // The current deadline is already sooner than the new one.
             return WithCancel(parent)
         }
         c := &amp;amp;timerCtx{
             cancelCtx: newCancelCtx(parent),
             deadline:  deadline,
         }
   ......
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œå½“æ´¾ç”Ÿå‡ºçš„å­ Context çš„deadlineåœ¨çˆ¶Contextä¹‹åï¼Œç›´æ¥è¿”å›äº†ä¸€ä¸ªçˆ¶Contextçš„æ‹·è´.æ•…è¯­ä¹‰ä¸Šç­‰æ•ˆä¸ºçˆ¶.&lt;/p&gt;
&lt;p&gt;WithDeadline çš„æœ€åæœŸé™è°ƒæ•´ä¸ºä¸æ™šäº d è¿”å›çˆ¶ä¸Šä¸‹æ–‡çš„å‰¯æœ¬.å¦‚æœçˆ¶æ¯çš„æˆªæ­¢æ—¥æœŸå·²ç»æ—©äº dï¼ŒWithDeadline ï¼ˆçˆ¶ï¼Œdï¼‰ æ˜¯åœ¨è¯­ä¹‰ä¸Šç­‰æ•ˆä¸ºçˆ¶.è¿”å›çš„ä¸Šä¸‹æ–‡å®Œæˆçš„é€šé“å…³é—­çš„æœ€åæœŸé™æœŸæ»¡åï¼Œè¿”å›çš„å–æ¶ˆå‡½æ•°è°ƒç”¨æ—¶ï¼Œæˆ–å½“çˆ¶ä¸Šä¸‹æ–‡å®Œæˆçš„é€šé“å…³é—­ï¼Œä»¥å…ˆå‘ç”Ÿè€…ä¸ºå‡†.&lt;/p&gt;
&lt;p&gt;çœ‹çœ‹å®˜æ–¹çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;context&amp;#34;
    &amp;#34;fmt&amp;#34;
    &amp;#34;time&amp;#34;
)

func main() {
    d := time.Now().Add(50 * time.Millisecond)
    ctx, cancel := context.WithDeadline(context.Background(), d)

    //å³ä½¿ctxå°†ä¼šè¿‡æœŸï¼Œè¿˜æ˜¯æœ€å¥½å°†å…¶è°ƒç”¨
    //åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å…·æœ‰å–æ¶ˆåŠŸèƒ½ã€‚ å¦åˆ™å¯èƒ½ä¼šä½¿
    //ä¸Šä¸‹æ–‡åŠå…¶çˆ¶å¯¹è±¡çš„ç”Ÿå­˜æ—¶é—´è¶…å‡ºäº†å¿…è¦ã€‚
    defer cancel()

    select {
    case &amp;lt;-time.After(1 * time.Second):
        fmt.Println(&amp;#34;overslept&amp;#34;)
    case &amp;lt;-ctx.Done():
        fmt.Println(ctx.Err())
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;withtimeout-ä¾‹å­&#34;&gt;WithTimeout ä¾‹å­ &lt;a href=&#34;#withtimeout-%e4%be%8b%e5%ad%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc) {
         return WithDeadline(parent, time.Now().Add(timeout))
     }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å®˜æ–¹ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;context&amp;#34;
    &amp;#34;fmt&amp;#34;
    &amp;#34;time&amp;#34;
)

func main() {
    // Pass a context with a timeout to tell a blocking function that it
    // should abandon its work after the timeout elapses.
    ctx, cancel := context.WithTimeout(context.Background(), 50*time.Millisecond)
    defer cancel()

    select {
    case &amp;lt;-time.After(1 * time.Second):
        fmt.Println(&amp;#34;overslept&amp;#34;)
    case &amp;lt;-ctx.Done():
        fmt.Println(ctx.Err()) // prints &amp;#34;context deadline exceeded&amp;#34;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;withvalue&#34;&gt;WithValue &lt;a href=&#34;#withvalue&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  func WithValue(parent Context, key, val interface{}) Context {
         if key == nil {
             panic(&amp;#34;nil key&amp;#34;)
         }
         if !reflect.TypeOf(key).Comparable() {
             panic(&amp;#34;key is not comparable&amp;#34;)
         }
         return &amp;amp;valueCtx{parent, key, val}
     }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;WithValue è¿”å›çš„çˆ¶ä¸é”®å…³è”çš„å€¼åœ¨ val çš„å‰¯æœ¬.&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šä¸‹æ–‡å€¼ä»…ä¸ºè¿‡æ¸¡è¿›ç¨‹å’Œ Api çš„è¯·æ±‚èŒƒå›´çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å°†å¯é€‰å‚æ•°ä¼ é€’ç»™å‡½æ•°.&lt;/p&gt;
&lt;p&gt;æä¾›çš„é”®å¿…é¡»æ˜¯å¯æ¯”æ€§å’Œåº”è¯¥ä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹æˆ–ä»»ä½•å…¶ä»–å†…ç½®çš„ç±»å‹ä»¥é¿å…åŒ…ä½¿ç”¨çš„ä¸Šä¸‹æ–‡ä¹‹é—´çš„ç¢°æ’.WithValue ç”¨æˆ·åº”è¯¥å®šä¹‰è‡ªå·±çš„é”®çš„ç±»å‹.ä¸ºäº†é¿å…åˆ†é…åˆ†é…ç»™æ¥å£ {} æ—¶ï¼Œä¸Šä¸‹æ–‡é”®ç»å¸¸æœ‰å…·ä½“ç±»å‹ç»“æ„ {}.å¦å¤–ï¼Œå¯¼å‡ºçš„ä¸Šä¸‹æ–‡å…³é”®å˜é‡é™æ€ç±»å‹åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‡é’ˆæˆ–æ¥å£.&lt;/p&gt;
&lt;p&gt;çœ‹çœ‹å®˜æ–¹ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;context&amp;#34;
    &amp;#34;fmt&amp;#34;
)

func main() {
    type favContextKey string

    f := func(ctx context.Context, k favContextKey) {
        if v := ctx.Value(k); v != nil {
            fmt.Println(&amp;#34;found value:&amp;#34;, v)
            return
        }
        fmt.Println(&amp;#34;key not found:&amp;#34;, k)
    }

    k := favContextKey(&amp;#34;language&amp;#34;)
    ctx := context.WithValue(context.Background(), k, &amp;#34;Go&amp;#34;)

    f(ctx, k)
    f(ctx, favContextKey(&amp;#34;color&amp;#34;))
}
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;æ–‡ç« æ¥æºï¼šhttps://mojotv.cn/2019/06/26/golang-context&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Go modules è¯¦è§£</title>
      <link>https://abnerxc.github.io/go/mod%E8%AF%A6%E8%A7%A3/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/mod%E8%AF%A6%E8%A7%A3/</guid>
      <description>&lt;h1 id=&#34;go-modçš„ä»‹ç»&#34;&gt;go modçš„ä»‹ç» &lt;a href=&#34;#go-mod%e7%9a%84%e4%bb%8b%e7%bb%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æˆ‘ä»¬ä»¥å‰ç”¨ go get è·å–ä¾èµ–å…¶å®æ˜¯æœ‰æ½œåœ¨å±é™©çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ç¡®å®šæœ€æ–°ç‰ˆä¾èµ–æ˜¯å¦ä¼šç ´åæ‰æˆ‘ä»¬é¡¹ç›®å¯¹ä¾èµ–åŒ…çš„ä½¿ç”¨æ–¹å¼ï¼Œå³å½“å‰é¡¹ç›®å¯èƒ½ä¼šå‡ºç°ä¸å…¼å®¹æœ€æ–°ä¾èµ–åŒ…çš„é—®é¢˜ã€‚éšç€ go1.11 çš„å‘å¸ƒï¼Œgo ç»™æˆ‘ä»¬å¸¦æ¥äº† module æ–°ç‰¹æ€§ï¼Œè¿™æ˜¯ Go è¯­è¨€æ–°çš„ä¸€å¥—ä¾èµ–ç®¡ç†ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ$GOPATH é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸æ”¯æŒ go mudules çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;code&gt;$ export GO111MODULE=on&lt;/code&gt;,è¿™ä¹Ÿè¡¨æ˜äº† go è¦åˆ©ç”¨ modules æœºåˆ¶æ¶ˆç­ $GOPATH çš„å†³å¿ƒå•Šï¼&lt;/p&gt;
&lt;p&gt;GO111MODULEå¯ä»¥è®¾ç½®ä¸ºä¸‰ä¸ªå­—ç¬¦ä¸²å€¼ä¹‹ä¸€ï¼šoffï¼Œonæˆ–autoï¼ˆé»˜è®¤å€¼ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;off : goå‘½ä»¤ä»ä¸ä½¿ç”¨æ–°æ¨¡å—æ”¯æŒã€‚å®ƒæŸ¥æ‰¾vendor ç›®å½•å’ŒGOPATHä»¥æŸ¥æ‰¾ä¾èµ–å…³ç³»;ä¹Ÿå°±æ˜¯ç»§ç»­ä½¿ç”¨â€œGOPATHæ¨¡å¼â€ã€‚&lt;/li&gt;
&lt;li&gt;on : goå‘½ä»¤éœ€è¦ä½¿ç”¨æ¨¡å—ï¼Œgo ä¼šå¿½ç•¥ $GOPATH å’Œ vendor æ–‡ä»¶å¤¹ï¼Œåªæ ¹æ®go.modä¸‹è½½ä¾èµ–ã€‚&lt;/li&gt;
&lt;li&gt;auto æˆ–æœªè®¾ç½®: goå‘½ä»¤æ ¹æ®å½“å‰ç›®å½•å¯ç”¨æˆ–ç¦ç”¨æ¨¡å—æ”¯æŒã€‚ä»…å½“å½“å‰ç›®å½•ä½äº$GOPATH/srcä¹‹å¤–å¹¶ä¸”å…¶æœ¬èº«åŒ…å«go.modæ–‡ä»¶æˆ–ä½äºåŒ…å«go.modæ–‡ä»¶çš„ç›®å½•ä¸‹æ—¶ï¼Œæ‰å¯ç”¨æ¨¡å—æ”¯æŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¼”ç¤ºä½¿ç”¨æ•™ç¨‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºé¡¹ç›®,ä¸ºäº†é…åˆ go modules æœºåˆ¶ï¼Œæˆ‘ä»¬ $GOPATH ä»¥å¤–çš„ç›®å½•åˆ›å»ºä¸€ä¸ª testmod çš„åŒ…ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ mkdir testmod
$ cd testmod

$ echo &amp;#39;package testmod
		import &amp;#34;fmt&amp;#34;
	func Hi(name string) string {
        return fmt.Sprintf(&amp;#34;Hi, %s&amp;#34;, name)
}&amp;#39; &amp;gt;&amp;gt; testmod.go
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;åˆå§‹åŒ–module&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ go mod init github.com/objcoding/testmod
#è¿™é‡Œå¦‚æœæ˜¯ä»gitä¸‹æ¥çš„ï¼Œå¯ä»¥ç›´æ¥è¿›å…¥é¡¹ç›®é‡Œé¢æ‰§è¡Œgo init
go: creating new go.mod: module github.com/objcoding/testmod
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;æ¨é€åˆ° github ä»“åº“&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git init
$ git add *
$ git commit -am &amp;#34;First commit&amp;#34;
$ git push -u origin master
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;go-mudules-ç‰ˆæœ¬è§„åˆ™&#34;&gt;go mudules ç‰ˆæœ¬è§„åˆ™ &lt;a href=&#34;#go-mudules-%e7%89%88%e6%9c%ac%e8%a7%84%e5%88%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;go modules æ˜¯ä¸€ä¸ªç‰ˆæœ¬åŒ–ä¾èµ–ç®¡ç†ç³»ç»Ÿï¼Œç‰ˆæœ¬éœ€è¦éµå¾ªä¸€äº›è§„åˆ™ï¼Œæ¯”å¦‚ç‰ˆæœ¬å·éœ€è¦éµå¾ªä»¥ä¸‹æ ¼å¼ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vX.Y.Z-pre.0.yyyymmddhhmmss-abcdefabcdef
vX.0.0-yyyymmddhhmmss-abcdefabcdef
vX.Y.(Z+1)-0.yyyymmddhhmmss-abcdefabcdef
vX.Y.Z
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;vX.Y.Z æ˜¯æˆ‘ä»¬ä»“åº“æ‰“çš„æ ‡ç­¾ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ go modules æ˜¯æ ¹æ®ä»“åº“æ ‡ç­¾æ¥ç¡®å®šç‰ˆæœ¬å·çš„ï¼Œå› æ­¤æˆ‘ä»¬å‘å¸ƒç‰ˆæœ¬æ—¶ï¼Œéœ€è¦ç»™æˆ‘ä»¬çš„ä»“åº“æ‰“ä¸Šä¸€ä¸ªæ ‡ç­¾ç‰ˆæœ¬å·ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯ç‰ˆæœ¬å· + æ—¶é—´æˆ³ +hashï¼Œæˆ‘ä»¬è‡ªå·±æŒ‡å®šç‰ˆæœ¬æ—¶åªéœ€è¦æŒ‡å®šç‰ˆæœ¬å·å³å¯ï¼Œæ²¡æœ‰ç‰ˆæœ¬ tag çš„åˆ™éœ€è¦æ‰¾åˆ°å¯¹åº” commit çš„æ—¶é—´å’Œ hash å€¼ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„è§„åˆ™æ˜¯ï¼Œç‰ˆæœ¬ 0 å’Œ 1ï¼Œæœ€å¥½éœ€è¦æœ‰ä¸åŒçš„ä¾èµ–è·¯å¾„ï¼Œå¦‚ï¼šv1.0.0 å’Œ v2.0.0 æ˜¯æœ‰ä¸åŒçš„ä¾èµ–è·¯å¾„ï¼Œä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬è§„åˆ™ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å‘å¸ƒç‰ˆæœ¬&#34;&gt;å‘å¸ƒç‰ˆæœ¬ &lt;a href=&#34;#%e5%8f%91%e5%b8%83%e7%89%88%e6%9c%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;äº†è§£äº† go modules çš„ç‰ˆæœ¬è§„åˆ™åï¼Œç°åœ¨æˆ‘ä»¬å‘å¸ƒä¸€ä¸‹è¯¥é¡¹ç›®çš„ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git tag v1.0.0
$ git push --tags
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ—¶æˆ‘ä»¬æœ€å¥½è¿˜éœ€è¦åˆ›å»ºä¸€æ¡ v1 åˆ†æ”¯ï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨å…¶å®ƒåˆ†æ”¯å†™ä»£ç ä¸ä¼šå½±å“åˆ° v1.0.0 ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git checkout -b v1
$ git push -u origin v1
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;å‡çº§ç‰ˆæœ¬&#34;&gt;å‡çº§ç‰ˆæœ¬ &lt;a href=&#34;#%e5%8d%87%e7%ba%a7%e7%89%88%e6%9c%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git commit -m &amp;#34;update testmod&amp;#34; testmod.go
$ git tag v1.0.1
$ git push --tags origin v1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬çš„ é¡¹ç›®å·²ç»å‡çº§åˆ° v1.0.1 ç‰ˆæœ¬äº†ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¤šç§æ–¹å¼è·å–è¿™ä¸ªç‰ˆæœ¬ä¾èµ–ï¼Œgo1.11 ä¸­ï¼Œgo get æ‹¥æœ‰äº†å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è·å– v1.01 ç‰ˆæœ¬ä¾èµ–ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ go get github.com/objcoding/testmod@v1.0.1
æˆ–è€…
$ go mod edit -require=&amp;#34;github.com/objcoding/testmod@v1.0.1&amp;#34;
$ go mod tidy
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;go mod edit -require å¯ä»¥ä¸»åŠ¨ä¿®æ”¹ go.md æ–‡ä»¶ä¸­ä¾èµ–çš„ç‰ˆæœ¬å·ï¼Œç„¶åé€šè¿‡ go mod tidy å¯¹ç‰ˆæœ¬è¿›è¡Œæ›´æ–°ï¼Œå®ƒä¼šè‡ªåŠ¨æ¸…ç†æ‰ä¸éœ€è¦çš„ä¾èµ–é¡¹ï¼ŒåŒæ—¶å¯ä»¥å°†ä¾èµ–é¡¹æ›´æ–°åˆ°å½“å‰ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸»è¦ç‰ˆæœ¬å‡çº§&#34;&gt;ä¸»è¦ç‰ˆæœ¬å‡çº§ &lt;a href=&#34;#%e4%b8%bb%e8%a6%81%e7%89%88%e6%9c%ac%e5%8d%87%e7%ba%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä¸Šé¢ç‰ˆæœ¬è§„åˆ™è¯´äº†ï¼Œç‰ˆæœ¬ 0 å’Œ 1ï¼Œå³å¤§ç‰ˆæœ¬æ›´æ–°ï¼Œæœ€å¥½éœ€è¦æœ‰ä¸åŒçš„ä¾èµ–è·¯å¾„ï¼Œå¦‚ï¼šv1.0.0 å’Œ v2.0.0 æ˜¯æœ‰ä¸åŒçš„ä¾èµ–è·¯å¾„ï¼Œé‚£ä¹ˆç”¨ go modules æ€ä¹ˆå®ç°å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ go.mod æ–‡ä»¶ç¬¬ä¸€è¡Œæ·»åŠ æ–°è·¯å¾„ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ cd testmod
$ echo &amp;#39;module github.com/objcoding/testmod/v2&amp;#39; &amp;gt;&amp;gt; go.mod
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬ä¿®æ”¹ testmod å‡½æ•° Hi()ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ cd testmod

$ echo &amp;#39;package testmod
import (
	&amp;#34;fmt&amp;#34;
	&amp;#34;errors&amp;#34;
)
func Hi(name, lang string) (string, error) {
	switch lang {
	case &amp;#34;en&amp;#34;:
		return fmt.Sprintf(&amp;#34;Hi, %s!&amp;#34;, name), nil
	default:
		return &amp;#34;&amp;#34;, errors.New(&amp;#34;unknown language&amp;#34;)
	}
}&amp;#39; &amp;gt;&amp;gt; testmod.go
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ—¶ï¼ŒHi() æ–¹æ³•å°†ä¸å…¼å®¹ v1 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ª v2.0.0 ç‰ˆæœ¬ï¼Œè¿˜æ˜¯è€æ ·å­ï¼Œæˆ‘ä»¬æœ€å¥½åœ¨ v2.0.0 ç‰ˆæœ¬æ–°å»ºä¸€æ¡ v2 åˆ†åˆ†æ”¯ï¼Œå°† v2.0.0 ç‰ˆæœ¬çš„ä»£ç å†™åˆ°è¿™æ¡åˆ†æ”¯ä¸­ï¼ˆè¿™åªæ˜¯ä¸€ä¸ªè§„èŒƒï¼Œå®é™…ä¸Šä½ å°†ä»£ç ä¹Ÿå†™åˆ°ä»»ä½•åˆ†æ”¯ä¸­éƒ½è¡Œï¼Œgoå¹¶æ²¡æœ‰è¿™ä¸ªè§„èŒƒï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git add *
$ git checkout -b v2
$ git commit testmod.go -m &amp;#34;v2.0.0&amp;#34;
$ git tag v2.0.0
$ git push --tags origin v2
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬ä¿®æ”¹ä»£ç ä¸­çš„ç‰ˆæœ¬import,ä¸ºv2&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main
import (
    &amp;#34;fmt&amp;#34;
  	&amp;#34;github.com/objcoding/testmod/v2&amp;#34;
)
func main() {
    fmt.Println(testmod.Hi(&amp;#34;zch&amp;#34;, &amp;#34;en&amp;#34;))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åæ‰§è¡Œ&lt;code&gt;go mod tidy&lt;/code&gt;ï¼Œgo mod ä¼šè‡ªåŠ¨æ›´æ–°åˆ°v2.0.0ç‰ˆæœ¬&lt;/p&gt;
&lt;h1 id=&#34;go-modules-å‘½ä»¤å¤§å…¨&#34;&gt;go modules å‘½ä»¤å¤§å…¨ &lt;a href=&#34;#go-modules-%e5%91%bd%e4%bb%a4%e5%a4%a7%e5%85%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go help modules

go modå‘½ä»¤

download    download modules to local cache (ä¸‹è½½ä¾èµ–çš„moduleåˆ°æœ¬åœ°cache))
edit        edit go.mod from tools or scripts (ç¼–è¾‘go.modæ–‡ä»¶)
graph       print module requirement graph (æ‰“å°æ¨¡å—ä¾èµ–å›¾))
init        initialize new module in current directory (å†å½“å‰æ–‡ä»¶å¤¹ä¸‹åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„module, åˆ›å»ºgo.modæ–‡ä»¶))
tidy        add missing and remove unused modules (å¢åŠ ä¸¢å¤±çš„moduleï¼Œå»æ‰æœªç”¨çš„module)
vendor      make vendored copy of dependencies (å°†ä¾èµ–å¤åˆ¶åˆ°vendorä¸‹)
verify      verify dependencies have expected content (æ ¡éªŒä¾èµ–)
why         explain why packages or modules are needed (è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–)

åˆå§‹åŒ–mod

go mod init [module]å¯ä»¥åˆ›å»ºä¸€ä¸ªgo.modï¼Œåªæœ‰ä¸€è¡Œä¿¡æ¯moduleã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;go-ç¿»å¢™&#34;&gt;go ç¿»å¢™ &lt;a href=&#34;#go-%e7%bf%bb%e5%a2%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;swagå®‰è£…ä¸ºä¾‹&lt;/p&gt;
&lt;p&gt;mac/linux swag å®‰è£…&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-code&#34; data-lang=&#34;code&#34;&gt;## 127.0.0.1:1087 æ˜¯ ssrçš„hhtpä»£ç†
$ git config --global http.proxy &amp;#34;127.0.0.1:1087&amp;#34;
$ http_proxy=127.0.0.1:1087 go get -u -v github.com/swaggo/swag/cmd/swag
$ git config --global --unset-all http.proxy
$ git config --global --unset-all https.proxy
$ cd $GOPATH/src/github.com/swaggo/swag/cmd/swag
$ go install
$ swag -v #éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;window goget.batæ–‡ä»¶&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;@echo off

set http_proxy=socks5://127.0.0.1:1080
set https_proxy=socks5://127.0.0.1:1080

go get -u -v %*

echo ...

pause
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;git bashä¸Šç”¨goget.bat urlå°±è¡Œäº†~&lt;/p&gt;
&lt;h1 id=&#34;è‡ªå»ºgoproxy-server&#34;&gt;è‡ªå»ºGOPROXY server &lt;a href=&#34;#%e8%87%aa%e5%bb%bagoproxy-server&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é¡¹ç›®åœ°å€ &lt;a href=&#34;https://github.com/gomods/athens&#34;&gt;https://github.com/gomods/athens&lt;/a&gt;
Athenså¯ä»¥ç”¨æ¥åœ¨å…¬å¸å†…éƒ¨å»ºç«‹è‡ªå·±çš„ç§æœ‰go modæœåŠ¡å™¨ï¼Œæˆ–è€…åœ¨å…¬ç½‘å»ºç«‹ä¸€ä¸ªå¯¹å¤–å…¬å¼€çš„GOPROXY serverã€‚&lt;/p&gt;
&lt;h1 id=&#34;å¯ç”¨é•œåƒ&#34;&gt;å¯ç”¨é•œåƒ &lt;a href=&#34;#%e5%8f%af%e7%94%a8%e9%95%9c%e5%83%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;é˜¿é‡Œäº‘:https://mirrors.aliyun.com/goproxy/&lt;/li&gt;
&lt;li&gt;goä»£ç†:https://goproxy.io&lt;/li&gt;
&lt;li&gt;goä»£ç†:https://goproxy.cn&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Go-logæ—¥å¿—</title>
      <link>https://abnerxc.github.io/go/log%E6%97%A5%E5%BF%97/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/log%E6%97%A5%E5%BF%97/</guid>
      <description>&lt;h1 id=&#34;æ—¥å¿—ä½¿ç”¨&#34;&gt;æ—¥å¿—ä½¿ç”¨ &lt;a href=&#34;#%e6%97%a5%e5%bf%97%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;oè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›äº†æ ‡å‡†çš„logåŒ…ï¼Œæ¥è·Ÿè¸ªæ—¥å¿—çš„è®°å½•ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æ—¥å¿—åŒ…logçš„ä½¿ç”¨&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	log.Println(&amp;#34;è¿™æ˜¯ç™¾åº¦åœ°å€:&amp;#34;,&amp;#34;http://www.baidu.com&amp;#34;)
	log.Printf(&amp;#34;è¿™æ˜¯ç™¾åº¦åœ°å€åŸŸåï¼š%s\n&amp;#34;,&amp;#34;baidu.com&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2019/08/28 13:18:44 è¿™æ˜¯ç™¾åº¦åœ°å€: http://www.baidu.com
2019/08/28 13:18:44 è¿™æ˜¯ç™¾åº¦åœ°å€åŸŸåï¼šbaidu.com
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æœ‰äº†æ—¶é—´äº†ï¼Œæˆ‘ä»¬è¿˜æƒ³è¦æ›´å¤šçš„ä¿¡æ¯ï¼Œå¿…ç„¶å‘ç”Ÿçš„æºä»£ç è¡Œå·ç­‰ï¼Œå¯¹æ­¤æ—¥å¿—åŒ…log ä¸ºæˆ‘ä»¬æä¾›äº†å¯å®šåˆ¶åŒ–çš„é…åˆ¶ï¼Œè®©æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šåˆ¶æ—¥å¿—çš„æŠ¬å¤´ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func init(){
	log.SetFlags(log.Ldate|log.Lshortfile)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;init&lt;/code&gt;å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨&lt;code&gt;main&lt;/code&gt;å‡½æ•°æ‰§è¡Œä¹‹å‰å°±å¯ä»¥åˆå§‹åŒ–ï¼Œå¯ä»¥å¸®æˆ‘ä»¬åšä¸€äº›é…ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬è‡ªå®šä¹‰æ—¥å¿—çš„æŠ¬å¤´ä¿¡æ¯ä¸ºæ—¶é—´+æ–‡ä»¶å+æºä»£ç æ‰€åœ¨è¡Œå·ã€‚ä¹Ÿå°±æ˜¯&lt;code&gt;log.Ldate|log.Lshortfile,&lt;/code&gt;ä¸­é—´æ˜¯ä¸€ä¸ªä½è¿ç®—ç¬¦&lt;code&gt;|&lt;/code&gt;ï¼Œç„¶åé€šè¿‡å‡½æ•°&lt;code&gt;log.SetFlags&lt;/code&gt;è¿›è¡Œè®¾ç½®ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2017/04/29 main.go:10: é£é›ªæ— æƒ…çš„åšå®¢: http://www.flysnow.org
2017/04/29 main.go:11: é£é›ªæ— æƒ…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šflysnow_org
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çœ‹çœ‹&lt;code&gt;log&lt;/code&gt;åŒ…ä¸ºæˆ‘ä»¬æä¾›äº†é‚£äº›å¯ä»¥å®šä¹‰çš„é€‰é¡¹å¸¸é‡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const (
	Ldate         = 1 &amp;lt;&amp;lt; iota     //æ—¥æœŸç¤ºä¾‹ï¼š 2009/01/23
	Ltime                         //æ—¶é—´ç¤ºä¾‹: 01:23:23
	Lmicroseconds                 //æ¯«ç§’ç¤ºä¾‹: 01:23:23.123123.
	Llongfile                     //ç»å¯¹è·¯å¾„å’Œè¡Œå·: /a/b/c/d.go:23
	Lshortfile                    //æ–‡ä»¶å’Œè¡Œå·: d.go:23.
	LUTC                          //æ—¥æœŸæ—¶é—´è½¬ä¸º0æ—¶åŒºçš„
	LstdFlags     = Ldate | Ltime //Goæä¾›çš„æ ‡å‡†æŠ¬å¤´ä¿¡æ¯
)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ˜¯logåŒ…å®šä¹‰çš„ä¸€äº›æŠ¬å¤´ä¿¡æ¯ï¼Œæœ‰æ—¥æœŸã€æ—¶é—´ã€æ¯«ç§’æ—¶é—´ã€ç»å¯¹è·¯å¾„å’Œè¡Œå·ã€æ–‡ä»¶åå’Œè¡Œå·ç­‰ï¼Œåœ¨ä¸Šé¢éƒ½æœ‰æ³¨é‡Šè¯´æ˜ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœè®¾ç½®äº†&lt;code&gt;Lmicroseconds&lt;/code&gt;ï¼Œé‚£ä¹ˆ&lt;code&gt;Ltime&lt;/code&gt;å°±ä¸ç”Ÿæ•ˆäº†ï¼›è®¾ç½®äº†&lt;code&gt;Lshortfile&lt;/code&gt;ï¼Œ &lt;code&gt;Llongfile&lt;/code&gt;ä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œå¤§å®¶è‡ªå·±å¯ä»¥æµ‹è¯•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;LUTC&lt;/code&gt;æ¯”è¾ƒç‰¹æ®Šï¼Œå¦‚æœæˆ‘ä»¬é…ç½®äº†æ—¶é—´æ ‡ç­¾ï¼Œé‚£ä¹ˆå¦‚æœè®¾ç½®äº†LUTCçš„è¯ï¼Œå°±ä¼šæŠŠè¾“å‡ºçš„æ—¥æœŸæ—¶é—´è½¬ä¸º0æ—¶åŒºçš„æ—¥æœŸæ—¶é—´æ˜¾ç¤ºã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;log.SetFlags(log.Ldate|log.Ltime |log.LUTC)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é‚£ä¹ˆå¯¹æˆ‘ä»¬ä¸œå…«åŒºçš„æ—¶é—´æ¥è¯´ï¼Œå°±ä¼šå‡å»8ä¸ªå°æ—¶ï¼Œæˆ‘ä»¬çœ‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2017/04/29 05:46:29 é£é›ªæ— æƒ…çš„åšå®¢: http://www.flysnow.org
2017/04/29 05:46:29 é£é›ªæ— æƒ…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šflysnow_org
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æœ€åä¸€ä¸ª&lt;code&gt;LstdFlags&lt;/code&gt;è¡¨ç¤ºæ ‡å‡†çš„æ—¥å¿—æŠ¬å¤´ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤çš„ï¼ŒåŒ…å«æ—¥æœŸå’Œå…·ä½“æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æœ‰å¾ˆå¤šä¸šåŠ¡ï¼Œæ¯ä¸ªä¸šåŠ¡éƒ½éœ€è¦è®°å½•æ—¥å¿—ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•ï¼Œèƒ½åŒºåˆ†è¿™äº›ä¸šåŠ¡å‘¢ï¼Ÿè¿™æ ·æˆ‘ä»¬åœ¨æŸ¥æ‰¾æ—¥å¿—çš„æ—¶å€™ï¼Œå°±æ–¹ä¾¿å¤šäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºè¿™ç§æƒ…å†µï¼ŒGoè¯­è¨€ä¹Ÿå¸®æˆ‘ä»¬è€ƒè™‘åˆ°äº†ï¼Œè¿™å°±æ˜¯è®¾ç½®æ—¥å¿—çš„å‰ç¼€ï¼Œæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·ä¸­å¿ƒç³»ç»Ÿçš„æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè®¾ç½®ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func init(){
	log.SetPrefix(&amp;#34;ã€UserCenterã€‘&amp;#34;)
	log.SetFlags(log.LstdFlags | log.Lshortfile |log.LUTC)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€šè¿‡&lt;code&gt;log.SetPrefix&lt;/code&gt;å¯ä»¥æŒ‡å®šè¾“å‡ºæ—¥å¿—çš„å‰ç¼€ï¼Œè¿™é‡Œæˆ‘ä»¬æŒ‡å®šä¸º&lt;code&gt;ã€UserCenterã€‘&lt;/code&gt;ï¼Œç„¶åå°±å¯ä»¥çœ‹åˆ°æ—¥å¿—çš„æ‰“å°è¾“å‡ºå·²ç»æ¸…æ™°çš„æ ‡è®°å‡ºæˆ‘ä»¬çš„è¿™äº›æ—¥å¿—æ˜¯å±äºå“ªäº›ä¸šåŠ¡çš„å•¦ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ã€UserCenterã€‘2017/04/29 05:53:26 main.go:11: é£é›ªæ— æƒ…çš„åšå®¢: http://www.flysnow.org
ã€UserCenterã€‘2017/04/29 05:53:26 main.go:12: é£é›ªæ— æƒ…çš„å¾®ä¿¡å…¬ä¼—å·ï¼šflysnow_org
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;log&lt;/code&gt;åŒ…é™¤äº†æœ‰&lt;code&gt;Print&lt;/code&gt;ç³»åˆ—çš„å‡½æ•°ï¼Œè¿˜æœ‰&lt;code&gt;Fatal&lt;/code&gt;ä»¥åŠ&lt;code&gt;Panic&lt;/code&gt;ç³»åˆ—çš„å‡½æ•°ï¼Œå…¶ä¸­&lt;code&gt;Fatal&lt;/code&gt;è¡¨ç¤ºç¨‹åºé‡åˆ°äº†è‡´å‘½çš„é”™è¯¯ï¼Œéœ€è¦é€€å‡ºï¼Œè¿™æ—¶å€™ä½¿ç”¨&lt;code&gt;Fatal&lt;/code&gt;è®°å½•æ—¥å¿—åï¼Œç„¶åç¨‹åºé€€å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´Fatalç›¸å½“äºå…ˆè°ƒç”¨&lt;code&gt;Print&lt;/code&gt;æ‰“å°æ—¥å¿—ï¼Œç„¶åå†è°ƒç”¨&lt;code&gt;os.Exit(1)&lt;/code&gt;é€€å‡ºç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;åŒç†&lt;code&gt;Panic&lt;/code&gt;ç³»åˆ—çš„å‡½æ•°ä¹Ÿä¸€æ ·ï¼Œè¡¨ç¤ºå…ˆä½¿ç”¨&lt;code&gt;Print&lt;/code&gt;è®°å½•æ—¥å¿—ï¼Œç„¶åè°ƒç”¨&lt;code&gt;panic()&lt;/code&gt;å‡½æ•°æŠ›å‡ºä¸€ä¸ªææ…Œï¼Œè¿™æ—¶å€™é™¤éä½¿ç”¨&lt;code&gt;recover()&lt;/code&gt;å‡½æ•°ï¼Œå¦åˆ™ç¨‹åºå°±ä¼šæ‰“å°é”™è¯¯å †æ ˆä¿¡æ¯ï¼Œç„¶åç¨‹åºç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè´´ä¸‹è¿™å‡ ä¸ªç³»åˆ—å‡½æ•°çš„æºä»£ç ï¼Œæ›´å¥½ç†è§£ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Println(v ...interface{}) {
	std.Output(2, fmt.Sprintln(v...))
}

func Fatalln(v ...interface{}) {
	std.Output(2, fmt.Sprintln(v...))
	os.Exit(1)
}

func Panicln(v ...interface{}) {
	s := fmt.Sprintln(v...)
	std.Output(2, s)
	panic(s)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;å®ç°åŸç†&#34;&gt;å®ç°åŸç† &lt;a href=&#34;#%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é€šè¿‡ä¸Šé¢çš„æºä»£ç ï¼Œæˆ‘ä»¬å‘ç°ï¼Œæ—¥å¿—åŒ…&lt;code&gt;log&lt;/code&gt;çš„è¿™äº›å‡½æ•°éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå…³é”®çš„è¾“å‡ºæ—¥å¿—å°±åœ¨äº&lt;code&gt;std.Output&lt;/code&gt;æ–¹æ³•&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func New(out io.Writer, prefix string, flag int) *Logger {
	return &amp;amp;Logger{out: out, prefix: prefix, flag: flag}
}

var std = New(os.Stderr, &amp;#34;&amp;#34;, LstdFlags)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»ä»¥ä¸Šæºä»£ç å¯ä»¥çœ‹å‡ºï¼Œå˜é‡&lt;code&gt;std&lt;/code&gt;å…¶å®æ˜¯ä¸€ä¸ª&lt;code&gt;*Logger&lt;/code&gt;ï¼Œé€šè¿‡&lt;code&gt;log.New&lt;/code&gt;å‡½æ•°åˆ›å»ºï¼Œé»˜è®¤è¾“å‡ºåˆ°&lt;code&gt;os.Stderr&lt;/code&gt;è®¾å¤‡ï¼Œå‰ç¼€ä¸ºç©ºï¼Œæ—¥å¿—æŠ¬å¤´ä¿¡æ¯ä¸ºæ ‡å‡†æŠ¬å¤´&lt;code&gt;LstdFlags&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;os.Stderr&lt;/code&gt;å¯¹åº”çš„æ˜¯UNIXé‡Œçš„æ ‡å‡†é”™è¯¯è­¦å‘Šä¿¡æ¯çš„è¾“å‡ºè®¾å¤‡ï¼ŒåŒæ—¶è¢«ä½œä¸ºé»˜è®¤çš„æ—¥å¿—è¾“å‡ºç›®çš„åœ°ã€‚åˆæ¬¡ä¹‹å¤–ï¼Œè¿˜æœ‰æ ‡å‡†è¾“å‡ºè®¾å¤‡&lt;code&gt;os.Stdout&lt;/code&gt;ä»¥åŠæ ‡å‡†è¾“å…¥è®¾å¤‡&lt;code&gt;os.Stdin&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var (
	Stdin  = NewFile(uintptr(syscall.Stdin), &amp;#34;/dev/stdin&amp;#34;)
	Stdout = NewFile(uintptr(syscall.Stdout), &amp;#34;/dev/stdout&amp;#34;)
	Stderr = NewFile(uintptr(syscall.Stderr), &amp;#34;/dev/stderr&amp;#34;)
)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯å®šä¹‰çš„UNIXçš„æ ‡å‡†çš„ä¸‰ç§è®¾å¤‡ï¼Œåˆ†åˆ«ç”¨äºè¾“å…¥ã€è¾“å‡ºå’Œè­¦å‘Šé”™è¯¯ä¿¡æ¯ã€‚ç†è§£äº†&lt;code&gt;os.Stderr&lt;/code&gt;ï¼Œç°åœ¨æˆ‘ä»¬çœ‹ä¸‹&lt;code&gt;Logger&lt;/code&gt;è¿™ä¸ªç»“æ„ä½“ï¼Œæ—¥å¿—çš„ä¿¡æ¯å’Œæ“ä½œï¼Œéƒ½æ˜¯é€šè¿‡è¿™ä¸ª&lt;code&gt;Logger&lt;/code&gt;æ“ä½œçš„ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Logger struct {
	mu     sync.Mutex // å­—æ®µmuæ˜¯ä¸€ä¸ªäº’æ–¥é”ï¼Œä¸»è¦æ˜¯æ˜¯ä¿è¯è¿™ä¸ªæ—¥å¿—è®°å½•å™¨Loggeråœ¨å¤šgoroutineä¸‹ä¹Ÿæ˜¯å®‰å…¨çš„
	prefix string     // å­—æ®µprefixæ˜¯æ¯ä¸€è¡Œæ—¥å¿—çš„å‰ç¼€
	flag   int        // å­—æ®µflagæ˜¯æ—¥å¿—æŠ¬å¤´ä¿¡æ¯
	out    io.Writer  // å­—æ®µoutæ˜¯æ—¥å¿—è¾“å‡ºçš„ç›®çš„åœ°ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯os.Stderrã€‚
	buf    []byte     // å­—æ®µbufæ˜¯ä¸€æ¬¡æ—¥å¿—è¾“å‡ºæ–‡æœ¬ç¼“å†²ï¼Œæœ€ç»ˆä¼šè¢«å†™åˆ°outé‡Œã€‚
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;äº†è§£äº†ç»“æ„ä½“&lt;code&gt;Logger&lt;/code&gt;çš„å­—æ®µï¼Œç°åœ¨å°±å¯ä»¥çœ‹ä¸‹å®ƒæœ€é‡è¦çš„æ–¹æ³•&lt;code&gt;Output&lt;/code&gt;äº†ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¾“å‡ºæ ¼å¼åŒ–å¥½çš„æ—¥å¿—ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (l *Logger) Output(calldepth int, s string) error {
	now := time.Now() // get this early.
	var file string
	var line int
	//åŠ é”ï¼Œä¿è¯å¤šgoroutineä¸‹çš„å®‰å…¨
	l.mu.Lock()
	defer l.mu.Unlock()
	//å¦‚æœé…ç½®äº†è·å–æ–‡ä»¶å’Œè¡Œå·çš„è¯
	if l.flag&amp;amp;(Lshortfile|Llongfile) != 0 {
		//å› ä¸ºruntime.Callerä»£ä»·æ¯”è¾ƒå¤§ï¼Œå…ˆä¸åŠ é”
		l.mu.Unlock()
		var ok bool
		_, file, line, ok = runtime.Caller(calldepth)
		if !ok {
			file = &amp;#34;???&amp;#34;
			line = 0
		}
		//è·å–åˆ°è¡Œå·ç­‰ä¿¡æ¯åï¼Œå†åŠ é”ï¼Œä¿è¯å®‰å…¨
		l.mu.Lock()
	}
	//æŠŠæˆ‘ä»¬çš„æ—¥å¿—ä¿¡æ¯å’Œè®¾ç½®çš„æ—¥å¿—æŠ¬å¤´è¿›è¡Œæ‹¼æ¥
	l.buf = l.buf[:0]
	l.formatHeader(&amp;amp;l.buf, now, file, line)
	l.buf = append(l.buf, s...)
	if len(s) == 0 || s[len(s)-1] != &amp;#39;\n&amp;#39; {
		l.buf = append(l.buf, &amp;#39;\n&amp;#39;)
	}
	//è¾“å‡ºæ‹¼æ¥å¥½çš„ç¼“å†²bufé‡Œçš„æ—¥å¿—ä¿¡æ¯åˆ°ç›®çš„åœ°
	_, err := l.out.Write(l.buf)
	return err
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ•´ä¸ªä»£ç æ¯”è¾ƒç®€æ´ï¼Œä¸ºäº†å¤šgoroutineå®‰å…¨äº’æ–¥é”ä¹Ÿç”¨ä¸Šäº†ï¼Œä½†æ˜¯åœ¨è·å–è°ƒç”¨å †æ ˆä¿¡æ¯çš„æ—¶å€™ï¼Œåˆè¦å…ˆè§£é”ï¼Œå› ä¸ºè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒé‡ã€‚è·å–åˆ°æ–‡ä»¶ã€è¡Œå·ç­‰ä¿¡æ¯åï¼Œç»§ç»­åŠ äº’æ–¥é”ä¿è¯å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;åé¢çš„å°±æ¯”è¾ƒç®€å•äº†ï¼Œ&lt;code&gt;formatHeader&lt;/code&gt;æ–¹æ³•ä¸»è¦æ˜¯æ ¼å¼åŒ–æ—¥å¿—æŠ¬å¤´ä¿¡æ¯ï¼Œç„¶åå­˜å‚¨åœ¨bufè¿™ä¸ªç¼“å†²ä¸­ï¼Œæœ€åå†æŠŠæˆ‘ä»¬è‡ªå·±çš„æ—¥å¿—ä¿¡æ¯æ‹¼æ¥åˆ°ç¼“å†²bufçš„åé¢ï¼Œç„¶åä¸ºä¸€æ¬¡logæ—¥å¿—è¾“å‡ºè¿½åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œè¿™æ ·æ¯æ¬¡æ—¥å¿—è¾“å‡ºéƒ½æ˜¯ä¸€è¡Œä¸€è¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†æœ€ç»ˆçš„æ—¥å¿—ä¿¡æ¯&lt;code&gt;buf&lt;/code&gt;ï¼Œç„¶åæŠŠå®ƒå†™åˆ°è¾“å‡ºçš„ç›®çš„åœ°outé‡Œå°±å¯ä»¥äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªå®ç°äº†&lt;code&gt;io.Writer&lt;/code&gt;æ¥å£çš„ç±»å‹ï¼Œåªè¦å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œéƒ½å¯ä»¥å½“ä½œè¾“å‡ºç›®çš„åœ°ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (l *Logger) SetOutput(w io.Writer) {
	l.mu.Lock()
	defer l.mu.Unlock()
	l.out = w
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;log&lt;/code&gt;åŒ…çš„&lt;code&gt;SetOutput&lt;/code&gt;å‡½æ•°ï¼Œå¯ä»¥è®¾ç½®è¾“å‡ºç›®çš„åœ°ã€‚è¿™é‡Œç¨å¾®ç®€å•ä»‹ç»ä¸‹&lt;code&gt;runtime.Caller&lt;/code&gt;ï¼Œå®ƒå¯ä»¥è·å–è¿è¡Œæ—¶æ–¹æ³•çš„è°ƒç”¨ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Caller(skip int) (pc uintptr, file string, line int, ok bool)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å‚æ•°&lt;code&gt;skip&lt;/code&gt;è¡¨ç¤ºè·³è¿‡æ ˆå¸§æ•°ï¼Œ&lt;code&gt;0&lt;/code&gt;è¡¨ç¤ºä¸è·³è¿‡ï¼Œä¹Ÿå°±æ˜¯&lt;code&gt;runtime.Caller&lt;/code&gt;çš„è°ƒç”¨è€…ã€‚&lt;code&gt;1&lt;/code&gt;çš„è¯å°±æ˜¯å†å‘ä¸Šä¸€å±‚ï¼Œè¡¨ç¤ºè°ƒç”¨è€…çš„è°ƒç”¨è€…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;log&lt;/code&gt;æ—¥å¿—åŒ…é‡Œä½¿ç”¨çš„æ˜¯&lt;code&gt;2&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºæˆ‘ä»¬åœ¨æºä»£ç ä¸­è°ƒç”¨&lt;code&gt;log.Print&lt;/code&gt;ã€&lt;code&gt;log.Fatal&lt;/code&gt;å’Œ&lt;code&gt;log.Panic&lt;/code&gt;è¿™äº›å‡½æ•°çš„è°ƒç”¨è€…ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥&lt;code&gt;main&lt;/code&gt;å‡½æ•°è°ƒç”¨&lt;code&gt;log.Println&lt;/code&gt;ä¸ºä¾‹ï¼Œæ˜¯&lt;code&gt;main-&amp;gt;log.Println-&amp;gt;*Logger.Output-&amp;gt;runtime.Caller&lt;/code&gt;è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ ˆï¼Œæ‰€ä»¥è¿™æ—¶å€™ï¼Œskipçš„å€¼åˆ†åˆ«ä»£è¡¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;0è¡¨ç¤º*Logger.Outputä¸­è°ƒç”¨runtime.Callerçš„æºä»£ç æ–‡ä»¶å’Œè¡Œå·&lt;/li&gt;
&lt;li&gt;1è¡¨ç¤ºlog.Printlnä¸­è°ƒç”¨*Logger.Outputçš„æºä»£ç æ–‡ä»¶å’Œè¡Œå·&lt;/li&gt;
&lt;li&gt;2è¡¨ç¤ºmainä¸­è°ƒç”¨log.Printlnçš„æºä»£ç æ–‡ä»¶å’Œè¡Œå·&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‰€ä»¥è¿™ä¹Ÿæ˜¯&lt;code&gt;log&lt;/code&gt;åŒ…é‡Œçš„è¿™ä¸ª&lt;code&gt;skip&lt;/code&gt;çš„å€¼ä¸ºä»€ä¹ˆä¸€ç›´æ˜¯2çš„åŸå› ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å®šåˆ¶è‡ªå·±çš„æ—¥å¿—&#34;&gt;å®šåˆ¶è‡ªå·±çš„æ—¥å¿— &lt;a href=&#34;#%e5%ae%9a%e5%88%b6%e8%87%aa%e5%b7%b1%e7%9a%84%e6%97%a5%e5%bf%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é€šè¿‡ä¸Šé¢çš„æºç åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“æ—¥å¿—è®°å½•çš„æ ¹æœ¬å°±åœ¨äºä¸€ä¸ªæ—¥å¿—è®°å½•å™¨&lt;code&gt;Logger&lt;/code&gt;ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šåˆ¶è‡ªå·±çš„æ—¥å¿—ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºä¸åŒçš„&lt;code&gt;Logger&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var (
	Info *log.Logger
	Warning *log.Logger
	Error * log.Logger
)

func init(){
	errFile,err:=os.OpenFile(&amp;#34;errors.log&amp;#34;,os.O_CREATE|os.O_WRONLY|os.O_APPEND,0666)
	if err!=nil{
		log.Fatalln(&amp;#34;æ‰“å¼€æ—¥å¿—æ–‡ä»¶å¤±è´¥ï¼š&amp;#34;,err)
	}

	Info = log.New(os.Stdout,&amp;#34;Info:&amp;#34;,log.Ldate | log.Ltime | log.Lshortfile)
	Warning = log.New(os.Stdout,&amp;#34;Warning:&amp;#34;,log.Ldate | log.Ltime | log.Lshortfile)
	Error = log.New(io.MultiWriter(os.Stderr,errFile),&amp;#34;Error:&amp;#34;,log.Ldate | log.Ltime | log.Lshortfile)

}

func main() {
	Info.Println(&amp;#34;é£é›ªæ— æƒ…çš„åšå®¢:&amp;#34;,&amp;#34;http://www.flysnow.org&amp;#34;)
	Warning.Printf(&amp;#34;é£é›ªæ— æƒ…çš„å¾®ä¿¡å…¬ä¼—å·ï¼š%s\n&amp;#34;,&amp;#34;flysnow_org&amp;#34;)
	Error.Println(&amp;#34;æ¬¢è¿å…³æ³¨ç•™è¨€&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬æ ¹æ®æ—¥å¿—çº§åˆ«å®šä¹‰äº†ä¸‰ç§ä¸åŒçš„&lt;code&gt;Logger&lt;/code&gt;ï¼Œåˆ†åˆ«ä¸º&lt;code&gt;Info&lt;/code&gt;,&lt;code&gt;Warning&lt;/code&gt;,&lt;code&gt;Error&lt;/code&gt;ï¼Œç”¨äºä¸åŒçº§åˆ«æ—¥å¿—çš„è¾“å‡ºã€‚è¿™ä¸‰ç§æ—¥å¿—è®°å½•å™¨éƒ½æ˜¯ä½¿ç”¨&lt;code&gt;log.New&lt;/code&gt;å‡½æ•°è¿›è¡Œåˆ›å»ºã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œåˆ›å»º&lt;code&gt;Logger&lt;/code&gt;çš„æ—¶å€™ï¼Œ&lt;code&gt;Info&lt;/code&gt;å’Œ&lt;code&gt;Warning&lt;/code&gt;éƒ½æ¯”è¾ƒæ­£å¸¸ï¼Œ&lt;code&gt;Error&lt;/code&gt;è¿™é‡Œé‡‡ç”¨äº†å¤šä¸ªç›®çš„åœ°è¾“å‡ºï¼Œè¿™é‡Œå¯ä»¥åŒæ—¶æŠŠé”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°&lt;code&gt;os.Stderr&lt;/code&gt;ä»¥åŠæˆ‘ä»¬åˆ›å»ºçš„&lt;code&gt;errors.log&lt;/code&gt;æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;io.MultiWriter&lt;/code&gt;å‡½æ•°å¯ä»¥åŒ…è£…å¤šä¸ª&lt;code&gt;io.Writer&lt;/code&gt;ä¸ºä¸€ä¸ª&lt;code&gt;io.Writer&lt;/code&gt;ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¾¾åˆ°åŒæ—¶å¯¹å¤šä¸ª&lt;code&gt;io.Writer&lt;/code&gt;è¾“å‡ºæ—¥å¿—çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;io.MultiWriter&lt;/code&gt;çš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œå®šä¹‰ä¸€ä¸ªç±»å‹å®ç°&lt;code&gt;io.Writer&lt;/code&gt;ï¼Œç„¶ååœ¨å®ç°çš„&lt;code&gt;Write&lt;/code&gt;æ–¹æ³•é‡Œå¾ªç¯è°ƒç”¨è¦åŒ…è£…çš„å¤šä¸ª&lt;code&gt;Writer&lt;/code&gt;æ¥å£çš„&lt;code&gt;Write&lt;/code&gt;æ–¹æ³•å³å¯ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (t *multiWriter) Write(p []byte) (n int, err error) {
	for _, w := range t.writers {
		n, err = w.Write(p)
		if err != nil {
			return
		}
		if n != len(p) {
			err = ErrShortWrite
			return
		}
	}
	return len(p), nil
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬é€šè¿‡å®šä¹‰äº†å¤šä¸ªLoggeræ¥åŒºåˆ†ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼Œä½¿ç”¨æ¯”è¾ƒéº»çƒ¦ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„logæ¡†æ¶ï¼Œä¹Ÿå¯ä»¥è‡ªå®šåŒ…è£…å®šä¹‰ï¼Œç›´æ¥é€šè¿‡ä¸åŒçº§åˆ«çš„æ–¹æ³•æ¥è®°å½•ä¸åŒçº§åˆ«çš„æ—¥å¿—ï¼Œè¿˜å¯ä»¥è®¾ç½®è®°å½•æ—¥å¿—çš„çº§åˆ«ç­‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ”¶é›†æ¥æºï¼šhttps://www.flysnow.org&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Golang sync åŒ…çš„ç›¸å…³ä½¿ç”¨æ–¹æ³•</title>
      <link>https://abnerxc.github.io/go/sync/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/sync/</guid>
      <description>&lt;h1 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦é”&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦é” &lt;a href=&#34;#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e9%94%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹æˆ–åç¨‹åŒæ—¶å»ä¿®æ”¹ä¸€ä¸ªå˜é‡ï¼Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;fmt&amp;#34;
    &amp;#34;sync&amp;#34;
    &amp;#34;time&amp;#34;
)

func main() {
    var a = 0

    // å¯åŠ¨ 100 ä¸ªåç¨‹ï¼Œéœ€è¦è¶³å¤Ÿå¤§
    // var lock sync.Mutex
    for i := 0; i &amp;lt; 100; i++ {
        go func(idx int) {
            // lock.Lock()
            // defer lock.Unlock()
            a += 1
            fmt.Printf(&amp;#34;goroutine %d, a=%d\n&amp;#34;, idx, a)
        }(i)
    }

    // ç­‰å¾… 1s ç»“æŸä¸»ç¨‹åº
    // ç¡®ä¿æ‰€æœ‰åç¨‹æ‰§è¡Œå®Œ
    time.Sleep(time.Second)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è§‚å¯Ÿæ‰“å°ç»“æœï¼Œæ˜¯å¦å‡ºç° a çš„å€¼æ˜¯ç›¸åŒçš„æƒ…å†µï¼ˆæœªå‡ºç°åˆ™é‡è¯•æˆ–è°ƒå¤§åç¨‹æ•°ï¼‰ï¼Œç­”æ¡ˆï¼šæ˜¯çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› æ˜¯ï¼Œåç¨‹ä¾æ¬¡æ‰§è¡Œï¼šä»å¯„å­˜å™¨è¯»å– a çš„å€¼ -&amp;gt; ç„¶ååšåŠ æ³•è¿ç®— -&amp;gt; æœ€åå†™ä¼šå¯„å­˜å™¨ã€‚è¯•æƒ³ï¼Œæ­¤æ—¶ä¸€ä¸ªåç¨‹å–å‡º a çš„å€¼ 3ï¼Œæ­£åœ¨åšåŠ æ³•è¿ç®—ï¼ˆè¿˜æœªå†™å›å¯„å­˜å™¨ï¼‰ã€‚åŒæ—¶å¦ä¸€ä¸ªåç¨‹æ­¤æ—¶å»å–ï¼Œå–å‡ºäº†åŒæ ·çš„ a çš„å€¼ 3ã€‚æœ€ç»ˆå¯¼è‡´çš„ç»“æœæ˜¯ï¼Œä¸¤ä¸ªåç¨‹äº§å‡ºçš„ç»“æœç›¸åŒï¼Œa ç›¸å½“äºåªå¢åŠ äº† 1ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œé”çš„æ¦‚å¿µå°±æ˜¯ï¼Œæˆ‘æ­£åœ¨å¤„ç† aï¼ˆé”å®šï¼‰ï¼Œä½ ä»¬è°éƒ½åˆ«å’Œæˆ‘æŠ¢ï¼Œç­‰æˆ‘å¤„ç†å®Œäº†ï¼ˆè§£é”ï¼‰ï¼Œä½ ä»¬å†å¤„ç†ã€‚è¿™æ ·å°±å®ç°äº†ï¼ŒåŒæ—¶å¤„ç† a çš„åç¨‹åªæœ‰ä¸€ä¸ªï¼Œå°±å®ç°äº†åŒæ­¥ã€‚&lt;/p&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;ä»€ä¹ˆæ˜¯äº’æ–¥é”-mutex&#34;&gt;ä»€ä¹ˆæ˜¯äº’æ–¥é” Mutexï¼Ÿ &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e4%ba%92%e6%96%a5%e9%94%81-mutex&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»€ä¹ˆæ˜¯äº’æ–¥é”ï¼Ÿå®ƒæ˜¯é”çš„ä¸€ç§å…·ä½“å®ç°ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (m *Mutex) Lock()
func (m *Mutex) Unlock()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨é¦–æ¬¡ä½¿ç”¨åä¸è¦å¤åˆ¶è¯¥äº’æ–¥é”ã€‚å¯¹ä¸€ä¸ªæœªé”å®šçš„äº’æ–¥é”è§£é”å°†ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªäº’æ–¥é”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ª goroutine é”å®šï¼Œå…¶å®ƒ goroutine å°†é˜»å¡ç›´åˆ°äº’æ–¥é”è¢«è§£é”ï¼ˆé‡æ–°äº‰æŠ¢å¯¹äº’æ–¥é”çš„é”å®šï¼‰ã€‚å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;fmt&amp;#34;
    &amp;#34;sync&amp;#34;
    &amp;#34;time&amp;#34;
)

func main() {
    ch := make(chan struct{}, 2)

    var l sync.Mutex
    go func() {
        l.Lock()
        defer l.Unlock()
        fmt.Println(&amp;#34;goroutine1: æˆ‘ä¼šé”å®šå¤§æ¦‚ 2s&amp;#34;)
        time.Sleep(time.Second * 2)
        fmt.Println(&amp;#34;goroutine1: æˆ‘è§£é”äº†ï¼Œä½ ä»¬å»æŠ¢å§&amp;#34;)
        ch &amp;lt;- struct{}{}
    }()

    go func() {
        fmt.Println(&amp;#34;groutine2: ç­‰å¾…è§£é”&amp;#34;)
        l.Lock()
        defer l.Unlock()
        fmt.Println(&amp;#34;goroutine2: å“ˆå“ˆï¼Œæˆ‘é”å®šäº†&amp;#34;)
        ch &amp;lt;- struct{}{}
    }()

    // ç­‰å¾… goroutine æ‰§è¡Œç»“æŸ
    for i := 0; i &amp;lt; 2; i++ {
        &amp;lt;-ch
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼Œå¹³æ—¶æ‰€è¯´çš„é”å®šï¼Œå…¶å®å°±æ˜¯å»é”å®šäº’æ–¥é”ï¼Œè€Œä¸æ˜¯è¯´å»é”å®šä¸€æ®µä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°æœ‰é”çš„åœ°æ–¹æ—¶ï¼Œå®ƒè·å–ä¸åˆ°äº’æ–¥é”çš„é”å®šï¼Œä¼šé˜»å¡åœ¨é‚£é‡Œï¼Œä»è€Œè¾¾åˆ°æ§åˆ¶åŒæ­¥çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;ä»€ä¹ˆæ˜¯è¯»å†™é”-rwmutex&#34;&gt;ä»€ä¹ˆæ˜¯è¯»å†™é” RWMutex? &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e8%af%bb%e5%86%99%e9%94%81-rwmutex&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é‚£ä¹ˆä»€ä¹ˆæ˜¯è¯»å†™é”å‘¢ï¼Ÿå®ƒæ˜¯é’ˆå¯¹è¯»å†™æ“ä½œçš„äº’æ–¥é”ï¼Œè¯»å†™é”ä¸äº’æ–¥é”æœ€å¤§çš„ä¸åŒå°±æ˜¯å¯ä»¥åˆ†åˆ«å¯¹ è¯»ã€å†™ è¿›è¡Œé”å®šã€‚ä¸€èˆ¬ç”¨åœ¨å¤§é‡è¯»æ“ä½œã€å°‘é‡å†™æ“ä½œçš„æƒ…å†µï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (rw *RWMutex) Lock()
func (rw *RWMutex) Unlock()

func (rw *RWMutex) RLock()
func (rw *RWMutex) RUnlock()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç”±äºè¿™é‡Œéœ€è¦åŒºåˆ†è¯»å†™é”å®šï¼Œæˆ‘ä»¬è¿™æ ·å®šä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»é”å®šï¼ˆRLockï¼‰ï¼Œå¯¹è¯»æ“ä½œè¿›è¡Œé”å®š&lt;/li&gt;
&lt;li&gt;è¯»è§£é”ï¼ˆRUnlockï¼‰ï¼Œå¯¹è¯»é”å®šè¿›è¡Œè§£é”&lt;/li&gt;
&lt;li&gt;å†™é”å®šï¼ˆLockï¼‰ï¼Œå¯¹å†™æ“ä½œè¿›è¡Œé”å®š&lt;/li&gt;
&lt;li&gt;å†™è§£é”ï¼ˆUnlockï¼‰ï¼Œå¯¹å†™é”å®šè¿›è¡Œè§£é”&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨é¦–æ¬¡ä½¿ç”¨ä¹‹åï¼Œä¸è¦å¤åˆ¶è¯¥è¯»å†™é”ã€‚ä¸è¦æ··ç”¨é”å®šå’Œè§£é”ï¼Œå¦‚ï¼šLock å’Œ RUnlockã€RLock å’Œ Unlockã€‚å› ä¸ºå¯¹æœªè¯»é”å®šçš„è¯»å†™é”è¿›è¡Œè¯»è§£é”æˆ–å¯¹æœªå†™é”å®šçš„è¯»å†™é”è¿›è¡Œå†™è§£é”å°†ä¼šå¼•èµ·è¿è¡Œæ—¶é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•ç†è§£è¯»å†™é”å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª goroutine èƒ½å¤Ÿè·å¾—å†™é”å®šã€‚&lt;/li&gt;
&lt;li&gt;åŒæ—¶å¯ä»¥æœ‰ä»»æ„å¤šä¸ª gorouinte è·å¾—è¯»é”å®šã€‚&lt;/li&gt;
&lt;li&gt;åŒæ—¶åªèƒ½å­˜åœ¨å†™é”å®šæˆ–è¯»é”å®šï¼ˆè¯»å’Œå†™äº’æ–¥ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æœ‰ä¸€ä¸ª goroutine è·å¾—å†™é”å®šï¼Œå…¶å®ƒæ— è®ºæ˜¯è¯»é”å®šè¿˜æ˜¯å†™é”å®šéƒ½å°†é˜»å¡ç›´åˆ°å†™è§£é”ï¼›å½“æœ‰ä¸€ä¸ª goroutine è·å¾—è¯»é”å®šï¼Œå…¶å®ƒè¯»é”å®šä»»ç„¶å¯ä»¥ç»§ç»­ï¼›å½“æœ‰ä¸€ä¸ªæˆ–ä»»æ„å¤šä¸ªè¯»é”å®šï¼Œå†™é”å®šå°†ç­‰å¾…æ‰€æœ‰è¯»é”å®šè§£é”ä¹‹åæ‰èƒ½å¤Ÿè¿›è¡Œå†™é”å®šã€‚æ‰€ä»¥è¯´è¿™é‡Œçš„è¯»é”å®šï¼ˆRLockï¼‰ç›®çš„å…¶å®æ˜¯å‘Šè¯‰å†™é”å®šï¼šæœ‰å¾ˆå¤šäººæ­£åœ¨è¯»å–æ•°æ®ï¼Œä½ ç»™æˆ‘ç«™ä¸€è¾¹å»ï¼Œç­‰å®ƒä»¬è¯»ï¼ˆè¯»è§£é”ï¼‰å®Œä½ å†æ¥å†™ï¼ˆå†™é”å®šï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;fmt&amp;#34;
    &amp;#34;math/rand&amp;#34;
    &amp;#34;sync&amp;#34;
)

var count int
var rw sync.RWMutex

func main() {
    ch := make(chan struct{}, 10)
    for i := 0; i &amp;lt; 5; i++ {
        go read(i, ch)
    }
    for i := 0; i &amp;lt; 5; i++ {
        go write(i, ch)
    }

    for i := 0; i &amp;lt; 10; i++ {
        &amp;lt;-ch
    }
}

func read(n int, ch chan struct{}) {
    rw.RLock()
    fmt.Printf(&amp;#34;goroutine %d è¿›å…¥è¯»æ“ä½œ...\n&amp;#34;, n)
    v := count
    fmt.Printf(&amp;#34;goroutine %d è¯»å–ç»“æŸï¼Œå€¼ä¸ºï¼š%d\n&amp;#34;, n, v)
    rw.RUnlock()
    ch &amp;lt;- struct{}{}
}

func write(n int, ch chan struct{}) {
    rw.Lock()
    fmt.Printf(&amp;#34;goroutine %d è¿›å…¥å†™æ“ä½œ...\n&amp;#34;, n)
    v := rand.Intn(1000)
    count = v
    fmt.Printf(&amp;#34;goroutine %d å†™å…¥ç»“æŸï¼Œæ–°å€¼ä¸ºï¼š%d\n&amp;#34;, n, v)
    rw.Unlock()
    ch &amp;lt;- struct{}{}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;waitgroup-ä¾‹å­&#34;&gt;WaitGroup ä¾‹å­ &lt;a href=&#34;#waitgroup-%e4%be%8b%e5%ad%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;WaitGroup ç”¨äºç­‰å¾…ä¸€ç»„ goroutine ç»“æŸï¼Œç”¨æ³•å¾ˆç®€å•ã€‚å®ƒæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (wg *WaitGroup) Add(delta int)
func (wg *WaitGroup) Done()
func (wg *WaitGroup) Wait()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Add ç”¨æ¥æ·»åŠ  goroutine çš„ä¸ªæ•°ã€‚Done æ‰§è¡Œä¸€æ¬¡æ•°é‡å‡ 1ã€‚Wait ç”¨æ¥ç­‰å¾…ç»“æŸï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;fmt&amp;#34;
    &amp;#34;sync&amp;#34;
    &amp;#34;time&amp;#34;
)

func main() {
    var wg sync.WaitGroup

    for i := 0; i &amp;lt; 5; i++ {
        // è®¡æ•°åŠ  1
        wg.Add(1)
        go func(i int) {
            // è®¡æ•°å‡ 1
            defer wg.Done()
            time.Sleep(time.Second * time.Duration(i))
            fmt.Printf(&amp;#34;goroutine%d ç»“æŸ\n&amp;#34;, i)
        }(i)
    }

    // ç­‰å¾…æ‰§è¡Œç»“æŸ
    wg.Wait()
    fmt.Println(&amp;#34;æ‰€æœ‰ goroutine æ‰§è¡Œç»“æŸ&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;æ³¨æ„ï¼Œwg.Add() æ–¹æ³•ä¸€å®šè¦åœ¨ goroutine å¼€å§‹å‰æ‰§è¡Œå“¦ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;cond-æ¡ä»¶å˜é‡&#34;&gt;Cond æ¡ä»¶å˜é‡ &lt;a href=&#34;#cond-%e6%9d%a1%e4%bb%b6%e5%8f%98%e9%87%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Cond å®ç°ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œå³ç­‰å¾…æˆ–å®£å¸ƒäº‹ä»¶å‘ç”Ÿçš„ goroutines çš„ä¼šåˆç‚¹ï¼Œå®ƒä¼šä¿å­˜ä¸€ä¸ªé€šçŸ¥åˆ—è¡¨ã€‚åŸºæœ¬æ€æƒ³æ˜¯å½“æŸä¸­çŠ¶æ€è¾¾æˆï¼Œgoroutine å°†ä¼šç­‰å¾…ï¼ˆWaitï¼‰åœ¨é‚£é‡Œï¼Œå½“æŸä¸ªæ—¶åˆ»çŠ¶æ€æ”¹å˜æ—¶é€šè¿‡é€šçŸ¥çš„æ–¹å¼ï¼ˆBroadcastï¼ŒSignalï¼‰çš„æ–¹å¼é€šçŸ¥ç­‰å¾…çš„ goroutineã€‚è¿™æ ·ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„ goroutine å”¤é†’ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œæ»¡è¶³æ¡ä»¶çš„é‡æ–°è¿›å…¥ç­‰å¾…åºåˆ—ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Cond struct {
    noCopy noCopy
  
    // L is held while observing or changing the condition
    L Locker
  
    notify  notifyList // é€šçŸ¥åˆ—è¡¨
    checker copyChecker
}
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func NewCond(l Locker) *Cond
func (c *Cond) Broadcast()
func (c *Cond) Signal()
func (c *Cond) Wait()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Wait æ–¹æ³•ã€Signal æ–¹æ³•å’Œ Broadcast æ–¹æ³•ã€‚å®ƒä»¬åˆ†åˆ«ä»£è¡¨äº†ç­‰å¾…é€šçŸ¥ã€å•å‘é€šçŸ¥å’Œå¹¿æ’­é€šçŸ¥çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Wait æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (c *Cond) Wait() {
    c.checker.check()
    t := runtime_notifyListAdd(&amp;amp;c.notify)
    c.L.Unlock()
    runtime_notifyListWait(&amp;amp;c.notify, t)
    c.L.Lock()
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å®ƒçš„æ“ä½œä¸ºï¼šåŠ å…¥åˆ°é€šçŸ¥åˆ—è¡¨ -&amp;gt; è§£é” L -&amp;gt; ç­‰å¾…é€šçŸ¥ -&amp;gt; é”å®š Lã€‚å…¶ä½¿ç”¨æ–¹æ³•æ˜¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;c.L.Lock()
for !condition() {
    c.Wait()
}
... make use of condition ...
c.L.Unlock()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸¾ä¸ªä¾‹å­:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// Package main provides ...
package main

import (
    &amp;#34;fmt&amp;#34;
    &amp;#34;sync&amp;#34;
    &amp;#34;time&amp;#34;
)

var count int = 4

func main() {
    ch := make(chan struct{}, 5)

    // æ–°å»º cond
    var l sync.Mutex
    cond := sync.NewCond(&amp;amp;l)

    for i := 0; i &amp;lt; 5; i++ {
        go func(i int) {
            // äº‰æŠ¢äº’æ–¥é”çš„é”å®š
            cond.L.Lock()
            defer func() {
                cond.L.Unlock()
                ch &amp;lt;- struct{}{}
            }()

            // æ¡ä»¶æ˜¯å¦è¾¾æˆ
            for count &amp;gt; i {
                cond.Wait()
                fmt.Printf(&amp;#34;æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ goroutine%d\n&amp;#34;, i)
            }
            
            fmt.Printf(&amp;#34;goroutine%d æ‰§è¡Œç»“æŸ\n&amp;#34;, i)
        }(i)
    }

    // ç¡®ä¿æ‰€æœ‰ goroutine å¯åŠ¨å®Œæˆ
    time.Sleep(time.Millisecond * 20)
    
    // é”å®šä¸€ä¸‹
    fmt.Println(&amp;#34;broadcast...&amp;#34;)
    cond.L.Lock()
    count -= 1
    cond.Broadcast()
    cond.L.Unlock()

    time.Sleep(time.Second)
    fmt.Println(&amp;#34;signal...&amp;#34;)
    cond.L.Lock()
    count -= 2
    cond.Signal()
    cond.L.Unlock()

    time.Sleep(time.Second)
    fmt.Println(&amp;#34;broadcast...&amp;#34;)
    cond.L.Lock()
    count -= 1
    cond.Broadcast()
    cond.L.Unlock()

    for i := 0; i &amp;lt; 5; i++ {
        &amp;lt;-ch
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;pool-ä¸´æ—¶å¯¹è±¡æ± &#34;&gt;Pool ä¸´æ—¶å¯¹è±¡æ±  &lt;a href=&#34;#pool-%e4%b8%b4%e6%97%b6%e5%af%b9%e8%b1%a1%e6%b1%a0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;sync.Pool å¯ä»¥ä½œä¸ºä¸´æ—¶å¯¹è±¡çš„ä¿å­˜å’Œå¤ç”¨çš„é›†åˆã€‚å…¶ç»“æ„ä¸ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Pool struct {
    noCopy noCopy

    local     unsafe.Pointer // local fixed-size per-P pool, actual type is [P]poolLocal
    localSize uintptr        // size of the local array

    // New optionally specifies a function to generate
    // a value when Get would otherwise return nil.
    // It may not be changed concurrently with calls to Get.
    New func() interface{}
}

func (p *Pool) Get() interface{}
func (p *Pool) Put(x interface{})
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ–°é”® Pool éœ€è¦æä¾›ä¸€ä¸ª New æ–¹æ³•ï¼Œç›®çš„æ˜¯å½“è·å–ä¸åˆ°ä¸´æ—¶å¯¹è±¡æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªï¼ˆä¸ä¼šä¸»åŠ¨åŠ å…¥åˆ° Pool ä¸­ï¼‰ï¼ŒGet å’Œ Put æ–¹æ³•éƒ½å¾ˆå¥½ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;æ·±å…¥äº†è§£è¿‡ Go çš„åŒå­¦åº”è¯¥çŸ¥é“ï¼ŒGo çš„é‡è¦ç»„æˆç»“æ„ä¸º Mã€Pã€Gã€‚Pool å®é™…ä¸Šä¼šä¸ºæ¯ä¸€ä¸ªæ“ä½œå®ƒçš„ goroutine ç›¸å…³è”çš„ P éƒ½ç”Ÿæˆä¸€ä¸ªæœ¬åœ°æ± ã€‚å¦‚æœä»æœ¬åœ°æ±  Get å¯¹è±¡çš„æ—¶å€™ï¼Œæœ¬åœ°æ± æ²¡æœ‰ï¼Œåˆ™ä¼šä»å…¶å®ƒçš„ P æœ¬åœ°æ± è·å–ã€‚å› æ­¤ï¼ŒPool çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼šå¯ä»¥æŠŠç”±å…¶ä¸­çš„å¯¹è±¡å€¼äº§ç”Ÿçš„å­˜å‚¨å‹åŠ›è¿›è¡Œåˆ†æ‘Šã€‚&lt;/p&gt;
&lt;p&gt;å®ƒæœ‰ç€ä»¥ä¸‹ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pool ä¸­çš„å¯¹è±¡åœ¨ä»…æœ‰ Pool æœ‰ç€å”¯ä¸€ç´¢å¼•çš„æƒ…å†µä¸‹å¯èƒ½ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆå–å†³äºä¸‹ä¸€æ¬¡ GC æ‰§è¡Œçš„æ—¶é—´ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;goroutines åç¨‹å®‰å…¨ï¼Œå¯ä»¥åŒæ—¶è¢«å¤šä¸ªåç¨‹ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;GC çš„æ‰§è¡Œä¸€èˆ¬ä¼šä½¿ Pool ä¸­çš„å¯¹è±¡å…¨éƒ¨ç§»é™¤ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é‚£ä¹ˆ Pool éƒ½é€‚ç”¨äºä»€ä¹ˆåœºæ™¯å‘¢ï¼Ÿä»å®ƒçš„ç‰¹ç‚¹æ¥è¯´ï¼Œé€‚ç”¨ä¸æ— çŠ¶æ€çš„å¯¹è±¡çš„å¤ç”¨ï¼Œè€Œä¸é€‚ç”¨ä¸å¦‚è¿æ¥æ± ä¹‹ç±»çš„ã€‚åœ¨ fmt åŒ…ä¸­æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ä½¿ç”¨æ± çš„ä¾‹å­ï¼Œå®ƒç»´æŠ¤ä¸€ä¸ªåŠ¨æ€å¤§å°çš„ä¸´æ—¶è¾“å‡ºç¼“å†²åŒºã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
    &amp;#34;bytes&amp;#34;
    &amp;#34;io&amp;#34;
    &amp;#34;os&amp;#34;
    &amp;#34;sync&amp;#34;
    &amp;#34;time&amp;#34;
)

var bufPool = sync.Pool{
    New: func() interface{} {
        return new(bytes.Buffer)
    },
}

func timeNow() time.Time {
    return time.Unix(1136214245, 0)
}

func Log(w io.Writer, key, val string) {
    // è·å–ä¸´æ—¶å¯¹è±¡ï¼Œæ²¡æœ‰çš„è¯ä¼šè‡ªåŠ¨åˆ›å»º
    b := bufPool.Get().(*bytes.Buffer)
    b.Reset()
    b.WriteString(timeNow().UTC().Format(time.RFC3339))
    b.WriteByte(&amp;#39; &amp;#39;)
    b.WriteString(key)
    b.WriteByte(&amp;#39;=&amp;#39;)
    b.WriteString(val)
    w.Write(b.Bytes())
    // å°†ä¸´æ—¶å¯¹è±¡æ”¾å›åˆ° Pool ä¸­
    bufPool.Put(b)
}

func main() {
    Log(os.Stdout, &amp;#34;path&amp;#34;, &amp;#34;/search?q=flowers&amp;#34;)
}

æ‰“å°ç»“æœï¼š
2006-01-02T15:04:05Z path=/search?q=flowers
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;once-æ‰§è¡Œä¸€æ¬¡&#34;&gt;Once æ‰§è¡Œä¸€æ¬¡ &lt;a href=&#34;#once-%e6%89%a7%e8%a1%8c%e4%b8%80%e6%ac%a1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä½¿ç”¨ sync.Once å¯¹è±¡å¯ä»¥ä½¿å¾—å‡½æ•°å¤šæ¬¡è°ƒç”¨åªæ‰§è¡Œä¸€æ¬¡ã€‚å…¶ç»“æ„ä¸ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Once struct {
    m    Mutex
    done uint32
}

func (o *Once) Do(f func())
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç”¨ done æ¥è®°å½•æ‰§è¡Œæ¬¡æ•°ï¼Œç”¨ m æ¥ä¿è¯ä¿è¯ä»…è¢«æ‰§è¡Œä¸€æ¬¡ã€‚åªæœ‰ä¸€ä¸ª Do æ–¹æ³•ï¼Œè°ƒç”¨æ‰§è¡Œã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GoåŸºç¡€-iota</title>
      <link>https://abnerxc.github.io/go/base1.iota/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/base1.iota/</guid>
      <description>&lt;p&gt;&lt;code&gt;iota-goè¯­è¨€ä¸­çš„å¸¸é‡è®¡æ•°å™¨ï¼Œåªèƒ½åœ¨å¸¸é‡è¡¨è¾¾å¼ä¸­ä½¿ç”¨&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;iotaåªèƒ½åœ¨å¸¸é‡çš„è¡¨è¾¾å¼ä¸­ä½¿ç”¨&#34;&gt;iotaåªèƒ½åœ¨å¸¸é‡çš„è¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚ &lt;a href=&#34;#iota%e5%8f%aa%e8%83%bd%e5%9c%a8%e5%b8%b8%e9%87%8f%e7%9a%84%e8%a1%a8%e8%be%be%e5%bc%8f%e4%b8%ad%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;fmt.Println(iota) 
ç¼–è¯‘é”™è¯¯ï¼š undefined: iota
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æ¯æ¬¡-const-å‡ºç°æ—¶éƒ½ä¼šè®©-iota-åˆå§‹åŒ–ä¸º0è‡ªå¢é•¿&#34;&gt;æ¯æ¬¡ const å‡ºç°æ—¶ï¼Œéƒ½ä¼šè®© iota åˆå§‹åŒ–ä¸º0.ã€è‡ªå¢é•¿ã€‘ &lt;a href=&#34;#%e6%af%8f%e6%ac%a1-const-%e5%87%ba%e7%8e%b0%e6%97%b6%e9%83%bd%e4%bc%9a%e8%ae%a9-iota-%e5%88%9d%e5%a7%8b%e5%8c%96%e4%b8%ba0%e8%87%aa%e5%a2%9e%e9%95%bf&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const a = iota // a=0
const (
  b = iota          //b=0
  c                      //c=1
)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æšä¸¾ç±»å‹å®šä¹‰&#34;&gt;æšä¸¾ç±»å‹å®šä¹‰ &lt;a href=&#34;#%e6%9e%9a%e4%b8%be%e7%b1%bb%e5%9e%8b%e5%ae%9a%e4%b9%89&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Weekday int
const (
    Sunday Weekday = iota
    Monday
    Tuesday
    Wednesday
    Thursday
    Friday
    Saturday
)

//å¯ä»¥ç±»ä¼¼è°ƒç”¨æšä¸¾ç±»ä¸€æ ·è°ƒç”¨
println(Weekday(Saturday))   


func (d Weekday) String() string {
    return [...]string{&amp;#34;Sunday&amp;#34;, &amp;#34;Monday&amp;#34;, &amp;#34;Tuesday&amp;#34;, &amp;#34;Wednesday&amp;#34;}[d]
}


var d Weekday = Monday
fmt.Print(d)
switch d {
case Sunday:
    fmt.Println(&amp;#34; goes up.&amp;#34;)
case Monday:
    fmt.Println(&amp;#34; goes down.&amp;#34;)
default:
    fmt.Println(&amp;#34; stays put.&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å¯è·³è¿‡çš„å€¼&#34;&gt;å¯è·³è¿‡çš„å€¼ &lt;a href=&#34;#%e5%8f%af%e8%b7%b3%e8%bf%87%e7%9a%84%e5%80%bc&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type AudioOutput int
const (
    OutMute AudioOutput = iota // 0
    OutMono                       // 1
    OutStereo                     // 2
    _
    _
    OutSurround                // 5
)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ä½æ©ç è¡¨è¾¾å¼&#34;&gt;ä½æ©ç è¡¨è¾¾å¼ &lt;a href=&#34;#%e4%bd%8d%e6%8e%a9%e7%a0%81%e8%a1%a8%e8%be%be%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;iota å¯ä»¥åšæ›´å¤šäº‹æƒ…ï¼Œè€Œä¸ä»…ä»…æ˜¯ incrementã€‚æ›´ç²¾ç¡®åœ°è¯´ï¼Œiota æ€»æ˜¯ç”¨äº incrementï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨äºè¡¨è¾¾å¼ï¼Œåœ¨å¸¸é‡ä¸­çš„å­˜å‚¨ç»“æœå€¼ã€‚&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const (
    IgEggs Allergen = 1 &amp;lt;&amp;lt; iota // 1 &amp;lt;&amp;lt; 0 which is 00000001
    IgChocolate                             // 1 &amp;lt;&amp;lt; 1 which is 00000010
    IgNuts                                       // 1 &amp;lt;&amp;lt; 2 which is 00000100
    IgStrawberries                        // 1 &amp;lt;&amp;lt; 3 which is 00001000
    IgShellfish                                // 1 &amp;lt;&amp;lt; 4 which is 00010000
)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å®šä¹‰bitå•ä½&#34;&gt;å®šä¹‰bitå•ä½ &lt;a href=&#34;#%e5%ae%9a%e4%b9%89bit%e5%8d%95%e4%bd%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type ByteSize float64
const (
    _           = iota                   // ignore first value by assigning to blank identifier
    KB ByteSize = 1 &amp;lt;&amp;lt; (10 * iota)       // 1 &amp;lt;&amp;lt; (10*1)
    MB                                   // 1 &amp;lt;&amp;lt; (10*2)
    GB                                   // 1 &amp;lt;&amp;lt; (10*3)
    TB                                   // 1 &amp;lt;&amp;lt; (10*4)
    PB                                   // 1 &amp;lt;&amp;lt; (10*5)
    EB                                   // 1 &amp;lt;&amp;lt; (10*6)
    ZB                                   // 1 &amp;lt;&amp;lt; (10*7)
    YB                                   // 1 &amp;lt;&amp;lt; (10*8)
)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å®šä¹‰åœ¨ä¸€è¡Œçš„æƒ…å†µiota-åœ¨ä¸‹ä¸€è¡Œå¢é•¿è€Œä¸æ˜¯ç«‹å³å–å¾—å®ƒçš„å¼•ç”¨&#34;&gt;å®šä¹‰åœ¨ä¸€è¡Œçš„æƒ…å†µ(iota åœ¨ä¸‹ä¸€è¡Œå¢é•¿ï¼Œè€Œä¸æ˜¯ç«‹å³å–å¾—å®ƒçš„å¼•ç”¨) &lt;a href=&#34;#%e5%ae%9a%e4%b9%89%e5%9c%a8%e4%b8%80%e8%a1%8c%e7%9a%84%e6%83%85%e5%86%b5iota-%e5%9c%a8%e4%b8%8b%e4%b8%80%e8%a1%8c%e5%a2%9e%e9%95%bf%e8%80%8c%e4%b8%8d%e6%98%af%e7%ab%8b%e5%8d%b3%e5%8f%96%e5%be%97%e5%ae%83%e7%9a%84%e5%bc%95%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;æ³¨æ„ä»–ä»¬æ˜¯é€—å·åˆ†éš”å¸¸é‡ï¼Œå¹¶ä¸æ˜¯æ¢è¡Œ&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœºæ™¯ä¸€&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const (
    Apple, Banana = iota , iota 
    Cherimoya, Durian
    Elderberry, Fig
)
// Apple: 0, Banana: 0,
// Cherimoya: 1, Durian: 1, 
// Elderberry: 2, Fig: 2
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åœºæ™¯äºŒ,æ¯ä¸€æ¢è¡Œéƒ½æŒ‰ç…§å‰ä¸€è¡Œçš„è¡¨è¾¾å¼è¿›è¡Œå¢åŠ &lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const (
    Apple, Banana = iota+1 , iota+1 
    Cherimoya, Durian
    Elderberry, Fig
)
// Apple: 1, Banana: 1,
// Cherimoya: 2, Durian: 2, 
// Elderberry: 3, Fig: 3
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ä¸­é—´æ’é˜Ÿ&#34;&gt;ä¸­é—´æ’é˜Ÿ &lt;a href=&#34;#%e4%b8%ad%e9%97%b4%e6%8f%92%e9%98%9f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const (
    i = iota
    j = 3.14
    k = iota
    l
)
é‚£ä¹ˆæ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯ i=0,j=3.14,k=2,l=3
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>GoåŸºç¡€-ä¿¡é“</title>
      <link>https://abnerxc.github.io/go/base5.channel/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/base5.channel/</guid>
      <description>&lt;p&gt;ä¿¡é“æ˜¯åç¨‹ä¹‹é—´é€šä¿¡çš„ç®¡é“ï¼Œä»ä¸€ç«¯å‘é€æ•°æ®ï¼Œå¦ä¸€ç«¯æ¥æ”¶æ•°æ®ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¿¡é“å£°æ˜&#34;&gt;ä¿¡é“å£°æ˜ &lt;a href=&#34;#%e4%bf%a1%e9%81%93%e5%a3%b0%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;var c chan int&lt;/code&gt;,å£°æ˜äº† nil ä¿¡é“ã€‚nil ä¿¡é“æ²¡ä»€ä¹ˆä½œç”¨ï¼Œæ—¢ä¸èƒ½å‘é€æ•°æ®ä¹Ÿä¸èƒ½æ¥å—æ•°æ®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;c:=make(chan int)&lt;/code&gt;,ä½¿ç”¨ make å‡½æ•°åˆ›å»ºäº†å¯ç”¨çš„ä¿¡é“ cã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;è¯»å†™æ•°æ®&#34;&gt;è¯»å†™æ•°æ® &lt;a href=&#34;#%e8%af%bb%e5%86%99%e6%95%b0%e6%8d%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;c := make(chan int)
// å†™æ•°æ®
c &amp;lt;- data   

// è¯»æ•°æ®
variable &amp;lt;- c  // æ–¹å¼ä¸€
&amp;lt;- c              // æ–¹å¼äºŒ
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;è§£å†³ç”Ÿäº§ç¯å¢ƒä½¿ç”¨timesleep&#34;&gt;è§£å†³ç”Ÿäº§ç¯å¢ƒä½¿ç”¨timeSleep &lt;a href=&#34;#%e8%a7%a3%e5%86%b3%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e4%bd%bf%e7%94%a8timesleep&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func printHello(c chan bool) {
    fmt.Println(&amp;#34;hello world goroutine&amp;#34;)
    &amp;lt;- c    // è¯»å–ä¿¡é“çš„æ•°æ®
}
 
func main() {
    c := make(chan bool)
    go printHello(c)
    c &amp;lt;- true    // main åç¨‹é˜»å¡
    fmt.Println(&amp;#34;main goroutine&amp;#34;)
}
//output
hello world goroutine
main goroutine
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;æ­»é”åªè¯»ä¸å†™æˆ–è€…åªè¯»ä¸å†™&#34;&gt;æ­»é”ï¼ˆåªè¯»ä¸å†™æˆ–è€…åªè¯»ä¸å†™ï¼‰ &lt;a href=&#34;#%e6%ad%bb%e9%94%81%e5%8f%aa%e8%af%bb%e4%b8%8d%e5%86%99%e6%88%96%e8%80%85%e5%8f%aa%e8%af%bb%e4%b8%8d%e5%86%99&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
    c := make(chan bool)
    c &amp;lt;- true    // åªå†™ä¸è¯»
    fmt.Println(&amp;#34;main goroutine&amp;#34;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;å…³é—­ä¿¡é“ä¸-for-loop&#34;&gt;å…³é—­ä¿¡é“ä¸ for loop &lt;a href=&#34;#%e5%85%b3%e9%97%ad%e4%bf%a1%e9%81%93%e4%b8%8e-for-loop&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func printNums(ch chan int) {
    for i := 0; i &amp;lt; 10; i++ {
        ch &amp;lt;- i
    }
    close(ch)
}

func main() {
    ch := make(chan int)
    go printNums(ch)
    for {
        v, ok := &amp;lt;-ch
        if ok == false {     // é€šè¿‡ ok åˆ¤æ–­ä¿¡é“æ˜¯å¦å…³é—­
            fmt.Println(v, ok)
            break
        }
        fmt.Println(v, ok)
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;ç¼“å†²ä¿¡é“å’Œæ™®é€šä¿¡é“&#34;&gt;ç¼“å†²ä¿¡é“å’Œæ™®é€šä¿¡é“ &lt;a href=&#34;#%e7%bc%93%e5%86%b2%e4%bf%a1%e9%81%93%e5%92%8c%e6%99%ae%e9%80%9a%e4%bf%a1%e9%81%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;æ™®é€šä¿¡é“æ˜¯&lt;code&gt;æ— ç¼“å†²çš„ï¼Œè¯»å†™ä¿¡é“ä¼šç«‹é©¬é˜»å¡å½“å‰åç¨‹&lt;/code&gt;ã€‚å¯¹äºç¼“å†²ä¿¡é“ï¼Œå†™ä¸ä¼šé˜»å¡å½“å‰ä¿¡é“ç›´åˆ°ä¿¡é“æ»¡äº†ï¼ŒåŒç†ï¼Œè¯»æ“ä½œä¹Ÿä¸ä¼šé˜»å¡å½“å‰ä¿¡é“é™¤éä¿¡é“æ²¡æ•°æ®&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“ &lt;a href=&#34;#%e6%80%bb%e7%bb%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;{% post_link Go/channelæ€»ç»“ [channelæ€»ç»“]%}&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GoåŸºç¡€-åˆ‡ç‰‡</title>
      <link>https://abnerxc.github.io/go/base3.%E5%88%87%E7%89%87/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/base3.%E5%88%87%E7%89%87/</guid>
      <description>&lt;h1 id=&#34;å†…éƒ¨å®ç°&#34;&gt;å†…éƒ¨å®ç° &lt;a href=&#34;#%e5%86%85%e9%83%a8%e5%ae%9e%e7%8e%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åˆ‡ç‰‡æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œå®ƒçš„åº•å±‚æ˜¯æ•°ç»„ï¼Œå®ƒè‡ªå·±æœ¬èº«éå¸¸å°ï¼Œå¯ä»¥ç†è§£ä¸ºå¯¹åº•å±‚æ•°ç»„çš„æŠ½è±¡
åˆ‡ç‰‡å¯¹è±¡éå¸¸å°ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯åªæœ‰3ä¸ªå­—æ®µçš„æ•°æ®ç»“æ„ï¼šä¸€ä¸ªæ˜¯æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆï¼Œä¸€ä¸ªæ˜¯åˆ‡ç‰‡çš„é•¿åº¦ï¼Œä¸€ä¸ªæ˜¯åˆ‡ç‰‡çš„å®¹é‡&lt;/p&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;å£°æ˜å’Œåˆå§‹åŒ–&#34;&gt;å£°æ˜å’Œåˆå§‹åŒ– &lt;a href=&#34;#%e5%a3%b0%e6%98%8e%e5%92%8c%e5%88%9d%e5%a7%8b%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice:=make([]int,5)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨å†…ç½®çš„makeå‡½æ•°æ—¶ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šåˆ‡ç‰‡çš„é•¿åº¦ï¼Œä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ—¶5ï¼Œè¿™æ—¶å€™åˆ‡ç‰‡çš„å®¹é‡ä¹Ÿæ˜¯5ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬æŒ‡å®šåˆ‡ç‰‡çš„å®¹é‡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice:=make([]int,5,10)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åˆ›å»ºçš„åˆ‡ç‰‡é•¿åº¦æ˜¯5ï¼Œå®¹é‡æ˜¯10,éœ€è¦æ³¨æ„çš„è¿™ä¸ªå®¹é‡10å…¶å®å¯¹åº”çš„æ˜¯åˆ‡ç‰‡åº•å±‚æ•°ç»„çš„ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºåˆ‡ç‰‡çš„åº•å±‚æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥åˆ›å»ºåˆ‡ç‰‡æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šå­—é¢å€¼çš„è¯ï¼Œé»˜è®¤å€¼å°±æ˜¯æ•°ç»„çš„å…ƒç´ çš„é›¶å€¼ã€‚è¿™é‡Œæˆ‘ä»¬æ‰€ä»¥æŒ‡å®šäº†å®¹é‡æ˜¯10ï¼Œä½†æ˜¯æˆ‘ä»¬åªèƒ½è®¿é—®5ä¸ªå…ƒç´ ï¼Œå› ä¸ºåˆ‡ç‰‡çš„é•¿åº¦æ˜¯5ï¼Œå‰©ä¸‹çš„5ä¸ªå…ƒç´ ï¼Œéœ€è¦åˆ‡ç‰‡æ‰©å……åæ‰å¯ä»¥è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å®¹é‡å¿…é¡»&amp;gt;=é•¿åº¦ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½åˆ›å»ºé•¿åº¦å¤§äºå®¹é‡çš„åˆ‡ç‰‡çš„ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice:=[]int{1,2,3,4,5}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸åˆ›å»ºæ•°ç»„éå¸¸åƒï¼Œåªä¸è¿‡ä¸ç”¨æŒ‡å®š&lt;code&gt;[]&lt;/code&gt;ä¸­çš„å€¼ï¼Œè¿™æ—¶å€™åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡æ˜¯ç›¸ç­‰çš„ï¼Œå¹¶ä¸”ä¼šæ ¹æ®æˆ‘ä»¬æŒ‡å®šçš„å­—é¢é‡æ¨å¯¼å‡ºæ¥&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice:=[]int{4:1}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ˜¯æŒ‡å®šäº†ç¬¬5ä¸ªå…ƒç´ ä¸º1ï¼Œå…¶ä»–å…ƒç´ éƒ½æ˜¯é»˜è®¤å€¼0ã€‚è¿™æ—¶å€™åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¹Ÿæ˜¯ä¸€æ ·çš„&lt;/p&gt;
&lt;h1 id=&#34;æ•°ç»„å’Œåˆ‡ç‰‡çš„å¾®å°å·®åˆ«&#34;&gt;æ•°ç»„å’Œåˆ‡ç‰‡çš„å¾®å°å·®åˆ« &lt;a href=&#34;#%e6%95%b0%e7%bb%84%e5%92%8c%e5%88%87%e7%89%87%e7%9a%84%e5%be%ae%e5%b0%8f%e5%b7%ae%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//æ•°ç»„
var arr [5]int
//åˆ‡ç‰‡
var slice []int


//æ•°ç»„
array:=[5]int{4:1}
//åˆ‡ç‰‡
slice:=[]int{4:1}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;nilåˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡&#34;&gt;nilåˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡ &lt;a href=&#34;#nil%e5%88%87%e7%89%87%e5%92%8c%e7%a9%ba%e5%88%87%e7%89%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//nilåˆ‡ç‰‡
var nilSlice []int
//ç©ºåˆ‡ç‰‡
slice:=[]int{}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;åŸºäºç°æœ‰åˆ‡ç‰‡æˆ–è€…æ•°ç»„åˆ›å»º&#34;&gt;åŸºäºç°æœ‰åˆ‡ç‰‡æˆ–è€…æ•°ç»„åˆ›å»º &lt;a href=&#34;#%e5%9f%ba%e4%ba%8e%e7%8e%b0%e6%9c%89%e5%88%87%e7%89%87%e6%88%96%e8%80%85%e6%95%b0%e7%bb%84%e5%88%9b%e5%bb%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice := []int{1, 2, 3, 4, 5}
slice1 := slice[:]
slice2 := slice[0:]
slice3 := slice[:5]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨[i:j]è¿™æ ·çš„æ“ä½œç¬¦å³å¯ï¼Œå¥¹è¡¨ç¤ºä»¥iç´¢å¼•å¼€å§‹ï¼Œåˆ°jç´¢å¼•ç»“æŸ,æˆªå–åŸæ•°ç»„æˆ–è€…åˆ‡ç‰‡ï¼Œåˆ›å»ºè€Œæˆçš„æ–°åˆ‡ç‰‡ï¼Œæ–°åˆ‡ç‰‡çš„å€¼åŒ…å«åŸåˆ‡ç‰‡çš„iç´¢å¼•ï¼Œä½†æ˜¯ä¸åŒ…å«jç´¢å¼•ã€‚&lt;code&gt;slice[i:j)&lt;/code&gt;åŒ…å«i,ä¸åŒ…å«j
ç¬¬3ä¸ªç”¨æ¥é™å®šæ–°åˆ‡ç‰‡çš„å®¹é‡ï¼Œå…¶ç”¨æ³•ä¸º&lt;code&gt;slice[i:j:k]&lt;/code&gt;,kç”¨æ¥é™å®šåˆ‡ç‰‡çš„å®¹é‡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;slice := []int{1, 2, 3, 4, 5}
newSlice := slice[1:2:3]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸€ä¸ªé•¿åº¦ä¸º2-1=1ï¼Œå®¹é‡ä¸º3-1=2çš„æ–°åˆ‡ç‰‡,ä¸è¿‡ç¬¬ä¸‰ä¸ªç´¢å¼•ï¼Œä¸èƒ½è¶…è¿‡åŸåˆ‡ç‰‡çš„æœ€å¤§ç´¢å¼•å€¼5&lt;/p&gt;
&lt;h1 id=&#34;åœ¨å‡½æ•°é—´ä¼ é€’åˆ‡ç‰‡&#34;&gt;åœ¨å‡½æ•°é—´ä¼ é€’åˆ‡ç‰‡ &lt;a href=&#34;#%e5%9c%a8%e5%87%bd%e6%95%b0%e9%97%b4%e4%bc%a0%e9%80%92%e5%88%87%e7%89%87&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
	slice := []int{1, 2, 3, 4, 5}
	fmt.Printf(&amp;#34;%p\n&amp;#34;, &amp;amp;slice)
	modify(slice)
	fmt.Println(slice)
}

func modify(slice []int) {
	fmt.Printf(&amp;#34;%p\n&amp;#34;, &amp;amp;slice)
	slice[1] = 10
}

0xc420082060
0xc420082080
[1 10 3 4 5]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è§‚å¯Ÿå‘ç°ï¼Œè¿™ä¸¤ä¸ªåˆ‡ç‰‡çš„åœ°å€ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥ç¡®è®¤åˆ‡ç‰‡åœ¨å‡½æ•°é—´ä¼ é€’æ˜¯å¤åˆ¶çš„ã€‚è€Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªç´¢å¼•çš„å€¼åï¼Œå‘ç°åŸåˆ‡ç‰‡çš„å€¼ä¹Ÿè¢«ä¿®æ”¹äº†ï¼Œè¯´æ˜å®ƒä»¬å…±ç”¨ä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GoåŸºç¡€-åŸºæœ¬ç±»å‹</title>
      <link>https://abnerxc.github.io/go/base0.%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/base0.%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</guid>
      <description>&lt;h1 id=&#34;å†…å»ºç±»å‹ç§ç±»&#34;&gt;å†…å»ºç±»å‹ç§ç±» &lt;a href=&#34;#%e5%86%85%e5%bb%ba%e7%b1%bb%e5%9e%8b%e7%a7%8d%e7%b1%bb&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;boolï¼šå¸ƒå°”ç±»å‹,å¯é€‰ true|false,é»˜è®¤åˆå§‹åŒ–é›¶å€¼ false&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•´å‹
8bit=1å­—èŠ‚ï¼Œint(8)è¡¨ç¤º8ä¸ªbitä½&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;ç±»å‹&lt;/th&gt;
          &lt;th&gt;å­—èŠ‚&lt;/th&gt;
          &lt;th&gt;å–å€¼&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;(u)int(8)&lt;/td&gt;
          &lt;td&gt;2^0=1&lt;/td&gt;
          &lt;td&gt;2^8=-127~128&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;(u)int(16)&lt;/td&gt;
          &lt;td&gt;2^1=2&lt;/td&gt;
          &lt;td&gt;2^16&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;(u)int(32)&lt;/td&gt;
          &lt;td&gt;2^2=4&lt;/td&gt;
          &lt;td&gt;2^32&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;(u)int(64)&lt;/td&gt;
          &lt;td&gt;2^3=8&lt;/td&gt;
          &lt;td&gt;2^64&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;(u)int&lt;/td&gt;
          &lt;td&gt;è·Ÿéšæ“ä½œç³»ç»Ÿä½æ•°(32or64ä½)&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;uintptr:ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ— ç¬¦å·æ•´å‹ï¼Œ ç”¨æ¥è¡¨ç¤ºä»»æ„åœ°å€;ä¸€ä¸ªuintptræ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä¸æ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚æŠŠä¸€ä¸ªPointerè½¬æ¢ä¸ºuintptråï¼Œå®é™…æ˜¯å‰¥ç¦»äº†åŸæœ‰çš„æŒ‡é’ˆçš„è¯­ä¹‰ï¼Œåªå–äº†åœ°å€çš„æ•´æ•°å€¼ã€‚&lt;code&gt;p = unsafe.Pointer( uintptr ( p ) + offset )&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;byte(uint8) , rune(int32)ï¼Œstring&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;byte :æœ€åŸºç¡€å­—èŠ‚ç±»å‹,æ˜¯ uint8 ç±»å‹çš„åˆ«å&lt;/li&gt;
&lt;li&gt;rune : Go ä¸­çš„å­—ç¬¦ç±»å‹,æ˜¯ int32 çš„åˆ«å&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;string
å€¼ç”¨ &amp;quot;&amp;quot; æˆ–è€… `` åŒ…æ‹¬, `` å¯åŒ…å«å¤šè¡Œå­—ç¬¦ä¸²,å­—ç¬¦ä¸²çš„å†…å®¹åœ¨åˆå§‹åŒ–åï¼Œä¸èƒ½è¢«ä¿®æ”¹ï¼Œä½†å¯é‡æ–°å®Œå…¨èµ‹å€¼ï¼Œå­—ç¬¦ä¸²çš„æ“ä½œä¸æ•°ç»„ç›¸åŒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;float32 , float64 , complex64 , complex128
8bit=1å­—èŠ‚ï¼Œfloat32è¡¨ç¤º32ä¸ªbitä½ï¼Œåˆšå¥½4ä¸ªå­—èŠ‚&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;ç±»å‹&lt;/th&gt;
          &lt;th&gt;å­—èŠ‚&lt;/th&gt;
          &lt;th&gt;å–å€¼&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;float32&lt;/td&gt;
          &lt;td&gt;4&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;float64&lt;/td&gt;
          &lt;td&gt;8&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;complex64&lt;/td&gt;
          &lt;td&gt;8&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;complex128&lt;/td&gt;
          &lt;td&gt;16&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;+++&lt;/p&gt;
&lt;h1 id=&#34;å†…å»ºç±»å‹ç‰¹ç‚¹&#34;&gt;å†…å»ºç±»å‹ç‰¹ç‚¹ &lt;a href=&#34;#%e5%86%85%e5%bb%ba%e7%b1%bb%e5%9e%8b%e7%89%b9%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;ç±»å‹è½¬æ¢åªæœ‰æ˜¾ç¤ºè½¬æ¢,ä¸å­˜åœ¨ä»»ä½•å½¢å¼çš„éšå¼ç±»å‹è½¬æ¢&lt;/li&gt;
&lt;li&gt;è™½ç„¶æä¾›æŒ‡é’ˆç±»å‹,ä½†æŒ‡é’ˆæœ¬èº«ä¸èƒ½è¿›è¡Œä»»ä½•å½¢å¼çš„è®¡ç®—&lt;/li&gt;
&lt;li&gt;å˜é‡å£°æ˜åæœ‰é»˜è®¤åˆå§‹åŒ–é›¶å€¼,å˜é‡é›¶å€¼è§†å…·ä½“ç±»å‹è€Œå®š&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;initå‡½æ•°ç‰¹ç‚¹&#34;&gt;initå‡½æ•°ç‰¹ç‚¹ &lt;a href=&#34;#init%e5%87%bd%e6%95%b0%e7%89%b9%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;ä¸»è¦ä½œç”¨
&lt;ul&gt;
&lt;li&gt;åˆå§‹åŒ–ä¸èƒ½é‡‡ç”¨åˆå§‹åŒ–è¡¨è¾¾å¼åˆå§‹åŒ–çš„å˜é‡ã€‚&lt;/li&gt;
&lt;li&gt;ç¨‹åºè¿è¡Œå‰çš„æ³¨å†Œã€‚&lt;/li&gt;
&lt;li&gt;å®ç°sync.OnceåŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å…¶ä»–&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç‰¹ç‚¹&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;init() å‡½æ•°æ˜¯ç”¨äºç¨‹åºæ‰§è¡Œå‰åšåŒ…çš„åˆå§‹åŒ–çš„å‡½æ•°ï¼Œæ¯”å¦‚åˆå§‹åŒ–åŒ…é‡Œçš„å˜é‡ç­‰;&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªåŒ…å¯ä»¥å‡ºçº¿å¤šä¸ª init() å‡½æ•°,ä¸€ä¸ªæºæ–‡ä»¶ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ª init() å‡½æ•°ï¼›&lt;/li&gt;
&lt;li&gt;åŒä¸€ä¸ªåŒ…ä¸­å¤šä¸ª init() å‡½æ•°çš„æ‰§è¡Œé¡ºåºæ²¡æœ‰æ˜ç¡®å®šä¹‰ï¼Œä½†æ˜¯ä¸åŒåŒ…çš„initå‡½æ•°æ˜¯æ ¹æ®åŒ…å¯¼å…¥çš„ä¾èµ–å…³ç³»å†³å®šçš„ï¼ˆçœ‹ä¸‹å›¾ï¼‰;&lt;/li&gt;
&lt;li&gt;init() å‡½æ•°åœ¨ä»£ç ä¸­ä¸èƒ½è¢«æ˜¾ç¤ºè°ƒç”¨ã€ä¸èƒ½è¢«å¼•ç”¨ï¼ˆèµ‹å€¼ç»™å‡½æ•°å˜é‡ï¼‰ï¼Œå¦åˆ™å‡ºç°ç¼–è¯‘é”™è¯¯;&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªåŒ…è¢«å¼•ç”¨å¤šæ¬¡ï¼Œå¦‚ A import B,C import B,A import Cï¼ŒB è¢«å¼•ç”¨å¤šæ¬¡ï¼Œä½† B åŒ…åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼›&lt;/li&gt;
&lt;li&gt;å¼•å…¥åŒ…ï¼Œä¸å¯å‡ºç°æ­»å¾ªåã€‚å³ A import B,B import Aï¼Œè¿™ç§æƒ…å†µç¼–è¯‘å¤±è´¥ï¼›
&lt;img src=&#34;https://abnerxc.github.io/img/go-inipack.jpeg&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;typeçš„ä½¿ç”¨&#34;&gt;.(type)çš„ä½¿ç”¨ &lt;a href=&#34;#type%e7%9a%84%e4%bd%bf%e7%94%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ç±»å‹é€‰æ‹©ï¼Œç±»å‹é€‰æ‹©çš„è¯­æ³•å½¢å¦‚ï¼ši.(type)ï¼Œå…¶ä¸­ i æ˜¯æ¥å£ï¼Œtype æ˜¯å›ºå®šå…³é”®å­—ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;code&gt;åªæœ‰æ¥å£ç±»å‹æ‰å¯ä»¥ä½¿ç”¨ç±»å‹é€‰æ‹©&lt;/code&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>GoåŸºç¡€-å­—ç¬¦ä¸²é«˜æ•ˆæ‹¼</title>
      <link>https://abnerxc.github.io/go/base2.%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%AB%98%E6%95%88%E6%8B%BC%E6%8E%A5/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/base2.%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%AB%98%E6%95%88%E6%8B%BC%E6%8E%A5/</guid>
      <description>&lt;h1 id=&#34;å·æ‹¼æ¥&#34;&gt;+å·æ‹¼æ¥ &lt;a href=&#34;#%e5%8f%b7%e6%8b%bc%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è¿™ç§æ‹¼æ¥æœ€ç®€å•ï¼Œä¹Ÿæœ€å®¹æ˜“è¢«æˆ‘ä»¬ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯ä¸é™ç¼–ç¨‹è¯­è¨€çš„ï¼Œæ¯”å¦‚Goè¯­è¨€æœ‰ï¼ŒJavaä¹Ÿæœ‰ï¼Œå®ƒä»¬æ˜¯+å·è¿ç®—ç¬¦ï¼Œåœ¨è¿è¡Œæ—¶è®¡ç®—çš„ã€‚ç°åœ¨æ¼”ç¤ºä¸‹è¿™ç§æ‹¼æ¥çš„ä»£ç ï¼Œè™½ç„¶æ¯”è¾ƒç®€å•ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringPlus() string{
	var s string
	s+=&amp;#34;æ˜µç§°&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;é£é›ªæ— æƒ…&amp;#34;+&amp;#34;\n&amp;#34;
	s+=&amp;#34;åšå®¢&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;http://www.flysnow.org/&amp;#34;+&amp;#34;\n&amp;#34;
	s+=&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;flysnow_org&amp;#34;
	return s
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥è‡ªå·±å†™ä¸ªç”¨ä¾‹æµ‹è¯•ä¸‹ï¼Œå¯ä»¥æ‰“å°å‡ºå’Œæˆ‘ä»¬ä¾‹å­ä¸­ä¸€æ ·çš„å†…å®¹ã€‚é‚£ä¹ˆè¿™ç§æœ€å¸¸è§çš„å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼æ€§èƒ½æ€ä¹ˆæ ·çš„å‘¢ï¼Œæˆ‘ä»¬æµ‹è¯•ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func BenchmarkStringPlus(b *testing.B) {
	for i:=0;i&amp;lt;b.N;i++{
		StringPlus()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿è¡Œ&lt;code&gt;go test -bench=. -benchmem&lt;/code&gt; æŸ¥çœ‹æ€§èƒ½è¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringPlus-8   20000000    108 ns/op   144 B/op    2 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ¯æ¬¡æ“ä½œéœ€è¦108ns,è¿›è¡Œ2æ¬¡å†…å­˜åˆ†é…ï¼Œåˆ†é…114å­—èŠ‚çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;fmt-æ‹¼æ¥&#34;&gt;fmt æ‹¼æ¥ &lt;a href=&#34;#fmt-%e6%8b%bc%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è¿™ç§æ‹¼æ¥ï¼Œå€ŸåŠ©äº&lt;code&gt;fmt.Sprint&lt;/code&gt;ç³»åˆ—å‡½æ•°è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åè¿”å›æ‹¼æ¥çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringFmt() string{
	return fmt.Sprint(&amp;#34;æ˜µç§°&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;é£é›ªæ— æƒ…&amp;#34;,&amp;#34;\n&amp;#34;,&amp;#34;åšå®¢&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;http://www.flysnow.org/&amp;#34;,&amp;#34;\n&amp;#34;,&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;flysnow_org&amp;#34;)
}

func BenchmarkStringFmt(b *testing.B) {
	for i:=0;i&amp;lt;b.N;i++{
		StringFmt()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿è¡ŒæŸ¥çœ‹æµ‹è¯•ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringFmt-8    5000000     385 ns/op   80 B/op     1 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;font color=red&gt;è™½ç„¶æ¯æ¬¡æ“ä½œå†…å­˜åˆ†é…åªæœ‰1æ¬¡ï¼Œåˆ†é…80å­—èŠ‚ä¹Ÿä¸å¤šï¼Œä½†æ˜¯æ¯æ¬¡æ“ä½œè€—æ—¶å¤ªé•¿ï¼Œæ€§èƒ½è¿œæ²¡æœ‰&lt;code&gt;+&lt;/code&gt;å·æ“ä½œå¿«ã€‚&lt;/font&gt;&lt;/p&gt;
&lt;h1 id=&#34;join-æ‹¼æ¥&#34;&gt;Join æ‹¼æ¥ &lt;a href=&#34;#join-%e6%8b%bc%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è¿™ä¸ªæ˜¯åˆ©ç”¨&lt;code&gt;strings.Join&lt;/code&gt;å‡½æ•°è¿›è¡Œæ‹¼æ¥ï¼Œæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè½¬æ¢ä¸ºä¸€ä¸ªæ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringJoin() string{
	s:=[]string{&amp;#34;æ˜µç§°&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;é£é›ªæ— æƒ…&amp;#34;,&amp;#34;\n&amp;#34;,&amp;#34;åšå®¢&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;http://www.flysnow.org/&amp;#34;,&amp;#34;\n&amp;#34;,&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;,&amp;#34;:&amp;#34;,&amp;#34;flysnow_org&amp;#34;}
	return strings.Join(s,&amp;#34;&amp;#34;)
}

func BenchmarkStringJoin(b *testing.B) {
	for i:=0;i&amp;lt;b.N;i++{
		StringJoin()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠæ€§èƒ½æµ‹è¯•çš„ä»£ç æ”¾ä¸€èµ·äº†ï¼Œç°åœ¨çœ‹çœ‹æ€§èƒ½æµ‹è¯•çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringJoin-8   10000000    177 ns/op   160 B/op    2 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;font color=red&gt;æ•´ä½“å’Œ&lt;code&gt;+&lt;/code&gt;æ“ä½œç›¸å·®ä¸äº†å¤ªå¤šï¼Œå¤§æ¦‚ä½0.5å€çš„æ ·å­ã€‚&lt;/font&gt;&lt;/p&gt;
&lt;h1 id=&#34;buffer-æ‹¼æ¥&#34;&gt;buffer æ‹¼æ¥ &lt;a href=&#34;#buffer-%e6%8b%bc%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è¿™ç§è¢«ç”¨çš„ä¹Ÿå¾ˆå¤šï¼Œä½¿ç”¨çš„æ˜¯&lt;code&gt;bytes.Buffer&lt;/code&gt;è¿›è¡Œçš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå®ƒæ˜¯éå¸¸çµæ´»çš„ä¸€ä¸ªç»“æ„ä½“ï¼Œä¸æ­¢å¯ä»¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œè¿˜æ˜¯å¯ä»¥&lt;code&gt;byte,rune&lt;/code&gt;ç­‰ï¼Œå¹¶ä¸”å®ç°äº†&lt;code&gt;io.Writer&lt;/code&gt;æ¥å£ï¼Œå†™å…¥ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringBuffer() string {
	var b bytes.Buffer
	b.WriteString(&amp;#34;æ˜µç§°&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;é£é›ªæ— æƒ…&amp;#34;)
	b.WriteString(&amp;#34;\n&amp;#34;)
	b.WriteString(&amp;#34;åšå®¢&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;http://www.flysnow.org/&amp;#34;)
	b.WriteString(&amp;#34;\n&amp;#34;)
	b.WriteString(&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;flysnow_org&amp;#34;)
	return b.String()
}

func BenchmarkStringBuffer(b *testing.B) {
	for i:=0;i&amp;lt;b.N;i++{
		StringBuffer()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çœ‹çœ‹ä»–çš„æ€§èƒ½ï¼Œè¿è¡Œè¾“å‡ºå³å¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringBuffer-8     5000000     291 ns/op   336 B/op    3 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¥½åƒå¹¶ä¸æ˜¯å¤ªå¥½,å’Œæœ€å·®çš„fmtæ‹¼æ¥å·®ä¸å¤šï¼Œå’Œ&lt;code&gt;+&lt;/code&gt;å·ï¼ŒJoinæ‹¼æ¥å·®å¥½è¿œï¼Œå†…å­˜åˆ†é…ä¹Ÿæ¯”è¾ƒå¤šã€‚æ¯æ¬¡æ“ä½œè€—æ—¶ä¹Ÿå¾ˆé•¿ã€‚&lt;/p&gt;
&lt;h1 id=&#34;builder-æ‹¼æ¥&#34;&gt;builder æ‹¼æ¥ &lt;a href=&#34;#builder-%e6%8b%bc%e6%8e%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä¸ºäº†æ”¹è¿›bufferæ‹¼æ¥çš„æ€§èƒ½ï¼Œä»go 1.10 ç‰ˆæœ¬å¼€å§‹ï¼Œå¢åŠ äº†ä¸€ä¸ªbuilderç±»å‹ï¼Œç”¨äºæå‡å­—ç¬¦ä¸²æ‹¼æ¥çš„æ€§èƒ½ã€‚å®ƒçš„ä½¿ç”¨å’Œbufferå‡ ä¹ä¸€æ ·ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringBuilder() string {
	var b strings.Builder
	b.WriteString(&amp;#34;æ˜µç§°&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;é£é›ªæ— æƒ…&amp;#34;)
	b.WriteString(&amp;#34;\n&amp;#34;)
	b.WriteString(&amp;#34;åšå®¢&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;http://www.flysnow.org/&amp;#34;)
	b.WriteString(&amp;#34;\n&amp;#34;)
	b.WriteString(&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;)
	b.WriteString(&amp;#34;:&amp;#34;)
	b.WriteString(&amp;#34;flysnow_org&amp;#34;)
	return b.String()
}

func BenchmarkStringBuilder(b *testing.B) {
	for i:=0;i&amp;lt;b.N;i++{
		StringBuilder()
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å®˜æ–¹éƒ½è¯´æ¯”bufferæ€§èƒ½å¥½äº†ï¼Œæˆ‘ä»¬çœ‹çœ‹æ€§èƒ½æµ‹è¯•çš„ç»“æœã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringBuilder-8    10000000    170 ns/op   232 B/op    4 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çš„ç¡®æå‡äº†ï¼Œæå‡äº†ä¸€å€ï¼Œè™½ç„¶æ¯æ¬¡åˆ†é…çš„å†…å­˜æ¬¡æ•°æœ‰ç‚¹å¤šï¼Œä½†æ˜¯æ¯æ¬¡åˆ†é…çš„å†…å­˜å¤§å°æ¯”bufferè¦å°‘ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€§èƒ½å¯¹æ¯”&#34;&gt;æ€§èƒ½å¯¹æ¯” &lt;a href=&#34;#%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯å¸¸ç”¨çš„å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ï¼Œç°åœ¨æˆ‘ä»¬æŠŠè¿™äº›æµ‹è¯•ç»“æœï¼Œæ±‡æ€»åˆ°ä¸€èµ·ï¼Œå¯¹æ¯”ä¸‹çœ‹çœ‹,å› ä¸ºBenchmarkçš„æµ‹è¯•ï¼Œå¯¹äºæ€§èƒ½åªæ˜¾ç¤ºï¼Œæˆ‘æŠŠæµ‹è¯•çš„æ—¶é—´è®¾ç½®ä¸º3sï¼ˆç§’ï¼‰ï¼ŒæŠŠæ—¶é—´æ‹‰é•¿ä¾¿äºå¯¹æ¯”æµ‹è¯•ï¼ŒåŒæ—¶ç”Ÿæˆäº†cpu profileæ–‡ä»¶ï¼Œç”¨äºæ€§èƒ½åˆ†æã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œ&lt;code&gt;go test xx.go -bench=. -benchmem -benchtime=3s -cpuprofile=profile.out&lt;/code&gt;å¾—åˆ°å¦‚ä¸‹æµ‹è¯•ç»“æœï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;StringPlus-8    50000000    112 ns/op   144 B/op    2 allocs/op
StringFmt-8     20000000    344 ns/op   80 B/op     1 allocs/op
StringJoin-8    30000000    171 ns/op   160 B/op    2 allocs/op
StringBuffer-8  20000000    302 ns/op   336 B/op    3 allocs/op
StringBuilder-8 30000000    171 ns/op   232 B/op    4 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬é€šè¿‡&lt;code&gt;go tool pprof profile.out&lt;/code&gt; çœ‹ä¸‹æˆ‘ä»¬è¾“å‡ºçš„cpu profileä¿¡æ¯ã€‚è¿™é‡Œä¸»è¦ä½¿ç”¨topå‘½ä»¤ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Showing top 15 nodes out of 89
      flat  flat%   sum%        cum   cum%
    11.99s 42.55% 42.55%     11.99s 42.55%  runtime.kevent
     6.30s 22.36% 64.90%      6.30s 22.36%  runtime.pthread_cond_wait
     1.65s  5.86% 70.76%      1.65s  5.86%  runtime.pthread_cond_signal
     1.11s  3.94% 74.70%      1.11s  3.94%  runtime.usleep
     1.10s  3.90% 78.60%      1.10s  3.90%  runtime.pthread_cond_timedwait_relative_np
     0.58s  2.06% 80.66%      0.62s  2.20%  runtime.wbBufFlush1
     0.51s  1.81% 82.47%      0.51s  1.81%  runtime.memmove
     0.44s  1.56% 84.03%      1.81s  6.42%  fmt.(*pp).printArg
     0.39s  1.38% 85.42%      2.36s  8.37%  fmt.(*pp).doPrint
     0.36s  1.28% 86.69%      0.70s  2.48%  fmt.(*buffer).WriteString (inline)
     0.34s  1.21% 87.90%      0.93s  3.30%  runtime.mallocgc
     0.20s  0.71% 88.61%      1.20s  4.26%  fmt.(*fmt).fmtS
     0.18s  0.64% 89.25%      0.18s  0.64%  fmt.(*fmt).truncate
     0.16s  0.57% 89.82%      0.16s  0.57%  runtime.memclrNoHeapPointers
     0.15s  0.53% 90.35%      1.35s  4.79%  fmt.(*pp).fmtString
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å‰15ä¸ªï¼Œå¯ä»¥çœ‹åˆ°fmtæ‹¼æ¥çš„æ–¹å¼æ˜¯æœ€å·®çš„ï¼Œå› ä¸ºfmté‡Œå¾ˆå¤šæ–¹æ³•è€—æ—¶æ’åœ¨äº†æœ€å‰é¢ã€‚bufferçš„WriteStringæ–¹æ³•ä¹Ÿæ¯”è¾ƒè€—æ—¶ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šçš„TOPå¯èƒ½è¿˜ä¸æ˜¯å¤ªç›´è§‚ï¼Œå¦‚æœå¤§å®¶çœ‹ç«ç„°å›¾çš„è¯ï¼Œå°±ä¼šæ›´æ¸…æ™°ã€‚æ€§èƒ½æœ€å¥½çš„æ˜¯&lt;code&gt;+&lt;/code&gt;å·æ‹¼æ¥ã€Joinæ‹¼æ¥ï¼Œæœ€æ…¢çš„æ˜¯fmtæ‹¼æ¥ï¼Œè¿™é‡Œçš„builderå’Œbufferæ‹¼æ¥å·®ä¸å¤šï¼Œå¹¶æ²¡æœ‰å‘æŒ¥å‡ºå…¶èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ç–‘é—®&#34;&gt;ç–‘é—® &lt;a href=&#34;#%e7%96%91%e9%97%ae&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»æ•´ä¸ªæ€§èƒ½çš„æµ‹è¯•å’Œåˆ†ææ¥çœ‹ï¼Œæˆ‘ä»¬æœŸå¾…çš„builderå¹¶æ²¡æœ‰å‘æŒ¥å‡ºæ¥ï¼Œè¿™æ˜¯ä¸æ˜¯æ„å‘³ç€builderä¸å®ç”¨äº†å‘¢ï¼Ÿè¿˜ä¸å¦‚+å·å’ŒJoinæ‹¼æ¥å‘¢ï¼Ÿç»§ç»­æ¥ç€åˆ†æ,çŒœæµ‹å¯èƒ½åŸå› å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‹¼æ¥çš„å­—ç¬¦ä¸²å¤§å°&lt;/li&gt;
&lt;li&gt;æ‹¼æ¥çš„å­—ç¬¦ä¸²æ•°é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ‹¼æ¥å‡½æ•°æ”¹é€ &#34;&gt;æ‹¼æ¥å‡½æ•°æ”¹é€  &lt;a href=&#34;#%e6%8b%bc%e6%8e%a5%e5%87%bd%e6%95%b0%e6%94%b9%e9%80%a0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å‰é¢æåˆ°äº†2ç§å¯èƒ½çš„çŒœæµ‹ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²çš„æ•°é‡å’Œæ‹¼æ¥å­—ç¬¦ä¸²çš„å¤§å°ï¼Œç°åœ¨æˆ‘ä»¬å°±å¼€å§‹è¯æ˜è¿™ä¸¤ç§æƒ…å†µï¼Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠåŸæ¥çš„æ‹¼æ¥å‡½æ•°ä¿®æ”¹ä¸€ä¸‹ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ª[]stringç±»å‹çš„å‚æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹åˆ‡ç‰‡æ•°ç»„è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºæ‰€æœ‰çš„æ‹¼æ¥æ–¹æ³•çš„æ”¹é€ åå®ç°ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringPlus(p []string) string{
	var s string
	l:=len(p)
	for i:=0;i&amp;lt;l;i++{
		s+=p[i]
	}
	return s
}

func StringFmt(p []interface{}) string{
	return fmt.Sprint(p...)
}

func StringJoin(p []string) string{
	return strings.Join(p,&amp;#34;&amp;#34;)
}

func StringBuffer(p []string) string {
	var b bytes.Buffer
	l:=len(p)
	for i:=0;i&amp;lt;l;i++{
		b.WriteString(p[i])
	}
	return b.String()
}

func StringBuilder(p []string) string {
	var b strings.Builder
	l:=len(p)
	for i:=0;i&amp;lt;l;i++{
		b.WriteString(p[i])
	}
	return b.String()
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;æµ‹è¯•ç”¨ä¾‹&#34;&gt;æµ‹è¯•ç”¨ä¾‹ &lt;a href=&#34;#%e6%b5%8b%e8%af%95%e7%94%a8%e4%be%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»¥ä¸Šçš„å­—ç¬¦ä¸²æ‹¼æ¥å‡½æ•°ä¿®æ”¹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ ä¸åŒå¤§å°çš„åˆ‡ç‰‡è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥æµ‹è¯•äº†ã€‚ä¸ºäº†æ¨¡æ‹Ÿä¸Šæ¬¡çš„æ•ˆæœï¼Œæˆ‘ä»¬å…ˆç”¨10ä¸ªåˆ‡ç‰‡å¤§å°çš„å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥æµ‹è¯•ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;const BLOG  = &amp;#34;http://www.flysnow.org/&amp;#34;

func initStrings(N int) []string{
	s:=make([]string,N)
	for i:=0;i&amp;lt;N;i++{
		s[i]=BLOG
	}
	return s;
}

func initStringi(N int) []interface{}{
	s:=make([]interface{},N)
	for i:=0;i&amp;lt;N;i++{
		s[i]=BLOG
	}
	return s;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ˜¯ä¸¤ä¸ªæ„å»ºæµ‹è¯•ç”¨ä¾‹åˆ‡ç‰‡æ•°ç»„çš„å‡½æ•°ï¼Œå¯ä»¥ç”ŸæˆNä¸ªå¤§å°çš„åˆ‡ç‰‡ã€‚ç¬¬äºŒä¸ªinitStringiå‡½æ•°è¿”å›çš„æ˜¯[]interface{}ï¼Œè¿™æ˜¯ä¸“é—¨ä¸ºStringFmt(p []interface{})æ‹¼æ¥å‡½æ•°å‡†å¤‡çš„ï¼Œå‡å°‘ç±»å‹ä¹‹é—´çš„è½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†è¿™ä¸¤ä¸ªç”Ÿæˆæµ‹è¯•ç”¨ä¾‹çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»ºæˆ‘ä»¬çš„Goè¯­è¨€æ€§èƒ½æµ‹è¯•äº†ï¼Œæˆ‘ä»¬å…ˆæµ‹è¯•10ä¸ªå¤§å°çš„åˆ‡ç‰‡ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func BenchmarkStringPlus10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringPlus(p)
	}
}

func BenchmarkStringFmt10(b *testing.B) {
	p:= initStringi(10)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringFmt(p)
	}
}

func BenchmarkStringJoin10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringJoin(p)
	}
}

func BenchmarkStringBuffer10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuffer(p)
	}
}

func BenchmarkStringBuilder10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuilder(p)
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨æ¯ä¸ªæ€§èƒ½æµ‹è¯•å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šè°ƒç”¨b.ResetTimer()ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…æµ‹è¯•ç”¨ä¾‹å‡†å¤‡æ—¶é—´ä¸åŒï¼Œå¸¦æ¥çš„æ€§èƒ½æµ‹è¯•æ•ˆæœåå·®é—®é¢˜
æˆ‘ä»¬è¿è¡Œ&lt;code&gt;go test -bench=. -run=NONE -benchmem&lt;/code&gt; æŸ¥çœ‹ç»“æœã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringPlus10-8     3000000     593 ns/op   1312 B/op   9 allocs/op
BenchmarkStringFmt10-8      5000000     335 ns/op   240 B/op    1 allocs/op
BenchmarkStringJoin10-8     10000000    200 ns/op   480 B/op    2 allocs/op
BenchmarkStringBuffer10-8   3000000     452 ns/op   864 B/op    4 allocs/op
BenchmarkStringBuilder10-8  10000000    231 ns/op   480 B/op    4 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€šè¿‡è¿™æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code&gt;+&lt;/code&gt;å·æ‹¼æ¥ä¸å†å…·æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºstringæ˜¯ä¸å¯å˜çš„ï¼Œæ¯æ¬¡æ‹¼æ¥éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„&lt;code&gt;string&lt;/code&gt;,ä¹Ÿå°±æ˜¯ä¼šè¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œæˆ‘ä»¬ç°åœ¨æ˜¯10ä¸ªå¤§å°çš„åˆ‡ç‰‡ï¼Œæ¯æ¬¡æ“ä½œè¦è¿›è¡Œ9æ¬¡è¿›è¡Œåˆ†é…ï¼Œå ç”¨å†…å­˜ï¼Œæ‰€ä»¥æ¯æ¬¡æ“ä½œæ—¶é—´éƒ½æ¯”è¾ƒé•¿ï¼Œè‡ªç„¶æ€§èƒ½å°±ä½ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ç« ä¸Šé¢å…³äº&lt;code&gt;+&lt;/code&gt;æ‹¼æ¥è¿˜æœ‰å°è±¡ï¼Œ&lt;code&gt;+&lt;/code&gt;åŠ å·æ‹¼æ¥çš„æ€§èƒ½æµ‹è¯•ä¸­æ˜¾ç¤ºçš„åªæœ‰2æ¬¡å†…å­˜åˆ†é…ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨äº†å¥½å¤šä¸ª&lt;code&gt;+&lt;/code&gt;çš„ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringPlus() string{
	var s string
	s+=&amp;#34;æ˜µç§°&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;é£é›ªæ— æƒ…&amp;#34;+&amp;#34;\n&amp;#34;
	s+=&amp;#34;åšå®¢&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;http://www.flysnow.org/&amp;#34;+&amp;#34;\n&amp;#34;
	s+=&amp;#34;å¾®ä¿¡å…¬ä¼—å·&amp;#34;+&amp;#34;:&amp;#34;+&amp;#34;flysnow_org&amp;#34;
	return s
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å†æ¥å›é¡¾ä¸‹è¿™æ®µä»£ç ï¼Œçš„ç¡®æ˜¯æœ‰å¾ˆå¤š+çš„ï¼Œä½†æ˜¯åªæœ‰2æ¬¡å†…å­˜åˆ†é…ï¼Œæˆ‘ä»¬å¯ä»¥å¤§èƒ†çŒœæµ‹,æ˜¯3æ¬¡s+=å¯¼è‡´çš„ï¼Œæ­£å¸¸å’Œæˆ‘ä»¬ä»Šå¤©æµ‹è¯•çš„10ä¸ªé•¿åº¦çš„åˆ‡ç‰‡ï¼Œåªæœ‰9æ¬¡å†…å­˜åˆ†é…ä¸€æ ·ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡è¿è¡Œå¦‚ä¸‹å‘½ä»¤çœ‹ä¸‹Goç¼–è¯‘å™¨å¯¹è¿™æ®µä»£ç çš„ä¼˜åŒ–ï¼š&lt;code&gt;go build -gcflags=&amp;quot;-m -m&amp;quot; main.go&lt;/code&gt;,è¾“å‡ºä¸­æœ‰å¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;can inline StringPlus as: func() string { var s string; s = &amp;lt;N&amp;gt;; s += &amp;#34;æ˜µç§°:é£é›ªæ— æƒ…\n&amp;#34;; s += &amp;#34;åšå®¢:http://www.flysnow.org/\n&amp;#34;; s += &amp;#34;å¾®ä¿¡å…¬ä¼—å·:flysnow_org&amp;#34;; return s }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç°åœ¨ä¸€ç›®äº†ç„¶äº†ï¼Œå…¶å®æ˜¯ç¼–è¯‘å™¨å¸®æˆ‘ä»¬æŠŠå­—ç¬¦ä¸²åšäº†ä¼˜åŒ–ï¼Œåªå‰©ä¸‹3ä¸ª&lt;code&gt;s+=&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡ï¼Œé‡‡ç”¨é•¿åº¦ä¸º10ä¸ªåˆ‡ç‰‡è¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå¾ˆæ˜æ˜¾æµ‹è¯•å‡ºäº†Builderè¦æ¯”Bufferæ€§èƒ½å¥½å¾ˆå¤šï¼Œè¿™ä¸ªé—®é¢˜åŸå› ä¸»è¦è¿˜æ˜¯&lt;code&gt;[]byte&lt;/code&gt;å’Œ&lt;code&gt;string&lt;/code&gt;ä¹‹é—´çš„è½¬æ¢ï¼Œ&lt;code&gt;Builder&lt;/code&gt;æ°æ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (b *Builder) String() string {
	return *(*string)(unsafe.Pointer(&amp;amp;b.buf))
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¾ˆé«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h1 id=&#34;100ä¸ªå­—ç¬¦ä¸²&#34;&gt;100ä¸ªå­—ç¬¦ä¸² &lt;a href=&#34;#100%e4%b8%aa%e5%ad%97%e7%ac%a6%e4%b8%b2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬æµ‹è¯•ä¸‹100ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥çš„æƒ…å†µï¼Œå¯¹äºæˆ‘ä»¬ä¸Šé¢çš„ä»£ç ï¼Œè¦æ”¹é€ éå¸¸å®¹æ˜“ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºæµ‹è¯•ä»£ç ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func BenchmarkStringPlus100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringPlus(p)
	}
}

func BenchmarkStringFmt100(b *testing.B) {
	p:= initStringi(100)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringFmt(p)
	}
}

func BenchmarkStringJoin100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringJoin(p)
	}
}

func BenchmarkStringBuffer100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuffer(p)
	}
}

func BenchmarkStringBuilder100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuilder(p)
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç°åœ¨è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼Œçœ‹çœ‹100ä¸ªå­—ç¬¦ä¸²è¿æ¥çš„æ€§èƒ½æ€ä¹ˆæ ·ï¼Œå“ªä¸ªå‡½æ•°æœ€é«˜æ•ˆã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringPlus100-8    100000  19711 ns/op     123168 B/op     99 allocs/op
BenchmarkStringFmt100-8     500000  2615 ns/op      2304 B/op       1 allocs/op
BenchmarkStringJoin100-8    1000000 1516 ns/op      4608 B/op       2 allocs/op
BenchmarkStringBuffer100-8  500000  2333 ns/op      8112 B/op       7 allocs/op
BenchmarkStringBuilder100-8 1000000 1714 ns/op      6752 B/op       8 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;+&lt;/code&gt;å·å’Œæˆ‘ä»¬ä¸Šé¢åˆ†æå¾—ä¸€æ ·ï¼Œè¿™æ¬¡æ˜¯99æ¬¡å†…å­˜åˆ†é…ï¼Œæ€§èƒ½ä½“éªŒè¶Šæ¥è¶Šå·®ï¼Œåœ¨åé¢çš„æµ‹è¯•ä¸­ï¼Œä¼šæ’é™¤æ‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;fmt&lt;/code&gt;å’Œ&lt;code&gt;bufrer&lt;/code&gt;å·²ç»çš„æ€§èƒ½ä¹Ÿæ²¡æœ‰æå‡ï¼Œç»§ç»­èµ°ä½ã€‚å‰©ä¸‹æ¯”è¾ƒåšæŒºçš„æ˜¯&lt;code&gt;Join&lt;/code&gt;å’Œ&lt;code&gt;Builder&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h1 id=&#34;1000-ä¸ªå­—ç¬¦ä¸²&#34;&gt;1000 ä¸ªå­—ç¬¦ä¸²ã€‚ &lt;a href=&#34;#1000-%e4%b8%aa%e5%ad%97%e7%ac%a6%e4%b8%b2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æµ‹è¯•ç”¨åŠ›å’Œä¸Šé¢ç« èŠ‚çš„å¤§åŒå°å¼‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥çœ‹æµ‹è¯•ç»“æœã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;BenchmarkStringPlus1000-8       1000    1611985 ns/op   12136228 B/op   999 allocs/op
BenchmarkStringFmt1000-8        50000   28510 ns/op     24590 B/op      1 allocs/op
BenchmarkStringJoin1000-8       100000  15050 ns/op     49152 B/op      2 allocs/op
BenchmarkStringBuffer1000-8     100000  23534 ns/op     122544 B/op     11 allocs/op
BenchmarkStringBuilder1000-8    100000  17996 ns/op     96224 B/op      16 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ•´ä½“å’Œ100ä¸ªå­—ç¬¦ä¸²çš„æ—¶å€™å·®ä¸å¤šï¼Œè¡¨ç°å¥½çš„è¿˜æ˜¯&lt;code&gt;Join&lt;/code&gt;å’Œ&lt;code&gt;Builder&lt;/code&gt;ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½¿ç”¨ä¾§é‡ç‚¹æœ‰äº›ä¸ä¸€æ ·ï¼Œ å¦‚æœæœ‰ç°æˆçš„æ•°ç»„ã€åˆ‡ç‰‡é‚£ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨&lt;code&gt;Join&lt;/code&gt;,ä½†æ˜¯å¦‚æœæ²¡æœ‰ï¼Œå¹¶ä¸”è¿½æ±‚çµæ´»æ€§æ‹¼æ¥ï¼Œè¿˜æ˜¯é€‰æ‹©&lt;code&gt;Builder&lt;/code&gt;ã€‚ &lt;code&gt;Join&lt;/code&gt;è¿˜æ˜¯å®šä½äºæœ‰ç°æˆåˆ‡ç‰‡ã€æ•°ç»„çš„ï¼ˆæ¯•ç«Ÿæ‹¼æ¥æˆæ•°ç»„ä¹Ÿè¦æ—¶é—´ï¼‰ï¼Œå¹¶ä¸”ä½¿ç”¨å›ºå®šæ–¹å¼è¿›è¡Œåˆ†è§£çš„ï¼Œæ¯”å¦‚é€—å·ã€ç©ºæ ¼ç­‰ï¼Œå±€é™æ¯”è¾ƒå¤§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å°ç»“&#34;&gt;å°ç»“ &lt;a href=&#34;#%e5%b0%8f%e7%bb%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è‡³äº10000ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥æˆ‘è¿™é‡Œå°±ä¸åšæµ‹è¯•äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¯•è¯•ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å¤§åŒå°å¼‚çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»æœ€è¿‘çš„è¿™ä¸¤ç¯‡æ–‡ç« çš„åˆ†ææ¥çœ‹ï¼Œæˆ‘ä»¬å¤§æ¦‚å¯ä»¥æ€»ç»“å‡ºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;è¿æ¥é€‚ç”¨äºçŸ­å°çš„ã€å¸¸é‡å­—ç¬¦ä¸²ï¼ˆæ˜ç¡®çš„ï¼Œéå˜é‡ï¼‰ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬ä¼˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Joinæ˜¯æ¯”è¾ƒç»Ÿä¸€çš„æ‹¼æ¥ï¼Œä¸å¤ªçµæ´»&lt;/li&gt;
&lt;li&gt;fmtå’ŒbufferåŸºæœ¬ä¸Šä¸æ¨è&lt;/li&gt;
&lt;li&gt;builderä»æ€§èƒ½å’Œçµæ´»æ€§ä¸Šï¼Œéƒ½æ˜¯ä¸Šä½³çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;builder-æ…¢åœ¨å“ª&#34;&gt;Builder æ…¢åœ¨å“ª &lt;a href=&#34;#builder-%e6%85%a2%e5%9c%a8%e5%93%aa&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨å‰é¢å¯ä»¥çœ‹å‡ºæ¥å°‘é‡æ‹¼æ¥ï¼Œ&lt;code&gt;builder&lt;/code&gt;å¹¶ä¸æ˜æ˜¾ï¼Œé‚£ä¹ˆåˆ°åº•æ…¢åœ¨å“ªé‡Œå‘¢ï¼Ÿæ—¢ç„¶è¦ä¼˜åŒ–Builderæ‹¼æ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬èµ·ç çŸ¥é“ä»–æ…¢åœ¨å“ªï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨æˆ‘ä»¬ä¸Šç¯‡æ–‡ç« çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿è¡Œçœ‹ä¸‹æ€§èƒ½ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Builder10-8     5000000     258 ns/op       480 B/op        4 allocs/op
Builder100-8    1000000     2012 ns/op      6752 B/op       8 allocs/op
Builder1000-8   100000      21016 ns/op     96224 B/op      16 allocs/op
Builder10000-8  10000       195098 ns/op    1120226 B/op    25 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é’ˆå¯¹æ—¢ç„¶è¦ä¼˜åŒ–&lt;code&gt;Builder&lt;/code&gt;æ‹¼æ¥,é‡‡å–äº†10ã€100ã€1000ã€10000å››ç§ä¸åŒæ•°é‡çš„å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥æµ‹è¯•ã€‚æˆ‘ä»¬å‘ç°æ¯æ¬¡æ“ä½œéƒ½æœ‰ä¸åŒæ¬¡æ•°çš„å†…å­˜åˆ†é…ï¼Œå†…å­˜åˆ†é…è¶Šå¤šï¼Œè¶Šæ…¢ï¼Œå¦‚æœå¼•èµ·GCï¼Œå°±æ›´æ…¢äº†ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆä¼˜åŒ–è¿™ä¸ªï¼Œå‡å°‘å†…å­˜åˆ†é…çš„æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å†…å­˜åˆ†é…ä¼˜åŒ–&#34;&gt;å†…å­˜åˆ†é…ä¼˜åŒ– &lt;a href=&#34;#%e5%86%85%e5%ad%98%e5%88%86%e9%85%8d%e4%bc%98%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;é€šè¿‡cpuprofileï¼ŒæŸ¥çœ‹ç”Ÿæˆçš„ç«ç„°å›¾å¯ä»¥å¾—çŸ¥ï¼Œ&lt;code&gt;runtime.growslice&lt;/code&gt;å‡½æ•°ä¼šè¢«é¢‘ç¹çš„è°ƒç”¨ï¼Œå¹¶ä¸”æ—¶é—´å æ¯”ä¹Ÿæ¯”è¾ƒé•¿ã€‚æˆ‘ä»¬æŸ¥çœ‹&lt;code&gt;Builder.WriteString&lt;/code&gt;çš„æºä»£ç ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (b *Builder) WriteString(s string) (int, error) {
	b.copyCheck()
	b.buf = append(b.buf, s...)
	return len(s), nil
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥è‚¯å®šæ˜¯&lt;code&gt;append&lt;/code&gt;æ–¹æ³•è§¦å‘äº†&lt;code&gt;runtime.growslice&lt;/code&gt;ï¼Œå› ä¸º&lt;code&gt;b.buf&lt;/code&gt;çš„å®¹é‡&lt;code&gt;cap&lt;/code&gt;ä¸è¶³ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨&lt;code&gt;runtime.growslice&lt;/code&gt;æ‰©å……&lt;code&gt;b.buf&lt;/code&gt;çš„å®¹é‡ï¼Œç„¶åæ‰å¯ä»¥è¿½åŠ æ–°çš„å…ƒç´ &lt;code&gt;s...&lt;/code&gt;ã€‚æ‰©å®¹å®¹é‡è‡ªç„¶ä¼šæ¶‰åŠåˆ°å†…å­˜çš„åˆ†é…ï¼Œè€Œä¸”è¿½åŠ çš„å†…å®¹è¶Šå¤šï¼Œå†…å­˜åˆ†é…çš„æ¬¡æ•°è¶Šå¤šï¼Œè¿™å’Œæˆ‘ä»¬ä¸Šé¢æ€§èƒ½æµ‹è¯•çš„æ•°æ®æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶é—®é¢˜çš„åŸå› æ‰¾åˆ°äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¼˜åŒ–äº†ï¼Œæ ¸å¿ƒæ‰‹æ®µå°±æ˜¯å‡å°‘&lt;code&gt;runtime.growslice&lt;/code&gt;è°ƒç”¨ï¼Œç”šè‡³ä¸è°ƒç”¨ã€‚ç…§ç€è¿™ä¸ªæ€è·¯çš„è¯ï¼Œæˆ‘ä»¬å°±è¦æå‰ä¸º&lt;code&gt;b.buf&lt;/code&gt;åˆ†é…å¥½å®¹é‡&lt;code&gt;cap&lt;/code&gt;ã€‚å¹¸å¥½&lt;code&gt;Builder&lt;/code&gt;ä¸ºæˆ‘ä»¬æä¾›äº†æ‰©å……å®¹é‡çš„æ–¹æ³•&lt;code&gt;Grow&lt;/code&gt;ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œ&lt;code&gt;WriteString&lt;/code&gt;ä¹‹å‰ï¼Œå…ˆé€šè¿‡&lt;code&gt;Grow&lt;/code&gt;æ–¹æ³•ï¼Œæ‰©å……å¥½å®¹é‡å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¼€å§‹æ”¹é€ æˆ‘ä»¬çš„StringBuilderå‡½æ•°ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func StringBuilder(p []string,cap int) string {
	var b strings.Builder
	l:=len(p)
	b.Grow(cap)
	for i:=0;i&amp;lt;l;i++{
		b.WriteString(p[i])
	}
	return b.String()
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¢åŠ ä¸€ä¸ªå‚æ•°&lt;code&gt;cap&lt;/code&gt;ï¼Œè®©ä½¿ç”¨è€…å‘Šè¯‰æˆ‘ä»¬éœ€è¦çš„å®¹é‡å¤§å°ã€‚&lt;code&gt;Grow&lt;/code&gt;æ–¹æ³•çš„å®ç°éå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªé€šè¿‡&lt;code&gt;make&lt;/code&gt;å‡½æ•°ï¼Œæ‰©å……&lt;code&gt;b.buf&lt;/code&gt;å¤§å°ï¼Œç„¶åå†æ‹·è´&lt;code&gt;b.buf&lt;/code&gt;çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func (b *Builder) grow(n int) {
	buf := make([]byte, len(b.buf), 2*cap(b.buf)+n)
	copy(buf, b.buf)
	b.buf = buf
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é‚£ä¹ˆç°åœ¨æˆ‘ä»¬çš„æ€§èƒ½æµ‹è¯•ç”¨ä¾‹å˜æˆå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func BenchmarkStringBuilder10(b *testing.B) {
	p:= initStrings(10)
	cap:=10*len(BLOG)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuilder(p,cap)
	}
}

func BenchmarkStringBuilder1000(b *testing.B) {
	p:= initStrings(1000)
	cap:=1000*len(BLOG)
	b.ResetTimer()
	for i:=0;i&amp;lt;b.N;i++{
		StringBuilder(p,cap)
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸ºäº†è¯´æ˜æƒ…å†µå’Œç®€çŸ­ä»£ç ï¼Œè¿™é‡Œåªæœ‰10å’Œ1000ä¸ªå…ƒç´ çš„ç”¨ä¾‹ï¼Œå…¶ä»–ç±»ä¼¼ã€‚ä¸ºäº†æŠŠæ€§èƒ½ä¼˜åŒ–åˆ°æè‡´ï¼Œæˆ‘ä¸€æ¬¡æ€§æŠŠéœ€è¦çš„å®¹é‡åˆ†é…è¶³å¤Ÿã€‚ç°åœ¨æˆ‘ä»¬å†è¿è¡Œæ€§èƒ½ï¼ˆBenchmarkï¼‰æµ‹è¯•ä»£ç ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Builder10-8     10000000    123 ns/op       352 B/op    1 allocs/op
Builder100-8    2000000     898 ns/op       2688 B/op   1 allocs/op
Builder1000-8   200000      7729 ns/op      24576 B/op  1 allocs/op
Builder10000-8  20000       78678 ns/op     237568 B/op 1 allocs/op
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ€§èƒ½è¶³è¶³ç¿»äº†1å€å¤šï¼Œåªæœ‰1æ¬¡å†…å­˜åˆ†é…ï¼Œæ¯æ¬¡æ“ä½œå ç”¨çš„å†…å­˜ä¹Ÿå‡å°‘äº†ä¸€åŠå¤šï¼Œé™ä½äº†GCã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“ &lt;a href=&#34;#%e6%80%bb%e7%bb%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;èƒŒåçš„åŸç†ä¹Ÿéå¸¸æ¸…æ¥šï¼Œå°±æ˜¯é¢„å…ˆåˆ†é…å†…å­˜ï¼Œå‡å°‘appendè¿‡ç¨‹ä¸­çš„å†…å­˜é‡æ–°åˆ†é…å’Œæ•°æ®æ‹·è´ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æå‡å¾ˆå¤šçš„æ€§èƒ½ã€‚æ‰€ä»¥å¯¹äºå¯ä»¥é¢„è§çš„é•¿åº¦çš„åˆ‡ï¼Œéƒ½å¯ä»¥æå‰ç”³è¯·ç”³è¯·å¥½å†…å­˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ”¶é›†æ¥æºï¼šhttps://www.flysnow.org&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Goçš„pprofä½¿ç”¨æŠ€å·§</title>
      <link>https://abnerxc.github.io/go/pprof/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/pprof/</guid>
      <description>&lt;h1 id=&#34;1å®‰è£…æ˜“ç”¨çš„pprof&#34;&gt;1.å®‰è£…æ˜“ç”¨çš„pprof &lt;a href=&#34;#1%e5%ae%89%e8%a3%85%e6%98%93%e7%94%a8%e7%9a%84pprof&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;golangè‡ªå¸¦çš„profåŒ…æ˜¯runtime/pprofï¼Œè¿™ä¸ªæ˜¯ä½çº§åˆ«çš„ï¼Œéœ€è¦ä½ æ‰‹åŠ¨åšä¸€äº›è®¾ç½®ç­‰ç­‰å‘¨è¾¹å·¥ä½œï¼Œä¸åˆ©äºæˆ‘ä»¬å¿«é€Ÿä¸Šæ‰‹ï¼Œåˆ©ç”¨pprofå¸®åŠ©æˆ‘ä»¬è§£å†³å®é™…çš„é—®é¢˜ã€‚è¿™é‡Œæ¨èdavecheneyå°è£…çš„pprofï¼Œå®ƒå¯ä»¥1è¡Œä»£ç ï¼Œè®©ä½ ç”¨ä¸Špprofï¼Œä¸“å¿ƒè§£å†³è‡ªå·±çš„ä»£ç é—®é¢˜ï¼Œä¸‹è½½ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go get github.com/pkg/profile
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;2å®‰è£…graphviz&#34;&gt;2.å®‰è£…graphviz &lt;a href=&#34;#2%e5%ae%89%e8%a3%85graphviz&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;pprofç”Ÿæˆçš„profæ–‡ä»¶æ—¶äºŒè¿›åˆ¶çš„ï¼Œéœ€è¦æŠŠè¿™ä¸ªäºŒè¿›åˆ¶çš„æ–‡ä»¶è½¬æ¢ä¸ºæˆ‘ä»¬äººç±»å¯è¯»çš„ï¼Œgraphvizå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠäºŒè¿›åˆ¶çš„profæ–‡ä»¶è½¬æ¢ä¸ºå›¾åƒã€‚Macå®‰è£…ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;brew install graphviz
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;3ä¿®æ”¹mainå‡½æ•°&#34;&gt;3.ä¿®æ”¹mainå‡½æ•° &lt;a href=&#34;#3%e4%bf%ae%e6%94%b9main%e5%87%bd%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åªéœ€è¦ä¸ºhi.goå¢åŠ è¿™ä¸€è¡Œï¼Œdefer profile.Start().Stop()ï¼Œç¨‹åºè¿è¡Œæ—¶ï¼Œé»˜è®¤å°±ä¼šè®°å½•cpuæ•°æ®&lt;/p&gt;
&lt;h1 id=&#34;4ç¼–è¯‘è¿è¡Œä½ çš„å‡½æ•°&#34;&gt;4.ç¼–è¯‘è¿è¡Œä½ çš„å‡½æ•° &lt;a href=&#34;#4%e7%bc%96%e8%af%91%e8%bf%90%e8%a1%8c%e4%bd%a0%e7%9a%84%e5%87%bd%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
	&amp;#34;fmt&amp;#34;
	&amp;#34;github.com/pkg/profile&amp;#34;
)

func main() {
	defer profile.Start().Stop()
	sl:=makeSlice()
	fmt.Printf(&amp;#34;sum=%d\n&amp;#34;,sumSlice(sl))
}

func makeSlice() []int {
	sl := make([]int, 10000000)
	for idx := range sl {
		sl[idx] = idx
	}
	return sl
}

func sumSlice(sl []int) int {
	sum := 0
	for _, x := range sl {
		sum += x
	}
	return sum
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿è¡Œä»£ç &lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go build hi.go
./hi
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åº”å½“çœ‹åˆ°ç±»ä¼¼çš„ç»“æœï¼Œå®ƒè¾“å‡ºäº†ç”Ÿæˆçš„cpu.pprofçš„è·¯å¾„ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;2019/02/26 23:24:22 profile: cpu profiling enabled, /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile152894194/cpu.pprof  
sum=49999995000000  
2019/02/26 23:24:22 profile: cpu profiling disabled, /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile152894194/cpu.pprof  
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;5å¯è§†åŒ–prof&#34;&gt;5.å¯è§†åŒ–prof &lt;a href=&#34;#5%e5%8f%af%e8%a7%86%e5%8c%96prof&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¯è§†åŒ–æœ‰å¤šç§æ–¹å¼ï¼Œå¯ä»¥è½¬æ¢ä¸ºtextã€pdfã€svgç­‰ç­‰ã€‚textå‘½ä»¤æ˜¯&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go tool pprof --text /path/to/yourbinary /var/path/to/cpu.pprof
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go tool pprof --text ./hi /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile626723859/cpu.pprof
File: hi
Type: cpu
Time: Feb 26, 2019 at 11:29pm (CST)
Duration: 203.53ms, Total samples = 100ms (49.13%)
Showing nodes accounting for 100ms, 100% of 100ms total
      flat  flat%   sum%        cum   cum%
      60ms 60.00% 60.00%       60ms 60.00%  runtime.usleep
      30ms 30.00% 90.00%       30ms 30.00%  main.makeSlice
      10ms 10.00%   100%       10ms 10.00%  runtime.nanotime
         0     0%   100%       30ms 30.00%  main.main
         0     0%   100%       10ms 10.00%  runtime.gcBgMarkWorker
         0     0%   100%       70ms 70.00%  runtime.gcBgMarkWorker.func2
         0     0%   100%       70ms 70.00%  runtime.gcDrain
         0     0%   100%       30ms 30.00%  runtime.main
         0     0%   100%       70ms 70.00%  runtime.markroot
         0     0%   100%       70ms 70.00%  runtime.markroot.func1
         0     0%   100%       60ms 60.00%  runtime.mstart
         0     0%   100%       60ms 60.00%  runtime.osyield
         0     0%   100%       70ms 70.00%  runtime.scang
         0     0%   100%       70ms 70.00%  runtime.systemstack
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç”Ÿæˆpdfå›¾&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; go tool pprof --pdf ./hi /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile626723859/cpu.pprof &amp;gt; cpu.pdf
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;6è·å–å†…å­˜ppfo&#34;&gt;6.è·å–å†…å­˜ppfo &lt;a href=&#34;#6%e8%8e%b7%e5%8f%96%e5%86%85%e5%ad%98ppfo&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¦‚æœä½ æŒæ¡äº†cpu pprofï¼Œmem pprofè½»è€Œæ˜“ä¸¾å°±èƒ½æ‹¿ä¸‹ï¼Œåªéœ€è¦æ”¹1è¡Œä»£ç ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;defer profile.Start(profile.MemProfile).Stop()
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Goè¯­è¨€ç¼–ç¨‹æ¨¡å¼</title>
      <link>https://abnerxc.github.io/go/go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F/</link>
      <pubDate>Tue, 15 Jan 2019 18:35:11 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/go/go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F/</guid>
      <description>&lt;h1 id=&#34;æ€§èƒ½æç¤º&#34;&gt;æ€§èƒ½æç¤º &lt;a href=&#34;#%e6%80%a7%e8%83%bd%e6%8f%90%e7%a4%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœéœ€è¦æŠŠæ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ strconv.Itoa() æ¯” fmt.Sprintf() è¦å¿«ä¸€å€å·¦å³ã€‚&lt;/li&gt;
&lt;li&gt;å°½å¯èƒ½é¿å…æŠŠStringè½¬æˆ[]Byte ï¼Œè¿™ä¸ªè½¬æ¢ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœåœ¨ for-loop é‡Œå¯¹æŸä¸ª Slice ä½¿ç”¨ append()ï¼Œè¯·å…ˆæŠŠ Slice çš„å®¹é‡æ‰©å……åˆ°ä½ï¼Œè¿™æ ·å¯ä»¥é¿å…å†…å­˜é‡æ–°åˆ†é…ä»¥åŠç³»ç»Ÿè‡ªåŠ¨æŒ‰ 2 çš„ N æ¬¡æ–¹å¹‚è¿›è¡Œæ‰©å±•ä½†åˆç”¨ä¸åˆ°çš„æƒ…å†µï¼Œä»è€Œé¿å…æµªè´¹å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨StringBuffer æˆ–æ˜¯StringBuild æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œæ€§èƒ½ä¼šæ¯”ä½¿ç”¨ + æˆ– +=é«˜ä¸‰åˆ°å››ä¸ªæ•°é‡çº§ã€‚&lt;/li&gt;
&lt;li&gt;å°½å¯èƒ½ä½¿ç”¨å¹¶å‘çš„ goroutineï¼Œç„¶åä½¿ç”¨ sync.WaitGroup æ¥åŒæ­¥åˆ†ç‰‡æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;é¿å…åœ¨çƒ­ä»£ç ä¸­è¿›è¡Œå†…å­˜åˆ†é…ï¼Œè¿™æ ·ä¼šå¯¼è‡´ gc å¾ˆå¿™ã€‚å°½å¯èƒ½ä½¿ç”¨ sync.Pool æ¥é‡ç”¨å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ lock-free çš„æ“ä½œï¼Œé¿å…ä½¿ç”¨ mutexï¼Œå°½å¯èƒ½ä½¿ç”¨ sync/AtomicåŒ…&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ I/O ç¼“å†²ï¼ŒI/O æ˜¯ä¸ªéå¸¸éå¸¸æ…¢çš„æ“ä½œï¼Œä½¿ç”¨ bufio.NewWrite() å’Œ bufio.NewReader() å¯ä»¥å¸¦æ¥æ›´é«˜çš„æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºåœ¨ for-loop é‡Œçš„å›ºå®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸€å®šè¦ä½¿ç”¨ regexp.Compile() ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ã€‚æ€§èƒ½ä¼šæå‡ä¸¤ä¸ªæ•°é‡çº§ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ éœ€è¦æ›´é«˜æ€§èƒ½çš„åè®®ï¼Œå°±è¦è€ƒè™‘ä½¿ç”¨ protobuf æˆ– msgp è€Œä¸æ˜¯ JSONï¼Œå› ä¸º JSON çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–é‡Œä½¿ç”¨äº†åå°„ã€‚&lt;/li&gt;
&lt;li&gt;ä½ åœ¨ä½¿ç”¨ Map çš„æ—¶å€™ï¼Œä½¿ç”¨æ•´å‹çš„ key ä¼šæ¯”å­—ç¬¦ä¸²çš„è¦å¿«ï¼Œå› ä¸ºæ•´å‹æ¯”è¾ƒæ¯”å­—ç¬¦ä¸²æ¯”è¾ƒè¦å¿«ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ¥å£ç¼–ç¨‹&#34;&gt;æ¥å£ç¼–ç¨‹ &lt;a href=&#34;#%e6%8e%a5%e5%8f%a3%e7%bc%96%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
type Country struct {
    Name string
}

type City struct {
    Name string
}

type Printable interface {
    PrintStr()
}
func (c Country) PrintStr() {
    fmt.Println(c.Name)
}
func (c City) PrintStr() {
    fmt.Println(c.Name)
}

c1 := Country {&amp;#34;China&amp;#34;}
c2 := City {&amp;#34;Beijing&amp;#34;}
c1.PrintStr()
c2.PrintStr()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ®µä»£ç ä¸­ä½¿ç”¨äº†ä¸€ä¸ª Printable çš„æ¥å£ï¼Œè€Œ Country å’Œ City éƒ½å®ç°äº†æ¥å£æ–¹æ³• PrintStr() æŠŠè‡ªå·±è¾“å‡ºã€‚ç„¶è€Œï¼Œè¿™äº›ä»£ç éƒ½æ˜¯ä¸€æ ·çš„ï¼Œèƒ½ä¸èƒ½çœæ‰å‘¢ï¼Ÿå…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œç»“æ„ä½“åµŒå…¥â€çš„æ–¹å¼æ¥å®Œæˆè¿™ä¸ªäº‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
type WithName struct {
    Name string
}

type Country struct {
    WithName
}

type City struct {
    WithName
}

type Printable interface {
    PrintStr()
}

func (w WithName) PrintStr() {
    fmt.Println(w.Name)
}

c1 := Country {WithName{ &amp;#34;China&amp;#34;}}
c2 := City { WithName{&amp;#34;Beijing&amp;#34;}}
c1.PrintStr()
c2.PrintStr()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¼•å…¥ä¸€ä¸ªå« WithNameçš„ç»“æ„ä½“ï¼Œä½†æ˜¯è¿™ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™å˜å¾—æœ‰ç‚¹ä¹±ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•å‘¢ï¼Ÿå†æ¥çœ‹å¦å¤–ä¸€ä¸ªè§£ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
type Country struct {
    Name string
}

type City struct {
    Name string
}

type Stringable interface {
    ToString() string
}
func (c Country) ToString() string {
    return &amp;#34;Country = &amp;#34; + c.Name
}
func (c City) ToString() string{
    return &amp;#34;City = &amp;#34; + c.Name
}

func PrintStr(p Stringable) {
    fmt.Println(p.ToString())
}

d1 := Country {&amp;#34;USA&amp;#34;}
d2 := City{&amp;#34;Los Angeles&amp;#34;}
PrintStr(d1)
PrintStr(d2)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå«Stringable çš„æ¥å£ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªæ¥å£æŠŠâ€œä¸šåŠ¡ç±»å‹â€ Country å’Œ City å’Œâ€œæ§åˆ¶é€»è¾‘â€ Print() ç»™è§£è€¦äº†ã€‚äºæ˜¯ï¼Œåªè¦å®ç°äº†Stringable æ¥å£ï¼Œéƒ½å¯ä»¥ä¼ ç»™ PrintStr() æ¥ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ¥å£å®Œæ•´æ€§æ£€æŸ¥&#34;&gt;æ¥å£å®Œæ•´æ€§æ£€æŸ¥ &lt;a href=&#34;#%e6%8e%a5%e5%8f%a3%e5%ae%8c%e6%95%b4%e6%80%a7%e6%a3%80%e6%9f%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
type Shape interface {
    Sides() int
    Area() int
}
type Square struct {
    len int
}
func (s* Square) Sides() int {
    return 4
}
func main() {
    s := Square{len: 5}
    fmt.Printf(&amp;#34;%d\n&amp;#34;,s.Sides())
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼ŒSquare å¹¶æ²¡æœ‰å®ç° Shape æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œç¨‹åºè™½ç„¶å¯ä»¥è·‘é€šï¼Œä½†æ˜¯è¿™æ ·çš„ç¼–ç¨‹æ–¹å¼å¹¶ä¸ä¸¥è°¨ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¼ºåˆ¶å®ç°æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;var _ Shape = (*Square)(nil)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å£°æ˜ä¸€ä¸ª _ å˜é‡ï¼ˆæ²¡äººç”¨ï¼‰ä¼šæŠŠä¸€ä¸ª nil çš„ç©ºæŒ‡é’ˆä» Square è½¬æˆ Shapeï¼Œè¿™æ ·ï¼Œå¦‚æœæ²¡æœ‰å®ç°å®Œç›¸å…³çš„æ¥å£æ–¹æ³•ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;cannot use (*Square)(nil) (type *Square) as type Shape in assignment: *Square does not implement Shape (missing Area method)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;functional-options-ç¼–ç¨‹æ¨¡å¼&#34;&gt;Functional Options ç¼–ç¨‹æ¨¡å¼ &lt;a href=&#34;#functional-options-%e7%bc%96%e7%a8%8b%e6%a8%a1%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;package main

import (
	&amp;#34;crypto/tls&amp;#34;
	&amp;#34;fmt&amp;#34;
	&amp;#34;time&amp;#34;
)

type Option func(*Server)

type Server struct {
	Addr     string
	Port     int
	Protocol string
	Timeout  time.Duration
	MaxConns int
	TLS      *tls.Config
}

func Protocol(p string) Option {
	return func(s *Server) {
		s.Protocol = p
	}
}
func Timeout(timeout time.Duration) Option {
	return func(s *Server) {
		s.Timeout = timeout
	}
}
func MaxConns(maxconns int) Option {
	return func(s *Server) {
		s.MaxConns = maxconns
	}
}
func TLS(tls *tls.Config) Option {
	return func(s *Server) {
		s.TLS = tls
	}
}
func NewService(addr string, port int, options ...func(*Server)) (*Server, error) {
	srv := Server{
		Addr:     addr,
		Port:     port,
		Protocol: &amp;#34;tcp&amp;#34;,
		Timeout:  30 * time.Second,
		MaxConns: 1000,
		TLS:      nil,
	}
	for _, option := range options {
		option(&amp;amp;srv)
	} //...
	return &amp;amp;srv, nil
}

func main() {
	server, _ := NewService(&amp;#34;localhost&amp;#34;, 80, Protocol(&amp;#34;ftp&amp;#34;),Timeout(5*10))
	fmt.Println(server)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;mapreducefilter-æ¨¡å¼&#34;&gt;Map,Reduce,Filter æ¨¡å¼ &lt;a href=&#34;#mapreducefilter-%e6%a8%a1%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
type Employee struct {
    Name     string
    Age      int
    Vacation int
    Salary   int
}

var list = []Employee{
    {&amp;#34;Hao&amp;#34;, 44, 0, 8000},
    {&amp;#34;Bob&amp;#34;, 34, 10, 5000},
    {&amp;#34;Alice&amp;#34;, 23, 5, 9000},
    {&amp;#34;Jack&amp;#34;, 26, 0, 4000},
    {&amp;#34;Tom&amp;#34;, 48, 9, 7500},
    {&amp;#34;Marry&amp;#34;, 29, 0, 6000},
    {&amp;#34;Mike&amp;#34;, 32, 8, 4000},
}


func EmployeeCountIf(list []Employee, fn func(e *Employee) bool) int {
    count := 0
    for i, _ := range list {
        if fn(&amp;amp;list[i]) {
            count += 1
        }
    }
    return count
}

func EmployeeFilterIn(list []Employee, fn func(e *Employee) bool) []Employee {
    var newList []Employee
    for i, _ := range list {
        if fn(&amp;amp;list[i]) {
            newList = append(newList, list[i])
        }
    }
    return newList
}

func EmployeeSumIf(list []Employee, fn func(e *Employee) int) int {
    var sum = 0
    for i, _ := range list {
        sum += fn(&amp;amp;list[i])
    }
    return sum
}

//ç»Ÿè®¡æœ‰å¤šå°‘å‘˜å·¥å¤§äº 40 å²

old := EmployeeCountIf(list, func(e *Employee) bool {
    return e.Age &amp;gt; 40
})
fmt.Printf(&amp;#34;old people: %d\n&amp;#34;, old)
//old people: 2
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title></title>
      <link>https://abnerxc.github.io/go/base4.%E6%8E%A5%E5%8F%A3/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://abnerxc.github.io/go/base4.%E6%8E%A5%E5%8F%A3/</guid>
      <description>&lt;p&gt;title = &amp;lsquo;GoåŸºç¡€-æ¥å£&amp;rsquo;
date = 2019-01-15T18:35:11+08:00
draft = false
categories=[&amp;lsquo;Go&amp;rsquo;]&lt;/p&gt;
&lt;h1 id=&#34;ä»€ä¹ˆæ˜¯æ¥å£&#34;&gt;ä»€ä¹ˆæ˜¯æ¥å£ &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨ä¸€äº›é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä¾‹å¦‚ Javaã€PHP ç­‰ï¼Œæ¥å£å®šä¹‰äº†å¯¹è±¡çš„è¡Œä¸ºï¼ŒåªæŒ‡å®šäº†å¯¹è±¡åº”è¯¥åšä»€ä¹ˆã€‚è¡Œä¸ºçš„å…·ä½“å®ç°å–å†³äºå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Go è¯­è¨€ä¸­ï¼Œæ¥å£æ˜¯ä¸€ç»„æ–¹æ³•çš„é›†åˆï¼Œä½†ä¸åŒ…å«æ–¹æ³•çš„å®ç°ã€æ˜¯æŠ½è±¡çš„ï¼Œæ¥å£ä¸­ä¹Ÿä¸èƒ½åŒ…å«å˜é‡ã€‚å½“ä¸€ä¸ªç±»å‹ T æä¾›äº†æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•çš„å®šä¹‰æ—¶ï¼Œå°±è¯´ T å®ç°äº†æ¥å£ã€‚æ¥å£æŒ‡å®šç±»å‹åº”è¯¥æœ‰å“ªäº›æ–¹æ³•ï¼Œç±»å‹å†³å®šå¦‚ä½•å»å®ç°è¿™äº›æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ¥å£å£°æ˜&#34;&gt;æ¥å£å£°æ˜ &lt;a href=&#34;#%e6%8e%a5%e5%8f%a3%e5%a3%b0%e6%98%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Shape interface {
    Area() float32
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç å®šä¹‰äº†æ¥å£ç±»å‹ Shapeï¼Œæ¥å£ä¸­åŒ…å«äº†ä¸€ä¸ªä¸å¸¦å‚æ•°ã€è¿”å›å€¼ä¸º float32  çš„æ–¹æ³• Area()ã€‚ä»»ä½•å®ç°äº†æ–¹æ³• Area() çš„ç±»å‹ Tï¼Œæˆ‘ä»¬å°±è¯´å®ƒå®ç°äº†æ¥å£ Shapeã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func main() {
    var s Shape
    fmt.Println(&amp;#34;value of s is&amp;#34;, s)
    fmt.Printf(&amp;#34;type of s is %T\n&amp;#34;, s)
}

//output
value of s is &amp;lt;nil&amp;gt;
type of s is &amp;lt;nil&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;æ¥å£çš„ç±»å‹å€¼&#34;&gt;æ¥å£çš„ç±»å‹å€¼ &lt;a href=&#34;#%e6%8e%a5%e5%8f%a3%e7%9a%84%e7%b1%bb%e5%9e%8b%e5%80%bc&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;é™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹&#34;&gt;é™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹ &lt;a href=&#34;#%e9%9d%99%e6%80%81%e7%b1%bb%e5%9e%8b%e5%92%8c%e5%8a%a8%e6%80%81%e7%b1%bb%e5%9e%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å˜é‡çš„ç±»å‹åœ¨å£°æ˜æ—¶æŒ‡å®šã€ä¸”ä¸èƒ½æ”¹å˜ï¼Œç§°ä¸º&lt;code&gt;é™æ€ç±»å‹&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ¥å£ç±»å‹çš„é™æ€å€¼å°±æ˜¯æ¥å£æœ¬èº«ã€‚&lt;/li&gt;
&lt;li&gt;æ¥å£æ²¡æœ‰é™æ€å€¼ï¼Œå®ƒæŒ‡å‘çš„æ˜¯åŠ¨æ€å€¼ã€‚&lt;/li&gt;
&lt;li&gt;æ¥å£ç±»å‹çš„å˜é‡å­˜çš„æ˜¯å®ç°æ¥å£çš„ç±»å‹çš„å€¼ã€‚è¯¥å€¼å°±æ˜¯æ¥å£çš„åŠ¨æ€å€¼ï¼Œå®ç°æ¥å£çš„ç±»å‹å°±æ˜¯æ¥å£çš„åŠ¨æ€ç±»å‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Iname interface {
    Mname()
}

type St1 struct {}
func (St1) Mname() {}
type St2 struct {}
func (St2) Mname() {}

func main() {
    var i Iname = St1{}
    fmt.Printf(&amp;#34;type is %T\n&amp;#34;,i)
    fmt.Printf(&amp;#34;value is %v\n&amp;#34;,i)
    i = St2{}
    fmt.Printf(&amp;#34;type is %T\n&amp;#34;,i)
    fmt.Printf(&amp;#34;value is %v\n&amp;#34;,i)
}
//output 
type is main.St1
value is {}
type is main.St2
value is {}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å˜é‡&lt;code&gt;i&lt;/code&gt;çš„é™æ€ç±»å‹æ˜¯&lt;code&gt;Iname&lt;/code&gt;,æ˜¯ä¸èƒ½æ”¹å˜çš„ã€‚åŠ¨æ€ç±»å‹å´æ˜¯ä¸å›ºå®šçš„ã€‚ç¬¬ä¸€æ¬¡åˆ†é…æ˜¯ &lt;code&gt;St1&lt;/code&gt; ç¬¬äºŒæ¬¡æ˜¯&lt;code&gt;St2&lt;/code&gt;,åŠ¨æ€å€¼éƒ½æ˜¯&lt;code&gt;ç©ºç»“æ„ä½“&lt;/code&gt;
æœ‰æ—¶å€™ï¼Œæ¥å£çš„åŠ¨æ€ç±»å‹åˆç§°ä¸º&lt;code&gt;å…·ä½“ç±»å‹&lt;/code&gt;ï¼Œå½“è®¿é—®çš„æ—¶å€™ï¼Œè¿”å›çš„æ˜¯åº•å±‚çš„åŠ¨æ€å€¼ç±»å‹&lt;/p&gt;
&lt;h2 id=&#34;nilå€¼&#34;&gt;nilå€¼ &lt;a href=&#34;#nil%e5%80%bc&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Iname interface {
    Mname()
}
type St struct {}
func (St) Mname() {}
func main() {
    var t *St
    if t == nil {
        fmt.Println(&amp;#34;t is nil&amp;#34;)
    } else {
        fmt.Println(&amp;#34;t is not nil&amp;#34;)
    }
    var i Iname = t
    fmt.Printf(&amp;#34;%T\n&amp;#34;, i)
    if i == nil {
        fmt.Println(&amp;#34;i is nil&amp;#34;)
    } else {
        fmt.Println(&amp;#34;i is not nil&amp;#34;)
    }
    fmt.Printf(&amp;#34;i is nil pointer:%v&amp;#34;,i == (*St)(nil))
}
//output
t is nil
*main.St
i is not nil
i is nil pointer:true
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;å½“ä¸”ä»…å½“åŠ¨æ€å€¼å’ŒåŠ¨æ€ç±»å‹éƒ½ä¸º nil æ—¶ï¼Œæ¥å£ç±»å‹å€¼æ‰ä¸º nil&lt;/code&gt;ã€‚ä¸Šé¢çš„ä»£ç ï¼Œç»™å˜é‡ i  èµ‹å€¼ä¹‹åï¼Œi çš„åŠ¨æ€å€¼æ˜¯ nilï¼Œä½†æ˜¯åŠ¨æ€ç±»å‹å´æ˜¯ *Stï¼Œ i æ˜¯ä¸€ä¸ª nil æŒ‡é’ˆï¼Œæ‰€ä»¥æ¡ä»¶ä¸æˆç«‹ã€‚&lt;/p&gt;
&lt;p&gt;Goè¯­è¨€è§„èŒƒï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; var x interface{}  // x is nil and has static type interface{}
 var v *T           // v has value nil, static type *T
 x = 42             // x has value 42 and dynamic type int
 x = v              // x has value (*T)(nil) and dynamic type *T
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;å®ç°æ¥å£&#34;&gt;å®ç°æ¥å£ &lt;a href=&#34;#%e5%ae%9e%e7%8e%b0%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Shape interface {
    Area() float32
}

type Rect struct {
    width  float32
    height float32
}
//ç»“æ„ä½“å®ç°äº†æ¥å£
func (r Rect) Area() float32 {
    return r.width * r.height
}

func main() {
    var s Shape
    s = Rect{5.0, 4.0}
    r := Rect{5.0, 4.0}
    fmt.Printf(&amp;#34;type of s is %T\n&amp;#34;, s)
    fmt.Printf(&amp;#34;value of s is %v\n&amp;#34;, s)
    fmt.Println(&amp;#34;area of rectange s&amp;#34;, s.Area())
    fmt.Println(&amp;#34;s == r is&amp;#34;, s == r)
}
//output
type of s is main.Rect
value of s is {5 4}
area of rectange s 20
s == r is true
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;ç©ºæ¥å£&#34;&gt;ç©ºæ¥å£ &lt;a href=&#34;#%e7%a9%ba%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Println(a ...interface{}) (n int, err error) {}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type MyString string
type Rect struct {
    width  float32
    height float32
}
func explain(i interface{}) {
    fmt.Printf(&amp;#34;type of s is %T\n&amp;#34;, i)
    fmt.Printf(&amp;#34;value of s is %v\n\n&amp;#34;, i)
}
func main() {
    ms := MyString(&amp;#34;Seekload&amp;#34;)
    r := Rect{5.0, 4.0}
    explain(ms)
    explain(r)
}
//output
type of s is main.MyString
value of s is Seekload

type of s is main.Rect
value of s is {5 4}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç ï¼Œåˆ›å»ºäº†è‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ç±»å‹ MyString ã€ç»“æ„ä½“ Rect å’Œ explain() å‡½æ•°ã€‚explain() å‡½æ•°çš„å½¢å‚æ˜¯ç©ºæ¥å£ï¼Œæ‰€ä»¥å¯ä»¥æ¥æ”¶ä»»æ„ç±»å‹çš„å€¼ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å®ç°å¤šä¸ªæ¥å£&#34;&gt;å®ç°å¤šä¸ªæ¥å£ &lt;a href=&#34;#%e5%ae%9e%e7%8e%b0%e5%a4%9a%e4%b8%aa%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Shape interface {
	Area() float32
}
 
type Object interface {
	Perimeter() float32
}

type Circle struct {
	radius float32
}

func (c Circle) Area() float32 {
    return math.Pi * (c.radius * c.radius)
}

func (c Circle) Perimeter() float32 {
   return 2 * math.Pi * c.radius
}

func main() {
    c := Circle{3}
    var s Shape = c
    var p Object = c
    fmt.Println(&amp;#34;area: &amp;#34;, s.Area())
    fmt.Println(&amp;#34;perimeter: &amp;#34;, p.Perimeter())
}
//output
area:  28.274334
perimeter:  18.849556
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœä¿®æ”¹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;fmt.Println(&amp;#34;area: &amp;#34;, p.Area())
fmt.Println(&amp;#34;perimeter: &amp;#34;, s.Perimeter())
//output
p.Area undefined (type Object has no field or method Area)
s.Perimeter undefined (type Shape has no field or method Perimeter)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å› ä¸º s çš„é™æ€ç±»å‹æ˜¯ Shapeï¼Œè€Œ p çš„é™æ€ç±»å‹æ˜¯ Objectï¼Œæ­¤é—®é¢˜å¯ä»¥ä½¿ç”¨&lt;code&gt;ç±»å‹æ–­è¨€&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç±»å‹æ–­è¨€&#34;&gt;ç±»å‹æ–­è¨€ &lt;a href=&#34;#%e7%b1%bb%e5%9e%8b%e6%96%ad%e8%a8%80&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ç±»å‹æ–­è¨€å¯ä»¥ç”¨æ¥è·å–æ¥å£çš„åº•å±‚å€¼ï¼Œé€šå¸¸çš„è¯­æ³•ï¼š&lt;code&gt;i.(Type)&lt;/code&gt;ï¼Œå…¶ä¸­ i æ˜¯æ¥å£ï¼ŒType æ˜¯ç±»å‹æˆ–æ¥å£ã€‚ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹ i çš„åŠ¨æ€ç±»å‹ä¸ Type æ˜¯å¦ä¸€è‡´ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Shape interface {
	Area() float32
}
 
type Object interface {
	Perimeter() float32
}

type Circle struct {
	radius float32
}

func (c Circle) Area() float32 {
    return math.Pi * (c.radius * c.radius)
}

func (c Circle) Perimeter() float32 {
   return 2 * math.Pi * c.radius
}

func main() {
    var s Shape = Circle{3}
    c := s.(Circle)
    var p Object = c
    fmt.Printf(&amp;#34;%T\n&amp;#34;,c)
    fmt.Printf(&amp;#34;%v\n&amp;#34;,c)
    fmt.Println(&amp;#34;area: &amp;#34;, c.Area())
    fmt.Println(&amp;#34;perimeter: &amp;#34;, c.Perimeter())
}
//output
main.Circle
{3}
area:  28.274334
perimeter:  18.849556
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ c è®¿é—®æ¥å£ s çš„åº•å±‚å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ c åˆ†åˆ«è°ƒç”¨æ–¹æ³• Area() å’Œ Perimeter()ï¼Œè¿™å°±è§£å†³äº†ä¸Šé¢é‡åˆ°çš„é—®é¢˜ã€‚
&lt;code&gt;åœ¨è¯­æ³• i.(Type) ä¸­ï¼Œå¦‚æœ Type æ²¡æœ‰å®ç° i æ‰€å±çš„æ¥å£ï¼Œç¼–è¯‘çš„æ—¶å€™ä¼šæŠ¥é”™ï¼›æˆ–è€… i çš„åŠ¨æ€å€¼ä¸æ˜¯ Typeï¼Œåˆ™ä¼šæŠ¥ panic é”™è¯¯&lt;/code&gt;ã€‚æ€ä¹ˆè§£å†³å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•:&lt;code&gt;value, ok := i.(Type)&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç±»å‹é€‰æ‹©&#34;&gt;ç±»å‹é€‰æ‹© &lt;a href=&#34;#%e7%b1%bb%e5%9e%8b%e9%80%89%e6%8b%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func switchType(i interface{}) {
     switch i.(type) {
     case string:
         fmt.Printf(&amp;#34;string and value is %s\n&amp;#34;, i.(string))
     case int:
         fmt.Printf(&amp;#34;int and value is %d\n&amp;#34;, i.(int))
     default:
         fmt.Printf(&amp;#34;Unknown type\n&amp;#34;)
     }
}
func main() {
    switchType(&amp;#34;Seekload&amp;#34;)
    switchType(27)
    switchType(true)
}
//output
string and value is Seekload
int and value is 27
Unknown type
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;æ³¨æ„ï¼šåªæœ‰æ¥å£ç±»å‹æ‰å¯ä»¥è¿›è¡Œç±»å‹é€‰æ‹©&lt;/code&gt;ã€‚å…¶ä»–ç±»å‹ï¼Œä¾‹å¦‚ intã€stringç­‰æ˜¯ä¸èƒ½&lt;/p&gt;
&lt;h1 id=&#34;æ¥å£åµŒå¥—&#34;&gt;æ¥å£åµŒå¥— &lt;a href=&#34;#%e6%8e%a5%e5%8f%a3%e5%b5%8c%e5%a5%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Go è¯­è¨€ä¸­ï¼Œæ¥å£ä¸èƒ½å»å®ç°åˆ«çš„æ¥å£ä¹Ÿä¸èƒ½ç»§æ‰¿ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åµŒå¥—æ¥å£åˆ›å»ºæ–°æ¥å£&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Math interface {
	Shape
	Object
}
type Shape interface {
	Area() float32
}

type Object interface {
	Perimeter() float32
}

type Circle struct {
	radius float32
}

func (c Circle) Area() float32 {
	return math.Pi * (c.radius * c.radius)
}

func (c Circle) Perimeter() float32 {
	return 2 * math.Pi * c.radius
}

func main() {
    c := Circle{3}
    var m Math = c
    fmt.Printf(&amp;#34;%T\n&amp;#34;, m )
    fmt.Println(&amp;#34;area: &amp;#34;, m.Area())
    fmt.Println(&amp;#34;perimeter: &amp;#34;, m.Perimeter())
}
//output
main.Circle
area:  28.274334
perimeter:  18.849556
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç ï¼Œé€šè¿‡åµŒå¥—æ¥å£ Shape å’Œ Objectï¼Œåˆ›å»ºäº†æ–°çš„æ¥å£ Mathã€‚ä»»ä½•ç±»å‹å¦‚æœå®ç°äº†æ¥å£ Shape å’Œ Object å®šä¹‰çš„æ–¹æ³•ï¼Œåˆ™è¯´ç±»å‹ä¹Ÿå®ç°äº†æ¥å£ Mathï¼Œä¾‹å¦‚æˆ‘ä»¬åˆ›å»ºçš„ç»“æ„ä½“ Circleã€‚
ä¸»å‡½æ•°é‡Œé¢ï¼Œå®šä¹‰äº†æ¥å£ç±»å‹çš„å˜é‡ mï¼ŒåŠ¨æ€ç±»å‹æ˜¯ç»“æ„ä½“ Circleï¼Œæ³¨æ„ä¸‹æ–¹æ³• Area å’Œ  Perimeter çš„è°ƒç”¨æ–¹å¼ï¼Œç±»ä¼¼ä¸è®¿é—®åµŒå¥—ç»“æ„ä½“çš„æˆå‘˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…å’Œå€¼æ¥æ”¶è€…å®ç°æ¥å£&#34;&gt;ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…å’Œå€¼æ¥æ”¶è€…å®ç°æ¥å£ &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e6%8c%87%e9%92%88%e6%8e%a5%e6%94%b6%e8%80%85%e5%92%8c%e5%80%bc%e6%8e%a5%e6%94%b6%e8%80%85%e5%ae%9e%e7%8e%b0%e6%8e%a5%e5%8f%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;type Shape interface {
	Area() float32
}
type Circle struct {
	radius float32
}
type Square struct {
	side float32
}
func (c Circle) Area() float32 {
	return math.Pi * (c.radius * c.radius)
}

func (s *Square) Area() float32 {
	return s.side*s.side
}
func main() {
    var s Shape
    c1 := Circle{3}
    s = c1
    fmt.Printf(&amp;#34;%v\n&amp;#34;,s.Area())

    c2 := Circle{4}
    s = &amp;amp;c2
    fmt.Printf(&amp;#34;%v\n&amp;#34;,s.Area())

    c3 := Square{3}
    //s = c3
    s = &amp;amp;c3
    fmt.Printf(&amp;#34;%v\n&amp;#34;,s.Area())
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç ï¼Œç»“æ„ä½“ Circle é€šè¿‡å€¼æ¥æ”¶è€…å®ç°äº†æ¥å£ Shapeã€‚å€¼æ¥æ”¶è€…çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨å€¼æˆ–è€…æŒ‡é’ˆè°ƒç”¨ï¼Œæ‰€ä»¥ä¸Šé¢çš„ c1 å’Œ c2 çš„è°ƒç”¨æ–¹å¼æ˜¯åˆæ³•çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç»“æ„ä½“ Square é€šè¿‡æŒ‡é’ˆæ¥æ”¶è€…å®ç°äº†æ¥å£ Shapeã€‚å¦‚æœå°†ä¸Šæ–¹æ³¨é‡Šéƒ¨åˆ†æ‰“å¼€çš„è¯ï¼Œç¼–è¯‘å°±ä¼šå‡ºé”™ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cannot use c3 (type Square) as type Shape in assignment:
Square does not implement Shape (Area method has pointer receiver)
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
  </channel>
</rss>
