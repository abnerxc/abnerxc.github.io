<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">




<title>Go-æ·±å…¥è§£æsliceåº•å±‚å®ç° | Abnerçš„åšå®¢</title>
<link rel="canonical" href="https://abnerxc.github.io/go/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90slice%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/">
<meta property="og:type" content="article" />
<meta property="og:title" content="Go-æ·±å…¥è§£æsliceåº•å±‚å®ç° | Abnerçš„åšå®¢" />
<meta property="og:url" content="https://abnerxc.github.io/go/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90slice%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/" />








<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/custom.css" />
<script src="/js/copy-code-block.js"></script>
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    </head>

    <body>
        <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://abnerxc.github.io/">Abnerçš„åšå®¢</a>

        <nav class="menu">
            
        </nav>
    </div>
</header>

        <main class="main-wrapper">
            <div class="main">
                

<section class="single">
    <h1 class="title">Go-æ·±å…¥è§£æsliceåº•å±‚å®ç°</h1>

    <div class="tip">
        <time datetime="2021-05-15 18:35:11 &#43;0800 CST">2021/05/15</time>
        <span class="split">Â·</span>
        <span> 1474 words </span>
        <span class="split">Â·</span>
        <span>
            7 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/go">Go</a>
            
        </div>
        

        
    </div>

    
    
    <div class="post-toc">
        <h3>ç›®å½•</h3>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#åˆ‡ç‰‡å’Œæ•°ç»„">åˆ‡ç‰‡å’Œæ•°ç»„</a></li>
    <li><a href="#åˆ‡ç‰‡ä¸Šçš„æ•°æ®ç»“æ„">åˆ‡ç‰‡ä¸Šçš„æ•°æ®ç»“æ„</a></li>
    <li><a href="#åˆ›å»ºåˆ‡ç‰‡">åˆ›å»ºåˆ‡ç‰‡</a></li>
    <li><a href="#åˆ‡ç‰‡æ‰©å®¹">åˆ‡ç‰‡æ‰©å®¹</a></li>
    <li><a href="#åˆ‡ç‰‡æ‹·è´">åˆ‡ç‰‡æ‹·è´</a></li>
  </ul>
</nav>
    </div>
    

    <hr />

    <div class="content">
        <p>åŸæ–‡åœ°å€ï¼šhttps://halfrost.com/go_slice/</p>
<p>åˆ‡ç‰‡æ˜¯ Go ä¸­çš„ä¸€ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼Œä½¿ç”¨è¿™ç§ç»“æ„å¯ä»¥ç”¨æ¥ç®¡ç†æ•°æ®é›†åˆã€‚åˆ‡ç‰‡çš„è®¾è®¡æƒ³æ³•æ˜¯ç”±åŠ¨æ€æ•°ç»„æ¦‚å¿µè€Œæ¥ï¼Œä¸ºäº†å¼€å‘è€…å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„ä½¿ä¸€ä¸ªæ•°æ®ç»“æ„å¯ä»¥è‡ªåŠ¨å¢åŠ å’Œå‡å°‘ã€‚ä½†æ˜¯åˆ‡ç‰‡æœ¬èº«å¹¶ä¸æ˜¯åŠ¨æ€æ•°æ®æˆ–è€…æ•°ç»„æŒ‡é’ˆã€‚åˆ‡ç‰‡å¸¸è§çš„æ“ä½œæœ‰ resliceã€appendã€copyã€‚ä¸æ­¤åŒæ—¶ï¼Œåˆ‡ç‰‡è¿˜å…·æœ‰å¯ç´¢å¼•ï¼Œå¯è¿­ä»£çš„ä¼˜ç§€ç‰¹æ€§ã€‚</p>
<h1 id="åˆ‡ç‰‡å’Œæ•°ç»„">åˆ‡ç‰‡å’Œæ•°ç»„ <a href="#%e5%88%87%e7%89%87%e5%92%8c%e6%95%b0%e7%bb%84" class="anchor">ğŸ”—</a></h1><p>åœ¨ Go ä¸­ï¼Œä¸ C æ•°ç»„å˜é‡éšå¼ä½œä¸ºæŒ‡é’ˆä½¿ç”¨ä¸åŒï¼ŒGo æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œèµ‹å€¼å’Œå‡½æ•°ä¼ å‚æ“ä½œéƒ½ä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„æ•°æ®ã€‚</p>
<pre tabindex="0"><code>func main() {
	arrayA := [2]int{100, 200}
	var arrayB [2]int

	arrayB = arrayA

	fmt.Printf(&#34;arrayA : %p , %v\n&#34;, &amp;arrayA, arrayA)
	fmt.Printf(&#34;arrayB : %p , %v\n&#34;, &amp;arrayB, arrayB)

	testArray(arrayA)
}

func testArray(x [2]int) {
	fmt.Printf(&#34;func Array : %p , %v\n&#34;, &amp;x, x)
}
</code></pre><p>æ‰“å°ç»“æœï¼š</p>
<pre tabindex="0"><code>arrayA : 0xc4200bebf0 , [100 200]
arrayB : 0xc4200bec00 , [100 200]
func Array : 0xc4200bec30 , [100 200]
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸‰ä¸ªå†…å­˜åœ°å€éƒ½ä¸åŒï¼Œè¿™ä¹Ÿå°±éªŒè¯äº† Go ä¸­æ•°ç»„èµ‹å€¼å’Œå‡½æ•°ä¼ å‚éƒ½æ˜¯å€¼å¤åˆ¶çš„ã€‚é‚£è¿™ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>
<p>å‡æƒ³æ¯æ¬¡ä¼ å‚éƒ½ç”¨æ•°ç»„ï¼Œé‚£ä¹ˆæ¯æ¬¡æ•°ç»„éƒ½è¦è¢«å¤åˆ¶ä¸€éã€‚å¦‚æœæ•°ç»„å¤§å°æœ‰ 100ä¸‡ï¼Œåœ¨64ä½æœºå™¨ä¸Šå°±éœ€è¦èŠ±è´¹å¤§çº¦ 800W å­—èŠ‚ï¼Œå³ 8MB å†…å­˜ã€‚è¿™æ ·ä¼šæ¶ˆè€—æ‰å¤§é‡çš„å†…å­˜ã€‚äºæ˜¯ä¹æœ‰äººæƒ³åˆ°ï¼Œå‡½æ•°ä¼ å‚ç”¨æ•°ç»„çš„æŒ‡é’ˆã€‚</p>
<pre tabindex="0"><code>func main() {
	arrayA := []int{100, 200}
	testArrayPoint(&amp;arrayA)   // 1.ä¼ æ•°ç»„æŒ‡é’ˆ
	arrayB := arrayA[:]
	testArrayPoint(&amp;arrayB)   // 2.ä¼ åˆ‡ç‰‡
	fmt.Printf(&#34;arrayA : %p , %v\n&#34;, &amp;arrayA, arrayA)
}

func testArrayPoint(x *[]int) {
	fmt.Printf(&#34;func Array : %p , %v\n&#34;, x, *x)
	(*x)[1] += 100
}
</code></pre><p>æ‰“å°ç»“æœ:</p>
<pre tabindex="0"><code>func Array : 0xc4200b0140 , [100 200]
func Array : 0xc4200b0180 , [100 300]
arrayA : 0xc4200b0140 , [100 400]
</code></pre><p>è¿™ä¹Ÿå°±è¯æ˜äº†æ•°ç»„æŒ‡é’ˆç¡®å®åˆ°è¾¾äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚ç°åœ¨å°±ç®—æ˜¯ä¼ å…¥10äº¿çš„æ•°ç»„ï¼Œä¹Ÿåªéœ€è¦å†æ ˆä¸Šåˆ†é…ä¸€ä¸ª8ä¸ªå­—èŠ‚çš„å†…å­˜ç»™æŒ‡é’ˆå°±å¯ä»¥äº†ã€‚è¿™æ ·æ›´åŠ é«˜æ•ˆçš„åˆ©ç”¨å†…å­˜ï¼Œæ€§èƒ½ä¹Ÿæ¯”ä¹‹å‰çš„å¥½ã€‚</p>
<p>ä¸è¿‡ä¼ æŒ‡é’ˆä¼šæœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œä»æ‰“å°ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€è¡Œå’Œç¬¬ä¸‰è¡ŒæŒ‡é’ˆåœ°å€éƒ½æ˜¯åŒä¸€ä¸ªï¼Œä¸‡ä¸€åŸæ•°ç»„çš„æŒ‡é’ˆæŒ‡å‘æ›´æ”¹äº†ï¼Œé‚£ä¹ˆå‡½æ•°é‡Œé¢çš„æŒ‡é’ˆæŒ‡å‘éƒ½ä¼šè·Ÿç€æ›´æ”¹ã€‚</p>
<p>åˆ‡ç‰‡çš„ä¼˜åŠ¿ä¹Ÿå°±è¡¨ç°å‡ºæ¥äº†ã€‚ç”¨åˆ‡ç‰‡ä¼ æ•°ç»„å‚æ•°ï¼Œæ—¢å¯ä»¥è¾¾åˆ°èŠ‚çº¦å†…å­˜çš„ç›®çš„ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°åˆç†å¤„ç†å¥½å…±äº«å†…å­˜çš„é—®é¢˜ã€‚æ‰“å°ç»“æœç¬¬äºŒè¡Œå°±æ˜¯åˆ‡ç‰‡ï¼Œåˆ‡ç‰‡çš„æŒ‡é’ˆå’ŒåŸæ¥æ•°ç»„çš„æŒ‡é’ˆæ˜¯ä¸åŒçš„ã€‚</p>
<p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š</p>
<p>æŠŠç¬¬ä¸€ä¸ªå¤§æ•°ç»„ä¼ é€’ç»™å‡½æ•°ä¼šæ¶ˆè€—å¾ˆå¤šå†…å­˜ï¼Œé‡‡ç”¨åˆ‡ç‰‡çš„æ–¹å¼ä¼ å‚å¯ä»¥é¿å…ä¸Šè¿°é—®é¢˜ã€‚åˆ‡ç‰‡æ˜¯å¼•ç”¨ä¼ é€’ï¼Œæ‰€ä»¥å®ƒä»¬ä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„å†…å­˜å¹¶ä¸”æ¯”ä½¿ç”¨æ•°ç»„æ›´æœ‰æ•ˆç‡ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¾æ—§æœ‰åä¾‹ã€‚</p>
<pre tabindex="0"><code>package main

import &#34;testing&#34;

func array() [1024]int {
	var x [1024]int
	for i := 0; i &lt; len(x); i++ {
		x[i] = i
	}
	return x
}

func slice() []int {
	x := make([]int, 1024)
	for i := 0; i &lt; len(x); i++ {
		x[i] = i
	}
	return x
}

func BenchmarkArray(b *testing.B) {
	for i := 0; i &lt; b.N; i++ {
		array()
	}
}

func BenchmarkSlice(b *testing.B) {
	for i := 0; i &lt; b.N; i++ {
		slice()
	}
}
</code></pre><p>æˆ‘ä»¬åšä¸€æ¬¡æ€§èƒ½æµ‹è¯•ï¼Œå¹¶ä¸”ç¦ç”¨å†…è”å’Œä¼˜åŒ–ï¼Œæ¥è§‚å¯Ÿåˆ‡ç‰‡çš„å †ä¸Šå†…å­˜åˆ†é…çš„æƒ…å†µã€‚</p>
<pre tabindex="0"><code>  go test -bench . -benchmem -gcflags &#34;-N -l&#34;
</code></pre><p>è¾“å‡ºç»“æœæ¯”è¾ƒâ€œä»¤äººæ„å¤–â€ï¼š</p>
<pre tabindex="0"><code>BenchmarkArray-4          500000              3637 ns/op               0 B/op          0 alloc s/op
BenchmarkSlice-4          300000              4055 ns/op            8192 B/op          1 alloc s/op
</code></pre><p>è§£é‡Šä¸€ä¸‹ä¸Šè¿°ç»“æœï¼Œåœ¨æµ‹è¯• Array çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯4æ ¸ï¼Œå¾ªç¯æ¬¡æ•°æ˜¯500000ï¼Œå¹³å‡æ¯æ¬¡æ‰§è¡Œæ—¶é—´æ˜¯3637 nsï¼Œæ¯æ¬¡æ‰§è¡Œå †ä¸Šåˆ†é…å†…å­˜æ€»é‡æ˜¯0ï¼Œåˆ†é…æ¬¡æ•°ä¹Ÿæ˜¯0 ã€‚</p>
<p>è€Œåˆ‡ç‰‡çš„ç»“æœå°±â€œå·®â€ä¸€ç‚¹ï¼ŒåŒæ ·ä¹Ÿæ˜¯ç”¨çš„æ˜¯4æ ¸ï¼Œå¾ªç¯æ¬¡æ•°æ˜¯300000ï¼Œå¹³å‡æ¯æ¬¡æ‰§è¡Œæ—¶é—´æ˜¯4055 nsï¼Œä½†æ˜¯æ¯æ¬¡æ‰§è¡Œä¸€æ¬¡ï¼Œå †ä¸Šåˆ†é…å†…å­˜æ€»é‡æ˜¯8192ï¼Œåˆ†é…æ¬¡æ•°ä¹Ÿæ˜¯1 ã€‚</p>
<p>è¿™æ ·å¯¹æ¯”çœ‹æ¥ï¼Œå¹¶éæ‰€æœ‰æ—¶å€™éƒ½é€‚åˆç”¨åˆ‡ç‰‡ä»£æ›¿æ•°ç»„ï¼Œå› ä¸ºåˆ‡ç‰‡åº•å±‚æ•°ç»„å¯èƒ½ä¼šåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œè€Œä¸”å°æ•°ç»„åœ¨æ ˆä¸Šæ‹·è´çš„æ¶ˆè€—ä¹Ÿæœªå¿…æ¯” make æ¶ˆè€—å¤§ã€‚</p>
<h1 id="åˆ‡ç‰‡ä¸Šçš„æ•°æ®ç»“æ„">åˆ‡ç‰‡ä¸Šçš„æ•°æ®ç»“æ„ <a href="#%e5%88%87%e7%89%87%e4%b8%8a%e7%9a%84%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h1><p>åˆ‡ç‰‡æœ¬èº«å¹¶ä¸æ˜¯åŠ¨æ€æ•°ç»„æˆ–è€…æ•°ç»„æŒ‡é’ˆã€‚å®ƒå†…éƒ¨å®ç°çš„æ•°æ®ç»“æ„é€šè¿‡æŒ‡é’ˆå¼•ç”¨åº•å±‚æ•°ç»„ï¼Œè®¾å®šç›¸å…³å±æ€§å°†æ•°æ®è¯»å†™æ“ä½œé™å®šåœ¨æŒ‡å®šçš„åŒºåŸŸå†…ã€‚<strong>åˆ‡ç‰‡æœ¬èº«æ˜¯ä¸€ä¸ªåªè¯»å¯¹è±¡ï¼Œå…¶å·¥ä½œæœºåˆ¶ç±»ä¼¼æ•°ç»„æŒ‡é’ˆçš„ä¸€ç§å°è£…ã€‚</strong></p>
<p>åˆ‡ç‰‡ï¼ˆsliceï¼‰æ˜¯å¯¹æ•°ç»„ä¸€ä¸ªè¿ç»­ç‰‡æ®µçš„å¼•ç”¨ï¼Œæ‰€ä»¥åˆ‡ç‰‡æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼ˆå› æ­¤æ›´ç±»ä¼¼äº C/C++ ä¸­çš„æ•°ç»„ç±»å‹ï¼Œæˆ–è€… Python ä¸­çš„ list ç±»å‹ï¼‰ã€‚è¿™ä¸ªç‰‡æ®µå¯ä»¥æ˜¯æ•´ä¸ªæ•°ç»„ï¼Œæˆ–è€…æ˜¯ç”±èµ·å§‹å’Œç»ˆæ­¢ç´¢å¼•æ ‡è¯†çš„ä¸€äº›é¡¹çš„å­é›†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»ˆæ­¢ç´¢å¼•æ ‡è¯†çš„é¡¹ä¸åŒ…æ‹¬åœ¨åˆ‡ç‰‡å†…ã€‚åˆ‡ç‰‡æä¾›äº†ä¸€ä¸ªä¸æŒ‡å‘æ•°ç»„çš„åŠ¨æ€çª—å£ã€‚</p>
<p>ç»™å®šé¡¹çš„åˆ‡ç‰‡ç´¢å¼•å¯èƒ½æ¯”ç›¸å…³æ•°ç»„çš„ç›¸åŒå…ƒç´ çš„ç´¢å¼•å°ã€‚å’Œæ•°ç»„ä¸åŒçš„æ˜¯ï¼Œåˆ‡ç‰‡çš„é•¿åº¦å¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹ï¼Œæœ€å°ä¸º 0 æœ€å¤§ä¸ºç›¸å…³æ•°ç»„çš„é•¿åº¦ï¼šåˆ‡ç‰‡æ˜¯ä¸€ä¸ªé•¿åº¦å¯å˜çš„æ•°ç»„ã€‚</p>
<pre tabindex="0"><code>type slice struct {
	array unsafe.Pointer
	len   int
	cap   int
}
</code></pre><p><img src="/img/go-s1.jpeg" alt="slice_å†…å­˜æ¨¡å‹"></p>
<p>åˆ‡ç‰‡çš„ç»“æ„ä½“ç”±3éƒ¨åˆ†æ„æˆï¼ŒPointer æ˜¯æŒ‡å‘ä¸€ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼Œlen ä»£è¡¨å½“å‰åˆ‡ç‰‡çš„é•¿åº¦ï¼Œcap æ˜¯å½“å‰åˆ‡ç‰‡çš„å®¹é‡ã€‚cap æ€»æ˜¯å¤§äºç­‰äº len çš„ã€‚</p>
<p><img src="/img/go-s2.jpeg" alt="57_3.png"></p>
<p>å¦‚æœæƒ³ä» slice ä¸­å¾—åˆ°ä¸€å—å†…å­˜åœ°å€ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p>
<pre tabindex="0"><code>s := make([]byte, 200)
ptr := unsafe.Pointer(&amp;s[0])
</code></pre><p>å¦‚æœåè¿‡æ¥å‘¢ï¼Ÿä» Go çš„å†…å­˜åœ°å€ä¸­æ„é€ ä¸€ä¸ª sliceã€‚</p>
<pre tabindex="0"><code>var ptr unsafe.Pointer
var s1 = struct {
    addr uintptr
    len int
    cap int
}{ptr, length, length}
s := *(*[]byte)(unsafe.Pointer(&amp;s1))
</code></pre><p>æ„é€ ä¸€ä¸ªè™šæ‹Ÿçš„ç»“æ„ä½“ï¼ŒæŠŠ slice çš„æ•°æ®ç»“æ„æ‹¼å‡ºæ¥ã€‚</p>
<p>å½“ç„¶è¿˜æœ‰æ›´åŠ ç›´æ¥çš„æ–¹æ³•ï¼Œåœ¨ Go çš„åå°„ä¸­å°±å­˜åœ¨ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„æ•°æ®ç»“æ„ SliceHeaderï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ„é€ ä¸€ä¸ª slice</p>
<pre tabindex="0"><code>var o []byte
sliceHeader := (*reflect.SliceHeader)((unsafe.Pointer(&amp;o)))
sliceHeader.Cap = length
sliceHeader.Len = length
sliceHeader.Data = uintptr(ptr)
</code></pre><h1 id="åˆ›å»ºåˆ‡ç‰‡">åˆ›å»ºåˆ‡ç‰‡ <a href="#%e5%88%9b%e5%bb%ba%e5%88%87%e7%89%87" class="anchor">ğŸ”—</a></h1><p>make å‡½æ•°å…è®¸åœ¨è¿è¡ŒæœŸåŠ¨æ€æŒ‡å®šæ•°ç»„é•¿åº¦ï¼Œç»•å¼€äº†æ•°ç»„ç±»å‹å¿…é¡»ä½¿ç”¨ç¼–è¯‘æœŸå¸¸é‡çš„é™åˆ¶ã€‚</p>
<p>åˆ›å»ºåˆ‡ç‰‡æœ‰ä¸¤ç§å½¢å¼ï¼Œmake åˆ›å»ºåˆ‡ç‰‡ï¼Œç©ºåˆ‡ç‰‡ã€‚</p>
<h2 id="make-å’Œåˆ‡ç‰‡å­—é¢é‡">make å’Œåˆ‡ç‰‡å­—é¢é‡ <a href="#make-%e5%92%8c%e5%88%87%e7%89%87%e5%ad%97%e9%9d%a2%e9%87%8f" class="anchor">ğŸ”—</a></h2><pre tabindex="0"><code>func makeslice(et *_type, len, cap int) slice {
	// æ ¹æ®åˆ‡ç‰‡çš„æ•°æ®ç±»å‹ï¼Œè·å–åˆ‡ç‰‡çš„æœ€å¤§å®¹é‡
	maxElements := maxSliceCap(et.size)
    // æ¯”è¾ƒåˆ‡ç‰‡çš„é•¿åº¦ï¼Œé•¿åº¦å€¼åŸŸåº”è¯¥åœ¨[0,maxElements]ä¹‹é—´
	if len &lt; 0 || uintptr(len) &gt; maxElements {
		panic(errorString(&#34;makeslice: len out of range&#34;))
	}
    // æ¯”è¾ƒåˆ‡ç‰‡çš„å®¹é‡ï¼Œå®¹é‡å€¼åŸŸåº”è¯¥åœ¨[len,maxElements]ä¹‹é—´
	if cap &lt; len || uintptr(cap) &gt; maxElements {
		panic(errorString(&#34;makeslice: cap out of range&#34;))
	}
    // æ ¹æ®åˆ‡ç‰‡çš„å®¹é‡ç”³è¯·å†…å­˜
	p := mallocgc(et.size*uintptr(cap), et, true)
    // è¿”å›ç”³è¯·å¥½å†…å­˜çš„åˆ‡ç‰‡çš„é¦–åœ°å€
	return slice{p, len, cap}
}
</code></pre><p><img src="/img/go-s3.jpeg" alt=""></p>
<p>ä¸Šå›¾æ˜¯ç”¨ make å‡½æ•°åˆ›å»ºçš„ä¸€ä¸ª len = 4ï¼Œ cap = 6 çš„åˆ‡ç‰‡ã€‚å†…å­˜ç©ºé—´ç”³è¯·äº†6ä¸ª int ç±»å‹çš„å†…å­˜å¤§å°ã€‚ç”±äº len = 4ï¼Œæ‰€ä»¥åé¢2ä¸ªæš‚æ—¶è®¿é—®ä¸åˆ°ï¼Œä½†æ˜¯å®¹é‡è¿˜æ˜¯åœ¨çš„ã€‚è¿™æ—¶å€™æ•°ç»„é‡Œé¢æ¯ä¸ªå˜é‡éƒ½æ˜¯0 ã€‚</p>
<p>é™¤äº† make å‡½æ•°å¯ä»¥åˆ›å»ºåˆ‡ç‰‡ä»¥å¤–ï¼Œå­—é¢é‡ä¹Ÿå¯ä»¥åˆ›å»ºåˆ‡ç‰‡ã€‚</p>
<p><img src="/img/go-s4.jpeg" alt=""></p>
<p>è¿™é‡Œæ˜¯ç”¨å­—é¢é‡åˆ›å»ºçš„ä¸€ä¸ª len = 6ï¼Œcap = 6 çš„åˆ‡ç‰‡ï¼Œè¿™æ—¶å€™æ•°ç»„é‡Œé¢æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½åˆå§‹åŒ–å®Œæˆäº†ã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ [ ] é‡Œé¢ä¸è¦å†™æ•°ç»„çš„å®¹é‡ï¼Œå› ä¸ºå¦‚æœå†™äº†ä¸ªæ•°ä»¥åå°±æ˜¯æ•°ç»„äº†ï¼Œè€Œä¸æ˜¯åˆ‡ç‰‡äº†ã€‚</strong></p>
<p><img src="/img/go-s5.jpeg" alt=""></p>
<p>è¿˜æœ‰ä¸€ç§ç®€å•çš„å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡çš„æ–¹æ³•ã€‚å¦‚ä¸Šå›¾ã€‚ä¸Šå›¾å°± Slice A åˆ›å»ºå‡ºäº†ä¸€ä¸ª len = 3ï¼Œcap = 3 çš„åˆ‡ç‰‡ã€‚ä»åŸæ•°ç»„çš„ç¬¬äºŒä½å…ƒç´ (0æ˜¯ç¬¬ä¸€ä½)å¼€å§‹åˆ‡ï¼Œä¸€ç›´åˆ‡åˆ°ç¬¬å››ä½ä¸ºæ­¢(ä¸åŒ…æ‹¬ç¬¬äº”ä½)ã€‚åŒç†ï¼ŒSlice B åˆ›å»ºå‡ºäº†ä¸€ä¸ª len = 2ï¼Œcap = 4 çš„åˆ‡ç‰‡ã€‚</p>
<h2 id="nil-å’Œç©ºåˆ‡ç‰‡">nil å’Œç©ºåˆ‡ç‰‡ <a href="#nil-%e5%92%8c%e7%a9%ba%e5%88%87%e7%89%87" class="anchor">ğŸ”—</a></h2><p>nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡ä¹Ÿæ˜¯å¸¸ç”¨çš„ã€‚</p>
<pre tabindex="0"><code>var slice []int
</code></pre><p><img src="/img/go-s6.jpeg" alt=""></p>
<p>nil åˆ‡ç‰‡è¢«ç”¨åœ¨å¾ˆå¤šæ ‡å‡†åº“å’Œå†…ç½®å‡½æ•°ä¸­ï¼Œæè¿°ä¸€ä¸ªä¸å­˜åœ¨çš„åˆ‡ç‰‡çš„æ—¶å€™ï¼Œå°±éœ€è¦ç”¨åˆ° nil åˆ‡ç‰‡ã€‚æ¯”å¦‚å‡½æ•°åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œè¿”å›çš„åˆ‡ç‰‡å°±æ˜¯ nil åˆ‡ç‰‡ã€‚nil åˆ‡ç‰‡çš„æŒ‡é’ˆæŒ‡å‘ nilã€‚</p>
<p>ç©ºåˆ‡ç‰‡ä¸€èˆ¬ä¼šç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç©ºçš„é›†åˆã€‚æ¯”å¦‚æ•°æ®åº“æŸ¥è¯¢ï¼Œä¸€æ¡ç»“æœä¹Ÿæ²¡æœ‰æŸ¥åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿”å›ä¸€ä¸ªç©ºåˆ‡ç‰‡ã€‚</p>
<pre tabindex="0"><code>silce := make( []int , 0 )
slice := []int{ }
</code></pre><p><img src="/img/go-s7.jpeg" alt=""></p>
<p>ç©ºåˆ‡ç‰‡å’Œ nil åˆ‡ç‰‡çš„åŒºåˆ«åœ¨äºï¼Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸æ˜¯nilï¼ŒæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰åˆ†é…ä»»ä½•å†…å­˜ç©ºé—´ï¼Œå³åº•å±‚å…ƒç´ åŒ…å«0ä¸ªå…ƒç´ ã€‚</p>
<p>æœ€åéœ€è¦è¯´æ˜çš„ä¸€ç‚¹æ˜¯ã€‚ä¸ç®¡æ˜¯ä½¿ç”¨ nil åˆ‡ç‰‡è¿˜æ˜¯ç©ºåˆ‡ç‰‡ï¼Œå¯¹å…¶è°ƒç”¨å†…ç½®å‡½æ•° appendï¼Œlen å’Œ cap çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<h1 id="åˆ‡ç‰‡æ‰©å®¹">åˆ‡ç‰‡æ‰©å®¹ <a href="#%e5%88%87%e7%89%87%e6%89%a9%e5%ae%b9" class="anchor">ğŸ”—</a></h1><p>é¦–å…ˆçœ‹çœ‹æºç </p>
<pre tabindex="0"><code>func growslice(et *_type, old slice, cap int) slice {
	if raceenabled {
		callerpc := getcallerpc(unsafe.Pointer(&amp;et))
		racereadrangepc(old.array, uintptr(old.len*int(et.size)), callerpc, funcPC(growslice))
	}
	if msanenabled {
		msanread(old.array, uintptr(old.len*int(et.size)))
	}

	if et.size == 0 {
		// å¦‚æœæ–°è¦æ‰©å®¹çš„å®¹é‡æ¯”åŸæ¥çš„å®¹é‡è¿˜è¦å°ï¼Œè¿™ä»£è¡¨è¦ç¼©å®¹äº†ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥æŠ¥panicäº†ã€‚
		if cap &lt; old.cap {
			panic(errorString(&#34;growslice: cap out of range&#34;))
		}

		// å¦‚æœå½“å‰åˆ‡ç‰‡çš„å¤§å°ä¸º0ï¼Œè¿˜è°ƒç”¨äº†æ‰©å®¹æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„å®¹é‡çš„åˆ‡ç‰‡è¿”å›ã€‚
		return slice{unsafe.Pointer(&amp;zerobase), old.len, cap}
	}

    // è¿™é‡Œå°±æ˜¯æ‰©å®¹çš„ç­–ç•¥
	newcap := old.cap
	doublecap := newcap + newcap
	if cap &gt; doublecap {
		newcap = cap
	} else {
		if old.len &lt; 1024 {
			newcap = doublecap
		} else {
			// Check 0 &lt; newcap to detect overflow
			// and prevent an infinite loop.
			for 0 &lt; newcap &amp;&amp; newcap &lt; cap {
				newcap += newcap / 4
			}
			// Set newcap to the requested cap when
			// the newcap calculation overflowed.
			if newcap &lt;= 0 {
				newcap = cap
			}
		}
	}

	// è®¡ç®—æ–°çš„åˆ‡ç‰‡çš„å®¹é‡ï¼Œé•¿åº¦ã€‚
	var lenmem, newlenmem, capmem uintptr
	const ptrSize = unsafe.Sizeof((*byte)(nil))
	switch et.size {
	case 1:
		lenmem = uintptr(old.len)
		newlenmem = uintptr(cap)
		capmem = roundupsize(uintptr(newcap))
		newcap = int(capmem)
	case ptrSize:
		lenmem = uintptr(old.len) * ptrSize
		newlenmem = uintptr(cap) * ptrSize
		capmem = roundupsize(uintptr(newcap) * ptrSize)
		newcap = int(capmem / ptrSize)
	default:
		lenmem = uintptr(old.len) * et.size
		newlenmem = uintptr(cap) * et.size
		capmem = roundupsize(uintptr(newcap) * et.size)
		newcap = int(capmem / et.size)
	}

	// åˆ¤æ–­éæ³•çš„å€¼ï¼Œä¿è¯å®¹é‡æ˜¯åœ¨å¢åŠ ï¼Œå¹¶ä¸”å®¹é‡ä¸è¶…è¿‡æœ€å¤§å®¹é‡
	if cap &lt; old.cap || uintptr(newcap) &gt; maxSliceCap(et.size) {
		panic(errorString(&#34;growslice: cap out of range&#34;))
	}

	var p unsafe.Pointer
	if et.kind&amp;kindNoPointers != 0 {
		// åœ¨è€çš„åˆ‡ç‰‡åé¢ç»§ç»­æ‰©å……å®¹é‡
		p = mallocgc(capmem, nil, false)
		// å°† lenmem è¿™ä¸ªå¤šä¸ª bytes ä» old.arrayåœ°å€ æ‹·è´åˆ° p çš„åœ°å€å¤„
		memmove(p, old.array, lenmem)
		// å…ˆå°† P åœ°å€åŠ ä¸Šæ–°çš„å®¹é‡å¾—åˆ°æ–°åˆ‡ç‰‡å®¹é‡çš„åœ°å€ï¼Œç„¶åå°†æ–°åˆ‡ç‰‡å®¹é‡åœ°å€åé¢çš„ capmem-newlenmem ä¸ª bytes è¿™å—å†…å­˜åˆå§‹åŒ–ã€‚ä¸ºä¹‹åç»§ç»­ append() æ“ä½œè…¾å‡ºç©ºé—´ã€‚
		memclrNoHeapPointers(add(p, newlenmem), capmem-newlenmem)
	} else {
		// é‡æ–°ç”³è¯·æ–°çš„æ•°ç»„ç»™æ–°åˆ‡ç‰‡
		// é‡æ–°ç”³è¯· capmen è¿™ä¸ªå¤§çš„å†…å­˜åœ°å€ï¼Œå¹¶ä¸”åˆå§‹åŒ–ä¸º0å€¼
		p = mallocgc(capmem, et, true)
		if !writeBarrier.enabled {
			// å¦‚æœè¿˜ä¸èƒ½æ‰“å¼€å†™é”ï¼Œé‚£ä¹ˆåªèƒ½æŠŠ lenmem å¤§å°çš„ bytes å­—èŠ‚ä» old.array æ‹·è´åˆ° p çš„åœ°å€å¤„
			memmove(p, old.array, lenmem)
		} else {
			// å¾ªç¯æ‹·è´è€çš„åˆ‡ç‰‡çš„å€¼
			for i := uintptr(0); i &lt; lenmem; i += et.size {
				typedmemmove(et, add(p, i), add(old.array, i))
			}
		}
	}
	// è¿”å›æœ€ç»ˆæ–°åˆ‡ç‰‡ï¼Œå®¹é‡æ›´æ–°ä¸ºæœ€æ–°æ‰©å®¹ä¹‹åçš„å®¹é‡
	return slice{p, old.len, newcap}
}
</code></pre><h2 id="æ‰©å®¹ç­–ç•¥">æ‰©å®¹ç­–ç•¥ <a href="#%e6%89%a9%e5%ae%b9%e7%ad%96%e7%95%a5" class="anchor">ğŸ”—</a></h2><pre tabindex="0"><code>func main() {
	slice := []int{10, 20, 30, 40}
	newSlice := append(slice, 50)
	fmt.Printf(&#34;Before slice = %v, Pointer = %p, len = %d, cap = %d\n&#34;, slice, &amp;slice, len(slice), cap(slice))
	fmt.Printf(&#34;Before newSlice = %v, Pointer = %p, len = %d, cap = %d\n&#34;, newSlice, &amp;newSlice, len(newSlice), cap(newSlice))
	newSlice[1] += 10
	fmt.Printf(&#34;After slice = %v, Pointer = %p, len = %d, cap = %d\n&#34;, slice, &amp;slice, len(slice), cap(slice))
	fmt.Printf(&#34;After newSlice = %v, Pointer = %p, len = %d, cap = %d\n&#34;, newSlice, &amp;newSlice, len(newSlice), cap(newSlice))
}
//è¾“å‡ºç»“æœ
Before slice = [10 20 30 40], Pointer = 0xc4200b0140, len = 4, cap = 4
Before newSlice = [10 20 30 40 50], Pointer = 0xc4200b0180, len = 5, cap = 8
After slice = [10 20 30 40], Pointer = 0xc4200b0140, len = 4, cap = 4
After newSlice = [10 30 30 40 50], Pointer = 0xc4200b0180, len = 5, cap = 8
</code></pre><p>ç”¨å›¾è¡¨ç¤º</p>
<p><img src="/img/go-s8.jpeg" alt=""></p>
<p>ä»å›¾ä¸Šæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹å‡ºï¼Œæ–°çš„åˆ‡ç‰‡å’Œä¹‹å‰çš„åˆ‡ç‰‡å·²ç»ä¸åŒäº†ï¼Œå› ä¸ºæ–°çš„åˆ‡ç‰‡æ›´æ”¹äº†ä¸€ä¸ªå€¼ï¼Œå¹¶æ²¡æœ‰å½±å“åˆ°åŸæ¥çš„æ•°ç»„ï¼Œæ–°åˆ‡ç‰‡æŒ‡å‘çš„æ•°ç»„æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ•°ç»„ã€‚å¹¶ä¸” cap å®¹é‡ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚è¿™ä¹‹é—´ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>Go ä¸­åˆ‡ç‰‡æ‰©å®¹çš„ç­–ç•¥æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>é¦–å…ˆåˆ¤æ–­ï¼Œå¦‚æœæ–°ç”³è¯·å®¹é‡ï¼ˆcapï¼‰å¤§äº2å€çš„æ—§å®¹é‡ï¼ˆold.capï¼‰ï¼Œæœ€ç»ˆå®¹é‡ï¼ˆnewcapï¼‰å°±æ˜¯æ–°ç”³è¯·çš„å®¹é‡ï¼ˆcapï¼‰</li>
<li>å¦åˆ™åˆ¤æ–­ï¼Œå¦‚æœæ—§åˆ‡ç‰‡çš„é•¿åº¦å°äº1024ï¼Œåˆ™æœ€ç»ˆå®¹é‡(newcap)å°±æ˜¯æ—§å®¹é‡(old.cap)çš„ä¸¤å€ï¼Œå³ï¼ˆnewcap=doublecapï¼‰</li>
<li>å¦åˆ™åˆ¤æ–­ï¼Œå¦‚æœæ—§åˆ‡ç‰‡é•¿åº¦å¤§äºç­‰äº1024ï¼Œåˆ™æœ€ç»ˆå®¹é‡ï¼ˆnewcapï¼‰ä»æ—§å®¹é‡ï¼ˆold.capï¼‰å¼€å§‹å¾ªç¯å¢åŠ åŸæ¥çš„ 1/4ï¼Œå³ï¼ˆnewcap=old.cap,for {newcap += newcap/4}ï¼‰ç›´åˆ°æœ€ç»ˆå®¹é‡ï¼ˆnewcapï¼‰å¤§äºç­‰äºæ–°ç”³è¯·çš„å®¹é‡(cap)ï¼Œå³ï¼ˆnewcap &gt;= capï¼‰</li>
<li>å¦‚æœæœ€ç»ˆå®¹é‡ï¼ˆcapï¼‰è®¡ç®—å€¼æº¢å‡ºï¼Œåˆ™æœ€ç»ˆå®¹é‡ï¼ˆcapï¼‰å°±æ˜¯æ–°ç”³è¯·å®¹é‡ï¼ˆcapï¼‰</li>
</ul>
<p><strong>æ³¨æ„ï¼šæ‰©å®¹æ‰©å¤§çš„å®¹é‡éƒ½æ˜¯é’ˆå¯¹åŸæ¥çš„å®¹é‡è€Œè¨€çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹åŸæ¥æ•°ç»„çš„é•¿åº¦è€Œè¨€çš„ã€‚</strong></p>
<h2 id="æ–°æ•°ç»„-or-è€æ•°ç»„-">æ–°æ•°ç»„ or è€æ•°ç»„ ï¼Ÿ <a href="#%e6%96%b0%e6%95%b0%e7%bb%84-or-%e8%80%81%e6%95%b0%e7%bb%84-" class="anchor">ğŸ”—</a></h2><p>å†è°ˆè°ˆæ‰©å®¹ä¹‹åçš„æ•°ç»„ä¸€å®šæ˜¯æ–°çš„ä¹ˆï¼Ÿè¿™ä¸ªä¸ä¸€å®šï¼Œåˆ†ä¸¤ç§æƒ…å†µã€‚</p>
<p>æƒ…å†µä¸€ï¼š</p>
<pre tabindex="0"><code>func main() {
	array := [4]int{10, 20, 30, 40}
	slice := array[0:2]
	newSlice := append(slice, 50)
	fmt.Printf(&#34;Before slice = %v, Pointer = %p, len = %d, cap = %d\n&#34;, slice, &amp;slice, len(slice), cap(slice))
	fmt.Printf(&#34;Before newSlice = %v, Pointer = %p, len = %d, cap = %d\n&#34;, newSlice, &amp;newSlice, len(newSlice), cap(newSlice))
	newSlice[1] += 10
	fmt.Printf(&#34;After slice = %v, Pointer = %p, len = %d, cap = %d\n&#34;, slice, &amp;slice, len(slice), cap(slice))
	fmt.Printf(&#34;After newSlice = %v, Pointer = %p, len = %d, cap = %d\n&#34;, newSlice, &amp;newSlice, len(newSlice), cap(newSlice))
	fmt.Printf(&#34;After array = %v\n&#34;, array)
}

//è¾“å‡º
Before slice = [10 20], Pointer = 0xc4200c0040, len = 2, cap = 4
Before newSlice = [10 20 50], Pointer = 0xc4200c0060, len = 3, cap = 4
After slice = [10 30], Pointer = 0xc4200c0040, len = 2, cap = 4
After newSlice = [10 30 50], Pointer = 0xc4200c0060, len = 3, cap = 4
After array = [10 30 50 40]
</code></pre><p>æŠŠä¸Šè¿°è¿‡ç¨‹ç”¨å›¾è¡¨ç¤ºå‡ºæ¥ï¼Œå¦‚ä¸‹å›¾ã€‚
<img src="/img/go-s9.jpeg" alt=""></p>
<p>é€šè¿‡æ‰“å°çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å®¹ä»¥åå¹¶æ²¡æœ‰æ–°å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæ‰©å®¹å‰åçš„æ•°ç»„éƒ½æ˜¯åŒä¸€ä¸ªï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†æ–°çš„åˆ‡ç‰‡ä¿®æ”¹äº†ä¸€ä¸ªå€¼ï¼Œä¹Ÿå½±å“åˆ°äº†è€çš„åˆ‡ç‰‡äº†ã€‚å¹¶ä¸” append() æ“ä½œä¹Ÿæ”¹å˜äº†åŸæ¥æ•°ç»„é‡Œé¢çš„å€¼ã€‚ä¸€ä¸ª append() æ“ä½œå½±å“äº†è¿™ä¹ˆå¤šåœ°æ–¹ï¼Œå¦‚æœåŸæ•°ç»„ä¸Šæœ‰å¤šä¸ªåˆ‡ç‰‡ï¼Œé‚£ä¹ˆè¿™äº›åˆ‡ç‰‡éƒ½ä¼šè¢«å½±å“ï¼æ— æ„é—´å°±äº§ç”Ÿäº†è«åçš„ bugï¼</p>
<p>è¿™ç§æƒ…å†µï¼Œç”±äºåŸæ•°ç»„è¿˜æœ‰å®¹é‡å¯ä»¥æ‰©å®¹ï¼Œæ‰€ä»¥æ‰§è¡Œ append() æ“ä½œä»¥åï¼Œä¼šåœ¨åŸæ•°ç»„ä¸Šç›´æ¥æ“ä½œï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å®¹ä»¥åçš„æ•°ç»„è¿˜æ˜¯æŒ‡å‘åŸæ¥çš„æ•°ç»„ã€‚</p>
<p>è¿™ç§æƒ…å†µä¹Ÿæå®¹æ˜“å‡ºç°åœ¨å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡æ—¶å€™ï¼Œç¬¬ä¸‰ä¸ªå‚æ•° cap ä¼ å€¼çš„æ—¶å€™ï¼Œå¦‚æœç”¨å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡ï¼Œcap å¹¶ä¸ç­‰äºæŒ‡å‘æ•°ç»„çš„æ€»å®¹é‡ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µå°±ä¼šå‘ç”Ÿã€‚</p>
<pre tabindex="0"><code>slice := array[1:2:3]
</code></pre><p><strong>ä¸Šé¢è¿™ç§æƒ…å†µéå¸¸å±é™©ï¼Œæåº¦å®¹æ˜“äº§ç”Ÿ bug ã€‚</strong>
å»ºè®®ç”¨å­—é¢é‡åˆ›å»ºåˆ‡ç‰‡çš„æ—¶å€™ï¼Œcap çš„å€¼ä¸€å®šè¦ä¿æŒæ¸…é†’ï¼Œé¿å…å…±äº«åŸæ•°ç»„å¯¼è‡´çš„ bugã€‚</p>
<p>æƒ…å†µäºŒï¼š</p>
<p>æƒ…å†µäºŒå…¶å®å°±æ˜¯åœ¨æ‰©å®¹ç­–ç•¥é‡Œé¢ä¸¾çš„ä¾‹å­ï¼Œåœ¨é‚£ä¸ªä¾‹å­ä¸­ä¹‹æ‰€ä»¥ç”Ÿæˆäº†æ–°çš„åˆ‡ç‰‡ï¼Œæ˜¯å› ä¸ºåŸæ¥æ•°ç»„çš„å®¹é‡å·²ç»è¾¾åˆ°äº†æœ€å¤§å€¼ï¼Œå†æƒ³æ‰©å®¹ï¼Œ Go é»˜è®¤ä¼šå…ˆå¼€ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼ŒæŠŠåŸæ¥çš„å€¼æ‹·è´è¿‡æ¥ï¼Œç„¶åå†æ‰§è¡Œ append() æ“ä½œã€‚è¿™ç§æƒ…å†µä¸æ¯«ä¸å½±å“åŸæ•°ç»„ã€‚</p>
<p>æ‰€ä»¥å»ºè®®å°½é‡é¿å…æƒ…å†µä¸€ï¼Œå°½é‡ä½¿ç”¨æƒ…å†µäºŒï¼Œé¿å… bug äº§ç”Ÿã€‚
ä¸¾ä¾‹ï¼š</p>
<pre tabindex="0"><code>func main() {

    s1 := []int{1, 2, 3}
    s2 := s1[1:]
    s2[1] = 4
    fmt.Println(s1)
    s2 = append(s2, 5, 6, 7)
    fmt.Println(s1)
}
//output 
[1 2 4]
[1 2 4]
</code></pre><h1 id="åˆ‡ç‰‡æ‹·è´">åˆ‡ç‰‡æ‹·è´ <a href="#%e5%88%87%e7%89%87%e6%8b%b7%e8%b4%9d" class="anchor">ğŸ”—</a></h1><p>Slice ä¸­æ‹·è´æ–¹æ³•æœ‰2ä¸ªã€‚</p>
<pre tabindex="0"><code>func slicecopy(to, fm slice, width uintptr) int {
	// å¦‚æœæºåˆ‡ç‰‡æˆ–è€…ç›®æ ‡åˆ‡ç‰‡æœ‰ä¸€ä¸ªé•¿åº¦ä¸º0ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦æ‹·è´ï¼Œç›´æ¥ return 
	if fm.len == 0 || to.len == 0 {
		return 0
	}
	// n è®°å½•ä¸‹æºåˆ‡ç‰‡æˆ–è€…ç›®æ ‡åˆ‡ç‰‡è¾ƒçŸ­çš„é‚£ä¸€ä¸ªçš„é•¿åº¦
	n := fm.len
	if to.len &lt; n {
		n = to.len
	}
	// å¦‚æœå…¥å‚ width = 0ï¼Œä¹Ÿä¸éœ€è¦æ‹·è´äº†ï¼Œè¿”å›è¾ƒçŸ­çš„åˆ‡ç‰‡çš„é•¿åº¦
	if width == 0 {
		return n
	}
	// å¦‚æœå¼€å¯äº†ç«äº‰æ£€æµ‹
	if raceenabled {
		callerpc := getcallerpc(unsafe.Pointer(&amp;to))
		pc := funcPC(slicecopy)
		racewriterangepc(to.array, uintptr(n*int(width)), callerpc, pc)
		racereadrangepc(fm.array, uintptr(n*int(width)), callerpc, pc)
	}
	// å¦‚æœå¼€å¯äº† The memory sanitizer (msan)
	if msanenabled {
		msanwrite(to.array, uintptr(n*int(width)))
		msanread(fm.array, uintptr(n*int(width)))
	}

	size := uintptr(n) * width
	if size == 1 { 
		// TODO: is this still worth it with new memmove impl?
		// å¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆæŒ‡é’ˆç›´æ¥è½¬æ¢å³å¯
		*(*byte)(to.array) = *(*byte)(fm.array) // known to be a byte pointer
	} else {
		// å¦‚æœä¸æ­¢ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå°±æŠŠ size ä¸ª bytes ä» fm.array åœ°å€å¼€å§‹ï¼Œæ‹·è´åˆ° to.array åœ°å€ä¹‹å
		memmove(to.array, fm.array, size)
	}
	return n
}
</code></pre><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œslicecopy æ–¹æ³•ä¼šæŠŠæºåˆ‡ç‰‡å€¼(å³ fm Slice )ä¸­çš„å…ƒç´ å¤åˆ¶åˆ°ç›®æ ‡åˆ‡ç‰‡(å³ to Slice )ä¸­ï¼Œå¹¶è¿”å›è¢«å¤åˆ¶çš„å…ƒç´ ä¸ªæ•°ï¼Œcopy çš„ä¸¤ä¸ªç±»å‹å¿…é¡»ä¸€è‡´ã€‚slicecopy æ–¹æ³•æœ€ç»ˆçš„å¤åˆ¶ç»“æœå–å†³äºè¾ƒçŸ­çš„é‚£ä¸ªåˆ‡ç‰‡ï¼Œå½“è¾ƒçŸ­çš„åˆ‡ç‰‡å¤åˆ¶å®Œæˆï¼Œæ•´ä¸ªå¤åˆ¶è¿‡ç¨‹å°±å…¨éƒ¨å®Œæˆäº†ã€‚
<img src="/img/go-s10.jpeg" alt=""></p>
<p>è¯´åˆ°æ‹·è´ï¼Œåˆ‡ç‰‡ä¸­æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚</p>
<pre tabindex="0"><code>func main() {
	slice := []int{10, 20, 30, 40}
	for index, value := range slice {
		fmt.Printf(&#34;value = %d , value-addr = %x , slice-addr = %x\n&#34;, value, &amp;value, &amp;slice[index])
	}
}
//è¾“å‡º
value = 10 , value-addr = c4200aedf8 , slice-addr = c4200b0320
value = 20 , value-addr = c4200aedf8 , slice-addr = c4200b0328
value = 30 , value-addr = c4200aedf8 , slice-addr = c4200b0330
value = 40 , value-addr = c4200aedf8 , slice-addr = c4200b0338
</code></pre><p><img src="/img/go-s11.jpeg" alt=""></p>
<p>ç”±äº Value æ˜¯å€¼æ‹·è´çš„ï¼Œå¹¶éå¼•ç”¨ä¼ é€’ï¼Œæ‰€ä»¥ç›´æ¥æ”¹ Value æ˜¯è¾¾ä¸åˆ°æ›´æ”¹åŸåˆ‡ç‰‡å€¼çš„ç›®çš„çš„ï¼Œéœ€è¦é€šè¿‡ &amp;slice[index] è·å–çœŸå®çš„åœ°å€ã€‚</p>

    </div>

    
</section>


            </div>
            <div class="side">
                <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/ai">ai(3)</a>
            </li>
        
            <li>
                <a href="/categories/go">go(23)</a>
            </li>
        
            <li>
                <a href="/categories/%E4%BB%A3%E7%A0%81">ä»£ç (2)</a>
            </li>
        
            <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7">å·¥å…·(8)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%80%86%E5%90%91">é€†å‘(3)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%9D%A2%E8%AF%95">é¢è¯•(5)</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/note/">Recent Note</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/">åœºæ™¯æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿çš„è§£å†³æ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/">å•çº¿ç¨‹çš„redisä¸ºä»€ä¹ˆå¿«</a>
            </li>
        
            <li>
                <a href="/note/redis-%E6%80%BB%E7%BB%93/">redisæ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/mysql-%E6%80%BB%E7%BB%93/">mysqlæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/android/">Recent Android</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/android/redroid%E4%BD%BF%E7%94%A8/">Redroidå®‰å“å®¹å™¨</a>
            </li>
        
            <li>
                <a href="/android/%E5%85%A5%E9%97%A8/">é€†å‘ç¯å¢ƒ-æ‚</a>
            </li>
        
            <li>
                <a href="/android/frida%E6%95%99%E7%A8%8B/">fridaæ•™ç¨‹</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/tool/">Recent Tool</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tool/linux-almalinux%E4%BC%98%E5%8C%96/">AlmaLinux10</a>
            </li>
        
            <li>
                <a href="/tool/almalinux-k8s/">AlmaLinux-k8så®‰è£…</a>
            </li>
        
            <li>
                <a href="/tool/vscode%E6%8A%98%E8%85%BE/">vscodeæŠ˜è…¾</a>
            </li>
        
            <li>
                <a href="/tool/linux-ubuntu%E4%BC%98%E5%8C%96/">Ubuntuå¼€æœºä¼˜åŒ–</a>
            </li>
        
            <li>
                <a href="/tool/shell-ssh_script/">sshå¸¸ç”¨è„šæœ¬</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/llm/">Recent Llm</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/">Transformers-å…¥é—¨ç¯‡</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/">AIæ¨¡å‹VLLMéƒ¨ç½²</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">AIæ¨¡å‹å¾®è°ƒ</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/go/">Recent Go</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/">Goä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/">Goä¸­makeä¸newåŒºåˆ«</a>
            </li>
        
            <li>
                <a href="/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/go/grpc%E6%80%BB%E7%BB%93/">GRPCç¬”è®°</a>
            </li>
        
            <li>
                <a href="/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/">Goçš„deferæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
            </div>
        </main>
        <footer class="footer">
    <div class="footer-row">
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/note/index.xml">
                    Feed of Note
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/android/index.xml">
                    Feed of Android
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/tool/index.xml">
                    Feed of Tool
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/llm/index.xml">
                    Feed of Llm
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/go/index.xml">
                    Feed of Go
                    <i class="icofont-rss"></i>
                </a>
            
        

        
            
            
        
    </div>

    
</footer>

    </body>
</html>
