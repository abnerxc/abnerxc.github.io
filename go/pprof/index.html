<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">




<title>Goçš„pprofä½¿ç”¨æŠ€å·§ | Abnerçš„åšå®¢</title>
<link rel="canonical" href="https://abnerxc.github.io/go/pprof/">
<meta property="og:type" content="article" />
<meta property="og:title" content="Goçš„pprofä½¿ç”¨æŠ€å·§ | Abnerçš„åšå®¢" />
<meta property="og:url" content="https://abnerxc.github.io/go/pprof/" />








<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/custom.css" />
<script src="/js/copy-code-block.js"></script>
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    </head>

    <body>
        <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://abnerxc.github.io/">Abnerçš„åšå®¢</a>

        <nav class="menu">
            
        </nav>
    </div>
</header>

        <main class="main-wrapper">
            <div class="main">
                

<section class="single">
    <h1 class="title">Goçš„pprofä½¿ç”¨æŠ€å·§</h1>

    <div class="tip">
        <time datetime="2019-01-15 18:35:11 &#43;0800 CST">2019/01/15</time>
        <span class="split">Â·</span>
        <span> 238 words </span>
        <span class="split">Â·</span>
        <span>
            2 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/go">Go</a>
            
        </div>
        

        
    </div>

    
    
    <div class="post-toc">
        <h3>ç›®å½•</h3>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#1å®‰è£…æ˜“ç”¨çš„pprof">1.å®‰è£…æ˜“ç”¨çš„pprof</a></li>
    <li><a href="#2å®‰è£…graphviz">2.å®‰è£…graphviz</a></li>
    <li><a href="#3ä¿®æ”¹mainå‡½æ•°">3.ä¿®æ”¹mainå‡½æ•°</a></li>
    <li><a href="#4ç¼–è¯‘è¿è¡Œä½ çš„å‡½æ•°">4.ç¼–è¯‘è¿è¡Œä½ çš„å‡½æ•°</a></li>
    <li><a href="#5å¯è§†åŒ–prof">5.å¯è§†åŒ–prof</a></li>
    <li><a href="#6è·å–å†…å­˜ppfo">6.è·å–å†…å­˜ppfo</a></li>
  </ul>
</nav>
    </div>
    

    <hr />

    <div class="content">
        <h1 id="1å®‰è£…æ˜“ç”¨çš„pprof">1.å®‰è£…æ˜“ç”¨çš„pprof <a href="#1%e5%ae%89%e8%a3%85%e6%98%93%e7%94%a8%e7%9a%84pprof" class="anchor">ğŸ”—</a></h1><p>golangè‡ªå¸¦çš„profåŒ…æ˜¯runtime/pprofï¼Œè¿™ä¸ªæ˜¯ä½çº§åˆ«çš„ï¼Œéœ€è¦ä½ æ‰‹åŠ¨åšä¸€äº›è®¾ç½®ç­‰ç­‰å‘¨è¾¹å·¥ä½œï¼Œä¸åˆ©äºæˆ‘ä»¬å¿«é€Ÿä¸Šæ‰‹ï¼Œåˆ©ç”¨pprofå¸®åŠ©æˆ‘ä»¬è§£å†³å®é™…çš„é—®é¢˜ã€‚è¿™é‡Œæ¨èdavecheneyå°è£…çš„pprofï¼Œå®ƒå¯ä»¥1è¡Œä»£ç ï¼Œè®©ä½ ç”¨ä¸Špprofï¼Œä¸“å¿ƒè§£å†³è‡ªå·±çš„ä»£ç é—®é¢˜ï¼Œä¸‹è½½ï¼š</p>
<pre tabindex="0"><code>go get github.com/pkg/profile
</code></pre><h1 id="2å®‰è£…graphviz">2.å®‰è£…graphviz <a href="#2%e5%ae%89%e8%a3%85graphviz" class="anchor">ğŸ”—</a></h1><p>pprofç”Ÿæˆçš„profæ–‡ä»¶æ—¶äºŒè¿›åˆ¶çš„ï¼Œéœ€è¦æŠŠè¿™ä¸ªäºŒè¿›åˆ¶çš„æ–‡ä»¶è½¬æ¢ä¸ºæˆ‘ä»¬äººç±»å¯è¯»çš„ï¼Œgraphvizå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠäºŒè¿›åˆ¶çš„profæ–‡ä»¶è½¬æ¢ä¸ºå›¾åƒã€‚Macå®‰è£…ï¼š</p>
<pre tabindex="0"><code>brew install graphviz
</code></pre><h1 id="3ä¿®æ”¹mainå‡½æ•°">3.ä¿®æ”¹mainå‡½æ•° <a href="#3%e4%bf%ae%e6%94%b9main%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—</a></h1><p>åªéœ€è¦ä¸ºhi.goå¢åŠ è¿™ä¸€è¡Œï¼Œdefer profile.Start().Stop()ï¼Œç¨‹åºè¿è¡Œæ—¶ï¼Œé»˜è®¤å°±ä¼šè®°å½•cpuæ•°æ®</p>
<h1 id="4ç¼–è¯‘è¿è¡Œä½ çš„å‡½æ•°">4.ç¼–è¯‘è¿è¡Œä½ çš„å‡½æ•° <a href="#4%e7%bc%96%e8%af%91%e8%bf%90%e8%a1%8c%e4%bd%a0%e7%9a%84%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—</a></h1><pre tabindex="0"><code>package main

import (
	&#34;fmt&#34;
	&#34;github.com/pkg/profile&#34;
)

func main() {
	defer profile.Start().Stop()
	sl:=makeSlice()
	fmt.Printf(&#34;sum=%d\n&#34;,sumSlice(sl))
}

func makeSlice() []int {
	sl := make([]int, 10000000)
	for idx := range sl {
		sl[idx] = idx
	}
	return sl
}

func sumSlice(sl []int) int {
	sum := 0
	for _, x := range sl {
		sum += x
	}
	return sum
}
</code></pre><p>è¿è¡Œä»£ç </p>
<pre tabindex="0"><code>go build hi.go
./hi
</code></pre><p>åº”å½“çœ‹åˆ°ç±»ä¼¼çš„ç»“æœï¼Œå®ƒè¾“å‡ºäº†ç”Ÿæˆçš„cpu.pprofçš„è·¯å¾„ï¼š</p>
<pre tabindex="0"><code>2019/02/26 23:24:22 profile: cpu profiling enabled, /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile152894194/cpu.pprof  
sum=49999995000000  
2019/02/26 23:24:22 profile: cpu profiling disabled, /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile152894194/cpu.pprof  
</code></pre><h1 id="5å¯è§†åŒ–prof">5.å¯è§†åŒ–prof <a href="#5%e5%8f%af%e8%a7%86%e5%8c%96prof" class="anchor">ğŸ”—</a></h1><p>å¯è§†åŒ–æœ‰å¤šç§æ–¹å¼ï¼Œå¯ä»¥è½¬æ¢ä¸ºtextã€pdfã€svgç­‰ç­‰ã€‚textå‘½ä»¤æ˜¯</p>
<pre tabindex="0"><code>go tool pprof --text /path/to/yourbinary /var/path/to/cpu.pprof
</code></pre><pre tabindex="0"><code>go tool pprof --text ./hi /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile626723859/cpu.pprof
File: hi
Type: cpu
Time: Feb 26, 2019 at 11:29pm (CST)
Duration: 203.53ms, Total samples = 100ms (49.13%)
Showing nodes accounting for 100ms, 100% of 100ms total
      flat  flat%   sum%        cum   cum%
      60ms 60.00% 60.00%       60ms 60.00%  runtime.usleep
      30ms 30.00% 90.00%       30ms 30.00%  main.makeSlice
      10ms 10.00%   100%       10ms 10.00%  runtime.nanotime
         0     0%   100%       30ms 30.00%  main.main
         0     0%   100%       10ms 10.00%  runtime.gcBgMarkWorker
         0     0%   100%       70ms 70.00%  runtime.gcBgMarkWorker.func2
         0     0%   100%       70ms 70.00%  runtime.gcDrain
         0     0%   100%       30ms 30.00%  runtime.main
         0     0%   100%       70ms 70.00%  runtime.markroot
         0     0%   100%       70ms 70.00%  runtime.markroot.func1
         0     0%   100%       60ms 60.00%  runtime.mstart
         0     0%   100%       60ms 60.00%  runtime.osyield
         0     0%   100%       70ms 70.00%  runtime.scang
         0     0%   100%       70ms 70.00%  runtime.systemstack
</code></pre><p>ç”Ÿæˆpdfå›¾</p>
<pre tabindex="0"><code> go tool pprof --pdf ./hi /var/folders/zy/d8yskqjj09q21y7jnc0vbsqh0000gn/T/profile626723859/cpu.pprof &gt; cpu.pdf
</code></pre><h1 id="6è·å–å†…å­˜ppfo">6.è·å–å†…å­˜ppfo <a href="#6%e8%8e%b7%e5%8f%96%e5%86%85%e5%ad%98ppfo" class="anchor">ğŸ”—</a></h1><p>å¦‚æœä½ æŒæ¡äº†cpu pprofï¼Œmem pprofè½»è€Œæ˜“ä¸¾å°±èƒ½æ‹¿ä¸‹ï¼Œåªéœ€è¦æ”¹1è¡Œä»£ç ï¼š</p>
<pre tabindex="0"><code>defer profile.Start(profile.MemProfile).Stop()
</code></pre>
    </div>

    
</section>


            </div>
            <div class="side">
                <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/ai">ai(3)</a>
            </li>
        
            <li>
                <a href="/categories/go">go(23)</a>
            </li>
        
            <li>
                <a href="/categories/%E4%BB%A3%E7%A0%81">ä»£ç (2)</a>
            </li>
        
            <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7">å·¥å…·(8)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%80%86%E5%90%91">é€†å‘(3)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%9D%A2%E8%AF%95">é¢è¯•(5)</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/note/">Recent Note</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/">åœºæ™¯æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿çš„è§£å†³æ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/">å•çº¿ç¨‹çš„redisä¸ºä»€ä¹ˆå¿«</a>
            </li>
        
            <li>
                <a href="/note/redis-%E6%80%BB%E7%BB%93/">redisæ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/mysql-%E6%80%BB%E7%BB%93/">mysqlæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/android/">Recent Android</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/android/redroid%E4%BD%BF%E7%94%A8/">Redroidå®‰å“å®¹å™¨</a>
            </li>
        
            <li>
                <a href="/android/%E5%85%A5%E9%97%A8/">é€†å‘ç¯å¢ƒ-æ‚</a>
            </li>
        
            <li>
                <a href="/android/frida%E6%95%99%E7%A8%8B/">fridaæ•™ç¨‹</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/tool/">Recent Tool</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tool/linux-almalinux%E4%BC%98%E5%8C%96/">AlmaLinux10</a>
            </li>
        
            <li>
                <a href="/tool/almalinux-k8s/">AlmaLinux-k8så®‰è£…</a>
            </li>
        
            <li>
                <a href="/tool/vscode%E6%8A%98%E8%85%BE/">vscodeæŠ˜è…¾</a>
            </li>
        
            <li>
                <a href="/tool/linux-ubuntu%E4%BC%98%E5%8C%96/">Ubuntuå¼€æœºä¼˜åŒ–</a>
            </li>
        
            <li>
                <a href="/tool/shell-ssh_script/">sshå¸¸ç”¨è„šæœ¬</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/llm/">Recent Llm</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/">Transformers-å…¥é—¨ç¯‡</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/">AIæ¨¡å‹VLLMéƒ¨ç½²</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">AIæ¨¡å‹å¾®è°ƒ</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/go/">Recent Go</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/">Goä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/">Goä¸­makeä¸newåŒºåˆ«</a>
            </li>
        
            <li>
                <a href="/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/go/grpc%E6%80%BB%E7%BB%93/">GRPCç¬”è®°</a>
            </li>
        
            <li>
                <a href="/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/">Goçš„deferæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
            </div>
        </main>
        <footer class="footer">
    <div class="footer-row">
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/note/index.xml">
                    Feed of Note
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/android/index.xml">
                    Feed of Android
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/tool/index.xml">
                    Feed of Tool
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/llm/index.xml">
                    Feed of Llm
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/go/index.xml">
                    Feed of Go
                    <i class="icofont-rss"></i>
                </a>
            
        

        
            
            
        
    </div>

    
</footer>

    </body>
</html>
