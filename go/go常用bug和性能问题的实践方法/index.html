<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">




<title>Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³• | Abnerçš„åšå®¢</title>
<link rel="canonical" href="https://abnerxc.github.io/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">
<meta property="og:type" content="article" />
<meta property="og:title" content="Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³• | Abnerçš„åšå®¢" />
<meta property="og:url" content="https://abnerxc.github.io/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/" />








<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/custom.css" />
<script src="/js/copy-code-block.js"></script>
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    </head>

    <body>
        <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://abnerxc.github.io/">Abnerçš„åšå®¢</a>

        <nav class="menu">
            
        </nav>
    </div>
</header>

        <main class="main-wrapper">
            <div class="main">
                

<section class="single">
    <h1 class="title">Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</h1>

    <div class="tip">
        <time datetime="2024-09-19 17:50:03 &#43;0800 CST">2024/09/19</time>
        <span class="split">Â·</span>
        <span> 1592 words </span>
        <span class="split">Â·</span>
        <span>
            8 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/go">Go</a>
            
        </div>
        

        
    </div>

    
    
    <div class="post-toc">
        <h3>ç›®å½•</h3>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€åˆ†æç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸cpuåˆ©ç”¨ç‡æƒ…å†µ">ä¸€ã€åˆ†æç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸CPUåˆ©ç”¨ç‡æƒ…å†µ</a></li>
    <li><a href="#äºŒåˆ†ægolangç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ">äºŒã€åˆ†ægolangç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ</a></li>
    <li><a href="#ä¸‰åˆ†ægolangç¨‹åºçš„cpuæ€§èƒ½æƒ…å†µ">ä¸‰ã€åˆ†æGolangç¨‹åºçš„CPUæ€§èƒ½æƒ…å†µ</a></li>
  </ul>
</nav>
    </div>
    

    <hr />

    <div class="content">
        <blockquote>
<p>åŸæ–‡åœ°å€ï¼šhttps://www.yuque.com/aceld/golang/ga6pb1</p>
</blockquote>
<h1 id="ä¸€åˆ†æç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸cpuåˆ©ç”¨ç‡æƒ…å†µ">ä¸€ã€åˆ†æç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸CPUåˆ©ç”¨ç‡æƒ…å†µ <a href="#%e4%b8%80%e5%88%86%e6%9e%90%e7%a8%8b%e5%ba%8f%e7%9a%84%e8%bf%90%e8%a1%8c%e6%97%b6%e9%97%b4%e4%b8%8ecpu%e5%88%a9%e7%94%a8%e7%8e%87%e6%83%85%e5%86%b5" class="anchor">ğŸ”—</a></h1><h2 id="shellå†…ç½®timeæŒ‡ä»¤">shellå†…ç½®timeæŒ‡ä»¤ <a href="#shell%e5%86%85%e7%bd%aetime%e6%8c%87%e4%bb%a4" class="anchor">ğŸ”—</a></h2><p>è¿™ä¸ªæ–¹æ³•ä¸ç®—æ–°é¢–ï¼Œä½†æ˜¯ç¡®å¾ˆå®ç”¨ã€‚ <code>time</code>æ˜¯Unix/Linuxå†…ç½®å¤šå‘½ä»¤ï¼Œä½¿ç”¨æ—¶ä¸€èˆ¬ä¸ç”¨ä¼ è¿‡å¤šå‚æ•°ï¼Œç›´æ¥è·Ÿä¸Šéœ€è¦è°ƒè¯•å¤šç¨‹åºå³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>time go run main.go 
</span></span><span style="display:flex;"><span>æ–æ³¢é‚£å¥‘æ•°åˆ—ç¬¬30é¡¹çš„å€¼ä¸ºï¼š <span style="color:#ae81ff">55</span>
</span></span><span style="display:flex;"><span>real	0m0.843s
</span></span><span style="display:flex;"><span>user	0m0.216s
</span></span><span style="display:flex;"><span>sys	0m0.389s
</span></span></code></pre></div><p>ä¸Šé¢æ˜¯ä½¿ç”¨timeå¯¹ go run main.goå¯¹æ‰§è¡Œç¨‹åºåšäº†æ€§èƒ½åˆ†æï¼Œå¾—åˆ°3ä¸ªæŒ‡æ ‡ã€‚</p>
<ul>
<li>real:ä»ç¨‹åºå¼€å§‹åˆ°ç»“æŸï¼Œå®é™…åº¦è¿‡çš„æ—¶é—´ï¼›</li>
<li>user:ç¨‹åºåœ¨ç”¨æˆ·æ€åº¦è¿‡çš„æ—¶é—´ï¼›</li>
<li>sys:ç¨‹åºåœ¨ç³»ç»Ÿæ€åº¦è¿‡æ—¶é—´ã€‚
ä¸€èˆ¬æƒ…å†µä¸‹ real &gt;= user + sysï¼Œå› ä¸ºç³»ç»Ÿè¿˜æœ‰å…¶å®ƒè¿›ç¨‹(åˆ‡æ¢å…¶ä»–è¿›ç¨‹ä¸­é—´å¯¹äºæœ¬è¿›ç¨‹ä¼šæœ‰ç©ºç™½æœŸ)ã€‚</li>
</ul>
<h2 id="usrbintimeæŒ‡ä»¤">/usr/bin/timeæŒ‡ä»¤ <a href="#usrbintime%e6%8c%87%e4%bb%a4" class="anchor">ğŸ”—</a></h2><p>è¿™ä¸ªæŒ‡ä»¤æ¯”å†…ç½®çš„timeæ›´åŠ è¯¦ç»†ä¸€äº›ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦ç”¨ç»å¯¹è·¯å¾„ï¼Œè€Œä¸”è¦åŠ ä¸Šå‚æ•°<code>-v</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/bin/time -v go run main.go  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	Command being timed: <span style="color:#e6db74">&#34;go run main.go&#34;</span>
</span></span><span style="display:flex;"><span>	User time <span style="color:#f92672">(</span>seconds<span style="color:#f92672">)</span>: 0.12
</span></span><span style="display:flex;"><span>	System time <span style="color:#f92672">(</span>seconds<span style="color:#f92672">)</span>: 0.06
</span></span><span style="display:flex;"><span>	Percent of CPU this job got: 115%
</span></span><span style="display:flex;"><span>	Elapsed <span style="color:#f92672">(</span>wall clock<span style="color:#f92672">)</span> time <span style="color:#f92672">(</span>h:mm:ss or m:ss<span style="color:#f92672">)</span>: 0:00.16
</span></span><span style="display:flex;"><span>	Average shared text size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Average unshared data size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Average stack size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Average total size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Maximum resident set size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">41172</span>
</span></span><span style="display:flex;"><span>	Average resident set size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Major <span style="color:#f92672">(</span>requiring I/O<span style="color:#f92672">)</span> page faults: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	Minor <span style="color:#f92672">(</span>reclaiming a frame<span style="color:#f92672">)</span> page faults: <span style="color:#ae81ff">15880</span>
</span></span><span style="display:flex;"><span>	Voluntary context switches: <span style="color:#ae81ff">897</span>
</span></span><span style="display:flex;"><span>	Involuntary context switches: <span style="color:#ae81ff">183</span>
</span></span><span style="display:flex;"><span>	Swaps: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	File system inputs: <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>	File system outputs: <span style="color:#ae81ff">2664</span>
</span></span><span style="display:flex;"><span>	Socket messages sent: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Socket messages received: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Signals delivered: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Page size <span style="color:#f92672">(</span>bytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">4096</span>
</span></span><span style="display:flex;"><span>	Exit status: <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h1 id="äºŒåˆ†ægolangç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ">äºŒã€åˆ†ægolangç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ <a href="#%e4%ba%8c%e5%88%86%e6%9e%90golang%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%86%85%e5%ad%98%e4%bd%bf%e7%94%a8%e6%83%85%e5%86%b5" class="anchor">ğŸ”—</a></h1><h2 id="å†…å­˜å ç”¨æƒ…å†µæŸ¥çœ‹">å†…å­˜å ç”¨æƒ…å†µæŸ¥çœ‹ <a href="#%e5%86%85%e5%ad%98%e5%8d%a0%e7%94%a8%e6%83%85%e5%86%b5%e6%9f%a5%e7%9c%8b" class="anchor">ğŸ”—</a></h2><p>æˆ‘ä»¬å…ˆå†™ä¸€æ®µdemoä¾‹å­ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;runtime&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">container</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop begin.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">32</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">container</span> = append(<span style="color:#a6e22e">container</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop end.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Start.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">test</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;force gc.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GC</span>() <span style="color:#75715e">//å¼ºåˆ¶è°ƒç”¨gcå›æ”¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Done.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">3600</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>) <span style="color:#75715e">//ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç¼–è¯‘</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>go build -o snippet_mem <span style="color:#f92672">&amp;&amp;</span> ./snippet_mem
</span></span></code></pre></div><p>ç„¶ååœ¨./snippet_memè¿›ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå†å¼€ä¸€ä¸ªçª—å£ï¼Œé€šè¿‡<code>top</code>å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜å ç”¨æƒ…å†µ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>top -p <span style="color:#66d9ef">$(</span>pidof snippet_mem<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><p>å¾—åˆ°ç»“æœå¦‚ä¸‹
<img src="/img/godebug1.png" alt="godebug1">
æˆ‘ä»¬çœ‹å‡ºæ¥ï¼Œæ²¡æœ‰é€€å‡ºçš„snippet_memè¿›ç¨‹æœ‰çº¦830mçš„å†…å­˜è¢«å ç”¨ã€‚</p>
<p>ç›´è§‚ä¸Šæ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºåœ¨test()å‡½æ•°æ‰§è¡Œå®Œåï¼Œåˆ‡ç‰‡contanerçš„å†…å­˜åº”è¯¥è¢«é‡Šæ”¾ï¼Œä¸åº”è¯¥å ç”¨830Mé‚£ä¹ˆå¤§ã€‚</p>
<h2 id="ä½¿ç”¨godebugä¸gctraceæ¥åˆ†æç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ">ä½¿ç”¨GODEBUGä¸gctraceæ¥åˆ†æç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ <a href="#%e4%bd%bf%e7%94%a8godebug%e4%b8%8egctrace%e6%9d%a5%e5%88%86%e6%9e%90%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%86%85%e5%ad%98%e4%bd%bf%e7%94%a8%e6%83%85%e5%86%b5" class="anchor">ğŸ”—</a></h2><p>æ‰§è¡Œsnippet_memç¨‹åºä¹‹å‰æ·»åŠ ç¯å¢ƒå˜é‡GODEBUG=&lsquo;gctrace=1&rsquo;æ¥è·Ÿè¸ªæ‰“å°åƒåœ¾å›æ”¶å™¨ä¿¡æ¯</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>GODEBUG<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gctrace=1&#39;</span> ./snippet_mem
</span></span></code></pre></div><p>è®¾ç½®gctrace=1ä¼šä½¿å¾—åƒåœ¾å›æ”¶å™¨åœ¨æ¯æ¬¡å›æ”¶æ—¶æ±‡æ€»æ‰€å›æ”¶å†…å­˜çš„å¤§å°ä»¥åŠè€—æ—¶ï¼Œ
å¹¶å°†è¿™äº›å†…å®¹æ±‡æ€»æˆå•è¡Œå†…å®¹æ‰“å°åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºä¸­ã€‚
æ ¼å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>gc # @#s #%: #+#+# ms clock, #+#/#/#+# ms cpu, #-&gt;#-&gt;# MB, # MB goal, # P
</span></span></code></pre></div><p>å«ä¹‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>gc #        GCæ¬¡æ•°çš„ç¼–å·ï¼Œæ¯æ¬¡GCæ—¶é€’å¢
</span></span><span style="display:flex;"><span>@#s         è·ç¦»ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶çš„æ—¶é—´
</span></span><span style="display:flex;"><span>#%          GCå ç”¨çš„æ‰§è¡Œæ—¶é—´ç™¾åˆ†æ¯”
</span></span><span style="display:flex;"><span>#+...+#     GCä½¿ç”¨çš„æ—¶é—´
</span></span><span style="display:flex;"><span>#-&gt;#-&gt;# MB  GCå¼€å§‹ï¼Œç»“æŸï¼Œä»¥åŠå½“å‰æ´»è·ƒå †å†…å­˜çš„å¤§å°ï¼Œå•ä½M
</span></span><span style="display:flex;"><span># MB goal   å…¨å±€å †å†…å­˜å¤§å°
</span></span><span style="display:flex;"><span># P         ä½¿ç”¨processorçš„æ•°é‡
</span></span></code></pre></div><p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>gc 15 @0.123s 4%: 0.051+43+0.003 ms clock, 0.83+0/44/0+0.057 ms cpu, 277-&gt;277-&gt;94 MB, 277 MB goal, 0 MB stacks, 0 MB globals, 16 P
</span></span></code></pre></div><p>è¯¥æ¡ä¿¡æ¯å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>gc 15</code>:Gc è°ƒè¯•ç¼–å·ä¸º15</li>
<li><code>@0.123s</code>:æ­¤æ—¶ç¨‹åºå·²ç»æ‰§è¡Œäº†0.123s</li>
<li><code>4%:</code>:0.123sä¸­å…¶ä¸­gcæ¨¡å—å ç”¨äº†4%çš„æ—¶é—´</li>
<li><code>0.051+43+0.003 ms clock</code>:åƒåœ¾å›æ”¶çš„æ—¶é—´ï¼Œåˆ†åˆ«ä¸ºSTWï¼ˆstop-the-worldï¼‰æ¸…æ‰«çš„æ—¶é—´+å¹¶å‘æ ‡è®°å’Œæ‰«æçš„æ—¶é—´+STWæ ‡è®°çš„æ—¶é—´</li>
<li><code>0.83+0/44/0+0.057 ms cpu</code>: åƒåœ¾å›æ”¶å ç”¨cpuæ—¶é—´</li>
<li><code>277-&gt;277-&gt;94 MB</code>: GCå¼€å§‹å‰å †å†…å­˜277Mï¼Œ GCç»“æŸåå †å†…å­˜277Mï¼Œå½“å‰æ´»è·ƒçš„å †å†…å­˜94M</li>
<li><code>277 MB goal</code>: å…¨å±€å †å†…å­˜å¤§å°277M</li>
<li><code>0 MB stacks</code>: æ ˆå†…å­˜å¤§å°0M</li>
<li><code>0 MB globals</code>: å…¨å±€å˜é‡å†…å­˜å¤§å°0M</li>
<li><code>16 P</code>: ä½¿ç”¨processorçš„æ•°é‡16</li>
</ul>
<p>äº†è§£äº†GCçš„è°ƒè¯•ä¿¡æ¯è¯»æ³•åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æœ¬æ¬¡GCçš„ç»“æœã€‚
æ‰§è¡ŒGODEBUGè°ƒè¯•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>GODEBUG<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gctrace=1&#39;</span> ./snippet_mem
</span></span></code></pre></div><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>2024/09/19 21:04:09  ===&gt; loop begin.
</span></span><span style="display:flex;"><span>gc 1 @0.003s 2%: 0.040+2.0+0.012 ms clock, 0.81+0/2.1/0+0.24 ms cpu, 4-&gt;4-&gt;1 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 2 @0.006s 4%: 0.027+8.1+0.14 ms clock, 0.55+0/6.6/0+2.9 ms cpu, 4-&gt;5-&gt;3 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 3 @0.015s 4%: 0.026+2.9+0.010 ms clock, 0.52+0/2.9/0+0.21 ms cpu, 7-&gt;7-&gt;2 MB, 8 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 4 @0.019s 22%: 0.050+1.1+5.2 ms clock, 1.0+0/1.1/0+105 ms cpu, 6-&gt;10-&gt;7 MB, 6 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 5 @0.026s 17%: 0.028+10+0.014 ms clock, 0.56+0/10/0+0.29 ms cpu, 19-&gt;19-&gt;6 MB, 19 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 6 @0.037s 12%: 0.031+14+0.067 ms clock, 0.63+0/4.5/0.001+1.3 ms cpu, 14-&gt;24-&gt;18 MB, 14 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 7 @0.067s 8%: 0.037+44+0.21 ms clock, 0.75+0/44/0+4.2 ms cpu, 46-&gt;46-&gt;28 MB, 46 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 8 @0.116s 7%: 0.035+25+0.028 ms clock, 0.71+0/24/0+0.57 ms cpu, 72-&gt;72-&gt;44 MB, 72 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 9 @0.150s 6%: 0.036+53+0.059 ms clock, 0.72+0/53/0+1.1 ms cpu, 113-&gt;113-&gt;38 MB, 113 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 10 @0.204s 6%: 0.079+9.0+0.011 ms clock, 1.5+0/8.9/0+0.23 ms cpu, 86-&gt;86-&gt;48 MB, 86 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 11 @0.213s 6%: 0.10+19+0.23 ms clock, 2.1+0/19/0+4.6 ms cpu, 108-&gt;108-&gt;108 MB, 108 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 12 @0.283s 5%: 0.025+40+0.024 ms clock, 0.50+0/40/0+0.48 ms cpu, 277-&gt;277-&gt;169 MB, 277 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 13 @0.408s 4%: 0.035+101+0.006 ms clock, 0.70+0/101/0+0.12 ms cpu, 433-&gt;433-&gt;147 MB, 433 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 14 @0.510s 4%: 0.011+18+0.005 ms clock, 0.22+0/18/0+0.10 ms cpu, 330-&gt;330-&gt;183 MB, 330 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 15 @0.529s 4%: 0.010+36+0.011 ms clock, 0.20+0/36/0+0.22 ms cpu, 413-&gt;413-&gt;229 MB, 413 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>2024/09/19 21:04:10  ===&gt; loop end.
</span></span><span style="display:flex;"><span>2024/09/19 21:04:10 force gc.
</span></span><span style="display:flex;"><span>gc 16 @0.566s 4%: 0.022+116+0.004 ms clock, 0.45+0/116/0+0.094 ms cpu, 516-&gt;516-&gt;0 MB, 516 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 17 @0.682s 4%: 0.080+0.17+0.073 ms clock, 1.6+0/0.15/0+1.4 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P (forced)
</span></span><span style="display:flex;"><span>2024/09/19 21:04:10 Done.
</span></span><span style="display:flex;"><span>GC forced
</span></span><span style="display:flex;"><span>gc 18 @121.392s 0%: 0.029+0.29+0.004 ms clock, 0.59+0/0.31/0+0.093 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span></code></pre></div><p>åˆ†æ</p>
<p>å…ˆçœ‹åœ¨test()å‡½æ•°æ‰§è¡Œå®Œåç«‹å³æ‰“å°çš„gc 16é‚£è¡Œçš„ä¿¡æ¯ã€‚516-&gt;516-&gt;0 MB, 516 MB goalè¡¨ç¤ºåƒåœ¾å›æ”¶å™¨å·²ç»æŠŠ516Mçš„å†…å­˜æ ‡è®°ä¸ºéæ´»è·ƒçš„å†…å­˜ã€‚</p>
<p>å†çœ‹ä¸‹ä¸€ä¸ªè®°å½•gc 17è¡Œ0-&gt;0-&gt;0 MB, 4 MB goalè¡¨ç¤ºåƒåœ¾å›æ”¶å™¨ä¸­çš„å…¨å±€å †å†…å­˜å¤§å°ç”±888Mä¸‹é™ä¸º4Mã€‚</p>
<p>ç»“è®º</p>
<ul>
<li>åœ¨test()å‡½æ•°æ‰§è¡Œå®Œåï¼Œdemoç¨‹åºä¸­çš„åˆ‡ç‰‡å®¹å™¨æ‰€ç”³è¯·çš„å †ç©ºé—´éƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶äº†ã€‚</li>
<li>å¦‚æœæ­¤æ—¶åœ¨topæŒ‡ä»¤æŸ¥è¯¢å†…å­˜çš„æ—¶å€™ï¼Œå¦‚æœä¾ç„¶æ˜¯800+MBï¼Œè¯´æ˜åƒåœ¾å›æ”¶å™¨å›æ”¶äº†åº”ç”¨å±‚çš„å†…å­˜åï¼Œ<code>ï¼ˆå¯èƒ½ï¼‰å¹¶ä¸ä¼šç«‹å³å°†å†…å­˜å½’è¿˜ç»™ç³»ç»Ÿ</code>ã€‚</li>
</ul>
<h2 id="runtimereadmemstats">runtime.ReadMemStats <a href="#runtimereadmemstats" class="anchor">ğŸ”—</a></h2><p>æ¥ä¸‹æ¥æ¢å¦ä¸€ç§æ–¹å¼æŸ¥çœ‹å†…å­˜çš„æ–¹å¼ åˆ©ç”¨ <code>runtime</code>åº“é‡Œçš„<code>ReadMemStats()</code>æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;runtime&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readMemStats</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ms</span> <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">MemStats</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">ReadMemStats</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ms</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34; ===&gt; Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)&#34;</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">Alloc</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">HeapIdle</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">HeapReleased</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">container</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop begin.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">32</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">container</span> = append(<span style="color:#a6e22e">container</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">i</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop end.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [Start].&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">test</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [force gc].&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GC</span>() <span style="color:#75715e">//å¼ºåˆ¶è°ƒç”¨gcå›æ”¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [Done].&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">3600</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>) <span style="color:#75715e">//ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è¿™é‡Œæˆ‘ä»¬ï¼Œ å°è£…äº†ä¸€ä¸ªå‡½æ•°<code>readMemStats()</code>ï¼Œè¿™é‡Œé¢ä¸»è¦æ˜¯è°ƒç”¨runtimeä¸­çš„<code>ReadMemStats()</code>æ–¹æ³•è·å¾—å†…å­˜ä¿¡æ¯ï¼Œç„¶åé€šè¿‡<code>log</code>æ‰“å°å‡ºæ¥ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">run</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">17</span>  <span style="color:#f92672">==</span>=&gt; [<span style="color:#a6e22e">Start</span>].
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">17</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">71280</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">66633728</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">66600960</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">17</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">loop</span> <span style="color:#a6e22e">begin</span>.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">18</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">132535744</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">336756736</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">155721728</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">loop</span> <span style="color:#a6e22e">end</span>.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">598300600</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">609181696</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">434323456</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; [<span style="color:#a6e22e">force</span> <span style="color:#a6e22e">gc</span>].
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; [<span style="color:#a6e22e">Done</span>].
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">55840</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207427072</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">434266112</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">56656</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207394304</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">434266112</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">48</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">56912</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207394304</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">1206493184</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">58</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">57488</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207394304</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">1206493184</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">22</span>:<span style="color:#ae81ff">08</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">57616</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207394304</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">1206493184</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">c2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">22</span>:<span style="color:#ae81ff">18</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">57744</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207394304</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">1206493184</span>(<span style="color:#a6e22e">by</span>
</span></span></code></pre></div><p>è¯´æ˜ï¼š</p>
<ul>
<li>Allocï¼šå·²åˆ†é…ä½†å°šæœªé‡Šæ”¾çš„å†…å­˜å­—èŠ‚æ•°ï¼ŒåŒ…æ‹¬å †å†…å­˜å’Œæ ˆå†…å­˜ç­‰</li>
<li>HeapIdleï¼šå½“å‰æœªä½¿ç”¨ä½†ä»ç„¶ä¿ç•™ç»™å †çš„å†…å­˜å­—èŠ‚æ•°ï¼ˆå³å¯ä»¥å¿«é€Ÿé‡æ–°ä½¿ç”¨çš„å†…å­˜ï¼‰</li>
<li>HeapReleasedï¼šå·²å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼ˆä½†æœªæ¥å¯èƒ½å†æ¬¡ç”³è¯·ï¼‰çš„å †å†…å­˜å­—èŠ‚æ•°</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ‰“å°<code>[Done]</code>.ä¹‹åé‚£æ¡traceä¿¡æ¯ï¼ŒAllocå·²ç»ä¸‹é™ï¼Œå³å†…å­˜å·²è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚åœ¨2025/09/19 21:17:31å’Œ2020/03/02 18:21:48çš„ä¸¤æ¡traceä¿¡æ¯ä¸­ï¼ŒHeapReleasedå¼€å§‹ä¸Šå‡ï¼Œå³åƒåœ¾å›æ”¶å™¨æŠŠå†…å­˜å½’è¿˜ç»™ç³»ç»Ÿã€‚</p>
<blockquote>
<p>æ›´å¤šMemStatsè¯´æ˜ï¼š<a href="https://pkg.go.dev/runtime#MemStats">https://pkg.go.dev/runtime#MemStats</a></p>
</blockquote>
<h4 id="pprofå·¥å…·">pprofå·¥å…· <a href="#pprof%e5%b7%a5%e5%85%b7" class="anchor">ğŸ”—</a></h4><p>pprofå·¥å…·æ”¯æŒç½‘é¡µä¸ŠæŸ¥çœ‹å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œéœ€è¦åœ¨ä»£ç ä¸­æ·»åŠ ä¸€ä¸ªåç¨‹å³å¯ã€‚</p>
<p>å®Œæ•´ç¤ºä¾‹ä»£ç :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;runtime&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_</span> <span style="color:#e6db74">&#34;net/http/pprof&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readMemStats</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ms</span> <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">MemStats</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">ReadMemStats</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ms</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34; ===&gt; Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)&#34;</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">Alloc</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">HeapIdle</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">HeapReleased</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">container</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop begin.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">32</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">container</span> = append(<span style="color:#a6e22e">container</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">i</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop end.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å¯åŠ¨pprof</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;0.0.0.0:10000&#34;</span>, <span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [Start].&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">test</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [force gc].&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GC</span>() <span style="color:#75715e">//å¼ºåˆ¶è°ƒç”¨gcå›æ”¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [Done].&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">3600</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>) <span style="color:#75715e">//ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è®¿é—®ï¼šhttp://127.0.0.1:10000/debug/pprof/heap?debug=1 æŸ¥çœ‹</p>
<p>æµè§ˆå™¨çš„å†…å®¹å…¶ä¸­æœ‰ä¸€éƒ¨åˆ†å¦‚ä¸‹ï¼Œè®°å½•äº†ç›®å‰çš„å†…å­˜æƒ…å†µ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># runtime.MemStats
</span></span><span style="display:flex;"><span># Alloc = 393328
</span></span><span style="display:flex;"><span># TotalAlloc = 1503610448
</span></span><span style="display:flex;"><span># Sys = 991758840
</span></span><span style="display:flex;"><span># Lookups = 0
</span></span><span style="display:flex;"><span># Mallocs = 1023
</span></span><span style="display:flex;"><span># Frees = 233
</span></span><span style="display:flex;"><span># HeapAlloc = 393328
</span></span><span style="display:flex;"><span># HeapSys = 985137152
</span></span><span style="display:flex;"><span># HeapIdle = 984096768
</span></span><span style="display:flex;"><span># HeapInuse = 1040384
</span></span><span style="display:flex;"><span># HeapReleased = 984006656
</span></span><span style="display:flex;"><span># HeapObjects = 790
</span></span><span style="display:flex;"><span># Stack = 524288 / 524288
</span></span><span style="display:flex;"><span># MSpan = 75680 / 81600
</span></span><span style="display:flex;"><span># MCache = 24000 / 31200
</span></span><span style="display:flex;"><span># BuckHashSys = 1450271
</span></span><span style="display:flex;"><span># GCSys = 3206184
</span></span><span style="display:flex;"><span># OtherSys = 1328145
</span></span><span style="display:flex;"><span># NextGC = 4194304
</span></span><span style="display:flex;"><span># LastGC = 1758288816398705240
</span></span></code></pre></div><h1 id="ä¸‰åˆ†ægolangç¨‹åºçš„cpuæ€§èƒ½æƒ…å†µ">ä¸‰ã€åˆ†æGolangç¨‹åºçš„CPUæ€§èƒ½æƒ…å†µ <a href="#%e4%b8%89%e5%88%86%e6%9e%90golang%e7%a8%8b%e5%ba%8f%e7%9a%84cpu%e6%80%a7%e8%83%bd%e6%83%85%e5%86%b5" class="anchor">ğŸ”—</a></h1><h2 id="cpuæ€§èƒ½æµ‹è¯•ä»£ç ">CPUæ€§èƒ½æµ‹è¯•ä»£ç  <a href="#cpu%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;bytes&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_</span> <span style="color:#e6db74">&#34;net/http/pprof&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop begin.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">1000</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">genSomeBytes</span>())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop end.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">genSomeBytes</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">buff</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">20000</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">buff</span>.<span style="color:#a6e22e">Write</span>([]<span style="color:#66d9ef">byte</span>{<span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">+</span> byte(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">10</span>))})
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">buff</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">test</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å¯åŠ¨pprof</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;0.0.0.0:10000&#34;</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="ä½¿ç”¨pprof-webç•Œé¢æŸ¥çœ‹">ä½¿ç”¨pprof-Webç•Œé¢æŸ¥çœ‹ <a href="#%e4%bd%bf%e7%94%a8pprof-web%e7%95%8c%e9%9d%a2%e6%9f%a5%e7%9c%8b" class="anchor">ğŸ”—</a></h2><p>æµè§ˆå™¨è®¿é—®: http://127.0.0.1:10000/debug/pprof/
<img src="/img/godebug2.png" alt="godebug2">
æˆ‘ä»¬å¯ä»¥ç›´æ¥ç‚¹å‡»ç½‘é¡µçš„profile,æµè§ˆå™¨ä¼šç»™æˆ‘ä»¬ä¸‹è½½ä¸€ä¸ªprofileæ–‡ä»¶.</p>
<h2 id="ä½¿ç”¨pprofå·¥å…·æŸ¥çœ‹">ä½¿ç”¨pprofå·¥å…·æŸ¥çœ‹ <a href="#%e4%bd%bf%e7%94%a8pprof%e5%b7%a5%e5%85%b7%e6%9f%a5%e7%9c%8b" class="anchor">ğŸ”—</a></h2><p>å°†ä¸‹è½½çš„profileæ–‡ä»¶å’Œgoçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸€èµ·æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>go tool pprof <span style="color:#f92672">[</span>binary<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>profile<span style="color:#f92672">]</span>
</span></span></code></pre></div><ul>
<li>binary:goå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶</li>
<li>profile:webç•Œé¢ä¸‹è½½çš„profileæ–‡ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>go tool pprof ./democpu profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>File: democpu
</span></span><span style="display:flex;"><span>Type: cpu
</span></span><span style="display:flex;"><span>Time: Mar 3, 2020 at 11:18pm (CST)
</span></span><span style="display:flex;"><span>Duration: 30.13s, Total samples = 6.27s (20.81%)
</span></span><span style="display:flex;"><span>Entering interactive mode (type &#34;help&#34; for commands, &#34;o&#34; for options)
</span></span><span style="display:flex;"><span>(pprof)
</span></span></code></pre></div><p>helpå¯ä»¥æŸ¥çœ‹ä¸€äº›æŒ‡ä»¤,æˆ‘ä¹ˆå¯ä»¥é€šè¿‡topæ¥æŸ¥çœ‹cpuçš„æ€§èƒ½æƒ…å†µ.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>(pprof) top
</span></span><span style="display:flex;"><span>Showing nodes accounting for 5090ms, 81.18% of 6270ms total
</span></span><span style="display:flex;"><span>Dropped 80 nodes (cum <span style="color:#960050;background-color:#1e0010">&lt;</span>= 31.35ms)
</span></span><span style="display:flex;"><span>Showing top 10 nodes out of 60
</span></span><span style="display:flex;"><span>      flat  flat%   sum%        cum   cum%
</span></span><span style="display:flex;"><span>    1060ms 16.91% 16.91%     2170ms 34.61%  math/rand.(*lockedSource).Int63
</span></span><span style="display:flex;"><span>     850ms 13.56% 30.46%      850ms 13.56%  sync.(*Mutex).Unlock (inline)
</span></span><span style="display:flex;"><span>     710ms 11.32% 41.79%     2950ms 47.05%  math/rand.(*Rand).Int31n
</span></span><span style="display:flex;"><span>     570ms  9.09% 50.88%      990ms 15.79%  bytes.(*Buffer).Write
</span></span><span style="display:flex;"><span>     530ms  8.45% 59.33%      540ms  8.61%  syscall.Syscall
</span></span><span style="display:flex;"><span>     370ms  5.90% 65.23%      370ms  5.90%  runtime.procyield
</span></span><span style="display:flex;"><span>     270ms  4.31% 69.54%     4490ms 71.61%  main.genSomeBytes
</span></span><span style="display:flex;"><span>     250ms  3.99% 73.52%     3200ms 51.04%  math/rand.(*Rand).Intn
</span></span><span style="display:flex;"><span>     250ms  3.99% 77.51%      250ms  3.99%  runtime.memmove
</span></span><span style="display:flex;"><span>     230ms  3.67% 81.18%      690ms 11.00%  runtime.suspendG
</span></span><span style="display:flex;"><span>(pprof)
</span></span></code></pre></div><p>è¿™é‡Œé¢æœ‰å‡ åˆ—æ•°æ®,éœ€è¦è¯´æ˜ä¸€ä¸‹.</p>
<ul>
<li>flatï¼šå½“å‰å‡½æ•°å ç”¨CPUçš„è€—æ—¶</li>
<li>flat%ï¼š:å½“å‰å‡½æ•°å ç”¨CPUçš„è€—æ—¶ç™¾åˆ†æ¯”</li>
<li>sum%ï¼šå‡½æ•°å ç”¨CPUçš„è€—æ—¶ç´¯è®¡ç™¾åˆ†æ¯”</li>
<li>cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨CPUçš„æ€»è€—æ—¶</li>
<li>cum%ï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨CPUçš„æ€»è€—æ—¶ç™¾åˆ†æ¯”</li>
<li>æœ€åä¸€åˆ—ï¼šå‡½æ•°åç§°</li>
</ul>
<h2 id="é€šè¿‡go-tool-pprofå¾—åˆ°profileæ–‡ä»¶">é€šè¿‡go tool pprofå¾—åˆ°profileæ–‡ä»¶ <a href="#%e9%80%9a%e8%bf%87go-tool-pprof%e5%be%97%e5%88%b0profile%e6%96%87%e4%bb%b6" class="anchor">ğŸ”—</a></h2><p>webä¸‹è½½çš„é»˜è®¤æ˜¯30s,é€šè¿‡ä¸‹é¢å‘½ä»¤å¯ä»¥å¾—åˆ°60sçš„profileæ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>go tool pprof http://localhost:10000/debug/pprof/profile?seconds<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span> go tool pprof http://localhost:10000/debug/pprof/profile?seconds=60
</span></span><span style="display:flex;"><span>Fetching profile over HTTP from http://localhost:10000/debug/pprof/profile?seconds=60
</span></span><span style="display:flex;"><span>Saved profile in /home/abner/pprof/pprof.procpu.samples.cpu.001.pb.gz
</span></span><span style="display:flex;"><span>File: procpu
</span></span><span style="display:flex;"><span>Type: cpu
</span></span><span style="display:flex;"><span>Time: Sep 19, 2024 at 10:28pm (CST)
</span></span><span style="display:flex;"><span>Duration: 60.16s, Total samples = 18.90s (31.42%)
</span></span><span style="display:flex;"><span>Entering interactive mode (type &#34;help&#34; for commands, &#34;o&#34; for options)
</span></span><span style="display:flex;"><span>(pprof) top
</span></span><span style="display:flex;"><span>Showing nodes accounting for 14990ms, 79.31% of 18900ms total
</span></span><span style="display:flex;"><span>Dropped 191 nodes (cum <span style="color:#960050;background-color:#1e0010">&lt;</span>= 94.50ms)
</span></span><span style="display:flex;"><span>Showing top 10 nodes out of 74
</span></span><span style="display:flex;"><span>      flat  flat%   sum%        cum   cum%
</span></span><span style="display:flex;"><span>    3650ms 19.31% 19.31%     8440ms 44.66%  math/rand.(*Rand).Int31n
</span></span><span style="display:flex;"><span>    2960ms 15.66% 34.97%     2960ms 15.66%  internal/runtime/syscall.Syscall6
</span></span><span style="display:flex;"><span>    2770ms 14.66% 49.63%     2770ms 14.66%  internal/chacha8rand.block
</span></span><span style="display:flex;"><span>    1190ms  6.30% 55.93%     3050ms 16.14%  bytes.(*Buffer).Write
</span></span><span style="display:flex;"><span>    1160ms  6.14% 62.06%     1160ms  6.14%  runtime.memmove
</span></span><span style="display:flex;"><span>     780ms  4.13% 66.19%    14010ms 74.13%  main.genSomeBytes
</span></span><span style="display:flex;"><span>     780ms  4.13% 70.32%     3970ms 21.01%  runtime.rand
</span></span><span style="display:flex;"><span>     660ms  3.49% 73.81%     9100ms 48.15%  math/rand.(*Rand).Intn
</span></span><span style="display:flex;"><span>     550ms  2.91% 76.72%    10130ms 53.60%  math/rand.Intn
</span></span><span style="display:flex;"><span>     490ms  2.59% 79.31%     4790ms 25.34%  math/rand.(*Rand).Int63 (inline)
</span></span><span style="display:flex;"><span>(pprof) 
</span></span></code></pre></div><h2 id="å¯è§†åŒ–æŸ¥çœ‹">å¯è§†åŒ–æŸ¥çœ‹ <a href="#%e5%8f%af%e8%a7%86%e5%8c%96%e6%9f%a5%e7%9c%8b" class="anchor">ğŸ”—</a></h2><p>è¾“å…¥web</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>go tool pprof ./democpu profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>File: democpu
</span></span><span style="display:flex;"><span>Type: cpu
</span></span><span style="display:flex;"><span>Time: Mar 3, 2020 at 11:18pm (CST)
</span></span><span style="display:flex;"><span>Duration: 30.13s, Total samples = 6.27s (20.81%)
</span></span><span style="display:flex;"><span>Entering interactive mode (type &#34;help&#34; for commands, &#34;o&#34; for options)
</span></span><span style="display:flex;"><span>(pprof) web
</span></span></code></pre></div><p>è¿™é‡Œå¦‚æœæŠ¥æ‰¾ä¸åˆ°graphvizå·¥å…·,éœ€è¦å®‰è£…ä¸€ä¸‹
Ubuntuå®‰è£…:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo apt-get install graphviz
</span></span></code></pre></div><p>Macå®‰è£…:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>brew install graphviz
</span></span></code></pre></div><p>Winå®‰è£…:
ä¸‹è½½https://graphviz.gitlab.io/_pages/Download/Download_windows.html
å°†graphvizå®‰è£…ç›®å½•ä¸‹çš„binæ–‡ä»¶å¤¹æ·»åŠ åˆ°Pathç¯å¢ƒå˜é‡ä¸­ã€‚ åœ¨ç»ˆç«¯è¾“å…¥dot -versionæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚</p>
<p><img src="/img/godebug3.png" alt="godebug3"></p>

    </div>

    
</section>


            </div>
            <div class="side">
                <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/ai">ai(3)</a>
            </li>
        
            <li>
                <a href="/categories/go">go(23)</a>
            </li>
        
            <li>
                <a href="/categories/%E4%BB%A3%E7%A0%81">ä»£ç (2)</a>
            </li>
        
            <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7">å·¥å…·(8)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%80%86%E5%90%91">é€†å‘(3)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%9D%A2%E8%AF%95">é¢è¯•(5)</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/note/">Recent Note</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/">åœºæ™¯æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿çš„è§£å†³æ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/">å•çº¿ç¨‹çš„redisä¸ºä»€ä¹ˆå¿«</a>
            </li>
        
            <li>
                <a href="/note/redis-%E6%80%BB%E7%BB%93/">redisæ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/mysql-%E6%80%BB%E7%BB%93/">mysqlæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/android/">Recent Android</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/android/redroid%E4%BD%BF%E7%94%A8/">Redroidå®‰å“å®¹å™¨</a>
            </li>
        
            <li>
                <a href="/android/%E5%85%A5%E9%97%A8/">é€†å‘ç¯å¢ƒ-æ‚</a>
            </li>
        
            <li>
                <a href="/android/frida%E6%95%99%E7%A8%8B/">fridaæ•™ç¨‹</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/tool/">Recent Tool</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tool/linux-almalinux%E4%BC%98%E5%8C%96/">AlmaLinux10</a>
            </li>
        
            <li>
                <a href="/tool/almalinux-k8s/">AlmaLinux-k8så®‰è£…</a>
            </li>
        
            <li>
                <a href="/tool/vscode%E6%8A%98%E8%85%BE/">vscodeæŠ˜è…¾</a>
            </li>
        
            <li>
                <a href="/tool/linux-ubuntu%E4%BC%98%E5%8C%96/">Ubuntuå¼€æœºä¼˜åŒ–</a>
            </li>
        
            <li>
                <a href="/tool/shell-ssh_script/">sshå¸¸ç”¨è„šæœ¬</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/llm/">Recent Llm</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/">Transformers-å…¥é—¨ç¯‡</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/">AIæ¨¡å‹VLLMéƒ¨ç½²</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">AIæ¨¡å‹å¾®è°ƒ</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/go/">Recent Go</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/">Goä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/">Goä¸­makeä¸newåŒºåˆ«</a>
            </li>
        
            <li>
                <a href="/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/go/grpc%E6%80%BB%E7%BB%93/">GRPCç¬”è®°</a>
            </li>
        
            <li>
                <a href="/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/">Goçš„deferæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
            </div>
        </main>
        <footer class="footer">
    <div class="footer-row">
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/note/index.xml">
                    Feed of Note
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/android/index.xml">
                    Feed of Android
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/tool/index.xml">
                    Feed of Tool
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/llm/index.xml">
                    Feed of Llm
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/go/index.xml">
                    Feed of Go
                    <i class="icofont-rss"></i>
                </a>
            
        

        
            
            
        
    </div>

    
</footer>

    </body>
</html>
