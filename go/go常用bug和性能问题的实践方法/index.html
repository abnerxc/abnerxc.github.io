<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">




<title>Go常用bug和性能问题的实践方法 | Abner的博客</title>
<link rel="canonical" href="https://abnerxc.github.io/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">
<meta property="og:type" content="article" />
<meta property="og:title" content="Go常用bug和性能问题的实践方法 | Abner的博客" />
<meta property="og:url" content="https://abnerxc.github.io/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/" />








<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<script src="/js/copy-code-block.js"></script>
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    </head>

    <body>
        <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://abnerxc.github.io/">Abner的博客</a>

        <nav class="menu">
            
        </nav>
    </div>
</header>

        <main class="main-wrapper">
            <div class="main">
                

<section class="single">
    <h1 class="title">Go常用bug和性能问题的实践方法</h1>

    <div class="tip">
        <time datetime="2024-09-19 17:50:03 &#43;0800 CST">2024/09/19</time>
        <span class="split">·</span>
        <span> 1592 words </span>
        <span class="split">·</span>
        <span>
            8 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/go">Go</a>
            
        </div>
        

        
    </div>

    
    
    <div class="post-toc">
        <h3>Table of Contents</h3>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#一分析程序的运行时间与cpu利用率情况">一、分析程序的运行时间与CPU利用率情况</a>
      <ul>
        <li><a href="#shell内置time指令">shell内置time指令</a></li>
        <li><a href="#usrbintime指令">/usr/bin/time指令</a></li>
      </ul>
    </li>
    <li><a href="#二分析golang程序的内存使用情况">二、分析golang程序的内存使用情况</a>
      <ul>
        <li><a href="#内存占用情况查看">内存占用情况查看</a></li>
        <li><a href="#使用godebug与gctrace来分析程序的内存使用情况">使用GODEBUG与gctrace来分析程序的内存使用情况</a></li>
        <li><a href="#runtimereadmemstats">runtime.ReadMemStats</a>
          <ul>
            <li>
              <ul>
                <li><a href="#pprof工具">pprof工具</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#三分析golang程序的cpu性能情况">三、分析Golang程序的CPU性能情况</a>
      <ul>
        <li><a href="#cpu性能测试代码">CPU性能测试代码</a></li>
        <li><a href="#使用pprof-web界面查看">使用pprof-Web界面查看</a></li>
        <li><a href="#使用pprof工具查看">使用pprof工具查看</a></li>
        <li><a href="#通过go-tool-pprof得到profile文件">通过go tool pprof得到profile文件</a></li>
        <li><a href="#可视化查看">可视化查看</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    

    <hr />

    <div class="content">
        <blockquote>
<p>原文地址：https://www.yuque.com/aceld/golang/ga6pb1</p></blockquote>
<h1 id="一分析程序的运行时间与cpu利用率情况">一、分析程序的运行时间与CPU利用率情况 <a href="#%e4%b8%80%e5%88%86%e6%9e%90%e7%a8%8b%e5%ba%8f%e7%9a%84%e8%bf%90%e8%a1%8c%e6%97%b6%e9%97%b4%e4%b8%8ecpu%e5%88%a9%e7%94%a8%e7%8e%87%e6%83%85%e5%86%b5" class="anchor">🔗</a></h1><h2 id="shell内置time指令">shell内置time指令 <a href="#shell%e5%86%85%e7%bd%aetime%e6%8c%87%e4%bb%a4" class="anchor">🔗</a></h2><p>这个方法不算新颖，但是确很实用。 <code>time</code>是Unix/Linux内置多命令，使用时一般不用传过多参数，直接跟上需要调试多程序即可。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>time go run main.go 
</span></span><span style="display:flex;"><span>斐波那契数列第30项的值为： <span style="color:#ae81ff">55</span>
</span></span><span style="display:flex;"><span>real	0m0.843s
</span></span><span style="display:flex;"><span>user	0m0.216s
</span></span><span style="display:flex;"><span>sys	0m0.389s
</span></span></code></pre></div><p>上面是使用time对 go run main.go对执行程序做了性能分析，得到3个指标。</p>
<ul>
<li>real:从程序开始到结束，实际度过的时间；</li>
<li>user:程序在用户态度过的时间；</li>
<li>sys:程序在系统态度过时间。
一般情况下 real &gt;= user + sys，因为系统还有其它进程(切换其他进程中间对于本进程会有空白期)。</li>
</ul>
<h2 id="usrbintime指令">/usr/bin/time指令 <a href="#usrbintime%e6%8c%87%e4%bb%a4" class="anchor">🔗</a></h2><p>这个指令比内置的time更加详细一些，使用的时候需要用绝对路径，而且要加上参数<code>-v</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/bin/time -v go run main.go  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	Command being timed: <span style="color:#e6db74">&#34;go run main.go&#34;</span>
</span></span><span style="display:flex;"><span>	User time <span style="color:#f92672">(</span>seconds<span style="color:#f92672">)</span>: 0.12
</span></span><span style="display:flex;"><span>	System time <span style="color:#f92672">(</span>seconds<span style="color:#f92672">)</span>: 0.06
</span></span><span style="display:flex;"><span>	Percent of CPU this job got: 115%
</span></span><span style="display:flex;"><span>	Elapsed <span style="color:#f92672">(</span>wall clock<span style="color:#f92672">)</span> time <span style="color:#f92672">(</span>h:mm:ss or m:ss<span style="color:#f92672">)</span>: 0:00.16
</span></span><span style="display:flex;"><span>	Average shared text size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Average unshared data size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Average stack size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Average total size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Maximum resident set size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">41172</span>
</span></span><span style="display:flex;"><span>	Average resident set size <span style="color:#f92672">(</span>kbytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Major <span style="color:#f92672">(</span>requiring I/O<span style="color:#f92672">)</span> page faults: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	Minor <span style="color:#f92672">(</span>reclaiming a frame<span style="color:#f92672">)</span> page faults: <span style="color:#ae81ff">15880</span>
</span></span><span style="display:flex;"><span>	Voluntary context switches: <span style="color:#ae81ff">897</span>
</span></span><span style="display:flex;"><span>	Involuntary context switches: <span style="color:#ae81ff">183</span>
</span></span><span style="display:flex;"><span>	Swaps: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	File system inputs: <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>	File system outputs: <span style="color:#ae81ff">2664</span>
</span></span><span style="display:flex;"><span>	Socket messages sent: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Socket messages received: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Signals delivered: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	Page size <span style="color:#f92672">(</span>bytes<span style="color:#f92672">)</span>: <span style="color:#ae81ff">4096</span>
</span></span><span style="display:flex;"><span>	Exit status: <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h1 id="二分析golang程序的内存使用情况">二、分析golang程序的内存使用情况 <a href="#%e4%ba%8c%e5%88%86%e6%9e%90golang%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%86%85%e5%ad%98%e4%bd%bf%e7%94%a8%e6%83%85%e5%86%b5" class="anchor">🔗</a></h1><h2 id="内存占用情况查看">内存占用情况查看 <a href="#%e5%86%85%e5%ad%98%e5%8d%a0%e7%94%a8%e6%83%85%e5%86%b5%e6%9f%a5%e7%9c%8b" class="anchor">🔗</a></h2><p>我们先写一段demo例子代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;runtime&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//slice 会动态扩容，用slice来做堆内存申请</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">container</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop begin.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">32</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">container</span> = append(<span style="color:#a6e22e">container</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop end.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Start.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">test</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;force gc.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GC</span>() <span style="color:#75715e">//强制调用gc回收</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Done.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">3600</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>) <span style="color:#75715e">//睡眠，保持程序不退出</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>编译</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>go build -o snippet_mem <span style="color:#f92672">&amp;&amp;</span> ./snippet_mem
</span></span></code></pre></div><p>然后在./snippet_mem进程没有执行完，再开一个窗口，通过<code>top</code>命令查看进程的内存占用情况</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>top -p <span style="color:#66d9ef">$(</span>pidof snippet_mem<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><p>得到结果如下
<img src="/img/godebug1.png" alt="godebug1">
我们看出来，没有退出的snippet_mem进程有约830m的内存被占用。</p>
<p>直观上来说，这个程序在test()函数执行完后，切片contaner的内存应该被释放，不应该占用830M那么大。</p>
<h2 id="使用godebug与gctrace来分析程序的内存使用情况">使用GODEBUG与gctrace来分析程序的内存使用情况 <a href="#%e4%bd%bf%e7%94%a8godebug%e4%b8%8egctrace%e6%9d%a5%e5%88%86%e6%9e%90%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%86%85%e5%ad%98%e4%bd%bf%e7%94%a8%e6%83%85%e5%86%b5" class="anchor">🔗</a></h2><p>执行snippet_mem程序之前添加环境变量GODEBUG=&lsquo;gctrace=1&rsquo;来跟踪打印垃圾回收器信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>GODEBUG<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gctrace=1&#39;</span> ./snippet_mem
</span></span></code></pre></div><p>设置gctrace=1会使得垃圾回收器在每次回收时汇总所回收内存的大小以及耗时，
并将这些内容汇总成单行内容打印到标准错误输出中。
格式</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>gc # @#s #%: #+#+# ms clock, #+#/#/#+# ms cpu, #-&gt;#-&gt;# MB, # MB goal, # P
</span></span></code></pre></div><p>含义</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>gc #        GC次数的编号，每次GC时递增
</span></span><span style="display:flex;"><span>@#s         距离程序开始执行时的时间
</span></span><span style="display:flex;"><span>#%          GC占用的执行时间百分比
</span></span><span style="display:flex;"><span>#+...+#     GC使用的时间
</span></span><span style="display:flex;"><span>#-&gt;#-&gt;# MB  GC开始，结束，以及当前活跃堆内存的大小，单位M
</span></span><span style="display:flex;"><span># MB goal   全局堆内存大小
</span></span><span style="display:flex;"><span># P         使用processor的数量
</span></span></code></pre></div><p>例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>gc 15 @0.123s 4%: 0.051+43+0.003 ms clock, 0.83+0/44/0+0.057 ms cpu, 277-&gt;277-&gt;94 MB, 277 MB goal, 0 MB stacks, 0 MB globals, 16 P
</span></span></code></pre></div><p>该条信息含义如下：</p>
<ul>
<li><code>gc 15</code>:Gc 调试编号为15</li>
<li><code>@0.123s</code>:此时程序已经执行了0.123s</li>
<li><code>4%:</code>:0.123s中其中gc模块占用了4%的时间</li>
<li><code>0.051+43+0.003 ms clock</code>:垃圾回收的时间，分别为STW（stop-the-world）清扫的时间+并发标记和扫描的时间+STW标记的时间</li>
<li><code>0.83+0/44/0+0.057 ms cpu</code>: 垃圾回收占用cpu时间</li>
<li><code>277-&gt;277-&gt;94 MB</code>: GC开始前堆内存277M， GC结束后堆内存277M，当前活跃的堆内存94M</li>
<li><code>277 MB goal</code>: 全局堆内存大小277M</li>
<li><code>0 MB stacks</code>: 栈内存大小0M</li>
<li><code>0 MB globals</code>: 全局变量内存大小0M</li>
<li><code>16 P</code>: 使用processor的数量16</li>
</ul>
<p>了解了GC的调试信息读法后，接下来我们来分析一下本次GC的结果。
执行GODEBUG调试</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>GODEBUG<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gctrace=1&#39;</span> ./snippet_mem
</span></span></code></pre></div><p>输出结果如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>2024/09/19 21:04:09  ===&gt; loop begin.
</span></span><span style="display:flex;"><span>gc 1 @0.003s 2%: 0.040+2.0+0.012 ms clock, 0.81+0/2.1/0+0.24 ms cpu, 4-&gt;4-&gt;1 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 2 @0.006s 4%: 0.027+8.1+0.14 ms clock, 0.55+0/6.6/0+2.9 ms cpu, 4-&gt;5-&gt;3 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 3 @0.015s 4%: 0.026+2.9+0.010 ms clock, 0.52+0/2.9/0+0.21 ms cpu, 7-&gt;7-&gt;2 MB, 8 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 4 @0.019s 22%: 0.050+1.1+5.2 ms clock, 1.0+0/1.1/0+105 ms cpu, 6-&gt;10-&gt;7 MB, 6 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 5 @0.026s 17%: 0.028+10+0.014 ms clock, 0.56+0/10/0+0.29 ms cpu, 19-&gt;19-&gt;6 MB, 19 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 6 @0.037s 12%: 0.031+14+0.067 ms clock, 0.63+0/4.5/0.001+1.3 ms cpu, 14-&gt;24-&gt;18 MB, 14 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 7 @0.067s 8%: 0.037+44+0.21 ms clock, 0.75+0/44/0+4.2 ms cpu, 46-&gt;46-&gt;28 MB, 46 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 8 @0.116s 7%: 0.035+25+0.028 ms clock, 0.71+0/24/0+0.57 ms cpu, 72-&gt;72-&gt;44 MB, 72 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 9 @0.150s 6%: 0.036+53+0.059 ms clock, 0.72+0/53/0+1.1 ms cpu, 113-&gt;113-&gt;38 MB, 113 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 10 @0.204s 6%: 0.079+9.0+0.011 ms clock, 1.5+0/8.9/0+0.23 ms cpu, 86-&gt;86-&gt;48 MB, 86 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 11 @0.213s 6%: 0.10+19+0.23 ms clock, 2.1+0/19/0+4.6 ms cpu, 108-&gt;108-&gt;108 MB, 108 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 12 @0.283s 5%: 0.025+40+0.024 ms clock, 0.50+0/40/0+0.48 ms cpu, 277-&gt;277-&gt;169 MB, 277 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 13 @0.408s 4%: 0.035+101+0.006 ms clock, 0.70+0/101/0+0.12 ms cpu, 433-&gt;433-&gt;147 MB, 433 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 14 @0.510s 4%: 0.011+18+0.005 ms clock, 0.22+0/18/0+0.10 ms cpu, 330-&gt;330-&gt;183 MB, 330 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 15 @0.529s 4%: 0.010+36+0.011 ms clock, 0.20+0/36/0+0.22 ms cpu, 413-&gt;413-&gt;229 MB, 413 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>2024/09/19 21:04:10  ===&gt; loop end.
</span></span><span style="display:flex;"><span>2024/09/19 21:04:10 force gc.
</span></span><span style="display:flex;"><span>gc 16 @0.566s 4%: 0.022+116+0.004 ms clock, 0.45+0/116/0+0.094 ms cpu, 516-&gt;516-&gt;0 MB, 516 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span><span style="display:flex;"><span>gc 17 @0.682s 4%: 0.080+0.17+0.073 ms clock, 1.6+0/0.15/0+1.4 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P (forced)
</span></span><span style="display:flex;"><span>2024/09/19 21:04:10 Done.
</span></span><span style="display:flex;"><span>GC forced
</span></span><span style="display:flex;"><span>gc 18 @121.392s 0%: 0.029+0.29+0.004 ms clock, 0.59+0/0.31/0+0.093 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 20 P
</span></span></code></pre></div><p>分析</p>
<p>先看在test()函数执行完后立即打印的gc 16那行的信息。516-&gt;516-&gt;0 MB, 516 MB goal表示垃圾回收器已经把516M的内存标记为非活跃的内存。</p>
<p>再看下一个记录gc 17行0-&gt;0-&gt;0 MB, 4 MB goal表示垃圾回收器中的全局堆内存大小由888M下降为4M。</p>
<p>结论</p>
<ul>
<li>在test()函数执行完后，demo程序中的切片容器所申请的堆空间都被垃圾回收器回收了。</li>
<li>如果此时在top指令查询内存的时候，如果依然是800+MB，说明垃圾回收器回收了应用层的内存后，<code>（可能）并不会立即将内存归还给系统</code>。</li>
</ul>
<h2 id="runtimereadmemstats">runtime.ReadMemStats <a href="#runtimereadmemstats" class="anchor">🔗</a></h2><p>接下来换另一种方式查看内存的方式 利用 <code>runtime</code>库里的<code>ReadMemStats()</code>方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;runtime&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readMemStats</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ms</span> <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">MemStats</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">ReadMemStats</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ms</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34; ===&gt; Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)&#34;</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">Alloc</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">HeapIdle</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">HeapReleased</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//slice 会动态扩容，用slice来做堆内存申请</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">container</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop begin.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">32</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">container</span> = append(<span style="color:#a6e22e">container</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">i</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop end.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [Start].&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">test</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [force gc].&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GC</span>() <span style="color:#75715e">//强制调用gc回收</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [Done].&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">3600</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>) <span style="color:#75715e">//睡眠，保持程序不退出</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这里我们， 封装了一个函数<code>readMemStats()</code>，这里面主要是调用runtime中的<code>ReadMemStats()</code>方法获得内存信息，然后通过<code>log</code>打印出来。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">run</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">17</span>  <span style="color:#f92672">==</span>=&gt; [<span style="color:#a6e22e">Start</span>].
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">17</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">71280</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">66633728</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">66600960</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">17</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">loop</span> <span style="color:#a6e22e">begin</span>.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">18</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">132535744</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">336756736</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">155721728</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">loop</span> <span style="color:#a6e22e">end</span>.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">598300600</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">609181696</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">434323456</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; [<span style="color:#a6e22e">force</span> <span style="color:#a6e22e">gc</span>].
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; [<span style="color:#a6e22e">Done</span>].
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">55840</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207427072</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">434266112</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">38</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">56656</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207394304</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">434266112</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">48</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">56912</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207394304</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">1206493184</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">58</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">57488</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207394304</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">1206493184</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">22</span>:<span style="color:#ae81ff">08</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">57616</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207394304</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">1206493184</span>(<span style="color:#a6e22e">bytes</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">c2020</span><span style="color:#f92672">/</span><span style="color:#ae81ff">03</span><span style="color:#f92672">/</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">18</span>:<span style="color:#ae81ff">22</span>:<span style="color:#ae81ff">18</span>  <span style="color:#f92672">==</span>=&gt; <span style="color:#a6e22e">Alloc</span>:<span style="color:#ae81ff">57744</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapIdle</span>:<span style="color:#ae81ff">1207394304</span>(<span style="color:#a6e22e">bytes</span>) <span style="color:#a6e22e">HeapReleased</span>:<span style="color:#ae81ff">1206493184</span>(<span style="color:#a6e22e">by</span>
</span></span></code></pre></div><p>说明：</p>
<ul>
<li>Alloc：已分配但尚未释放的内存字节数，包括堆内存和栈内存等</li>
<li>HeapIdle：当前未使用但仍然保留给堆的内存字节数（即可以快速重新使用的内存）</li>
<li>HeapReleased：已归还给操作系统（但未来可能再次申请）的堆内存字节数</li>
</ul>
<p>可以看到，打印<code>[Done]</code>.之后那条trace信息，Alloc已经下降，即内存已被垃圾回收器回收。在2025/09/19 21:17:31和2020/03/02 18:21:48的两条trace信息中，HeapReleased开始上升，即垃圾回收器把内存归还给系统。</p>
<blockquote>
<p>更多MemStats说明：<a href="https://pkg.go.dev/runtime#MemStats">https://pkg.go.dev/runtime#MemStats</a></p></blockquote>
<h4 id="pprof工具">pprof工具 <a href="#pprof%e5%b7%a5%e5%85%b7" class="anchor">🔗</a></h4><p>pprof工具支持网页上查看内存的使用情况，需要在代码中添加一个协程即可。</p>
<p>完整示例代码:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;runtime&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_</span> <span style="color:#e6db74">&#34;net/http/pprof&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readMemStats</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ms</span> <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">MemStats</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">ReadMemStats</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ms</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34; ===&gt; Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)&#34;</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">Alloc</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">HeapIdle</span>, <span style="color:#a6e22e">ms</span>.<span style="color:#a6e22e">HeapReleased</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//slice 会动态扩容，用slice来做堆内存申请</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">container</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop begin.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">32</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">container</span> = append(<span style="color:#a6e22e">container</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">i</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop end.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//启动pprof</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;0.0.0.0:10000&#34;</span>, <span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [Start].&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">test</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [force gc].&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GC</span>() <span style="color:#75715e">//强制调用gc回收</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; [Done].&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">readMemStats</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">3600</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>) <span style="color:#75715e">//睡眠，保持程序不退出</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>访问：http://127.0.0.1:10000/debug/pprof/heap?debug=1 查看</p>
<p>浏览器的内容其中有一部分如下，记录了目前的内存情况</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># runtime.MemStats
</span></span><span style="display:flex;"><span># Alloc = 393328
</span></span><span style="display:flex;"><span># TotalAlloc = 1503610448
</span></span><span style="display:flex;"><span># Sys = 991758840
</span></span><span style="display:flex;"><span># Lookups = 0
</span></span><span style="display:flex;"><span># Mallocs = 1023
</span></span><span style="display:flex;"><span># Frees = 233
</span></span><span style="display:flex;"><span># HeapAlloc = 393328
</span></span><span style="display:flex;"><span># HeapSys = 985137152
</span></span><span style="display:flex;"><span># HeapIdle = 984096768
</span></span><span style="display:flex;"><span># HeapInuse = 1040384
</span></span><span style="display:flex;"><span># HeapReleased = 984006656
</span></span><span style="display:flex;"><span># HeapObjects = 790
</span></span><span style="display:flex;"><span># Stack = 524288 / 524288
</span></span><span style="display:flex;"><span># MSpan = 75680 / 81600
</span></span><span style="display:flex;"><span># MCache = 24000 / 31200
</span></span><span style="display:flex;"><span># BuckHashSys = 1450271
</span></span><span style="display:flex;"><span># GCSys = 3206184
</span></span><span style="display:flex;"><span># OtherSys = 1328145
</span></span><span style="display:flex;"><span># NextGC = 4194304
</span></span><span style="display:flex;"><span># LastGC = 1758288816398705240
</span></span></code></pre></div><h1 id="三分析golang程序的cpu性能情况">三、分析Golang程序的CPU性能情况 <a href="#%e4%b8%89%e5%88%86%e6%9e%90golang%e7%a8%8b%e5%ba%8f%e7%9a%84cpu%e6%80%a7%e8%83%bd%e6%83%85%e5%86%b5" class="anchor">🔗</a></h1><h2 id="cpu性能测试代码">CPU性能测试代码 <a href="#cpu%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e4%bb%a3%e7%a0%81" class="anchor">🔗</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;bytes&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_</span> <span style="color:#e6db74">&#34;net/http/pprof&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">test</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop begin.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">1000</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">genSomeBytes</span>())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34; ===&gt; loop end.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//生成一个随机字符串</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">genSomeBytes</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">buff</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">20000</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">buff</span>.<span style="color:#a6e22e">Write</span>([]<span style="color:#66d9ef">byte</span>{<span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">+</span> byte(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">10</span>))})
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">buff</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">test</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//启动pprof</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;0.0.0.0:10000&#34;</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="使用pprof-web界面查看">使用pprof-Web界面查看 <a href="#%e4%bd%bf%e7%94%a8pprof-web%e7%95%8c%e9%9d%a2%e6%9f%a5%e7%9c%8b" class="anchor">🔗</a></h2><p>浏览器访问: http://127.0.0.1:10000/debug/pprof/
<img src="/img/godebug2.png" alt="godebug2">
我们可以直接点击网页的profile,浏览器会给我们下载一个profile文件.</p>
<h2 id="使用pprof工具查看">使用pprof工具查看 <a href="#%e4%bd%bf%e7%94%a8pprof%e5%b7%a5%e5%85%b7%e6%9f%a5%e7%9c%8b" class="anchor">🔗</a></h2><p>将下载的profile文件和go的二进制文件一起放在同一个目录下，然后执行如下命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>go tool pprof <span style="color:#f92672">[</span>binary<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>profile<span style="color:#f92672">]</span>
</span></span></code></pre></div><ul>
<li>binary:go可执行的二进制文件</li>
<li>profile:web界面下载的profile文件</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>go tool pprof ./democpu profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>File: democpu
</span></span><span style="display:flex;"><span>Type: cpu
</span></span><span style="display:flex;"><span>Time: Mar 3, 2020 at 11:18pm (CST)
</span></span><span style="display:flex;"><span>Duration: 30.13s, Total samples = 6.27s (20.81%)
</span></span><span style="display:flex;"><span>Entering interactive mode (type &#34;help&#34; for commands, &#34;o&#34; for options)
</span></span><span style="display:flex;"><span>(pprof)
</span></span></code></pre></div><p>help可以查看一些指令,我么可以通过top来查看cpu的性能情况.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>(pprof) top
</span></span><span style="display:flex;"><span>Showing nodes accounting for 5090ms, 81.18% of 6270ms total
</span></span><span style="display:flex;"><span>Dropped 80 nodes (cum <span style="color:#960050;background-color:#1e0010">&lt;</span>= 31.35ms)
</span></span><span style="display:flex;"><span>Showing top 10 nodes out of 60
</span></span><span style="display:flex;"><span>      flat  flat%   sum%        cum   cum%
</span></span><span style="display:flex;"><span>    1060ms 16.91% 16.91%     2170ms 34.61%  math/rand.(*lockedSource).Int63
</span></span><span style="display:flex;"><span>     850ms 13.56% 30.46%      850ms 13.56%  sync.(*Mutex).Unlock (inline)
</span></span><span style="display:flex;"><span>     710ms 11.32% 41.79%     2950ms 47.05%  math/rand.(*Rand).Int31n
</span></span><span style="display:flex;"><span>     570ms  9.09% 50.88%      990ms 15.79%  bytes.(*Buffer).Write
</span></span><span style="display:flex;"><span>     530ms  8.45% 59.33%      540ms  8.61%  syscall.Syscall
</span></span><span style="display:flex;"><span>     370ms  5.90% 65.23%      370ms  5.90%  runtime.procyield
</span></span><span style="display:flex;"><span>     270ms  4.31% 69.54%     4490ms 71.61%  main.genSomeBytes
</span></span><span style="display:flex;"><span>     250ms  3.99% 73.52%     3200ms 51.04%  math/rand.(*Rand).Intn
</span></span><span style="display:flex;"><span>     250ms  3.99% 77.51%      250ms  3.99%  runtime.memmove
</span></span><span style="display:flex;"><span>     230ms  3.67% 81.18%      690ms 11.00%  runtime.suspendG
</span></span><span style="display:flex;"><span>(pprof)
</span></span></code></pre></div><p>这里面有几列数据,需要说明一下.</p>
<ul>
<li>flat：当前函数占用CPU的耗时</li>
<li>flat%：:当前函数占用CPU的耗时百分比</li>
<li>sum%：函数占用CPU的耗时累计百分比</li>
<li>cum：当前函数加上调用当前函数的函数占用CPU的总耗时</li>
<li>cum%：当前函数加上调用当前函数的函数占用CPU的总耗时百分比</li>
<li>最后一列：函数名称</li>
</ul>
<h2 id="通过go-tool-pprof得到profile文件">通过go tool pprof得到profile文件 <a href="#%e9%80%9a%e8%bf%87go-tool-pprof%e5%be%97%e5%88%b0profile%e6%96%87%e4%bb%b6" class="anchor">🔗</a></h2><p>web下载的默认是30s,通过下面命令可以得到60s的profile文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>go tool pprof http://localhost:10000/debug/pprof/profile?seconds<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span> go tool pprof http://localhost:10000/debug/pprof/profile?seconds=60
</span></span><span style="display:flex;"><span>Fetching profile over HTTP from http://localhost:10000/debug/pprof/profile?seconds=60
</span></span><span style="display:flex;"><span>Saved profile in /home/abner/pprof/pprof.procpu.samples.cpu.001.pb.gz
</span></span><span style="display:flex;"><span>File: procpu
</span></span><span style="display:flex;"><span>Type: cpu
</span></span><span style="display:flex;"><span>Time: Sep 19, 2024 at 10:28pm (CST)
</span></span><span style="display:flex;"><span>Duration: 60.16s, Total samples = 18.90s (31.42%)
</span></span><span style="display:flex;"><span>Entering interactive mode (type &#34;help&#34; for commands, &#34;o&#34; for options)
</span></span><span style="display:flex;"><span>(pprof) top
</span></span><span style="display:flex;"><span>Showing nodes accounting for 14990ms, 79.31% of 18900ms total
</span></span><span style="display:flex;"><span>Dropped 191 nodes (cum <span style="color:#960050;background-color:#1e0010">&lt;</span>= 94.50ms)
</span></span><span style="display:flex;"><span>Showing top 10 nodes out of 74
</span></span><span style="display:flex;"><span>      flat  flat%   sum%        cum   cum%
</span></span><span style="display:flex;"><span>    3650ms 19.31% 19.31%     8440ms 44.66%  math/rand.(*Rand).Int31n
</span></span><span style="display:flex;"><span>    2960ms 15.66% 34.97%     2960ms 15.66%  internal/runtime/syscall.Syscall6
</span></span><span style="display:flex;"><span>    2770ms 14.66% 49.63%     2770ms 14.66%  internal/chacha8rand.block
</span></span><span style="display:flex;"><span>    1190ms  6.30% 55.93%     3050ms 16.14%  bytes.(*Buffer).Write
</span></span><span style="display:flex;"><span>    1160ms  6.14% 62.06%     1160ms  6.14%  runtime.memmove
</span></span><span style="display:flex;"><span>     780ms  4.13% 66.19%    14010ms 74.13%  main.genSomeBytes
</span></span><span style="display:flex;"><span>     780ms  4.13% 70.32%     3970ms 21.01%  runtime.rand
</span></span><span style="display:flex;"><span>     660ms  3.49% 73.81%     9100ms 48.15%  math/rand.(*Rand).Intn
</span></span><span style="display:flex;"><span>     550ms  2.91% 76.72%    10130ms 53.60%  math/rand.Intn
</span></span><span style="display:flex;"><span>     490ms  2.59% 79.31%     4790ms 25.34%  math/rand.(*Rand).Int63 (inline)
</span></span><span style="display:flex;"><span>(pprof) 
</span></span></code></pre></div><h2 id="可视化查看">可视化查看 <a href="#%e5%8f%af%e8%a7%86%e5%8c%96%e6%9f%a5%e7%9c%8b" class="anchor">🔗</a></h2><p>输入web</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>go tool pprof ./democpu profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>File: democpu
</span></span><span style="display:flex;"><span>Type: cpu
</span></span><span style="display:flex;"><span>Time: Mar 3, 2020 at 11:18pm (CST)
</span></span><span style="display:flex;"><span>Duration: 30.13s, Total samples = 6.27s (20.81%)
</span></span><span style="display:flex;"><span>Entering interactive mode (type &#34;help&#34; for commands, &#34;o&#34; for options)
</span></span><span style="display:flex;"><span>(pprof) web
</span></span></code></pre></div><p>这里如果报找不到graphviz工具,需要安装一下
Ubuntu安装:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo apt-get install graphviz
</span></span></code></pre></div><p>Mac安装:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>brew install graphviz
</span></span></code></pre></div><p>Win安装:
下载https://graphviz.gitlab.io/_pages/Download/Download_windows.html
将graphviz安装目录下的bin文件夹添加到Path环境变量中。 在终端输入dot -version查看是否安装成功。</p>
<p><img src="/img/godebug3.png" alt="godebug3"></p>

    </div>

    
</section>


            </div>
            <div class="side">
                <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/ai">ai(3)</a>
            </li>
        
            <li>
                <a href="/categories/go">go(23)</a>
            </li>
        
            <li>
                <a href="/categories/%E4%BB%A3%E7%A0%81">代码(2)</a>
            </li>
        
            <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7">工具(7)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%80%86%E5%90%91">逆向(3)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%9D%A2%E8%AF%95">面试(4)</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/android/">Recent Android</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/android/redroid%E4%BD%BF%E7%94%A8/">Redroid安卓容器</a>
            </li>
        
            <li>
                <a href="/android/%E5%85%A5%E9%97%A8/">逆向环境-杂</a>
            </li>
        
            <li>
                <a href="/android/frida%E6%95%99%E7%A8%8B/">frida教程</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/llm/">Recent Llm</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/">Transformers-入门篇</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/">AI模型VLLM部署</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">AI模型微调</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/go/">Recent Go</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/">Go三色标记混合写屏障GC模式全总结</a>
            </li>
        
            <li>
                <a href="/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/">Go中make与new区别</a>
            </li>
        
            <li>
                <a href="/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">Go常用bug和性能问题的实践方法</a>
            </li>
        
            <li>
                <a href="/go/grpc%E6%80%BB%E7%BB%93/">GRPC笔记</a>
            </li>
        
            <li>
                <a href="/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/">Go的defer总结</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/tool/">Recent Tool</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tool/vscode%E6%8A%98%E8%85%BE/">vscode折腾</a>
            </li>
        
            <li>
                <a href="/tool/linux-ubuntu%E4%BC%98%E5%8C%96/">Ubuntu开机优化</a>
            </li>
        
            <li>
                <a href="/tool/shell-ssh_script/">ssh常用脚本</a>
            </li>
        
            <li>
                <a href="/tool/mac-%E4%BC%98%E5%8C%96/">Mac优化</a>
            </li>
        
            <li>
                <a href="/tool/git-%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/">git命令大全</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/note/">Recent Note</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">缓存穿透、雪崩、击穿的解决方法</a>
            </li>
        
            <li>
                <a href="/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/">单线程的redis为什么快</a>
            </li>
        
            <li>
                <a href="/note/redis-%E6%80%BB%E7%BB%93/">redis总结</a>
            </li>
        
            <li>
                <a href="/note/mysql-%E6%80%BB%E7%BB%93/">mysql总结</a>
            </li>
        
            <li>
                <a href="/note/java-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90/">JAVA代码生成</a>
            </li>
        
    </ul>
</div>

                
            </div>
        </main>
        <footer class="footer">
    <div class="footer-row">
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/android/index.xml">
                    Feed of Android
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/llm/index.xml">
                    Feed of Llm
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/go/index.xml">
                    Feed of Go
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/tool/index.xml">
                    Feed of Tool
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/note/index.xml">
                    Feed of Note
                    <i class="icofont-rss"></i>
                </a>
            
        

        
            
            
        
    </div>

    
</footer>

    </body>
</html>
