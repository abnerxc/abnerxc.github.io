<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">




<title>Goçš„deferæ€»ç»“ | Abnerçš„åšå®¢</title>
<link rel="canonical" href="https://abnerxc.github.io/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/">
<meta property="og:type" content="article" />
<meta property="og:title" content="Goçš„deferæ€»ç»“ | Abnerçš„åšå®¢" />
<meta property="og:url" content="https://abnerxc.github.io/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/" />








<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/custom.css" />
<script src="/js/copy-code-block.js"></script>
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    </head>

    <body>
        <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://abnerxc.github.io/">Abnerçš„åšå®¢</a>

        <nav class="menu">
            
        </nav>
    </div>
</header>

        <main class="main-wrapper">
            <div class="main">
                

<section class="single">
    <h1 class="title">Goçš„deferæ€»ç»“</h1>

    <div class="tip">
        <time datetime="2024-03-15 18:35:11 &#43;0800 CST">2024/03/15</time>
        <span class="split">Â·</span>
        <span> 550 words </span>
        <span class="split">Â·</span>
        <span>
            3 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/go">Go</a>
            
        </div>
        

        
    </div>

    
    
    <div class="post-toc">
        <h3>ç›®å½•</h3>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€deferæ‰§è¡Œé¡ºåº">ä¸€ã€deferæ‰§è¡Œé¡ºåº</a></li>
    <li><a href="#äºŒdeferä¸returnè°å…ˆè°å">äºŒã€deferä¸returnè°å…ˆè°å</a></li>
    <li><a href="#ä¸‰å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ–">ä¸‰ã€å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ–</a></li>
    <li><a href="#å››æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ">å››ã€æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ</a></li>
    <li><a href="#äº”deferé‡è§panic">äº”ã€deferé‡è§panic</a></li>
    <li><a href="#å…­deferä¸­åŒ…å«panic">å…­ã€deferä¸­åŒ…å«panic</a></li>
    <li><a href="#ä¸ƒdeferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•°">ä¸ƒã€deferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•°</a></li>
    <li><a href="#å…«deferä¸­çš„å‘">å…«ã€deferä¸­çš„å‘</a></li>
  </ul>
</nav>
    </div>
    

    <hr />

    <div class="content">
        <h1 id="ä¸€deferæ‰§è¡Œé¡ºåº">ä¸€ã€deferæ‰§è¡Œé¡ºåº <a href="#%e4%b8%80defer%e6%89%a7%e8%a1%8c%e9%a1%ba%e5%ba%8f" class="anchor">ğŸ”—</a></h1><p>å¤šä¸ªdeferå‡ºç°çš„æ—¶å€™ï¼Œ<strong>å®ƒæ˜¯ä¸€ä¸ªâ€œæ ˆâ€çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯å…ˆè¿›åå‡º</strong>ã€‚ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå†™åœ¨å‰é¢çš„deferä¼šæ¯”å†™åœ¨åé¢çš„deferè°ƒç”¨çš„æ™šã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">func1</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">func2</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">func3</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">func1</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;A&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">func2</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;B&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">func3</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;C&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img src="/img/go-defer1.jpeg" alt="go-defer">
è¾“å‡ºç»“æœï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>C
</span></span><span style="display:flex;"><span>B
</span></span><span style="display:flex;"><span>A
</span></span></code></pre></div><h1 id="äºŒdeferä¸returnè°å…ˆè°å">äºŒã€deferä¸returnè°å…ˆè°å <a href="#%e4%ba%8cdefer%e4%b8%8ereturn%e8%b0%81%e5%85%88%e8%b0%81%e5%90%8e" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">deferFunc</span>() <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;defer func called&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">returnFunc</span>() <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;return func called&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">returnAndDefer</span>() <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">deferFunc</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">returnFunc</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">returnAndDefer</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ‰§è¡Œç»“æœä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>return func called
</span></span><span style="display:flex;"><span>defer func called
</span></span></code></pre></div><p>ç»“è®ºä¸ºï¼šreturnä¹‹åçš„è¯­å¥å…ˆæ‰§è¡Œï¼Œdeferåçš„è¯­å¥åæ‰§è¡Œ</p>
<h1 id="ä¸‰å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ–">ä¸‰ã€å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ– <a href="#%e4%b8%89%e5%87%bd%e6%95%b0%e7%9a%84%e8%bf%94%e5%9b%9e%e5%80%bc%e5%88%9d%e5%a7%8b%e5%8c%96" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">DeferFunc1</span>(<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>) (<span style="color:#a6e22e">t</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;t = &#34;</span>, <span style="color:#a6e22e">t</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">DeferFunc11</span>(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// output t=0</span>
</span></span></code></pre></div><p>è¯æ˜ï¼Œåªè¦å£°æ˜å‡½æ•°çš„è¿”å›å€¼å˜é‡åç§°ï¼Œå°±ä¼šåœ¨å‡½æ•°åˆå§‹åŒ–æ—¶å€™ä¸ºä¹‹èµ‹å€¼ä¸º0ï¼Œè€Œä¸”åœ¨å‡½æ•°ä½“ä½œç”¨åŸŸå¯è§ã€‚</p>
<h1 id="å››æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ">å››ã€æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ <a href="#%e5%9b%9b%e6%9c%89%e5%90%8d%e5%87%bd%e6%95%b0%e8%bf%94%e5%9b%9e%e5%80%bc%e9%81%87%e8%a7%81defer%e6%83%85%e5%86%b5" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">returnButDefer</span>() (<span style="color:#a6e22e">t</span> <span style="color:#66d9ef">int</span>) {  <span style="color:#75715e">//tåˆå§‹åŒ–0ï¼Œ å¹¶ä¸”ä½œç”¨åŸŸä¸ºè¯¥å‡½æ•°å…¨åŸŸ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">t</span> = <span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">returnButDefer</span>())
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// output t=10</span>
</span></span></code></pre></div><p>è¯¥returnButDefer()æœ¬åº”çš„è¿”å›å€¼æ˜¯1ï¼Œä½†æ˜¯åœ¨returnä¹‹åï¼Œåˆè¢«deferçš„åŒ¿åfuncå‡½æ•°æ‰§è¡Œï¼Œæ‰€ä»¥t=t*10è¢«æ‰§è¡Œï¼Œæœ€åreturnButDefer()è¿”å›ç»™ä¸Šå±‚main()çš„ç»“æœä¸º10</p>
<h1 id="äº”deferé‡è§panic">äº”ã€deferé‡è§panic <a href="#%e4%ba%94defer%e9%81%87%e8%a7%81panic" class="anchor">ğŸ”—</a></h1><p>æ ¹æ®çŸ¥è¯†ç‚¹2ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œdeferé‡è§returnæƒ…å†µå¦‚ä¸‹ï¼š
<img src="/img/go-defer2.jpeg" alt="go-defer2">
é‚£ä¹ˆï¼Œé‡åˆ°panicæ—¶ï¼Œéå†æœ¬åç¨‹çš„deferé“¾è¡¨ï¼Œå¹¶æ‰§è¡Œdeferã€‚åœ¨æ‰§è¡Œdeferè¿‡ç¨‹ä¸­:é‡åˆ°recoveråˆ™åœæ­¢panicï¼Œè¿”å›recoverå¤„ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰é‡åˆ°recoverï¼Œéå†å®Œæœ¬åç¨‹çš„deferé“¾è¡¨åï¼Œå‘stderræŠ›å‡ºpanicä¿¡æ¯ã€‚
<img src="/img/go-defer3.jpeg" alt="go-defer3"></p>
<h2 id="deferé‡è§panicä½†æ˜¯å¹¶ä¸æ•è·å¼‚å¸¸çš„æƒ…å†µ">deferé‡è§panicï¼Œä½†æ˜¯å¹¶ä¸æ•è·å¼‚å¸¸çš„æƒ…å†µ <a href="#defer%e9%81%87%e8%a7%81panic%e4%bd%86%e6%98%af%e5%b9%b6%e4%b8%8d%e6%8d%95%e8%8e%b7%e5%bc%82%e5%b8%b8%e7%9a%84%e6%83%85%e5%86%b5" class="anchor">ğŸ”—</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">defer_call</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;main æ­£å¸¸ç»“æŸ&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">defer_call</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() { <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;defer: panic ä¹‹å‰1&#34;</span>) }()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() { <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;defer: panic ä¹‹å‰2&#34;</span>) }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    panic(<span style="color:#e6db74">&#34;å¼‚å¸¸å†…å®¹&#34;</span>)  <span style="color:#75715e">//è§¦å‘deferå‡ºæ ˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() { <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;defer: panic ä¹‹åï¼Œæ°¸è¿œæ‰§è¡Œä¸åˆ°&#34;</span>) }()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç»“æœ:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>// output
</span></span><span style="display:flex;"><span>defer: panic ä¹‹å‰2
</span></span><span style="display:flex;"><span>defer: panic ä¹‹å‰1
</span></span><span style="display:flex;"><span>panic: å¼‚å¸¸å†…å®¹
</span></span><span style="display:flex;"><span>//... å¼‚å¸¸å †æ ˆä¿¡æ¯
</span></span></code></pre></div><h2 id="deferé‡è§panicå¹¶æ•è·å¼‚å¸¸">deferé‡è§panicï¼Œå¹¶æ•è·å¼‚å¸¸ <a href="#defer%e9%81%87%e8%a7%81panic%e5%b9%b6%e6%8d%95%e8%8e%b7%e5%bc%82%e5%b8%b8" class="anchor">ğŸ”—</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">defer_call</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;main æ­£å¸¸ç»“æŸ&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">defer_call</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;defer: panic ä¹‹å‰1, æ•è·å¼‚å¸¸&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> recover(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() { <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;defer: panic ä¹‹å‰2, ä¸æ•è·&#34;</span>) }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    panic(<span style="color:#e6db74">&#34;å¼‚å¸¸å†…å®¹&#34;</span>)  <span style="color:#75715e">//è§¦å‘deferå‡ºæ ˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() { <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;defer: panic ä¹‹å, æ°¸è¿œæ‰§è¡Œä¸åˆ°&#34;</span>) }()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç»“æœ:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>defer: panic ä¹‹å‰2, ä¸æ•è·
</span></span><span style="display:flex;"><span>defer: panic ä¹‹å‰1, æ•è·å¼‚å¸¸
</span></span><span style="display:flex;"><span>å¼‚å¸¸å†…å®¹
</span></span><span style="display:flex;"><span>main æ­£å¸¸ç»“æŸ
</span></span></code></pre></div><p>defer æœ€å¤§çš„åŠŸèƒ½æ˜¯ panic åä¾ç„¶æœ‰æ•ˆ
æ‰€ä»¥deferå¯ä»¥ä¿è¯ä½ çš„ä¸€äº›èµ„æºä¸€å®šä¼šè¢«å…³é—­ï¼Œä»è€Œé¿å…ä¸€äº›å¼‚å¸¸å‡ºç°çš„é—®é¢˜ã€‚</p>
<h1 id="å…­deferä¸­åŒ…å«panic">å…­ã€deferä¸­åŒ…å«panic <a href="#%e5%85%addefer%e4%b8%ad%e5%8c%85%e5%90%abpanic" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>()  {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> recover(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span>{
</span></span><span style="display:flex;"><span>           <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>       }<span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>           <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;fatal&#34;</span>)
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        panic(<span style="color:#e6db74">&#34;defer panic&#34;</span>)
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    panic(<span style="color:#e6db74">&#34;panic&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç»“æœ:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>defer panic
</span></span></code></pre></div><p>åˆ†æ
<strong>panicä»…æœ‰æœ€åä¸€ä¸ªå¯ä»¥è¢«revoveræ•è·ã€‚</strong></p>
<p>è§¦å‘<code>panic(&quot;panic&quot;)</code>ådeferé¡ºåºå‡ºæ ˆæ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„deferä¸­ ä¼šæœ‰panic(&ldquo;defer panic&rdquo;)å¼‚å¸¸è¯­å¥ï¼Œè¿™ä¸ªå¼‚å¸¸å°†ä¼šè¦†ç›–æ‰mainä¸­çš„å¼‚å¸¸panic(&ldquo;panic&rdquo;)ï¼Œæœ€åè¿™ä¸ªå¼‚å¸¸è¢«ç¬¬äºŒä¸ªæ‰§è¡Œçš„deferæ•è·åˆ°ã€‚</p>
<h1 id="ä¸ƒdeferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•°">ä¸ƒã€deferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•° <a href="#%e4%b8%83defer%e4%b8%8b%e7%9a%84%e5%87%bd%e6%95%b0%e5%8f%82%e6%95%b0%e5%8c%85%e5%90%ab%e5%ad%90%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">function</span>(<span style="color:#a6e22e">index</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">index</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">index</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">function</span>(<span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">function</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">function</span>(<span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">function</span>(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç»“æœ:</p>
<pre tabindex="0"><code>3
4
2
1
</code></pre><p>åˆ†æï¼š
è¿™é‡Œï¼Œæœ‰4ä¸ªå‡½æ•°ï¼Œä»–ä»¬çš„indexåºå·åˆ†åˆ«ä¸º1ï¼Œ2ï¼Œ3ï¼Œ4ã€‚</p>
<p>é‚£ä¹ˆè¿™4ä¸ªå‡½æ•°çš„å…ˆåæ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œé¢æœ‰ä¸¤ä¸ªdeferï¼Œ æ‰€ä»¥deferä¸€å…±ä¼šå‹æ ˆä¸¤æ¬¡ï¼Œå…ˆè¿›æ ˆ1ï¼Œåè¿›æ ˆ2ã€‚ é‚£ä¹ˆåœ¨å‹æ ˆfunction1çš„æ—¶å€™ï¼Œéœ€è¦è¿åŒå‡½æ•°åœ°å€ã€å‡½æ•°å½¢å‚ä¸€åŒè¿›æ ˆï¼Œé‚£ä¹ˆä¸ºäº†å¾—åˆ°function1çš„ç¬¬äºŒä¸ªå‚æ•°çš„ç»“æœï¼Œæ‰€ä»¥å°±éœ€è¦å…ˆæ‰§è¡Œfunction3å°†ç¬¬äºŒä¸ªå‚æ•°ç®—å‡ºï¼Œé‚£ä¹ˆfunction3å°±è¢«ç¬¬ä¸€ä¸ªæ‰§è¡Œã€‚åŒç†å‹æ ˆfunction2ï¼Œå°±éœ€è¦æ‰§è¡Œfunction4ç®—å‡ºfunction2ç¬¬äºŒä¸ªå‚æ•°çš„å€¼ã€‚ç„¶åå‡½æ•°ç»“æŸï¼Œå…ˆå‡ºæ ˆfuction2ã€å†å‡ºæ ˆfunction1.</p>
<p>æ‰€ä»¥é¡ºåºå¦‚ä¸‹ï¼š</p>
<ul>
<li>deferå‹æ ˆfunction1ï¼Œå‹æ ˆå‡½æ•°åœ°å€ã€å½¢å‚1ã€å½¢å‚2(è°ƒç”¨function3) &ndash;&gt; æ‰“å°3</li>
<li>deferå‹æ ˆfunction2ï¼Œå‹æ ˆå‡½æ•°åœ°å€ã€å½¢å‚1ã€å½¢å‚2(è°ƒç”¨function4) &ndash;&gt; æ‰“å°4</li>
<li>deferå‡ºæ ˆfunction2, è°ƒç”¨function2 &ndash;&gt; æ‰“å°2</li>
<li>deferå‡ºæ ˆfunction1, è°ƒç”¨function1&ndash;&gt; æ‰“å°1</li>
</ul>
<h1 id="å…«deferä¸­çš„å‘">å…«ã€deferä¸­çš„å‘ <a href="#%e5%85%abdefer%e4%b8%ad%e7%9a%84%e5%9d%91" class="anchor">ğŸ”—</a></h1><h2 id="defer-nilå‡½æ•°">defer nilå‡½æ•° <a href="#defer-nil%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">run</span> <span style="color:#66d9ef">func</span>() = <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">run</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;runs&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//output</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">runs</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">panic</span>: <span style="color:#a6e22e">runtime</span> <span style="color:#66d9ef">error</span>: <span style="color:#a6e22e">invalid</span> <span style="color:#a6e22e">memory</span> <span style="color:#a6e22e">address</span> <span style="color:#a6e22e">or</span> <span style="color:#66d9ef">nil</span> <span style="color:#a6e22e">pointer</span> <span style="color:#a6e22e">dereference</span>
</span></span></code></pre></div><p>åä¸º func çš„å‡½æ•°ä¸€ç›´è¿è¡Œè‡³ç»“æŸï¼Œç„¶å defer å‡½æ•°ä¼šè¢«æ‰§è¡Œä¸”ä¼šå› ä¸ºå€¼ä¸º nil è€Œäº§ç”Ÿ panic å¼‚å¸¸ã€‚ç„¶è€Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œrun() çš„å£°æ˜æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºåœ¨å¤–å›´å‡½æ•°è¿è¡Œå®Œæˆåå®ƒæ‰ä¼šè¢«è°ƒç”¨ã€‚</p>
<h2 id="å¾ªç¯ä¸­ä½¿ç”¨defer">å¾ªç¯ä¸­ä½¿ç”¨defer <a href="#%e5%be%aa%e7%8e%af%e4%b8%ad%e4%bd%bf%e7%94%a8defer" class="anchor">ğŸ”—</a></h2><p><code>æ…é‡åœ¨å¾ªç¯ä¸­ä½¿ç”¨defer</code>ï¼Œå› ä¸ºç»“æœå‡ºäººæ„æ–™</p>
<pre tabindex="0"><code>func demo(){
	for{
		row,err:=db.Query(&#34;select .....&#34;)
		if err!=nil{
			...
		}
		defer row.close()
	}
}
</code></pre><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œdefer row.Close() åœ¨å¾ªç¯ä¸­çš„å»¶è¿Ÿå‡½æ•°ä¼šåœ¨å‡½æ•°ç»“æŸè¿‡åè¿è¡Œï¼Œè€Œä¸æ˜¯æ¯æ¬¡ for å¾ªç¯ç»“æŸä¹‹åã€‚è¿™äº›å»¶è¿Ÿå‡½æ•°ä¼šä¸åœåœ°å †ç§¯åˆ°å»¶è¿Ÿè°ƒç”¨æ ˆä¸­ï¼Œæœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆ1ï¼šä¸ä½¿ç”¨defer</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">demo</span>(){
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">row</span>,<span style="color:#a6e22e">err</span><span style="color:#f92672">:=</span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;select .....&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">nil</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">row</span>.close()
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è§£å†³æ–¹æ¡ˆ2ï¼šç§»äº¤ç»™å‡½æ•°
è¿™æ ·æ¯æ¬¡åŒ¿åå‡½æ•°æ‰§è¡Œå®Œï¼Œä¼šæ‰§è¡Œdefer</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">demo</span>(){
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">func</span>(){
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">row</span>,<span style="color:#a6e22e">err</span><span style="color:#f92672">:=</span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;select .....&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">nil</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">row</span>.close()
</span></span><span style="display:flex;"><span>		}()
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="å»¶è¿Ÿè°ƒç”¨å«æœ‰é—­åŒ…çš„å‡½æ•°">å»¶è¿Ÿè°ƒç”¨å«æœ‰é—­åŒ…çš„å‡½æ•° <a href="#%e5%bb%b6%e8%bf%9f%e8%b0%83%e7%94%a8%e5%90%ab%e6%9c%89%e9%97%ad%e5%8c%85%e7%9a%84%e5%87%bd%e6%95%b0" class="anchor">ğŸ”—</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">database</span> <span style="color:#66d9ef">struct</span>{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">database</span>) <span style="color:#a6e22e">connect</span>() (<span style="color:#a6e22e">disconnect</span> <span style="color:#66d9ef">func</span>()) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;connect&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;disconnect&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//è¿è¡Œ </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">db</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">database</span>{}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">connect</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;query db...&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//output</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">query</span> <span style="color:#a6e22e">db</span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">connect</span>
</span></span></code></pre></div><p>æœ€ç»ˆ disconnect å¹¶æ²¡æœ‰è¾“å‡ºï¼Œæœ€ååªæœ‰ connect ï¼Œè¿™æ˜¯ä¸€ä¸ª bugï¼Œæœ€ç»ˆçš„æƒ…å†µæ˜¯ connect() æ‰§è¡Œç»“æŸåï¼Œå…¶æ‰§è¡ŒåŸŸå¾—ä»¥è¢«ä¿å­˜èµ·æ¥ï¼Œä½†å†…éƒ¨çš„é—­åŒ…å¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<p>è§£å†³æ–¹æ¡ˆ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">db</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">database</span>{}  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">close</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">connect</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> close()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;query db...&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="åœ¨æ‰§è¡Œå—ä¸­ä½¿ç”¨-defer">åœ¨æ‰§è¡Œå—ä¸­ä½¿ç”¨ defer <a href="#%e5%9c%a8%e6%89%a7%e8%a1%8c%e5%9d%97%e4%b8%ad%e4%bd%bf%e7%94%a8-defer" class="anchor">ğŸ”—</a></h2><p>æƒ³è¦åœ¨æ‰§è¡Œå—æ‰§è¡Œç»“æŸåæ‰§è¡Œåœ¨å—å†…å»¶è¿Ÿè°ƒç”¨çš„å‡½æ•°ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ï¼Œå®ƒä»¬åªä¼šåœ¨å—æ‰€å±çš„å‡½æ•°æ‰§è¡Œç»“æŸåæ‰è¢«æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µé€‚ç”¨äºæ‰€æœ‰çš„ä»£ç å—é™¤äº†ä¸Šæ–‡çš„å‡½æ•°å—ä¾‹å¦‚ï¼Œforï¼Œswitch ç­‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;block: defer runs&#34;</span>)
</span></span><span style="display:flex;"><span>        }()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;block: ends&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;main: ends&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//output</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">block</span>: <span style="color:#a6e22e">ends</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">main</span>: <span style="color:#a6e22e">ends</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">block</span>: <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">runs</span>
</span></span></code></pre></div><p>è§£å†³æ–¹æ¡ˆ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;func: defer runs&#34;</span>)
</span></span><span style="display:flex;"><span>        }()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;func: ends&#34;</span>)
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;main: ends&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    </div>

    
</section>


            </div>
            <div class="side">
                <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/ai">ai(3)</a>
            </li>
        
            <li>
                <a href="/categories/go">go(23)</a>
            </li>
        
            <li>
                <a href="/categories/%E4%BB%A3%E7%A0%81">ä»£ç (2)</a>
            </li>
        
            <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7">å·¥å…·(8)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%80%86%E5%90%91">é€†å‘(3)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%9D%A2%E8%AF%95">é¢è¯•(5)</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/note/">Recent Note</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/">åœºæ™¯æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿çš„è§£å†³æ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/">å•çº¿ç¨‹çš„redisä¸ºä»€ä¹ˆå¿«</a>
            </li>
        
            <li>
                <a href="/note/redis-%E6%80%BB%E7%BB%93/">redisæ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/mysql-%E6%80%BB%E7%BB%93/">mysqlæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/android/">Recent Android</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/android/redroid%E4%BD%BF%E7%94%A8/">Redroidå®‰å“å®¹å™¨</a>
            </li>
        
            <li>
                <a href="/android/%E5%85%A5%E9%97%A8/">é€†å‘ç¯å¢ƒ-æ‚</a>
            </li>
        
            <li>
                <a href="/android/frida%E6%95%99%E7%A8%8B/">fridaæ•™ç¨‹</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/tool/">Recent Tool</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tool/linux-almalinux%E4%BC%98%E5%8C%96/">AlmaLinux10</a>
            </li>
        
            <li>
                <a href="/tool/almalinux-k8s/">AlmaLinux-k8så®‰è£…</a>
            </li>
        
            <li>
                <a href="/tool/vscode%E6%8A%98%E8%85%BE/">vscodeæŠ˜è…¾</a>
            </li>
        
            <li>
                <a href="/tool/linux-ubuntu%E4%BC%98%E5%8C%96/">Ubuntuå¼€æœºä¼˜åŒ–</a>
            </li>
        
            <li>
                <a href="/tool/shell-ssh_script/">sshå¸¸ç”¨è„šæœ¬</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/llm/">Recent Llm</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/">Transformers-å…¥é—¨ç¯‡</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/">AIæ¨¡å‹VLLMéƒ¨ç½²</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">AIæ¨¡å‹å¾®è°ƒ</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/go/">Recent Go</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/">Goä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/">Goä¸­makeä¸newåŒºåˆ«</a>
            </li>
        
            <li>
                <a href="/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/go/grpc%E6%80%BB%E7%BB%93/">GRPCç¬”è®°</a>
            </li>
        
            <li>
                <a href="/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/">Goçš„deferæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
            </div>
        </main>
        <footer class="footer">
    <div class="footer-row">
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/note/index.xml">
                    Feed of Note
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/android/index.xml">
                    Feed of Android
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/tool/index.xml">
                    Feed of Tool
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/llm/index.xml">
                    Feed of Llm
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/go/index.xml">
                    Feed of Go
                    <i class="icofont-rss"></i>
                </a>
            
        

        
            
            
        
    </div>

    
</footer>

    </body>
</html>
