<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">




<title>GoåŸºç¡€-å­—ç¬¦ä¸²é«˜æ•ˆæ‹¼ | Abnerçš„åšå®¢</title>
<link rel="canonical" href="https://abnerxc.github.io/go/base2.%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%AB%98%E6%95%88%E6%8B%BC%E6%8E%A5/">
<meta property="og:type" content="article" />
<meta property="og:title" content="GoåŸºç¡€-å­—ç¬¦ä¸²é«˜æ•ˆæ‹¼ | Abnerçš„åšå®¢" />
<meta property="og:url" content="https://abnerxc.github.io/go/base2.%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%AB%98%E6%95%88%E6%8B%BC%E6%8E%A5/" />








<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/custom.css" />
<script src="/js/copy-code-block.js"></script>
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    </head>

    <body>
        <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://abnerxc.github.io/">Abnerçš„åšå®¢</a>

        <nav class="menu">
            
        </nav>
    </div>
</header>

        <main class="main-wrapper">
            <div class="main">
                

<section class="single">
    <h1 class="title">GoåŸºç¡€-å­—ç¬¦ä¸²é«˜æ•ˆæ‹¼</h1>

    <div class="tip">
        <time datetime="2019-01-15 18:35:11 &#43;0800 CST">2019/01/15</time>
        <span class="split">Â·</span>
        <span> 923 words </span>
        <span class="split">Â·</span>
        <span>
            5 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/go">Go</a>
            
        </div>
        

        
    </div>

    
    
    <div class="post-toc">
        <h3>ç›®å½•</h3>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#å·æ‹¼æ¥">+å·æ‹¼æ¥</a></li>
    <li><a href="#fmt-æ‹¼æ¥">fmt æ‹¼æ¥</a></li>
    <li><a href="#join-æ‹¼æ¥">Join æ‹¼æ¥</a></li>
    <li><a href="#buffer-æ‹¼æ¥">buffer æ‹¼æ¥</a></li>
    <li><a href="#builder-æ‹¼æ¥">builder æ‹¼æ¥</a></li>
    <li><a href="#æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯”</a></li>
    <li><a href="#ç–‘é—®">ç–‘é—®</a></li>
    <li><a href="#æ‹¼æ¥å‡½æ•°æ”¹é€ ">æ‹¼æ¥å‡½æ•°æ”¹é€ </a></li>
    <li><a href="#æµ‹è¯•ç”¨ä¾‹">æµ‹è¯•ç”¨ä¾‹</a></li>
    <li><a href="#100ä¸ªå­—ç¬¦ä¸²">100ä¸ªå­—ç¬¦ä¸²</a></li>
    <li><a href="#1000-ä¸ªå­—ç¬¦ä¸²">1000 ä¸ªå­—ç¬¦ä¸²ã€‚</a></li>
    <li><a href="#å°ç»“">å°ç»“</a></li>
    <li><a href="#builder-æ…¢åœ¨å“ª">Builder æ…¢åœ¨å“ª</a></li>
    <li><a href="#å†…å­˜åˆ†é…ä¼˜åŒ–">å†…å­˜åˆ†é…ä¼˜åŒ–</a></li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
  </ul>
</nav>
    </div>
    

    <hr />

    <div class="content">
        <h1 id="å·æ‹¼æ¥">+å·æ‹¼æ¥ <a href="#%e5%8f%b7%e6%8b%bc%e6%8e%a5" class="anchor">ğŸ”—</a></h1><p>è¿™ç§æ‹¼æ¥æœ€ç®€å•ï¼Œä¹Ÿæœ€å®¹æ˜“è¢«æˆ‘ä»¬ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯ä¸é™ç¼–ç¨‹è¯­è¨€çš„ï¼Œæ¯”å¦‚Goè¯­è¨€æœ‰ï¼ŒJavaä¹Ÿæœ‰ï¼Œå®ƒä»¬æ˜¯+å·è¿ç®—ç¬¦ï¼Œåœ¨è¿è¡Œæ—¶è®¡ç®—çš„ã€‚ç°åœ¨æ¼”ç¤ºä¸‹è¿™ç§æ‹¼æ¥çš„ä»£ç ï¼Œè™½ç„¶æ¯”è¾ƒç®€å•ã€‚</p>
<pre tabindex="0"><code>func StringPlus() string{
	var s string
	s+=&#34;æ˜µç§°&#34;+&#34;:&#34;+&#34;é£é›ªæ— æƒ…&#34;+&#34;\n&#34;
	s+=&#34;åšå®¢&#34;+&#34;:&#34;+&#34;http://www.flysnow.org/&#34;+&#34;\n&#34;
	s+=&#34;å¾®ä¿¡å…¬ä¼—å·&#34;+&#34;:&#34;+&#34;flysnow_org&#34;
	return s
}
</code></pre><p>æˆ‘ä»¬å¯ä»¥è‡ªå·±å†™ä¸ªç”¨ä¾‹æµ‹è¯•ä¸‹ï¼Œå¯ä»¥æ‰“å°å‡ºå’Œæˆ‘ä»¬ä¾‹å­ä¸­ä¸€æ ·çš„å†…å®¹ã€‚é‚£ä¹ˆè¿™ç§æœ€å¸¸è§çš„å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼æ€§èƒ½æ€ä¹ˆæ ·çš„å‘¢ï¼Œæˆ‘ä»¬æµ‹è¯•ä¸‹ï¼š</p>
<pre tabindex="0"><code>func BenchmarkStringPlus(b *testing.B) {
	for i:=0;i&lt;b.N;i++{
		StringPlus()
	}
}
</code></pre><p>è¿è¡Œ<code>go test -bench=. -benchmem</code> æŸ¥çœ‹æ€§èƒ½è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>BenchmarkStringPlus-8   20000000    108 ns/op   144 B/op    2 allocs/op
</code></pre><p>æ¯æ¬¡æ“ä½œéœ€è¦108ns,è¿›è¡Œ2æ¬¡å†…å­˜åˆ†é…ï¼Œåˆ†é…114å­—èŠ‚çš„å†…å­˜ã€‚</p>
<h1 id="fmt-æ‹¼æ¥">fmt æ‹¼æ¥ <a href="#fmt-%e6%8b%bc%e6%8e%a5" class="anchor">ğŸ”—</a></h1><p>è¿™ç§æ‹¼æ¥ï¼Œå€ŸåŠ©äº<code>fmt.Sprint</code>ç³»åˆ—å‡½æ•°è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åè¿”å›æ‹¼æ¥çš„å­—ç¬¦ä¸²ã€‚</p>
<pre tabindex="0"><code>func StringFmt() string{
	return fmt.Sprint(&#34;æ˜µç§°&#34;,&#34;:&#34;,&#34;é£é›ªæ— æƒ…&#34;,&#34;\n&#34;,&#34;åšå®¢&#34;,&#34;:&#34;,&#34;http://www.flysnow.org/&#34;,&#34;\n&#34;,&#34;å¾®ä¿¡å…¬ä¼—å·&#34;,&#34;:&#34;,&#34;flysnow_org&#34;)
}

func BenchmarkStringFmt(b *testing.B) {
	for i:=0;i&lt;b.N;i++{
		StringFmt()
	}
}
</code></pre><p>è¿è¡ŒæŸ¥çœ‹æµ‹è¯•ç»“æœï¼š</p>
<pre tabindex="0"><code>BenchmarkStringFmt-8    5000000     385 ns/op   80 B/op     1 allocs/op
</code></pre><p><font color=red>è™½ç„¶æ¯æ¬¡æ“ä½œå†…å­˜åˆ†é…åªæœ‰1æ¬¡ï¼Œåˆ†é…80å­—èŠ‚ä¹Ÿä¸å¤šï¼Œä½†æ˜¯æ¯æ¬¡æ“ä½œè€—æ—¶å¤ªé•¿ï¼Œæ€§èƒ½è¿œæ²¡æœ‰<code>+</code>å·æ“ä½œå¿«ã€‚</font></p>
<h1 id="join-æ‹¼æ¥">Join æ‹¼æ¥ <a href="#join-%e6%8b%bc%e6%8e%a5" class="anchor">ğŸ”—</a></h1><p>è¿™ä¸ªæ˜¯åˆ©ç”¨<code>strings.Join</code>å‡½æ•°è¿›è¡Œæ‹¼æ¥ï¼Œæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè½¬æ¢ä¸ºä¸€ä¸ªæ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²ã€‚</p>
<pre tabindex="0"><code>func StringJoin() string{
	s:=[]string{&#34;æ˜µç§°&#34;,&#34;:&#34;,&#34;é£é›ªæ— æƒ…&#34;,&#34;\n&#34;,&#34;åšå®¢&#34;,&#34;:&#34;,&#34;http://www.flysnow.org/&#34;,&#34;\n&#34;,&#34;å¾®ä¿¡å…¬ä¼—å·&#34;,&#34;:&#34;,&#34;flysnow_org&#34;}
	return strings.Join(s,&#34;&#34;)
}

func BenchmarkStringJoin(b *testing.B) {
	for i:=0;i&lt;b.N;i++{
		StringJoin()
	}
}
</code></pre><p>ä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠæ€§èƒ½æµ‹è¯•çš„ä»£ç æ”¾ä¸€èµ·äº†ï¼Œç°åœ¨çœ‹çœ‹æ€§èƒ½æµ‹è¯•çš„æ•ˆæœã€‚</p>
<pre tabindex="0"><code>BenchmarkStringJoin-8   10000000    177 ns/op   160 B/op    2 allocs/op
</code></pre><p><font color=red>æ•´ä½“å’Œ<code>+</code>æ“ä½œç›¸å·®ä¸äº†å¤ªå¤šï¼Œå¤§æ¦‚ä½0.5å€çš„æ ·å­ã€‚</font></p>
<h1 id="buffer-æ‹¼æ¥">buffer æ‹¼æ¥ <a href="#buffer-%e6%8b%bc%e6%8e%a5" class="anchor">ğŸ”—</a></h1><p>è¿™ç§è¢«ç”¨çš„ä¹Ÿå¾ˆå¤šï¼Œä½¿ç”¨çš„æ˜¯<code>bytes.Buffer</code>è¿›è¡Œçš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå®ƒæ˜¯éå¸¸çµæ´»çš„ä¸€ä¸ªç»“æ„ä½“ï¼Œä¸æ­¢å¯ä»¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œè¿˜æ˜¯å¯ä»¥<code>byte,rune</code>ç­‰ï¼Œå¹¶ä¸”å®ç°äº†<code>io.Writer</code>æ¥å£ï¼Œå†™å…¥ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚</p>
<pre tabindex="0"><code>func StringBuffer() string {
	var b bytes.Buffer
	b.WriteString(&#34;æ˜µç§°&#34;)
	b.WriteString(&#34;:&#34;)
	b.WriteString(&#34;é£é›ªæ— æƒ…&#34;)
	b.WriteString(&#34;\n&#34;)
	b.WriteString(&#34;åšå®¢&#34;)
	b.WriteString(&#34;:&#34;)
	b.WriteString(&#34;http://www.flysnow.org/&#34;)
	b.WriteString(&#34;\n&#34;)
	b.WriteString(&#34;å¾®ä¿¡å…¬ä¼—å·&#34;)
	b.WriteString(&#34;:&#34;)
	b.WriteString(&#34;flysnow_org&#34;)
	return b.String()
}

func BenchmarkStringBuffer(b *testing.B) {
	for i:=0;i&lt;b.N;i++{
		StringBuffer()
	}
}
</code></pre><p>çœ‹çœ‹ä»–çš„æ€§èƒ½ï¼Œè¿è¡Œè¾“å‡ºå³å¯ï¼š</p>
<pre tabindex="0"><code>BenchmarkStringBuffer-8     5000000     291 ns/op   336 B/op    3 allocs/op
</code></pre><p>å¥½åƒå¹¶ä¸æ˜¯å¤ªå¥½,å’Œæœ€å·®çš„fmtæ‹¼æ¥å·®ä¸å¤šï¼Œå’Œ<code>+</code>å·ï¼ŒJoinæ‹¼æ¥å·®å¥½è¿œï¼Œå†…å­˜åˆ†é…ä¹Ÿæ¯”è¾ƒå¤šã€‚æ¯æ¬¡æ“ä½œè€—æ—¶ä¹Ÿå¾ˆé•¿ã€‚</p>
<h1 id="builder-æ‹¼æ¥">builder æ‹¼æ¥ <a href="#builder-%e6%8b%bc%e6%8e%a5" class="anchor">ğŸ”—</a></h1><p>ä¸ºäº†æ”¹è¿›bufferæ‹¼æ¥çš„æ€§èƒ½ï¼Œä»go 1.10 ç‰ˆæœ¬å¼€å§‹ï¼Œå¢åŠ äº†ä¸€ä¸ªbuilderç±»å‹ï¼Œç”¨äºæå‡å­—ç¬¦ä¸²æ‹¼æ¥çš„æ€§èƒ½ã€‚å®ƒçš„ä½¿ç”¨å’Œbufferå‡ ä¹ä¸€æ ·ã€‚</p>
<pre tabindex="0"><code>func StringBuilder() string {
	var b strings.Builder
	b.WriteString(&#34;æ˜µç§°&#34;)
	b.WriteString(&#34;:&#34;)
	b.WriteString(&#34;é£é›ªæ— æƒ…&#34;)
	b.WriteString(&#34;\n&#34;)
	b.WriteString(&#34;åšå®¢&#34;)
	b.WriteString(&#34;:&#34;)
	b.WriteString(&#34;http://www.flysnow.org/&#34;)
	b.WriteString(&#34;\n&#34;)
	b.WriteString(&#34;å¾®ä¿¡å…¬ä¼—å·&#34;)
	b.WriteString(&#34;:&#34;)
	b.WriteString(&#34;flysnow_org&#34;)
	return b.String()
}

func BenchmarkStringBuilder(b *testing.B) {
	for i:=0;i&lt;b.N;i++{
		StringBuilder()
	}
}
</code></pre><p>å®˜æ–¹éƒ½è¯´æ¯”bufferæ€§èƒ½å¥½äº†ï¼Œæˆ‘ä»¬çœ‹çœ‹æ€§èƒ½æµ‹è¯•çš„ç»“æœã€‚</p>
<pre tabindex="0"><code>BenchmarkStringBuilder-8    10000000    170 ns/op   232 B/op    4 allocs/op
</code></pre><p>çš„ç¡®æå‡äº†ï¼Œæå‡äº†ä¸€å€ï¼Œè™½ç„¶æ¯æ¬¡åˆ†é…çš„å†…å­˜æ¬¡æ•°æœ‰ç‚¹å¤šï¼Œä½†æ˜¯æ¯æ¬¡åˆ†é…çš„å†…å­˜å¤§å°æ¯”bufferè¦å°‘ã€‚</p>
<h1 id="æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯” <a href="#%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94" class="anchor">ğŸ”—</a></h1><p>ä»¥ä¸Šå°±æ˜¯å¸¸ç”¨çš„å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ï¼Œç°åœ¨æˆ‘ä»¬æŠŠè¿™äº›æµ‹è¯•ç»“æœï¼Œæ±‡æ€»åˆ°ä¸€èµ·ï¼Œå¯¹æ¯”ä¸‹çœ‹çœ‹,å› ä¸ºBenchmarkçš„æµ‹è¯•ï¼Œå¯¹äºæ€§èƒ½åªæ˜¾ç¤ºï¼Œæˆ‘æŠŠæµ‹è¯•çš„æ—¶é—´è®¾ç½®ä¸º3sï¼ˆç§’ï¼‰ï¼ŒæŠŠæ—¶é—´æ‹‰é•¿ä¾¿äºå¯¹æ¯”æµ‹è¯•ï¼ŒåŒæ—¶ç”Ÿæˆäº†cpu profileæ–‡ä»¶ï¼Œç”¨äºæ€§èƒ½åˆ†æã€‚</p>
<p>è¿è¡Œ<code>go test xx.go -bench=. -benchmem -benchtime=3s -cpuprofile=profile.out</code>å¾—åˆ°å¦‚ä¸‹æµ‹è¯•ç»“æœï¼š</p>
<pre tabindex="0"><code>StringPlus-8    50000000    112 ns/op   144 B/op    2 allocs/op
StringFmt-8     20000000    344 ns/op   80 B/op     1 allocs/op
StringJoin-8    30000000    171 ns/op   160 B/op    2 allocs/op
StringBuffer-8  20000000    302 ns/op   336 B/op    3 allocs/op
StringBuilder-8 30000000    171 ns/op   232 B/op    4 allocs/op
</code></pre><p>æˆ‘ä»¬é€šè¿‡<code>go tool pprof profile.out</code> çœ‹ä¸‹æˆ‘ä»¬è¾“å‡ºçš„cpu profileä¿¡æ¯ã€‚è¿™é‡Œä¸»è¦ä½¿ç”¨topå‘½ä»¤ã€‚</p>
<pre tabindex="0"><code>Showing top 15 nodes out of 89
      flat  flat%   sum%        cum   cum%
    11.99s 42.55% 42.55%     11.99s 42.55%  runtime.kevent
     6.30s 22.36% 64.90%      6.30s 22.36%  runtime.pthread_cond_wait
     1.65s  5.86% 70.76%      1.65s  5.86%  runtime.pthread_cond_signal
     1.11s  3.94% 74.70%      1.11s  3.94%  runtime.usleep
     1.10s  3.90% 78.60%      1.10s  3.90%  runtime.pthread_cond_timedwait_relative_np
     0.58s  2.06% 80.66%      0.62s  2.20%  runtime.wbBufFlush1
     0.51s  1.81% 82.47%      0.51s  1.81%  runtime.memmove
     0.44s  1.56% 84.03%      1.81s  6.42%  fmt.(*pp).printArg
     0.39s  1.38% 85.42%      2.36s  8.37%  fmt.(*pp).doPrint
     0.36s  1.28% 86.69%      0.70s  2.48%  fmt.(*buffer).WriteString (inline)
     0.34s  1.21% 87.90%      0.93s  3.30%  runtime.mallocgc
     0.20s  0.71% 88.61%      1.20s  4.26%  fmt.(*fmt).fmtS
     0.18s  0.64% 89.25%      0.18s  0.64%  fmt.(*fmt).truncate
     0.16s  0.57% 89.82%      0.16s  0.57%  runtime.memclrNoHeapPointers
     0.15s  0.53% 90.35%      1.35s  4.79%  fmt.(*pp).fmtString
</code></pre><p>å‰15ä¸ªï¼Œå¯ä»¥çœ‹åˆ°fmtæ‹¼æ¥çš„æ–¹å¼æ˜¯æœ€å·®çš„ï¼Œå› ä¸ºfmté‡Œå¾ˆå¤šæ–¹æ³•è€—æ—¶æ’åœ¨äº†æœ€å‰é¢ã€‚bufferçš„WriteStringæ–¹æ³•ä¹Ÿæ¯”è¾ƒè€—æ—¶ã€‚</p>
<p>ä»¥ä¸Šçš„TOPå¯èƒ½è¿˜ä¸æ˜¯å¤ªç›´è§‚ï¼Œå¦‚æœå¤§å®¶çœ‹ç«ç„°å›¾çš„è¯ï¼Œå°±ä¼šæ›´æ¸…æ™°ã€‚æ€§èƒ½æœ€å¥½çš„æ˜¯<code>+</code>å·æ‹¼æ¥ã€Joinæ‹¼æ¥ï¼Œæœ€æ…¢çš„æ˜¯fmtæ‹¼æ¥ï¼Œè¿™é‡Œçš„builderå’Œbufferæ‹¼æ¥å·®ä¸å¤šï¼Œå¹¶æ²¡æœ‰å‘æŒ¥å‡ºå…¶èƒ½åŠ›ã€‚</p>
<h1 id="ç–‘é—®">ç–‘é—® <a href="#%e7%96%91%e9%97%ae" class="anchor">ğŸ”—</a></h1><p>ä»æ•´ä¸ªæ€§èƒ½çš„æµ‹è¯•å’Œåˆ†ææ¥çœ‹ï¼Œæˆ‘ä»¬æœŸå¾…çš„builderå¹¶æ²¡æœ‰å‘æŒ¥å‡ºæ¥ï¼Œè¿™æ˜¯ä¸æ˜¯æ„å‘³ç€builderä¸å®ç”¨äº†å‘¢ï¼Ÿè¿˜ä¸å¦‚+å·å’ŒJoinæ‹¼æ¥å‘¢ï¼Ÿç»§ç»­æ¥ç€åˆ†æ,çŒœæµ‹å¯èƒ½åŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ‹¼æ¥çš„å­—ç¬¦ä¸²å¤§å°</li>
<li>æ‹¼æ¥çš„å­—ç¬¦ä¸²æ•°é‡</li>
</ul>
<h1 id="æ‹¼æ¥å‡½æ•°æ”¹é€ ">æ‹¼æ¥å‡½æ•°æ”¹é€  <a href="#%e6%8b%bc%e6%8e%a5%e5%87%bd%e6%95%b0%e6%94%b9%e9%80%a0" class="anchor">ğŸ”—</a></h1><p>å‰é¢æåˆ°äº†2ç§å¯èƒ½çš„çŒœæµ‹ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²çš„æ•°é‡å’Œæ‹¼æ¥å­—ç¬¦ä¸²çš„å¤§å°ï¼Œç°åœ¨æˆ‘ä»¬å°±å¼€å§‹è¯æ˜è¿™ä¸¤ç§æƒ…å†µï¼Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠåŸæ¥çš„æ‹¼æ¥å‡½æ•°ä¿®æ”¹ä¸€ä¸‹ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ª[]stringç±»å‹çš„å‚æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹åˆ‡ç‰‡æ•°ç»„è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºæ‰€æœ‰çš„æ‹¼æ¥æ–¹æ³•çš„æ”¹é€ åå®ç°ã€‚</p>
<pre tabindex="0"><code>func StringPlus(p []string) string{
	var s string
	l:=len(p)
	for i:=0;i&lt;l;i++{
		s+=p[i]
	}
	return s
}

func StringFmt(p []interface{}) string{
	return fmt.Sprint(p...)
}

func StringJoin(p []string) string{
	return strings.Join(p,&#34;&#34;)
}

func StringBuffer(p []string) string {
	var b bytes.Buffer
	l:=len(p)
	for i:=0;i&lt;l;i++{
		b.WriteString(p[i])
	}
	return b.String()
}

func StringBuilder(p []string) string {
	var b strings.Builder
	l:=len(p)
	for i:=0;i&lt;l;i++{
		b.WriteString(p[i])
	}
	return b.String()
}
</code></pre><h1 id="æµ‹è¯•ç”¨ä¾‹">æµ‹è¯•ç”¨ä¾‹ <a href="#%e6%b5%8b%e8%af%95%e7%94%a8%e4%be%8b" class="anchor">ğŸ”—</a></h1><p>ä»¥ä¸Šçš„å­—ç¬¦ä¸²æ‹¼æ¥å‡½æ•°ä¿®æ”¹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ ä¸åŒå¤§å°çš„åˆ‡ç‰‡è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥æµ‹è¯•äº†ã€‚ä¸ºäº†æ¨¡æ‹Ÿä¸Šæ¬¡çš„æ•ˆæœï¼Œæˆ‘ä»¬å…ˆç”¨10ä¸ªåˆ‡ç‰‡å¤§å°çš„å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥æµ‹è¯•ã€‚</p>
<pre tabindex="0"><code>const BLOG  = &#34;http://www.flysnow.org/&#34;

func initStrings(N int) []string{
	s:=make([]string,N)
	for i:=0;i&lt;N;i++{
		s[i]=BLOG
	}
	return s;
}

func initStringi(N int) []interface{}{
	s:=make([]interface{},N)
	for i:=0;i&lt;N;i++{
		s[i]=BLOG
	}
	return s;
}
</code></pre><p>è¿™æ˜¯ä¸¤ä¸ªæ„å»ºæµ‹è¯•ç”¨ä¾‹åˆ‡ç‰‡æ•°ç»„çš„å‡½æ•°ï¼Œå¯ä»¥ç”ŸæˆNä¸ªå¤§å°çš„åˆ‡ç‰‡ã€‚ç¬¬äºŒä¸ªinitStringiå‡½æ•°è¿”å›çš„æ˜¯[]interface{}ï¼Œè¿™æ˜¯ä¸“é—¨ä¸ºStringFmt(p []interface{})æ‹¼æ¥å‡½æ•°å‡†å¤‡çš„ï¼Œå‡å°‘ç±»å‹ä¹‹é—´çš„è½¬æ¢ã€‚</p>
<p>æœ‰äº†è¿™ä¸¤ä¸ªç”Ÿæˆæµ‹è¯•ç”¨ä¾‹çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»ºæˆ‘ä»¬çš„Goè¯­è¨€æ€§èƒ½æµ‹è¯•äº†ï¼Œæˆ‘ä»¬å…ˆæµ‹è¯•10ä¸ªå¤§å°çš„åˆ‡ç‰‡ã€‚</p>
<pre tabindex="0"><code>func BenchmarkStringPlus10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringPlus(p)
	}
}

func BenchmarkStringFmt10(b *testing.B) {
	p:= initStringi(10)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringFmt(p)
	}
}

func BenchmarkStringJoin10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringJoin(p)
	}
}

func BenchmarkStringBuffer10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringBuffer(p)
	}
}

func BenchmarkStringBuilder10(b *testing.B) {
	p:= initStrings(10)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringBuilder(p)
	}
}
</code></pre><p>åœ¨æ¯ä¸ªæ€§èƒ½æµ‹è¯•å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šè°ƒç”¨b.ResetTimer()ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…æµ‹è¯•ç”¨ä¾‹å‡†å¤‡æ—¶é—´ä¸åŒï¼Œå¸¦æ¥çš„æ€§èƒ½æµ‹è¯•æ•ˆæœåå·®é—®é¢˜
æˆ‘ä»¬è¿è¡Œ<code>go test -bench=. -run=NONE -benchmem</code> æŸ¥çœ‹ç»“æœã€‚</p>
<pre tabindex="0"><code>BenchmarkStringPlus10-8     3000000     593 ns/op   1312 B/op   9 allocs/op
BenchmarkStringFmt10-8      5000000     335 ns/op   240 B/op    1 allocs/op
BenchmarkStringJoin10-8     10000000    200 ns/op   480 B/op    2 allocs/op
BenchmarkStringBuffer10-8   3000000     452 ns/op   864 B/op    4 allocs/op
BenchmarkStringBuilder10-8  10000000    231 ns/op   480 B/op    4 allocs/op
</code></pre><p>é€šè¿‡è¿™æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>+</code>å·æ‹¼æ¥ä¸å†å…·æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºstringæ˜¯ä¸å¯å˜çš„ï¼Œæ¯æ¬¡æ‹¼æ¥éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„<code>string</code>,ä¹Ÿå°±æ˜¯ä¼šè¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œæˆ‘ä»¬ç°åœ¨æ˜¯10ä¸ªå¤§å°çš„åˆ‡ç‰‡ï¼Œæ¯æ¬¡æ“ä½œè¦è¿›è¡Œ9æ¬¡è¿›è¡Œåˆ†é…ï¼Œå ç”¨å†…å­˜ï¼Œæ‰€ä»¥æ¯æ¬¡æ“ä½œæ—¶é—´éƒ½æ¯”è¾ƒé•¿ï¼Œè‡ªç„¶æ€§èƒ½å°±ä½ä¸‹ã€‚</p>
<p>æ–‡ç« ä¸Šé¢å…³äº<code>+</code>æ‹¼æ¥è¿˜æœ‰å°è±¡ï¼Œ<code>+</code>åŠ å·æ‹¼æ¥çš„æ€§èƒ½æµ‹è¯•ä¸­æ˜¾ç¤ºçš„åªæœ‰2æ¬¡å†…å­˜åˆ†é…ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨äº†å¥½å¤šä¸ª<code>+</code>çš„ã€‚</p>
<pre tabindex="0"><code>func StringPlus() string{
	var s string
	s+=&#34;æ˜µç§°&#34;+&#34;:&#34;+&#34;é£é›ªæ— æƒ…&#34;+&#34;\n&#34;
	s+=&#34;åšå®¢&#34;+&#34;:&#34;+&#34;http://www.flysnow.org/&#34;+&#34;\n&#34;
	s+=&#34;å¾®ä¿¡å…¬ä¼—å·&#34;+&#34;:&#34;+&#34;flysnow_org&#34;
	return s
}
</code></pre><p>å†æ¥å›é¡¾ä¸‹è¿™æ®µä»£ç ï¼Œçš„ç¡®æ˜¯æœ‰å¾ˆå¤š+çš„ï¼Œä½†æ˜¯åªæœ‰2æ¬¡å†…å­˜åˆ†é…ï¼Œæˆ‘ä»¬å¯ä»¥å¤§èƒ†çŒœæµ‹,æ˜¯3æ¬¡s+=å¯¼è‡´çš„ï¼Œæ­£å¸¸å’Œæˆ‘ä»¬ä»Šå¤©æµ‹è¯•çš„10ä¸ªé•¿åº¦çš„åˆ‡ç‰‡ï¼Œåªæœ‰9æ¬¡å†…å­˜åˆ†é…ä¸€æ ·ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡è¿è¡Œå¦‚ä¸‹å‘½ä»¤çœ‹ä¸‹Goç¼–è¯‘å™¨å¯¹è¿™æ®µä»£ç çš„ä¼˜åŒ–ï¼š<code>go build -gcflags=&quot;-m -m&quot; main.go</code>,è¾“å‡ºä¸­æœ‰å¦‚ä¸‹å†…å®¹ï¼š</p>
<pre tabindex="0"><code>can inline StringPlus as: func() string { var s string; s = &lt;N&gt;; s += &#34;æ˜µç§°:é£é›ªæ— æƒ…\n&#34;; s += &#34;åšå®¢:http://www.flysnow.org/\n&#34;; s += &#34;å¾®ä¿¡å…¬ä¼—å·:flysnow_org&#34;; return s }
</code></pre><p>ç°åœ¨ä¸€ç›®äº†ç„¶äº†ï¼Œå…¶å®æ˜¯ç¼–è¯‘å™¨å¸®æˆ‘ä»¬æŠŠå­—ç¬¦ä¸²åšäº†ä¼˜åŒ–ï¼Œåªå‰©ä¸‹3ä¸ª<code>s+=</code></p>
<p>è¿™æ¬¡ï¼Œé‡‡ç”¨é•¿åº¦ä¸º10ä¸ªåˆ‡ç‰‡è¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå¾ˆæ˜æ˜¾æµ‹è¯•å‡ºäº†Builderè¦æ¯”Bufferæ€§èƒ½å¥½å¾ˆå¤šï¼Œè¿™ä¸ªé—®é¢˜åŸå› ä¸»è¦è¿˜æ˜¯<code>[]byte</code>å’Œ<code>string</code>ä¹‹é—´çš„è½¬æ¢ï¼Œ<code>Builder</code>æ°æ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<pre tabindex="0"><code>func (b *Builder) String() string {
	return *(*string)(unsafe.Pointer(&amp;b.buf))
}
</code></pre><p>å¾ˆé«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h1 id="100ä¸ªå­—ç¬¦ä¸²">100ä¸ªå­—ç¬¦ä¸² <a href="#100%e4%b8%aa%e5%ad%97%e7%ac%a6%e4%b8%b2" class="anchor">ğŸ”—</a></h1><p>ç°åœ¨æˆ‘ä»¬æµ‹è¯•ä¸‹100ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥çš„æƒ…å†µï¼Œå¯¹äºæˆ‘ä»¬ä¸Šé¢çš„ä»£ç ï¼Œè¦æ”¹é€ éå¸¸å®¹æ˜“ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºæµ‹è¯•ä»£ç ã€‚</p>
<pre tabindex="0"><code>func BenchmarkStringPlus100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringPlus(p)
	}
}

func BenchmarkStringFmt100(b *testing.B) {
	p:= initStringi(100)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringFmt(p)
	}
}

func BenchmarkStringJoin100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringJoin(p)
	}
}

func BenchmarkStringBuffer100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringBuffer(p)
	}
}

func BenchmarkStringBuilder100(b *testing.B) {
	p:= initStrings(100)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringBuilder(p)
	}
}
</code></pre><p>ç°åœ¨è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼Œçœ‹çœ‹100ä¸ªå­—ç¬¦ä¸²è¿æ¥çš„æ€§èƒ½æ€ä¹ˆæ ·ï¼Œå“ªä¸ªå‡½æ•°æœ€é«˜æ•ˆã€‚</p>
<pre tabindex="0"><code>BenchmarkStringPlus100-8    100000  19711 ns/op     123168 B/op     99 allocs/op
BenchmarkStringFmt100-8     500000  2615 ns/op      2304 B/op       1 allocs/op
BenchmarkStringJoin100-8    1000000 1516 ns/op      4608 B/op       2 allocs/op
BenchmarkStringBuffer100-8  500000  2333 ns/op      8112 B/op       7 allocs/op
BenchmarkStringBuilder100-8 1000000 1714 ns/op      6752 B/op       8 allocs/op
</code></pre><p><code>+</code>å·å’Œæˆ‘ä»¬ä¸Šé¢åˆ†æå¾—ä¸€æ ·ï¼Œè¿™æ¬¡æ˜¯99æ¬¡å†…å­˜åˆ†é…ï¼Œæ€§èƒ½ä½“éªŒè¶Šæ¥è¶Šå·®ï¼Œåœ¨åé¢çš„æµ‹è¯•ä¸­ï¼Œä¼šæ’é™¤æ‰ã€‚</p>
<p><code>fmt</code>å’Œ<code>bufrer</code>å·²ç»çš„æ€§èƒ½ä¹Ÿæ²¡æœ‰æå‡ï¼Œç»§ç»­èµ°ä½ã€‚å‰©ä¸‹æ¯”è¾ƒåšæŒºçš„æ˜¯<code>Join</code>å’Œ<code>Builder</code>ã€‚</p>
<h1 id="1000-ä¸ªå­—ç¬¦ä¸²">1000 ä¸ªå­—ç¬¦ä¸²ã€‚ <a href="#1000-%e4%b8%aa%e5%ad%97%e7%ac%a6%e4%b8%b2" class="anchor">ğŸ”—</a></h1><p>æµ‹è¯•ç”¨åŠ›å’Œä¸Šé¢ç« èŠ‚çš„å¤§åŒå°å¼‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥çœ‹æµ‹è¯•ç»“æœã€‚</p>
<pre tabindex="0"><code>BenchmarkStringPlus1000-8       1000    1611985 ns/op   12136228 B/op   999 allocs/op
BenchmarkStringFmt1000-8        50000   28510 ns/op     24590 B/op      1 allocs/op
BenchmarkStringJoin1000-8       100000  15050 ns/op     49152 B/op      2 allocs/op
BenchmarkStringBuffer1000-8     100000  23534 ns/op     122544 B/op     11 allocs/op
BenchmarkStringBuilder1000-8    100000  17996 ns/op     96224 B/op      16 allocs/op
</code></pre><p>æ•´ä½“å’Œ100ä¸ªå­—ç¬¦ä¸²çš„æ—¶å€™å·®ä¸å¤šï¼Œè¡¨ç°å¥½çš„è¿˜æ˜¯<code>Join</code>å’Œ<code>Builder</code>ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½¿ç”¨ä¾§é‡ç‚¹æœ‰äº›ä¸ä¸€æ ·ï¼Œ å¦‚æœæœ‰ç°æˆçš„æ•°ç»„ã€åˆ‡ç‰‡é‚£ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨<code>Join</code>,ä½†æ˜¯å¦‚æœæ²¡æœ‰ï¼Œå¹¶ä¸”è¿½æ±‚çµæ´»æ€§æ‹¼æ¥ï¼Œè¿˜æ˜¯é€‰æ‹©<code>Builder</code>ã€‚ <code>Join</code>è¿˜æ˜¯å®šä½äºæœ‰ç°æˆåˆ‡ç‰‡ã€æ•°ç»„çš„ï¼ˆæ¯•ç«Ÿæ‹¼æ¥æˆæ•°ç»„ä¹Ÿè¦æ—¶é—´ï¼‰ï¼Œå¹¶ä¸”ä½¿ç”¨å›ºå®šæ–¹å¼è¿›è¡Œåˆ†è§£çš„ï¼Œæ¯”å¦‚é€—å·ã€ç©ºæ ¼ç­‰ï¼Œå±€é™æ¯”è¾ƒå¤§ã€‚</p>
<h1 id="å°ç»“">å°ç»“ <a href="#%e5%b0%8f%e7%bb%93" class="anchor">ğŸ”—</a></h1><p>è‡³äº10000ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥æˆ‘è¿™é‡Œå°±ä¸åšæµ‹è¯•äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¯•è¯•ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å¤§åŒå°å¼‚çš„ã€‚</p>
<p>ä»æœ€è¿‘çš„è¿™ä¸¤ç¯‡æ–‡ç« çš„åˆ†ææ¥çœ‹ï¼Œæˆ‘ä»¬å¤§æ¦‚å¯ä»¥æ€»ç»“å‡ºã€‚</p>
<ul>
<li>
<ul>
<li>è¿æ¥é€‚ç”¨äºçŸ­å°çš„ã€å¸¸é‡å­—ç¬¦ä¸²ï¼ˆæ˜ç¡®çš„ï¼Œéå˜é‡ï¼‰ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬ä¼˜åŒ–ã€‚</li>
</ul>
</li>
<li>Joinæ˜¯æ¯”è¾ƒç»Ÿä¸€çš„æ‹¼æ¥ï¼Œä¸å¤ªçµæ´»</li>
<li>fmtå’ŒbufferåŸºæœ¬ä¸Šä¸æ¨è</li>
<li>builderä»æ€§èƒ½å’Œçµæ´»æ€§ä¸Šï¼Œéƒ½æ˜¯ä¸Šä½³çš„é€‰æ‹©ã€‚</li>
</ul>
<h1 id="builder-æ…¢åœ¨å“ª">Builder æ…¢åœ¨å“ª <a href="#builder-%e6%85%a2%e5%9c%a8%e5%93%aa" class="anchor">ğŸ”—</a></h1><p>åœ¨å‰é¢å¯ä»¥çœ‹å‡ºæ¥å°‘é‡æ‹¼æ¥ï¼Œ<code>builder</code>å¹¶ä¸æ˜æ˜¾ï¼Œé‚£ä¹ˆåˆ°åº•æ…¢åœ¨å“ªé‡Œå‘¢ï¼Ÿæ—¢ç„¶è¦ä¼˜åŒ–Builderæ‹¼æ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬èµ·ç çŸ¥é“ä»–æ…¢åœ¨å“ªï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨æˆ‘ä»¬ä¸Šç¯‡æ–‡ç« çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿è¡Œçœ‹ä¸‹æ€§èƒ½ã€‚</p>
<pre tabindex="0"><code>Builder10-8     5000000     258 ns/op       480 B/op        4 allocs/op
Builder100-8    1000000     2012 ns/op      6752 B/op       8 allocs/op
Builder1000-8   100000      21016 ns/op     96224 B/op      16 allocs/op
Builder10000-8  10000       195098 ns/op    1120226 B/op    25 allocs/op
</code></pre><p>é’ˆå¯¹æ—¢ç„¶è¦ä¼˜åŒ–<code>Builder</code>æ‹¼æ¥,é‡‡å–äº†10ã€100ã€1000ã€10000å››ç§ä¸åŒæ•°é‡çš„å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥æµ‹è¯•ã€‚æˆ‘ä»¬å‘ç°æ¯æ¬¡æ“ä½œéƒ½æœ‰ä¸åŒæ¬¡æ•°çš„å†…å­˜åˆ†é…ï¼Œå†…å­˜åˆ†é…è¶Šå¤šï¼Œè¶Šæ…¢ï¼Œå¦‚æœå¼•èµ·GCï¼Œå°±æ›´æ…¢äº†ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆä¼˜åŒ–è¿™ä¸ªï¼Œå‡å°‘å†…å­˜åˆ†é…çš„æ¬¡æ•°ã€‚</p>
<h1 id="å†…å­˜åˆ†é…ä¼˜åŒ–">å†…å­˜åˆ†é…ä¼˜åŒ– <a href="#%e5%86%85%e5%ad%98%e5%88%86%e9%85%8d%e4%bc%98%e5%8c%96" class="anchor">ğŸ”—</a></h1><p>é€šè¿‡cpuprofileï¼ŒæŸ¥çœ‹ç”Ÿæˆçš„ç«ç„°å›¾å¯ä»¥å¾—çŸ¥ï¼Œ<code>runtime.growslice</code>å‡½æ•°ä¼šè¢«é¢‘ç¹çš„è°ƒç”¨ï¼Œå¹¶ä¸”æ—¶é—´å æ¯”ä¹Ÿæ¯”è¾ƒé•¿ã€‚æˆ‘ä»¬æŸ¥çœ‹<code>Builder.WriteString</code>çš„æºä»£ç ï¼š</p>
<pre tabindex="0"><code>func (b *Builder) WriteString(s string) (int, error) {
	b.copyCheck()
	b.buf = append(b.buf, s...)
	return len(s), nil
}
</code></pre><p>å¯ä»¥è‚¯å®šæ˜¯<code>append</code>æ–¹æ³•è§¦å‘äº†<code>runtime.growslice</code>ï¼Œå› ä¸º<code>b.buf</code>çš„å®¹é‡<code>cap</code>ä¸è¶³ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨<code>runtime.growslice</code>æ‰©å……<code>b.buf</code>çš„å®¹é‡ï¼Œç„¶åæ‰å¯ä»¥è¿½åŠ æ–°çš„å…ƒç´ <code>s...</code>ã€‚æ‰©å®¹å®¹é‡è‡ªç„¶ä¼šæ¶‰åŠåˆ°å†…å­˜çš„åˆ†é…ï¼Œè€Œä¸”è¿½åŠ çš„å†…å®¹è¶Šå¤šï¼Œå†…å­˜åˆ†é…çš„æ¬¡æ•°è¶Šå¤šï¼Œè¿™å’Œæˆ‘ä»¬ä¸Šé¢æ€§èƒ½æµ‹è¯•çš„æ•°æ®æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æ—¢ç„¶é—®é¢˜çš„åŸå› æ‰¾åˆ°äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¼˜åŒ–äº†ï¼Œæ ¸å¿ƒæ‰‹æ®µå°±æ˜¯å‡å°‘<code>runtime.growslice</code>è°ƒç”¨ï¼Œç”šè‡³ä¸è°ƒç”¨ã€‚ç…§ç€è¿™ä¸ªæ€è·¯çš„è¯ï¼Œæˆ‘ä»¬å°±è¦æå‰ä¸º<code>b.buf</code>åˆ†é…å¥½å®¹é‡<code>cap</code>ã€‚å¹¸å¥½<code>Builder</code>ä¸ºæˆ‘ä»¬æä¾›äº†æ‰©å……å®¹é‡çš„æ–¹æ³•<code>Grow</code>ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œ<code>WriteString</code>ä¹‹å‰ï¼Œå…ˆé€šè¿‡<code>Grow</code>æ–¹æ³•ï¼Œæ‰©å……å¥½å®¹é‡å³å¯ã€‚</p>
<p>ç°åœ¨å¼€å§‹æ”¹é€ æˆ‘ä»¬çš„StringBuilderå‡½æ•°ã€‚</p>
<pre tabindex="0"><code>func StringBuilder(p []string,cap int) string {
	var b strings.Builder
	l:=len(p)
	b.Grow(cap)
	for i:=0;i&lt;l;i++{
		b.WriteString(p[i])
	}
	return b.String()
}
</code></pre><p>å¢åŠ ä¸€ä¸ªå‚æ•°<code>cap</code>ï¼Œè®©ä½¿ç”¨è€…å‘Šè¯‰æˆ‘ä»¬éœ€è¦çš„å®¹é‡å¤§å°ã€‚<code>Grow</code>æ–¹æ³•çš„å®ç°éå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªé€šè¿‡<code>make</code>å‡½æ•°ï¼Œæ‰©å……<code>b.buf</code>å¤§å°ï¼Œç„¶åå†æ‹·è´<code>b.buf</code>çš„è¿‡ç¨‹ã€‚</p>
<pre tabindex="0"><code>func (b *Builder) grow(n int) {
	buf := make([]byte, len(b.buf), 2*cap(b.buf)+n)
	copy(buf, b.buf)
	b.buf = buf
}
</code></pre><p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬çš„æ€§èƒ½æµ‹è¯•ç”¨ä¾‹å˜æˆå¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>func BenchmarkStringBuilder10(b *testing.B) {
	p:= initStrings(10)
	cap:=10*len(BLOG)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringBuilder(p,cap)
	}
}

func BenchmarkStringBuilder1000(b *testing.B) {
	p:= initStrings(1000)
	cap:=1000*len(BLOG)
	b.ResetTimer()
	for i:=0;i&lt;b.N;i++{
		StringBuilder(p,cap)
	}
}
</code></pre><p>ä¸ºäº†è¯´æ˜æƒ…å†µå’Œç®€çŸ­ä»£ç ï¼Œè¿™é‡Œåªæœ‰10å’Œ1000ä¸ªå…ƒç´ çš„ç”¨ä¾‹ï¼Œå…¶ä»–ç±»ä¼¼ã€‚ä¸ºäº†æŠŠæ€§èƒ½ä¼˜åŒ–åˆ°æè‡´ï¼Œæˆ‘ä¸€æ¬¡æ€§æŠŠéœ€è¦çš„å®¹é‡åˆ†é…è¶³å¤Ÿã€‚ç°åœ¨æˆ‘ä»¬å†è¿è¡Œæ€§èƒ½ï¼ˆBenchmarkï¼‰æµ‹è¯•ä»£ç ã€‚</p>
<pre tabindex="0"><code>Builder10-8     10000000    123 ns/op       352 B/op    1 allocs/op
Builder100-8    2000000     898 ns/op       2688 B/op   1 allocs/op
Builder1000-8   200000      7729 ns/op      24576 B/op  1 allocs/op
Builder10000-8  20000       78678 ns/op     237568 B/op 1 allocs/op
</code></pre><p>æ€§èƒ½è¶³è¶³ç¿»äº†1å€å¤šï¼Œåªæœ‰1æ¬¡å†…å­˜åˆ†é…ï¼Œæ¯æ¬¡æ“ä½œå ç”¨çš„å†…å­˜ä¹Ÿå‡å°‘äº†ä¸€åŠå¤šï¼Œé™ä½äº†GCã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“ <a href="#%e6%80%bb%e7%bb%93" class="anchor">ğŸ”—</a></h1><p>èƒŒåçš„åŸç†ä¹Ÿéå¸¸æ¸…æ¥šï¼Œå°±æ˜¯é¢„å…ˆåˆ†é…å†…å­˜ï¼Œå‡å°‘appendè¿‡ç¨‹ä¸­çš„å†…å­˜é‡æ–°åˆ†é…å’Œæ•°æ®æ‹·è´ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æå‡å¾ˆå¤šçš„æ€§èƒ½ã€‚æ‰€ä»¥å¯¹äºå¯ä»¥é¢„è§çš„é•¿åº¦çš„åˆ‡ï¼Œéƒ½å¯ä»¥æå‰ç”³è¯·ç”³è¯·å¥½å†…å­˜ã€‚</p>
<blockquote>
<p>æœ¬æ–‡æ”¶é›†æ¥æºï¼šhttps://www.flysnow.org</p>
</blockquote>

    </div>

    
</section>


            </div>
            <div class="side">
                <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/ai">ai(3)</a>
            </li>
        
            <li>
                <a href="/categories/go">go(23)</a>
            </li>
        
            <li>
                <a href="/categories/%E4%BB%A3%E7%A0%81">ä»£ç (2)</a>
            </li>
        
            <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7">å·¥å…·(8)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%80%86%E5%90%91">é€†å‘(3)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%9D%A2%E8%AF%95">é¢è¯•(5)</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/note/">Recent Note</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/">åœºæ™¯æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿çš„è§£å†³æ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/">å•çº¿ç¨‹çš„redisä¸ºä»€ä¹ˆå¿«</a>
            </li>
        
            <li>
                <a href="/note/redis-%E6%80%BB%E7%BB%93/">redisæ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/mysql-%E6%80%BB%E7%BB%93/">mysqlæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/android/">Recent Android</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/android/redroid%E4%BD%BF%E7%94%A8/">Redroidå®‰å“å®¹å™¨</a>
            </li>
        
            <li>
                <a href="/android/%E5%85%A5%E9%97%A8/">é€†å‘ç¯å¢ƒ-æ‚</a>
            </li>
        
            <li>
                <a href="/android/frida%E6%95%99%E7%A8%8B/">fridaæ•™ç¨‹</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/tool/">Recent Tool</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tool/linux-almalinux%E4%BC%98%E5%8C%96/">AlmaLinux10</a>
            </li>
        
            <li>
                <a href="/tool/almalinux-k8s/">AlmaLinux-k8så®‰è£…</a>
            </li>
        
            <li>
                <a href="/tool/vscode%E6%8A%98%E8%85%BE/">vscodeæŠ˜è…¾</a>
            </li>
        
            <li>
                <a href="/tool/linux-ubuntu%E4%BC%98%E5%8C%96/">Ubuntuå¼€æœºä¼˜åŒ–</a>
            </li>
        
            <li>
                <a href="/tool/shell-ssh_script/">sshå¸¸ç”¨è„šæœ¬</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/llm/">Recent Llm</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/">Transformers-å…¥é—¨ç¯‡</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/">AIæ¨¡å‹VLLMéƒ¨ç½²</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">AIæ¨¡å‹å¾®è°ƒ</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/go/">Recent Go</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/">Goä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/">Goä¸­makeä¸newåŒºåˆ«</a>
            </li>
        
            <li>
                <a href="/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/go/grpc%E6%80%BB%E7%BB%93/">GRPCç¬”è®°</a>
            </li>
        
            <li>
                <a href="/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/">Goçš„deferæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
            </div>
        </main>
        <footer class="footer">
    <div class="footer-row">
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/note/index.xml">
                    Feed of Note
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/android/index.xml">
                    Feed of Android
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/tool/index.xml">
                    Feed of Tool
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/llm/index.xml">
                    Feed of Llm
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/go/index.xml">
                    Feed of Go
                    <i class="icofont-rss"></i>
                </a>
            
        

        
            
            
        
    </div>

    
</footer>

    </body>
</html>
