<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">




<title>Dockeræ­å»ºå¯ä¸€é”®éƒ¨ç½²çš„å¤šåŸŸåLNMPç¯å¢ƒ | Abnerçš„åšå®¢</title>
<link rel="canonical" href="https://abnerxc.github.io/tool/docker-%E6%90%AD%E5%BB%BA%E5%8F%AF%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E7%9A%84%E5%A4%9A%E5%9F%9F%E5%90%8Dlnmp%E7%8E%AF%E5%A2%83/">
<meta property="og:type" content="article" />
<meta property="og:title" content="Dockeræ­å»ºå¯ä¸€é”®éƒ¨ç½²çš„å¤šåŸŸåLNMPç¯å¢ƒ | Abnerçš„åšå®¢" />
<meta property="og:url" content="https://abnerxc.github.io/tool/docker-%E6%90%AD%E5%BB%BA%E5%8F%AF%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E7%9A%84%E5%A4%9A%E5%9F%9F%E5%90%8Dlnmp%E7%8E%AF%E5%A2%83/" />








<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/custom.css" />
<script src="/js/copy-code-block.js"></script>
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    </head>

    <body>
        <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://abnerxc.github.io/">Abnerçš„åšå®¢</a>

        <nav class="menu">
            
        </nav>
    </div>
</header>

        <main class="main-wrapper">
            <div class="main">
                

<section class="single">
    <h1 class="title">Dockeræ­å»ºå¯ä¸€é”®éƒ¨ç½²çš„å¤šåŸŸåLNMPç¯å¢ƒ</h1>

    <div class="tip">
        <time datetime="2022-07-21 18:35:11 &#43;0800 CST">2022/07/21</time>
        <span class="split">Â·</span>
        <span> 993 words </span>
        <span class="split">Â·</span>
        <span>
            5 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/%E5%B7%A5%E5%85%B7">å·¥å…·</a>
            
        </div>
        

        
    </div>

    
    
    <div class="post-toc">
        <h3>ç›®å½•</h3>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#dockeræ­å»ºå¯ä¸€é”®éƒ¨ç½²çš„å¤šåŸŸålnmpç¯å¢ƒ">Dockeræ­å»ºå¯ä¸€é”®éƒ¨ç½²çš„å¤šåŸŸåLNMPç¯å¢ƒ</a></li>
    <li><a href="#ä»¥ä¸‹éƒ¨åˆ†å±äºæ‰©å±•">ä»¥ä¸‹éƒ¨åˆ†å±äºæ‰©å±•</a></li>
  </ul>
</nav>
    </div>
    

    <hr />

    <div class="content">
        <h1 id="dockeræ­å»ºå¯ä¸€é”®éƒ¨ç½²çš„å¤šåŸŸålnmpç¯å¢ƒ">Dockeræ­å»ºå¯ä¸€é”®éƒ¨ç½²çš„å¤šåŸŸåLNMPç¯å¢ƒ <a href="#docker%e6%90%ad%e5%bb%ba%e5%8f%af%e4%b8%80%e9%94%ae%e9%83%a8%e7%bd%b2%e7%9a%84%e5%a4%9a%e5%9f%9f%e5%90%8dlnmp%e7%8e%af%e5%a2%83" class="anchor">ğŸ”—</a></h1><h2 id="ç‰¹ç‚¹">ç‰¹ç‚¹ <a href="#%e7%89%b9%e7%82%b9" class="anchor">ğŸ”—</a></h2><ol>
<li>å®Œå…¨å¼€æº</li>
<li>æ”¯æŒå¤šç‰ˆæœ¬PHPåˆ‡æ¢ï¼ˆPHP5.4ã€PHP5.6ã€PHP7.2&hellip;)</li>
<li>æ”¯æŒç»‘å®šä»»æ„å¤šä¸ªåŸŸå</li>
<li>æ”¯æŒHTTPSå’ŒHTTP/2</li>
<li>PHPæºä»£ç ä½äºhostä¸­</li>
<li>MySQL dataä½äºhostä¸­</li>
<li>æ‰€æœ‰é…ç½®æ–‡ä»¶å¯åœ¨hostä¸­ç›´æ¥ä¿®æ”¹</li>
<li>æ‰€æœ‰æ—¥å¿—æ–‡ä»¶å¯åœ¨hostä¸­ç›´æ¥æŸ¥çœ‹</li>
<li>å†…ç½®å®Œæ•´PHPæ‰©å±•å®‰è£…å‘½ä»¤</li>
<li>å®é™…ä½¿ç”¨ï¼Œç¡®ä¿100%å¯è¡Œ</li>
<li>å®ç°ä¸€æ¬¡é…ç½®ï¼Œå¯åœ¨ä»»ä½•æ”¯æŒDockerç³»ç»Ÿä½¿ç”¨</li>
</ol>
<hr>
<h2 id="å®‰è£…æ­¥éª¤">å®‰è£…æ­¥éª¤ <a href="#%e5%ae%89%e8%a3%85%e6%ad%a5%e9%aa%a4" class="anchor">ğŸ”—</a></h2><h2 id="dockerå®‰è£…">dockerå®‰è£… <a href="#docker%e5%ae%89%e8%a3%85" class="anchor">ğŸ”—</a></h2><h3 id="1--centos7å®‰è£…æ–¹æ³•">1.  Centos7å®‰è£…æ–¹æ³• <a href="#1--centos7%e5%ae%89%e8%a3%85%e6%96%b9%e6%b3%95" class="anchor">ğŸ”—</a></h3><pre tabindex="0"><code>sudo yum install -y yum-utils device-mapper-persistent-data lvm2
sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
sudo yum makecache fast
sudo yum -y install docker-ce
sudo service docker start
</code></pre><h3 id="2--ubuntuå®‰è£…æ–¹æ³•">2.  Ubuntuå®‰è£…æ–¹æ³• <a href="#2--ubuntu%e5%ae%89%e8%a3%85%e6%96%b9%e6%b3%95" class="anchor">ğŸ”—</a></h3><pre tabindex="0"><code>sudo apt-get update
sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common
curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
sudo add-apt-repository &#34;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&#34;
sudo apt-get -y update
sudo apt-get -y install docker-ce
</code></pre><h2 id="docker-composeå®‰è£…">docker-composeå®‰è£… <a href="#docker-compose%e5%ae%89%e8%a3%85" class="anchor">ğŸ”—</a></h2><pre tabindex="0"><code>sudo curl -L https://get.daocloud.io/docker/compose/releases/download/1.18.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
</code></pre><h2 id="æŸ¥çœ‹ç‰ˆæœ¬åŠ å…¥åˆ°dockerç»„">æŸ¥çœ‹ç‰ˆæœ¬ï¼ŒåŠ å…¥åˆ°dockerç»„ <a href="#%e6%9f%a5%e7%9c%8b%e7%89%88%e6%9c%ac%e5%8a%a0%e5%85%a5%e5%88%b0docker%e7%bb%84" class="anchor">ğŸ”—</a></h2><pre tabindex="0"><code>$ docker -v
$ docker-compose -v
$ sudo gpasswd -a ${USER} docker     
</code></pre><p>å°±ä¸ç”¨æ¯æ¬¡å¯åŠ¨Dockeréƒ½å¾—åŠ sudoäº†ï¼Œæ³¨æ„ï¼Œæ‰§è¡Œgpasswdå‘½ä»¤ä¹‹åè¦é‡æ–°ç™»é™†æ‰æœ‰æ•ˆã€‚</p>
<h2 id="ä½¿ç”¨å›½å†…é•œåƒä»“åº“">ä½¿ç”¨å›½å†…é•œåƒä»“åº“ <a href="#%e4%bd%bf%e7%94%a8%e5%9b%bd%e5%86%85%e9%95%9c%e5%83%8f%e4%bb%93%e5%ba%93" class="anchor">ğŸ”—</a></h2><ul>
<li>é¦–å…ˆæ³¨å†Œä¸€ä¸ªé˜¿é‡Œäº‘è´¦å·ï¼Œç„¶åè®¿é—®é˜¿é‡Œäº‘çš„<a href="https://cr.console.aliyun.com/">Dockeré•œåƒä»“åº“</a>ï¼Œèƒ½æ‰¾åˆ°åŠ é€Ÿå™¨åœ°å€ã€‚</li>
<li>å¯¹äºDocker 1.10+ï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶ /etc/docker/daemon.jsonï¼ˆæ²¡æœ‰æ—¶æ–°å»ºè¯¥æ–‡ä»¶ï¼‰ï¼š</li>
</ul>
<pre tabindex="0"><code>sudo mkdir -p /etc/docker
echo &#39;{ &#34;registry-mirrors&#34;: [&#34;https://l714mp7z.mirror.aliyuncs.com&#34;] }&#39; &gt;  /etc/docker/daemon.json
sudo systemctl daemon-reload
sudo systemctl restart docker
sudo systemctl enable docker

#å¼€æœºå¯åŠ¨centos7
systemctl enable docker
</code></pre><p>Docker 1.10ä»¥ä¸‹è¯·çœ‹ï¼šhttps://yq.aliyun.com/articles/29941ã€‚</p>
<h2 id="å®‰è£…å®¹å™¨å’Œé•œåƒ">å®‰è£…å®¹å™¨å’Œé•œåƒ <a href="#%e5%ae%89%e8%a3%85%e5%ae%b9%e5%99%a8%e5%92%8c%e9%95%9c%e5%83%8f" class="anchor">ğŸ”—</a></h2><pre tabindex="0"><code>docker-compose up -d
</code></pre><h2 id="å¦‚æœæ˜¯windowsä¸‹åŸºäºvirtualboxæŒ‚è½½ç›®å½•åˆ°linux">å¦‚æœæ˜¯windowsä¸‹åŸºäºvirtualboxæŒ‚è½½ç›®å½•åˆ°linux <a href="#%e5%a6%82%e6%9e%9c%e6%98%afwindows%e4%b8%8b%e5%9f%ba%e4%ba%8evirtualbox%e6%8c%82%e8%bd%bd%e7%9b%ae%e5%bd%95%e5%88%b0linux" class="anchor">ğŸ”—</a></h2><h3 id="å®‰è£…å¢å¼ºå·¥å…·centos7ç‰ˆæœ¬">å®‰è£…å¢å¼ºå·¥å…·(centos7ç‰ˆæœ¬) <a href="#%e5%ae%89%e8%a3%85%e5%a2%9e%e5%bc%ba%e5%b7%a5%e5%85%b7centos7%e7%89%88%e6%9c%ac" class="anchor">ğŸ”—</a></h3><p><img src="/img/docker-win-a.jpeg" alt=""></p>
<pre tabindex="0"><code>yum install -y gcc gcc-devel gcc-c++ gcc-c++-devel make kernel kernel-devel bzip2 vim wget  
sudo reboot  #é‡å¯
ln -s /usr/src/kernels/3.10.0ï¼ˆæ³¨æ„å†…æ ¸ç‰ˆæœ¬å·è‡ªåŠ¨è¡¥å…¨ï¼‰ /usr/src/linuxã€€   ## å¢åŠ è½¯è¿æ¥
#ç‚¹å‡»è™šæ‹Ÿæœºè®¾å¤‡-&gt;å®‰è£…å¢å¼º
mount /dev/cdrom /mnt  #æŒ‚è½½å¢å¼ºå…‰ç›˜åˆ°ç³»ç»Ÿï¼Œæç¤ºåªè¯»ä¸ç”¨ç®¡
cd /mnt &amp;&amp;  ./VBoxLinuxAdditions.run
</code></pre><h3 id="é…ç½®å…±äº«ç›®å½•">é…ç½®å…±äº«ç›®å½• <a href="#%e9%85%8d%e7%bd%ae%e5%85%b1%e4%ba%ab%e7%9b%ae%e5%bd%95" class="anchor">ğŸ”—</a></h3><p><img src="/img/docker-win-b.jpeg" alt=""></p>
<h3 id="æ‰‹åŠ¨æŒ‚è½½">æ‰‹åŠ¨æŒ‚è½½ <a href="#%e6%89%8b%e5%8a%a8%e6%8c%82%e8%bd%bd" class="anchor">ğŸ”—</a></h3><h4 id="ubuntu">ubuntu <a href="#ubuntu" class="anchor">ğŸ”—</a></h4><pre tabindex="0"><code>sudo mkdir /home/abner/server  &amp;&amp; chmod -R 777 /home/abner/server 
sudo mount -t vboxsf docker /home/abner/server   #æ‰‹åŠ¨æŒ‚è½½ ï¼ˆè¿™é‡ŒæŒ‚è½½çš„ç›®å½•æœ€å¥½ä¸è¦å’Œå…±äº«æ–‡ä»¶å¤¹åç§°ä¸€æ ·ï¼‰
</code></pre><h4 id="centos7">centos7 <a href="#centos7" class="anchor">ğŸ”—</a></h4><pre tabindex="0"><code>sudo mkdir /root/server  &amp;&amp; chmod -R 777 /root/server 
sudo mount -t vboxsf docker /root/server
</code></pre><h3 id="å¼€æœºè‡ªåŠ¨æŒ‚è½½">å¼€æœºè‡ªåŠ¨æŒ‚è½½ <a href="#%e5%bc%80%e6%9c%ba%e8%87%aa%e5%8a%a8%e6%8c%82%e8%bd%bd" class="anchor">ğŸ”—</a></h3><p><em><strong><code>virboxè‡ªåŠ¨æŒ‚è½½ä¸èƒ½å‹¾é€‰</code></strong></em></p>
<h4 id="ubuntu-1">ubuntu <a href="#ubuntu-1" class="anchor">ğŸ”—</a></h4><pre tabindex="0"><code>sudo vim /etc/rc.local
##exit 0 å‰å¢åŠ å¦‚ä¸‹å‘½ä»¤
sleep 1
sudo mount -t vboxsf docker /home/abner/server
</code></pre><h4 id="centos7-1">centos7 <a href="#centos7-1" class="anchor">ğŸ”—</a></h4><pre tabindex="0"><code>mkdir /root/server &amp;&amp; chmod -R 777 /root/server
mount -t vboxsf docker /root/server   #æ‰‹åŠ¨æŒ‚è½½
## æ­¤æ—¶å¦‚æœæç¤º/sbin/mount.vboxsf: mounting failed with the error: No such deviceï¼Œè¯´æ˜å†…æ ¸æ¨¡å—vboxsfæœªåŠ è½½ï¼Œå¯é€šè¿‡lsmod | grep vboxsfæŸ¥çœ‹ï¼ˆæ— ç»“æœè¯´æ˜æœªåŠ è½½ï¼‰ã€‚æ‰§è¡Œ `modprobe vboxsf` #åŠ è½½vboxsfæ¨¡å—
#è‡ªåŠ¨æŒ‚è½½
sudo vim /etc/fstab
docker /root/server   vboxsf rw,gid=100,uid=1000,auto 0 0
</code></pre><h3 id="è‹¥èµ°çš„ç«¯å£è½¬å‘æŒ‰å›¾å¦‚ä¸‹é…ç½®">è‹¥èµ°çš„ç«¯å£è½¬å‘æŒ‰å›¾å¦‚ä¸‹é…ç½® <a href="#%e8%8b%a5%e8%b5%b0%e7%9a%84%e7%ab%af%e5%8f%a3%e8%bd%ac%e5%8f%91%e6%8c%89%e5%9b%be%e5%a6%82%e4%b8%8b%e9%85%8d%e7%bd%ae" class="anchor">ğŸ”—</a></h3><p><img src="/img/docker-win-c.jpeg" alt=""></p>
<h3 id="è‹¥èµ°çš„æ¡¥æ¥ç½‘å¡æ­£å¸¸ipåœ°å€è¿æ¥å³å¯">è‹¥èµ°çš„æ¡¥æ¥ç½‘å¡ï¼Œæ­£å¸¸IPåœ°å€è¿æ¥å³å¯ <a href="#%e8%8b%a5%e8%b5%b0%e7%9a%84%e6%a1%a5%e6%8e%a5%e7%bd%91%e5%8d%a1%e6%ad%a3%e5%b8%b8ip%e5%9c%b0%e5%9d%80%e8%bf%9e%e6%8e%a5%e5%8d%b3%e5%8f%af" class="anchor">ğŸ”—</a></h3><h1 id="ä»¥ä¸‹éƒ¨åˆ†å±äºæ‰©å±•">ä»¥ä¸‹éƒ¨åˆ†å±äºæ‰©å±• <a href="#%e4%bb%a5%e4%b8%8b%e9%83%a8%e5%88%86%e5%b1%9e%e4%ba%8e%e6%89%a9%e5%b1%95" class="anchor">ğŸ”—</a></h1><h2 id="ç›®å½•è¯´æ˜">ç›®å½•è¯´æ˜ <a href="#%e7%9b%ae%e5%bd%95%e8%af%b4%e6%98%8e" class="anchor">ğŸ”—</a></h2><h4 id="å¤§è‡´æ¡†æ¶">å¤§è‡´æ¡†æ¶ <a href="#%e5%a4%a7%e8%87%b4%e6%a1%86%e6%9e%b6" class="anchor">ğŸ”—</a></h4><p><img src="/img/docker-win-d.jpeg" alt=""></p>
<h4 id="ç›®å½•ç»“æ„">ç›®å½•ç»“æ„ <a href="#%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h4><pre tabindex="0"><code>â”œâ”€â”€ docker-compose.yml          å®¹å™¨å¯åŠ¨é…ç½®æ–‡ä»¶
â”œâ”€â”€ Dockerfile                  PHP-FPMæ„å»ºé…ç½®æ–‡ä»¶
â”œâ”€â”€ conf                        é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ mysql                   MySQLé…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”‚   â””â”€â”€ my.cnf              MySQLé…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ nginx                   Nginxé…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”‚   â”œâ”€â”€ conf.d              ç«™ç‚¹é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ certs           SSLè®¤è¯æ–‡ä»¶ã€å¯†é’¥å’ŒåŠ å¯†æ–‡ä»¶ç›®å½•
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ site2       ç«™ç‚¹2çš„è®¤è¯æ–‡ä»¶ç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ site1.conf      ç«™ç‚¹1 Nginxé…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ site2.conf      ç«™ç‚¹2 Nginxé…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ nginx.conf          Nginxé€šç”¨é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ php                     PHPé…ç½®ç›®å½•
â”‚       â”œâ”€â”€ php-fpm.d           PHP-FPMé…ç½®ç›®å½•
â”‚       â”‚   â””â”€â”€ www.conf        PHP-FPMé…ç½®æ–‡ä»¶
â”‚       â””â”€â”€ php.ini             PHPé…ç½®æ–‡ä»¶
â”œâ”€â”€ log                         æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ mysql                   MySQLæ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ nginx                   Nginxæ—¥å¿—ç›®å½•
â”‚   â””â”€â”€ php-fpm                 PHP-FPMæ—¥å¿—ç›®å½•
â”œâ”€â”€ mysql                       MySQLæ•°æ®æ–‡ä»¶ç›®å½•
â””â”€â”€ www                         ç«™ç‚¹æ ¹ç›®å½•
    â”œâ”€â”€ site1                   ç«™ç‚¹1æ ¹ç›®å½•
    â””â”€â”€ site2                   ç«™ç‚¹2æ ¹ç›®å½•
</code></pre><h4 id="nginxé…ç½®">nginxé…ç½® <a href="#nginx%e9%85%8d%e7%bd%ae" class="anchor">ğŸ”—</a></h4><pre tabindex="0"><code>server {
    listen  80;
    server_name www.site1.com;
    root /var/www/html/site1;
    index index.shtml index.php index.html;
    location ~* \.(css|js)$ {
        sendfile  off;
        break;
    }
    expires off;
    client_max_body_size 2M;
    client_body_temp_path /var/www/html;

    location / {
            index index.shtml index.php index.html;
            if (!-e $request_filename){
                 rewrite ^/(.+)$ /index.php?_url=/$1 last;
            }
    }

    location ~ ^/.+\.php(/|$) {
        fastcgi_pass [å®¹å™¨çš„ipæˆ–è€…åç§°]:9000;  
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_read_timeout 600; 
    }
}
</code></pre><h4 id="ç«™ç‚¹éƒ¨ç½²">ç«™ç‚¹éƒ¨ç½² <a href="#%e7%ab%99%e7%82%b9%e9%83%a8%e7%bd%b2" class="anchor">ğŸ”—</a></h4><p>æœ¬æ–‡æœ‰é»˜è®¤åŠ äº†ä¸¤ä¸ªç«™ç‚¹ï¼šwww.site1.comï¼ˆåŒlocalhostï¼‰å’Œwww.site2.comã€‚<br>
è¦åœ¨æœ¬åœ°è®¿é—®è¿™ä¸¤ä¸ªåŸŸåï¼Œéœ€è¦ä¿®æ”¹ä½ çš„hostsæ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ä¸¤è¡Œï¼š<br>
127.0.0.1 <a href="https://www.site1.com">www.site1.com</a><br>
127.0.0.1 <a href="https://www.site2.com">www.site2.com</a><br>
å…¶ä¸­ï¼Œwww.site2.comä¸ºæ”¯æŒSSL/httpså’ŒHTTP/2çš„ç¤ºä¾‹ç«™ç‚¹ã€‚<br>
å› ä¸ºç«™ç‚¹2çš„SSLé‡‡ç”¨è‡ªç­¾åæ–¹å¼ï¼Œæ‰€ä»¥æµè§ˆå™¨æœ‰å®‰å…¨æç¤ºï¼Œç»§ç»­è®¿é—®å°±å¯ä»¥äº†ï¼Œè‡ªå·±çš„ç«™ç‚¹ç”¨ç¬¬ä¸‰æ–¹SSLè®¤è¯è¯ä¹¦æ›¿æ¢å³å¯ã€‚<br>
å¦‚æœåªç”¨åˆ°ç«™ç‚¹1ï¼ŒæŠŠç«™ç‚¹2ç›¸å…³çš„ç›®å½•å’Œé…ç½®æ–‡ä»¶åˆ é™¤ï¼š<br>
./conf/nginx/conf.d/certs/site2/<br>
./conf/nginx/conf.d/site2.conf<br>
./www/site2/<br>
é‡å¯å®¹å™¨å†…çš„Nginxç”Ÿæ•ˆï¼š<br>
docker exec -it dlnmp_nginx_1 nginx -s reload</p>
<h4 id="httpsä½¿ç”¨">HTTPSä½¿ç”¨ <a href="#https%e4%bd%bf%e7%94%a8" class="anchor">ğŸ”—</a></h4><p>./conf/nginx/conf.d/site2.conf<br>
å¦‚æœæ˜¯è‡ªç­¾åï¼Œå¯ä»¥ç”¨å»–é›ªå³°æä¾›çš„ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆè®¤è¯æ–‡ä»¶ã€ç§é’¥è„šæœ¬ï¼šgencert.shï¼Œ
è¿™ä¸ªè„šæœ¬å·²ç»æ”¾åœ¨é¡¹ç›®ä¸­ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼š<br>
./conf/nginx/conf.d/certs/site2/<br>
åœ¨Bashä¸­è¾“å…¥ï¼š<br>
$ ./gencert.sh<br>
è¾“å…¥ä¸€æ¬¡åŸŸåï¼Œå’Œå‡ æ¬¡å¯†ç ï¼ˆå†…å®¹éšæ„ï¼‰åï¼Œå°±ä¼šç”Ÿæˆå‡ ä¸ªè®¤è¯æ–‡ä»¶ã€‚<br>
å…¶ä¸­è‡ªç­¾åæƒ…å†µä¸éœ€è¦.csrå’Œ.origin.keyåç¼€çš„æ–‡ä»¶ã€‚<br>
ç„¶åä¿®æ”¹Nginxé…ç½®æ–‡ä»¶ï¼Œé…ç½®SSLæ”¯æŒå°±å¯ä»¥äº†ã€‚</p>
<h4 id="docker-composeymlæ–‡ä»¶">docker-compose.ymlæ–‡ä»¶ <a href="#docker-composeyml%e6%96%87%e4%bb%b6" class="anchor">ğŸ”—</a></h4><p>å¦‚ä¸‹æ˜¯dockerå®¹å™¨çš„è¿è¡Œé…ç½®docker-compose.ymlçš„å†…å®¹ï¼š</p>
<pre tabindex="0"><code>nginx:
  image: nginx:alpine
  ports:
    - &#34;80:80&#34;
    - &#34;443:443&#34;
  volumes:
    - ./www/:/var/www/html/:rw
    - ./conf/nginx/conf.d:/etc/nginx/conf.d/:ro
    - ./conf/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    - ./log/nginx/:/var/log/nginx/:rw
  links:
    - php-fpm:fpm

php-fpm:
  build: .
  expose:
    - &#34;9000&#34;
  volumes:
    - ./www/:/var/www/html/:rw
    - ./conf/php/php.ini:/usr/local/etc/php/php.ini:ro
    - ./conf/php/php-fpm.d/www.conf:/usr/local/etc/php-fpm.d/www.conf:rw
    - ./log/php-fpm/:/var/log/php-fpm/:rw
  links:
    - mysql:mysql
    - redis:redis

mysql:
  image: mysql:latest
  ports:
    - &#34;3306:3306&#34;
  volumes:
    - ./conf/mysql/my.cnf:/etc/mysql/my.cnf:ro
    - ./mysql/:/var/lib/mysql/:rw
    - ./log/mysql/:/var/log/mysql/:rw
  environment:
    MYSQL_ROOT_PASSWORD: &#34;123456&#34;

redis:
  image: redis:latest
  ports:
    - &#34;6379:6379&#34;
</code></pre><h4 id="ç«™ç‚¹æ ¹ç›®å½•å†™æƒé™">ç«™ç‚¹æ ¹ç›®å½•å†™æƒé™ <a href="#%e7%ab%99%e7%82%b9%e6%a0%b9%e7%9b%ae%e5%bd%95%e5%86%99%e6%9d%83%e9%99%90" class="anchor">ğŸ”—</a></h4><p>é»˜è®¤çš„ï¼Œå®¹å™¨ä¸­çš„/var/www/htmlç›®å½•å±äºrootï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸ºwww-dataï¼ŒPHPæ‰èƒ½æ­£å¸¸å†™ç›®å½•ã€‚<br>
å…ˆè¿›å…¥åˆ°å®¹å™¨ä¸­ï¼š<br>
$ docker exec -it dlnmp_php-fpm_1 /bin/bash<br>
ç„¶åä¿®æ”¹ç›®å½•æƒé™ï¼š<br>
$ chown -R www-data:www-data /var/www/html</p>
<h4 id="mysqlè¿æ¥">MYSQLè¿æ¥ <a href="#mysql%e8%bf%9e%e6%8e%a5" class="anchor">ğŸ”—</a></h4><ol>
<li>$ mysql -h 127.0.0.1 -u root -p
<ul>
<li>è¯´æ˜ï¼šè¿™é‡ŒMySQLçš„è¿æ¥ä¸»æœºä¸èƒ½ç”¨localhostï¼Œå› ä¸ºMySQLå®¢æˆ·ç«¯é»˜è®¤ä½¿ç”¨unix socketæ–¹å¼è¿æ¥ï¼Œåº”è¯¥ç›´æ¥ç”¨æœ¬åœ°IPã€‚</li>
</ul>
</li>
<li>$pdo = new PDO(&lsquo;mysql:host=mysql;dbname=site1&rsquo;, &lsquo;root&rsquo;, &lsquo;123456&rsquo;);
<ul>
<li>è¯´æ˜ï¼šï¼Œhostçš„å€¼å°±æ˜¯åœ¨æŒ‡å®šçš„MySQLå®¹å™¨çš„åç§°ã€‚ redis,memcacedç­‰ç±»ä¼¼</li>
</ul>
</li>
</ol>
<h4 id="ä¸€é”®å®‰è£…è„šæœ¬">ä¸€é”®å®‰è£…è„šæœ¬ <a href="#%e4%b8%80%e9%94%ae%e5%ae%89%e8%a3%85%e8%84%9a%e6%9c%ac" class="anchor">ğŸ”—</a></h4><pre tabindex="0"><code>#!/bin/bash

function getVersionNum(){
    version=`cat /proc/version`
    cut=${version%%(*}
    dd=${cut:14}
}

function dockerAlis() {
    dps=&#34;\$(docker ps -aq)&#34;
    dcup=&#34;ztth=&#39;docker-compose -f /root/docker/ztth.yml up -d&#39;&#34;
    dcrs=&#34;ztth-rs=&#39;docker-compose -f /root/docker/ztth.yml restart&#39;&#34;
    dcrm=&#34;ztth-rm=&#39;docker-compose -f /root/docker/ztth.yml stop &amp;&amp; docker-compose -f /root/docker/ztth.yml rm&#39;&#34;
    dcps=&#34;ztth-ps=&#39;docker-compose -f /root/docker/ztth.yml ps&#39;&#34;
    dcip=&#34;docker-ips=&#39;docker inspect --format=&#39;\&#34;&#39;\&#34;&#39;{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;\&#34;&#39;\&#34;&#39; $dps&#39;&#34;
}

function main(){
	while [ True ];do
		echo -e &#34;\033[33m CentOs7 dockerå®‰è£…æ­¥éª¤: \033[0m&#34;
		echo -e &#34;\033[33m The #1 dockeræœåŠ¡å®‰è£… \033[0m&#34;
		echo -e &#34;\033[33m The #2 virtual boxæŒ‚è½½å®‰è£…ï¼Œè¯·ä¿è¯å®‰è£…å¢åŠ å·¥å…·å’ŒæŒ‚è½½ç›®å½•å·²ç»æ·»åŠ  \033[0m&#34;
		echo -e &#34;\033[33m qé”®é€€å‡º \033[0m&#34;
		read -p &#39;é€‰æ‹©å®‰è£…: &#39; number
		case $number in
          1)
            echo -e &#34;\033[31m docker install starting \033[0m&#34; \
            &amp;&amp; yum install -y wget \
            &amp;&amp; mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup \
            &amp;&amp; wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo \
            &amp;&amp; yum install -y yum-utils \
            &amp;&amp; yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo \
            &amp;&amp; yum install -y gcc gcc-devel gcc-c++ gcc-c++-devel make kernel kernel-devel bzip2 vim wget device-mapper-persistent-data lvm2 docker-ce \
            &amp;&amp; yum makecache fast \
            &amp;&amp; service docker start \
            &amp;&amp; curl -L  https://ghproxy.com/https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose \
            &amp;&amp; chmod +x /usr/local/bin/docker-compose\
            &amp;&amp; gpasswd -a $USER docker \
            &amp;&amp; mkdir -p /etc/docker \
            &amp;&amp; echo &#39;{&#34;registry-mirrors&#34;:[&#34;https://l714mp7z.mirror.aliyuncs.com&#34;]}&#39;&gt;&gt; /etc/docker/daemon.json \
            &amp;&amp; systemctl daemon-reload \
            &amp;&amp; systemctl restart docker \
            &amp;&amp; systemctl enable docker \
            &amp;&amp; echo -e &#34;\033[31m dockerå®‰è£…å®Œæˆï¼Œè¯·é‡å¯ç”µè„‘ï¼Œæ‰§è¡Œæ­¥éª¤2 \033[0m&#34; &amp;&amp; exit
            ;;

          2)
            echo -e &#34;\033[31m virtual boxå¢å¼ºå·¥å…· install starting \033[0m&#34; \
            &amp;&amp; getVersionNum &amp;&amp; rm -rf /usr/src/linux &amp;&amp; ln -s /usr/src/kernels/$dd /usr/src/linux \
            &amp;&amp; mount /dev/cdrom /mnt \
            &amp;&amp; cd /mnt &amp;&amp;  ./VBoxLinuxAdditions.run \
            &amp;&amp; mkdir -p /root/docker  &amp;&amp; chmod -R 777 /root/docker \
            &amp;&amp; echo &#39;docker /root/docker   vboxsf rw,gid=100,uid=1000,auto 0 0&#39;&gt;&gt; /etc/fstab \
            &amp;&amp; dockerAlis \
            &amp;&amp; echo &#34;alias $dcup&#34;&gt;&gt; /root/.bashrc \
            &amp;&amp; echo &#34;alias $dcrs&#34;&gt;&gt; /root/.bashrc \
            &amp;&amp; echo &#34;alias $dcrm&#34;&gt;&gt; /root/.bashrc \
            &amp;&amp; echo &#34;alias $dcps&#34;&gt;&gt; /root/.bashrc \
            &amp;&amp; echo &#34;alias $dcip&#34;&gt;&gt; /root/.bashrc \
            &amp;&amp; source /root/.bashrc \
            &amp;&amp; echo -e &#34;\033[31m è¯·æœåŠ¡å™¨é‡å¯ \033[0m&#34;] &amp;&amp; exit
            ;;

		 &#34;q&#34;|&#34;quit&#34;)
            exit
            ;;

         *)
            echo &#34;Input error!!&#34;
             ;;

		esac
	done
}

main
</code></pre><h4 id="å¸¸ç”¨æ“ä½œ">å¸¸ç”¨æ“ä½œ <a href="#%e5%b8%b8%e7%94%a8%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—</a></h4><p>åˆ«åé…ç½®</p>
<pre tabindex="0"><code>alias docker-ips=&#39;docker inspect --format=&#39;&#34;&#39;&#34;&#39;{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;&#34;&#39;&#34;&#39; $(docker ps -aq)&#39;
alias ztth=&#39;docker-compose --compatibility -f /root/docker/ztth.yml up -d&#39;
alias ztth-rs=&#39;docker-compose --compatibility -f /root/docker/ztth.yml restart&#39;
alias ztth-rm=&#39;docker-compose --compatibility -f /root/docker/ztth.yml down -v&#39;
alias ztth-ps=&#39;docker-compose --compatibility -f /root/docker/ztth.yml ps&#39;
</code></pre><p>æ‰¹é‡æ“ä½œ</p>
<pre tabindex="0"><code>æ‰¹é‡åˆ é™¤é•œåƒ
docker rmi -f $(docker images -aq)
æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨èµ„æº
docker system prune -a --volumes
åˆ é™¤æœªä½¿ç”¨é•œåƒ
docker image prune -a -f
åˆ é™¤æœªä½¿ç”¨å®¹å™¨
docker rm -vf $(docker ps -aq)
æ‰¹é‡åˆ é™¤å·
docker volume rm $(docker volume ls -qf dangling=true)
åˆ é™¤æ‰€æœ‰å…³é—­çš„å®¹å™¨
docker ps -a | grep Exit | cut -d &#39; &#39; -f 1 | xargs docker rm
åˆ é™¤æ‰€æœ‰danglingé•œåƒï¼ˆå³æ— tagçš„é•œåƒï¼‰
docker rmi $(docker images | grep &#34;^&lt;none&gt;&#34; | awk &#34;{print $3}&#34;)
</code></pre><p>è‡ªåŠ¨è„šæœ¬</p>
<pre tabindex="0"><code>æŒ‚è½½åˆ°ç›®å½•`/docker-entrypoint-initdb.d/`,é¦–æ¬¡åˆ›å»ºå®¹å™¨ä¼šæ‰§è¡Œï¼Œä½†æ˜¯å¤šè„šæœ¬å¿…é¡»æ˜¯`01\02\03\04\05`è¿™æ ·çš„é¡ºåºå¼€å¤´ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
</code></pre><blockquote>
<p>docker pull docker.1ms.run/apache/rocketmq:5.3.2</p>
</blockquote>

    </div>

    
</section>


            </div>
            <div class="side">
                <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/ai">ai(3)</a>
            </li>
        
            <li>
                <a href="/categories/go">go(23)</a>
            </li>
        
            <li>
                <a href="/categories/%E4%BB%A3%E7%A0%81">ä»£ç (2)</a>
            </li>
        
            <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7">å·¥å…·(8)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%80%86%E5%90%91">é€†å‘(3)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%9D%A2%E8%AF%95">é¢è¯•(5)</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/note/">Recent Note</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/">åœºæ™¯æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿çš„è§£å†³æ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/">å•çº¿ç¨‹çš„redisä¸ºä»€ä¹ˆå¿«</a>
            </li>
        
            <li>
                <a href="/note/redis-%E6%80%BB%E7%BB%93/">redisæ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/mysql-%E6%80%BB%E7%BB%93/">mysqlæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/android/">Recent Android</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/android/redroid%E4%BD%BF%E7%94%A8/">Redroidå®‰å“å®¹å™¨</a>
            </li>
        
            <li>
                <a href="/android/%E5%85%A5%E9%97%A8/">é€†å‘ç¯å¢ƒ-æ‚</a>
            </li>
        
            <li>
                <a href="/android/frida%E6%95%99%E7%A8%8B/">fridaæ•™ç¨‹</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/tool/">Recent Tool</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tool/linux-almalinux%E4%BC%98%E5%8C%96/">AlmaLinux10</a>
            </li>
        
            <li>
                <a href="/tool/almalinux-k8s/">AlmaLinux-k8så®‰è£…</a>
            </li>
        
            <li>
                <a href="/tool/vscode%E6%8A%98%E8%85%BE/">vscodeæŠ˜è…¾</a>
            </li>
        
            <li>
                <a href="/tool/linux-ubuntu%E4%BC%98%E5%8C%96/">Ubuntuå¼€æœºä¼˜åŒ–</a>
            </li>
        
            <li>
                <a href="/tool/shell-ssh_script/">sshå¸¸ç”¨è„šæœ¬</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/llm/">Recent Llm</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/">Transformers-å…¥é—¨ç¯‡</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/">AIæ¨¡å‹VLLMéƒ¨ç½²</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">AIæ¨¡å‹å¾®è°ƒ</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/go/">Recent Go</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/">Goä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/">Goä¸­makeä¸newåŒºåˆ«</a>
            </li>
        
            <li>
                <a href="/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/go/grpc%E6%80%BB%E7%BB%93/">GRPCç¬”è®°</a>
            </li>
        
            <li>
                <a href="/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/">Goçš„deferæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
            </div>
        </main>
        <footer class="footer">
    <div class="footer-row">
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/note/index.xml">
                    Feed of Note
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/android/index.xml">
                    Feed of Android
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/tool/index.xml">
                    Feed of Tool
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/llm/index.xml">
                    Feed of Llm
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/go/index.xml">
                    Feed of Go
                    <i class="icofont-rss"></i>
                </a>
            
        

        
            
            
        
    </div>

    
</footer>

    </body>
</html>
