<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">




<title>sshå¸¸ç”¨è„šæœ¬ | Abnerçš„åšå®¢</title>
<link rel="canonical" href="https://abnerxc.github.io/tool/shell-ssh_script/">
<meta property="og:type" content="article" />
<meta property="og:title" content="sshå¸¸ç”¨è„šæœ¬ | Abnerçš„åšå®¢" />
<meta property="og:url" content="https://abnerxc.github.io/tool/shell-ssh_script/" />








<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/custom.css" />
<script src="/js/copy-code-block.js"></script>
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    </head>

    <body>
        <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://abnerxc.github.io/">Abnerçš„åšå®¢</a>

        <nav class="menu">
            
        </nav>
    </div>
</header>

        <main class="main-wrapper">
            <div class="main">
                

<section class="single">
    <h1 class="title">sshå¸¸ç”¨è„šæœ¬</h1>

    <div class="tip">
        <time datetime="2022-07-21 18:35:11 &#43;0800 CST">2022/07/21</time>
        <span class="split">Â·</span>
        <span> 664 words </span>
        <span class="split">Â·</span>
        <span>
            4 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/%E5%B7%A5%E5%85%B7">å·¥å…·</a>
            
        </div>
        

        
    </div>

    
    
    <div class="post-toc">
        <h3>ç›®å½•</h3>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#sshç™»é™†è„šæœ¬">sshç™»é™†è„šæœ¬</a></li>
  </ul>
</nav>
    </div>
    

    <hr />

    <div class="content">
        <h1 id="sshç™»é™†è„šæœ¬">sshç™»é™†è„šæœ¬ <a href="#ssh%e7%99%bb%e9%99%86%e8%84%9a%e6%9c%ac" class="anchor">ğŸ”—</a></h1><h2 id="1mainsh">1.main.sh <a href="#1mainsh" class="anchor">ğŸ”—</a></h2><pre tabindex="0"><code class="language-config" data-lang="config">#!/bin/bash
# è·å–è„šæœ¬ç»å¯¹è·¯å¾„
SOURCE=&#34;${BASH_SOURCE[0]}&#34;
while [ -h &#34;$SOURCE&#34; ]; do # resolve $SOURCE until the file is no longer a symlink
  DIR=&#34;$(cd -P &#34;$(dirname &#34;$SOURCE&#34;)&#34; &amp;&amp; pwd)&#34;
  SOURCE=&#34;$(readlink &#34;$SOURCE&#34;)&#34;
  [[ $SOURCE != /* ]] &amp;&amp; SOURCE=&#34;$DIR/$SOURCE&#34; # if relative, re resolve it
done
direc=&#34;$(cd -P &#34;$(dirname &#34;$SOURCE&#34;)&#34; &amp;&amp; pwd)&#34;

# é¢œè‰²è¾“å‡ºå‡½æ•°
function color(){
    blue=&#34;\033[0;36m&#34;
    red=&#34;\033[0;31m&#34;
    green=&#34;\033[0;32m&#34;
    close=&#34;\033[m&#34;
    case $1 in
        blue)
            echo -e &#34;$blue $2 $close&#34;
        ;;
        red)
            echo -e &#34;$red $2 $close&#34;
        ;;
        green)
            echo -e &#34;$green $2 $close&#34;
        ;;
        *)
            echo &#34;Input color error!!&#34;
        ;;
    esac
}

# ç‰ˆæƒä¿¡æ¯
function copyright(){
    echo &#34;#####################&#34;
    color blue &#34;   SSH Login Platform   &#34;
    echo &#34;#####################&#34;
    echo
}

# ä¸‹åˆ’çº¿åˆ†éš”ç¬¦
function underline(){
    echo &#34;-----------------------------------------&#34;
}

# è·å–æœåŠ¡å™¨é…ç½®
function get_server_config() {
    local id=&#34;$1&#34;
    awk -v server_id=&#34;server$id&#34; -F &#39;=&#39; &#39;
    BEGIN {
        current_section = &#34;&#34;
        ip = port = username = login_type = credential = label = &#34;&#34;
    }
    /^\[/ {
        current_section = substr($0, 2, length($0)-2)
        if(current_section == server_id) in_section=1
        else in_section=0
    }
    in_section &amp;&amp; NF&gt;0 {
        gsub(/^[ \t]+|[ \t]+$/, &#34;&#34;, $1)
        gsub(/^[ \t]+|[ \t]+$/, &#34;&#34;, $2)
        
        if ($1 == &#34;ip&#34;) ip = $2
        if ($1 == &#34;port&#34;) port = $2
        if ($1 == &#34;username&#34;) username = $2
        if ($1 == &#34;login_type&#34;) login_type = $2
        if ($1 == &#34;credential&#34;) credential = $2
        if ($1 == &#34;label&#34;) label = $2
    }
    END {
        if (ip != &#34;&#34;) {
            printf &#34;%s:%s:%s:%s:%s:%s&#34;, ip, port, username, login_type, credential, label
        }
    }
    &#39; &#34;$direc/config.ini&#34;
}

# åˆ—å‡ºæ‰€æœ‰æœåŠ¡å™¨
function list_servers() {
    awk -F &#39;=&#39; &#39;
    BEGIN {
        print &#34;åºå· |       ä¸»æœº      | ç™»å½•æ–¹å¼ | è¯´æ˜&#34;
    }
    /^\[server/ {
        match($0, /server[0-9]+/)
        server_id = substr($0, RSTART+6, RLENGTH-6)
        ip = login_type = label = &#34;&#34;
    }
    !/^\[/ &amp;&amp; $1 ~ /[[:space:]]*ip/ {
        gsub(/^[ \t]+|[ \t]+$/, &#34;&#34;, $2)
        ip = $2
    }
    !/^\[/ &amp;&amp; $1 ~ /[[:space:]]*login_type/ {
        gsub(/^[ \t]+|[ \t]+$/, &#34;&#34;, $2)
        login_type = $2
    }
    !/^\[/ &amp;&amp; $1 ~ /[[:space:]]*label/ {
        gsub(/^[ \t]+|[ \t]+$/, &#34;&#34;, $2)
        label = $2
    }
    ip != &#34;&#34; &amp;&amp; login_type != &#34;&#34; &amp;&amp; label != &#34;&#34; {
        printf &#34;\033[0;31m% 3s \033[m | %15s | %8s | %s\n&#34;, server_id, ip, login_type, label
        server_id = ip = login_type = label = &#34;&#34;
    }
    &#39; &#34;$direc/config.ini&#34;
}

# ä¸»å‡½æ•°
function main(){
    while true; do
        clear
        copyright
        
        echo &#34;åºå· |       ä¸»æœº      | ç™»å½•æ–¹å¼ | è¯´æ˜&#34;
        underline
        list_servers
        underline
        
        read -p &#39;[*] é€‰æ‹©ä¸»æœº: &#39; number
        
        if [[ &#34;$number&#34; == &#34;q&#34; || &#34;$number&#34; == &#34;quit&#34; ]]; then
            exit
        fi
        
        config=$(get_server_config &#34;$number&#34;)
        
        if [ -z &#34;$config&#34; ]; then
            color red &#34;[!] æ— æ•ˆçš„ä¸»æœºåºå·: $number&#34;
            sleep 1
            continue
        fi
        
        IFS=&#39;:&#39; read -r ipaddr port username login_type credential label &lt;&lt;&lt; &#34;$config&#34;
        
        # æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        color blue &#34;[*] è§£æé…ç½®ï¼š&#34;
        echo &#34;è·¯å¾„å‰ç¼€: $direc&#34;
        echo &#34;IPåœ°å€: $ipaddr&#34;
        echo &#34;ç«¯å£: $port&#34;
        echo &#34;ç”¨æˆ·å: $username&#34;
        echo &#34;ç™»å½•ç±»å‹: $login_type&#34;
        echo &#34;è¯ä¹¦æ–‡ä»¶: $credential&#34;
        
        if [[ &#34;$login_type&#34; == &#34;pem&#34; ]]; then
            pem_path=&#34;$direc/keys/$credential&#34;
            color green &#34;[*] ä½¿ç”¨è¯ä¹¦: $credential&#34;
            echo &#34;è¯ä¹¦è·¯å¾„: $pem_path&#34;
            
            if [ ! -f &#34;$pem_path&#34; ]; then
                color red &#34;[!] è¯ä¹¦æ–‡ä»¶ä¸å­˜åœ¨: $pem_path&#34;
                sleep 2
                continue
            elif [ ! -r &#34;$pem_path&#34; ]; then
                color red &#34;[!] æ— æƒé™è¯»å–è¯ä¹¦æ–‡ä»¶&#34;
                sleep 2
                continue
            fi
            
            ssh -i &#34;$pem_path&#34; &#34;$username@$ipaddr&#34; -p &#34;$port&#34;
            
        elif [[ &#34;$login_type&#34; == &#34;pwd&#34; ]]; then
            exp_path=&#34;$direc/login.exp&#34;
            
            if [ ! -f &#34;$exp_path&#34; ]; then
                color red &#34;[!] expectè„šæœ¬ä¸å­˜åœ¨: $exp_path&#34;
                sleep 2
                continue
            elif [ ! -x &#34;$exp_path&#34; ]; then
                color red &#34;[!] expectè„šæœ¬ä¸å¯æ‰§è¡Œ&#34;
                sleep 2
                continue
            fi
            
            expect -f &#34;$exp_path&#34; &#34;$ipaddr&#34; &#34;$username&#34; &#34;$credential&#34; &#34;$port&#34;
        else
            color red &#34;[!] æœªçŸ¥çš„ç™»å½•ç±»å‹: $login_type&#34;
            sleep 2
        fi
    done
}

main
</code></pre><h2 id="2loginexp">2.login.exp <a href="#2loginexp" class="anchor">ğŸ”—</a></h2><pre tabindex="0"><code class="language-config" data-lang="config">#!/usr/bin/expect -f
proc abort {msg} {
    puts stderr $msg
    exit 1
}

if {$argc != 4} {
    abort &#34;Usage: $argv0 host user password port&#34;
}

set TARGET [lindex $argv 0]
set USER [lindex $argv 1]
set PASSWD [lindex $argv 2]
set PORT [lindex $argv 3]
set timeout 10

spawn ssh -o StrictHostKeyChecking=no -p $PORT $USER@$TARGET
match_max 100000

expect {
    &#34;*yes/no&#34; {
        send &#34;yes\r&#34;
        exp_continue
    }
    &#34;*assword:&#34; {
        send &#34;$PASSWD\r&#34;
        exp_continue
    }
    eof {
        puts &#34;Connection closed.&#34;
    }
    timeout {
        abort &#34;Connection timeout&#34;
    }
}

interact
</code></pre><h2 id="3configini">3.config.ini <a href="#3configini" class="anchor">ğŸ”—</a></h2><pre tabindex="0"><code class="language-config" data-lang="config">[server1] 
ip=127.0.0.1
port=22
username=root
login_type=pwd
credential=123456
label=æœ¬åœ°test

[server2] 
ip=127.0.0.1
port=22
username=root
login_type=pwd
credential=123456
label=æœ¬åœ°test
</code></pre><h2 id="4åœ¨mainshç›®å½•ä¸‹æ–°å»ºkeysæ–‡ä»¶å¤¹å°†è¯ä¹¦æ–‡ä»¶æ”¾åœ¨keysæ–‡ä»¶å¤¹ä¸‹è¯ä¹¦æƒé™ä¸º600">4.åœ¨main.shç›®å½•ä¸‹æ–°å»ºkeysæ–‡ä»¶å¤¹ï¼Œå°†è¯ä¹¦æ–‡ä»¶æ”¾åœ¨keysæ–‡ä»¶å¤¹ä¸‹,è¯ä¹¦æƒé™ä¸º600 <a href="#4%e5%9c%a8mainsh%e7%9b%ae%e5%bd%95%e4%b8%8b%e6%96%b0%e5%bb%bakeys%e6%96%87%e4%bb%b6%e5%a4%b9%e5%b0%86%e8%af%81%e4%b9%a6%e6%96%87%e4%bb%b6%e6%94%be%e5%9c%a8keys%e6%96%87%e4%bb%b6%e5%a4%b9%e4%b8%8b%e8%af%81%e4%b9%a6%e6%9d%83%e9%99%90%e4%b8%ba600" class="anchor">ğŸ”—</a></h2><pre tabindex="0"><code class="language-config" data-lang="config">chmod 600 a.pem
</code></pre>
    </div>

    
</section>


            </div>
            <div class="side">
                <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/ai">ai(3)</a>
            </li>
        
            <li>
                <a href="/categories/go">go(23)</a>
            </li>
        
            <li>
                <a href="/categories/%E4%BB%A3%E7%A0%81">ä»£ç (2)</a>
            </li>
        
            <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7">å·¥å…·(8)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%80%86%E5%90%91">é€†å‘(3)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%9D%A2%E8%AF%95">é¢è¯•(5)</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/note/">Recent Note</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/">åœºæ™¯æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿çš„è§£å†³æ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/">å•çº¿ç¨‹çš„redisä¸ºä»€ä¹ˆå¿«</a>
            </li>
        
            <li>
                <a href="/note/redis-%E6%80%BB%E7%BB%93/">redisæ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/mysql-%E6%80%BB%E7%BB%93/">mysqlæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/android/">Recent Android</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/android/redroid%E4%BD%BF%E7%94%A8/">Redroidå®‰å“å®¹å™¨</a>
            </li>
        
            <li>
                <a href="/android/%E5%85%A5%E9%97%A8/">é€†å‘ç¯å¢ƒ-æ‚</a>
            </li>
        
            <li>
                <a href="/android/frida%E6%95%99%E7%A8%8B/">fridaæ•™ç¨‹</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/tool/">Recent Tool</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tool/linux-almalinux%E4%BC%98%E5%8C%96/">AlmaLinux10</a>
            </li>
        
            <li>
                <a href="/tool/almalinux-k8s/">AlmaLinux-k8så®‰è£…</a>
            </li>
        
            <li>
                <a href="/tool/vscode%E6%8A%98%E8%85%BE/">vscodeæŠ˜è…¾</a>
            </li>
        
            <li>
                <a href="/tool/linux-ubuntu%E4%BC%98%E5%8C%96/">Ubuntuå¼€æœºä¼˜åŒ–</a>
            </li>
        
            <li>
                <a href="/tool/shell-ssh_script/">sshå¸¸ç”¨è„šæœ¬</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/llm/">Recent Llm</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/">Transformers-å…¥é—¨ç¯‡</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/">AIæ¨¡å‹VLLMéƒ¨ç½²</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">AIæ¨¡å‹å¾®è°ƒ</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/go/">Recent Go</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/">Goä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/">Goä¸­makeä¸newåŒºåˆ«</a>
            </li>
        
            <li>
                <a href="/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/go/grpc%E6%80%BB%E7%BB%93/">GRPCç¬”è®°</a>
            </li>
        
            <li>
                <a href="/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/">Goçš„deferæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
            </div>
        </main>
        <footer class="footer">
    <div class="footer-row">
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/note/index.xml">
                    Feed of Note
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/android/index.xml">
                    Feed of Android
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/tool/index.xml">
                    Feed of Tool
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/llm/index.xml">
                    Feed of Llm
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/go/index.xml">
                    Feed of Go
                    <i class="icofont-rss"></i>
                </a>
            
        

        
            
            
        
    </div>

    
</footer>

    </body>
</html>
