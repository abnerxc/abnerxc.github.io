<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>é¢è¯• on Abnerçš„åšå®¢</title>
    <link>https://abnerxc.github.io/categories/%E9%9D%A2%E8%AF%95/</link>
    <description>Recent content in é¢è¯• on Abnerçš„åšå®¢</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Sun, 25 Jan 2026 12:07:58 +0800</lastBuildDate><atom:link href="https://abnerxc.github.io/categories/%E9%9D%A2%E8%AF%95/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>åœºæ™¯æ€»ç»“</title>
      <link>https://abnerxc.github.io/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/</link>
      <pubDate>Sun, 25 Jan 2026 12:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/</guid>
      <description>&lt;h1 id=&#34;é¡¹ç›®é‡Œç§’æ€å•†å“çš„è¯¦æƒ…é¡µqpsèƒ½åˆ°å¤šå°‘å¦‚æœçªç„¶é£™å‡åˆ°50ä¸‡qpsä¼šå‡ºç°ä»€ä¹ˆç“¶é¢ˆæ€ä¹ˆä¼˜åŒ–&#34;&gt;é¡¹ç›®é‡Œç§’æ€å•†å“çš„è¯¦æƒ…é¡µQPSèƒ½åˆ°å¤šå°‘?å¦‚æœçªç„¶é£™å‡åˆ°50ä¸‡QPSï¼Œä¼šå‡ºç°ä»€ä¹ˆç“¶é¢ˆ?æ€ä¹ˆä¼˜åŒ–? &lt;a href=&#34;#%e9%a1%b9%e7%9b%ae%e9%87%8c%e7%a7%92%e6%9d%80%e5%95%86%e5%93%81%e7%9a%84%e8%af%a6%e6%83%85%e9%a1%b5qps%e8%83%bd%e5%88%b0%e5%a4%9a%e5%b0%91%e5%a6%82%e6%9e%9c%e7%aa%81%e7%84%b6%e9%a3%99%e5%8d%87%e5%88%b050%e4%b8%87qps%e4%bc%9a%e5%87%ba%e7%8e%b0%e4%bb%80%e4%b9%88%e7%93%b6%e9%a2%88%e6%80%8e%e4%b9%88%e4%bc%98%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;åœºæ™¯&#34;&gt;åœºæ™¯ &lt;a href=&#34;#%e5%9c%ba%e6%99%af&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ç™¾äº¿è¡¥è´´è¯¦æƒ…é¡µé€šå¸¸åŒ…å«é™æ€ä¿¡æ¯ï¼ˆå›¾æ–‡ã€å‚æ•°ï¼‰å’ŒåŠ¨æ€ä¿¡æ¯ï¼ˆä»·æ ¼ã€åº“å­˜ã€ä¼˜æƒ ï¼‰ã€‚å¹³æ—¶QPSå¯èƒ½åœ¨å‡ åƒï¼Œä½†å¤§ä¿ƒæ—¶å¯èƒ½ç¬é—´é£™å‡è‡³50ä¸‡QPSã€‚&lt;/p&gt;
&lt;h2 id=&#34;50ä¸‡-qps-ä¸‹çš„ç“¶é¢ˆç‚¹&#34;&gt;50ä¸‡ QPS ä¸‹çš„ç“¶é¢ˆç‚¹ &lt;a href=&#34;#50%e4%b8%87-qps-%e4%b8%8b%e7%9a%84%e7%93%b6%e9%a2%88%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç½‘ç»œå¸¦å®½ç“¶é¢ˆï¼š è¯¦æƒ…é¡µHTMLå¾ˆå¤§ï¼ˆå‡ ç™¾KBï¼‰ï¼Œ50ä¸‡QPS * 200KB = 100Gbpsçš„å¸¦å®½å‡ºå£ï¼Œç¬é—´æ‰“æ»¡äº¤æ¢æœºå’Œç½‘å¡ã€‚&lt;/li&gt;
&lt;li&gt;CPU/è®¡ç®—ç“¶é¢ˆï¼š å¦‚æœåŠ¨æ€è®¡ç®—ä»·æ ¼æˆ–æ‹¼æ¥HTMLï¼ŒCPUä¼šæˆä¸ºç“¶é¢ˆï¼Œå°¤å…¶æ˜¯å¤§é‡çš„åºåˆ—åŒ–/ååºåˆ—åŒ–å’ŒJSONæ¸²æŸ“ã€‚&lt;/li&gt;
&lt;li&gt;Redis/DBç“¶é¢ˆï¼š å³ä½¿æ˜¯Redisï¼Œå•æœºQPSä¹Ÿå°±10ä¸‡å·¦å³ï¼Œä¸”50ä¸‡è¿æ¥ä¼šè€—å°½æ–‡ä»¶å¥æŸ„ï¼Œå¯¼è‡´è¿æ¥å»ºç«‹å¤±è´¥ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯è¿æ¥æ•°ï¼š é»˜è®¤çš„å†…æ ¸å‚æ•°ï¼ˆå¦‚ulimitï¼‰å’Œå…¨è¿æ¥é˜Ÿåˆ—å¯èƒ½è¢«å æ»¡ï¼Œå¯¼è‡´SYNä¸¢å¼ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¼˜åŒ–æ–¹æ¡ˆåˆ†å±‚æ¶æ„&#34;&gt;ä¼˜åŒ–æ–¹æ¡ˆï¼ˆåˆ†å±‚æ¶æ„ï¼‰ &lt;a href=&#34;#%e4%bc%98%e5%8c%96%e6%96%b9%e6%a1%88%e5%88%86%e5%b1%82%e6%9e%b6%e6%9e%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æŒ‰è°ƒç”¨é“¾æ‹†è§£ï¼šCDN â†’ Nginx â†’ å•†å“æœåŠ¡ â†’ Redis â†’ MySQL / ES&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é™æ€èµ„æºå…¨é¢CDNåŠ é€Ÿï¼ˆé™æ€åŒ–ï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š å°†å•†å“è¯¦æƒ…é¡µçš„HTMLã€å›¾ç‰‡ã€CSSã€JSå…¨éƒ¨é™æ€åŒ–ï¼Œæ¨é€åˆ°CDNè¾¹ç¼˜èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;æ•ˆæœï¼š 90%ä»¥ä¸Šçš„æµé‡ç›´æ¥åœ¨CDNè¾¹ç¼˜èŠ‚ç‚¹å“åº”ï¼Œæ ¹æœ¬ä¸ä¼šæ‰“åˆ°ä½ çš„æºç«™æœåŠ¡å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åŠ¨æ€å†…å®¹åˆ†ç¦»ï¼ˆåŠ¨é™åˆ†ç¦»ï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š å°†åŠ¨æ€å†…å®¹ï¼ˆä»·æ ¼ã€åº“å­˜ã€ä¼˜æƒ ï¼‰ä»HTMLä¸­åˆ†ç¦»å‡ºæ¥ï¼Œé€šè¿‡APIå¼‚æ­¥è·å–ã€‚&lt;/li&gt;
&lt;li&gt;æ•ˆæœï¼š åŠ¨æ€å†…å®¹çš„QPSå¯ä»¥å•ç‹¬è°ƒæ•´ï¼Œè€Œä¸ä¼šå½±å“é™æ€èµ„æºçš„è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¤šçº§ç¼“å­˜æ¶æ„ï¼š
&lt;ul&gt;
&lt;li&gt;æµè§ˆå™¨ç¼“å­˜ï¼š å¯¹é™æ€èµ„æºè®¾ç½®å¼ºç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;æœ¬åœ°ç¼“å­˜ï¼š åº”ç”¨æœåŠ¡å™¨éƒ¨ç½²L1ç¼“å­˜ï¼ˆå¦‚Guava/Caffeineæˆ–Golangçš„bigcacheï¼‰ã€‚ä»·æ ¼å˜æ›´ä¸é¢‘ç¹æ—¶ï¼Œç›´æ¥è¯»å†…å­˜ï¼ŒQPSå¯è¾¾ç™¾ä¸‡çº§ã€‚è®¾ç½®10~50msTTLï¼ŒæŠµæŒ¡ Redis æŠ–åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;Redisé›†ç¾¤ï¼š åšåˆ†ç‰‡ï¼Œé¿å¼€å•ç‚¹çƒ­ç‚¹ã€‚å¦‚ sku_stock:123 â†’ sku_stock:{123}_{0..9}ï¼Œé€šè¿‡ hash å–ä¸€ä¸ªå†™æ—¶å†™å¤šä¸ª key&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é™çº§å…œåº•ï¼š
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š Redis è¶…æ—¶ â†’ è¿”å›â€œåº“å­˜ç´§å¼ â€ã€‚&lt;/li&gt;
&lt;li&gt;æ•ˆæœï¼š ES è¶…æ—¶ â†’ è¿”å›é»˜è®¤æ’åº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ‹¼å•æˆåŠŸåéœ€åŒæ—¶æ‰£å‡å•†å“åº“å­˜æ›´æ–°æ‹¼å•çŠ¶æ€æ¨é€æˆåŠŸé€šçŸ¥å¦‚ä½•ä¿è¯è¿™ä¸‰ä¸ªæ“ä½œçš„åŸå­æ€§æ¯”è¾ƒseataatseatatccæœ¬åœ°æ¶ˆæ¯è¡¨çš„ä¼˜åŠ£&#34;&gt;æ‹¼å•æˆåŠŸåéœ€åŒæ—¶æ‰£å‡å•†å“åº“å­˜ã€æ›´æ–°æ‹¼å•çŠ¶æ€ã€æ¨é€æˆåŠŸé€šçŸ¥ï¼Œå¦‚ä½•ä¿è¯è¿™ä¸‰ä¸ªæ“ä½œçš„åŸå­æ€§?æ¯”è¾ƒSeataATã€SeataTCCã€æœ¬åœ°æ¶ˆæ¯è¡¨çš„ä¼˜åŠ£ã€‚ &lt;a href=&#34;#%e6%8b%bc%e5%8d%95%e6%88%90%e5%8a%9f%e5%90%8e%e9%9c%80%e5%90%8c%e6%97%b6%e6%89%a3%e5%87%8f%e5%95%86%e5%93%81%e5%ba%93%e5%ad%98%e6%9b%b4%e6%96%b0%e6%8b%bc%e5%8d%95%e7%8a%b6%e6%80%81%e6%8e%a8%e9%80%81%e6%88%90%e5%8a%9f%e9%80%9a%e7%9f%a5%e5%a6%82%e4%bd%95%e4%bf%9d%e8%af%81%e8%bf%99%e4%b8%89%e4%b8%aa%e6%93%8d%e4%bd%9c%e7%9a%84%e5%8e%9f%e5%ad%90%e6%80%a7%e6%af%94%e8%be%83seataatseatatcc%e6%9c%ac%e5%9c%b0%e6%b6%88%e6%81%af%e8%a1%a8%e7%9a%84%e4%bc%98%e5%8a%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;åœºæ™¯-1&#34;&gt;åœºæ™¯ &lt;a href=&#34;#%e5%9c%ba%e6%99%af-1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;æ‰£å‡åº“å­˜ã€æ›´æ–°æ‹¼å•çŠ¶æ€ã€æ¨é€é€šçŸ¥ï¼ˆçŸ­ä¿¡/IMï¼‰ï¼Œ&lt;code&gt;ä¿è¯åŸå­æ€§ï¼ˆä¸€è‡´æ€§ï¼‰çš„æ€è·¯&lt;/code&gt;ï¼š
è¿™ä¸‰ä¸ªæ“ä½œä¸­ï¼Œåº“å­˜å’ŒçŠ¶æ€å±äºå¼ºä¸€è‡´æ€§èŒƒç•´ï¼Œé€šçŸ¥å±äºæœ€ç»ˆä¸€è‡´æ€§èŒƒç•´ã€‚&lt;code&gt;ä¸è¦è¯•å›¾è®©è¿™ä¸‰è€…å…¨éƒ¨å¼ºä¸€è‡´&lt;/code&gt;ï¼Œå¦åˆ™æ€§èƒ½ä¼šæåº¦ä½ä¸‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åº“å­˜ &amp;amp; çŠ¶æ€ï¼š å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼ˆæœ¬åœ°äº‹åŠ¡æˆ–TCCï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šçŸ¥ï¼š å¿…é¡»å¼‚æ­¥ï¼Œå…è®¸å¤±è´¥é‡è¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆå¯¹æ¯”&#34;&gt;æ–¹æ¡ˆå¯¹æ¯” &lt;a href=&#34;#%e6%96%b9%e6%a1%88%e5%af%b9%e6%af%94&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ–¹æ¡ˆ&lt;/th&gt;
          &lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
          &lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Seata AT&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;æ¥å…¥ç®€å•&lt;/td&gt;
          &lt;td&gt;é«˜å¹¶å‘ä¸‹æ€§èƒ½å·®&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Seata TCC&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;å¼ºä¸€è‡´&lt;/td&gt;
          &lt;td&gt;ä¾µå…¥æ€§å¼º&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆæ¨èï¼‰&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;æœ€ç¨³ã€å¯æ‰©å±•&lt;/td&gt;
          &lt;td&gt;å®ç°å¤æ‚&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Seata ATæ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†ï¼š åŸºäºæœ¬åœ°äº‹åŠ¡ + Undo Logï¼ˆå›æ»šæ—¥å¿—ï¼‰ã€‚äºŒé˜¶æ®µæäº¤æ—¶ï¼Œå¦‚æœå…¨å±€å¤±è´¥ï¼Œå›æ»šæ—¶åˆ©ç”¨Undo Logåå‘è¡¥å¿ã€‚&lt;/li&gt;
&lt;li&gt;åŠ£åŠ¿ï¼š
&lt;ul&gt;
&lt;li&gt;é”ç«äº‰ä¸¥é‡ï¼š å…¨å±€äº‹åŠ¡æœŸé—´ï¼Œæ•°æ®åº“è¡Œé”è¢«é”å®šç›´åˆ°äº‹åŠ¡ç»“æŸï¼Œåœ¨é«˜å¹¶å‘æ‹¼å•åœºæ™¯ä¸‹ï¼Œæ•°æ®åº“ååé‡æä½ã€‚&lt;/li&gt;
&lt;li&gt;æ€§èƒ½æŸè€—ï¼š éœ€è¦è§£æSQLï¼Œç”Ÿæˆå‰åé•œåƒï¼Œé¢å¤–å¼€é”€å¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é€‚ç”¨æ€§ï¼š ä¸é€‚åˆé«˜å¹¶å‘çš„ç§’æ€/æ‹¼å•æ ¸å¿ƒé“¾è·¯ï¼Œé€‚åˆä½å¹¶å‘çš„åå°ç®¡ç†é“¾è·¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Seata TCCæ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†ï¼š Try-Confirm-Cancelã€‚ä¸šåŠ¡ä»£ç éœ€è¦å†™ä¸‰ä¸ªæ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŠ£ï¼š æ€§èƒ½æ¯”ATå¥½ï¼Œé”ç”±ä¸šåŠ¡æ§åˆ¶ï¼Œä¸ä¾èµ–DBé”ã€‚ä½†ä»£ç ä¾µå…¥æ€§æå¼ºï¼Œå¼€å‘æˆæœ¬é«˜ï¼Œä¸”æœ‰ç©ºå›æ»šã€æ‚¬æŒ‚ç­‰å‘ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨æ€§ï¼š é€‚åˆæ ¸å¿ƒèµ„äº§æ“ä½œï¼ˆå¦‚åº“å­˜æ‰£å‡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ¬åœ°æ¶ˆæ¯è¡¨æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœ¬åœ°DBäº‹åŠ¡ï¼š
&lt;ul&gt;
&lt;li&gt;æ‰£åº“å­˜&lt;/li&gt;
&lt;li&gt;æ›´æ–°æ‹¼å•çŠ¶æ€&lt;/li&gt;
&lt;li&gt;å†™æ¶ˆæ¯è¡¨ï¼ˆSUCCESSï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;MQ å¼‚æ­¥ï¼š
&lt;ul&gt;
&lt;li&gt;æ¨é€é€šçŸ¥&lt;/li&gt;
&lt;li&gt;å‘æ”¾æƒç›Š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯è¡¨é‡è¯•ï¼š
&lt;ul&gt;
&lt;li&gt;DB ä¿è¯ä¸€è‡´æ€§&lt;/li&gt;
&lt;li&gt;MQ åªè´Ÿè´£â€œæœ€ç»ˆé€šçŸ¥â€&lt;/li&gt;
&lt;li&gt;å¯è¡¥å¿ã€å¯å›æ”¾&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç”¨redisåšæ‹¼å•åˆ†å¸ƒå¼é”æ—¶æ€ä¹ˆé˜²æ­¢é”è¢«è¯¯åˆ å’Œæ­»é”å¦‚æœæ‹¼å•ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”è¶…æ—¶ä¼šå¯¼è‡´é‡å¤æ‹¼å•å—æ€ä¹ˆé¿å…&#34;&gt;ç”¨Redisåšæ‹¼å•åˆ†å¸ƒå¼é”æ—¶ï¼Œæ€ä¹ˆé˜²æ­¢é”è¢«è¯¯åˆ å’Œæ­»é”?å¦‚æœæ‹¼å•ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”è¶…æ—¶ï¼Œä¼šå¯¼è‡´é‡å¤æ‹¼å•å—?æ€ä¹ˆé¿å…? &lt;a href=&#34;#%e7%94%a8redis%e5%81%9a%e6%8b%bc%e5%8d%95%e5%88%86%e5%b8%83%e5%bc%8f%e9%94%81%e6%97%b6%e6%80%8e%e4%b9%88%e9%98%b2%e6%ad%a2%e9%94%81%e8%a2%ab%e8%af%af%e5%88%a0%e5%92%8c%e6%ad%bb%e9%94%81%e5%a6%82%e6%9e%9c%e6%8b%bc%e5%8d%95%e4%b8%9a%e5%8a%a1%e6%89%a7%e8%a1%8c%e6%97%b6%e9%97%b4%e8%b6%85%e8%bf%87%e9%94%81%e8%b6%85%e6%97%b6%e4%bc%9a%e5%af%bc%e8%87%b4%e9%87%8d%e5%a4%8d%e6%8b%bc%e5%8d%95%e5%90%97%e6%80%8e%e4%b9%88%e9%81%bf%e5%85%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;é—®é¢˜1é˜²æ­¢è¯¯åˆ é”&#34;&gt;é—®é¢˜1ï¼šé˜²æ­¢è¯¯åˆ é” &lt;a href=&#34;#%e9%97%ae%e9%a2%981%e9%98%b2%e6%ad%a2%e8%af%af%e5%88%a0%e9%94%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç°è±¡ï¼š çº¿ç¨‹Aæ‹¿åˆ°é”ï¼Œä¸šåŠ¡æ‰§è¡Œæ…¢ï¼Œé”è¶…æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚çº¿ç¨‹Bæ‹¿åˆ°é”ï¼Œæ­¤æ—¶çº¿ç¨‹Aæ‰§è¡Œå®Œï¼Œè¯¯åˆ äº†çº¿ç¨‹Bçš„é”ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š Valueæ ‡è¯†æ³•ã€‚SET key valueæ—¶ï¼Œvalueè®¾ä¸ºUUID+çº¿ç¨‹IDã€‚åˆ é™¤å‰ï¼Œå…ˆç”¨Luaè„šæœ¬ï¼ˆä¿è¯åŸå­æ€§ï¼‰åˆ¤æ–­Redisä¸­çš„Valueæ˜¯å¦ç­‰äºè‡ªå·±æŒæœ‰çš„æ ‡è¯†ï¼Œç›¸ç­‰æ‰DELã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é—®é¢˜2é˜²æ­¢æ­»é”&#34;&gt;é—®é¢˜2ï¼šé˜²æ­¢æ­»é” &lt;a href=&#34;#%e9%97%ae%e9%a2%982%e9%98%b2%e6%ad%a2%e6%ad%bb%e9%94%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç°è±¡ï¼š æ‹¿åˆ°é”çš„æœåŠ¡å®•æœºï¼Œé”æ°¸è¿œæ— æ³•é‡Šæ”¾ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼š è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆTTLï¼‰ã€‚SETNX EX 10ã€‚å³ä½¿å®•æœºï¼Œ10ç§’åé”è‡ªåŠ¨é‡Šæ”¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é—®é¢˜3ä¸šåŠ¡æ‰§è¡Œè¶…è¿‡é”è¶…æ—¶å¯¼è‡´é‡å¤ä¸‹å•&#34;&gt;é—®é¢˜3ï¼šä¸šåŠ¡æ‰§è¡Œè¶…è¿‡é”è¶…æ—¶ï¼ˆå¯¼è‡´é‡å¤ä¸‹å•ï¼‰ &lt;a href=&#34;#%e9%97%ae%e9%a2%983%e4%b8%9a%e5%8a%a1%e6%89%a7%e8%a1%8c%e8%b6%85%e8%bf%87%e9%94%81%e8%b6%85%e6%97%b6%e5%af%bc%e8%87%b4%e9%87%8d%e5%a4%8d%e4%b8%8b%e5%8d%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç°è±¡ï¼š é”TTL=10sï¼Œä¸šåŠ¡è·‘äº†15sã€‚ç¬¬10sé”é‡Šæ”¾ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹è¿›æ¥ï¼Œå¯¼è‡´ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‹¼å•ã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³ï¼ˆçœ‹é—¨ç‹—æœºåˆ¶ / Watchdogï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨ç»­æœŸï¼š å¼€å¯ä¸€ä¸ªåå°å®ˆæŠ¤çº¿ç¨‹ï¼ˆWatchdogï¼‰ã€‚å¦‚æœä¸šåŠ¡æœªæ‰§è¡Œå®Œï¼Œåœ¨TTLè¿‡æœŸå‰çš„1/3æ—¶é—´ï¼ˆå¦‚3sæ—¶ï¼‰ï¼Œä¸»åŠ¨å°†Redisä¸­çš„Keyé‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º10sã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š Redissonï¼ˆJavaï¼‰æˆ–ç±»ä¼¼çš„Golangåº“éƒ½æœ‰æ­¤æœºåˆ¶ã€‚è‡ªå®ç°æ—¶ï¼Œéœ€ç¡®ä¿ç»­æœŸé€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åŒç”Ÿå‘½å‘¨æœŸï¼Œä¸šåŠ¡åœåˆ™ç»­æœŸåœã€‚&lt;/li&gt;
&lt;li&gt;é¿å…é‡å¤æ‹¼å•ï¼š å³ä½¿é”ç»­æœŸå¤±è´¥ï¼Œæ•°æ®åº“å±‚é¢å¿…é¡»å…œåº•ã€‚æ‹¼å•SQLå¸¦ä¸Šæ¡ä»¶ UPDATE order SET status = &amp;lsquo;SUCCESS&amp;rsquo; WHERE id = ? AND status = &amp;lsquo;çŠ¶æ€å€¼&amp;rsquo;ï¼ˆä¹è§‚é”ï¼‰ï¼Œåˆ©ç”¨æ•°æ®åº“è¡Œé”æˆ–å”¯ä¸€ç´¢å¼•é˜²æ­¢å¹¶å‘ä¿®æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å•†å“åº“å­˜åˆ†ä»“å­˜å‚¨abcä»“åº“è·¨ä»“è°ƒæ‹¨æ—¶æ•°æ®åŒæ­¥å»¶è¿Ÿå¯¼è‡´ç”¨æˆ·ä¸‹å•åå‘ç°ç›®æ ‡ä»“åº“æ— è´§æ€ä¹ˆè§£å†³&#34;&gt;å•†å“åº“å­˜åˆ†ä»“å­˜å‚¨(A/B/Cä»“åº“)ï¼Œè·¨ä»“è°ƒæ‹¨æ—¶æ•°æ®åŒæ­¥å»¶è¿Ÿï¼Œå¯¼è‡´ç”¨æˆ·ä¸‹å•åå‘ç°ç›®æ ‡ä»“åº“æ— è´§ï¼Œæ€ä¹ˆè§£å†³? &lt;a href=&#34;#%e5%95%86%e5%93%81%e5%ba%93%e5%ad%98%e5%88%86%e4%bb%93%e5%ad%98%e5%82%a8abc%e4%bb%93%e5%ba%93%e8%b7%a8%e4%bb%93%e8%b0%83%e6%8b%a8%e6%97%b6%e6%95%b0%e6%8d%ae%e5%90%8c%e6%ad%a5%e5%bb%b6%e8%bf%9f%e5%af%bc%e8%87%b4%e7%94%a8%e6%88%b7%e4%b8%8b%e5%8d%95%e5%90%8e%e5%8f%91%e7%8e%b0%e7%9b%ae%e6%a0%87%e4%bb%93%e5%ba%93%e6%97%a0%e8%b4%a7%e6%80%8e%e4%b9%88%e8%a7%a3%e5%86%b3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æ ¸å¿ƒçŸ›ç›¾ï¼š CAPå®šç†ä¸‹ï¼Œä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼ˆAï¼‰å’Œåˆ†åŒºå®¹é”™ï¼ˆPï¼‰ï¼Œç‰ºç‰²äº†å¼ºä¸€è‡´æ€§ï¼ˆCï¼‰ï¼Œå¯¼è‡´ç”¨æˆ·çœ‹åˆ°çš„â€œæœ‰è´§â€æ˜¯æ—§æ•°æ®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§£å†³æ–¹æ¡ˆ&#34;&gt;è§£å†³æ–¹æ¡ˆ &lt;a href=&#34;#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å†™å…¥å‰æ ¡éªŒï¼ˆå¼ºçº¦æŸï¼‰:
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š ä¸‹å•æ—¶ï¼Œå¼ºåˆ¶è·¯ç”±åˆ°ä¸»ä»“çš„Masteræ•°æ®åº“è¿›è¡Œåº“å­˜æ‰£å‡ã€‚ä¸å…è®¸è¯»å–Slaveåº“å­˜ä½œä¸ºæ‰£å‡ä¾æ®ï¼ŒSlaveä»…ç”¨äºæŸ¥è¯¢å±•ç¤ºã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š æ•°æ®åº“è·¯ç”±å±‚é…ç½®è¯»å†™åˆ†ç¦»è§„åˆ™ï¼Œå¼ºåˆ¶ä¸»ä»åŒæ­¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åº“å­˜é¢„å /é¢„ç•™æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;åº“å­˜é¢„å ï¼šåœ¨è·¨ä»“è°ƒæ‹¨å‘èµ·æ—¶ï¼Œç³»ç»Ÿç”Ÿæˆâ€œé”å®šåº“å­˜â€ã€‚ç›®æ ‡ä»“åº“çš„åº“å­˜ = å®ç‰©åº“å­˜ + é”å®šåº“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;åº“å­˜é¢„ç•™ï¼šæ•°æ®åŒæ­¥æ—¶ï¼Œä¸ä»…è¦åŒæ­¥å®ç‰©ï¼Œè¿˜è¦åŒæ­¥â€œè°ƒæ‹¨å•â€çš„çŠ¶æ€ã€‚è¿™æ ·å³ä½¿å®ç‰©æ²¡åˆ°ï¼Œåªè¦ç³»ç»Ÿé‡Œè°ƒæ‹¨å•æ˜¯â€œåœ¨é€”â€ï¼Œç”¨æˆ·ä¹Ÿèƒ½ä¸‹å•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è®¾ç½®â€œå®‰å…¨åº“å­˜æ°´ä½â€
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š ä¸ºäº†é¿å…ç”¨æˆ·ä¸‹å•åå‘ç°ç›®æ ‡ä»“åº“æ— è´§ï¼Œè®¾ç½®ä¸€ä¸ªâ€œå®‰å…¨åº“å­˜æ°´ä½â€ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š å¦‚æœåŒæ­¥å»¶è¿Ÿæœ€å¤§5ç§’ï¼Œæ ¹æ®å¹³å‡é”€å”®é€Ÿåº¦ï¼Œè®¡ç®—5ç§’å†…å¯èƒ½å–å‡ºçš„æ•°é‡ï¼ˆå¦‚100ä»¶ï¼‰ã€‚ç³»ç»Ÿå±•ç¤ºåº“å­˜ = å®é™…åº“å­˜ - ç¼“å†²åº“å­˜ï¼ˆ100ä»¶ï¼‰ã€‚åªæœ‰å½“è°ƒæ‹¨è´§ç‰©ç¡®è®¤å…¥åº“åï¼Œæ‰é‡Šæ”¾è¿™100ä»¶çš„ç¼“å†²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ€ç»ˆä¸€è‡´æ€§ä¿®å¤
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼š å½“ç”¨æˆ·ä¸‹å•åï¼Œå‘ç°ç›®æ ‡ä»“åº“æ— è´§ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›æ»šè®¢å•ã€‚ç”¨æˆ·ç¨åå†æŸ¥è¯¢ï¼Œä¼šå‘ç°ç›®æ ‡ä»“åº“æœ‰è´§äº†ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š è®¢å•è¡¨æ·»åŠ çŠ¶æ€å­—æ®µï¼ˆå¦‚status=&amp;lsquo;CANCELLED&amp;rsquo;ï¼‰ï¼Œå½“å›æ»šè®¢å•æ—¶ï¼Œæ›´æ–°ä¸ºâ€œå·²å–æ¶ˆâ€ã€‚é€†å‘æµç¨‹ï¼šä¸»åŠ¨å–æ¶ˆè®¢å•ã€é€€æ¬¾å¹¶å‘é€ä¼˜æƒ åˆ¸è¡¥å¿ï¼Œä¸è¦é˜»å¡ç”¨æˆ·ä¸‹å•æµç¨‹å¤ªä¹…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç§’æ€æ´»åŠ¨ä¸­ç”¨æˆ·æ¯ç§’å‘èµ·10æ¬¡è¯·æ±‚å¦‚ä½•è®¾è®¡é™æµç­–ç•¥å…·ä½“æ€ä¹ˆå®ç°å’Œé€‰æ‹©&#34;&gt;ç§’æ€æ´»åŠ¨ä¸­ï¼Œç”¨æˆ·æ¯ç§’å‘èµ·10æ¬¡è¯·æ±‚ï¼Œå¦‚ä½•è®¾è®¡é™æµç­–ç•¥?å…·ä½“æ€ä¹ˆå®ç°å’Œé€‰æ‹©? &lt;a href=&#34;#%e7%a7%92%e6%9d%80%e6%b4%bb%e5%8a%a8%e4%b8%ad%e7%94%a8%e6%88%b7%e6%af%8f%e7%a7%92%e5%8f%91%e8%b5%b710%e6%ac%a1%e8%af%b7%e6%b1%82%e5%a6%82%e4%bd%95%e8%ae%be%e8%ae%a1%e9%99%90%e6%b5%81%e7%ad%96%e7%95%a5%e5%85%b7%e4%bd%93%e6%80%8e%e4%b9%88%e5%ae%9e%e7%8e%b0%e5%92%8c%e9%80%89%e6%8b%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;é™æµçš„ç®—æ³•&#34;&gt;é™æµçš„ç®—æ³• &lt;a href=&#34;#%e9%99%90%e6%b5%81%e7%9a%84%e7%ae%97%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è®¡æ•°å™¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼šåœ¨ä¸€æ®µæ—¶é—´é—´éš”å†…ï¼ˆæ—¶é—´çª—/æ—¶é—´åŒºé—´ï¼‰ï¼Œå¤„ç†è¯·æ±‚çš„æœ€å¤§æ•°é‡å›ºå®šï¼Œè¶…è¿‡éƒ¨åˆ†ä¸åšå¤„ç†&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;Redis å›ºå®šçª—ï¼šINCR + EXPIRE å®ç°â€œæ¯ç”¨æˆ·/æ¯IP æ¯ç§’/æ¯åˆ†é’Ÿæœ€å¤š N æ¬¡â€&lt;/li&gt;
&lt;li&gt;Redis æ»‘åŠ¨çª—ï¼šZSET è®°å½•æ—¶é—´æˆ³ï¼Œç§»é™¤è¿‡çª—å¤–æ•°æ®åæŒ‰çª—å£å†…è®¡æ•°&lt;/li&gt;
&lt;li&gt;åº”ç”¨å†…å®ç°ï¼šSpring/Go/Node æœåŠ¡ç”¨ Redis/æœ¬åœ°å†…å­˜åšè®¡æ•°å™¨ï¼ŒLua ä¿è¯åŸå­æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;ç™»å½•/çŸ­ä¿¡éªŒè¯ç é¢‘æ§ï¼šæ¯æ‰‹æœºå·æ¯åˆ†é’Ÿ â‰¤ 1 æ¬¡&lt;/li&gt;
&lt;li&gt;ç§’æ€æ´»åŠ¨ï¼šæ¯ä¸ªç”¨æˆ·/IP æ¯ç§’æœ€å¤š N æ¬¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¼æ¡¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼šæ¼æ¡¶å¤§å°å›ºå®šï¼Œå¤„ç†é€Ÿåº¦å›ºå®šï¼Œä½†è¯·æ±‚è¿›å…¥é€Ÿåº¦ä¸å›ºå®šï¼ˆåœ¨çªå‘æƒ…å†µè¯·æ±‚è¿‡å¤šæ—¶ï¼Œä¼šä¸¢å¼ƒè¿‡å¤šçš„è¯·æ±‚ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;Nginx limit_reqï¼šå¹³å‡é€Ÿç‡ + burstï¼Œ&lt;code&gt;limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;HAProxyï¼šé€šè¿‡è¯·æ±‚é€Ÿç‡å’Œé˜Ÿåˆ—æŠŠçªåˆºæŠ¹å¹³ï¼Œä¿éšœç¨³å®šå‡ºæµ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœºæ™¯ï¼š
&lt;ul&gt;
&lt;li&gt;ç½‘å…³å…¥å£å¹³æ»‘æµé‡ï¼šé¿å…ç¬æ—¶çªåˆºæŠŠåç«¯æ‰“æŒ‚&lt;/li&gt;
&lt;li&gt;ä¸‹æ¸¸ä¿æŠ¤ï¼šå¯¹æ•°æ®åº“/æœç´¢/å¤–éƒ¨ä¾èµ–ç»´æŒç¨³å®šåå&lt;/li&gt;
&lt;li&gt;å¤§ä¿ƒç§’æ€å…¥å£ï¼šå…è®¸å°å¹… burstï¼Œä½†æ•´ä½“ä»¥ç¨³å®šé€Ÿç‡è¿‡ç½‘å…³&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»¤ç‰Œæ¡¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ€è·¯ï¼šä»¤ç‰Œæ¡¶å¤§å°å›ºå®šï¼Œä»¤ç‰Œçš„äº§ç”Ÿé€Ÿåº¦å›ºå®šï¼Œä½†æ˜¯æ¶ˆè€—ä»¤ç‰Œï¼ˆå³è¯·æ±‚ï¼‰é€Ÿåº¦ä¸å›ºå®šï¼ˆå¯ä»¥åº”å¯¹ä¸€äº›æŸäº›æ—¶é—´è¯·æ±‚è¿‡å¤šçš„æƒ…å†µï¼‰ï¼›æ¯ä¸ªè¯·æ±‚éƒ½ä¼šä»ä»¤ç‰Œæ¡¶ä¸­å–å‡ºä»¤ç‰Œï¼Œå¦‚æœæ²¡æœ‰ä»¤ç‰Œåˆ™ä¸¢å¼ƒè¯¥æ¬¡è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨Google Guavaçš„RateLimiteræˆ–Redis+Luaå®ç°ä»¤ç‰Œæ¡¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆé€‰æ‹©&#34;&gt;æ–¹æ¡ˆé€‰æ‹© &lt;a href=&#34;#%e6%96%b9%e6%a1%88%e9%80%89%e6%8b%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç½‘å…³å…¥å£ï¼šä¼˜å…ˆç”¨ Nginx çš„æ¼æ¡¶æˆ–ä»¤ç‰Œæ¡¶ï¼Œç»“åˆ burst ä¸é˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;æœåŠ¡å†…éƒ¨ï¼šæœ¬åœ°ä»¤ç‰Œæ¡¶ï¼ˆGuava/Resilience ç”Ÿæ€ï¼‰+ Redis åˆ†å¸ƒå¼è®¡æ•°æ»‘çª—&lt;/li&gt;
&lt;li&gt;é™æµç»´åº¦ï¼šåŒæ—¶æŒ‰ç”¨æˆ·ã€IPã€è·¯å¾„ã€ç§Ÿæˆ·ã€å®ä¾‹ç»´åº¦åˆ†å±‚é…ç½®&lt;/li&gt;
&lt;li&gt;è§‚å¯Ÿä¸å›é€€ï¼šé…åˆé™æµæ—¥å¿—ã€æŒ‡æ ‡æŠ¥è­¦ã€ç°åº¦å‚æ•°å’Œé™çº§é¡µï¼Œé¿å…è¯¯ä¼¤çœŸå®ç”¨æˆ·&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç”¨rediså­˜å‚¨1äº¿ç”¨æˆ·çš„ç ä»·è¿›åº¦æ•°æ®é€‰ä»€ä¹ˆæ•°æ®ç»“æ„å†…å­˜å ç”¨å¤§æ¦‚å¤šå°‘æ€ä¹ˆä¼˜åŒ–å†…å­˜&#34;&gt;ç”¨Rediså­˜å‚¨1äº¿ç”¨æˆ·çš„ç ä»·è¿›åº¦æ•°æ®ï¼Œé€‰ä»€ä¹ˆæ•°æ®ç»“æ„?å†…å­˜å ç”¨å¤§æ¦‚å¤šå°‘?æ€ä¹ˆä¼˜åŒ–å†…å­˜? &lt;a href=&#34;#%e7%94%a8redis%e5%ad%98%e5%82%a81%e4%ba%bf%e7%94%a8%e6%88%b7%e7%9a%84%e7%a0%8d%e4%bb%b7%e8%bf%9b%e5%ba%a6%e6%95%b0%e6%8d%ae%e9%80%89%e4%bb%80%e4%b9%88%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e5%86%85%e5%ad%98%e5%8d%a0%e7%94%a8%e5%a4%a7%e6%a6%82%e5%a4%9a%e5%b0%91%e6%80%8e%e4%b9%88%e4%bc%98%e5%8c%96%e5%86%85%e5%ad%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;æ•°æ®ç»“æ„é€‰æ‹©hash&#34;&gt;æ•°æ®ç»“æ„é€‰æ‹©ï¼šHash &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e9%80%89%e6%8b%a9hash&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Keyï¼šactivity:progress:{userID}
Fieldï¼š{activityID}
Valueï¼š{current_price} (æ•´æ•°æˆ–æµ®ç‚¹æ•°å­—ç¬¦ä¸²)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ç†ç”±:&lt;/strong&gt; Hashç»“æ„å¯ä»¥åœ¨Fieldè¾ƒå°‘æ—¶ä½¿ç”¨ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ç¼–ç ï¼Œæå…¶èŠ‚çœå†…å­˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å†…å­˜å ç”¨ä¼°ç®—ç²—ç•¥&#34;&gt;å†…å­˜å ç”¨ä¼°ç®—ï¼ˆç²—ç•¥ï¼‰ï¼š &lt;a href=&#34;#%e5%86%85%e5%ad%98%e5%8d%a0%e7%94%a8%e4%bc%b0%e7%ae%97%e7%b2%97%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸ä¼˜åŒ–ï¼š1äº¿ä¸ªKeyï¼Œæ¯ä¸ªKeyæœ¬èº«çš„å¼€é”€ + Rediså¯¹è±¡å¤´å¼€é”€å¾ˆå¤§ï¼Œå¯èƒ½éœ€è¦å‡ åGBã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Hashä¼˜åŒ–ï¼šå¯ä»¥å°†Keyçš„æ•°é‡å‡å°‘ã€‚ä¾‹å¦‚ï¼Œå°†ç”¨æˆ·IDå–æ¨¡åˆ†ç‰‡ï¼Œæ¯ä¸ªHashå­˜1000ä¸ªç”¨æˆ·ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªEntryå‡è®¾10å­—èŠ‚ï¼ˆField 4å­—èŠ‚ + Value 4å­—èŠ‚ + å¼€é”€ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;1äº¿ç”¨æˆ· * 10å­—èŠ‚ â‰ˆ 1GB (çº¯æ•°æ®é‡)ã€‚åŠ ä¸ŠKeyå¼€é”€å’ŒRediså¯¹è±¡å¤´ï¼Œå¯èƒ½åœ¨ 2GB~3GB å·¦å³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å†…å­˜ä¼˜åŒ–ç­–ç•¥&#34;&gt;å†…å­˜ä¼˜åŒ–ç­–ç•¥ï¼š &lt;a href=&#34;#%e5%86%85%e5%ad%98%e4%bc%98%e5%8c%96%e7%ad%96%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Hash ZipMapä¼˜åŒ–ï¼š é…ç½®hash-max-ziplist-entrieså’Œhash-max-ziplist-valueï¼Œç¡®ä¿Hashå†…éƒ¨ä½¿ç”¨ziplistç¼–ç ï¼Œè€Œä¸æ˜¯hashtableï¼Œèƒ½èŠ‚çœ50%ä»¥ä¸Šå†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;Keyç²¾ç®€ï¼š å»æ‰ä¸å¿…è¦çš„ä¸šåŠ¡å‰ç¼€ï¼Œä½¿ç”¨çŸ­IDæˆ–Hashæ˜ å°„IDã€‚&lt;/li&gt;
&lt;li&gt;æ•°å€¼ç¼–ç ï¼š å¦‚æœç ä»·é‡‘é¢éƒ½æ˜¯æ•´æ•°ï¼ŒRediså†…éƒ¨ä¼šä½¿ç”¨intç¼–ç å­˜å‚¨Valueï¼Œéå¸¸çœå†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®åˆ†ç‰‡ï¼š ä¸è¦è®©å•ä¸ªRedisèŠ‚ç‚¹å­˜1äº¿æ•°æ®ã€‚æŒ‰userID % 1000åˆ†ç‰‡åˆ°ä¸åŒRediså®ä¾‹ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¼˜æƒ åˆ¸æ ¸é”€æ—¶ç”¨æˆ·åŒæ—¶ä½¿ç”¨æ»¡100å‡30æ‹¼å•ä»·æŠ˜5æ–°äººç«‹å‡15å¦‚ä½•ç²¾å‡†è®¡ç®—å®ä»˜é‡‘é¢è§„åˆ™å¼•æ“æ€ä¹ˆè®¾è®¡&#34;&gt;ä¼˜æƒ åˆ¸æ ¸é”€æ—¶ï¼Œç”¨æˆ·åŒæ—¶ä½¿ç”¨â€œæ»¡100å‡30â€â€œæ‹¼å•ä»·æŠ˜5%â€â€œæ–°äººç«‹å‡15â€ï¼Œå¦‚ä½•ç²¾å‡†è®¡ç®—å®ä»˜é‡‘é¢?è§„åˆ™å¼•æ“æ€ä¹ˆè®¾è®¡? &lt;a href=&#34;#%e4%bc%98%e6%83%a0%e5%88%b8%e6%a0%b8%e9%94%80%e6%97%b6%e7%94%a8%e6%88%b7%e5%90%8c%e6%97%b6%e4%bd%bf%e7%94%a8%e6%bb%a1100%e5%87%8f30%e6%8b%bc%e5%8d%95%e4%bb%b7%e6%8a%985%e6%96%b0%e4%ba%ba%e7%ab%8b%e5%87%8f15%e5%a6%82%e4%bd%95%e7%b2%be%e5%87%86%e8%ae%a1%e7%ae%97%e5%ae%9e%e4%bb%98%e9%87%91%e9%a2%9d%e8%a7%84%e5%88%99%e5%bc%95%e6%93%8e%e6%80%8e%e4%b9%88%e8%ae%be%e8%ae%a1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;è®¡ç®—é¡ºåºä¸é€»è¾‘ï¼š&lt;code&gt;ç”µå•†é€šç”¨é¡ºåºï¼šå•å“ä»· -&amp;gt; ä¼šå‘˜ä»·/é™æ—¶ä»· -&amp;gt; ç±»ç›®æ»¡å‡ -&amp;gt; å¹³å°æ»¡å‡ -&amp;gt; æ‹¼å•ä»· -&amp;gt; æ–°äººåˆ¸ã€‚&lt;/code&gt;æ³¨æ„ï¼šæœ‰äº›äº’æ–¥ï¼Œæœ‰äº›å åŠ ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§„åˆ™å¼•æ“è®¾è®¡ç­–ç•¥æ¨¡å¼--è´£ä»»é“¾æ¨¡å¼&#34;&gt;è§„åˆ™å¼•æ“è®¾è®¡ï¼ˆç­–ç•¥æ¨¡å¼ + è´£ä»»é“¾æ¨¡å¼ï¼‰ï¼š &lt;a href=&#34;#%e8%a7%84%e5%88%99%e5%bc%95%e6%93%8e%e8%ae%be%e8%ae%a1%e7%ad%96%e7%95%a5%e6%a8%a1%e5%bc%8f--%e8%b4%a3%e4%bb%bb%e9%93%be%e6%a8%a1%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç­–ç•¥æ¨¡å¼(æ¨¡å‹æŠ½è±¡)ï¼š æ¯ä¸ªä¼˜æƒ åˆ¸æ˜¯ä¸€ä¸ª&lt;code&gt;Rule&lt;/code&gt;å¯¹è±¡ï¼ŒåŒ…å«ï¼š&lt;code&gt;Condition&lt;/code&gt;ï¼ˆè§„åˆ™ï¼Œå¦‚æ»¡100å…ƒï¼‰å’Œ&lt;code&gt;Action&lt;/code&gt;ï¼ˆåŠ¨ä½œï¼Œå‡30å…ƒï¼‰,&lt;code&gt;Condition&lt;/code&gt;æ”¯æŒé€»è¾‘ç»„åˆï¼š&lt;code&gt;AND / OR&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è´£ä»»é“¾æ¨¡å¼ï¼š
&lt;ul&gt;
&lt;li&gt;å°†å¤šä¸ªä¼˜æƒ åˆ¸è§„åˆ™ä¸²æˆä¸€æ¡é“¾ã€‚&lt;/li&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡Contextåœ¨é“¾ä¸­ä¼ é€’ï¼ŒåŒ…å«ï¼šå½“å‰é‡‘é¢ã€å•†å“åˆ—è¡¨ã€ç”¨æˆ·ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªRuleèŠ‚ç‚¹ï¼šæ£€æŸ¥Contextæ˜¯å¦æ»¡è¶³Condition -&amp;gt; è‹¥æ»¡è¶³ï¼Œä¿®æ”¹Contexté‡‘é¢ï¼Œæ ‡è®°å·²ä½¿ç”¨ä¼˜æƒ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç”µå•†å¹³å°è®¢å•idç”¨ä»€ä¹ˆåˆ†å¸ƒå¼idæ–¹æ¡ˆæ¯”è¾ƒé›ªèŠ±ç®—æ³•å˜ç§å«ä¸šåŠ¡ç¼–ç leafredisè‡ªå¢çš„ä¼˜åŠ£&#34;&gt;ç”µå•†å¹³å°è®¢å•IDç”¨ä»€ä¹ˆåˆ†å¸ƒå¼IDæ–¹æ¡ˆ?æ¯”è¾ƒé›ªèŠ±ç®—æ³•å˜ç§(å«ä¸šåŠ¡ç¼–ç )ã€Leafã€Redisè‡ªå¢çš„ä¼˜åŠ£ &lt;a href=&#34;#%e7%94%b5%e5%95%86%e5%b9%b3%e5%8f%b0%e8%ae%a2%e5%8d%95id%e7%94%a8%e4%bb%80%e4%b9%88%e5%88%86%e5%b8%83%e5%bc%8fid%e6%96%b9%e6%a1%88%e6%af%94%e8%be%83%e9%9b%aa%e8%8a%b1%e7%ae%97%e6%b3%95%e5%8f%98%e7%a7%8d%e5%90%ab%e4%b8%9a%e5%8a%a1%e7%bc%96%e7%a0%81leafredis%e8%87%aa%e5%a2%9e%e7%9a%84%e4%bc%98%e5%8a%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;é›ªèŠ±ç®—æ³•å˜ç§&#34;&gt;é›ªèŠ±ç®—æ³•å˜ç§ï¼š &lt;a href=&#34;#%e9%9b%aa%e8%8a%b1%e7%ae%97%e6%b3%95%e5%8f%98%e7%a7%8d&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;åŸç†ï¼š 1ä½ç¬¦å·ä½ + 41ä½æ—¶é—´æ¯«ç§’ + 10ä½æœºå™¨ID + 12ä½åºåˆ—å·ã€‚&lt;/li&gt;
&lt;li&gt;å˜ç§ï¼š å°†æœºå™¨IDéƒ¨åˆ†æ›¿æ¢ä¸º ä¸šåŠ¡ç¼–ç ï¼ˆå¦‚æœºæˆ¿ID+ä¸šåŠ¡çº¿IDï¼‰ æˆ– åˆ†ç‰‡IDã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŠ£ï¼š æ€§èƒ½æœ€é«˜ï¼ˆæœ¬åœ°ç”Ÿæˆï¼‰ï¼Œä¸ä¾èµ–ç½‘ç»œã€‚ä½†ä¾èµ–æœºå™¨æ—¶é’Ÿï¼ˆæ—¶é’Ÿå›æ‹¨ä¼šé‡å¤ï¼‰ï¼Œä¸”IDè¿‡é•¿ï¼ˆ19ä½ï¼‰ï¼Œä¸å…·å¤‡ä¸¥æ ¼çš„ä¸šåŠ¡å¯è¯»æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;leafç¾å›¢&#34;&gt;Leafï¼ˆç¾å›¢ï¼‰ &lt;a href=&#34;#leaf%e7%be%8e%e5%9b%a2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Segmentæ¨¡å¼ï¼š ä»DBæ‰¹é‡è·å–IDå·æ®µï¼ˆå¦‚[1000, 2000]ï¼‰ï¼Œç¼“å­˜åœ¨æœ¬åœ°å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŠ£ï¼š æ€§èƒ½é«˜ï¼ŒDBå‹åŠ›å°ã€‚åŒBufferä¼˜åŒ–ä¿éšœå¹³æ»‘ã€‚é‡å¯å¯èƒ½ä¸¢å¤±éƒ¨åˆ†IDï¼ˆä¸è¿ç»­ï¼‰ï¼Œä½†å”¯ä¸€æ€§æ²¡é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;Snowflakeæ¨¡å¼ï¼š åŸºäºZookeeperè§£å†³æ—¶é’Ÿå›æ‹¨é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;é€‚ç”¨æ€§ï¼š ç¨³å®šæ€§æé«˜ï¼Œé€‚åˆä¸­å¤§å‹äº’è”ç½‘å…¬å¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;redisè‡ªå¢incr&#34;&gt;Redisè‡ªå¢ï¼ˆINCRï¼‰ï¼š &lt;a href=&#34;#redis%e8%87%aa%e5%a2%9eincr&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ä¼˜åŠ£ï¼š å®ç°æœ€ç®€å•ã€‚ä½†å¼ºä¾èµ–Redisï¼Œé›†ç¾¤æ‰©ç¼©å®¹éº»çƒ¦ï¼ˆéœ€è¦è€ƒè™‘Luaè„šæœ¬æˆ–Redis Cluster Slotï¼‰ï¼Œä¸”ç½‘ç»œIOæœ‰å»¶è¿Ÿã€‚é«˜å¹¶å‘ä¸‹æˆä¸ºå•ç‚¹ç“¶é¢ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç§’æ€ä¼˜æƒ åˆ¸å¦‚ä½•é˜²æ­¢è¶…å‘å¯¹æ¯”redisluaè„šæœ¬å’Œåˆ†å¸ƒå¼æ•°æ®åº“é”çš„æ–¹æ¡ˆä¼˜åŠ£&#34;&gt;ç§’æ€ä¼˜æƒ åˆ¸å¦‚ä½•é˜²æ­¢è¶…å‘?å¯¹æ¯”Redis+Luaè„šæœ¬å’Œåˆ†å¸ƒå¼æ•°æ®åº“é”çš„æ–¹æ¡ˆä¼˜åŠ£ã€‚ &lt;a href=&#34;#%e7%a7%92%e6%9d%80%e4%bc%98%e6%83%a0%e5%88%b8%e5%a6%82%e4%bd%95%e9%98%b2%e6%ad%a2%e8%b6%85%e5%8f%91%e5%af%b9%e6%af%94redislua%e8%84%9a%e6%9c%ac%e5%92%8c%e5%88%86%e5%b8%83%e5%bc%8f%e6%95%b0%e6%8d%ae%e5%ba%93%e9%94%81%e7%9a%84%e6%96%b9%e6%a1%88%e4%bc%98%e5%8a%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;æ–¹æ¡ˆä¸€redis--lua-è„šæœ¬ä¸»æµç§’æ€é¦–é€‰&#34;&gt;æ–¹æ¡ˆä¸€ï¼šRedis + Lua è„šæœ¬ï¼ˆä¸»æµã€ç§’æ€é¦–é€‰ï¼‰ &lt;a href=&#34;#%e6%96%b9%e6%a1%88%e4%b8%80redis--lua-%e8%84%9a%e6%9c%ac%e4%b8%bb%e6%b5%81%e7%a7%92%e6%9d%80%e9%a6%96%e9%80%89&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;æ•°æ®ç»“æ„è®¾è®¡&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;keyè®¾è®¡ï¼š
coupon:stock:{couponId}: å­—ç¬¦ä¸²ï¼Œå‰©ä½™åº“å­˜æ•°ã€‚
coupon:user:{couponId}: Set æˆ– Hashï¼Œè®°å½•å·²é¢†å–ç”¨æˆ·ï¼ˆSet åšâ€œæ˜¯å¦å·²é¢†â€ï¼ŒHash å¯è®°å½•é¢†äº†å‡ å¼ ï¼‰ã€‚
åˆå§‹åŒ–æ—¶ï¼ˆæ´»åŠ¨å¼€å§‹å‰ï¼‰é¢„çƒ­åˆ° Redisï¼š
SET coupon:stock:1001 1000
SADD coupon:user:1001ï¼ˆç©ºé›†åˆå³å¯ï¼Œåç»­é€šè¿‡ SADD æ·»åŠ  userIdï¼‰
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;luaè„šæœ¬&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-lua&#34; data-lang=&#34;lua&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- KEYS[1]: coupon:stock:{couponId}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- KEYS[2]: coupon:user:{couponId}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- ARGV[1]: userId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- ARGV[2]: maxPerUserï¼ˆåŒä¸€ç”¨æˆ·æœ€å¤šå¯é¢†å‡ å¼ ï¼Œå¯ä¸º 1ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; stockKey   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; KEYS[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; userSetKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; KEYS[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; userId     &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ARGV[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; maxPerUser &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tonumber(ARGV[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- 1) ç”¨æˆ·æ˜¯å¦å·²è¾¾åˆ°é¢†å–ä¸Šé™&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; count &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tonumber(redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;HGET&amp;#34;&lt;/span&gt;, userSetKey, userId) &lt;span style=&#34;color:#f92672&#34;&gt;or&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; count &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; maxPerUser &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;-- è¶…è¿‡ä¸ªäººé™é¢&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- 2) æ£€æŸ¥åº“å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;local&lt;/span&gt; stock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tonumber(redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;, stockKey) &lt;span style=&#34;color:#f92672&#34;&gt;or&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; stock &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;-- åº“å­˜ä¸è¶³&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- 3) æ‰£åº“å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;DECR&amp;#34;&lt;/span&gt;, stockKey)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- 4) è®°å½•ç”¨æˆ·å·²é¢†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; count &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;HSET&amp;#34;&lt;/span&gt;, userSetKey, userId, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ts&amp;#34;&lt;/span&gt;, ARGV[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;]) &lt;span style=&#34;color:#75715e&#34;&gt;-- è®°å½•é¢†å–æ—¶é—´&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;HINCRBY&amp;#34;&lt;/span&gt;, userSetKey, userId, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;-- 5) è¿”å›å‰©ä½™åº“å­˜ï¼ˆå¯é€‰ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; tonumber(redis.call(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;, stockKey))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;PHPé›†æˆä¸MQé›†æˆï¼Œè½åº“&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     * ç”¨æˆ·é¢†å–ä¼˜æƒ åˆ¸ï¼ˆç§’æ€æ¥å£ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     * @param int $couponId  ä¼˜æƒ åˆ¸ID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     * @param int $userId    ç”¨æˆ·ID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     * @param int $maxPerUser æ¯äººæœ€å¤§å¯é¢†æ•°é‡ï¼ˆä¸€èˆ¬ 1ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     * @return array [&amp;#39;code&amp;#39;=&amp;gt;int, &amp;#39;msg&amp;#39;=&amp;gt;string, &amp;#39;leftStock&amp;#39;=&amp;gt;int|null]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;grabCoupon&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;int&lt;/span&gt; $couponId, &lt;span style=&#34;color:#a6e22e&#34;&gt;int&lt;/span&gt;$userId, &lt;span style=&#34;color:#a6e22e&#34;&gt;int&lt;/span&gt; $maxPerUser &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;array&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $stockKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;coupon:stock:&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;$couponId&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $userKey  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;coupon:user:&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{&lt;/span&gt;$couponId&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// Lua è„šæœ¬
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        $script &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;&amp;lt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;LUA&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local stockKey   = KEYS[1]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local userSetKey = KEYS[2]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local userId     = ARGV[1]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local maxPerUser = tonumber(ARGV[2])
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local nowTs      = ARGV[3]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local ttlSeconds = tonumber(ARGV[4]) // è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local count = tonumber(redis.call(&amp;#34;HGET&amp;#34;, userSetKey, userId) or &amp;#34;0&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;if count &amp;gt;= maxPerUser then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  return -1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;local stock = tonumber(redis.call(&amp;#34;GET&amp;#34;, stockKey) or &amp;#34;0&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;if stock &amp;lt;= 0 then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  return 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;redis.call(&amp;#34;DECR&amp;#34;, stockKey)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;if count == 0 then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  redis.call(&amp;#34;HSET&amp;#34;, userSetKey, userId, 1, &amp;#34;ts&amp;#34;, nowTs)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  if ttlSeconds and ttlSeconds &amp;gt; 0 then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    local ttl = redis.call(&amp;#34;TTL&amp;#34;, userSetKey)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    if ttl == -1 then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      redis.call(&amp;#34;EXPIRE&amp;#34;, userSetKey, ttlSeconds)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;else
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  redis.call(&amp;#34;HINCRBY&amp;#34;, userSetKey, userId, 1)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;return tonumber(redis.call(&amp;#34;GET&amp;#34;, stockKey))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;LUA&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ï¼Œeval çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯åŒ…å«æ‰€æœ‰ KEYS å’Œ ARGV çš„æ•°ç»„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ KEYS çš„ä¸ªæ•°ï¼ŒRedis ä¼šæŠŠå‰ N ä¸ªå…ƒç´ å½“ä½œ KEYSï¼Œåé¢çš„å½“ä½œ ARGV
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        $args &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            $stockKey,                 &lt;span style=&#34;color:#75715e&#34;&gt;// KEYS[1]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            $userKey,                  &lt;span style=&#34;color:#75715e&#34;&gt;// KEYS[2]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            $userId,                   &lt;span style=&#34;color:#75715e&#34;&gt;// ARGV[1]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            $maxPerUser,               &lt;span style=&#34;color:#75715e&#34;&gt;// ARGV[2]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            (&lt;span style=&#34;color:#a6e22e&#34;&gt;string&lt;/span&gt;)&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;(),            &lt;span style=&#34;color:#75715e&#34;&gt;// ARGV[3] å½“å‰æ—¶é—´æˆ³
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;24&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3600&lt;/span&gt;,             &lt;span style=&#34;color:#75715e&#34;&gt;// ARGV[4] è¿‡æœŸæ—¶é—´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        ];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $numKeys &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// KEYS çš„ä¸ªæ•°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$this&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;redis&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;eval&lt;/span&gt;($script,$args, $numKeys);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ($result &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// Redis é”™è¯¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;code&amp;#39;&lt;/span&gt;     &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $result &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;int&lt;/span&gt;)$result;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ($result &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// é¢†å–æˆåŠŸ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;code&amp;#39;&lt;/span&gt;     &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;é¢†å–æˆåŠŸ&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; $result,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ($result &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#75715e&#34;&gt;// åº“å­˜ä¸è¶³
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;code&amp;#39;&lt;/span&gt;     &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ä¼˜æƒ åˆ¸å·²è¢«æŠ¢å…‰&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// $result === -1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// é‡å¤é¢†å–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;code&amp;#39;&lt;/span&gt;     &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ä½ å·²ç»é¢†å–è¿‡è¯¥ä¼˜æƒ åˆ¸&amp;#39;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$service &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SeckillCouponService&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$couponId &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1001&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// æ´»åŠ¨å¼€å¯å‰ï¼Œåœ¨åå°ç®¡ç†æˆ–è„šæœ¬é‡Œåˆå§‹åŒ–åº“å­˜ï¼ˆåªåšä¸€æ¬¡ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;$service&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;initStock&lt;/span&gt;($couponId, &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ç”¨æˆ·è¯·æ±‚é¢†å–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;$userId &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;12345&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ret &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;$service&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;grabCoupon&lt;/span&gt;($couponId,$userId);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; ($ret[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;code&amp;#39;&lt;/span&gt;]) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;é¢†å–æˆåŠŸï¼Œå‰©ä½™åº“å­˜ï¼š&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; $ret[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PHP_EOL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—å°è£…ï¼ˆRedis List æˆ–æ›´ä¸“ä¸šçš„ MQï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        $event &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;json_encode&lt;/span&gt;([
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;couponId&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; $couponId,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;userId&amp;#39;&lt;/span&gt;   &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; $userId,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ts&amp;#39;&lt;/span&gt;       &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        $redis&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lPush&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;coupon:grab:queue&amp;#39;&lt;/span&gt;,$event);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å·²è¢«æŠ¢å…‰ï¼Œåº“å­˜ä¸è¶³ï¼š&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; $ret[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leftStock&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PHP_EOL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;echo&lt;/span&gt; $ret[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PHP_EOL&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// ä½ å·²ç»é¢†å–è¿‡è¯¥ä¼˜æƒ åˆ¸
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;echo&lt;/span&gt; $ret[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PHP_EOL&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// ç³»ç»Ÿé”™è¯¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ–¹æ¡ˆäºŒåˆ†å¸ƒå¼æ•°æ®åº“é”mysql-è¡Œé”--ä¹è§‚é”ç­‰&#34;&gt;æ–¹æ¡ˆäºŒï¼šåˆ†å¸ƒå¼æ•°æ®åº“é”ï¼ˆMySQL è¡Œé” / ä¹è§‚é”ç­‰ï¼‰ &lt;a href=&#34;#%e6%96%b9%e6%a1%88%e4%ba%8c%e5%88%86%e5%b8%83%e5%bc%8f%e6%95%b0%e6%8d%ae%e5%ba%93%e9%94%81mysql-%e8%a1%8c%e9%94%81--%e4%b9%90%e8%a7%82%e9%94%81%e7%ad%89&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;update&lt;/span&gt; coupon
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;set&lt;/span&gt; stock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stock &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt; id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;and&lt;/span&gt; stock &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¼ºç‚¹&#34;&gt;ç¼ºç‚¹ &lt;a href=&#34;#%e7%bc%ba%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;ç»´åº¦&lt;/th&gt;
          &lt;th&gt;Redis + Lua&lt;/th&gt;
          &lt;th&gt;æ•°æ®åº“é”&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;é˜²è¶…å‘èƒ½åŠ›&lt;/td&gt;
          &lt;td&gt;âœ… å¼º&lt;/td&gt;
          &lt;td&gt;âœ… å¼º&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ€§èƒ½&lt;/td&gt;
          &lt;td&gt;â­â­â­â­â­&lt;/td&gt;
          &lt;td&gt;â­&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å¹¶å‘èƒ½åŠ›&lt;/td&gt;
          &lt;td&gt;10ä¸‡~ç™¾ä¸‡&lt;/td&gt;
          &lt;td&gt;å‡ åƒ&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ¶æ„å¤æ‚åº¦&lt;/td&gt;
          &lt;td&gt;ä¸­&lt;/td&gt;
          &lt;td&gt;ä½&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ•°æ®ä¸€è‡´æ€§&lt;/td&gt;
          &lt;td&gt;æœ€ç»ˆä¸€è‡´&lt;/td&gt;
          &lt;td&gt;å¼ºä¸€è‡´&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ç§’æ€é€‚é…åº¦&lt;/td&gt;
          &lt;td&gt;â­â­â­â­â­&lt;/td&gt;
          &lt;td&gt;âŒ&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;å¤šçº§ç¼“å­˜æ¶æ„æœ¬åœ°ç¼“å­˜caffeineå’Œrediså¦‚ä½•ååŒä¿è¯æ•°æ®ä¸€è‡´æ€§&#34;&gt;å¤šçº§ç¼“å­˜æ¶æ„æœ¬åœ°ç¼“å­˜(Caffeine)å’ŒRediså¦‚ä½•ååŒä¿è¯æ•°æ®ä¸€è‡´æ€§? &lt;a href=&#34;#%e5%a4%9a%e7%ba%a7%e7%bc%93%e5%ad%98%e6%9e%b6%e6%9e%84%e6%9c%ac%e5%9c%b0%e7%bc%93%e5%ad%98caffeine%e5%92%8credis%e5%a6%82%e4%bd%95%e5%8d%8f%e5%90%8c%e4%bf%9d%e8%af%81%e6%95%b0%e6%8d%ae%e4%b8%80%e8%87%b4%e6%80%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;å¤šçº§ç¼“å­˜â€œä¸€å®šä¼šä¸ä¸€è‡´â€,åªèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;æœ€æ ¸å¿ƒçš„ååŒç­–ç•¥&#34;&gt;æœ€æ ¸å¿ƒçš„ååŒç­–ç•¥ &lt;a href=&#34;#%e6%9c%80%e6%a0%b8%e5%bf%83%e7%9a%84%e5%8d%8f%e5%90%8c%e7%ad%96%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å†™æ“ä½œï¼šå…ˆ DBï¼Œååˆ ç¼“å­˜ï¼ˆä¸¤çº§ï¼‰ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1. æ›´æ–° DBï¼ˆäº‹åŠ¡æäº¤ï¼‰
2. åˆ é™¤ Redis
3. åˆ é™¤ Caffeine
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;ä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Œæ˜¯åˆ é™¤ç¼“å­˜&lt;/code&gt; , æ›´æ–°ç¼“å­˜æ›´å®¹æ˜“è„å†™,åˆ é™¤è®©è¯»è¯·æ±‚å›æºé‡å»º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é˜²æ­¢å¹¶å‘å†™å¯¼è‡´è„æ•°æ®ï¼šå»¶è¿ŸåŒåˆ :&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1. åˆ  Redis + Caffeine
2. sleep 500ms
3. å†åˆ ä¸€æ¬¡ Redis
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹é—´æœ¬åœ°ç¼“å­˜ä¸€è‡´æ€§ï¼šæ¶ˆæ¯é€šçŸ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;DB æ›´æ–°
 â†’ åˆ é™¤ Redis
 â†’ å‘é€ MQ / Redis PubSub
 â†’ å„èŠ‚ç‚¹æ¸…ç†æœ¬åœ° Caffeine
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;TTL + ç‰ˆæœ¬å…œåº•ï¼ˆé˜²â€œæ°¸è¿œä¸ä¸€è‡´â€ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;æœ¬åœ°ç¼“å­˜ï¼šTTL = 30 ~ 60 ç§’
Redisç¼“å­˜ï¼šTTL =  5 ~ 10 åˆ†é’Ÿ
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å®Œæ•´è¯»å†™æµç¨‹çœŸå®ç”Ÿäº§&#34;&gt;å®Œæ•´è¯»å†™æµç¨‹ï¼ˆçœŸå®ç”Ÿäº§ï¼‰ &lt;a href=&#34;#%e5%ae%8c%e6%95%b4%e8%af%bb%e5%86%99%e6%b5%81%e7%a8%8b%e7%9c%9f%e5%ae%9e%e7%94%9f%e4%ba%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;è¯»æµç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1. æŸ¥ Caffeine
2. æœªå‘½ä¸­ â†’ æŸ¥ Redis
3. Redis å‘½ä¸­ â†’ å›å¡« Caffeine
4. Redis æœªå‘½ä¸­ â†’ æŸ¥ DB
5. å›å¡« Redis + Caffeine
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å†™æµç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1. åå°å†…å®¹æ“ä½œ
2. æ›´æ–° DBï¼ˆäº‹åŠ¡ï¼‰
3. åˆ é™¤ Redis
4. åˆ é™¤æœ¬åœ° Caffeine
5. å‘ MQ é€šçŸ¥
6. å„èŠ‚ç‚¹æ¸…æœ¬åœ°ç¼“å­˜
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;è®¢å•è¿‡æœŸå¤„ç†ç­–ç•¥å¦‚æ”¯ä»˜å¤–å–è®¢å•è¶…æ—¶&#34;&gt;è®¢å•è¿‡æœŸå¤„ç†ç­–ç•¥ï¼Œå¦‚æ”¯ä»˜ã€å¤–å–è®¢å•è¶…æ—¶ &lt;a href=&#34;#%e8%ae%a2%e5%8d%95%e8%bf%87%e6%9c%9f%e5%a4%84%e7%90%86%e7%ad%96%e7%95%a5%e5%a6%82%e6%94%af%e4%bb%98%e5%a4%96%e5%8d%96%e8%ae%a2%e5%8d%95%e8%b6%85%e6%97%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å®šæ—¶ä»»åŠ¡&#34;&gt;å®šæ—¶ä»»åŠ¡ &lt;a href=&#34;#%e5%ae%9a%e6%97%b6%e4%bb%bb%e5%8a%a1&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼šå®ç°é€»è¾‘ç®€å•ï¼Œæ‰«ææ•°æ®åº“å³å¯&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šæ—¶é—´ä¸å¤Ÿç²¾ç¡®ï¼Œå¦‚è®¢å•è¶…æ—¶10åˆ†é’Ÿï¼Œå®šæ—¶ä»»åŠ¡åªèƒ½æ¯1åˆ†é’Ÿæ‰«æä¸€æ¬¡ï¼Œä¼šæœ‰10åˆ†é’Ÿçš„å»¶è¿Ÿï¼Œéšç€æ•°æ®é‡çš„å¢åŠ å»¶è¿Ÿå¢å¤§&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;redisè¿‡æœŸç›‘å¬&#34;&gt;Redisè¿‡æœŸç›‘å¬ &lt;a href=&#34;#redis%e8%bf%87%e6%9c%9f%e7%9b%91%e5%90%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;æºç &lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// è®¢é˜…ç«¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() { &lt;span style=&#34;color:#75715e&#34;&gt;// ä¸»å‡½æ•°ï¼Œç¨‹åºå…¥å£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;addr&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:6379&amp;#34;&lt;/span&gt;               &lt;span style=&#34;color:#75715e&#34;&gt;// Redis åœ°å€ï¼ˆä¸»æœº:ç«¯å£ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;pwd&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;123456&amp;#34;&lt;/span&gt;                        &lt;span style=&#34;color:#75715e&#34;&gt;// Redis å¯†ç ï¼ˆå¦‚æ— å¯†ç å¯ç½®ç©ºï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;redis&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewClient&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;redis&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Options&lt;/span&gt;{ &lt;span style=&#34;color:#75715e&#34;&gt;// åˆ›å»º Redis å®¢æˆ·ç«¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Addr&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;addr&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;// è¿æ¥åœ°å€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Password&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;pwd&lt;/span&gt;,  &lt;span style=&#34;color:#75715e&#34;&gt;// è¿æ¥å¯†ç &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;DB&lt;/span&gt;:       &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,    &lt;span style=&#34;color:#75715e&#34;&gt;// ä½¿ç”¨çš„æ•°æ®åº“ç¼–å·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Ping&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;Result&lt;/span&gt;(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;// æ¢æµ‹è¿æ¥æ˜¯å¦æ­£å¸¸&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// è¿æ¥å¤±è´¥ç›´æ¥é€€å‡º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigSet&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;notify-keyspace-events&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Ex&amp;#34;&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;// å¯ç”¨é”®è¿‡æœŸäº‹ä»¶é€šçŸ¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// è®¾ç½®é€šçŸ¥å¤±è´¥ç›´æ¥é€€å‡ºï¼ˆäº‘æœåŠ¡å¯èƒ½éœ€è¦åœ¨æœåŠ¡ç«¯é…ç½®ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ps&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PSubscribe&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;__keyevent@0__:expired&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// è®¢é˜… DB0 çš„é”®è¿‡æœŸäº‹ä»¶é¢‘é“ï¼Œä¸å¯éšæ„æ›´æ”¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ps&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()                               &lt;span style=&#34;color:#75715e&#34;&gt;// ç¨‹åºç»“æŸæ—¶å…³é—­è®¢é˜…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ch&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ps&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Channel&lt;/span&gt;()                             &lt;span style=&#34;color:#75715e&#34;&gt;// è·å–è®¢é˜…æ¶ˆæ¯çš„é€šé“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ch&lt;/span&gt; {                          &lt;span style=&#34;color:#75715e&#34;&gt;// æŒç»­è¯»å–è¿‡æœŸäº‹ä»¶æ¶ˆæ¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Payload&lt;/span&gt;                        &lt;span style=&#34;color:#75715e&#34;&gt;// è¿‡æœŸçš„é”®å&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;strings&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HasPrefix&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pay:order:&amp;#34;&lt;/span&gt;) { &lt;span style=&#34;color:#75715e&#34;&gt;// åªå¤„ç†æ”¯ä»˜è®¢å•ç›¸å…³çš„é”®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;strings&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TrimPrefix&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pay:order:&amp;#34;&lt;/span&gt;)                                 &lt;span style=&#34;color:#75715e&#34;&gt;// æå–è®¢å• ID&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;timeout order=%s at=%s\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;Format&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RFC3339&lt;/span&gt;)) &lt;span style=&#34;color:#75715e&#34;&gt;// æ‰“å°è¶…æ—¶æ—¥å¿—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”Ÿäº§ç«¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;addr&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:6379&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;pwd&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;123456&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;redis&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewClient&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;redis&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Options&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Addr&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;addr&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Password&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;pwd&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;DB&lt;/span&gt;:       &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Ping&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;Result&lt;/span&gt;(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rand&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Seed&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;UnixNano&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sprintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%d%03d&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;UnixNano&lt;/span&gt;(), &lt;span style=&#34;color:#a6e22e&#34;&gt;rand&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Intn&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pay:order:&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Set&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;Format&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RFC3339&lt;/span&gt;), &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;(); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;create order=%s ttl=10s\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;id&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹: ç”±äºredisçš„é«˜æ€§èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è®¾ç½®keyï¼Œæˆ–è€…æ¶ˆè´¹key æ—¶ï¼Œé€Ÿåº¦ä¸Šæ˜¯å¯ä»¥ä¿è¯çš„ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹: ç”±äºredis çš„key è¿‡æœŸç­–ç•¥åŸå› ï¼Œå½“ä¸€ä¸ªkey è¿‡æœŸæ—¶ï¼Œredis æ— æ³•ä¿è¯ç«‹åˆ»å°†å…¶åˆ é™¤ï¼Œè‡ªç„¶æˆ‘ä»¬çš„ç›‘å¬äº‹ä»¶ä¹Ÿæ— æ³•ç¬¬ä¸€æ—¶é—´æ¶ˆè´¹åˆ°è¿™ä¸ªkeyï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿã€‚å¦å¤–ï¼Œåœ¨redis5.0ä¹‹å‰ï¼Œè®¢é˜…å‘å¸ƒä¸­çš„æ¶ˆæ¯å¹¶æ²¡æœ‰è¢«æŒä¹…åŒ–ï¼Œè‡ªç„¶ä¹Ÿæ²¡æœ‰æ‰€è°“çš„ç¡®è®¤æœºåˆ¶ã€‚æ‰€ä»¥ä¸€æ—¦æ¶ˆè´¹æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬çš„å®¢æˆ·ç«¯å‘ç”Ÿäº†å®•æœºï¼Œè¿™æ¡æ¶ˆæ¯å°±å½»åº•ä¸¢å¤±äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;rocketmqå»¶è¿Ÿé˜Ÿåˆ—-æˆ–è€…-æ­»ä¿¡é˜Ÿåˆ—&#34;&gt;RocketMQå»¶è¿Ÿé˜Ÿåˆ— æˆ–è€… æ­»ä¿¡é˜Ÿåˆ— &lt;a href=&#34;#rocketmq%e5%bb%b6%e8%bf%9f%e9%98%9f%e5%88%97-%e6%88%96%e8%80%85-%e6%ad%bb%e4%bf%a1%e9%98%9f%e5%88%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å»¶è¿Ÿæ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯å†™å…¥åˆ°Brokeråï¼Œä¸ä¼šç«‹åˆ»è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œéœ€è¦ç­‰å¾…æŒ‡å®šçš„æ—¶é•¿åæ‰å¯è¢«æ¶ˆè´¹å¤„ç†çš„æ¶ˆæ¯ï¼Œç§°ä¸ºå»¶æ—¶æ¶ˆæ¯ã€‚
åœ¨è®¢å•åˆ›å»ºä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè®¢å•ä½œä¸ºä¸€æ¡æ¶ˆæ¯æŠ•é€’åˆ°rocketmqï¼Œå¹¶å°†å»¶è¿Ÿæ—¶é—´è®¾ç½®ä¸º 30åˆ†é’Ÿï¼Œè¿™æ ·ï¼Œ30åˆ†é’Ÿåæˆ‘ä»¬å®šä¹‰çš„consumer å°±å¯ä»¥æ¶ˆè´¹åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œç„¶åæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ”¯ä»˜äº†è¿™ä¸ªè®¢å•ã€‚
é€šè¿‡å»¶è¿Ÿæ¶ˆæ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä¸šåŠ¡è§£è€¦ï¼Œæå¤§åœ°ç®€åŒ–æˆ‘ä»¬çš„ä»£ç é€»è¾‘ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹:å¯ä»¥ä½¿ä»£ç é€»è¾‘æ¸…æ™°ï¼Œç³»ç»Ÿä¹‹é—´å®Œå…¨è§£è€¦ï¼Œåªéœ€å…³æ³¨ç”Ÿäº§åŠæ¶ˆè´¹æ¶ˆæ¯å³å¯ã€‚å¦å¤–å…¶ååé‡æé«˜ï¼Œæœ€å¤šå¯ä»¥æ”¯æ’‘ä¸‡äº¿çº§çš„æ•°æ®é‡ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹:ç›¸å¯¹æ¥è¯´mqæ˜¯é‡é‡çº§çš„ç»„ä»¶ï¼Œå¼•å…¥mqä¹‹åï¼Œéšä¹‹è€Œæ¥çš„æ¶ˆæ¯ä¸¢å¤±ã€å¹‚ç­‰æ€§é—®é¢˜ç­‰éƒ½åŠ æ·±äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;li&gt;æ€»ç»“:é€šè¿‡ mq è¿›è¡Œç³»ç»Ÿä¸šåŠ¡è§£è€¦ï¼Œä»¥åŠå¯¹ç³»ç»Ÿæ€§èƒ½å‰Šå³°å¡«è°·å·²ç»æ˜¯å½“å‰é«˜æ€§èƒ½ç³»ç»Ÿçš„æ ‡é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>mysqlæ€»ç»“</title>
      <link>https://abnerxc.github.io/note/mysql-%E6%80%BB%E7%BB%93/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/mysql-%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;h1 id=&#34;å®è§‚äº†è§£&#34;&gt;å®è§‚äº†è§£ &lt;a href=&#34;#%e5%ae%8f%e8%a7%82%e4%ba%86%e8%a7%a3&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-a.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;æŸ¥è¯¢ç¼“å­˜&#34;&gt;æŸ¥è¯¢ç¼“å­˜ &lt;a href=&#34;#%e6%9f%a5%e8%af%a2%e7%bc%93%e5%ad%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æˆ‘ä»¬å…ˆé€šè¿‡&lt;code&gt;show variables like &#39;%query_cache%&#39;&lt;/code&gt;æ¥çœ‹ä¸€ä¸‹é»˜è®¤çš„æ•°æ®åº“é…ç½®ï¼Œ&lt;code&gt;query_cache_type=ON&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç†ï¼šMYSQLçš„æŸ¥è¯¢ç¼“å­˜å®è´¨ä¸Šæ˜¯ç¼“å­˜SQLçš„hashå€¼å’Œè¯¥SQLçš„æŸ¥è¯¢ç»“æœï¼Œå¦‚æœè¿è¡Œç›¸åŒçš„SQL,æœåŠ¡å™¨ç›´æ¥ä»ç¼“å­˜ä¸­å»æ‰ç»“æœï¼Œè€Œä¸å†å»è§£æï¼Œä¼˜åŒ–ï¼Œå¯»æ‰¾æœ€ä½æˆæœ¬çš„æ‰§è¡Œè®¡åˆ’ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œå¤§å¤§æå‡äº†æŸ¥è¯¢é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;å¼Šç«¯ï¼šæ‰§è¡Œçš„SQLè¯­å¥å¿…é¡»ä¸€æ ·ï¼ˆå¤§å°å†™ï¼Œé—´éš”ç­‰ï¼‰ï¼Œå¦‚æœä¸ä¸€æ ·å°†ä¼šäº§ç”Ÿä¸åŒçš„hashå€¼&lt;/li&gt;
&lt;li&gt;åœºæ™¯ï¼šé€šè¿‡è§‚å¯Ÿäº‘å‚å•†ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯å…³é—­æŸ¥è¯¢ç¼“å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¼•æ“&#34;&gt;å¼•æ“ &lt;a href=&#34;#%e5%bc%95%e6%93%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;myisamå­˜å‚¨å¼•æ“&#34;&gt;MyISAMå­˜å‚¨å¼•æ“ &lt;a href=&#34;#myisam%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;MyISAMåŸºäºISAMå­˜å‚¨å¼•æ“ï¼Œå¹¶å¯¹å…¶è¿›è¡Œæ‰©å±•ã€‚ä½¿ç”¨MyISAMå¼•æ“åˆ›å»ºæ•°æ®åº“ï¼Œå°†äº§ç”Ÿ3ä¸ªæ–‡ä»¶,æ–‡ä»¶çš„åå­—ä»¥è¡¨åå­—å¼€å§‹ï¼Œ&lt;code&gt;æ‰©å±•åä¹‹å¤„æ–‡ä»¶ç±»å‹ï¼šfrmæ–‡ä»¶å­˜å‚¨è¡¨å®šä¹‰ã€æ•°æ®æ–‡ä»¶çš„æ‰©å±•åä¸º.MYDï¼ˆMYDataï¼‰ã€ç´¢å¼•æ–‡ä»¶çš„æ‰©å±•åæ—¶.MYIï¼ˆMYIndexï¼‰&lt;/code&gt;ã€‚MyISAMæ‹¥æœ‰è¾ƒé«˜çš„æ’å…¥ã€æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†&lt;code&gt;ä¸æ”¯æŒäº‹ç‰©&lt;/code&gt;ã€‚MyISAMä¸»è¦ç‰¹æ€§æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤§æ–‡ä»¶ï¼ˆè¾¾åˆ°63ä½æ–‡ä»¶é•¿åº¦ï¼‰åœ¨æ”¯æŒå¤§æ–‡ä»¶çš„æ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿä¸Šè¢«æ”¯æŒ&lt;/li&gt;
&lt;li&gt;å½“æŠŠåˆ é™¤å’Œæ›´æ–°åŠæ’å…¥æ“ä½œæ··åˆä½¿ç”¨çš„æ—¶å€™ï¼ŒåŠ¨æ€å°ºå¯¸çš„è¡Œäº§ç”Ÿæ›´å°‘ç¢ç‰‡ã€‚è¿™è¦é€šè¿‡åˆå¹¶ç›¸é‚»è¢«åˆ é™¤çš„å—ï¼Œä»¥åŠè‹¥ä¸‹ä¸€ä¸ªå—è¢«åˆ é™¤ï¼Œå°±æ‰©å±•åˆ°ä¸‹ä¸€å—è‡ªåŠ¨å®Œæˆ&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªMyISAMè¡¨æœ€å¤§ç´¢å¼•æ•°æ˜¯64ï¼Œè¿™å¯ä»¥é€šè¿‡é‡æ–°ç¼–è¯‘æ¥æ”¹å˜ã€‚æ¯ä¸ªç´¢å¼•æœ€å¤§çš„åˆ—æ•°æ˜¯16&lt;/li&gt;
&lt;li&gt;æœ€å¤§çš„é”®é•¿åº¦æ˜¯1000å­—èŠ‚ï¼Œè¿™ä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¯‘æ¥æ”¹å˜ï¼Œå¯¹äºé”®é•¿åº¦è¶…è¿‡250å­—èŠ‚çš„æƒ…å†µï¼Œä¸€ä¸ªè¶…è¿‡1024å­—èŠ‚çš„é”®å°†è¢«ç”¨ä¸Š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BLOBå’ŒTEXTåˆ—å¯ä»¥è¢«ç´¢å¼•&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;NULLè¢«å…è®¸åœ¨ç´¢å¼•çš„åˆ—ä¸­ï¼Œè¿™ä¸ªå€¼å æ¯ä¸ªé”®çš„0~1ä¸ªå­—èŠ‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰æ•°å­—é”®å€¼ä»¥é«˜å­—èŠ‚ä¼˜å…ˆè¢«å­˜å‚¨ä»¥å…è®¸ä¸€ä¸ªæ›´é«˜çš„ç´¢å¼•å‹ç¼©&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¯ä¸ªMyISAMç±»å‹çš„è¡¨éƒ½æœ‰ä¸€ä¸ªAUTO_INCREMENTçš„å†…éƒ¨åˆ—ï¼Œå½“INSERTå’ŒUPDATEæ“ä½œçš„æ—¶å€™è¯¥åˆ—è¢«æ›´æ–°ï¼ŒåŒæ—¶AUTO_INCREMENTåˆ—å°†è¢«åˆ·æ–°ã€‚æ‰€ä»¥è¯´ï¼ŒMyISAMç±»å‹è¡¨çš„AUTO_INCREMENTåˆ—æ›´æ–°æ¯”InnoDBç±»å‹çš„AUTO_INCREMENTæ›´å¿«&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¯ä»¥æŠŠæ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶æ”¾åœ¨ä¸åŒç›®å½•&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå­—ç¬¦åˆ—å¯ä»¥æœ‰ä¸åŒçš„å­—ç¬¦é›†&lt;/li&gt;
&lt;li&gt;æœ‰VARCHARçš„è¡¨å¯ä»¥å›ºå®šæˆ–åŠ¨æ€è®°å½•é•¿åº¦&lt;/li&gt;
&lt;li&gt;VARCHARå’ŒCHARåˆ—å¯ä»¥å¤šè¾¾64KB&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;innodbå­˜å‚¨å¼•æ“&#34;&gt;InnoDBå­˜å‚¨å¼•æ“ &lt;a href=&#34;#innodb%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;InnoDBä¸åˆ›å»ºç›®å½•ï¼Œä½¿ç”¨InnoDBæ—¶ï¼ŒMySQLå°†åœ¨MySQLæ•°æ®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºibdata1çš„10MBå¤§å°çš„è‡ªåŠ¨æ‰©å±•æ•°æ®æ–‡ä»¶ï¼Œä»¥åŠä¸¤ä¸ªåä¸ºib_logfile0å’Œib_logfile1çš„5MBå¤§å°çš„æ—¥å¿—æ–‡ä»¶
InnoDBæ˜¯äº‹åŠ¡å‹æ•°æ®åº“çš„é¦–é€‰å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡å®‰å…¨è¡¨ï¼ˆACIDï¼‰ï¼Œæ”¯æŒè¡Œé”å®šå’Œå¤–é”®ï¼ŒInnoDBæ˜¯é»˜è®¤çš„MySQLå¼•æ“ã€‚InnoDBä¸»è¦ç‰¹æ€§æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;InnoDBç»™MySQLæä¾›äº†å…·æœ‰æäº¤ã€å›æ»šå’Œå´©æºƒæ¢å¤èƒ½åŠ›çš„äº‹ç‰©å®‰å…¨ï¼ˆACIDå…¼å®¹ï¼‰å­˜å‚¨å¼•æ“ã€‚InnoDBé”å®šåœ¨è¡Œçº§å¹¶ä¸”ä¹Ÿåœ¨SELECTè¯­å¥ä¸­æä¾›ä¸€ä¸ªç±»ä¼¼Oracleçš„éé”å®šè¯»ã€‚è¿™äº›åŠŸèƒ½å¢åŠ äº†å¤šç”¨æˆ·éƒ¨ç½²å’Œæ€§èƒ½ã€‚åœ¨SQLæŸ¥è¯¢ä¸­ï¼Œå¯ä»¥è‡ªç”±åœ°å°†InnoDBç±»å‹çš„è¡¨å’Œå…¶ä»–MySQLçš„è¡¨ç±»å‹æ··åˆèµ·æ¥ï¼Œç”šè‡³åœ¨åŒä¸€ä¸ªæŸ¥è¯¢ä¸­ä¹Ÿå¯ä»¥æ··åˆ&lt;/li&gt;
&lt;li&gt;InnoDBæ˜¯ä¸ºå¤„ç†å·¨å¤§æ•°æ®é‡çš„æœ€å¤§æ€§èƒ½è®¾è®¡ã€‚å®ƒçš„CPUæ•ˆç‡å¯èƒ½æ˜¯ä»»ä½•å…¶ä»–åŸºäºç£ç›˜çš„å…³ç³»å‹æ•°æ®åº“å¼•æ“é”ä¸èƒ½åŒ¹æ•Œçš„&lt;/li&gt;
&lt;li&gt;InnoDBå­˜å‚¨å¼•æ“å®Œå…¨ä¸MySQLæœåŠ¡å™¨æ•´åˆï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¸ºåœ¨ä¸»å†…å­˜ä¸­ç¼“å­˜æ•°æ®å’Œç´¢å¼•è€Œç»´æŒå®ƒè‡ªå·±çš„ç¼“å†²æ± ã€‚InnoDBå°†å®ƒçš„è¡¨å’Œç´¢å¼•åœ¨ä¸€ä¸ªé€»è¾‘è¡¨ç©ºé—´ä¸­ï¼Œè¡¨ç©ºé—´å¯ä»¥åŒ…å«æ•°ä¸ªæ–‡ä»¶ï¼ˆæˆ–åŸå§‹ç£ç›˜æ–‡ä»¶ï¼‰ã€‚è¿™ä¸MyISAMè¡¨ä¸åŒï¼Œæ¯”å¦‚åœ¨MyISAMè¡¨ä¸­æ¯ä¸ªè¡¨è¢«å­˜æ”¾åœ¨åˆ†ç¦»çš„æ–‡ä»¶ä¸­ã€‚InnoDBè¡¨å¯ä»¥æ˜¯ä»»ä½•å°ºå¯¸ï¼Œå³ä½¿åœ¨æ–‡ä»¶å°ºå¯¸è¢«é™åˆ¶ä¸º2GBçš„æ“ä½œç³»ç»Ÿä¸Š&lt;/li&gt;
&lt;li&gt;InnoDBæ”¯æŒå¤–é”®å®Œæ•´æ€§çº¦æŸï¼Œå­˜å‚¨è¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œæ¯å¼ è¡¨çš„å­˜å‚¨éƒ½æŒ‰ä¸»é”®é¡ºåºå­˜æ”¾ï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºåœ¨è¡¨å®šä¹‰æ—¶æŒ‡å®šä¸»é”®ï¼ŒInnoDBä¼šä¸ºæ¯ä¸€è¡Œç”Ÿæˆä¸€ä¸ª6å­—èŠ‚çš„ROWIDï¼Œå¹¶ä»¥æ­¤ä½œä¸ºä¸»é”®&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;mysqlä¸­myisamä¸innodbçš„åŒºåˆ«&#34;&gt;MySQLä¸­myisamä¸innodbçš„åŒºåˆ« &lt;a href=&#34;#mysql%e4%b8%admyisam%e4%b8%8einnodb%e7%9a%84%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;InnoDBæ”¯æŒäº‹ç‰©ï¼Œè€ŒMyISAMä¸æ”¯æŒäº‹ç‰©&lt;/li&gt;
&lt;li&gt;InnoDBæ”¯æŒè¡Œçº§é”ï¼Œè€ŒMyISAMæ”¯æŒè¡¨çº§é”&lt;/li&gt;
&lt;li&gt;InnoDBæ”¯æŒMVCC, è€ŒMyISAMä¸æ”¯æŒ&lt;/li&gt;
&lt;li&gt;InnoDBæ”¯æŒå¤–é”®ï¼Œè€ŒMyISAMä¸æ”¯æŒ&lt;/li&gt;
&lt;li&gt;InnoDBä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œè€ŒMyISAMæ”¯æŒï¼ˆ5.6ç‰ˆæœ¬å·²ç»æ”¯æŒäº†ï¼‰&lt;/li&gt;
&lt;li&gt;MYSQLå¼•æ“çš„æ–‡ä»¶åŒ…å«ï¼ˆ.frm-è¡¨ç»“æ„æ–‡ä»¶ã€.myd-è¡¨æ•°æ®æ–‡ä»¶ï¼Œ.myi-è¡¨ç´¢å¼•æ–‡ä»¶ï¼‰&lt;/li&gt;
&lt;li&gt;InnoDBå¼•æ“åŒ…å«æ–‡ä»¶ï¼ˆ*.frm-è¡¨ç»“æ„æ–‡ä»¶ï¼Œibd-æ•°æ®å’Œç´¢å¼•æ–‡ä»¶ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç´¢å¼•&#34;&gt;ç´¢å¼• &lt;a href=&#34;#%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;èšé›†ç´¢å¼•&#34;&gt;èšé›†ç´¢å¼• &lt;a href=&#34;#%e8%81%9a%e9%9b%86%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;InnoDBçš„ä¸»é”®ç´¢å¼•ä¸è¡Œè®°å½•æ˜¯å­˜å‚¨åœ¨ä¸€èµ·çš„ï¼Œæ•…å«åšèšé›†ç´¢å¼•ï¼ˆClustered Indexï¼‰ï¼š&lt;/p&gt;
&lt;h2 id=&#34;éèšé›†ç´¢å¼•&#34;&gt;éèšé›†ç´¢å¼• &lt;a href=&#34;#%e9%9d%9e%e8%81%9a%e9%9b%86%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;MyISAMçš„ç´¢å¼•ä¸è¡Œè®°å½•æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå«åšéèšé›†ç´¢å¼•ï¼ˆUnClustered Indexï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è”åˆç´¢å¼•&#34;&gt;è”åˆç´¢å¼• &lt;a href=&#34;#%e8%81%94%e5%90%88%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å¤šä¸ªå­—æ®µä¸Šå»ºç«‹çš„ç´¢å¼•ï¼Œèƒ½å¤ŸåŠ é€Ÿå¤æ ¸æŸ¥è¯¢æ¡ä»¶çš„æ£€ç´¢ã€‚æ‰€ä»¥è¯¥ç´¢å¼•ä¹Ÿæœ‰æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œ5.6ç‰ˆæœ¬å»¶ä¼¸å‡ºæ¥çš„&lt;code&gt;ç´¢å¼•ä¸‹æ¨&lt;/code&gt;è§ä¸‹æ–‡&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªè¯´æ˜ï¼Œä¸å¦¨è®¾æœ‰è¡¨ï¼š&lt;code&gt;t(id PK, name KEY, sex, flag);&lt;/code&gt; ç”»å¤–éŸ³ï¼šidæ˜¯èšé›†ç´¢å¼•ï¼Œnameæ˜¯æ™®é€šç´¢å¼•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;mysqlçš„ç´¢å¼•æ–¹æ³•btreeå’Œhashçš„åŒºåˆ«&#34;&gt;mysqlçš„ç´¢å¼•æ–¹æ³•btreeå’Œhashçš„åŒºåˆ« &lt;a href=&#34;#mysql%e7%9a%84%e7%b4%a2%e5%bc%95%e6%96%b9%e6%b3%95btree%e5%92%8chash%e7%9a%84%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;hash
&lt;ol&gt;
&lt;li&gt;memoryå¼•æ“æ‰æ˜¾ç¤ºçš„æ”¯æŒHashç´¢å¼•ï¼ŒinnoDbé»˜è®¤æ˜¯B+æ ‘&lt;/li&gt;
&lt;li&gt;Hash ç´¢å¼•ä»…ä»…èƒ½æ»¡è¶³&amp;quot;=&amp;quot;,&amp;ldquo;IN&amp;quot;å’Œ&amp;rdquo;&amp;lt;= &amp;amp; &amp;gt;=&amp;ldquo;æŸ¥è¯¢ï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;Hash ç´¢å¼•æ— æ³•è¢«ç”¨æ¥é¿å…æ•°æ®çš„æ’åºæ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;Hash ç´¢å¼•ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•é”®æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;Hash ç´¢å¼•åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸èƒ½é¿å…è¡¨æ‰«æã€‚&lt;/li&gt;
&lt;li&gt;Hash ç´¢å¼•é‡åˆ°å¤§é‡Hashå€¼ç›¸ç­‰çš„æƒ…å†µåæ€§èƒ½å¹¶ä¸ä¸€å®šå°±ä¼šæ¯”B-Treeç´¢å¼•é«˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;btree
ä¸hashçš„ç¼ºç‚¹å°±æ˜¯btreeçš„ç‰¹ç‚¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å“ˆå¸Œhashæ¯”æ ‘treeæ›´å¿«ç´¢å¼•ç»“æ„ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆæ ‘å‹&#34;&gt;å“ˆå¸Œ(hash)æ¯”æ ‘(tree)æ›´å¿«ï¼Œç´¢å¼•ç»“æ„ä¸ºä»€ä¹ˆè¦è®¾è®¡æˆæ ‘å‹ï¼Ÿ &lt;a href=&#34;#%e5%93%88%e5%b8%8chash%e6%af%94%e6%a0%91tree%e6%9b%b4%e5%bf%ab%e7%b4%a2%e5%bc%95%e7%bb%93%e6%9e%84%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e8%ae%be%e8%ae%a1%e6%88%90%e6%a0%91%e5%9e%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åŠ é€ŸæŸ¥æ‰¾é€Ÿåº¦çš„æ•°æ®ç»“æ„ï¼Œå¸¸è§çš„æœ‰ä¸¤ç±»ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å“ˆå¸Œï¼Œä¾‹å¦‚HashMapï¼ŒæŸ¥è¯¢/æ’å…¥/ä¿®æ”¹/åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼›&lt;/li&gt;
&lt;li&gt;æ ‘ï¼Œä¾‹å¦‚å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ŒæŸ¥è¯¢/æ’å…¥/ä¿®æ”¹/åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(lg(n))ï¼›&lt;br&gt;
&lt;strong&gt;å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æ˜¯è¯»è¯·æ±‚ï¼Œè¿˜æ˜¯å†™è¯·æ±‚ï¼Œå“ˆå¸Œç±»å‹çš„ç´¢å¼•ï¼Œéƒ½è¦æ¯”æ ‘å‹çš„ç´¢å¼•æ›´å¿«ä¸€äº›ï¼Œé‚£ä¸ºä»€ä¹ˆï¼Œç´¢å¼•ç»“æ„è¦è®¾è®¡æˆæ ‘å‹å‘¢ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç´¢å¼•è®¾è®¡æˆæ ‘å½¢ï¼Œå’ŒSQLçš„éœ€æ±‚ç›¸å…³ã€‚
å¯¹äºè¿™æ ·ä¸€ä¸ªå•è¡ŒæŸ¥è¯¢çš„SQLéœ€æ±‚ï¼š&lt;code&gt;select * from t where name=â€shenjianâ€;&lt;/code&gt;ç¡®å®æ˜¯å“ˆå¸Œç´¢å¼•æ›´å¿«ï¼Œå› ä¸ºæ¯æ¬¡éƒ½åªæŸ¥è¯¢ä¸€æ¡è®°å½•ã€‚&lt;br&gt;
&lt;strong&gt;ç”»å¤–éŸ³ï¼šæ‰€ä»¥ï¼Œå¦‚æœä¸šåŠ¡éœ€æ±‚éƒ½æ˜¯å•è¡Œè®¿é—®ï¼Œä¾‹å¦‚passportï¼Œç¡®å®å¯ä»¥ä½¿ç”¨å“ˆå¸Œç´¢å¼•&lt;/strong&gt;
ä½†æ˜¯å¯¹äºæ’åºæŸ¥è¯¢çš„SQLéœ€æ±‚&lt;code&gt;åˆ†ç»„ï¼šgroup by   æ’åºï¼šorder by   æ¯”è¾ƒï¼š&amp;lt;ã€&amp;gt;  &lt;/code&gt;å“ˆå¸Œå‹çš„ç´¢å¼•ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šé€€åŒ–ä¸ºO(n)ï¼Œè€Œæ ‘å‹çš„â€œæœ‰åºâ€ç‰¹æ€§ï¼Œä¾ç„¶èƒ½å¤Ÿä¿æŒO(log(n)) çš„é«˜æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ•°æ®åº“ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨bæ ‘&#34;&gt;æ•°æ®åº“ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘ï¼Ÿ &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%ba%93%e7%b4%a2%e5%bc%95%e4%b8%ba%e4%bb%80%e4%b9%88%e4%bd%bf%e7%94%a8b%e6%a0%91&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#B+%E6%A0%91&#34;&gt;B+æ ‘äº†è§£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;äºŒå‰æœç´¢æ ‘
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-b.jpeg&#34; alt=&#34;&#34;&gt;
äºŒå‰æœç´¢æ ‘ï¼Œå¦‚ä¸Šå›¾ï¼Œæ˜¯æœ€ä¸ºå¤§å®¶æ‰€ç†ŸçŸ¥çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°±ä¸å±•å¼€ä»‹ç»äº†ï¼Œå®ƒä¸ºä»€ä¹ˆä¸é€‚åˆç”¨ä½œæ•°æ®åº“ç´¢å¼•ï¼Ÿ&lt;br&gt;
(1)å½“æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œæ ‘çš„é«˜åº¦ä¼šæ¯”è¾ƒé«˜ï¼Œæ•°æ®é‡å¤§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢ä¼šæ¯”è¾ƒæ…¢ï¼›&lt;br&gt;
(2)æ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨ä¸€ä¸ªè®°å½•ï¼Œå¯èƒ½å¯¼è‡´ä¸€æ¬¡æŸ¥è¯¢æœ‰å¾ˆå¤šæ¬¡ç£ç›˜IOï¼›&lt;/li&gt;
&lt;li&gt;Bæ ‘
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-c.jpeg&#34; alt=&#34;&#34;&gt;
Bæ ‘ï¼Œå¦‚ä¸Šå›¾ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š&lt;br&gt;
(1)ä¸å†æ˜¯äºŒå‰æœç´¢ï¼Œè€Œæ˜¯må‰æœç´¢ï¼›&lt;br&gt;
(2)å¶å­èŠ‚ç‚¹ï¼Œéå¶å­èŠ‚ç‚¹ï¼Œéƒ½å­˜å‚¨æ•°æ®ï¼›&lt;br&gt;
(3)ä¸­åºéå†ï¼Œå¯ä»¥è·å¾—æ‰€æœ‰èŠ‚ç‚¹ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ ‘è¢«ä½œä¸ºå®ç°ç´¢å¼•çš„æ•°æ®ç»“æ„è¢«åˆ›é€ å‡ºæ¥ï¼Œæ˜¯å› ä¸ºå®ƒèƒ½å¤Ÿå®Œç¾çš„åˆ©ç”¨â€œå±€éƒ¨æ€§åŸç†â€ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢&#34;&gt;ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e5%9b%9e%e8%a1%a8%e6%9f%a5%e8%af%a2&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;InnoDBèšé›†ç´¢å¼•å’Œæ™®é€šç´¢å¼•æœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ
InnoDBèšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨è¡Œè®°å½•ï¼Œå› æ­¤ï¼Œ InnoDBå¿…é¡»è¦æœ‰ï¼Œä¸”åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœè¡¨å®šä¹‰äº†PKï¼Œåˆ™PKå°±æ˜¯èšé›†ç´¢å¼•ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœè¡¨æ²¡æœ‰å®šä¹‰PKï¼Œåˆ™ç¬¬ä¸€ä¸ªnot NULL uniqueåˆ—æ˜¯èšé›†ç´¢å¼•ï¼›&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼ŒInnoDBä¼šåˆ›å»ºä¸€ä¸ªéšè—çš„row-idä½œä¸ºèšé›†ç´¢å¼•ï¼›
&lt;em&gt;&lt;strong&gt;æ‰€ä»¥PKæŸ¥è¯¢éå¸¸å¿«ï¼Œç›´æ¥å®šä½è¡Œè®°å½•ã€‚&lt;/strong&gt;&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;InnoDBæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å€¼ã€‚
&lt;em&gt;&lt;strong&gt;æ³¨æ„ï¼Œä¸æ˜¯å­˜å‚¨è¡Œè®°å½•å¤´æŒ‡é’ˆï¼ŒMyISAMçš„ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨è®°å½•æŒ‡é’ˆã€‚&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å›è¡¨æŸ¥è¯¢è¿‡ç¨‹
ä¸¾ä¸ªæ —å­ï¼Œä¸å¦¨è®¾æœ‰è¡¨ï¼št(id PK, name KEY, sex, flag);
è¡¨ä¸­æœ‰å››æ¡è®°å½•ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1, shenjian, m, A
3, zhangsan, m, A
5, lisi, m, A
9, wangwu, f, B
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-d.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸¤ä¸ªB+æ ‘ç´¢å¼•åˆ†åˆ«å¦‚ä¸Šå›¾ï¼š
ã€€ã€€ï¼ˆ1ï¼‰idä¸ºPKï¼Œèšé›†ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨è¡Œè®°å½•ï¼›
ã€€ã€€ï¼ˆ2ï¼‰nameä¸ºKEYï¼Œæ™®é€šç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨PKå€¼ï¼Œå³idï¼›
æ—¢ç„¶ä»æ™®é€šç´¢å¼•æ— æ³•ç›´æ¥å®šä½è¡Œè®°å½•ï¼Œé‚£æ™®é€šç´¢å¼•çš„æŸ¥è¯¢è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ
é€šå¸¸æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰«ç ä¸¤éç´¢å¼•æ ‘ã€‚
ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;select * from t where name=&amp;#39;lisi&amp;#39;;ã€€ 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-e.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚çº¢è‰²è·¯å¾„ï¼Œéœ€è¦æ‰«ç ä¸¤éç´¢å¼•æ ‘ï¼š
ï¼ˆ1ï¼‰å…ˆé€šè¿‡æ™®é€šç´¢å¼•å®šä½åˆ°ä¸»é”®å€¼id=5ï¼›
ï¼ˆ2ï¼‰åœ¨é€šè¿‡èšé›†ç´¢å¼•å®šä½åˆ°è¡Œè®°å½•ï¼›
è¿™å°±æ˜¯&lt;code&gt;å›è¡¨æŸ¥è¯¢&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç´¢å¼•è¦†ç›–covering-index&#34;&gt;ç´¢å¼•è¦†ç›–(Covering index)ï¼Ÿ &lt;a href=&#34;#%e7%b4%a2%e5%bc%95%e8%a6%86%e7%9b%96covering-index&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ä»€ä¹ˆæ˜¯ç´¢å¼•è¦†ç›–&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;MySQLå®˜ç½‘ï¼Œç±»ä¼¼çš„è¯´æ³•å‡ºç°åœ¨explainæŸ¥è¯¢è®¡åˆ’ä¼˜åŒ–ç« èŠ‚ï¼Œå³&lt;code&gt;explainçš„è¾“å‡ºç»“æœExtraå­—æ®µä¸ºUsing indexæ—¶ï¼Œèƒ½å¤Ÿè§¦å‘ç´¢å¼•è¦†ç›–&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ç®¡æ˜¯SQL-Serverå®˜ç½‘ï¼Œè¿˜æ˜¯MySQLå®˜ç½‘ï¼Œéƒ½è¡¨è¾¾äº†ï¼š&lt;code&gt;åªéœ€è¦åœ¨ä¸€æ£µç´¢å¼•æ ‘ä¸Šå°±èƒ½è·å–SQLæ‰€éœ€çš„æ‰€æœ‰åˆ—æ•°æ®ï¼Œæ— éœ€å›è¡¨ï¼Œé€Ÿåº¦æ›´å¿«&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å¦‚ä½•å®ç°ç´¢å¼•è¦†ç›–ï¼Ÿ
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-f.jpeg&#34; alt=&#34;&#34;&gt;
èƒ½å¤Ÿå‘½ä¸­nameç´¢å¼•ï¼Œç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†ä¸»é”®idï¼Œé€šè¿‡nameçš„ç´¢å¼•æ ‘å³å¯è·å–idå’Œnameï¼Œæ— éœ€å›è¡¨ï¼Œç¬¦åˆç´¢å¼•è¦†ç›–ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-h.jpeg&#34; alt=&#34;&#34;&gt;
èƒ½å¤Ÿå‘½ä¸­nameç´¢å¼•ï¼Œç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†ä¸»é”®idï¼Œä½†sexå­—æ®µå¿…é¡»å›è¡¨æŸ¥è¯¢æ‰èƒ½è·å–åˆ°ï¼Œä¸ç¬¦åˆç´¢å¼•è¦†ç›–ï¼Œéœ€è¦å†æ¬¡é€šè¿‡idå€¼æ‰«ç èšé›†ç´¢å¼•è·å–sexå­—æ®µï¼Œæ•ˆç‡ä¼šé™ä½ã€‚
å¦‚æœæŠŠ(name)å•åˆ—ç´¢å¼•å‡çº§ä¸º&lt;code&gt;è”åˆç´¢å¼•(name, sex)&lt;/code&gt;å°±ä¸åŒäº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-i.jpeg&#34; alt=&#34;&#34;&gt;
&lt;code&gt;éƒ½èƒ½å¤Ÿå‘½ä¸­ç´¢å¼•è¦†ç›–ï¼Œæ— éœ€å›è¡¨&lt;/code&gt;ã€‚
3.  å“ªäº›åœºæ™¯å¯ä»¥åˆ©ç”¨ç´¢å¼•è¦†ç›–æ¥ä¼˜åŒ–SQLï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…¨è¡¨countæŸ¥è¯¢ä¼˜åŒ– &lt;img src=&#34;https://abnerxc.github.io/img/mysql-j.jpeg&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;åˆ—æŸ¥è¯¢å›è¡¨ä¼˜åŒ–(åŒä¸Šé¢çš„ä¾‹å­)&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;éå¸¸éšè”½çš„å…¨è¡¨æ‰«æä¸èƒ½å‘½ä¸­ç´¢å¼•&#34;&gt;éå¸¸éšè”½çš„å…¨è¡¨æ‰«æï¼Œä¸èƒ½å‘½ä¸­ç´¢å¼• &lt;a href=&#34;#%e9%9d%9e%e5%b8%b8%e9%9a%90%e8%94%bd%e7%9a%84%e5%85%a8%e8%a1%a8%e6%89%ab%e6%8f%8f%e4%b8%8d%e8%83%bd%e5%91%bd%e4%b8%ad%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;code&gt;åˆ—ç±»å‹&lt;/code&gt;ä¸&lt;code&gt;where å€¼ç±»å‹ä¸ç¬¦åˆ&lt;/code&gt;ä¸èƒ½å‘½ä¸­ç´¢å¼•ï¼Œä¼šå¯¼è‡´å…¨è¡¨æ‰«æ&lt;/li&gt;
&lt;li&gt;ç›¸&lt;code&gt;join&lt;/code&gt;çš„ä¸¤ä¸ªè¡¨çš„å­—ç¬¦ç¼–ç ä¸åŒï¼Œä¸èƒ½å‘½ä¸­ç´¢å¼•ï¼Œä¼šå¯¼è‡´è¿ªå¡å°”ç§¯çš„è¿ç®—&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ•°æ®åº“ä¸»é”®ç´¢å¼•ä¸å®œå¤ªé•¿ç‰¹æŒ‡innodb&#34;&gt;æ•°æ®åº“ä¸»é”®ç´¢å¼•ä¸å®œå¤ªé•¿ï¼Ÿï¼Ÿï¼ˆç‰¹æŒ‡InnoDBï¼‰ &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%ba%93%e4%b8%bb%e9%94%ae%e7%b4%a2%e5%bc%95%e4%b8%8d%e5%ae%9c%e5%a4%aa%e9%95%bf%e7%89%b9%e6%8c%87innodb&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;MyISAMå¼•æ“ï¼Œæ— å½±å“ã€‚åŸå› ï¼šè¿›è¡Œæ£€ç´¢æ—¶ï¼Œä¼šå…ˆä»ç´¢å¼•æ ‘å®šä½åˆ°è®°å½•æŒ‡é’ˆï¼Œå†é€šè¿‡æŒ‡é’ˆå®šä½åˆ°å…·ä½“çš„è®°å½•&lt;/li&gt;
&lt;li&gt;InnoDBé€šè¿‡ä¸»é”®ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œèƒ½å¤Ÿç›´æ¥å®šä½åˆ°è¡Œè®°å½•ã€‚ åŸå› ï¼šèº«ä»½è¯å·id_codeæ˜¯ä¸€ä¸ªæ¯”è¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªç´¢å¼•éƒ½å­˜å‚¨è¿™ä¸ªå€¼ï¼Œåœ¨æ•°æ®é‡å¤§ï¼Œå†…å­˜çè´µçš„æƒ…å†µä¸‹ï¼ŒMySQLæœ‰é™çš„ç¼“å†²åŒºï¼Œå­˜å‚¨çš„ç´¢å¼•ä¸æ•°æ®ä¼šå‡å°‘ï¼Œç£ç›˜IOçš„æ¦‚ç‡ä¼šå¢åŠ ã€‚åŒæ—¶ï¼Œç´¢å¼•å ç”¨çš„ç£ç›˜ç©ºé—´ä¹Ÿä¼šå¢åŠ ã€‚&lt;/li&gt;
&lt;li&gt;æ€»ç»“
ï¼ˆ1ï¼‰MyISAMçš„ç´¢å¼•ä¸æ•°æ®åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•å¶å­å­˜å‚¨æŒ‡é’ˆï¼Œä¸»é”®ç´¢å¼•ä¸æ™®é€šç´¢å¼•æ— å¤ªå¤§åŒºåˆ«ï¼›
ï¼ˆ2ï¼‰InnoDBçš„èšé›†ç´¢å¼•å’Œæ•°æ®è¡Œç»Ÿä¸€å­˜å‚¨ï¼Œèšé›†ç´¢å¼•å­˜å‚¨æ•°æ®è¡Œæœ¬èº«ï¼Œæ™®é€šç´¢å¼•å­˜å‚¨ä¸»é”®ï¼›
ï¼ˆ3ï¼‰InnoDBä¸å»ºè®®ä½¿ç”¨å¤ªé•¿å­—æ®µä½œä¸ºPKï¼ˆæ­¤æ—¶å¯ä»¥åŠ å…¥ä¸€ä¸ªè‡ªå¢é”®PKï¼‰ï¼ŒMyISAMåˆ™æ— æ‰€è°“ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;likeæŸ¥è¯¢ä¸€å®šä¸å‘½ä¸­ç´¢å¼•å—&#34;&gt;likeæŸ¥è¯¢ä¸€å®šä¸å‘½ä¸­ç´¢å¼•å—ï¼Ÿ &lt;a href=&#34;#like%e6%9f%a5%e8%af%a2%e4%b8%80%e5%ae%9a%e4%b8%8d%e5%91%bd%e4%b8%ad%e7%b4%a2%e5%bc%95%e5%90%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;mysqlåœ¨ä½¿ç”¨likeæŸ¥è¯¢ï¼Œ%åœ¨æœ€å‰é¢ä¸ä¼šç”¨åˆ°ç´¢å¼•ï¼Œä¸­é—´æˆ–æœ€åæ˜¯ä¼šç”¨åˆ°ç´¢å¼•çš„ï¼Œåªæ˜¯è¶Šé å‰æ‰«æçš„è¡Œæ•°è¶Šå¤š
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-k.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç´¢å¼•ä¸‹æ¨&#34;&gt;ç´¢å¼•ä¸‹æ¨ &lt;a href=&#34;#%e7%b4%a2%e5%bc%95%e4%b8%8b%e6%8e%a8&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;ä¾‹å¦‚å¯¹äºuser_tableè¡¨ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ï¼ˆusername,ageï¼‰è”åˆç´¢å¼•ï¼Œå¦‚æœç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼ŒæŸ¥å‡ºåç§°ä¸­ä»¥â€œå¼ â€å¼€å¤´ä¸”å¹´é¾„å°äºç­‰äº10çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¯­å¥å¦‚ä¸‹ï¼š&amp;ldquo;select * from user_table where username like &amp;lsquo;å¼ %&amp;rsquo; and age &amp;gt; 10&amp;rdquo;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ç´¢å¼•ä¸‹æ¨ï¼šlike â€˜zhang%â€™and age &amp;gt;10 æ£€ç´¢ï¼ŒMySQL5.6ç‰ˆæœ¬ä¹‹å‰ï¼Œä¼šå¯¹åŒ¹é…çš„æ•°æ®è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚5.6ç‰ˆæœ¬åï¼Œä¼šå…ˆè¿‡æ»¤æ‰age&amp;lt;10çš„æ•°æ®ï¼Œå†è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œå‡å°‘å›è¡¨ç‡ï¼Œæå‡æ£€ç´¢é€Ÿåº¦&lt;/li&gt;
&lt;li&gt;æ³¨æ„ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;innodbå¼•æ“çš„è¡¨ï¼Œç´¢å¼•ä¸‹æ¨åªèƒ½ç”¨äºäºŒçº§ç´¢å¼•ã€‚ åŸå› ï¼šinnodbçš„ä¸»é”®ç´¢å¼•æ ‘å¶å­ç»“ç‚¹ä¸Šä¿å­˜çš„æ˜¯å…¨è¡Œæ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ç´¢å¼•ä¸‹æ¨å¹¶ä¸ä¼šèµ·åˆ°å‡å°‘æŸ¥è¯¢å…¨è¡Œæ•°æ®çš„æ•ˆæœã€‚&lt;/li&gt;
&lt;li&gt;ç´¢å¼•ä¸‹æ¨ä¸€èˆ¬å¯ç”¨äºæ‰€æ±‚æŸ¥è¯¢å­—æ®µï¼ˆselectåˆ—ï¼‰ä¸æ˜¯/ä¸å…¨æ˜¯è”åˆç´¢å¼•çš„å­—æ®µï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸ºå¤šæ¡ä»¶æŸ¥è¯¢ä¸”æŸ¥è¯¢æ¡ä»¶å­å¥ï¼ˆwhere/order byï¼‰å­—æ®µå…¨æ˜¯è”åˆç´¢å¼•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;å‡è®¾è¡¨tæœ‰è”åˆç´¢å¼•ï¼ˆa,bï¼‰,ä¸‹é¢è¯­å¥å¯ä»¥ä½¿ç”¨ç´¢å¼•ä¸‹æ¨æé«˜æ•ˆç‡&lt;code&gt;select * from t where a &amp;gt; 2 and b &amp;gt; 10&lt;/code&gt;;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;æ—¥å¿—&#34;&gt;æ—¥å¿— &lt;a href=&#34;#%e6%97%a5%e5%bf%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;mysqlå¤šå°‘ç§æ—¥å¿—&#34;&gt;MySQLå¤šå°‘ç§æ—¥å¿— &lt;a href=&#34;#mysql%e5%a4%9a%e5%b0%91%e7%a7%8d%e6%97%a5%e5%bf%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;é”™è¯¯æ—¥å¿—ï¼šè®°å½•mysqlå¯åŠ¨å’Œè¿è¡Œçš„å‡ºé”™ä¿¡æ¯ï¼Œä¹Ÿè®°å½•ä¸€äº›è­¦å‘Šä¿¡æ¯æˆ–è€…æ­£ç¡®çš„ä¿¡æ¯ï¼Œåœ¨my.cnfä¸­log_erroræŒ‡å®šè·¯å¾„ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰å¯¹æ•°æ®åº“è¯·æ±‚çš„ä¿¡æ¯ï¼Œä¸è®ºè¿™äº›è¯·æ±‚æ˜¯å¦å¾—åˆ°äº†æ­£ç¡®çš„æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šè®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼ˆlog_query_timeï¼‰ï¼Œå°†è¿è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼çš„æ‰€æœ‰SQLè¯­å¥éƒ½è®°å½•åˆ°æ…¢æŸ¥è¯¢çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;äºŒè¿›åˆ¶æ—¥å¿—ï¼šåˆå«åšbin-logæ—¥å¿—ï¼Œçºªå½•æ‰€æœ‰çš„å†™æ“ä½œ(å¢æ”¹åˆ )ï¼Œçºªå½•ä¸€äº›æ‰§è¡Œæ—¶é—´ï¼Œæ‰§è¡Œæ—¶é•¿ï¼Œæ•°æ®å˜æ›´ç­‰ã€‚ä¸»è¦ç”¨äº&lt;code&gt;æ¢å¤ã€å¤åˆ¶ã€å®¡è®¡&lt;/code&gt;ï¼Œç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼mysql-bin.001..ç­‰ä¸€ç³»åˆ—åºå·ã€‚&lt;/li&gt;
&lt;li&gt;ä¸­ç»§æ—¥å¿—ï¼šç†è§£ä¸Šrelay logå¾ˆå¤šæ–¹é¢éƒ½è·Ÿbinary logå·®ä¸å¤šã€‚åŒºåˆ«æ˜¯ï¼šä»æœåŠ¡å™¨I/Oçº¿ç¨‹å°†ä¸»æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—è¯»å–è¿‡æ¥è®°å½•åˆ°ä»æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ï¼Œç„¶åSQLçº¿ç¨‹ä¼šè¯»å–relay-logæ—¥å¿—çš„å†…å®¹å¹¶åº”ç”¨åˆ°ä»æœåŠ¡å™¨ï¼Œä»è€Œä½¿ä»æœåŠ¡å™¨å’Œä¸»æœåŠ¡å™¨çš„æ•°æ®ä¿æŒä¸€è‡´&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æ—¥å¿—ï¼š äº‹åŠ¡æ—¥å¿—æ–‡ä»¶åä¸º&lt;code&gt;ib_logfile0&lt;/code&gt;å’Œ&lt;code&gt;ib_logfile1&lt;/code&gt;ï¼Œé»˜è®¤å­˜æ”¾åœ¨è¡¨ç©ºé—´æ‰€åœ¨ç›®å½•&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;mysql-binlogçš„å‡ ç§æ—¥å¿—å½•å…¥æ ¼å¼ä»¥åŠåŒºåˆ«&#34;&gt;MySQL binlogçš„å‡ ç§æ—¥å¿—å½•å…¥æ ¼å¼ä»¥åŠåŒºåˆ« &lt;a href=&#34;#mysql-binlog%e7%9a%84%e5%87%a0%e7%a7%8d%e6%97%a5%e5%bf%97%e5%bd%95%e5%85%a5%e6%a0%bc%e5%bc%8f%e4%bb%a5%e5%8f%8a%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;æ ¼å¼ï¼š&lt;code&gt;Statement&lt;/code&gt;,&lt;code&gt;Row&lt;/code&gt;ï¼Œ&lt;code&gt;Mixedlevel&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åŒºåˆ«:&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;åŸºäºè¯­å¥çºªå½•ï¼ˆStatement ï¼‰:æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqléƒ½ä¼šè®°å½•åœ¨binlogä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼šåªéœ€è¦è®°å½•æ‰§è¡Œè¯­å¥çš„ç»†èŠ‚å’Œä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œé¿å…äº†è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œåœ¨ä¸€äº›ä¿®æ”¹è®°å½•è¾ƒå¤šçš„æƒ…å†µä¸‹ç›¸æ¯”ROW levelèƒ½å¤§å¤§å‡å°‘binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦IOï¼Œæé«˜æ€§èƒ½ï¼›è¿˜å¯ä»¥ç”¨äºå®æ—¶çš„è¿˜åŸï¼›&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šä¸ºäº†ä¿è¯sqlè¯­å¥èƒ½åœ¨slaveä¸Šæ­£ç¡®æ‰§è¡Œï¼Œå¿…é¡»è®°å½•ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»¥ä¿è¯æ‰€æœ‰è¯­å¥èƒ½åœ¨slaveå¾—åˆ°å’Œåœ¨masterç«¯æ‰§è¡Œæ—¶å€™ç›¸åŒçš„ç»“æœï¼›å¦å¤–ï¼Œä¸»ä»å¤åˆ¶æ—¶ï¼Œå­˜åœ¨éƒ¨åˆ†å‡½æ•°ï¼ˆå¦‚sleepï¼‰åŠå­˜å‚¨è¿‡ç¨‹åœ¨slaveä¸Šä¼šå‡ºç°ä¸masterç»“æœä¸ä¸€è‡´çš„æƒ…å†µï¼Œè€Œç›¸æ¯”Row levelè®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ç»†èŠ‚ï¼Œç»ä¸ä¼šå‘ç”Ÿè¿™ç§ä¸ä¸€è‡´çš„æƒ…å†µ.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åŸºäºè¡Œï¼ˆRowï¼‰ï¼šä»…ä¿å­˜è®°å½•è¢«ä¿®æ”¹ç»†èŠ‚ï¼Œä¸è®°å½•sqlè¯­å¥ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼š èƒ½éå¸¸æ¸…æ™°çš„è®°å½•ä¸‹æ¯è¡Œæ•°æ®çš„ä¿®æ”¹ç»†èŠ‚ï¼Œä¸éœ€è¦è®°å½•ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ï¼Œå› æ­¤ä¸ä¼šå‘ç”ŸæŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„procedureã€functionã€åŠtriggerçš„è°ƒç”¨è§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ï¼Œä»»ä½•æƒ…å†µéƒ½å¯ä»¥è¢«å¤åˆ¶ï¼Œä¸”èƒ½åŠ å¿«ä»åº“é‡æ”¾æ—¥å¿—çš„æ•ˆç‡ï¼Œä¿è¯ä»åº“æ•°æ®çš„ä¸€è‡´æ€§&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹:ç”±äºæ‰€æœ‰çš„æ‰§è¡Œçš„è¯­å¥åœ¨æ—¥å¿—ä¸­éƒ½å°†ä»¥æ¯è¡Œè®°å½•çš„ä¿®æ”¹ç»†èŠ‚æ¥è®°å½•ï¼Œå› æ­¤ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—å†…å®¹ï¼Œå¹²æ‰°å†…å®¹ä¹Ÿè¾ƒå¤šï¼›æ¯”å¦‚ä¸€æ¡updateè¯­å¥ï¼Œå¦‚ä¿®æ”¹å¤šæ¡è®°å½•ï¼Œåˆ™binlogä¸­æ¯ä¸€æ¡ä¿®æ”¹éƒ½ä¼šæœ‰è®°å½•ï¼Œè¿™æ ·é€ æˆbinlogæ—¥å¿—é‡ä¼šå¾ˆå¤§ï¼Œç‰¹åˆ«æ˜¯å½“æ‰§è¡Œalter tableä¹‹ç±»çš„è¯­å¥çš„æ—¶å€™ï¼Œç”±äºè¡¨ç»“æ„ä¿®æ”¹ï¼Œæ¯æ¡è®°å½•éƒ½å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆè¯¥è¡¨æ¯ä¸€æ¡è®°å½•éƒ½ä¼šè®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œå®é™…ç­‰äºé‡å»ºäº†è¡¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;æ··åˆæ¨¡å¼ï¼ˆMixedlevelï¼‰ï¼šæ˜¯ä»¥ä¸Šä¸¤ç§levelçš„æ··åˆä½¿ç”¨
ä¸€èˆ¬çš„è¯­å¥ä¿®æ”¹ä½¿ç”¨statmentæ ¼å¼ä¿å­˜binlogï¼Œå¦‚ä¸€äº›å‡½æ•°ï¼Œstatementæ— æ³•å®Œæˆä¸»ä»å¤åˆ¶çš„æ“ä½œï¼Œåˆ™ é‡‡ç”¨rowæ ¼å¼ä¿å­˜binlog,MySQLä¼šæ ¹æ®æ‰§è¡Œçš„æ¯ä¸€æ¡å…·ä½“çš„sqlè¯­å¥æ¥åŒºåˆ†å¯¹å¾…è®°å½•çš„æ—¥å¿—å½¢å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨Statementå’ŒRowä¹‹é—´é€‰æ‹© ä¸€ç§.æ–°ç‰ˆæœ¬çš„MySQLä¸­é˜Ÿrow levelæ¨¡å¼ä¹Ÿè¢«åšäº†ä¼˜åŒ–ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¿®æ”¹éƒ½ä¼šä»¥row levelæ¥è®°å½•ï¼Œåƒé‡åˆ°è¡¨ç»“æ„å˜æ›´çš„æ—¶å€™å°±ä¼šä»¥statementæ¨¡å¼æ¥è®°å½•ã€‚è‡³äºupdateæˆ–è€…deleteç­‰ä¿®æ”¹æ•°æ®çš„è¯­å¥ï¼Œè¿˜æ˜¯ä¼šè®°å½•æ‰€æœ‰è¡Œçš„ å˜æ›´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;...............................................................................
# at 552
#131128 17:50:46 server id 1  end_log_pos 665   Query   thread_id=11    exec_time=0     error_code=0 +++-&amp;gt;æ‰§è¡Œæ—¶é—´:17:50:46ï¼›posç‚¹:665
SET TIMESTAMP=1385632246/*!*/;
update zyyshop.stu set name=&amp;#39;æå››&amp;#39; where id=4              +++-&amp;gt;æ‰§è¡Œçš„SQL
/*!*/;
# at 665
#131128 17:50:46 server id 1  end_log_pos 692   Xid = 1454 +++-&amp;gt;æ‰§è¡Œæ—¶é—´:17:50:46ï¼›posç‚¹:692 
...............................................................................
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;äº‹ç‰©&#34;&gt;äº‹ç‰© &lt;a href=&#34;#%e4%ba%8b%e7%89%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;æ•°æ®åº“äº‹åŠ¡ç‰¹æ€§acid&#34;&gt;æ•°æ®åº“äº‹åŠ¡ç‰¹æ€§(ACID) &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%ba%93%e4%ba%8b%e5%8a%a1%e7%89%b9%e6%80%a7acid&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;åŸå­æ€§ï¼šå³æ­¥éª¤è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥&lt;/li&gt;
&lt;li&gt;ä¸€è‡´æ€§ï¼šå³æ“ä½œçš„æ€»æ•°æ®é‡çŠ¶æ€ä¿è¯ä¸€è‡´ã€‚ä¾‹å¦‚A-&amp;gt;Bè½¬è´¦æ€»æ•°æœ¨å˜åŒ–æ˜¯100ï¼Œä¸å¤šä¹Ÿä¸å°‘&lt;/li&gt;
&lt;li&gt;éš”ç¦»æ€§ï¼šå³æ¯ä¸ªäº‹ç‰©çš„æ“ä½œï¼Œä¸å½±å“å…¶ä»–çš„äº‹ç‰©&lt;/li&gt;
&lt;li&gt;æŒä¹…æ€§ï¼šå³ä¸€æ—¦æäº¤ç»“æœæ°¸ä¹…ä¿å­˜&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;äº‹ç‰©æ˜¯å¦‚ä½•é€šè¿‡æ—¥å¿—å®ç°çš„&#34;&gt;äº‹ç‰©æ˜¯å¦‚ä½•é€šè¿‡æ—¥å¿—å®ç°çš„ &lt;a href=&#34;#%e4%ba%8b%e7%89%a9%e6%98%af%e5%a6%82%e4%bd%95%e9%80%9a%e8%bf%87%e6%97%a5%e5%bf%97%e5%ae%9e%e7%8e%b0%e7%9a%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-l.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;redo_log å®ç°æŒä¹…åŒ–å’ŒåŸå­æ€§ï¼Œè€Œundo_logå®ç°ä¸€è‡´æ€§ï¼ŒäºŒç§æ—¥å¿—å‡å¯ä»¥è§†ä¸ºä¸€ç§æ¢å¤æ“ä½œï¼Œredo_logæ˜¯æ¢å¤æäº¤äº‹åŠ¡ä¿®æ”¹çš„é¡µæ“ä½œï¼Œè€Œundo_logæ˜¯å›æ»šè¡Œè®°å½•åˆ°ç‰¹å®šç‰ˆæœ¬ã€‚äºŒè€…è®°å½•çš„å†…å®¹ä¹Ÿä¸åŒï¼Œredo_logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•é¡µçš„ç‰©ç†ä¿®æ”¹æ“ä½œï¼Œè€Œundo_logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œæ ¹æ®æ¯è¡Œè®°å½•è¿›è¡Œè®°å½•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;äº‹åŠ¡æ—¥å¿—æ˜¯é€šè¿‡redo(é‡åšæ—¥å¿—)å’Œinnodbçš„å­˜å‚¨å¼•æ“æ—¥å¿—ç¼“å†²ï¼ˆInnodb log bufferï¼‰æ¥å®ç°çš„ï¼Œ&lt;/li&gt;
&lt;li&gt;å½“å¼€å§‹ä¸€ä¸ªäº‹åŠ¡çš„æ—¶å€™ï¼Œä¼šè®°å½•è¯¥äº‹åŠ¡çš„lsn(log sequence number)å·;&lt;/li&gt;
&lt;li&gt;å½“äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œä¼šå¾€InnoDBå­˜å‚¨å¼•æ“çš„æ—¥å¿—çš„æ—¥å¿—ç¼“å­˜é‡Œé¢æ’å…¥äº‹åŠ¡æ—¥å¿—ï¼›&lt;/li&gt;
&lt;li&gt;å½“äº‹åŠ¡æäº¤æ—¶ï¼Œå¿…é¡»å°†å­˜å‚¨å¼•æ“çš„æ—¥å¿—ç¼“å†²å†™å…¥ç£ç›˜ï¼ˆé€šè¿‡innodb_flush_log_at_trx_commitæ¥æ§åˆ¶ï¼‰ï¼Œä¹Ÿå°±æ˜¯å†™æ•°æ®å‰ï¼Œéœ€è¦å…ˆå†™æ—¥å¿—ã€‚è¿™ç§æ–¹å¼ç§°ä¸ºâ€œé¢„å†™æ—¥å¿—æ–¹å¼â€&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;äº‹åŠ¡å¹²æ‰°ä¾‹å­&#34;&gt;äº‹åŠ¡å¹²æ‰°ä¾‹å­ &lt;a href=&#34;#%e4%ba%8b%e5%8a%a1%e5%b9%b2%e6%89%b0%e4%be%8b%e5%ad%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;è¯»è„&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- äº‹åŠ¡Aï¼Œå…ˆæ‰§è¡Œï¼Œå¤„äºæœªæäº¤çš„çŠ¶æ€ï¼šinsert into t values(4, wangwu);
- äº‹åŠ¡Bï¼Œåæ‰§è¡Œï¼Œä¹Ÿæœªæäº¤ï¼šselect * from t;
å¦‚æœäº‹åŠ¡Bèƒ½å¤Ÿè¯»å–åˆ°(4, wangwu)è¿™æ¡è®°å½•ï¼Œäº‹åŠ¡Aå°±å¯¹äº‹åŠ¡Bäº§ç”Ÿäº†å½±å“ï¼Œ
è¿™ä¸ªå½±å“å«åšâ€œè¯»è„â€ï¼Œè¯»åˆ°äº†æœªæäº¤äº‹åŠ¡æ“ä½œçš„è®°å½•ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;ä¸å¯é‡å¤è¯»&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- äº‹åŠ¡Aï¼Œå…ˆæ‰§è¡Œï¼šselect * from t where id=1;ç»“æœé›†ä¸ºï¼š1, zhangsan
- äº‹åŠ¡Bï¼Œåæ‰§è¡Œï¼Œå¹¶ä¸”æäº¤ï¼šupdate t set name=xxoo where id=1;commit;
- äº‹åŠ¡Aï¼Œå†æ¬¡æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢ï¼šselect * from t where id=1;ç»“æœé›†ä¸ºï¼š1, xxoo
è¿™æ¬¡æ˜¯å·²æäº¤äº‹åŠ¡Bå¯¹äº‹åŠ¡Aäº§ç”Ÿçš„å½±å“ï¼Œ
è¿™ä¸ªå½±å“å«åšâ€œä¸å¯é‡å¤è¯»â€ï¼Œä¸€ä¸ªäº‹åŠ¡å†…ç›¸åŒçš„æŸ¥è¯¢ï¼Œå¾—åˆ°äº†ä¸åŒçš„ç»“æœã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å¹»è¯»&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- äº‹åŠ¡Aï¼Œå…ˆæ‰§è¡Œï¼šselect * from t where id&amp;gt;3; ç»“æœä¸ºnull
- äº‹åŠ¡Bï¼Œåæ‰§è¡Œï¼Œå¹¶ä¸”æäº¤ï¼šinsert into t values(4, wangwu);commit;
- äº‹åŠ¡Aï¼Œé¦–æ¬¡æŸ¥è¯¢äº†id&amp;gt;3çš„ç»“æœä¸ºNULLï¼Œäºæ˜¯æƒ³æ’å…¥ä¸€æ¡ä¸º4çš„è®°å½•ï¼šinsert into t values(4, xxoo);ç»“æœé›†ä¸ºï¼šError : duplicate key!
è¿™æ¬¡æ˜¯å·²æäº¤äº‹åŠ¡Bå¯¹äº‹åŠ¡Aäº§ç”Ÿçš„å½±å“ï¼Œè¿™ä¸ªå½±å“å«åšâ€œå¹»è¯»â€ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;æ•°æ®åº“çš„éš”ç¦»çº§åˆ«&#34;&gt;æ•°æ®åº“çš„éš”ç¦»çº§åˆ« &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e9%9a%94%e7%a6%bb%e7%ba%a7%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;æœªæäº¤è¯»(Read Uncommitted)ï¼ˆSé”ï¼‰: æ­¤æ—¶ï¼Œå¯èƒ½è¯»å–åˆ°ä¸ä¸€è‡´çš„æ•°æ®ï¼Œå³â€œè¯»è„â€ã€‚è¿™æ˜¯å¹¶å‘æœ€é«˜ï¼Œä¸€è‡´æ€§æœ€å·®çš„éš”ç¦»çº§åˆ«ã€‚é«˜å¹¶å‘é‡çš„åœºæ™¯ä¸‹ï¼Œå‡ ä¹ä¸ä¼šä½¿ç”¨&lt;/li&gt;
&lt;li&gt;ä¸²è¡ŒåŒ–(Serializable)ï¼ˆXé”ï¼‰: è¿™ç§äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ‰€æœ‰selectè¯­å¥éƒ½ä¼šè¢«éšå¼çš„è½¬åŒ–ä¸ºselect &amp;hellip; in share mode.è¿™å¯èƒ½å¯¼è‡´ï¼Œå¦‚æœæœ‰æœªæäº¤çš„äº‹åŠ¡æ­£åœ¨ä¿®æ”¹æŸäº›è¡Œï¼Œæ‰€æœ‰è¯»å–è¿™äº›è¡Œçš„selectéƒ½ä¼šè¢«é˜»å¡ä½ã€‚è¿™æ˜¯ä¸€è‡´æ€§æœ€å¥½çš„ï¼Œä½†å¹¶å‘æ€§æœ€å·®çš„éš”ç¦»çº§åˆ«ã€‚å¯ä»¥è§£å†³ è„è¯» ä¸å¯é‡å¤è¯» å’Œ è™šè¯»+++ç›¸å½“äºé”è¡¨,æ‰€ä»¥é«˜å¹¶å‘é‡çš„åœºæ™¯ä¸‹ï¼Œå‡ ä¹ä¸ä¼šä½¿ç”¨&lt;/li&gt;
&lt;li&gt;å¯é‡å¤è¯»(Repeated Read, RR)ï¼ˆXé”ï¼‰ï¼Œè¿™æ˜¯InnoDBé»˜è®¤çš„éš”ç¦»çº§åˆ«
(1) &lt;code&gt;æ™®é€šçš„select&lt;/code&gt;ä½¿ç”¨å¿«ç…§è¯»(snapshot read)ï¼Œè¿™æ˜¯ä¸€ç§ä¸åŠ é”çš„ä¸€è‡´æ€§è¯»(Consistent Nonlocking Read)ï¼Œåº•å±‚ä½¿ç”¨MVCCæ¥å®ç°
(2) &lt;code&gt;åŠ é”çš„select&lt;/code&gt;(select &amp;hellip; in share mode / select &amp;hellip; for update), update, deleteç­‰è¯­å¥ï¼Œå®ƒä»¬çš„é”ï¼Œä¾èµ–äºå®ƒä»¬æ˜¯å¦åœ¨å”¯ä¸€ç´¢å¼•(unique index)ä¸Šä½¿ç”¨äº†å”¯ä¸€çš„æŸ¥è¯¢æ¡ä»¶(unique search condition)ï¼Œæˆ–è€…èŒƒå›´æŸ¥è¯¢æ¡ä»¶(range-type search condition)ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨å”¯ä¸€ç´¢å¼•ä¸Šä½¿ç”¨å”¯ä¸€çš„æŸ¥è¯¢æ¡ä»¶ï¼Œä¼šä½¿ç”¨è®°å½•é”(record lock)ï¼Œè€Œä¸ä¼šå°é”è®°å½•ä¹‹é—´çš„é—´éš”ï¼Œå³ä¸ä¼šä½¿ç”¨é—´éš™é”(gap lock)ä¸ä¸´é”®é”(next-key lock)&lt;/li&gt;
&lt;li&gt;èŒƒå›´æŸ¥è¯¢æ¡ä»¶ï¼Œä¼šä½¿ç”¨é—´éš™é”ä¸ä¸´é”®é”ï¼Œé”ä½ç´¢å¼•è®°å½•ä¹‹é—´çš„èŒƒå›´ï¼Œé¿å…èŒƒå›´é—´æ’å…¥è®°å½•ï¼Œä»¥é¿å…äº§ç”Ÿå¹»å½±è¡Œè®°å½•ï¼Œä»¥åŠé¿å…ä¸å¯é‡å¤çš„è¯»&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¯»å·²æäº¤(Read Committed, RC): è¿™æ˜¯äº’è”ç½‘æœ€å¸¸ç”¨çš„éš”ç¦»çº§åˆ«
&lt;ul&gt;
&lt;li&gt;æ™®é€šè¯»æ˜¯å¿«ç…§è¯»ï¼›&lt;/li&gt;
&lt;li&gt;åŠ é”çš„select, update, deleteç­‰è¯­å¥ï¼Œé™¤äº†åœ¨å¤–é”®çº¦æŸæ£€æŸ¥(foreign-key constraint checking)ä»¥åŠé‡å¤é”®æ£€æŸ¥(duplicate-key checking)æ—¶ä¼šå°é”åŒºé—´ï¼Œå…¶ä»–æ—¶åˆ»éƒ½åªä½¿ç”¨è®°å½•é”ï¼›&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶ï¼Œå…¶ä»–äº‹åŠ¡çš„æ’å…¥ä¾ç„¶å¯ä»¥æ‰§è¡Œï¼Œå°±å¯èƒ½å¯¼è‡´ï¼Œè¯»å–åˆ°å¹»å½±è®°å½•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;mvccè§£é‡Š&#34;&gt;MVCCè§£é‡Š &lt;a href=&#34;#mvcc%e8%a7%a3%e9%87%8a&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;MVCC (Multiversion Concurrency Control)ï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æŠ€æœ¯,å®ƒä½¿å¾—å¤§éƒ¨åˆ†æ”¯æŒè¡Œé”çš„äº‹åŠ¡å¼•æ“ï¼Œä¸å†å•çº¯çš„ä½¿ç”¨è¡Œé”æ¥è¿›è¡Œæ•°æ®åº“çš„å¹¶å‘æ§åˆ¶ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æŠŠæ•°æ®åº“çš„è¡Œé”ä¸è¡Œçš„å¤šä¸ªç‰ˆæœ¬ç»“åˆèµ·æ¥ï¼Œåªéœ€è¦å¾ˆå°çš„å¼€é”€,å°±å¯ä»¥å®ç°éé”å®šè¯»ï¼Œä»è€Œå¤§å¤§æé«˜æ•°æ®åº“ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½&lt;/li&gt;
&lt;li&gt;æ ¸å¿ƒåŸç†
(1) å†™ä»»åŠ¡å‘ç”Ÿæ—¶ï¼Œå°†æ•°æ®å…‹éš†ä¸€ä»½ï¼Œä»¥ç‰ˆæœ¬å·åŒºåˆ†ï¼›
(2) å†™ä»»åŠ¡æ“ä½œæ–°å…‹éš†çš„æ•°æ®ï¼Œç›´è‡³æäº¤ï¼›
(3) å¹¶å‘è¯»ä»»åŠ¡å¯ä»¥ç»§ç»­è¯»å–æ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œä¸è‡³äºé˜»å¡ï¼›
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-m.jpeg&#34; alt=&#34;&#34;&gt;
å¦‚ä¸Šå›¾ï¼š&lt;/li&gt;
&lt;li&gt;æœ€å¼€å§‹æ•°æ®çš„ç‰ˆæœ¬æ˜¯V0ï¼›&lt;/li&gt;
&lt;li&gt;T1æ—¶åˆ»å‘èµ·äº†ä¸€ä¸ªå†™ä»»åŠ¡ï¼Œè¿™æ˜¯æŠŠæ•°æ®cloneäº†ä¸€ä»½ï¼Œè¿›è¡Œä¿®æ”¹ï¼Œç‰ˆæœ¬å˜ä¸ºV1ï¼Œä½†ä»»åŠ¡è¿˜æœªå®Œæˆï¼›&lt;/li&gt;
&lt;li&gt;T2æ—¶åˆ»å¹¶å‘äº†ä¸€ä¸ªè¯»ä»»åŠ¡ï¼Œä¾ç„¶å¯ä»¥è¯»V0ç‰ˆæœ¬çš„æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;T3æ—¶åˆ»åˆå¹¶å‘äº†ä¸€ä¸ªè¯»ä»»åŠ¡ï¼Œä¾ç„¶ä¸ä¼šé˜»å¡ï¼›
å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®å¤šç‰ˆæœ¬ï¼Œé€šè¿‡â€œè¯»å–æ—§ç‰ˆæœ¬æ•°æ®â€èƒ½å¤Ÿæå¤§æé«˜ä»»åŠ¡çš„å¹¶å‘åº¦ã€‚
æé«˜å¹¶å‘çš„æ¼”è¿›æ€è·¯ï¼Œå°±åœ¨å¦‚æ­¤ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ™®é€šé”ï¼Œæœ¬è´¨æ˜¯ä¸²è¡Œæ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;è¯»å†™é”ï¼Œå¯ä»¥å®ç°è¯»è¯»å¹¶å‘&lt;/li&gt;
&lt;li&gt;æ•°æ®å¤šç‰ˆæœ¬ï¼Œå¯ä»¥å®ç°è¯»å†™å¹¶å‘&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é”&#34;&gt;é” &lt;a href=&#34;#%e9%94%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-n.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;é”æœºåˆ¶&#34;&gt;é”æœºåˆ¶ &lt;a href=&#34;#%e9%94%81%e6%9c%ba%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;æ‚²è§‚é”ï¼šåˆ©ç”¨äº†æ•°æ®åº“å†…éƒ¨æä¾›çš„é”æœºåˆ¶ï¼›åœ¨å¹¶å‘è¿‡ç¨‹ä¸­ä¸€æ—¦æœ‰ä¸€ä¸ªäº‹åŠ¡æŒæœ‰äº†æ•°æ®åº“è®°å½•çš„é”ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¸èƒ½å†å¯¹æ•°æ®åº“è¿›è¡Œæ›´æ–°&lt;/li&gt;
&lt;li&gt;ä¹è§‚é”ï¼šä¹è§‚é”æ˜¯ä¸€ç§ä¸ä¼šé˜»å¡å…¶å®ƒçº¿ç¨‹å¹¶å‘çš„æœºåˆ¶ï¼Œå®ƒä¸ä¼šä½¿ç”¨æ•°æ®åº“çš„é”è¿›è¡Œå®ç°ã€‚æ‰€ä»¥å°±ä¸ä¼šå¼•èµ·çº¿ç¨‹çš„é¢‘ç¹æŒ‚èµ·å’Œæ¢å¤ï¼Œè¿™æ ·æ•ˆç‡å°±æé«˜äº†ã€‚å®ƒçš„å®ç°å…³é”®åœ¨äºCASç®—æ³•æˆ–è€…ç‰ˆæœ¬å·æœºåˆ¶ã€‚
&lt;ul&gt;
&lt;li&gt;ç‰ˆæœ¬å·æœºåˆ¶ï¼š
&lt;ol&gt;
&lt;li&gt;å…ˆè¯»taskè¡¨çš„æ•°æ®ï¼ˆå®é™…ä¸Šè¿™ä¸ªè¡¨åªæœ‰ä¸€æ¡è®°å½•ï¼‰ï¼Œå¾—åˆ°versionçš„å€¼ä¸ºversionValue&lt;/li&gt;
&lt;li&gt;update task set value = newValue,version =  versionValue + 1   where version = versionValue;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;CASç®—æ³•ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;é”ç²’åº¦&#34;&gt;é”ç²’åº¦ &lt;a href=&#34;#%e9%94%81%e7%b2%92%e5%ba%a6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;è¡Œé”è¯¦è§£
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-o.jpeg&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;è¡¨é”è¯¦è§£&lt;/li&gt;
&lt;li&gt;é¡µé”è¯¦è§£&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å½“å‰è¯»ä¸å¿«ç…§è¯»&#34;&gt;å½“å‰è¯»ä¸å¿«ç…§è¯» &lt;a href=&#34;#%e5%bd%93%e5%89%8d%e8%af%bb%e4%b8%8e%e5%bf%ab%e7%85%a7%e8%af%bb&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å½“å‰è¯»
ä½¿ç”¨å½“å‰è¯»çš„æ“ä½œä¸»è¦åŒ…æ‹¬ï¼šæ˜¾å¼åŠ é”çš„è¯»æ“ä½œä¸æ’å…¥/æ›´æ–°/åˆ é™¤ç­‰å†™æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;select * from table where ? lock in share mode;
select * from table where ? for update;
insert into table values (â€¦);
update table set ? where ?;
delete from table where ?;
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å¿«ç…§è¯»
å³ä¸åŠ é”è¯»ï¼Œè¯»å–è®°å½•çš„å¿«ç…§ç‰ˆæœ¬è€Œéæœ€æ–°ç‰ˆæœ¬ï¼Œé€šè¿‡MVCCå®ç°ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é”æ¨¡å¼&#34;&gt;é”æ¨¡å¼ &lt;a href=&#34;#%e9%94%81%e6%a8%a1%e5%bc%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;é”æ¨¡å¼&lt;/th&gt;
          &lt;th&gt;é”å®šå†…å®¹&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Record Lock&lt;/td&gt;
          &lt;td&gt;è®°å½•é”,é”å®šä¸€æ¡çºªå½•&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Gap Lock&lt;/td&gt;
          &lt;td&gt;é—´éš™é”,é”å®šä¸€ä¸ªåŒºé—´&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Next-key Lock&lt;/td&gt;
          &lt;td&gt;è®°å½•+é—´éš™é”,é”å®šä¸€ä¸ªåŒºé—´+è®°å½•è¡Œ&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;ç½‘ç»œ&#34;&gt;ç½‘ç»œ &lt;a href=&#34;#%e7%bd%91%e7%bb%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ä¸»ä»å¤åˆ¶åŸç†&#34;&gt;ä¸»ä»å¤åˆ¶åŸç† &lt;a href=&#34;#%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-p.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;mysqlå¯åŠ¨ä»¥åä¼šå­˜åœ¨2ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯sqlThredè¿›ç¨‹ä¸€ä¸ªIOThredè¿›ç¨‹&lt;/li&gt;
&lt;li&gt;åœ¨Slave æœåŠ¡å™¨ä¸Šæ‰§è¡Œsart slaveå‘½ä»¤å¼€å¯ä¸»ä»å¤åˆ¶å¼€å…³ï¼Œå¼€å§‹è¿›è¡Œä¸»ä»å¤åˆ¶&lt;/li&gt;
&lt;li&gt;SlaveæœåŠ¡å™¨çš„IOçº¿ç¨‹ä¼šé€šè¿‡åœ¨masterä¸Šå·²ç»æˆæƒçš„å¤åˆ¶ç”¨æˆ·æƒé™è¯·æ±‚è¿æ¥masteræœåŠ¡å™¨ï¼Œå¹¶è¯·æ±‚ä»æ‰§è¡Œbinlogæ—¥å¿—æ–‡ä»¶çš„æŒ‡å®šä½ç½®ä¹‹åå¼€å§‹å‘é€binlogæ—¥å¿—å†…å®¹&lt;/li&gt;
&lt;li&gt;MasteræœåŠ¡å™¨æ¥æ”¶åˆ°æ¥è‡ªSlaveæœåŠ¡å™¨çš„IOçº¿ç¨‹çš„è¯·æ±‚åï¼ŒäºŒè¿›åˆ¶è½¬å‚¨IOçº¿ç¨‹ä¼šæ ¹æ®SlaveæœåŠ¡å™¨çš„IOçº¿ç¨‹è¯·æ±‚çš„ä¿¡æ¯åˆ†æ‰¹è¯»å–æŒ‡å®šbinlogæ—¥å¿—æ–‡ä»¶æŒ‡å®šä½ç½®ä¹‹åçš„binlogæ—¥å¿—ä¿¡æ¯ï¼Œç„¶åè¿”å›ç»™Slaveç«¯çš„IOçº¿ç¨‹ã€‚è¿”å›çš„ä¿¡æ¯ä¸­é™¤äº†binlogæ—¥å¿—å†…å®¹å¤–ï¼Œè¿˜æœ‰åœ¨masteræœåŠ¡å™¨ç«¯è®°å½•çš„æ–°çš„binlogæ–‡ä»¶åç§°ï¼Œä»¥åŠåœ¨æ–°çš„binlogä¸­çš„ä¸‹ä¸€ä¸ªæŒ‡å®šæ›´æ–°ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;å½“SlaveæœåŠ¡å™¨çš„IOçº¿ç¨‹è·å–åˆ°MasteræœåŠ¡å™¨ä¸ŠIOçº¿ç¨‹å‘é€çš„æ—¥å¿—å†…å®¹ã€æ—¥å¿—æ–‡ä»¶åŠä½ç½®ç‚¹åï¼Œä¼šå°†binlogæ—¥å¿—å†…å®¹ä¾æ¬¡å†™åˆ°Slaveç«¯è‡ªèº«çš„Relay Logï¼ˆå³ä¸­ç»§æ—¥å¿—ï¼‰æ–‡ä»¶ï¼ˆMySQL-relay-bin.xxxï¼‰çš„æœ€æœ«ç«¯ï¼Œå¹¶å°†æ–°çš„binlogæ–‡ä»¶åå’Œä½ç½®è®°å½•åˆ°master-infoæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡è¯»å–masterç«¯æ–°binlogæ—¥å¿—æ—¶èƒ½å‘Šè¯‰MasteræœåŠ¡å™¨ä»æ–°binlogæ—¥å¿—çš„æŒ‡å®šæ–‡ä»¶åŠä½ç½®å¼€å§‹è¯»å–æ–°çš„binlogæ—¥å¿—å†…å®¹&lt;/li&gt;
&lt;li&gt;SlaveæœåŠ¡å™¨ç«¯çš„SQLçº¿ç¨‹ä¼šå®æ—¶æ£€æµ‹æœ¬åœ°Relay Log ä¸­IOçº¿ç¨‹æ–°å¢çš„æ—¥å¿—å†…å®¹ï¼Œç„¶ååŠæ—¶æŠŠRelay LOG æ–‡ä»¶ä¸­çš„å†…å®¹è§£ææˆsqlè¯­å¥ï¼Œå¹¶åœ¨è‡ªèº«SlaveæœåŠ¡å™¨ä¸ŠæŒ‰è§£æSQLè¯­å¥çš„ä½ç½®é¡ºåºæ‰§è¡Œåº”ç”¨è¿™æ ·sqlè¯­å¥ï¼Œå¹¶åœ¨relay-log.infoä¸­è®°å½•å½“å‰åº”ç”¨ä¸­ç»§æ—¥å¿—çš„æ–‡ä»¶åå’Œä½ç½®ç‚¹&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸»ä»å»¶è¿Ÿçš„é—®é¢˜å’Œè§£å†³åŠæ³•&#34;&gt;ä¸»ä»å»¶è¿Ÿçš„é—®é¢˜å’Œè§£å†³åŠæ³• &lt;a href=&#34;#%e4%b8%bb%e4%bb%8e%e5%bb%b6%e8%bf%9f%e7%9a%84%e9%97%ae%e9%a2%98%e5%92%8c%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ä¸»ä»åŒæ­¥çš„å»¶è¿Ÿçš„åŸå› ï¼šæˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªæœåŠ¡å™¨å¼€æ”¾ï¼®ä¸ªé“¾æ¥ç»™å®¢æˆ·ç«¯æ¥è¿æ¥çš„ï¼Œã€€è¿™æ ·æœ‰ä¼šæœ‰å¤§å¹¶å‘çš„æ›´æ–°æ“ä½œ, ä½†æ˜¯ä»æœåŠ¡å™¨çš„é‡Œé¢è¯»å–binlog çš„çº¿ç¨‹ä»…æœ‰ä¸€ä¸ªï¼Œ å½“æŸä¸ªSQLåœ¨ä»æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„æ—¶é—´ç¨é•¿ æˆ–è€…ç”±äºæŸä¸ªSQLè¦è¿›è¡Œé”è¡¨å°±ä¼šå¯¼è‡´ï¼Œä¸»æœåŠ¡å™¨çš„SQLå¤§é‡ç§¯å‹ï¼Œæœªè¢«åŒæ­¥åˆ°ä»æœåŠ¡å™¨é‡Œã€‚è¿™å°±å¯¼è‡´äº†ä¸»ä»ä¸ä¸€è‡´ï¼Œ ä¹Ÿå°±æ˜¯ä¸»ä»å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;è§£å†³åŠæ³•ï¼š
1ï¼‰å®é™…ä¸Šä¸»ä»åŒæ­¥å»¶è¿Ÿæ ¹æœ¬æ²¡æœ‰ä»€ä¹ˆä¸€æ‹›åˆ¶æ•Œçš„åŠæ³•ï¼Œå› ä¸ºæ‰€æœ‰çš„SQLå¿…é¡»éƒ½è¦åœ¨ä»æœåŠ¡å™¨é‡Œé¢æ‰§è¡Œä¸€éï¼Œä½†æ˜¯ä¸»æœåŠ¡å™¨å¦‚æœä¸æ–­çš„æœ‰æ›´æ–°æ“ä½œæºæºä¸æ–­çš„å†™å…¥ï¼Œé‚£ä¹ˆä¸€æ—¦æœ‰å»¶è¿Ÿäº§ç”Ÿï¼Œé‚£ä¹ˆå»¶è¿ŸåŠ é‡çš„å¯èƒ½æ€§å°±ä¼šåŸæ¥è¶Šå¤§ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥åšä¸€äº›ç¼“è§£çš„æªæ–½ã€‚
2ï¼‰æˆ‘ä»¬çŸ¥é“å› ä¸ºä¸»æœåŠ¡å™¨è¦è´Ÿè´£æ›´æ–°æ“ä½œï¼Œä»–å¯¹å®‰å…¨æ€§çš„è¦æ±‚æ¯”ä»æœåŠ¡å™¨é«˜ï¼Œæ‰€æœ‰æœ‰äº›è®¾ç½®å¯ä»¥ä¿®æ”¹ï¼Œæ¯”å¦‚sync_binlog=1ï¼Œinnodb_flush_log_at_trx_commit=1ä¹‹ç±»çš„è®¾ç½®ï¼Œè€Œslaveåˆ™ä¸éœ€è¦è¿™ä¹ˆé«˜çš„æ•°æ®å®‰å…¨ï¼Œå®Œå…¨å¯ä»¥è®²sync_binlogè®¾ç½®ä¸º0æˆ–è€…å…³é—­binlogï¼Œinnodb_flushlogï¼Œinnodb_flush_log_at_trx_commitä¹Ÿå¯ä»¥è®¾ç½®ä¸º0æ¥æé«˜sqlçš„æ‰§è¡Œæ•ˆç‡è¿™ä¸ªèƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜æ•ˆç‡ã€‚å¦å¤–å°±æ˜¯ä½¿ç”¨æ¯”ä¸»åº“æ›´å¥½çš„ç¡¬ä»¶è®¾å¤‡ä½œä¸ºslaveã€‚
3ï¼‰å°±æ˜¯æŠŠï¼Œä¸€å°ä»æœåŠ¡å™¨å½“åº¦ä½œä¸ºå¤‡ä»½ä½¿ç”¨ï¼Œè€Œä¸æä¾›æŸ¥è¯¢ï¼Œé‚£è¾¹ä»–çš„è´Ÿè½½ä¸‹æ¥äº†ï¼Œæ‰§è¡Œrelaylogé‡Œé¢çš„SQLæ•ˆç‡è‡ªç„¶å°±é«˜äº†ã€‚
4ï¼‰å¢åŠ ä»æœåŠ¡å™¨å–½ï¼Œè¿™ä¸ªç›®çš„è¿˜æ˜¯åˆ†æ•£è¯»çš„å‹åŠ›ï¼Œä»è€Œé™ä½æœåŠ¡å™¨è´Ÿè½½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å‹åŠ›æµ‹è¯•&#34;&gt;å‹åŠ›æµ‹è¯• &lt;a href=&#34;#%e5%8e%8b%e5%8a%9b%e6%b5%8b%e8%af%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://imysql.com/tag/%E5%8E%8B%E6%B5%8B&#34;&gt;https://imysql.com/tag/%E5%8E%8B%E6%B5%8B&lt;/a&gt;
æ¯”è¾ƒå¸¸ç”¨çš„MySQLåŸºå‡†å‹åŠ›æµ‹è¯•å·¥å…·æœ‰ tpcc-mysqlã€sysbenchã€mysqlslap ç­‰å‡ ä¸ªã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-q.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;å»¶ä¼¸çŸ¥è¯†ç‚¹&#34;&gt;å»¶ä¼¸çŸ¥è¯†ç‚¹ &lt;a href=&#34;#%e5%bb%b6%e4%bc%b8%e7%9f%a5%e8%af%86%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;mysql-countæ€»ç»“&#34;&gt;MYSQL countæ€»ç»“ &lt;a href=&#34;#mysql-count%e6%80%bb%e7%bb%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;COUNTæœ‰å‡ ç§ç”¨æ³•ï¼Ÿcount(*),count(å¸¸æ•°)ï¼Œcount(åˆ—å)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;COUNT(å­—æ®µå)å’ŒCOUNT(&lt;em&gt;)çš„æŸ¥è¯¢ç»“æœæœ‰ä»€ä¹ˆä¸åŒï¼Ÿä¸ºä»€ä¹ˆã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹å»ºè®®ä½¿ç”¨COUNT(&lt;/em&gt;)
count(&lt;em&gt;)æ˜¯SQL92å®šä¹‰çš„æ ‡å‡†è¯­æ³•ï¼Œcount(&lt;/em&gt;)ä¼šç»Ÿè®¡å€¼ä¸ºnullçš„è¡Œï¼Œcount(åˆ—æ˜)ä¸ä¼šç»Ÿè®¡æ”¹åˆ—ä¸ºnullçš„è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;COUNT(1)å’ŒCOUNT(&lt;em&gt;)ã€count(åˆ—å)ä¹‹é—´æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
COUNT(å¸¸é‡) å’Œ COUNT(&lt;/em&gt;)è¡¨ç¤ºçš„æ˜¯ç›´æ¥æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ•°æ®åº“è¡¨çš„è¡Œæ•°ã€‚è€ŒCOUNT(åˆ—å)è¡¨ç¤ºçš„æ˜¯æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„åˆ—çš„å€¼ä¸ä¸ºNULLçš„è¡Œæ•°ã€‚
é™¤äº†æŸ¥è¯¢å¾—åˆ°ç»“æœé›†æœ‰åŒºåˆ«ä¹‹å¤–ï¼ŒCOUNT(&lt;em&gt;)ç›¸æ¯”COUNT(å¸¸é‡) å’Œ COUNT(åˆ—å)æ¥è®²ï¼ŒCOUNT(&lt;/em&gt;)æ˜¯SQL92å®šä¹‰çš„æ ‡å‡†ç»Ÿè®¡è¡Œæ•°çš„è¯­æ³•ï¼Œå› ä¸ºä»–æ˜¯æ ‡å‡†è¯­æ³•ï¼Œæ‰€ä»¥MySQLæ•°æ®åº“å¯¹ä»–è¿›è¡Œè¿‡å¾ˆå¤šä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;COUNT(1)å’ŒCOUNT(*)ä¹‹é—´çš„æ•ˆç‡å“ªä¸ªæ›´é«˜ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;InnoDB handles SELECT COUNT(*) and SELECT COUNT(1) operations in the same way. There is no performance difference.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç”»é‡ç‚¹ï¼šsame way , no performance differenceã€‚æ‰€ä»¥ï¼Œå¯¹äºCOUNT(1)å’ŒCOUNT(*)ï¼ŒMySQLçš„ä¼˜åŒ–æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œæ ¹æœ¬ä¸å­˜åœ¨è°æ¯”è°å¿«!&lt;/strong&gt;
å»ºè®®ä½¿ç”¨COUNT(*)ï¼å› ä¸ºè¿™ä¸ªæ˜¯SQL92å®šä¹‰çš„æ ‡å‡†ç»Ÿè®¡è¡Œæ•°çš„è¯­æ³•ï¼Œè€Œä¸”æœ¬æ–‡åªæ˜¯åŸºäºMySQLåšäº†åˆ†æï¼Œå…³äºOracleä¸­çš„è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯ä¼—è¯´çº·çº­çš„å‘¢ã€‚&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;
&lt;p&gt;MySQLçš„MyISAMå¼•æ“å¯¹COUNT(&lt;em&gt;)åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ
å› ä¸ºMyISAMçš„é”æ˜¯è¡¨çº§é”ï¼Œæ‰€ä»¥åŒä¸€å¼ è¡¨ä¸Šé¢çš„æ“ä½œéœ€è¦ä¸²è¡Œè¿›è¡Œï¼Œæ‰€ä»¥ï¼ŒMyISAMåšäº†ä¸€ä¸ªç®€å•çš„ä¼˜åŒ–ï¼Œé‚£å°±æ˜¯å®ƒå¯ä»¥æŠŠè¡¨çš„æ€»è¡Œæ•°å•ç‹¬è®°å½•ä¸‹æ¥ï¼Œå¦‚æœä»ä¸€å¼ è¡¨ä¸­ä½¿ç”¨COUNT(&lt;/em&gt;)è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥è¿”å›è¿™ä¸ªè®°å½•ä¸‹æ¥çš„æ•°å€¼å°±å¯ä»¥äº†ï¼Œå½“ç„¶ï¼Œå‰ææ˜¯ä¸èƒ½æœ‰whereæ¡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MySQLçš„InnoDBå¼•æ“å¯¹COUNT(&lt;em&gt;)åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ
åœ¨InnoDBä¸­ï¼Œä½¿ç”¨COUNT(&lt;/em&gt;)æŸ¥è¯¢è¡Œæ•°çš„æ—¶å€™ï¼Œä¸å¯é¿å…çš„è¦è¿›è¡Œæ‰«è¡¨äº†ï¼Œé‚£ä¹ˆï¼Œå°±å¯ä»¥åœ¨æ‰«è¡¨è¿‡ç¨‹ä¸­ä¸‹åŠŸå¤«æ¥ä¼˜åŒ–æ•ˆç‡äº†ã€‚
ä»MySQL 8.0.13å¼€å§‹ï¼Œé’ˆå¯¹InnoDBçš„SELECT COUNT(&lt;em&gt;) FROM tbl_nameè¯­å¥ï¼Œç¡®å®åœ¨æ‰«è¡¨çš„è¿‡ç¨‹ä¸­åšäº†ä¸€äº›ä¼˜åŒ–ã€‚å‰ææ˜¯æŸ¥è¯¢è¯­å¥ä¸­ä¸åŒ…å«WHEREæˆ–GROUP BYç­‰æ¡ä»¶ã€‚
æˆ‘ä»¬çŸ¥é“ï¼ŒCOUNT(&lt;/em&gt;)çš„ç›®çš„åªæ˜¯ä¸ºäº†ç»Ÿè®¡æ€»è¡Œæ•°ï¼Œæ‰€ä»¥ï¼Œä»–æ ¹æœ¬ä¸å…³å¿ƒè‡ªå·±æŸ¥åˆ°çš„å…·ä½“å€¼ï¼Œæ‰€ä»¥ï¼Œä»–å¦‚æœèƒ½å¤Ÿåœ¨æ‰«è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæˆæœ¬è¾ƒä½çš„ç´¢å¼•è¿›è¡Œçš„è¯ï¼Œé‚£å°±å¯ä»¥å¤§å¤§èŠ‚çœæ—¶é—´ã€‚
æˆ‘ä»¬çŸ¥é“ï¼ŒInnoDBä¸­ç´¢å¼•åˆ†ä¸ºèšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰å’Œéèšç°‡ç´¢å¼•ï¼ˆéä¸»é”®ç´¢å¼•ï¼‰ï¼Œèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜çš„æ˜¯æ•´è¡Œè®°å½•ï¼Œè€Œéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜çš„æ˜¯è¯¥è¡Œè®°å½•çš„ä¸»é”®çš„å€¼ã€‚
æ‰€ä»¥ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œéèšç°‡ç´¢å¼•è¦æ¯”èšç°‡ç´¢å¼•å°å¾ˆå¤šï¼Œæ‰€ä»¥MySQLä¼šä¼˜å…ˆé€‰æ‹©æœ€å°çš„éèšç°‡ç´¢å¼•æ¥æ‰«è¡¨ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å»ºè¡¨çš„æ—¶å€™ï¼Œé™¤äº†ä¸»é”®ç´¢å¼•ä»¥å¤–ï¼Œåˆ›å»ºä¸€ä¸ªéä¸»é”®ç´¢å¼•è¿˜æ˜¯æœ‰å¿…è¦çš„ã€‚
è‡³æ­¤ï¼Œæˆ‘ä»¬ä»‹ç»å®Œäº†MySQLæ•°æ®åº“å¯¹äºCOUNT(*)çš„ä¼˜åŒ–ï¼Œè¿™äº›ä¼˜åŒ–çš„å‰æéƒ½æ˜¯æŸ¥è¯¢è¯­å¥ä¸­ä¸åŒ…å«WHEREä»¥åŠGROUP BYæ¡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šé¢æåˆ°çš„MySQLå¯¹COUNT(*)åšçš„ä¼˜åŒ–ï¼Œæœ‰ä¸€ä¸ªå…³é”®çš„å‰ææ˜¯ä»€ä¹ˆï¼Ÿ
æ— whereæ¡ä»¶æˆ–è€…group byç­‰æ¡ä»¶&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯å±€éƒ¨æ€§åŸç†&#34;&gt;ä»€ä¹ˆæ˜¯å±€éƒ¨æ€§åŸç†ï¼Ÿ &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e5%b1%80%e9%83%a8%e6%80%a7%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å±€éƒ¨æ€§åŸç†çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å†…å­˜è¯»å†™å—ï¼Œç£ç›˜è¯»å†™æ…¢ï¼Œè€Œä¸”æ…¢å¾ˆå¤šï¼›&lt;/li&gt;
&lt;li&gt;ç£ç›˜é¢„è¯»ï¼šç£ç›˜è¯»å†™å¹¶ä¸æ˜¯æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æŒ‰é¡µé¢„è¯»ï¼Œä¸€æ¬¡ä¼šè¯»ä¸€é¡µçš„æ•°æ®ï¼Œæ¯æ¬¡åŠ è½½æ›´å¤šçš„æ•°æ®ï¼Œå¦‚æœæœªæ¥è¦è¯»å–çš„æ•°æ®å°±åœ¨è¿™ä¸€é¡µä¸­ï¼Œå¯ä»¥é¿å…æœªæ¥çš„ç£ç›˜IOï¼Œæé«˜æ•ˆç‡ï¼›ï¼ˆé€šå¸¸ï¼Œä¸€é¡µæ•°æ®æ˜¯4Kï¼‰&lt;/li&gt;
&lt;li&gt;å±€éƒ¨æ€§åŸç†ï¼šè½¯ä»¶è®¾è®¡è¦å°½é‡éµå¾ªâ€œæ•°æ®è¯»å–é›†ä¸­â€ä¸â€œä½¿ç”¨åˆ°ä¸€ä¸ªæ•°æ®ï¼Œå¤§æ¦‚ç‡ä¼šä½¿ç”¨å…¶é™„è¿‘çš„æ•°æ®â€ï¼Œè¿™æ ·ç£ç›˜é¢„è¯»èƒ½å……åˆ†æé«˜ç£ç›˜IOï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;bæ ‘ä¸ºä½•é€‚åˆåšç´¢å¼•&#34;&gt;Bæ ‘ä¸ºä½•é€‚åˆåšç´¢å¼•ï¼Ÿ &lt;a href=&#34;#b%e6%a0%91%e4%b8%ba%e4%bd%95%e9%80%82%e5%90%88%e5%81%9a%e7%b4%a2%e5%bc%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ç”±äºæ˜¯måˆ†å‰çš„ï¼Œé«˜åº¦èƒ½å¤Ÿå¤§å¤§é™ä½ï¼›&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨jä¸ªè®°å½•ï¼Œå¦‚æœå°†èŠ‚ç‚¹å¤§å°è®¾ç½®ä¸ºé¡µå¤§å°ï¼Œä¾‹å¦‚4Kï¼Œèƒ½å¤Ÿå……åˆ†çš„åˆ©ç”¨é¢„è¯»çš„ç‰¹æ€§ï¼Œæå¤§å‡å°‘ç£ç›˜IOï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;bæ ‘&#34;&gt;B+æ ‘ &lt;a href=&#34;#b%e6%a0%91&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/mysql-r.jpeg&#34; alt=&#34;&#34;&gt;
Bæ ‘çš„æ’å…¥åŠå¹³è¡¡åŒ–æ“ä½œå’Œ2-3æ ‘å¾ˆç›¸ä¼¼ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚ä¸‹é¢æ˜¯å¾€Bæ ‘ä¸­ä¾æ¬¡æ’å…¥
&lt;code&gt;6 10 4 14 5 11 15 3 2 12 1 7 8 8 6 3 6 21 5 15 15 6 32 23 45 65 7 8 6 5 4&lt;/code&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/mysql-s.gif&#34; alt=&#34;&#34;&gt;
B+æ ‘ï¼Œå¦‚ä¸Šå›¾ï¼Œä»æ˜¯må‰æœç´¢æ ‘ï¼Œåœ¨Bæ ‘çš„åŸºç¡€ä¸Šï¼Œåšäº†ä¸€äº›æ”¹è¿›ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éå¶å­èŠ‚ç‚¹ä¸å†å­˜å‚¨æ•°æ®ï¼Œæ•°æ®åªå­˜å‚¨åœ¨åŒä¸€å±‚çš„å¶å­èŠ‚ç‚¹ä¸Šï¼›ï¼ˆç”»å¤–éŸ³ï¼šB+æ ‘ä¸­æ ¹åˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„è·¯å¾„é•¿åº¦ä¸€æ ·ï¼Œè€ŒBæ ‘ä¸æ˜¯è¿™æ ·ã€‚ï¼‰&lt;/li&gt;
&lt;li&gt;å¶å­ä¹‹é—´ï¼Œå¢åŠ äº†é“¾è¡¨ï¼Œè·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¸å†éœ€è¦ä¸­åºéå†ï¼›
è¿™äº›æ”¹è¿›è®©B+æ ‘æ¯”Bæ ‘æœ‰æ›´ä¼˜çš„ç‰¹æ€§ï¼š&lt;/li&gt;
&lt;li&gt;èŒƒå›´æŸ¥æ‰¾ï¼Œå®šä½minä¸maxä¹‹åï¼Œä¸­é—´å¶å­èŠ‚ç‚¹ï¼Œå°±æ˜¯ç»“æœé›†ï¼Œä¸ç”¨ä¸­åºå›æº¯ï¼›ï¼ˆç”»å¤–éŸ³ï¼šèŒƒå›´æŸ¥è¯¢åœ¨SQLä¸­ç”¨å¾—å¾ˆå¤šï¼Œè¿™æ˜¯B+æ ‘æ¯”Bæ ‘æœ€å¤§çš„ä¼˜åŠ¿ã€‚ï¼‰&lt;/li&gt;
&lt;li&gt;å¶å­èŠ‚ç‚¹å­˜å‚¨å®é™…è®°å½•è¡Œï¼Œè®°å½•è¡Œç›¸å¯¹æ¯”è¾ƒç´§å¯†çš„å­˜å‚¨ï¼Œé€‚åˆå¤§æ•°æ®é‡&lt;font color=red&gt;ç£ç›˜å­˜å‚¨&lt;/font&gt;ï¼›éå¶å­èŠ‚ç‚¹å­˜å‚¨è®°å½•çš„PKï¼Œç”¨äºæŸ¥è¯¢åŠ é€Ÿï¼Œé€‚åˆ&lt;font color=red&gt;å†…å­˜å­˜å‚¨&lt;/font&gt;ï¼›&lt;/li&gt;
&lt;li&gt;éå¶å­èŠ‚ç‚¹ï¼Œä¸å­˜å‚¨å®é™…è®°å½•ï¼Œè€Œåªå­˜å‚¨è®°å½•çš„KEYçš„è¯ï¼Œé‚£ä¹ˆåœ¨ç›¸åŒå†…å­˜çš„æƒ…å†µä¸‹ï¼ŒB+æ ‘èƒ½å¤Ÿå­˜å‚¨æ›´å¤šç´¢å¼•ï¼›
æœ€åï¼Œé‡åŒ–è¯´ä¸‹ï¼Œä¸ºä»€ä¹ˆmå‰çš„B+æ ‘æ¯”äºŒå‰æœç´¢æ ‘çš„é«˜åº¦å¤§å¤§å¤§å¤§é™ä½ï¼Ÿ
å¤§æ¦‚è®¡ç®—ä¸€ä¸‹ï¼š
(1)å±€éƒ¨æ€§åŸç†ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºä¸€é¡µï¼Œä¸€é¡µ4Kï¼Œå‡è®¾ä¸€ä¸ªKEYæœ‰8å­—èŠ‚ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨500ä¸ªKEYï¼Œå³j=500
(2)må‰æ ‘ï¼Œå¤§æ¦‚m/2&amp;lt;= j &amp;lt;=mï¼Œå³å¯ä»¥å·®ä¸å¤šæ˜¯1000å‰æ ‘
(3)é‚£ä¹ˆï¼š
ä¸€å±‚æ ‘ï¼š1ä¸ªèŠ‚ç‚¹ï¼Œ1&lt;em&gt;500ä¸ªKEYï¼Œå¤§å°4K
äºŒå±‚æ ‘ï¼š1000ä¸ªèŠ‚ç‚¹ï¼Œ1000&lt;/em&gt;500=50Wä¸ªKEYï¼Œå¤§å°1000&lt;em&gt;4K=4M
ä¸‰å±‚æ ‘ï¼š1000&lt;/em&gt;1000ä¸ªèŠ‚ç‚¹ï¼Œ1000&lt;em&gt;1000&lt;/em&gt;500=5äº¿ä¸ªKEYï¼Œå¤§å°1000&lt;em&gt;1000&lt;/em&gt;4K=4G
å¯ä»¥çœ‹åˆ°ï¼Œå­˜å‚¨å¤§é‡çš„æ•°æ®ï¼ˆ5äº¿ï¼‰ï¼Œå¹¶ä¸éœ€è¦å¤ªé«˜æ ‘çš„æ·±åº¦ï¼ˆé«˜åº¦3ï¼‰ï¼Œç´¢å¼•ä¹Ÿä¸æ˜¯å¤ªå å†…å­˜ï¼ˆ4Gï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>redisæ€»ç»“</title>
      <link>https://abnerxc.github.io/note/redis-%E6%80%BB%E7%BB%93/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/redis-%E6%80%BB%E7%BB%93/</guid>
      <description>&lt;h1 id=&#34;redisä¸ºä»€ä¹ˆé‚£ä¹ˆå¿«&#34;&gt;Redisä¸ºä»€ä¹ˆé‚£ä¹ˆå¿« &lt;a href=&#34;#redis%e4%b8%ba%e4%bb%80%e4%b9%88%e9%82%a3%e4%b9%88%e5%bf%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;çº¯å†…å­˜æ“ä½œ&lt;/li&gt;
&lt;li&gt;å•çº¿ç¨‹æ“ä½œï¼Œé¿å…äº†é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨äº†éé˜»å¡I/Oå¤šè·¯å¤ç”¨æœºåˆ¶
æˆ‘ä»¬çš„redis-clientåœ¨æ“ä½œçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿå…·æœ‰ä¸åŒäº‹ä»¶ç±»å‹çš„socketã€‚åœ¨æœåŠ¡ç«¯ï¼Œæœ‰ä¸€æ®µI/0å¤šè·¯å¤ç”¨ç¨‹åºï¼Œå°†å…¶ç½®å…¥é˜Ÿåˆ—ä¹‹ä¸­ã€‚ç„¶åï¼Œæ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼Œä¾æ¬¡å»é˜Ÿåˆ—ä¸­å–ï¼Œè½¬å‘åˆ°ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;redisæ•°æ®ç±»å‹&#34;&gt;Redisæ•°æ®ç±»å‹ &lt;a href=&#34;#redis%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;String,Hash,List,Set,SortedSet&lt;/li&gt;
&lt;li&gt;Pub/Sub&lt;/li&gt;
&lt;li&gt;HyperLogLog(2.8.9ç‰ˆæœ¬æ–°å¢):ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®š çš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚ä½¿ç”¨åœºæ™¯æœ€å¸¸è§çš„å°±æ˜¯è®¡ç®—ç½‘ç«™UVç­‰ï¼Œå¯¹æ•°æ®ç²¾åº¦è¦æ±‚ä¸é«˜&lt;/li&gt;
&lt;li&gt;Geoï¼ˆ3.2ç‰ˆæœ¬æ–°å¢ï¼‰ï¼šGEO(åœ°ç†ä½ç½®)çš„æ”¯æŒï¼Œä¸»è¦æ˜¯å¯¹ç»çº¬åº¦ä¸€ä¸ªä½ç½®è®¡ç®—ç­‰ç‰¹æ€§&lt;/li&gt;
&lt;li&gt;BitMap&lt;/li&gt;
&lt;li&gt;BloomFilter
&lt;img src=&#34;https://abnerxc.github.io/img/redis-i.jpeg&#34; alt=&#34;data-struct&#34;&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/redis-j.jpeg&#34; alt=&#34;data-struct&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;redisçš„è¿‡æœŸç­–ç•¥ä»¥åŠå†…å­˜æ·˜æ±°æœºåˆ¶&#34;&gt;Redisçš„è¿‡æœŸç­–ç•¥ä»¥åŠå†…å­˜æ·˜æ±°æœºåˆ¶ &lt;a href=&#34;#redis%e7%9a%84%e8%bf%87%e6%9c%9f%e7%ad%96%e7%95%a5%e4%bb%a5%e5%8f%8a%e5%86%85%e5%ad%98%e6%b7%98%e6%b1%b0%e6%9c%ba%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;ä¸‰ç§è¿‡æœŸç­–ç•¥&#34;&gt;ä¸‰ç§è¿‡æœŸç­–ç•¥ &lt;a href=&#34;#%e4%b8%89%e7%a7%8d%e8%bf%87%e6%9c%9f%e7%ad%96%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å®šæ—¶åˆ é™¤ï¼šåœ¨è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´çš„åŒæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨(timer)ï¼Œè®©å®šæ—¶å™¨åœ¨é”®çš„è¿‡æœŸæ—¶é—´æ¥ä¸´æ—¶ï¼Œç«‹å³æ‰§è¡Œå¯¹é”®çš„åˆ é™¤æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;æƒ°æ€§åˆ é™¤ï¼šæ”¾ä»»é”®è¿‡æœŸä¸ç®¡ï¼Œä½†æ˜¯æ¯æ¬¡ä»é”®ç©ºé—´ä¸­è·å–é”®æ—¶ï¼Œéƒ½æ£€æŸ¥å–å¾—çš„é”®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸçš„è¯ï¼Œå°±åˆ é™¤è¯¥é”®ï¼›å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œé‚£å°±è¿”å›è¯¥é”®ï¼›&lt;/li&gt;
&lt;li&gt;å®šæœŸåˆ é™¤ï¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œç¨‹åºå°±å¯¹æ•°æ®åº“è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œåˆ é™¤é‡Œé¢çš„è¿‡æœŸé”®ã€‚è‡³äºåˆ é™¤å¤šå°‘è¿‡æœŸé”®ï¼Œä»¥åŠè¦æ£€æŸ¥å¤šå°‘ä¸ªæ•°æ®åº“ï¼Œåˆ™ç”±ç®—æ³•å†³å®šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redisé‡‡ç”¨çš„æ˜¯å®šæœŸåˆ é™¤+æƒ°æ€§åˆ ç­–ç•¥ã€‚&lt;br&gt;
ä¸ºä»€ä¹ˆä¸ç”¨å®šæ—¶åˆ é™¤ç­–ç•¥ï¼Ÿå®šæ—¶åˆ é™¤ç­–ç•¥éœ€è¦å®šæ—¶å™¨æ¥ç›‘è§†keyï¼Œè¿‡æœŸåˆ™è‡ªåŠ¨åˆ é™¤ã€‚è™½ç„¶å†…å­˜åŠæ—¶é‡Šæ”¾äº†ï¼Œä½†æ˜¯CPUæ¶ˆè€—å¤§ã€‚åœ¨å¤§å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸€ç­–ç•¥å¾—ä¸å¿å¤±&lt;/p&gt;
&lt;p&gt;Redisé‡‡ç”¨çš„æ˜¯å®šæœŸåˆ é™¤+æƒ°æ€§åˆ ç­–ç•¥å·¥ä½œæœºåˆ¶ã€‚&lt;br&gt;
å®šæœŸåˆ é™¤ï¼Œredisé»˜è®¤æ¯100msæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦å­˜åœ¨è¿‡æœŸkeyï¼Œæœ‰åˆ™åˆ é™¤ã€‚éœ€è¦è¯´æ˜çš„æ˜¯rediså¹¶ä¸æ˜¯100msæ£€æŸ¥æ‰€æœ‰çš„keyä¸€æ¬¡ï¼Œè€Œæ˜¯éšæœºè¿›è¡ŒæŠ½å–æ£€æŸ¥ã€‚å› æ­¤ï¼Œæƒ°æ€§åˆ é™¤æ´¾ä¸Šç”¨å¤„ã€‚
æƒ°æ€§åˆ ç­–ç•¥å»¶ä¼¸å‡ºæ¥çš„é—®é¢˜å°±æ˜¯ï¼Œredisç¼“å­˜æ·˜æ±°æœºåˆ¶&lt;/p&gt;
&lt;h2 id=&#34;redis30ç‰ˆæœ¬6ç§ç¼“å­˜æ·˜æ±°æœºåˆ¶&#34;&gt;Redis(3.0ç‰ˆæœ¬)6ç§ç¼“å­˜æ·˜æ±°æœºåˆ¶ &lt;a href=&#34;#redis30%e7%89%88%e6%9c%ac6%e7%a7%8d%e7%bc%93%e5%ad%98%e6%b7%98%e6%b1%b0%e6%9c%ba%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;1.  no-enviction(é©±é€)ï¼šç¦æ­¢é©±é€æ•°æ®ï¼ˆä¸åˆ é™¤æ•°æ®ç­–ç•¥ï¼Œè¾¾åˆ°æœ€å¤§çš„å†…å­˜é™åˆ¶æ—¶ï¼Œå¦‚æœæœ‰æ›´å¤šçš„æ•°æ®å†™å…¥ï¼Œè¿”å›é”™è¯¯ç»™å®¢æˆ·ç«¯ï¼‰
2.  allkeys-lruï¼šæ‰€æœ‰keyé€šç”¨ï¼Œä¼˜å…ˆåˆ é™¤æœ€å°‘ä½¿ç”¨çš„keyï¼ˆless recently used,LRUç®—æ³•ï¼‰
3.  allkeys-random ï¼šæ‰€æœ‰keyé€šç”¨ï¼Œéšæœºåˆ é™¤ä¸€éƒ¨åˆ†key
4.  volatile-lruï¼šåªé™äºè®¾ç½®äº†expireçš„éƒ¨åˆ†ï¼Œä¼˜å…ˆåˆ é™¤æœ€å°‘ä½¿ç”¨çš„keyï¼ˆless recently used,LRUç®—æ³•ï¼‰
5.  volatile-randomï¼šåªé™äºè®¾ç½®äº† expire çš„éƒ¨åˆ†; éšæœºåˆ é™¤ä¸€éƒ¨åˆ†key
6.  volatile-ttlï¼šåªé™äºè®¾ç½®äº† expire çš„éƒ¨åˆ†; ä¼˜å…ˆåˆ é™¤å‰©ä½™æ—¶é—´(time to live,TTL) çŸ­çš„keyã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰è®¾ç½® expire çš„key, ä¸æ»¡è¶³å…ˆå†³æ¡ä»¶(prerequisites); é‚£ä¹ˆ volatile-lru, volatile-random å’Œ volatile-ttl ç­–ç•¥çš„è¡Œä¸º, å’Œ noeviction(ä¸åˆ é™¤) åŸºæœ¬ä¸Šä¸€è‡´ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼šå¦‚æœåˆ†ä¸ºçƒ­æ•°æ®ä¸å†·æ•°æ®, æ¨èä½¿ç”¨allkeys-lruç­–ç•¥ã€‚ ä¹Ÿå°±æ˜¯, å…¶ä¸­ä¸€éƒ¨åˆ†keyç»å¸¸è¢«è¯»å†™. å¦‚æœä¸ç¡®å®šå…·ä½“çš„ä¸šåŠ¡ç‰¹å¾, é‚£ä¹ˆallkeys-lruæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ å¦‚æœéœ€è¦å¾ªç¯è¯»å†™æ‰€æœ‰çš„key, æˆ–è€…å„ä¸ªkeyçš„è®¿é—®é¢‘ç‡å·®ä¸å¤š, å¯ä»¥ä½¿ç”¨allkeys-randomç­–ç•¥, å³è¯»å†™æ‰€æœ‰å…ƒç´ çš„æ¦‚ç‡å·®ä¸å¤šã€‚&lt;/p&gt;
&lt;p&gt;å‡å¦‚è¦è®© Redis æ ¹æ® TTL æ¥ç­›é€‰éœ€è¦åˆ é™¤çš„key, è¯·ä½¿ç”¨volatile-ttlç­–ç•¥ã€‚&lt;/p&gt;
&lt;h1 id=&#34;redisæŒä¹…åŒ–åŸç†&#34;&gt;RedisæŒä¹…åŒ–åŸç† &lt;a href=&#34;#redis%e6%8c%81%e4%b9%85%e5%8c%96%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å¿«ç…§ç‰¹ç‚¹bgsaveåšé•œåƒå…¨é‡æŒä¹…åŒ–&#34;&gt;å¿«ç…§ï¼ˆç‰¹ç‚¹ï¼šbgsaveåšé•œåƒå…¨é‡æŒä¹…åŒ–ï¼‰ &lt;a href=&#34;#%e5%bf%ab%e7%85%a7%e7%89%b9%e7%82%b9bgsave%e5%81%9a%e9%95%9c%e5%83%8f%e5%85%a8%e9%87%8f%e6%8c%81%e4%b9%85%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ç¼ºçœæƒ…å†µä¸‹ï¼ŒRedisæŠŠæ•°æ®å¿«ç…§å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶åä¸ºdump.rdbã€‚ä½ å¯ä»¥é…ç½®Redisçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚æ•°æ®é›†ä¸­æ¯Nç§’é’Ÿæœ‰è¶…è¿‡Mæ¬¡æ›´æ–°ï¼Œå°±å°†æ•°æ®å†™å…¥ç£ç›˜ï¼›æˆ–è€…ä½ å¯ä»¥æ‰‹å·¥è°ƒç”¨å‘½ä»¤SAVEæˆ–BGSAVEã€‚
å·¥ä½œåŸç†:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸»è¿›ç¨‹å¼€å¯ä¸€ä¸ª Redis forksï¼ˆå­è¿›ç¨‹ï¼‰.&lt;/li&gt;
&lt;li&gt;å­è¿›ç¨‹å¼€å§‹å°†æ•°æ®å†™åˆ°ä¸´æ—¶RDBæ–‡ä»¶ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å½“å­è¿›ç¨‹å®Œæˆå†™RDBæ–‡ä»¶ï¼Œç”¨æ–°æ–‡ä»¶æ›¿æ¢è€æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;bgsaveçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä½ ç»™å‡ºä¸¤ä¸ªè¯æ±‡å°±å¯ä»¥äº†ï¼Œforkå’Œcowã€‚forkæ˜¯æŒ‡redisé€šè¿‡åˆ›å»ºå­è¿›ç¨‹æ¥è¿›è¡Œbgsaveæ“ä½œï¼ŒcowæŒ‡çš„æ˜¯copy on writeï¼Œå­è¿›ç¨‹åˆ›å»ºåï¼Œçˆ¶å­è¿›ç¨‹å…±äº«æ•°æ®æ®µï¼Œçˆ¶è¿›ç¨‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ï¼Œå†™è„çš„é¡µé¢æ•°æ®ä¼šé€æ¸å’Œå­è¿›ç¨‹åˆ†ç¦»å¼€æ¥ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/redis-k.jpeg&#34; alt=&#34;fork&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;aofç‰¹ç‚¹aofå¢é‡æŒä¹…åŒ–&#34;&gt;AOFï¼ˆç‰¹ç‚¹ï¼šAOFå¢é‡æŒä¹…åŒ–ï¼‰ &lt;a href=&#34;#aof%e7%89%b9%e7%82%b9aof%e5%a2%9e%e9%87%8f%e6%8c%81%e4%b9%85%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;AOFæŒä¹…åŒ–ä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æœåŠ¡å™¨æ‰€å¤„ç†çš„æ¯ä¸€ä¸ªå†™ã€åˆ é™¤æ“ä½œï¼ŒæŸ¥è¯¢æ“ä½œä¸ä¼šè®°å½•ï¼Œä»¥æ–‡æœ¬çš„æ–¹å¼è®°å½•ï¼Œå¯ä»¥æ‰“å¼€æ–‡ä»¶çœ‹åˆ°è¯¦ç»†çš„æ“ä½œè®°å½•ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/redis-l.jpeg&#34; alt=&#34;aof&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;redisä¸»ä»å¤åˆ¶30å¼€å§‹æ”¯æŒåŸç†&#34;&gt;Redisä¸»ä»å¤åˆ¶(3.0å¼€å§‹æ”¯æŒ)åŸç† &lt;a href=&#34;#redis%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b630%e5%bc%80%e5%a7%8b%e6%94%af%e6%8c%81%e5%8e%9f%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;h2 id=&#34;å…¨é‡åŒæ­¥&#34;&gt;å…¨é‡åŒæ­¥ &lt;a href=&#34;#%e5%85%a8%e9%87%8f%e5%90%8c%e6%ad%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;å½“å¯åŠ¨ä¸€ä¸ªslave nodeçš„æ—¶å€™ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªPSYNCå‘½ä»¤ç»™master&lt;/li&gt;
&lt;li&gt;å¦‚æœè¿™æ˜¯slave nodeé‡æ–°é“¾æ¥masterï¼Œmasterä¼šå°†ç¼ºå°‘çš„æ•°æ®å‘é€ç»™slaveï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é“¾æ¥masterï¼Œåˆ™ä¼šè§¦å‘ä¸€æ¬¡full resynchronization,å¼€å§‹ full resynchronizationçš„æ—¶å€™ï¼Œmasterå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå…ˆå°†ç°æœ‰æ•°æ®ç”Ÿæˆä¸€ä¸ªé›¶æ—¶çš„rdbæ–‡ä»¶ï¼Œç”Ÿæˆæ–‡ä»¶åï¼Œmasterä¼šå°†è¿™ä¸ªrdbæ–‡ä»¶å‘é€ç»™slaveï¼Œslaveä¼šå…ˆæŠŠè¿™ä¸ªrdbæ–‡ä»¶å­˜æ”¾åˆ°æœ¬åœ°ç£ç›˜ï¼Œç„¶ååœ¨åŠ è½½åˆ°å†…å­˜ï¼Œç„¶åmasterä¼šå°†ç”Ÿæˆrdbè¿™æ®µæ—¶é—´å†…æ¥æ”¶åˆ°çš„åœ¨å†…å­˜ä¸­çš„æ•°æ®å‘é€ç»™slaveï¼Œslaveä¹Ÿä¼šæ¥æ”¶è¿™ä»½æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;slaveå¦‚æœè·Ÿmasterç½‘ç»œæ•…éšœï¼Œæ–­å¼€äº†ï¼Œå½“é‡æ–°è¿æ¥ä¸Šä»¥åï¼Œmasterå‘ç°æœ‰å¤šä¸ªslaveéƒ½æ¥é‡æ–°è¿æ¥ï¼Œmasterä¼šç”Ÿæˆä¸€ä¸ªrdbæ–‡ä»¶ï¼Œå°†è¿™ä¸ªæ–‡ä»¶åŒæ—¶å‘é€ä¸ªå¤šä¸ªslave node
&lt;img src=&#34;https://abnerxc.github.io/img/redis-m.jpeg&#34; alt=&#34;full_sync&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸»ä»å¤åˆ¶çš„æ–­ç‚¹ç»­ä¼ &#34;&gt;ä¸»ä»å¤åˆ¶çš„æ–­ç‚¹ç»­ä¼  &lt;a href=&#34;#%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e7%9a%84%e6%96%ad%e7%82%b9%e7%bb%ad%e4%bc%a0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;redisä»2.8å¼€å§‹å°±æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼Œå³å½“slaveä¸masteræ–­å¼€åï¼Œé‡æ–°è¿æ¥æ—¶ï¼Œä¼šç»§ç»­ä»ä¸Šä¸€æ¬¡æ–­å¼€çš„ç‚¹ç»§ç»­ä¼ é€æ•°æ®ï¼Œè€Œä¸æ˜¯full resynchronizationã€‚&lt;/li&gt;
&lt;li&gt;masterä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªbacklogï¼Œmasterå’Œslaveéƒ½ä¼šä¿å­˜ä¸€ä¸ªoffset,slaveè¿˜æœ‰ä¸€ä¸ªmaster id,offsetå°±æ˜¯ä¿å­˜åœ¨backlogä¸­çš„ï¼Œå¦‚æœslaveå’Œmasterç½‘ç»œæ–­å¼€ï¼Œé‡æ–°è¿æ¥åslaveä¼šè®©masterä»replica offsetå¼€å§‹ç»­ä¼ ã€‚ä½†æ˜¯å¦‚æœæ²¡æœ‰æ‰¾åˆ°offsetï¼Œåˆ™ä¼šè§¦å‘full resynchronizationã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ— ç£ç›˜åŒ–å¤åˆ¶&#34;&gt;æ— ç£ç›˜åŒ–å¤åˆ¶ &lt;a href=&#34;#%e6%97%a0%e7%a3%81%e7%9b%98%e5%8c%96%e5%a4%8d%e5%88%b6&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;masteråœ¨å†…å­˜ä¸­ç›´æ¥åˆ›å»ºrdb,ç„¶åç›´æ¥å‘é€ç»™slave,ä¸ä¼šå­˜å…¥æœ¬åœ°ç£ç›˜&lt;/li&gt;
&lt;li&gt;å‚æ•°é…ç½®&lt;br&gt;
repl-diskless-sync&lt;br&gt;
repl-diskless-sync-delay, ç­‰å¾…ä¸€å®šæ—¶é•¿åœ¨å¤åˆ¶ï¼Œå› ä¸ºè¦ç­‰æ›´å¤šçš„slaveé‡æ–°è¿æ¥&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è¿‡æœŸkeyå¤„ç†&#34;&gt;è¿‡æœŸkeyå¤„ç† &lt;a href=&#34;#%e8%bf%87%e6%9c%9fkey%e5%a4%84%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;slaveä¸ä¼šæœ‰è¿‡æœŸKey,åªæœ‰masteræœ‰è¿‡æœŸkey,å¦‚æœmasterè¿‡æœŸäº†ä¸€ä¸ªå¯ä»¥æˆ–è€…é€šè¿‡LRUç®—æ³•æ·˜æ±°äº†ä¸€ä¸ªkeyï¼Œé‚£ä¹ˆmasterä¼šæ¨¡æ‹Ÿå‘é€ä¸€ä¸ªdelå‘½ä»¤ç»™slave&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;redis-clusteré›†ç¾¤&#34;&gt;Redis-Clusteré›†ç¾¤ &lt;a href=&#34;#redis-cluster%e9%9b%86%e7%be%a4&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/redis-n.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´proxyå±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotä¸Šï¼ˆä¸ä¸€å®šæ˜¯å¹³å‡åˆ†é…ï¼‰,cluster è´Ÿè´£ç»´æŠ¤node&amp;lt;-&amp;gt;slot&amp;lt;-&amp;gt;valueã€‚&lt;/li&gt;
&lt;li&gt;Redisé›†ç¾¤é¢„åˆ†å¥½16384ä¸ªæ¡¶ï¼Œå½“éœ€è¦åœ¨ Redis é›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ª key-value æ—¶ï¼Œæ ¹æ® CRC16(key) mod 16384çš„å€¼ï¼Œå†³å®šå°†ä¸€ä¸ªkeyæ”¾åˆ°å“ªä¸ªæ¡¶ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæ˜¯16384ï¼ˆ2^14ï¼‰ä¸ªï¼Ÿ
åœ¨redisèŠ‚ç‚¹å‘é€å¿ƒè·³åŒ…æ—¶éœ€è¦æŠŠæ‰€æœ‰çš„æ§½æ”¾åˆ°è¿™ä¸ªå¿ƒè·³åŒ…é‡Œï¼Œä»¥ä¾¿è®©èŠ‚ç‚¹çŸ¥é“å½“å‰é›†ç¾¤ä¿¡æ¯ï¼Œ16384=16kï¼Œåœ¨å‘é€å¿ƒè·³åŒ…æ—¶ä½¿ç”¨charè¿›è¡Œbitmapå‹ç¼©åæ˜¯2kï¼ˆ2 * 8 (8 bit) * 1024(1k) = 2Kï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨2kçš„ç©ºé—´åˆ›å»ºäº†16kçš„æ§½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ä½¿ç”¨CRC16ç®—æ³•æœ€å¤šå¯ä»¥åˆ†é…65535ï¼ˆ2^16-1ï¼‰ä¸ªæ§½ä½ï¼Œ65535=65kï¼Œå‹ç¼©åå°±æ˜¯8kï¼ˆ8 * 8 (8 bit) * 1024(1k) = 8Kï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦éœ€è¦8kçš„å¿ƒè·³åŒ…ï¼Œä½œè€…è®¤ä¸ºè¿™æ ·åšä¸å¤ªå€¼å¾—ï¼›å¹¶ä¸”ä¸€èˆ¬æƒ…å†µä¸‹ä¸€ä¸ªredisé›†ç¾¤ä¸ä¼šæœ‰è¶…è¿‡1000ä¸ªmasterèŠ‚ç‚¹ï¼Œæ‰€ä»¥16kçš„æ§½ä½æ˜¯ä¸ªæ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h1 id=&#34;rediså“¨å…µ&#34;&gt;Rediså“¨å…µ &lt;a href=&#34;#redis%e5%93%a8%e5%85%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åœ¨Server1 æ‰çº¿åï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/redis-p1.jpeg&#34; alt=&#34;&#34;&gt;
å‡çº§Server2 ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼š
&lt;img src=&#34;https://abnerxc.github.io/img/redis-p2.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Sentinelçš„ä½œç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Master çŠ¶æ€ç›‘æµ‹&lt;/li&gt;
&lt;li&gt;å¦‚æœMaster å¼‚å¸¸ï¼Œåˆ™ä¼šè¿›è¡ŒMaster-slave è½¬æ¢ï¼Œå°†å…¶ä¸­ä¸€ä¸ªSlaveä½œä¸ºMasterï¼Œå°†ä¹‹å‰çš„Masterä½œä¸ºSlave&lt;/li&gt;
&lt;li&gt;Master-Slaveåˆ‡æ¢åï¼Œmaster_redis.confã€slave_redis.confå’Œsentinel.confçš„å†…å®¹éƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå³master_redis.confä¸­ä¼šå¤šä¸€è¡Œslaveofçš„é…ç½®ï¼Œsentinel.confçš„ç›‘æ§ç›®æ ‡ä¼šéšä¹‹è°ƒæ¢&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sentinelçš„å·¥ä½œæ–¹å¼:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¯ä¸ªSentinelä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘å®ƒæ‰€çŸ¥çš„Masterï¼ŒSlaveä»¥åŠå…¶ä»– Sentinel å®ä¾‹å‘é€ä¸€ä¸ª PING å‘½ä»¤&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œ åˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinel æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ªMasterè¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ªMasterçš„æ‰€æœ‰ Sentinel è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤Masterçš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤Masterçš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼Œ åˆ™Masterä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿&lt;/li&gt;
&lt;li&gt;åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª Sentinel ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘å®ƒå·²çŸ¥çš„æ‰€æœ‰Masterï¼ŒSlaveå‘é€ INFO å‘½ä»¤&lt;/li&gt;
&lt;li&gt;å½“Masterè¢« Sentinel æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿æ—¶ï¼ŒSentinel å‘ä¸‹çº¿çš„ Master çš„æ‰€æœ‰ Slave å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinel åŒæ„ Master å·²ç»ä¸‹çº¿ï¼Œ Master çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥ Master é‡æ–°å‘ Sentinel çš„ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼Œ Master çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;rediså’Œæ•°æ®åº“åŒå†™ä¸€è‡´æ€§é—®é¢˜&#34;&gt;Rediså’Œæ•°æ®åº“åŒå†™ä¸€è‡´æ€§é—®é¢˜ &lt;a href=&#34;#redis%e5%92%8c%e6%95%b0%e6%8d%ae%e5%ba%93%e5%8f%8c%e5%86%99%e4%b8%80%e8%87%b4%e6%80%a7%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä¸€è‡´æ€§é—®é¢˜æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸è§é—®é¢˜ï¼Œå¯ä»¥åˆ†ä¸ºæœ€ç»ˆä¸€è‡´æ€§å’Œå¼ºä¸€è‡´æ€§ã€‚æ‰€ä»¥å¼„æ¸…è¯‰æ±‚
æ•°æ®åº“å¼ºä¸€è‡´æ€§ï¼Œä¸æ”¾ç¼“å­˜ï¼Œæˆ‘ä»¬æ‰€åšçš„ä¸€åˆ‡åªæ˜¯ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¦å¤–æ— æ³•å®Œå…¨é¿å…ï¼Œè®¨è®ºä¸‰ç§æ›´æ–°ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜&lt;/li&gt;
&lt;li&gt;å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“&lt;/li&gt;
&lt;li&gt;å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜&#34;&gt;å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ &lt;a href=&#34;#%e5%85%88%e6%9b%b4%e6%96%b0%e6%95%b0%e6%8d%ae%e5%ba%93%e5%86%8d%e6%9b%b4%e6%96%b0%e7%bc%93%e5%ad%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¿™å¥—æ–¹æ¡ˆï¼Œå¤§å®¶æ˜¯æ™®éåå¯¹çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæœ‰å¦‚ä¸‹ä¸¤ç‚¹åŸå› ï¼š
åŸå› ä¸€ã€çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶æœ‰è¯·æ±‚Aå’Œè¯·æ±‚Bè¿›è¡Œæ›´æ–°æ“ä½œï¼Œé‚£ä¹ˆä¼šå‡ºç°ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;çº¿ç¨‹Aæ›´æ–°äº†æ•°æ®åº“
çº¿ç¨‹Bæ›´æ–°äº†æ•°æ®åº“
çº¿ç¨‹Bæ›´æ–°äº†ç¼“å­˜
çº¿ç¨‹Aæ›´æ–°äº†ç¼“å­˜
è¿™å°±å‡ºç°è¯·æ±‚Aæ›´æ–°ç¼“å­˜åº”è¯¥æ¯”è¯·æ±‚Bæ›´æ–°ç¼“å­˜æ—©æ‰å¯¹ï¼Œä½†æ˜¯å› ä¸ºç½‘ç»œç­‰åŸå› ï¼ŒBæ¯”Aæ›´æ—©æ›´æ–°äº†ç¼“å­˜ã€‚è¿™å°±å¯¼è‡´äº†è„æ•°æ®ï¼Œå› æ­¤ä¸è€ƒè™‘ï¼
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åŸå› äºŒã€ä¸šåŠ¡åœºæ™¯è€ƒè™‘&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœæ˜¯å†™æ•°æ®åº“åœºæ™¯æ¯”è¾ƒå¤šï¼Œè¯»æ•°æ®åº“åœºæ™¯æ¯”è¾ƒå°‘ä¸šåŠ¡éœ€æ±‚ã€‚&amp;ldquo;å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜&amp;quot;è¿™ç§æ–¹æ¡ˆä¼šå¯¼è‡´ï¼Œæ•°æ®å‹æ ¹è¿˜æ²¡è¯»åˆ°ï¼Œç¼“å­˜å°±è¢«é¢‘ç¹çš„æ›´æ–°æµªè´¹æ€§èƒ½&lt;/li&gt;
&lt;li&gt;å¦‚æœå†™å…¥æ•°æ®åº“æ˜¯ç»è¿‡å¤æ‚è®¡ç®—ä»¥åå†æ›´æ–°æ•°æ®åº“ï¼Œé‚£ä¹ˆæ¯æ¬¡å†™å…¥æ•°æ®åº“åæ›´æ–°ç¼“å­˜ï¼Œæ€§èƒ½å­˜åœ¨æµªè´¹&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“&#34;&gt;å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ &lt;a href=&#34;#%e5%85%88%e5%88%a0%e9%99%a4%e7%bc%93%e5%ad%98%e5%86%8d%e6%9b%b4%e6%96%b0%e6%95%b0%e6%8d%ae%e5%ba%93&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¯¥æ–¹æ¡ˆä¼šå¯¼è‡´ä¸ä¸€è‡´çš„åŸå› ï¼šåŒæ—¶æœ‰ä¸€ä¸ªè¯·æ±‚Aè¿›è¡Œæ›´æ–°æ“ä½œï¼Œå¦ä¸€ä¸ªè¯·æ±‚Bè¿›è¡ŒæŸ¥è¯¢æ“ä½œã€‚é‚£ä¹ˆå°±ä¼šå‡ºç°ä»¥ä¸‹æƒ…å½¢ï¼š
æƒ…å†µä¸€ï¼šå¤šè¿›ç¨‹è¯»å†™åŸå› &lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;è¯·æ±‚Aè¿›è¡Œå†™æ“ä½œï¼Œåˆ é™¤ç¼“å­˜
è¯·æ±‚BæŸ¥è¯¢å‘ç°ç¼“å­˜ä¸å­˜åœ¨
è¯·æ±‚Bå»æ•°æ®åº“æŸ¥è¯¢å¾—åˆ°æ—§å€¼
è¯·æ±‚Bå°†æ—§å€¼å†™å…¥ç¼“å­˜
è¯·æ±‚Aå°†æ–°å€¼å†™å…¥æ•°æ®åº“
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šè¯‰è¯·æ±‚å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå¦‚æœæ²¡é‡‡ç”¨ç¼“å­˜è¿‡æœŸç­–ç•¥ã€‚åˆ™ç¼“å­˜æ•°æ®ä¸€ç›´æ˜¯è„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æƒ…å†µäºŒï¼šMYSQLä¸»ä»åˆ†ç¦»åŸå› &lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;è¯·æ±‚Aè¿›è¡Œå†™æ“ä½œï¼Œåˆ é™¤ç¼“å­˜ï¼›
è¯·æ±‚Aå°†æ•°æ®å†™å…¥æ•°æ®åº“äº†ï¼›
è¯·æ±‚BæŸ¥è¯¢ç¼“å­˜å‘ç°ï¼Œç¼“å­˜æ²¡æœ‰å€¼ï¼›
è¯·æ±‚Bå»ä»åº“æŸ¥è¯¢ï¼Œè¿™æ—¶ï¼Œè¿˜æ²¡æœ‰å®Œæˆä¸»ä»åŒæ­¥ï¼Œå› æ­¤æŸ¥è¯¢åˆ°çš„æ˜¯æ—§å€¼ï¼›
è¯·æ±‚Bå°†æ—§å€¼å†™å…¥ç¼“å­˜ï¼›
æ•°æ®åº“å®Œæˆä¸»ä»åŒæ­¥ï¼Œä»åº“å˜ä¸ºæ–°å€¼ï¼›
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è§£å†³æ–¹æ¡ˆï¼šé‡‡ç”¨å»¶è¿ŸåŒåˆ ç­–ç•¥ã€‚å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†åˆ é™¤æ•°æ®åº“ï¼Œè¿›ç¨‹ä¼‘çœ 1ç§’å†æ¬¡åˆ é™¤ç¼“å­˜&lt;/p&gt;
&lt;h2 id=&#34;å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜&#34;&gt;å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ &lt;a href=&#34;#%e5%85%88%e6%9b%b4%e6%96%b0%e6%95%b0%e6%8d%ae%e5%ba%93%e5%86%8d%e5%88%a0%e9%99%a4%e7%bc%93%e5%ad%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;è¿™ç§æƒ…å†µä¸å­˜åœ¨å¹¶å‘é—®é¢˜ä¹ˆï¼Ÿ
ä¸æ˜¯çš„ã€‚å‡è®¾è¿™ä¼šæœ‰ä¸¤ä¸ªè¯·æ±‚ï¼Œä¸€ä¸ªè¯·æ±‚AåšæŸ¥è¯¢æ“ä½œï¼Œä¸€ä¸ªè¯·æ±‚Båšæ›´æ–°æ“ä½œï¼Œé‚£ä¹ˆä¼šæœ‰å¦‚ä¸‹æƒ…å½¢äº§ç”Ÿï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¼“å­˜åˆšå¥½å¤±æ•ˆï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚AæŸ¥è¯¢æ•°æ®åº“ï¼Œå¾—ä¸€ä¸ªæ—§å€¼ï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚Bå°†æ–°å€¼å†™å…¥æ•°æ®åº“ï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚Båˆ é™¤ç¼“å­˜ï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚Aå°†æŸ¥åˆ°çš„æ—§å€¼å†™å…¥ç¼“å­˜ï¼›
okï¼Œå¦‚æœå‘ç”Ÿä¸Šè¿°æƒ…å†µï¼Œç¡®å®æ˜¯ä¼šå‘ç”Ÿè„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆï¼šå‘ç”Ÿä¸Šè¿°æƒ…å†µæœ‰ä¸€ä¸ªå…ˆå¤©æ€§æ¡ä»¶ï¼Œå°±æ˜¯ä¸Šè¿°æ­¥éª¤ï¼ˆ3ï¼‰çš„å†™æ•°æ®åº“æ“ä½œæ¯”æ­¥éª¤ï¼ˆ2ï¼‰çš„è¯»æ•°æ®åº“æ“ä½œè€—æ—¶æ›´çŸ­ï¼Œæ‰æœ‰å¯èƒ½ä½¿å¾—æ­¥éª¤ï¼ˆ4ï¼‰å…ˆäºæ­¥éª¤ï¼ˆ5ï¼‰ã€‚å¯æ˜¯ï¼Œå¤§å®¶æƒ³æƒ³ï¼Œæ•°æ®åº“çš„è¯»æ“ä½œçš„é€Ÿåº¦è¿œå¿«äºå†™æ“ä½œçš„ï¼ˆä¸ç„¶åšè¯»å†™åˆ†ç¦»å¹²å˜›ï¼Œåšè¯»å†™åˆ†ç¦»çš„æ„ä¹‰å°±æ˜¯å› ä¸ºè¯»æ“ä½œæ¯”è¾ƒå¿«ï¼Œè€—èµ„æºå°‘ï¼‰ï¼Œå› æ­¤æ­¥éª¤ï¼ˆ3ï¼‰è€—æ—¶æ¯”æ­¥éª¤ï¼ˆ2ï¼‰æ›´çŸ­ï¼Œè¿™ä¸€æƒ…å½¢å¾ˆéš¾å‡ºç°ã€‚  é¦–å…ˆï¼Œç»™ç¼“å­˜è®¾æœ‰æ•ˆæ—¶é—´æ˜¯ä¸€ç§æ–¹æ¡ˆã€‚å…¶æ¬¡ï¼Œé‡‡ç”¨ç­–ç•¥2ï¼ˆå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼‰é‡Œç»™å‡ºçš„å¼‚æ­¥å»¶æ—¶åˆ é™¤ç­–ç•¥ï¼Œä¿è¯è¯»è¯·æ±‚å®Œæˆä»¥åï¼Œå†è¿›è¡Œåˆ é™¤æ“ä½œã€‚&lt;/p&gt;
&lt;h1 id=&#34;å¦‚ä½•è§£å†³redisçš„å¹¶å‘ç«äº‰keyé—®é¢˜&#34;&gt;å¦‚ä½•è§£å†³redisçš„å¹¶å‘ç«äº‰keyé—®é¢˜ &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3redis%e7%9a%84%e5%b9%b6%e5%8f%91%e7%ab%9e%e4%ba%89key%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åˆ†æ:è¿™ä¸ªé—®é¢˜å¤§è‡´å°±æ˜¯ï¼ŒåŒæ—¶æœ‰å¤šä¸ªå­ç³»ç»Ÿå»setä¸€ä¸ªkeyã€‚è¿™ä¸ªæ—¶å€™è¦æ³¨æ„ä»€ä¹ˆå‘¢ï¼Ÿå¤§å®¶æ€è€ƒè¿‡ä¹ˆã€‚éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œåšä¸»æå‰ç™¾åº¦äº†ä¸€ä¸‹ï¼Œå‘ç°ç­”æ¡ˆåŸºæœ¬éƒ½æ˜¯æ¨èç”¨redisäº‹åŠ¡æœºåˆ¶ã€‚åšä¸»ä¸æ¨èä½¿ç”¨redisçš„äº‹åŠ¡æœºåˆ¶ã€‚å› ä¸ºæˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒï¼ŒåŸºæœ¬éƒ½æ˜¯redisé›†ç¾¤ç¯å¢ƒï¼Œåšäº†æ•°æ®åˆ†ç‰‡æ“ä½œã€‚ä½ ä¸€ä¸ªäº‹åŠ¡ä¸­æœ‰æ¶‰åŠåˆ°å¤šä¸ªkeyæ“ä½œçš„æ—¶å€™ï¼Œè¿™å¤šä¸ªkeyä¸ä¸€å®šéƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªredis-serverä¸Šã€‚å› æ­¤ï¼Œredisçš„äº‹åŠ¡æœºåˆ¶ï¼Œååˆ†é¸¡è‚‹ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå¯¹keyæ“ä½œä¸è¦æ±‚é¡ºåº&lt;br&gt;
è¿™ç§æƒ…å†µä¸‹ï¼Œå‡†å¤‡ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Œè°æŠ¢åˆ°é”è°setå³å¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå¯¹keyæ“ä½œè¦æ±‚é¡ºåº&lt;br&gt;
å‡è®¾æœ‰ä¸€ä¸ªkey1,ç³»ç»ŸAéœ€è¦å°†key1è®¾ç½®ä¸ºvalueA,ç³»ç»ŸBéœ€è¦å°†key1è®¾ç½®ä¸ºvalueB,ç³»ç»ŸCéœ€è¦å°†key1è®¾ç½®ä¸ºvalueC.&lt;br&gt;
æœŸæœ›æŒ‰ç…§key1çš„valueå€¼æŒ‰ç…§ valueAâ€“&amp;gt;valueBâ€“&amp;gt;valueCçš„é¡ºåºå˜åŒ–ã€‚è¿™ç§æ—¶å€™æˆ‘ä»¬åœ¨æ•°æ®å†™å…¥æ•°æ®åº“çš„æ—¶å€™ï¼Œéœ€è¦ä¿å­˜ä¸€ä¸ªæ—¶é—´æˆ³ã€‚å‡è®¾æ—¶é—´æˆ³å¦‚ä¸‹&lt;br&gt;
ç³»ç»ŸA key 1 {valueA 3:00}&lt;br&gt;
ç³»ç»ŸB key 1 {valueB 3:05}&lt;br&gt;
ç³»ç»ŸC key 1 {valueC 3:10}&lt;br&gt;
é‚£ä¹ˆï¼Œå‡è®¾è¿™ä¼šç³»ç»ŸBå…ˆæŠ¢åˆ°é”ï¼Œå°†key1è®¾ç½®ä¸º{valueB 3:05}ã€‚æ¥ä¸‹æ¥ç³»ç»ŸAæŠ¢åˆ°é”ï¼Œå‘ç°è‡ªå·±çš„valueAçš„æ—¶é—´æˆ³æ—©äºç¼“å­˜ä¸­çš„æ—¶é—´æˆ³ï¼Œé‚£å°±ä¸åšsetæ“ä½œäº†ã€‚ä»¥æ­¤ç±»æ¨ã€‚&lt;br&gt;
æˆ–è€…ä½¿ç”¨é˜Ÿåˆ—ï¼Œå°†setæ“ä½œè¿›è¡Œä¸²è”å³å¯&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ&#34;&gt;rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ &lt;a href=&#34;#redis%e5%b8%b8%e8%a7%81%e6%80%a7%e8%83%bd%e9%97%ae%e9%a2%98%e5%92%8c%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;Masterå†™å†…å­˜å¿«ç…§ï¼Œsaveå‘½ä»¤è°ƒåº¦rdbSaveå‡½æ•°ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œå½“å¿«ç…§æ¯”è¾ƒå¤§æ—¶å¯¹æ€§èƒ½å½±å“æ˜¯éå¸¸å¤§çš„ï¼Œä¼šé—´æ–­æ€§æš‚åœæœåŠ¡ï¼Œæ‰€ä»¥Masteræœ€å¥½ä¸è¦å†™å†…å­˜å¿«ç…§ã€‚&lt;/li&gt;
&lt;li&gt;Master AOFæŒä¹…åŒ–ï¼Œå¦‚æœä¸é‡å†™AOFæ–‡ä»¶ï¼Œè¿™ä¸ªæŒä¹…åŒ–æ–¹å¼å¯¹æ€§èƒ½çš„å½±å“æ˜¯æœ€å°çš„ï¼Œä½†æ˜¯AOFæ–‡ä»¶ä¼šä¸æ–­å¢å¤§ï¼ŒAOFæ–‡ä»¶è¿‡å¤§ä¼šå½±å“Masteré‡å¯çš„æ¢å¤é€Ÿåº¦ã€‚Masteræœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å†…å­˜å¿«ç…§å’ŒAOFæ—¥å¿—æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸è¦å¯ç”¨å†…å­˜å¿«ç…§åšæŒä¹…åŒ–,å¦‚æœæ•°æ®æ¯”è¾ƒå…³é”®ï¼ŒæŸä¸ªSlaveå¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;Masterè°ƒç”¨BGREWRITEAOFé‡å†™AOFæ–‡ä»¶ï¼ŒAOFåœ¨é‡å†™çš„æ—¶å€™ä¼šå å¤§é‡çš„CPUå’Œå†…å­˜èµ„æºï¼Œå¯¼è‡´æœåŠ¡loadè¿‡é«˜ï¼Œå‡ºç°çŸ­æš‚æœåŠ¡æš‚åœç°è±¡ã€‚&lt;/li&gt;
&lt;li&gt;Redisä¸»ä»å¤åˆ¶çš„æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒSlaveå’ŒMasteræœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;redis60-å¤šçº¿ç¨‹&#34;&gt;Redis6.0 å¤šçº¿ç¨‹ &lt;a href=&#34;#redis60-%e5%a4%9a%e7%ba%bf%e7%a8%8b&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å…¶å®æœ¬è´¨åªæ˜¯åœ¨ç½‘ç»œIOä¸Šé¢å®ç°äº†å¤šçº¿ç¨‹è¯»å–å’Œå†™å…¥ï¼Œç„¶åè¿›è¡Œæ‰§è¡Œé˜Ÿåˆ—ï¼Œæ‰§è¡Œè¿˜æ˜¯å•çº¿ç¨‹
&lt;img src=&#34;https://abnerxc.github.io/img/redis-q.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;
åŠ å…¥å¤šçº¿ç¨‹ IO ä¹‹åï¼Œæ•´ä½“çš„è¯»æµç¨‹å¦‚ä¸‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»çº¿ç¨‹è´Ÿè´£æ¥æ”¶å»ºè¿è¯·æ±‚ï¼Œè¯»äº‹ä»¶åˆ°æ¥(æ”¶åˆ°è¯·æ±‚)åˆ™æ”¾åˆ°ä¸€ä¸ªå…¨å±€ç­‰å¾…è¯»å¤„ç†é˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;ä¸»çº¿ç¨‹å¤„ç†å®Œè¯»äº‹ä»¶ä¹‹åï¼Œé€šè¿‡ RR(Round Robin) å°†è¿™äº›è¿æ¥åˆ†é…ç»™è¿™äº› IO çº¿ç¨‹ï¼Œç„¶åä¸»çº¿ç¨‹å¿™ç­‰å¾…(spinlock çš„æ•ˆæœ)çŠ¶æ€&lt;/li&gt;
&lt;li&gt;IO çº¿ç¨‹å°†è¯·æ±‚æ•°æ®è¯»å–å¹¶è§£æå®Œæˆ(è¿™é‡Œåªæ˜¯è¯»æ•°æ®å’Œè§£æå¹¶ä¸æ‰§è¡Œ)&lt;/li&gt;
&lt;li&gt;ä¸»çº¿ç¨‹æ‰§è¡Œæ‰€æœ‰å‘½ä»¤å¹¶æ¸…ç©ºæ•´ä¸ªè¯·æ±‚ç­‰å¾…è¯»å¤„ç†é˜Ÿåˆ—(æ‰§è¡Œéƒ¨åˆ†ä¸²è¡Œ)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢çš„è¿™ä¸ªè¿‡ç¨‹æ˜¯å®Œå…¨æ— é”çš„ï¼Œå› ä¸ºåœ¨ IO çº¿ç¨‹å¤„ç†çš„æ—¶ä¸»çº¿ç¨‹ä¼šç­‰å¾…å…¨éƒ¨çš„ IO çº¿ç¨‹å®Œæˆï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°data raceçš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;h1 id=&#34;redisæ–°ç‰¹æ€§&#34;&gt;Redisæ–°ç‰¹æ€§ &lt;a href=&#34;#redis%e6%96%b0%e7%89%b9%e6%80%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Redis Module&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»»ä½•C/C++ç¨‹åºç°åœ¨éƒ½å¯ä»¥è¿è¡Œåœ¨Redisä¸Š&lt;/li&gt;
&lt;li&gt;Modulesæ˜¯ç”¨ä¸€ç§æœ¬åœ°çš„æ–¹å¼æ¥æ‰©å±•Redisçš„æ–°ç”¨ä¾‹å’ŒåŠŸèƒ½&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç°æœ‰çš„æˆ–è€…æ·»åŠ æ–°çš„æ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;äº«å—ç®€å•ï¼Œæ— é™å¯æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§çš„åŒæ—¶ä¿æŒç€redisçš„æœ¬æœºçš„é€Ÿåº¦&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redis Search
é«˜æ€§èƒ½çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ˆFaster, in-memory, highly available full text searchï¼‰ï¼Œå¯ä½œä¸ºRedis Moduleè¿è¡Œåœ¨Redisä¸Šã€‚ä½†æ˜¯å®ƒä¸å…¶ä»–Redisæœç´¢åº“ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸ä½¿ç”¨Rediså†…éƒ¨æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ï¼šé›†åˆã€æ’åºé›†ï¼ˆps.åé¢ä¼šå†™ä¸€ç¯‡åŸºäºRedisçš„æ•°æ®ç»“æ„æ¥è®¾è®¡æœç´¢å¼•æ“ï¼‰ï¼ŒRedisåŸå£°çš„æœç´¢è¿˜æ˜¯æœ‰å¾ˆå¤§çš„å±€é™æ€§ï¼Œç®€å•çš„åˆ†è¯æœç´¢æ˜¯å¯ä»¥æ»¡è¶³ï¼Œä½†æ˜¯åº”ç”¨åˆ°å¤æ‚çš„åœºæ™¯å°±ä¸å¤ªé€‚åˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redis ML
æœºå™¨å­¦ä¹ æ¨¡å‹æœåŠ¡å™¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>å•çº¿ç¨‹çš„redisä¸ºä»€ä¹ˆå¿«</title>
      <link>https://abnerxc.github.io/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/</guid>
      <description>&lt;h1 id=&#34;åŸºæœ¬æ¦‚å¿µ&#34;&gt;åŸºæœ¬æ¦‚å¿µ &lt;a href=&#34;#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Redisæ€§èƒ½å¦‚æ­¤é«˜çš„åŸå› ï¼Œæˆ‘æ€»ç»“äº†å¦‚ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çº¯å†…å­˜æ“ä½œ&lt;/li&gt;
&lt;li&gt;å•çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;é«˜æ•ˆçš„æ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;åˆç†çš„æ•°æ®ç¼–ç &lt;/li&gt;
&lt;li&gt;å…¶ä»–æ–¹é¢çš„ä¼˜åŒ–&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ Redis ä¸­ï¼Œå¸¸ç”¨çš„å‡ ç§æ•°æ®ç»“æ„å’Œåº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Stringï¼šç¼“å­˜ã€è®¡æ•°å™¨ã€åˆ†å¸ƒå¼é”ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;Listï¼šé“¾è¡¨ã€é˜Ÿåˆ—ã€å¾®åšå…³æ³¨äººæ—¶é—´è½´åˆ—è¡¨ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;Hashï¼šç”¨æˆ·ä¿¡æ¯ã€Hash è¡¨ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;Setï¼šå»é‡ã€èµã€è¸©ã€å…±åŒå¥½å‹ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;Zsetï¼šè®¿é—®é‡æ’è¡Œæ¦œã€ç‚¹å‡»é‡æ’è¡Œæ¦œç­‰ã€‚&lt;/li&gt;
&lt;li&gt;HyperLogLog: ç½‘ç«™UV,ç‹¬ç«‹IPè®¡ç®—ç­‰ï¼Œä¸»è¦ä¹Ÿæ˜¯ä¸€äº›å»é‡è®¡ç®—ï¼Œå¯¹æ•°æ®ç²¾åº¦è¦æ±‚ä¸é«˜ï¼Œä¸»è¦ç”±äºè®¡ç®—æ•°æ®ç©ºé—´æ˜¯å›ºå®šçš„&lt;/li&gt;
&lt;li&gt;Geoï¼šGEO(åœ°ç†ä½ç½®)çš„æ”¯æŒï¼Œä¸»è¦æ˜¯å¯¹ç»çº¬åº¦ä¸€ä¸ªä½ç½®è®¡ç®—ç­‰ç‰¹æ€§&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å†…éƒ¨æ•°æ®ç»“æ„&#34;&gt;å†…éƒ¨æ•°æ®ç»“æ„ &lt;a href=&#34;#%e5%86%85%e9%83%a8%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;redisçš„åº•å±‚æ•°æ®ç»“æ„æœ‰ä»¥ä¸‹7ç§ï¼ŒåŒ…æ‹¬&lt;code&gt;ç®€å•åŠ¨æ€å­—ç¬¦ä¸²(SDS)ï¼Œé“¾è¡¨ã€å­—å…¸ã€è·³è·ƒè¡¨ã€æ•´æ•°é›†åˆã€å‹ç¼©åˆ—è¡¨ã€å¯¹è±¡&lt;/code&gt;ã€‚
&lt;img src=&#34;https://abnerxc.github.io/img/redis-d.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç®€å•åŠ¨æ€å­—ç¬¦ä¸²sds&#34;&gt;ç®€å•åŠ¨æ€å­—ç¬¦ä¸²(SDS) &lt;a href=&#34;#%e7%ae%80%e5%8d%95%e5%8a%a8%e6%80%81%e5%ad%97%e7%ac%a6%e4%b8%b2sds&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Redis æ˜¯ç”¨ C è¯­è¨€å¼€å‘å®Œæˆçš„ï¼Œä½†åœ¨ Redis å­—ç¬¦ä¸²ä¸­ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ç”¨ä¸€ç§ç§°ä¸º SDSï¼ˆSimple Dynamic Stringï¼‰çš„ç»“æ„ä½“æ¥ä¿å­˜å­—ç¬¦ä¸²ã€‚
åœ¨redisæ•°æ®åº“é‡Œï¼ŒåŒ…å«å­—ç¬¦ä¸²å€¼çš„é”®å€¼å¯¹åœ¨åº•å±‚éƒ½æ˜¯ç”±SDSå®ç°çš„ã€‚é™¤äº†ç”¨æ¥ä¿å­˜æ•°æ®åº“ä¸­çš„å­—ç¬¦ä¸²å€¼ä¹‹å¤–ï¼Œsdsè¿˜è¢«ç”¨æ¥ä½œç¼“å†²åŒºï¼ˆbufferï¼‰ï¼šAOFï¼ˆä¸€ç§æŒä¹…åŒ–ç­–ç•¥ï¼‰æ¨¡å—ä¸­çš„AOFç¼“å†²åŒºï¼Œä»¥åŠå®¢æˆ·ç«¯çŠ¶æ€ä¸­çš„è¾“å…¥ç¼“å†²åŒºï¼Œéƒ½æ˜¯ç”±SDSå®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/redis-e.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct __attribute__ ((__packed__)) sdshdr64 {
    uint64_t len; /*  è®°å½•buffæ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡ */   
    uint64_t free; /* è®°å½•æœªä½¿ç”¨å­—èŠ‚æ•°é‡*/
    char buf[]; /*å­˜å‚¨å®é™…å†…å®¹*/
};
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¾‹å¦‚ï¼šæ‰§è¡Œå‘½ä»¤ set key valueï¼Œkey å’Œ value éƒ½æ˜¯ä¸€ä¸ª SDS ç±»å‹çš„ç»“æ„å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sds-ä¸-c-å­—ç¬¦ä¸²çš„åŒºåˆ«&#34;&gt;SDS ä¸ C å­—ç¬¦ä¸²çš„åŒºåˆ« &lt;a href=&#34;#sds-%e4%b8%8e-c-%e5%ad%97%e7%ac%a6%e4%b8%b2%e7%9a%84%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¸¸æ•°æ—¶é—´å†…è·å¾—å­—ç¬¦ä¸²é•¿åº¦:
C å­—ç¬¦ä¸²æœ¬èº«ä¸è®°å½•é•¿åº¦ä¿¡æ¯ï¼Œæ¯æ¬¡è·å–é•¿åº¦ä¿¡æ¯éƒ½éœ€è¦éå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œå¤æ‚åº¦ä¸º O(n)ï¼›C å­—ç¬¦ä¸²éå†æ—¶é‡åˆ°&amp;rsquo;\0â€˜ æ—¶ç»“æŸã€‚
SDS ä¸­ len å­—æ®µä¿å­˜ç€å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ‰€ä»¥æ€»èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…è·å–å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¤æ‚åº¦æ˜¯ O(1)ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¿å…ç¼“å†²åŒºæº¢å‡º
å‡è®¾åœ¨å†…å­˜ä¸­æœ‰ä¸¤ä¸ªç´§æŒ¨ç€çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œs1=&amp;ldquo;xxxxx&amp;quot;å’Œ s2=&amp;ldquo;yyyyy&amp;rdquo;&lt;br&gt;
ç”±äºåœ¨å†…å­˜ä¸Šç´§ç´§ç›¸è¿ï¼Œå½“æˆ‘ä»¬å¯¹ s1 è¿›è¡Œæ‰©å……çš„æ—¶å€™ï¼Œå°† s1=â€œxxxxxzzzzzâ€åï¼Œç”±äºæ²¡æœ‰è¿›è¡Œç›¸åº”çš„å†…å­˜é‡æ–°åˆ†é…ï¼Œå¯¼è‡´ s1 æŠŠ s2 è¦†ç›–æ‰ï¼Œå¯¼è‡´ s2 è¢«è«åå…¶å¦™çš„ä¿®æ”¹ã€‚&lt;br&gt;
ä½† SDS çš„ API å¯¹ zfc ä¿®æ”¹æ—¶é¦–å…ˆä¼šæ£€æŸ¥ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œè‹¥ä¸å……è¶³åˆ™ä¼šåˆ†é…æ–°ç©ºé—´ï¼Œé¿å…äº†ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‡å°‘å­—ç¬¦ä¸²ä¿®æ”¹æ—¶å¸¦æ¥çš„å†…å­˜é‡æ–°åˆ†é…çš„æ¬¡æ•°&#34;&gt;å‡å°‘å­—ç¬¦ä¸²ä¿®æ”¹æ—¶å¸¦æ¥çš„å†…å­˜é‡æ–°åˆ†é…çš„æ¬¡æ•° &lt;a href=&#34;#%e5%87%8f%e5%b0%91%e5%ad%97%e7%ac%a6%e4%b8%b2%e4%bf%ae%e6%94%b9%e6%97%b6%e5%b8%a6%e6%9d%a5%e7%9a%84%e5%86%85%e5%ad%98%e9%87%8d%e6%96%b0%e5%88%86%e9%85%8d%e7%9a%84%e6%ac%a1%e6%95%b0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ç”±äºCè¯­è¨€ä¿®æ”¹å­—ç¬¦éœ€è¦é‡æ–°åˆ†é…ç©ºé—´&lt;br&gt;
è€ŒSDSå®ç°äº†é¢„åˆ†é…å’Œæƒ°æ€§é‡Šæ”¾&lt;br&gt;
é¢„åˆ†é…è§„åˆ™ï¼šSDSç©ºé—´è¿›è¡Œæ‰©å……æ—¶ï¼Œä¼šåˆ†é…è¶³å¤Ÿçš„å†…å­˜ç©ºé—´è¿˜ä¼šåˆ†é…é¢å¤–æœªä½¿ç”¨çš„ç©ºé—´ã€‚å¦‚æœå¯¹ SDS ä¿®æ”¹åï¼Œlen çš„é•¿åº¦å°äº 1Mï¼Œé‚£ä¹ˆç¨‹åºå°†åˆ†é…å’Œ len ç›¸åŒé•¿åº¦çš„æœªä½¿ç”¨ç©ºé—´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ len=10ï¼Œé‡æ–°åˆ†é…åï¼Œbuf çš„å®é™…é•¿åº¦ä¼šå˜ä¸º 10(å·²ä½¿ç”¨ç©ºé—´)+10(é¢å¤–ç©ºé—´)+1(ç©ºå­—ç¬¦)=21ã€‚å¦‚æœå¯¹ SDS ä¿®æ”¹å len é•¿åº¦å¤§äº 1Mï¼Œé‚£ä¹ˆç¨‹åºå°†åˆ†é… 1M çš„æœªä½¿ç”¨ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;æƒ°æ€§ç©ºé—´é‡Šæ”¾ï¼šå½“å¯¹ SDS è¿›è¡Œç¼©çŸ­æ“ä½œæ—¶ï¼Œç¨‹åºå¹¶ä¸ä¼šå›æ”¶å¤šä½™çš„å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯ä½¿ç”¨ free å­—æ®µå°†è¿™äº›å­—èŠ‚æ•°é‡è®°å½•ä¸‹æ¥ä¸é‡Šæ”¾ï¼Œåé¢å¦‚æœéœ€è¦ append æ“ä½œï¼Œåˆ™ç›´æ¥ä½¿ç”¨ free ä¸­æœªä½¿ç”¨çš„ç©ºé—´ï¼Œå‡å°‘äº†å†…å­˜çš„åˆ†é…ã€‚&lt;/p&gt;
&lt;h1 id=&#34;3å­—å…¸hash&#34;&gt;3.å­—å…¸(Hash) &lt;a href=&#34;#3%e5%ad%97%e5%85%b8hash&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Redisåº•å±‚hashç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;typedef struct dict{
      dictType *type;
    void *privdata;
    dictht ht[2];
    int trehashidx;
}


typedef struct dictht{
    //å“ˆå¸Œè¡¨æ•°ç»„
    dectEntrt **table;
    //å“ˆå¸Œè¡¨å¤§å°
    unsigned long size;
    //
    unsigned long sizemask;
    //å“ˆå¸Œè¡¨å·²æœ‰èŠ‚ç‚¹æ•°é‡
    unsigned long used;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é‡è¦çš„ä¸¤ä¸ªå­—æ®µæ˜¯ dictht å’Œ trehashidx&lt;/p&gt;
&lt;h2 id=&#34;rehash&#34;&gt;Rehash &lt;a href=&#34;#rehash&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Rehashè§£é‡Šï¼šéšç€æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼Œ å“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹ä¼šé€æ¸åœ°å¢å¤šæˆ–è€…å‡å°‘ï¼Œ ä¸ºäº†è®©å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­ï¼ˆload factorï¼‰ç»´æŒåœ¨ä¸€ä¸ªåˆç†çš„èŒƒå›´ä¹‹å†…ï¼Œ å½“å“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å¤ªå¤šæˆ–è€…å¤ªå°‘æ—¶ï¼Œ ç¨‹åºéœ€è¦å¯¹å“ˆå¸Œè¡¨çš„å¤§å°è¿›è¡Œç›¸åº”çš„æ‰©å±•æˆ–è€…æ”¶ç¼©ã€‚æ‰©å±•å’Œæ”¶ç¼©å“ˆå¸Œè¡¨çš„å·¥ä½œå¯ä»¥é€šè¿‡æ‰§è¡Œ rehash ï¼ˆé‡æ–°æ•£åˆ—ï¼‰æ“ä½œæ¥å®Œæˆ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç”±ä¸Šæ®µä»£ç ï¼Œæˆ‘ä»¬å¯çŸ¥ dict ä¸­å­˜å‚¨äº†ä¸€ä¸ª dictht çš„æ•°ç»„ï¼Œé•¿åº¦ä¸º 2ï¼Œè¡¨æ˜è¿™ä¸ªæ•°æ®ç»“æ„ä¸­å®é™…å­˜å‚¨ç€ä¸¤ä¸ªå“ˆå¸Œè¡¨ ht[0] å’Œ ht[1]ï¼Œä¸ºä»€ä¹ˆè¦å­˜å‚¨ä¸¤å¼  hash è¡¨å‘¢ï¼Ÿ&lt;br&gt;
å½“ç„¶æ˜¯ä¸ºäº†Rehash,Rehashçš„è¿‡ç¨‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸º ht[1] åˆ†é…ç©ºé—´ã€‚å¦‚æœæ˜¯æ‰©å®¹æ“ä½œï¼Œht[1] çš„å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äº ht[0].used*2 çš„ 2^nï¼›å¦‚æœæ˜¯ç¼©å®¹æ“ä½œï¼Œht[1] çš„å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äº ht[0].used çš„ 2^nã€‚&lt;/li&gt;
&lt;li&gt;å°† ht[0] ä¸­çš„é”®å€¼ Rehash åˆ° ht[1] ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å½“ ht[0] å…¨éƒ¨è¿ç§»åˆ° ht[1] ä¸­åï¼Œé‡Šæ”¾ ht[0]ï¼Œå°† ht[1] ç½®ä¸º ht[0]ï¼Œå¹¶ä¸º ht[1] åˆ›å»ºä¸€å¼ æ–°è¡¨ï¼Œä¸ºä¸‹æ¬¡ Rehash åšå‡†å¤‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ¸è¿›å¼-rehash&#34;&gt;æ¸è¿›å¼ Rehash &lt;a href=&#34;#%e6%b8%90%e8%bf%9b%e5%bc%8f-rehash&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ä¸Šé¢æåˆ°çš„å¦‚æœht[0]å…¨éƒ¨ç§»åŠ¨åˆ°ht[1]ä¸­ï¼Œå¦‚æœæ•°æ®é‡å°å¾ˆå¿«ï¼Œå¦‚æœæ•°æ®é‡å¾ˆå¤§åˆ™ä¼šæœ‰å½±å“ä½¿ç”¨
æ‰€ä»¥redisé‡‡ç”¨äº†åˆ†å¤šæ¬¡ã€æ¸è¿›å¼çš„è¿ç§»ç­–ç•¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸º ht[1] åˆ†é…ç©ºé—´ï¼Œè®©å­—å…¸åŒæ—¶æ‹¥æœ‰ ht[0] å’Œ ht[1] ä¸¤ä¸ªå“ˆå¸Œè¡¨ã€‚&lt;/li&gt;
&lt;li&gt;å­—å…¸ä¸­ç»´æŠ¤ä¸€ä¸ª rehashidxï¼Œå¹¶å°†å®ƒç½®ä¸º 0ï¼Œè¡¨ç¤º Rehash å¼€å§‹ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ Rehash æœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸æ“ä½œæ—¶ï¼Œç¨‹åºè¿˜é¡ºä¾¿å°† ht[0] åœ¨ rehashidx ç´¢å¼•ä¸Šçš„æ‰€æœ‰é”®å€¼å¯¹ rehash åˆ° ht[1] ä¸­ï¼Œå½“ Rehash å®Œæˆåï¼Œå°† rehashidx å±æ€§+1ã€‚å½“å…¨éƒ¨ rehash å®Œæˆåï¼Œå°† rehashidx ç½®ä¸º -1ï¼Œè¡¨ç¤º rehash å®Œæˆã€‚
æ³¨æ„ï¼Œç”±äºç»´æŠ¤äº†ä¸¤å¼  Hash è¡¨ï¼Œæ‰€ä»¥åœ¨ Rehash çš„è¿‡ç¨‹ä¸­å†…å­˜ä¼šå¢é•¿ã€‚å¦å¤–ï¼Œåœ¨ Rehash è¿‡ç¨‹ä¸­ï¼Œå­—å…¸ä¼šåŒæ—¶ä½¿ç”¨ ht[0] å’Œ ht[1]ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥åœ¨åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°æ—¶ä¼šåœ¨ä¸¤å¼ è¡¨ä¸­æ“ä½œï¼Œåœ¨æŸ¥è¯¢æ—¶ä¼šå…ˆåœ¨ç¬¬ä¸€å¼ è¡¨ä¸­æŸ¥è¯¢ï¼Œå¦‚æœç¬¬ä¸€å¼ è¡¨ä¸­æ²¡æœ‰ï¼Œåˆ™ä¼šåœ¨ç¬¬äºŒå¼ è¡¨ä¸­æŸ¥è¯¢ã€‚ä½†æ–°å¢æ—¶ä¸€å¾‹ä¼šåœ¨ ht[1] ä¸­è¿›è¡Œï¼Œç¡®ä¿ ht[0] ä¸­çš„æ•°æ®åªä¼šå‡å°‘ä¸ä¼šå¢åŠ ã€‚&lt;/p&gt;
&lt;h1 id=&#34;4-zsetåº•å±‚&#34;&gt;4. Zsetåº•å±‚ &lt;a href=&#34;#4-zset%e5%ba%95%e5%b1%82&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;zsetåº•å±‚çš„å­˜å‚¨ç»“æ„åŒ…æ‹¬ziplistæˆ–skiplistï¼Œåœ¨åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ä½¿ç”¨ziplistï¼Œå…¶ä»–æ—¶å€™ä½¿ç”¨skiplistï¼Œä¸¤ä¸ªæ¡ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰åºé›†åˆä¿å­˜çš„å…ƒç´ æ•°é‡å°äº128ä¸ª&lt;/li&gt;
&lt;li&gt;æœ‰åºé›†åˆä¿å­˜çš„æ‰€æœ‰å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ziplistä½œä¸ºzsetçš„åº•å±‚å­˜å‚¨ç»“æ„æ—¶å€™ï¼Œæ¯ä¸ªé›†åˆå…ƒç´ ä½¿ç”¨ä¸¤ä¸ªç´§æŒ¨åœ¨ä¸€èµ·çš„å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹æ¥ä¿å­˜ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¿å­˜å…ƒç´ çš„æˆå‘˜ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¿å­˜å…ƒç´ çš„åˆ†å€¼ã€‚&lt;/p&gt;
&lt;p&gt;å½“skiplistä½œä¸ºzsetçš„åº•å±‚å­˜å‚¨ç»“æ„çš„æ—¶å€™ï¼Œä½¿ç”¨skiplistæŒ‰åºä¿å­˜å…ƒç´ åŠåˆ†å€¼ï¼Œä½¿ç”¨dictæ¥ä¿å­˜å…ƒç´ å’Œåˆ†å€¼çš„æ˜ å°„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;ziplistæ•°æ®ç»“æ„
&lt;img src=&#34;https://abnerxc.github.io/img/redis-f.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;&lt;/p&gt;
&lt;p&gt;skiplistæ•°æ®ç»“æ„
â€ƒskiplistä½œä¸ºzsetçš„å­˜å‚¨ç»“æ„ï¼Œæ•´ä½“å­˜å‚¨ç»“æ„å¦‚ä¸‹å›¾ï¼Œæ ¸å¿ƒç‚¹ä¸»è¦æ˜¯åŒ…æ‹¬ä¸€ä¸ªdictå¯¹è±¡å’Œä¸€ä¸ªskiplistå¯¹è±¡ã€‚dictä¿å­˜key/valueï¼Œkeyä¸ºå…ƒç´ ï¼Œvalueä¸ºåˆ†å€¼ï¼›skiplistä¿å­˜çš„æœ‰åºçš„å…ƒç´ åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ åŒ…æ‹¬å…ƒç´ å’Œåˆ†å€¼ã€‚ä¸¤ç§æ•°æ®ç»“æ„ä¸‹çš„å…ƒç´ æŒ‡å‘ç›¸åŒçš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/redis-g.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;5-setåº•å±‚&#34;&gt;5. Setåº•å±‚ &lt;a href=&#34;#5-set%e5%ba%95%e5%b1%82&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;setçš„åº•å±‚å­˜å‚¨intsetå’Œhashtableæ˜¯å­˜åœ¨ç¼–ç è½¬æ¢çš„ï¼Œä½¿ç”¨intsetå­˜å‚¨å¿…é¡»æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå¦åˆ™ä½¿ç”¨hashtableï¼Œæ¡ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»“åˆå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ•´æ•°å€¼&lt;/li&gt;
&lt;li&gt;é›†åˆå¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡ä¸è¶…è¿‡512ä¸ª&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;typedef struct intset {
    // ç¼–ç æ–¹å¼
    uint32_t encoding;
    // é›†åˆåŒ…å«çš„å…ƒç´ æ•°é‡
    uint32_t length;
    // ä¿å­˜å…ƒç´ çš„æ•°ç»„
    int8_t contents[];
} intset;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;setçš„å•ä¸ªå…ƒç´ çš„æ·»åŠ è¿‡ç¨‹ï¼Œé¦–å…ˆå¦‚æœå·²ç»æ˜¯hashtableçš„ç¼–ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èµ°æ­£å¸¸çš„hashtableçš„å…ƒç´ æ·»åŠ ï¼Œå¦‚æœåŸæ¥æ˜¯intsetçš„æƒ…å†µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œå¦‚ä¸‹åˆ¤æ–­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœèƒ½å¤Ÿè½¬æˆintçš„å¯¹è±¡ï¼ˆisObjectRepresentableAsLongLongï¼‰ï¼Œé‚£ä¹ˆå°±ç”¨intsetä¿å­˜ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœç”¨intsetä¿å­˜çš„æ—¶å€™ï¼Œå¦‚æœé•¿åº¦è¶…è¿‡512ï¼ˆREDIS_SET_MAX_INTSET_ENTRIESï¼‰å°±è½¬ä¸ºhashtableç¼–ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;liståº•å±‚&#34;&gt;Liståº•å±‚ &lt;a href=&#34;#list%e5%ba%95%e5%b1%82&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;redis listæ•°æ®ç»“æ„åº•å±‚é‡‡ç”¨å‹ç¼©åˆ—è¡¨ziplistæˆ–linkedlistä¸¤ç§æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œé¦–å…ˆä»¥ziplistè¿›è¡Œå­˜å‚¨ï¼Œåœ¨ä¸æ»¡è¶³ziplistçš„å­˜å‚¨è¦æ±‚åè½¬æ¢ä¸ºlinkedliståˆ—è¡¨ã€‚
â€ƒå½“åˆ—è¡¨å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œåˆ—è¡¨å¯¹è±¡ä½¿ç”¨ziplistè¿›è¡Œå­˜å‚¨ï¼Œå¦åˆ™ç”¨linkedlistå­˜å‚¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚&lt;/li&gt;
&lt;li&gt;åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡å°äº512ä¸ªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç¼–ç è½¬åŒ–&#34;&gt;ç¼–ç è½¬åŒ– &lt;a href=&#34;#%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Redis ä½¿ç”¨å¯¹è±¡ï¼ˆredisObjectï¼‰æ¥è¡¨ç¤ºæ•°æ®åº“ä¸­çš„é”®å€¼ï¼Œå½“æˆ‘ä»¬åœ¨ Redis ä¸­åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹æ—¶ï¼Œè‡³å°‘åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯ç”¨åšé”®å€¼å¯¹çš„é”®å¯¹è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯é”®å€¼å¯¹çš„å€¼å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚æˆ‘ä»¬æ‰§è¡Œ SET MSG XXX æ—¶ï¼Œé”®å€¼å¯¹çš„é”®æ˜¯ä¸€ä¸ªåŒ…å«äº†å­—ç¬¦ä¸²â€œMSGâ€œçš„å¯¹è±¡ï¼Œé”®å€¼å¯¹çš„å€¼å¯¹è±¡æ˜¯åŒ…å«å­—ç¬¦ä¸²â€XXXâ€çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;redisObject çš„ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;typedef struct redisObject{
    //ç±»å‹
   unsigned type:4;
   //ç¼–ç 
   unsigned encoding:4;
   //æŒ‡å‘åº•å±‚æ•°æ®ç»“æ„çš„æŒ‡é’ˆ
   void *ptr;
    //...
 }robj;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­ type å­—æ®µè®°å½•äº†å¯¹è±¡çš„ç±»å‹ï¼ŒåŒ…å«å­—ç¬¦ä¸²å¯¹è±¡ã€åˆ—è¡¨å¯¹è±¡ã€å“ˆå¸Œå¯¹è±¡ã€é›†åˆå¯¹è±¡ã€æœ‰åºé›†åˆå¯¹è±¡ã€‚&lt;br&gt;
ptr æŒ‡é’ˆå­—æ®µæŒ‡å‘å¯¹è±¡åº•å±‚å®ç°çš„æ•°æ®ç»“æ„ï¼Œè€Œè¿™äº›æ•°æ®ç»“æ„æ˜¯ç”± encoding å­—æ®µå†³å®šçš„ï¼Œæ¯ç§å¯¹è±¡è‡³å°‘æœ‰ä¸¤ç§æ•°æ®ç¼–ç ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://abnerxc.github.io/img/redis-h.jpeg&#34; alt=&#34;1.jpeg&#34;&gt;
å¯ä»¥é€šè¿‡ object encoding key æ¥æŸ¥çœ‹å¯¹è±¡æ‰€ä½¿ç”¨&lt;/p&gt;
&lt;h2 id=&#34;string-å¯¹è±¡çš„ç¼–ç è½¬åŒ–&#34;&gt;String å¯¹è±¡çš„ç¼–ç è½¬åŒ– &lt;a href=&#34;#string-%e5%af%b9%e8%b1%a1%e7%9a%84%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;String å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ int æˆ– rawï¼Œå¯¹äº String ç±»å‹çš„é”®å€¼ï¼Œå¦‚æœæˆ‘ä»¬å­˜å‚¨çš„æ˜¯çº¯æ•°å­—ï¼ŒRedis åº•å±‚é‡‡ç”¨çš„æ˜¯ int ç±»å‹çš„ç¼–ç ï¼Œå¦‚æœå…¶ä¸­åŒ…æ‹¬éæ•°å­—ï¼Œåˆ™ä¼šç«‹å³è½¬ä¸º raw ç¼–ç ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;127.0.0.1:6379&amp;gt; set str 1
OK
127.0.0.1:6379&amp;gt; object encoding str
&amp;#34;int&amp;#34;
127.0.0.1:6379&amp;gt; set str 1a
OK
127.0.0.1:6379&amp;gt; object encoding str
&amp;#34;raw&amp;#34;
127.0.0.1:6379&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;list-å¯¹è±¡çš„ç¼–ç è½¬åŒ–&#34;&gt;List å¯¹è±¡çš„ç¼–ç è½¬åŒ– &lt;a href=&#34;#list-%e5%af%b9%e8%b1%a1%e7%9a%84%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;List å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ziplist æˆ– linkedlistï¼Œå¯¹äº List ç±»å‹çš„é”®å€¼ï¼Œå½“åˆ—è¡¨å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œé‡‡ç”¨ ziplist ç¼–ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦éƒ½å°äº 64 å­—èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ ä¸ªæ•°å°äº 512 ä¸ªã€‚
å¦‚æœä¸æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„ä»»æ„ä¸€ä¸ªï¼Œå°±ä¼šè½¬åŒ–ä¸º linkedlist ç¼–ç ã€‚æ³¨æ„ï¼šè¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåœ¨ redis.conf ä¸­ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;list-max-ziplist-entries 512
list-max-ziplist-value 64
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;set-ç±»å‹çš„ç¼–ç è½¬åŒ–&#34;&gt;Set ç±»å‹çš„ç¼–ç è½¬åŒ– &lt;a href=&#34;#set-%e7%b1%bb%e5%9e%8b%e7%9a%84%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Set å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ intset æˆ– hashtableï¼Œintset ç¼–ç çš„ç»“æ„å¯¹è±¡ä½¿ç”¨æ•´æ•°é›†åˆä½œä¸ºåº•å±‚å®ç°ï¼ŒæŠŠæ‰€æœ‰å…ƒç´ éƒ½ä¿å­˜åœ¨ä¸€ä¸ªæ•´æ•°é›†åˆé‡Œé¢ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;127.0.0.1:6379&amp;gt; sadd set 1 2 3
(integer) 3
127.0.0.1:6379&amp;gt; object encoding set
&amp;#34;intset&amp;#34;
127.0.0.1:6379&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœ set é›†åˆä¸­ä¿å­˜äº†éæ•´æ•°ç±»å‹çš„æ•°æ®æ—¶ï¼ŒRedis ä¼šå°† intset è½¬åŒ–ä¸º hashtableï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;127.0.0.1:6379&amp;gt; sadd set 1 2 3
(integer) 3
127.0.0.1:6379&amp;gt; object encoding set
&amp;#34;intset&amp;#34;
127.0.0.1:6379&amp;gt; sadd set a
(integer) 1
127.0.0.1:6379&amp;gt; object encoding set
&amp;#34;hashtable&amp;#34;
 127.0.0.1:6379&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å½“ Set å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œå¯¹è±¡é‡‡ç”¨ intset ç¼–ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿å­˜çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ•´æ•°å€¼ï¼ˆå°æ•°ä¸è¡Œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Set å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å…ƒç´ ä¸ªæ•°å°äº 512 ä¸ªã€‚
ä¸èƒ½æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„ä»»æ„ä¸€ä¸ªï¼ŒSet éƒ½ä¼šé‡‡ç”¨ hashtable å­˜å‚¨ã€‚æ³¨æ„ï¼šç¬¬ä¸¤ä¸ªæ¡ä»¶æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåœ¨ redis.conf ä¸­ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;set-max-intset-entries 512
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;hash-å¯¹è±¡çš„ç¼–ç è½¬åŒ–&#34;&gt;Hash å¯¹è±¡çš„ç¼–ç è½¬åŒ– &lt;a href=&#34;#hash-%e5%af%b9%e8%b1%a1%e7%9a%84%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Hash å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ ziplist æˆ– hashtableï¼Œå½“ Hash ä»¥ ziplist ç¼–ç å­˜å‚¨çš„æ—¶å€™ï¼Œä¿å­˜åŒä¸€é”®å€¼å¯¹çš„ä¸¤ä¸ªèŠ‚ç‚¹æ€»æ˜¯ç´§æŒ¨åœ¨ä¸€èµ·ï¼Œé”®èŠ‚ç‚¹åœ¨å‰ï¼Œå€¼èŠ‚ç‚¹åœ¨åï¼š
å½“ Hash å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼ŒHash å¯¹è±¡é‡‡ç”¨ ziplist ç¼–ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hash å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰é”®å€¼å¯¹çš„é”®å’Œå€¼çš„å­—ç¬¦ä¸²é•¿åº¦å‡å°äº 64 å­—èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;Hash å¯¹è±¡ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å°äº 512 ä¸ªã€‚
å¦‚æœä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶çš„ä»»æ„ä¸€ä¸ªï¼Œziplist å°±ä¼šè½¬åŒ–ä¸º hashtable ç¼–ç ã€‚æ³¨æ„ï¼šè¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåœ¨ redis.conf ä¸­ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;hash-max-ziplist-entries 512
hash-max-ziplist-value 64
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;zset-å¯¹è±¡çš„ç¼–ç è½¬åŒ–&#34;&gt;Zset å¯¹è±¡çš„ç¼–ç è½¬åŒ– &lt;a href=&#34;#zset-%e5%af%b9%e8%b1%a1%e7%9a%84%e7%bc%96%e7%a0%81%e8%bd%ac%e5%8c%96&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Zset å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ ziplist æˆ– zkiplistï¼Œå½“é‡‡ç”¨ ziplist ç¼–ç å­˜å‚¨æ—¶ï¼Œæ¯ä¸ªé›†åˆå…ƒç´ ä½¿ç”¨ä¸¤ä¸ªç´§æŒ¨åœ¨ä¸€èµ·çš„å‹ç¼©åˆ—è¡¨æ¥å­˜å‚¨ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨å…ƒç´ çš„æˆå‘˜ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹å­˜å‚¨å…ƒç´ çš„åˆ†å€¼ï¼Œå¹¶ä¸”æŒ‰åˆ†å€¼å¤§å°ä»å°åˆ°å¤§æœ‰åºæ’åˆ—ã€‚&lt;/p&gt;
&lt;p&gt;å½“ Zset å¯¹è±¡åŒæ—¶æ»¡è¶³ä¸€ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œé‡‡ç”¨ ziplist ç¼–ç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Zset ä¿å­˜çš„å…ƒç´ ä¸ªæ•°å°äº 128ã€‚&lt;/li&gt;
&lt;li&gt;Zset å…ƒç´ çš„æˆå‘˜é•¿åº¦éƒ½å°äº 64 å­—èŠ‚ã€‚
å¦‚æœä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶çš„ä»»æ„ä¸€ä¸ªï¼Œziplist å°±ä¼šè½¬åŒ–ä¸º zkiplist ç¼–ç ã€‚æ³¨æ„ï¼šè¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåœ¨ redis.conf ä¸­ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;zset-max-ziplist-entries 128
zset-max-ziplist-value 64
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿çš„è§£å†³æ–¹æ³•</title>
      <link>https://abnerxc.github.io/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</guid>
      <description>&lt;h1 id=&#34;1ç¼“å­˜ç©¿é€&#34;&gt;1.ç¼“å­˜ç©¿é€ &lt;a href=&#34;#1%e7%bc%93%e5%ad%98%e7%a9%bf%e9%80%8f&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶éœ€è¦ä»æ•°æ®åº“æŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æ•°æ®åº“æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚åœ¨æµé‡å¤§æ—¶ï¼Œå¯èƒ½DBå°±æŒ‚æ‰äº†ï¼Œè¦æ˜¯æœ‰äººåˆ©ç”¨ä¸å­˜åœ¨çš„keyé¢‘ç¹æ”»å‡»æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™å°±æ˜¯æ¼æ´ã€‚&lt;br&gt;
ä¾‹å¦‚ä¸‹å›¾:&lt;br&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/redis-a.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;11è§£å†³åŠæ³•&#34;&gt;1.1è§£å†³åŠæ³• &lt;a href=&#34;#11%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å°†ä¸å­˜åœ¨çš„keyè®¾ç½®é»˜è®¤çš„å€¼&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰äººåˆ©ç”¨IDæ”»å‡»åº”ç”¨ï¼Œå¯ä»¥å°†è¿™ä¸ªkeyé¢„å…ˆè®¾ç½®ä¸€ä¸ªnullæˆ–è€…ç¨‹åºå¯åˆ¤æ–­çš„å€¼ï¼Œå†³å®šåº”ç”¨æ˜¯å¦è¿›è¡Œä¸‹é¢çš„æ‰§è¡Œã€‚å½“ç¼“å­˜å¤±æ•ˆæˆ–è€…ç¼“å­˜keyç»è¿‡è½®è®­ä»¥åä¸å†ä¸ºç©ºï¼Œåˆ™è¿›è¡Œç¨‹åºçš„åç»­æ‰§è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¸ƒéš†è¿‡æ»¤å™¨&lt;/p&gt;
&lt;p&gt;ç®€å•çš„è¯´ï¼Œbloomç®—æ³•ç±»ä¼¼ä¸€ä¸ªhash set,ç”¨æ¥åˆ¤æ–­æŸä¸ªå…ƒç´ çš„keyæ˜¯å¦å­˜åœ¨é›†åˆä¸­ã€‚å’Œä¸€èˆ¬çš„hash setä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªç®—æ³•æ— éœ€å­˜å‚¨keyçš„å€¼ï¼Œå€¼éœ€è¦kä¸ªæ¯”ç‰¹ä½ï¼Œæ¯ä¸ªå­˜åœ¨ä¸€ä¸ªæ ‡å¿—ï¼Œç”¨æ¥åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨é›†åˆä¸­ã€‚&lt;br&gt;
ç®—æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é¦–å…ˆéœ€è¦kä¸ªhasnå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°å¯ä»¥æŠŠkeyæ•£åˆ—æˆä¸º1ä¸ªæ•´æ•°&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–æ—¶ï¼Œéœ€è¦ä¸€ä¸ªé•¿åº¦ä¸ºnæ¯”ç‰¹çš„æ•°ç»„ï¼Œæ¯ä¸ªæ¯”ç‰¹ä½åˆå§‹åŒ–ä¸º0&lt;/li&gt;
&lt;li&gt;æŸä¸ªkeyåŠ å…¥é›†åˆæ—¶ï¼Œç”¨kä¸ªhashå‡½æ•°è®¡ç®—å‡ºkä¸ªæ•£åˆ—å€¼ï¼Œå¹¶æŠŠæ•°ç»„ä¸­å¯¹åº”çš„æ¯”ç‰¹ä½è®¾ç½®ä¸º1&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦åœ¨é›†åˆæ—¶ï¼Œç”¨kä¸ªhashå‡½æ•°è®¡ç®—å‡ºkä¸ªæ•£åˆ—å€¼ï¼Œå¹¶æŸ¥è¯¢æ•°ç»„ä¸­å¯¹åº”çš„æ¯”ç‰¹ä½ï¼Œå¦‚æœæ‰€æœ‰çš„æ¯”ç‰¹ä½éƒ½æ˜¯1ï¼Œåˆ™è®¤ä¸ºåœ¨é›†åˆä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¼˜ç‚¹:ä¸éœ€è¦å­˜å‚¨keyï¼ŒèŠ‚çœç©ºé—´&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç®—æ³•åˆ¤æ–­keyåœ¨é›†åˆæ—¶ï¼Œæœ‰ä¸€å®šçš„æ¦‚ç‡keyå…¶å®ä¸åœ¨é›†åˆä¸­&lt;/li&gt;
&lt;li&gt;æ— æ³•åˆ é™¤&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;2ç¼“å­˜é›ªå´©&#34;&gt;2.ç¼“å­˜é›ªå´© &lt;a href=&#34;#2%e7%bc%93%e5%ad%98%e9%9b%aa%e5%b4%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å¤§é‡çš„keyè®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´åœ¨ç¼“å­˜åœ¨åŒä¸€æ—¶åˆ»å¤±æ•ˆï¼Œé€ æˆDBçš„è¯·æ±‚å¤§ã€å‹åŠ›å¤§ï¼Œå¼•èµ·é›ªå´©&lt;/p&gt;
&lt;h2 id=&#34;21è§£å†³åŠæ³•&#34;&gt;2.1è§£å†³åŠæ³• &lt;a href=&#34;#21%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ä»ä¸šåŠ¡å±‚é¢ã€‚å¯ä»¥ç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ä¸ŠåŠ ä¸Šä¸€ä¸ªéšæœºå€¼ï¼Œä½¿å¾—æ¯ä¸ªkeyçš„è¿‡æœŸæ—¶é—´åˆ†å¸ƒå¼€æ¥ï¼Œä¸ä¼šé›†ä¸­åœ¨åŒä¸€æ—¶åˆ»&lt;/p&gt;
&lt;h1 id=&#34;3-ç¼“å­˜å‡»ç©¿å¹¶å‘&#34;&gt;3. ç¼“å­˜å‡»ç©¿ï¼ˆå¹¶å‘ï¼‰ &lt;a href=&#34;#3-%e7%bc%93%e5%ad%98%e5%87%bb%e7%a9%bf%e5%b9%b6%e5%8f%91&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä¸€ä¸ªå­˜åœ¨çš„keyï¼Œåœ¨ç¼“å­˜è¿‡æœŸçš„ä¸€åˆ»ï¼ŒåŒæ—¶æœ‰å¤§é‡çš„è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šå‡»ç©¿åˆ°DBï¼Œé€ æˆç¬æ—¶DBè¯·æ±‚é‡å¤§ã€å‹åŠ›éª¤å¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;31è§£å†³åŠæ³•&#34;&gt;3.1è§£å†³åŠæ³• &lt;a href=&#34;#31%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨äº’æ–¥é”ï¼šè®©ä¸€ä¸ªçº¿ç¨‹æ„å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ç­‰å¾…æ„å»ºç¼“å­˜çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œä»æ–°ä»ç¼“å­˜ä¸­è·å–æ•°æ®å°±è¡Œï¼ˆå¦‚ä¸‹å›¾ï¼‰
&lt;img src=&#34;https://abnerxc.github.io/img/redis-b.jpeg&#34; alt=&#34;&#34;&gt;
å¦‚æœæ˜¯å•æœºï¼Œå¯ä»¥ç”¨synchronizeæˆ–è€…lockæ¥å¤„ç†ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼ç¯å¢ƒå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼ˆmemcachedçš„addã€redisçš„setnx,zookeeperçš„æ·»åŠ èŠ‚ç‚¹ï¼‰,å½“ç¼“å­˜æ„å»ºå®Œæˆä»¥åé‡Šæ”¾åˆ†å¸ƒå¼é”&lt;/li&gt;
&lt;li&gt;åå°åˆ·æ–°ï¼šå®šä¹‰ä¸ªJobä¸“é—¨ä¸»åŠ¨åˆ·æ–°ç¼“å­˜ï¼Œæ¯”å¦‚ç¼“å­˜30åˆ†é’Ÿï¼Œé‚£ä¹ˆJobå¯ä»¥è®¾ç½®æ¯éš”29åˆ†é’Ÿå®šæ—¶å°†DBæ•°æ®åˆ·æ–°ç¼“å­˜ä¸­ã€‚&lt;code&gt;è¿™ç§æ–¹æ¡ˆé€‚åˆkeyç›¸å¯¹å›ºå®šï¼Œcacheç²’åº¦è¾ƒå¤§&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥æ›´æ–°ï¼šå°†ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼ˆç»å¯¹æ—¶é—´ï¼‰ä¸€èµ·ä¿å­˜åˆ°ç¼“å­˜ä¸­ï¼ˆå¯ä»¥æ˜¯keyæ‹¼æ¥ï¼Œæˆ–è€…valueä¸­å­˜æ”¾å­—æ®µï¼‰ï¼Œåœ¨æ¯æ¬¡åªéœ€getæ“ä½œä»¥åéƒ½å°†getå‡ºæ¥çš„ç¼“å­˜ä¸å½“å‰ç³»ç»Ÿæ—¶é—´è¿›è¡Œæ¯”è¾ƒï¼Œç¼“å­˜æ—¶é—´-å½“å‰æ—¶é—´&amp;lt;=1åˆ†é’Ÿï¼ˆè‡ªå®šä¹‰æ—¶é—´é˜ˆå€¼ï¼‰ï¼Œåˆ™ä¸»åŠ¨æ›´æ–°ç¼“å­˜&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;4-å¦‚ä½•è§£å†³ç¼“å­˜å•æœºçƒ­ç‚¹é—®é¢˜&#34;&gt;4. å¦‚ä½•è§£å†³ç¼“å­˜å•æœºçƒ­ç‚¹é—®é¢˜ &lt;a href=&#34;#4-%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e7%bc%93%e5%ad%98%e5%8d%95%e6%9c%ba%e7%83%ad%e7%82%b9%e9%97%ae%e9%a2%98&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åˆ†å¸ƒå¼ç¼“å­˜ä¸€è‡´æ€§hashç®—æ³•è§£å†³&lt;br&gt;
&lt;img src=&#34;https://abnerxc.github.io/img/redis-c.jpeg&#34; alt=&#34;&#34;&gt;&lt;br&gt;
ç®€å•æ¦‚è¿°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€è‡´æ€§hashç®—æ³•é€šè¿‡æ„é€ ä¸€ä¸ªé•¿åº¦ä¸º2^32çš„æ•´æ•°ç¯&lt;/li&gt;
&lt;li&gt;æ ¹æ®èŠ‚ç‚¹åï¼ˆæˆ–è€…æœåŠ¡å™¨IPç­‰ä¿¡æ¯ï¼‰çš„hashå€¼å°†ç¼“å­˜æœåŠ¡å™¨èŠ‚ç‚¹æ”¾ç½®åœ¨è¿™ä¸ªç¯ä¸Š&lt;/li&gt;
&lt;li&gt;è®¡ç®—éœ€è¦ç¼“å­˜çš„keyçš„hashå€¼ï¼Œé¡ºæ—¶é’ˆæ‰¾åˆ°æœ€è¿‘çš„çš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå°†æ•°æ®å­˜æ”¾åœ¨è¯¥èŠ‚ç‚¹ä¸Š&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
  </channel>
</rss>
