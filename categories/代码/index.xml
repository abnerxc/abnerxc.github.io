<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ä»£ç  on Abnerçš„åšå®¢</title>
    <link>https://abnerxc.github.io/categories/%E4%BB%A3%E7%A0%81/</link>
    <description>Recent content in ä»£ç  on Abnerçš„åšå®¢</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Mon, 25 Jan 2021 22:07:58 +0800</lastBuildDate><atom:link href="https://abnerxc.github.io/categories/%E4%BB%A3%E7%A0%81/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>HttpClientä½¿ç”¨æŠ€å·§</title>
      <link>https://abnerxc.github.io/note/java-httpclient%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/java-httpclient%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</guid>
      <description>&lt;h2 id=&#34;1-è§„èŒƒèƒŒæ™¯&#34;&gt;1. è§„èŒƒèƒŒæ™¯ &lt;a href=&#34;#1-%e8%a7%84%e8%8c%83%e8%83%8c%e6%99%af&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;11-http-clienté€‰æ‹©&#34;&gt;1.1. http clienté€‰æ‹© &lt;a href=&#34;#11-http-client%e9%80%89%e6%8b%a9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æ— ç‰¹æ®Šæƒ…å†µï¼ˆæ¯”å¦‚ï¼šå•æœºtpsä¸Šåƒï¼‰ï¼Œå»ºè®®é€‰Spring Rest Templateåšé—¨é¢ï¼ŒApache HttpClient 4.xåšå®ç°&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;12-rest-template-è¿è¡Œç¯å¢ƒ&#34;&gt;1.2. rest template è¿è¡Œç¯å¢ƒ &lt;a href=&#34;#12-rest-template-%e8%bf%90%e8%a1%8c%e7%8e%af%e5%a2%83&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;jdk 1.8&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;spring booté¡¹ç›®&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-é…ç½®-rest-template&#34;&gt;2. é…ç½® rest template &lt;a href=&#34;#2-%e9%85%8d%e7%bd%ae-rest-template&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;21-å¼•å…¥jaråŒ…&#34;&gt;2.1. å¼•å…¥jaråŒ… &lt;a href=&#34;#21-%e5%bc%95%e5%85%a5jar%e5%8c%85&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Spring Rest Templateåœ¨spring-webæ¨¡å—ä¸­å†…ç½®äº†ï¼Œspring bootä¼šè‡ªåŠ¨å¸®ä½ å¼•è¿›æ¥ï¼Œå› æ­¤æ— éœ€å†å¼•å…¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¼•å…¥Apache HttpClient 4.xåŒ…:&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.apache.httpcomponents&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;httpclient&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.5.5&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- å¦‚æœä¸é…å¼‚æ­¥ï¼ˆAsyncRestTemplateï¼‰ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸ªä¾èµ– --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;io.netty&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;netty-all&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.1.5.Final&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;22-ç¼–å†™-yml-æ–‡ä»¶é…ç½®å¯é€‰&#34;&gt;2.2. ç¼–å†™ yml æ–‡ä»¶é…ç½®ï¼ˆå¯é€‰ï¼‰ &lt;a href=&#34;#22-%e7%bc%96%e5%86%99-yml-%e6%96%87%e4%bb%b6%e9%85%8d%e7%bd%ae%e5%8f%af%e9%80%89&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# ymlé…ç½®çš„ä¼˜å…ˆçº§é«˜äºjavaé…ç½®ï¼›å¦‚æœymlé…ç½®å’Œjavaé…ç½®åŒæ—¶å­˜åœ¨ï¼Œåˆ™ymlé…ç½®ä¼šè¦†ç›–javaé…ç½®
####restTemplateçš„ymlé…ç½®å¼€å§‹####
spring:
  restTemplate:
    maxTotalConnect: 1000 #è¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°ï¼Œ0ä»£è¡¨ä¸é™ï¼›å¦‚æœå–0ï¼Œéœ€è¦è€ƒè™‘è¿æ¥æ³„éœ²å¯¼è‡´ç³»ç»Ÿå´©æºƒçš„åæœ
    maxConnectPerRoute: 200
    connectTimeout: 3000
    readTimeout: 5000
    charset: UTF-8
####restTemplateçš„ ymlé…ç½®å¼€å§‹####
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;23-ç¼–å†™javaé…ç½®å¿…å¤‡ä¸å¯çœç•¥&#34;&gt;2.3. ç¼–å†™javaé…ç½®ï¼ˆå¿…å¤‡ï¼Œä¸å¯çœç•¥ï¼‰ &lt;a href=&#34;#23-%e7%bc%96%e5%86%99java%e9%85%8d%e7%bd%ae%e5%bf%85%e5%a4%87%e4%b8%8d%e5%8f%af%e7%9c%81%e7%95%a5&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//xxxä»£è¡¨ä½ çš„é¡¹ç›®ï¼Œä¾‹å¦‚ï¼š
//com.douyu.wsd.adx.gateway.config
//com.douyu.wsd.venus.config
//å¯ä»¥å†™ä¸€çº§ï¼Œä¹Ÿå¯ä»¥å†™å¤šçº§ï¼Œå…·ä½“è‡ªå·±éšæ„
package com.douyu.wsd.xxx.config;



import java.nio.charset.Charset;
import java.util.LinkedList;
import java.util.List;

import org.apache.http.Header;
import org.apache.http.client.HttpRequestRetryHandler;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.DefaultHttpRequestRetryHandler;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.impl.conn.PoolingHttpClientConnectionManager;
import org.apache.http.message.BasicHeader;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.client.ClientHttpRequestFactory;
import org.springframework.http.client.HttpComponentsClientHttpRequestFactory;
import org.springframework.http.client.Netty4ClientHttpRequestFactory;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.http.converter.StringHttpMessageConverter;
import org.springframework.web.client.AsyncRestTemplate;
import org.springframework.web.client.DefaultResponseErrorHandler;
import org.springframework.web.client.RestTemplate;

@Configuration
@ConfigurationProperties(prefix = &amp;#34;spring.restTemplate&amp;#34;)
@ConditionalOnClass(value = {RestTemplate.class, CloseableHttpClient.class})
public class RestTemplateConfiguration {

    // javaé…ç½®çš„ä¼˜å…ˆçº§ä½äºymlé…ç½®ï¼›å¦‚æœymlé…ç½®ä¸å­˜åœ¨ï¼Œä¼šé‡‡ç”¨javaé…ç½®
    // ####restTemplateçš„ javaé…ç½®å¼€å§‹####

    private int maxTotalConnection = 500; //è¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°

    private int maxConnectionPerRoute = 100; //åŒè·¯ç”±çš„å¹¶å‘æ•°

    private int connectionTimeout = 2 * 1000; //è¿æ¥è¶…æ—¶ï¼Œé»˜è®¤2s

    private int readTimeout = 30 * 1000; //è¯»å–è¶…æ—¶ï¼Œé»˜è®¤30s

    private String charset = &amp;#34;UTF-8&amp;#34;;

    // ####restTemplateçš„ javaé…ç½®ç»“æŸ####

    public void setMaxTotalConnection(int maxTotalConnection) {
        this.maxTotalConnection = maxTotalConnection;
    }

    public void setMaxConnectionPerRoute(int maxConnectionPerRoute) {
        this.maxConnectionPerRoute = maxConnectionPerRoute;
    }

    public void setConnectionTimeout(int connectionTimeout) {
        this.connectionTimeout = connectionTimeout;
    }

    public void setReadTimeout(int readTimeout) {
        this.readTimeout = readTimeout;
    }

    public void setCharset(String charset) {
        this.charset = charset;
    }

    //åˆ›å»ºHTTPå®¢æˆ·ç«¯å·¥å‚
    @Bean(name = &amp;#34;clientHttpRequestFactory&amp;#34;)
    public ClientHttpRequestFactory clientHttpRequestFactory() {
        return createClientHttpRequestFactory(this.connectionTimeout, this.readTimeout);
    }

    //åˆå§‹åŒ–RestTemplate,å¹¶åŠ å…¥springçš„Beanå·¥å‚ï¼Œç”±springç»Ÿä¸€ç®¡ç†
    @Bean(name = &amp;#34;restTemplate&amp;#34;)
    @ConditionalOnMissingBean(RestTemplate.class)
    public RestTemplate restTemplate(ClientHttpRequestFactory factory) {
        return createRestTemplate(factory);
    }

    //åˆå§‹åŒ–æ”¯æŒå¼‚æ­¥çš„RestTemplate,å¹¶åŠ å…¥springçš„Beanå·¥å‚ï¼Œç”±springç»Ÿä¸€ç®¡ç†
    //å¦‚æœä½ ç”¨ä¸åˆ°å¼‚æ­¥ï¼Œåˆ™æ— é¡»åˆ›å»ºè¯¥å¯¹è±¡
    @Bean(name = &amp;#34;asyncRestTemplate&amp;#34;)
    @ConditionalOnMissingBean(AsyncRestTemplate.class)
    public AsyncRestTemplate asyncRestTemplate(RestTemplate restTemplate) {
        final Netty4ClientHttpRequestFactory factory = new Netty4ClientHttpRequestFactory();
        factory.setConnectTimeout(this.connectionTimeout);
        factory.setReadTimeout(this.readTimeout);
        return new AsyncRestTemplate(factory, restTemplate);
    }

    private ClientHttpRequestFactory createClientHttpRequestFactory(int connectionTimeout, int readTimeout) {
        //maxTotalConnection å’Œ maxConnectionPerRoute å¿…é¡»è¦é…
        if (this.maxTotalConnection &amp;lt;= 0) {
            throw new IllegalArgumentException(&amp;#34;invalid maxTotalConnection: &amp;#34; + maxTotalConnection);
        }
        if (this.maxConnectionPerRoute &amp;lt;= 0) {
            throw new IllegalArgumentException(&amp;#34;invalid maxConnectionPerRoute: &amp;#34; + maxTotalConnection);
        }

        //å…¨å±€é»˜è®¤çš„headerå¤´é…ç½®
        List&amp;lt;Header&amp;gt; headers = new LinkedList&amp;lt;&amp;gt;();
        headers.add(new BasicHeader(&amp;#34;Accept-Encoding&amp;#34;, &amp;#34;gzip,deflate&amp;#34;));
        headers.add(new BasicHeader(&amp;#34;Accept-Language&amp;#34;, &amp;#34;zh-CN,zh;q=0.8,en;q=0.6&amp;#34;));

        //ç¦ç”¨è‡ªåŠ¨é‡è¯•ï¼Œéœ€è¦é‡è¯•æ—¶ï¼Œè¯·è‡ªè¡Œæ§åˆ¶
        HttpRequestRetryHandler retryHandler = new DefaultHttpRequestRetryHandler(0, false);

        PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager();
        cm.setMaxTotal(maxTotalConnection);
        cm.setDefaultMaxPerRoute(maxConnectionPerRoute);

        //åˆ›å»ºçœŸæ­£å¤„ç†httpè¯·æ±‚çš„httpClientå®ä¾‹
        CloseableHttpClient httpClient = HttpClients.custom()
                .setDefaultHeaders(headers)
                .setRetryHandler(retryHandler)
                .setConnectionManager(cm)
                .build();

        HttpComponentsClientHttpRequestFactory factory = new HttpComponentsClientHttpRequestFactory(
                httpClient);
        factory.setConnectTimeout(connectionTimeout);
        factory.setReadTimeout(readTimeout);
        return factory;
    }

    private RestTemplate createRestTemplate(ClientHttpRequestFactory factory) {
        RestTemplate restTemplate = new RestTemplate(factory);

        //æˆ‘ä»¬é‡‡ç”¨RestTemplateå†…éƒ¨çš„MessageConverter
        //é‡æ–°è®¾ç½®StringHttpMessageConverterå­—ç¬¦é›†ï¼Œè§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜
        modifyDefaultCharset(restTemplate);

        //è®¾ç½®é”™è¯¯å¤„ç†å™¨
        restTemplate.setErrorHandler(new DefaultResponseErrorHandler());

        return restTemplate;
    }

    private void modifyDefaultCharset(RestTemplate restTemplate) {
        List&amp;lt;HttpMessageConverter&amp;lt;?&amp;gt;&amp;gt; converterList = restTemplate.getMessageConverters();
        HttpMessageConverter&amp;lt;?&amp;gt; converterTarget = null;
        for (HttpMessageConverter&amp;lt;?&amp;gt; item : converterList) {
            if (StringHttpMessageConverter.class == item.getClass()) {
                converterTarget = item;
                break;
            }
        }
        if (null != converterTarget) {
            converterList.remove(converterTarget);
        }
        Charset defaultCharset = Charset.forName(charset);
        converterList.add(1, new StringHttpMessageConverter(defaultCharset));
    }

}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åšå®Œä¸Šè¿°é…ç½®ï¼Œå°±ç”Ÿæˆäº†å¯ç”¨çš„RestTemplateå®ä¾‹&lt;/p&gt;
&lt;p&gt;é‡‡ç”¨ä¸Šè¿°é…ç½®ï¼Œå¯ä»¥åšåˆ°å¼€ç®±å³ç”¨ï¼›è‡ªå·±é…ï¼Œå¯èƒ½ä¼šè¸©äº›å‘ï¼Œæ¯”å¦‚ï¼š&lt;a href=&#34;http://doc.dz11.com/ddse/preview/share/9c0f4c855b09e2b1cf33?sid=187&#34;&gt;spring boot é…ç½®æŠ€å·§&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;3-rest-templateåŸºæœ¬ç”¨æ³•&#34;&gt;3. rest templateåŸºæœ¬ç”¨æ³• &lt;a href=&#34;#3-rest-template%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;31-getæ¼”ç¤º&#34;&gt;3.1. getæ¼”ç¤º &lt;a href=&#34;#31-get%e6%bc%94%e7%a4%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ¼”ç¤ºä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.lang.StringUtils;

import java.net.URLEncoder;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.AsyncRestTemplate;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @Resource
    private AsyncRestTemplate asyncRestTemplate;

    //æœ€ç®€å•çš„getæ“ä½œ
    @RequestMapping(&amp;#34;/get&amp;#34;)
    public String testGet(String keyword) throws Exception {
        String kw = StringUtils.defaultString(URLEncoder.encode(keyword, &amp;#34;UTF-8&amp;#34;));
        String html = restTemplate.getForObject(&amp;#34;https://www.douyu.com/search/?kw=&amp;#34; + kw, String.class);
        return html;//è¿”å›çš„æ˜¯æ–—é±¼ä¸»ç«™çš„html
    }

    //éœ€è¦è‡ªå®šä¹‰headerå¤´çš„getæ“ä½œ
    @RequestMapping(&amp;#34;/get2&amp;#34;)
    public String testGet2(String keyword) throws Exception {
        HttpHeaders headers = new HttpHeaders();
        headers.set(&amp;#34;MyHeaderKey&amp;#34;, &amp;#34;MyHeaderValue&amp;#34;);
        HttpEntity entity = new HttpEntity(headers);

        String kw = StringUtils.defaultString(URLEncoder.encode(keyword, &amp;#34;UTF-8&amp;#34;));
        ResponseEntity&amp;lt;String&amp;gt; response = restTemplate.exchange(&amp;#34;https://www.douyu.com/search/?kw=&amp;#34; + kw, HttpMethod.GET, entity, String.class);
        return response.getBody();//è¿”å›çš„æ˜¯æ–—é±¼ä¸»ç«™çš„html
    }
    
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;32-postè¡¨å•æ¼”ç¤º&#34;&gt;3.2. postè¡¨å•æ¼”ç¤º &lt;a href=&#34;#32-post%e8%a1%a8%e5%8d%95%e6%bc%94%e7%a4%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ¼”ç¤ºä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;

import javax.annotation.Resource;

import com.google.common.collect.ImmutableMap;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/postForm&amp;#34;)
    public String testPostForm(String posid) throws Exception {//æµ‹è¯•ç”¨ä¾‹ï¼šposid=804009
        String url = &amp;#34;http://www.douyu.com/lapi/sign/app/getinfo?aid=android1&amp;amp;client_sys=android&amp;amp;mdid=phone&amp;amp;time=1524495658&amp;amp;token=&amp;amp;auth=789c4f732d6aa4d0a5c8fb33765af8cf&amp;#34;;
        MultiValueMap&amp;lt;String, String&amp;gt; form = new LinkedMultiValueMap&amp;lt;String, String&amp;gt;();
        form.add(&amp;#34;app&amp;#34;, &amp;#34;{\&amp;#34;aname\&amp;#34;:\&amp;#34;æ–—é±¼ç›´æ’­\&amp;#34;,\&amp;#34;pname\&amp;#34;:\&amp;#34;air.tv.douyu.android\&amp;#34;}&amp;#34;);
        form.add(&amp;#34;mdid&amp;#34;, &amp;#34;phone&amp;#34;);
        form.add(&amp;#34;cate1&amp;#34;, &amp;#34;0&amp;#34;);
        form.add(&amp;#34;client_sys&amp;#34;, &amp;#34;ios&amp;#34;);
        form.add(&amp;#34;cate2&amp;#34;, &amp;#34;0&amp;#34;);
        form.add(&amp;#34;auth&amp;#34;, &amp;#34;789c4f732d6aa4d0a5c8fb33765af8cf&amp;#34;);
        form.add(&amp;#34;roomid&amp;#34;, &amp;#34;0&amp;#34;);
        form.add(&amp;#34;posid&amp;#34;, posid);
        form.add(&amp;#34;imei&amp;#34;, &amp;#34;863254010282712&amp;#34;);

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
        //headers.add(&amp;#34;xx&amp;#34;, &amp;#34;yy&amp;#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&amp;lt;MultiValueMap&amp;lt;String, String&amp;gt;&amp;gt; formEntity = new HttpEntity&amp;lt;&amp;gt;(form, headers);
        String json = restTemplate.postForObject(url, formEntity, String.class);
        return json;//è¿”å›çš„æ˜¯å¹¿å‘Šapiçš„json
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;33-postè¯·æ±‚ä½“æ¼”ç¤º&#34;&gt;3.3. postè¯·æ±‚ä½“æ¼”ç¤º &lt;a href=&#34;#33-post%e8%af%b7%e6%b1%82%e4%bd%93%e6%bc%94%e7%a4%ba&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ¼”ç¤ºä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/postBody&amp;#34;)
    public String testPostBody() throws Exception {
        String url = &amp;#34;https://venus.dz11.com/venus/release/pc/checkUpdate&amp;#34;;
        String jsonBody = &amp;#34;{\n&amp;#34;
                + &amp;#34;    \&amp;#34;channelCode\&amp;#34;: \&amp;#34;official\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;appCode\&amp;#34;: \&amp;#34;Douyu_Live_PC_Client\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;versionCode\&amp;#34;: \&amp;#34;201804121\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;versionName\&amp;#34;: \&amp;#34;V5.1.9\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;deviceUid\&amp;#34;: \&amp;#34;02-15-03-59-5C-E2\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;deviceResolution\&amp;#34;: \&amp;#34;1920*1080\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;token\&amp;#34;: \&amp;#34;token\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;webView\&amp;#34;: \&amp;#34;\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;osInfo\&amp;#34;: \&amp;#34;10.0\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;osType\&amp;#34;: \&amp;#34;64\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;cpuInfo\&amp;#34;:\n&amp;#34;
                + &amp;#34;    {\n&amp;#34;
                + &amp;#34;        \&amp;#34;OemId\&amp;#34;: \&amp;#34;0\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorArchitecture\&amp;#34;: \&amp;#34;0\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;PageSize\&amp;#34;: \&amp;#34;4096\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;MinimumApplicationAddress\&amp;#34;: \&amp;#34;00010000\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;MaximumApplicationAddress\&amp;#34;: \&amp;#34;7FFEFFFF\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ActiveProcessorMask\&amp;#34;: \&amp;#34;15\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;NumberOfProcessors\&amp;#34;: \&amp;#34;4\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorType\&amp;#34;: \&amp;#34;586\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;AllocationGranularity\&amp;#34;: \&amp;#34;65536\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorLevel\&amp;#34;: \&amp;#34;6\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorRevision\&amp;#34;: \&amp;#34;40457\&amp;#34;\n&amp;#34;
                + &amp;#34;    },\n&amp;#34;
                + &amp;#34;    \&amp;#34;diskInfo\&amp;#34;: \&amp;#34;931.507GB\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;memoryInfo\&amp;#34;: \&amp;#34;15.8906GB\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;driveInfo\&amp;#34;: \&amp;#34;Intel(R) HD Graphics 630:23.20.16.4973;\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;startTime\&amp;#34;: \&amp;#34;-501420357\&amp;#34;\n&amp;#34;
                + &amp;#34;}\n&amp;#34;;

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        //headers.add(&amp;#34;xx&amp;#34;, &amp;#34;yy&amp;#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&amp;lt;String&amp;gt; bodyEntity = new HttpEntity&amp;lt;&amp;gt;(jsonBody, headers);
        
        //1.ç›´æ¥æ‹¿åŸå§‹jsonä¸²
        String json = restTemplate.postForObject(url, bodyEntity, String.class);
        
        //2.å°†åŸå§‹çš„jsonä¼ è½¬æˆjavaå¯¹è±¡ï¼Œrest templateå¯ä»¥è‡ªåŠ¨å®Œæˆ
        ResultVo resultVo = restTemplate.postForObject(url, bodyEntity, ResultVo.class);
        if (resultVo != null &amp;amp;&amp;amp; resultVo.success()) {
            Object res = resultVo.getData();//dataèŠ‚ç‚¹çš„å®é™…ç±»å‹æ˜¯java.util.LinkedHashMap
            logger.info(&amp;#34;å¤„ç†æˆåŠŸï¼Œè¿”å›æ•°æ®: {}&amp;#34;, resultVo.getData());
        } else {
            logger.info(&amp;#34;å¤„ç†å¤±è´¥ï¼Œå“åº”ç»“æœ: {}&amp;#34;, resultVo);
        }

        return json;//è¿”å›çš„æ˜¯åˆ†åŒ…apiçš„json
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;34-postæ–‡ä»¶ä¸Šä¼ &#34;&gt;3.4. postæ–‡ä»¶ä¸Šä¼  &lt;a href=&#34;#34-post%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;åœºæ™¯è¯´æ˜ï¼šåªé€‚åˆå°æ–‡ä»¶ï¼ˆ20MBä»¥å†…ï¼‰ä¸Šä¼ &lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æ¼”ç¤ºä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.codec.CodecUtils;
import com.douyu.wsd.framework.common.lang.StringUtils;

import java.io.File;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.core.io.FileSystemResource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/postFile&amp;#34;)
    public String testPostBody() throws Exception {
        String filePath = &amp;#34;D:/config.png&amp;#34;;
        
        //é€šè¿‡ç£ç›˜æ–‡ä»¶ä¸Šä¼ ï¼Œå¦‚æœäº§ç”Ÿäº†ä¸´æ—¶æ–‡ä»¶ï¼Œä¸€å®šè¦è®°å¾—åˆ é™¤ï¼Œå¦åˆ™ï¼Œä¸´æ—¶æ–‡ä»¶è¶Šç§¯è¶Šå¤šï¼Œç£ç›˜ä¼šçˆ†
        FileSystemResource resource = new FileSystemResource(new File(filePath));
	
        String url = &amp;#34;http://dev.resuploader.dz11.com/Resource/Dss/put&amp;#34;;
        String appId = &amp;#34;***&amp;#34;;//æµ‹è¯•çš„æ—¶å€™æ¢æˆè‡ªå·±çš„é…ç½®
        String secureKey = &amp;#34;***&amp;#34;;
        String time = String.valueOf(System.currentTimeMillis());
        String pubStr = &amp;#34;1&amp;#34;;
        String tempStr = String.format(&amp;#34;app_id=%s&amp;amp;is_public=%s&amp;amp;time=%s&amp;amp;vframe=0%s&amp;#34;, appId, pubStr, time, secureKey);
        MultiValueMap&amp;lt;String, Object&amp;gt; form = new LinkedMultiValueMap&amp;lt;&amp;gt;();
        form.add(&amp;#34;is_public&amp;#34;, pubStr);
        form.add(&amp;#34;vframe&amp;#34;, &amp;#34;0&amp;#34;);
        form.add(&amp;#34;file&amp;#34;, resource);
        form.add(&amp;#34;app_id&amp;#34;, appId);
        form.add(&amp;#34;time&amp;#34;, time);
        form.add(&amp;#34;sign&amp;#34;, CodecUtils.md5(tempStr));

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.MULTIPART_FORM_DATA);
        //headers.add(&amp;#34;xx&amp;#34;, &amp;#34;yy&amp;#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&amp;lt;MultiValueMap&amp;lt;String, Object&amp;gt;&amp;gt; formEntity = new HttpEntity&amp;lt;&amp;gt;(form, headers);
        String json = restTemplate.postForObject(url, formEntity, String.class);
        return json;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;35-æ–‡ä»¶ä¸‹è½½&#34;&gt;3.5. æ–‡ä»¶ä¸‹è½½ &lt;a href=&#34;#35-%e6%96%87%e4%bb%b6%e4%b8%8b%e8%bd%bd&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;åœºæ™¯è¯´æ˜ï¼šåªé€‚åˆå°æ–‡ä»¶ï¼ˆ10MBä»¥å†…ï¼‰ä¸‹è½½&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æ¼”ç¤ºä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.lang.StringUtils;

import java.io.IOException;
import java.io.InputStream;
import java.net.URLEncoder;
import java.util.Collections;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.springframework.core.io.InputStreamResource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/downloadFile&amp;#34;)
    public ResponseEntity testDownloadFile() throws Exception {
        String url = &amp;#34;http://editor.baidu.com/editor/download/BaiduEditor(Online)_5-9-16.exe&amp;#34;;
        HttpHeaders headers = new HttpHeaders();
        headers.setAccept(Collections.singletonList(MediaType.APPLICATION_OCTET_STREAM));
        HttpEntity&amp;lt;String&amp;gt; entity = new HttpEntity&amp;lt;&amp;gt;(headers);
        ResponseEntity&amp;lt;byte[]&amp;gt; response = restTemplate.exchange(url, HttpMethod.GET, entity, byte[].class);
        byte[] bytes = response.getBody();
        long contentLength = bytes != null ? bytes.length : 0;
        headers.setContentLength((int) contentLength);
        headers.setContentDispositionFormData(&amp;#34;baidu.exe&amp;#34;, URLEncoder.encode(&amp;#34;ç™¾åº¦å®‰è£…åŒ….exe&amp;#34;, &amp;#34;UTF-8&amp;#34;));
        return new ResponseEntity&amp;lt;&amp;gt;(response.getBody(), headers, HttpStatus.OK);
    }   
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;36-æ›´å¤šapi&#34;&gt;3.6. æ›´å¤šAPI &lt;a href=&#34;#36-%e6%9b%b4%e5%a4%9aapi&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;h4 id=&#34;361--resttemplate-api-ä¸httpåŠ¨è¯çš„å¯¹è±¡å…³ç³»&#34;&gt;3.6.1.  RestTemplate API ä¸httpåŠ¨è¯çš„å¯¹è±¡å…³ç³»ï¼š &lt;a href=&#34;#361--resttemplate-api-%e4%b8%8ehttp%e5%8a%a8%e8%af%8d%e7%9a%84%e5%af%b9%e8%b1%a1%e5%85%b3%e7%b3%bb&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;| HTTPåŠ¨è¯  | å¯¹åº”çš„RestTemplate API   |
| ++++++-  |:++++++++++++-: |
|DELETE|	delete(String, String&amp;hellip;)
|GET|	getForObject(String, Class, String&amp;hellip;)
|HEAD|	headForHeaders(String, String&amp;hellip;)
|OPTIONS|	optionsForAllow(String, String&amp;hellip;)
|POST|	postForLocation(String, Object, String&amp;hellip;)
|PUT|	put(String, Object, String&amp;hellip;)&lt;/p&gt;
&lt;h4 id=&#34;362--postgetforentity-api-å’Œ-postgetforobject-çš„åŒºåˆ«&#34;&gt;3.6.2.  (post|get)ForEntity API å’Œ (post|get)ForObject çš„åŒºåˆ« &lt;a href=&#34;#362--postgetforentity-api-%e5%92%8c-postgetforobject-%e7%9a%84%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;ForEntity APIæ‹¿åˆ°çš„æ˜¯ResponseEntityï¼Œé€šè¿‡ResponseEntityå¯ä»¥æ‹¿åˆ°çŠ¶æ€ç ï¼Œresponse headerç­‰ä¿¡æ¯

ForObject APIæ‹¿åˆ°çš„æ˜¯javaå¯¹è±¡ï¼Œç”¨åœ¨ä¸å…³å¿ƒresponseçŠ¶æ€ç å’Œheaderçš„åœºåˆä¸­
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;363-getxxxpostxxx-å’Œ-exchange-æ–¹æ³•çš„åŒºåˆ«&#34;&gt;3.6.3. getXXXã€postXXX å’Œ exchange æ–¹æ³•çš„åŒºåˆ« &lt;a href=&#34;#363-getxxxpostxxx-%e5%92%8c-exchange-%e6%96%b9%e6%b3%95%e7%9a%84%e5%8c%ba%e5%88%ab&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;getXXXã€postXXX ç”¨äºæ¯”è¾ƒç®€å•çš„è°ƒç”¨

exchange ç”¨äºæ¯”è¾ƒå¤æ‚çš„è°ƒç”¨
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;4-rest-templateé«˜é˜¶ç”¨æ³•&#34;&gt;4. rest templateé«˜é˜¶ç”¨æ³• &lt;a href=&#34;#4-rest-template%e9%ab%98%e9%98%b6%e7%94%a8%e6%b3%95&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;41-å¸¦æ³›å‹çš„å“åº”è§£ç &#34;&gt;4.1. å¸¦æ³›å‹çš„å“åº”è§£ç  &lt;a href=&#34;#41-%e5%b8%a6%e6%b3%9b%e5%9e%8b%e7%9a%84%e5%93%8d%e5%ba%94%e8%a7%a3%e7%a0%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    private static final Logger logger = LoggerFactory.getLogger(TestController.class);

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/postBody&amp;#34;)
    public String testPostBody() throws Exception {//æµ‹è¯•ç”¨ä¾‹ï¼šposid=804009
        String url = &amp;#34;https://venus.dz11.com/venus/release/pc/checkUpdate&amp;#34;;
        String jsonBody = &amp;#34;{\n&amp;#34;
                + &amp;#34;    \&amp;#34;channelCode\&amp;#34;: \&amp;#34;official\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;appCode\&amp;#34;: \&amp;#34;Douyu_Live_PC_Client\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;versionCode\&amp;#34;: \&amp;#34;201804121\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;versionName\&amp;#34;: \&amp;#34;V5.1.9\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;deviceUid\&amp;#34;: \&amp;#34;02-15-03-59-5C-E2\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;deviceResolution\&amp;#34;: \&amp;#34;1920*1080\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;token\&amp;#34;: \&amp;#34;token\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;webView\&amp;#34;: \&amp;#34;\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;osInfo\&amp;#34;: \&amp;#34;10.0\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;osType\&amp;#34;: \&amp;#34;64\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;cpuInfo\&amp;#34;:\n&amp;#34;
                + &amp;#34;    {\n&amp;#34;
                + &amp;#34;        \&amp;#34;OemId\&amp;#34;: \&amp;#34;0\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorArchitecture\&amp;#34;: \&amp;#34;0\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;PageSize\&amp;#34;: \&amp;#34;4096\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;MinimumApplicationAddress\&amp;#34;: \&amp;#34;00010000\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;MaximumApplicationAddress\&amp;#34;: \&amp;#34;7FFEFFFF\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ActiveProcessorMask\&amp;#34;: \&amp;#34;15\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;NumberOfProcessors\&amp;#34;: \&amp;#34;4\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorType\&amp;#34;: \&amp;#34;586\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;AllocationGranularity\&amp;#34;: \&amp;#34;65536\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorLevel\&amp;#34;: \&amp;#34;6\&amp;#34;,\n&amp;#34;
                + &amp;#34;        \&amp;#34;ProcessorRevision\&amp;#34;: \&amp;#34;40457\&amp;#34;\n&amp;#34;
                + &amp;#34;    },\n&amp;#34;
                + &amp;#34;    \&amp;#34;diskInfo\&amp;#34;: \&amp;#34;931.507GB\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;memoryInfo\&amp;#34;: \&amp;#34;15.8906GB\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;driveInfo\&amp;#34;: \&amp;#34;Intel(R) HD Graphics 630:23.20.16.4973;\&amp;#34;,\n&amp;#34;
                + &amp;#34;    \&amp;#34;startTime\&amp;#34;: \&amp;#34;-501420357\&amp;#34;\n&amp;#34;
                + &amp;#34;}\n&amp;#34;;

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        HttpEntity&amp;lt;String&amp;gt; bodyEntity = new HttpEntity&amp;lt;&amp;gt;(jsonBody, headers);
        
        //1. ç›´æ¥æ‹¿åŸå§‹çš„jsonä¸²
        String json = restTemplate.postForObject(url, bodyEntity, String.class);

        //2. å°†åŸå§‹jsonä¼ è½¬javaå¯¹è±¡ï¼Œè·Ÿä¸Šæ–‡ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªjavaå¯¹è±¡é‡Œé¢æœ‰æ³›å‹ï¼ˆResultVo&amp;lt;PcUpdateRes&amp;gt;ï¼‰
        //å¤§å®¶å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼ŒæŠŠResultVo&amp;lt;PcUpdateRes&amp;gt;æ¢æˆè‡ªå·±çš„ç±»ï¼Œæ¯”å¦‚ï¼šList&amp;lt;MemberInfo&amp;gt;
        ResponseEntity&amp;lt;ResultVo&amp;lt;PcUpdateRes&amp;gt;&amp;gt; response = restTemplate
                .exchange(url, HttpMethod.POST, bodyEntity, new ParameterizedTypeReference&amp;lt;ResultVo&amp;lt;PcUpdateRes&amp;gt;&amp;gt;() {});
        if (response.getStatusCode().is2xxSuccessful() &amp;amp;&amp;amp; response.getBody() != null &amp;amp;&amp;amp; response.getBody().success()) {
            ResultVo&amp;lt;PcUpdateRes data = &amp;gt; resultVo = response.getBody();
            PcUpdateRes data = resultVo.getData();
            logger.info(&amp;#34;å¤„ç†æˆåŠŸï¼Œè¿”å›æ•°æ®: {}&amp;#34;, data);
        } else {
            logger.info(&amp;#34;å¤„ç†å¤±è´¥ï¼Œå“åº”ç»“æœ: {}&amp;#34;, response);
        }

        return json;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;42-ä¸Šä¼ æ–‡ä»¶æµ&#34;&gt;4.2. ä¸Šä¼ æ–‡ä»¶æµ &lt;a href=&#34;#42-%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6%e6%b5%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.codec.CodecUtils;
import com.douyu.wsd.framework.common.io.IOUtils;
import com.douyu.wsd.framework.common.lang.StringUtils;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.core.io.InputStreamResource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&amp;#34;/postFile&amp;#34;)
    public String testPostBody() throws Exception {
        String filePath = &amp;#34;D:/config.png&amp;#34;;
        MultipartFileResource resource = new MultipartFileResource(new FileInputStream(new File(filePath)), &amp;#34;config.png&amp;#34;);
        String url = &amp;#34;http://dev.resuploader.dz11.com/Resource/Dss/put&amp;#34;;
        String appId = &amp;#34;***&amp;#34;;//æµ‹è¯•çš„æ—¶å€™æ¢æˆè‡ªå·±çš„é…ç½®
        String secureKey = &amp;#34;***&amp;#34;;
        String time = String.valueOf(System.currentTimeMillis());
        String pubStr = &amp;#34;1&amp;#34;;
        String tempStr = String.format(&amp;#34;app_id=%s&amp;amp;is_public=%s&amp;amp;time=%s&amp;amp;vframe=0%s&amp;#34;, appId, pubStr, time, secureKey);
        MultiValueMap&amp;lt;String, Object&amp;gt; form = new LinkedMultiValueMap&amp;lt;&amp;gt;();
        form.add(&amp;#34;is_public&amp;#34;, pubStr);
        form.add(&amp;#34;vframe&amp;#34;, &amp;#34;0&amp;#34;);
        form.add(&amp;#34;file&amp;#34;, resource);
        form.add(&amp;#34;app_id&amp;#34;, appId);
        form.add(&amp;#34;time&amp;#34;, time);
        form.add(&amp;#34;sign&amp;#34;, CodecUtils.md5(tempStr));

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.MULTIPART_FORM_DATA);
        //headers.add(&amp;#34;xx&amp;#34;, &amp;#34;yy&amp;#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&amp;lt;MultiValueMap&amp;lt;String, Object&amp;gt;&amp;gt; formEntity = new HttpEntity&amp;lt;&amp;gt;(form, headers);
        String json = restTemplate.postForObject(url, formEntity, String.class);
        return json;
    }

    private class MultipartFileResource extends InputStreamResource {

        private String filename;

        public MultipartFileResource(InputStream inputStream, String filename) {
            super(inputStream);
            this.filename = filename;
        }

        @Override
        public String getFilename() {
            return this.filename;
        }

        @Override
        public long contentLength() throws IOException {
            return -1; // we do not want to generally read the whole stream into memory ...
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;43-å¼‚æ­¥æ“ä½œ&#34;&gt;4.3 å¼‚æ­¥æ“ä½œ &lt;a href=&#34;#43-%e5%bc%82%e6%ad%a5%e6%93%8d%e4%bd%9c&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;AsyncRestTemplate å¯æ”¯æŒå¼‚æ­¥ï¼Œä¸åŒæ­¥APIåŸºæœ¬ä¸€è‡´ï¼Œè¿”å›çš„æ˜¯future:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.TimeUnit;
import javax.annotation.Resource;

import org.springframework.http.ResponseEntity;
import org.springframework.util.concurrent.ListenableFuture;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.AsyncRestTemplate;

@RestController
public class TestController {

    @Resource
    private AsyncRestTemplate asyncRestTemplate;

    @RequestMapping(&amp;#34;/douyu&amp;#34;)
    public String douyu() throws Exception {
        ListenableFuture&amp;lt;ResponseEntity&amp;lt;String&amp;gt;&amp;gt; future = asyncRestTemplate
                .getForEntity(&amp;#34;http://www.douyu.com&amp;#34;, String.class);
        return future.get(2 * 1000, TimeUnit.SECONDS).getBody();
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;44-ä¸åŒçš„è¶…æ—¶æ—¶é—´&#34;&gt;4.4. ä¸åŒçš„è¶…æ—¶æ—¶é—´ &lt;a href=&#34;#44-%e4%b8%8d%e5%90%8c%e7%9a%84%e8%b6%85%e6%97%b6%e6%97%b6%e9%97%b4&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;å‡å¦‚æˆ‘ç¢°åˆ°è¿™ç§åœºæ™¯ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ServiceA | 10s

ServiceB | 25s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ‰3ä¸ªå¥—è·¯å¯è§£å†³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¥—è·¯ä¸€ï¼Œåˆ›å»ºå¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹æœ‰è‡ªå·±çš„è¶…æ—¶æ—¶é—´ï¼Œæ¯”å¦‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    // è¶…æ—¶æ—¶é—´çŸ­çš„å®ä¾‹
    @Bean(name = &amp;#34;clientHttpRequestFactoryA&amp;#34;)
    public ClientHttpRequestFactory clientHttpRequestFactoryA() {
        return createClientHttpRequestFactory(2*1000, 10*1000);
    }

    @Bean(name = &amp;#34;restTemplateA&amp;#34;)
    @ConditionalOnMissingBean(RestTemplate.class)
    public RestTemplate restTemplateA() {
        return createRestTemplate(clientHttpRequestFactoryA());
    }
    
    // è¶…æ—¶æ—¶é—´é•¿çš„å®ä¾‹
    @Bean(name = &amp;#34;clientHttpRequestFactoryB&amp;#34;)
    public ClientHttpRequestFactory clientHttpRequestFactoryB() {
        return createClientHttpRequestFactory(5*1000, 25*1000);
    }

    @Bean(name = &amp;#34;restTemplateB&amp;#34;)
    @ConditionalOnMissingBean(RestTemplate.class)
    public RestTemplate restTemplateB() {
        return createRestTemplate(clientHttpRequestFactoryB());
    }
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å¥—è·¯äºŒï¼ŒAsyncRestTemplate&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ListenableFuture&amp;lt;ResponseEntity&amp;lt;String&amp;gt;&amp;gt; future = asyncRestTemplate
                .getForEntity(&amp;#34;http://www.douyu.com&amp;#34;, String.class);
return future.get(2 * 1000, TimeUnit.SECONDS).getBody();
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;å¥—è·¯ä¸‰ï¼Œä¸Š&lt;a href=&#34;https://spring.io/guides/gs/circuit-breaker/&#34;&gt; Circuit Breaker&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;@EnableCircuitBreaker
public class MyApp {
    public static void main(String[] args) {
        SpringApplication.run(MyApp .class, args);
    }
}

@Service
public class MyService {
    private final RestTemplate restTemplate;

    public BookService(RestTemplate rest) {
        this.restTemplate = rest;
    }

    @HystrixCommand(
        fallbackMethod = &amp;#34;fooMethodFallback&amp;#34;,
        commandProperties = { 
            @HystrixProperty(
                 name = &amp;#34;execution.isolation.thread.timeoutInMilliseconds&amp;#34;, 
                 value=&amp;#34;5000&amp;#34;
            )
        }
    )
    public String fooMethod() {
        // Your logic here.
        restTemplate.exchange(...); 
    }

    public String fooMethodFallback(Throwable t) {
        log.error(&amp;#34;Fallback happened&amp;#34;, t);
        return &amp;#34;Sensible Default Here!&amp;#34;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;45-å¦‚ä½•è®¾ç½®è¿æ¥æ± &#34;&gt;4.5. å¦‚ä½•è®¾ç½®è¿æ¥æ±  &lt;a href=&#34;#45-%e5%a6%82%e4%bd%95%e8%ae%be%e7%bd%ae%e8%bf%9e%e6%8e%a5%e6%b1%a0&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;è¿æ¥æ± éœ€è¦æœåŠ¡ç«¯æ”¯æŒé•¿è¿æ¥ï¼Œå¹¶éæ‰€æœ‰æœåŠ¡ç«¯éƒ½æ”¯æŒï¼Œå› æ­¤å•ç‹¬å¼€äº†ç¯‡æ–‡ç« ï¼š&lt;a href=&#34;http://doc.dz11.com/ddse/preview/space/14816?sid=29&amp;amp;pid=12940&#34;&gt;RestTemplateå¦‚ä½•é…ç½®é•¿è¿æ¥&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;46-å…¨å±€ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†&#34;&gt;4.6. å…¨å±€ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç† &lt;a href=&#34;#46-%e5%85%a8%e5%b1%80%e7%bb%9f%e4%b8%80%e7%9a%84%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//å®ç°å¼‚å¸¸å¤„ç†æ¥å£
public class CustomErrorHandler extends DefaultResponseErrorHandler {  
  
    @Override  
    public void handleError(ClientHttpResponse response) throws IOException {  
  
    }
    
}  

//å°†è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†å™¨åŠ è¿›å»
@Configuration  
public class RestClientConfig {  
  
    @Bean  
    public RestTemplate restTemplate() {  
        RestTemplate restTemplate = new RestTemplate();  
        restTemplate.setErrorHandler(new CustomErrorHandler());  
        return restTemplate;  
    }  
  
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;5-å°æŠ€å·§&#34;&gt;5. å°æŠ€å·§ &lt;a href=&#34;#5-%e5%b0%8f%e6%8a%80%e5%b7%a7&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;51-å‚æ•°æ¨¡æ¿&#34;&gt;5.1. å‚æ•°æ¨¡æ¿ &lt;a href=&#34;#51-%e5%8f%82%e6%95%b0%e6%a8%a1%e6%9d%bf&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ•°ç»„ä¼ å‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;String result = restTemplate.getForObject(&amp;#34;http://example.com/hotels/{hotel}/bookings/{booking}&amp;#34;, 
    String.class, &amp;#34;42&amp;#34;, &amp;#34;21&amp;#34;);
//å®é™…æ•ˆæœç­‰åŒäºï¼šGET http://example.com/hotels/42/bookings/21
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;mapä¼ å‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Map&amp;lt;String, String&amp;gt; vars = new HashMap&amp;lt;String, String&amp;gt;();
vars.put(&amp;#34;hotel&amp;#34;, &amp;#34;42&amp;#34;);
vars.put(&amp;#34;booking&amp;#34;, &amp;#34;21&amp;#34;);
String result = restTemplate.getForObject(&amp;#34;http://example.com/hotels/{hotel}/bookings/{booking}&amp;#34;, 
    String.class, vars);
//å®é™…æ•ˆæœç­‰åŒäºï¼šGET http://example.com/hotels/42/rooms/42
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;52-æ–‡ä»¶ä¸Šä¼ æ³¨æ„ç‚¹&#34;&gt;5.2. æ–‡ä»¶ä¸Šä¼ æ³¨æ„ç‚¹ &lt;a href=&#34;#52-%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e6%b3%a8%e6%84%8f%e7%82%b9&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨äº†æœ¬åœ°ä¸´æ—¶æ–‡ä»¶ï¼Œä¸€å®šè¦åœ¨finallyä»£ç å—ä¸­åˆ é™¤ï¼Œå¦åˆ™å¯èƒ½ä¼šæ’‘çˆ†ç£ç›˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;6-faq&#34;&gt;6. FAQ &lt;a href=&#34;#6-faq&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h2&gt;&lt;h3 id=&#34;61-è·å–çŠ¶æ€ç &#34;&gt;6.1. è·å–çŠ¶æ€ç  &lt;a href=&#34;#61-%e8%8e%b7%e5%8f%96%e7%8a%b6%e6%80%81%e7%a0%81&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨xxForEntityç±»æ–¹æ³•è°ƒç”¨æ¥å£ï¼Œå°†è¿”å›ResponseEntityå¯¹è±¡ï¼Œé€šè¿‡å®ƒèƒ½å–åˆ°çŠ¶æ€ç ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//åˆ¤æ–­æ¥å£è¿”å›æ˜¯å¦ä¸º200
public static Boolean ping(){
    String url = &amp;#34;xxx&amp;#34;;
    try{
        ResponseEntity&amp;lt;String&amp;gt; responseEntity = restTemplate.getForEntity(url, String.class);
        HttpStatus status = responseEntity.getStatusCode();//è·å–è¿”å›çŠ¶æ€
        return status.is2xxSuccessful();//åˆ¤æ–­çŠ¶æ€ç æ˜¯å¦ä¸º2å¼€å¤´çš„
    }catch(Exception e){
        log.error(&amp;#34;å¤„ç†å¤±è´¥: {}&amp;#34;, url, e);
        return false; //502 ,500æ˜¯ä¸èƒ½æ­£å¸¸è¿”å›ç»“æœçš„ï¼Œéœ€è¦catchä½ï¼Œè¿”å›ä¸€ä¸ªfalse
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;62-æˆ‘éœ€è¦æ‰‹å·¥é‡Šæ”¾è¿æ¥å—&#34;&gt;6.2. æˆ‘éœ€è¦æ‰‹å·¥é‡Šæ”¾è¿æ¥å—ï¼Ÿ &lt;a href=&#34;#62-%e6%88%91%e9%9c%80%e8%a6%81%e6%89%8b%e5%b7%a5%e9%87%8a%e6%94%be%e8%bf%9e%e6%8e%a5%e5%90%97&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ä¸éœ€è¦ï¼Œrest templateä¼šå¸®æˆ‘ä»¬é‡Šæ”¾ï¼Œå…·ä½“è¯·çœ‹ï¼š&lt;a href=&#34;https://stackoverflow.com/questions/40161117/spring-resttemplate-need-to-release-connection&#34;&gt;spring-resttemplate-need-to-release-connection ?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;62-å¦‚ä½•è°ƒè¯•rest-template&#34;&gt;6.2. å¦‚ä½•è°ƒè¯•rest template &lt;a href=&#34;#62-%e5%a6%82%e4%bd%95%e8%b0%83%e8%af%95rest-template&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;å¯ä»¥åœ¨logbacké‡Œå•ç‹¬é…ä¸€ä¸ªdebugçº§åˆ«çš„loggerï¼ŒæŠŠorg.apache.httpä¸‹é¢çš„æ—¥å¿—å®šå‘åˆ°æ§åˆ¶å°ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;logger name=&amp;#34;org.apache.http&amp;#34; level=&amp;#34;DEBUG&amp;#34; additivity=&amp;#34;false&amp;#34;&amp;gt;
    &amp;lt;appender-ref ref=&amp;#34;STDOUT&amp;#34; /&amp;gt;
&amp;lt;/logger&amp;gt;
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>JAVAä»£ç ç”Ÿæˆ</title>
      <link>https://abnerxc.github.io/note/java-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90/</link>
      <pubDate>Mon, 25 Jan 2021 22:07:58 +0800</pubDate>
      
      <guid>https://abnerxc.github.io/note/java-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90/</guid>
      <description>&lt;h1 id=&#34;ä¾èµ–åŒ…ç‰ˆæœ¬&#34;&gt;ä¾èµ–åŒ…ç‰ˆæœ¬ &lt;a href=&#34;#%e4%be%9d%e8%b5%96%e5%8c%85%e7%89%88%e6%9c%ac&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;com.baomidou&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;mybatis-plus-generator&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;3.5.3.1&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.freemarker&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;freemarker&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.3.32&amp;lt;/version&amp;gt; &amp;lt;!-- or latest version --&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;javaä»£ç ç”Ÿæˆ&#34;&gt;Javaä»£ç ç”Ÿæˆ &lt;a href=&#34;#java%e4%bb%a3%e7%a0%81%e7%94%9f%e6%88%90&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;import com.baomidou.mybatisplus.generator.FastAutoGenerator;
import com.baomidou.mybatisplus.generator.config.OutputFile;
import com.baomidou.mybatisplus.generator.config.rules.DbColumnType;
import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;
import com.baomidou.mybatisplus.generator.config.builder.CustomFile;
import java.sql.Types;
import java.util.*;

public class CodeGeneratorTest {
    public static void main(String[] args) {
        // æ•°æ®åº“é…ç½®
        String url = &amp;#34;jdbc:mysql://127.0.01:3306/test?useUnicode=true&amp;amp;characterEncoding=UTF8&amp;amp;useSSL=false&amp;amp;serverTimezone=Asia/Shanghai&amp;#34;;
        String username = &amp;#34;root&amp;#34;;
        String password = &amp;#34;123456&amp;#34;;

        // è¡¨åé…ç½®
        String[] tableName = {&amp;#34;sys_subject&amp;#34;};
        String[] tablePreFix = {&amp;#34;sys_&amp;#34;, &amp;#34;tpl_&amp;#34;};

        // é¡¹ç›®é…ç½®
        String projectName = &amp;#34;com-server-demo-provider&amp;#34;;
        String basePkg = &amp;#34;com.server.demo.provider&amp;#34;;
        String moduleName = &amp;#34;subject&amp;#34;;
        String author = &amp;#34;abner&amp;#34;;

        String rootPath = System.getProperty(&amp;#34;user.dir&amp;#34;);
        String mainPath = rootPath + &amp;#34;/&amp;#34; + projectName + &amp;#34;/src/main&amp;#34;;

         FastAutoGenerator.create(url, username, password)
                .globalConfig(builder -&amp;gt; {
                    builder.author(author)
                            .fileOverride()
                            .outputDir(mainPath + &amp;#34;/java&amp;#34;);
                })
                .dataSourceConfig(builder -&amp;gt; builder.typeConvertHandler((globalConfig, typeRegistry, metaInfo) -&amp;gt; {
                    int typeCode = metaInfo.getJdbcType().TYPE_CODE;
                    if (typeCode == Types.SMALLINT || typeCode == Types.TINYINT) {  // æ·»åŠ  TINYINT ç±»å‹å¤„ç†
                        return DbColumnType.INTEGER;
                    }
                    return typeRegistry.getColumnType(metaInfo);
                }))
                .packageConfig(builder -&amp;gt; {
                    builder.parent(basePkg)
                            .moduleName(moduleName)
                            .entity(&amp;#34;model.entity&amp;#34;)  // å®ä½“ç±»æ”¾åœ¨modelåŒ…ä¸‹
                            .pathInfo(Collections.singletonMap(OutputFile.xml, mainPath + &amp;#34;/mapper/&amp;#34; + moduleName));
                })
                .strategyConfig(builder -&amp;gt; {
                    builder.addInclude(tableName)
                            .addTablePrefix(tablePreFix);

                    // å®ä½“ç±»é…ç½®
                    builder.entityBuilder()
                            //.superClass(BaseEntity.class)
                            .enableChainModel()
                            .enableLombok()
                            .disableSerialVersionUID()
                            .enableTableFieldAnnotation()
                            // å­—æ®µè¿‡æ»¤é…ç½®ï¼ˆæ’é™¤BaseEntity.classçˆ¶ç±»ä¸­å·²ç»ç»§æ‰¿çš„å­—æ®µï¼Œé˜²æ­¢é‡å¤ç”Ÿæˆè¦†ç›–ï¼‰
                            //.addSuperEntityColumns(&amp;#34;id&amp;#34;, &amp;#34;create_by&amp;#34;, &amp;#34;create_name&amp;#34;,
                                    &amp;#34;create_time&amp;#34;, &amp;#34;modify_by&amp;#34;, &amp;#34;modify_name&amp;#34;,
                                    &amp;#34;modify_time&amp;#34;);

                    // æ–°å¢Controlleré…ç½®
                    builder.controllerBuilder()
                            .enableRestStyle()  // ä½¿ç”¨@RestControlleræ³¨è§£
                            .enableHyphenStyle() // å¯ç”¨é©¼å³°è½¬è¿å­—ç¬¦
                            .formatFileName(&amp;#34;%sController&amp;#34;);

                    // Mapperé…ç½®
                    builder.mapperBuilder()
                            .superClass(BaseMapperX.class)
                            .enableBaseColumnList()
                            .enableMapperAnnotation();

                    // Serviceé…ç½®
                    builder.serviceBuilder()
                            .formatServiceFileName(&amp;#34;%sService&amp;#34;);
                })
                .injectionConfig(builder -&amp;gt; {
                    Map&amp;lt;String, Object&amp;gt; customMap = new HashMap&amp;lt;&amp;gt;();
                    // æ·»åŠ çˆ¶åŒ…è·¯å¾„å˜é‡
                    customMap.put(&amp;#34;packageName&amp;#34;, basePkg + &amp;#34;.&amp;#34; + moduleName);
                    customMap.put(&amp;#34;dtoPackage&amp;#34;, &amp;#34;model.dto&amp;#34;);
                    customMap.put(&amp;#34;voPackage&amp;#34;, &amp;#34;model.vo&amp;#34;);
                    customMap.put(&amp;#34;convertPackage&amp;#34;, &amp;#34;model.convert&amp;#34;);

                    builder.customMap(customMap)
                            // DTOæ¨¡æ¿
                            .customFile(new CustomFile.Builder()
                                    .fileName(&amp;#34;Dto.java&amp;#34;)
                                    .templatePath(&amp;#34;/templates/dto.java.ftl&amp;#34;)
                                    .packageName(&amp;#34;model.dto&amp;#34;)
                                    .build())
                            // VOæ¨¡æ¿
                            .customFile(new CustomFile.Builder()
                                    .fileName(&amp;#34;Vo.java&amp;#34;)
                                    .templatePath(&amp;#34;/templates/vo.java.ftl&amp;#34;)
                                    .packageName(&amp;#34;model.vo&amp;#34;)
                                    .build())
                            // Convertæ¨¡æ¿
                            .customFile(new CustomFile.Builder()
                                    .fileName(&amp;#34;Convert.java&amp;#34;)
                                    .templatePath(&amp;#34;/templates/convert.java.ftl&amp;#34;)
                                    .packageName(&amp;#34;model.convert&amp;#34;)
                                    .build());
                })
                .templateEngine(new FreemarkerTemplateEngine())
                .execute();
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;freemarkeræ¨¡æ¿&#34;&gt;Freemarkeræ¨¡æ¿ &lt;a href=&#34;#freemarker%e6%a8%a1%e6%9d%bf&#34; class=&#34;anchor&#34;&gt;ğŸ”—&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;convert.java.ftl&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;package ${packageName}.${convertPackage};

import ${package.Entity}.${entity};
import ${package.Entity?replace(&amp;#34;entity&amp;#34;,&amp;#34;dto&amp;#34;)}.${entity}Dto;
import ${package.Entity?replace(&amp;#34;entity&amp;#34;,&amp;#34;vo&amp;#34;)}.${entity}Vo;
import org.mapstruct.Mapper;
import org.mapstruct.factory.Mappers;
import java.util.List;

@Mapper(componentModel = &amp;#34;spring&amp;#34;)
public interface ${entity}Convert {

${entity}Convert INSTANCE = Mappers.getMapper(${entity}Convert.class);

${entity}Dto entityToDto(${entity} entity);

${entity} dtoToEntity(${entity}Dto dto);

${entity} voToEntity(${entity}Vo vo);

List&amp;lt;${entity}Dto&amp;gt; entityListToDto(List&amp;lt;${entity}&amp;gt; entities);
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;dto.java.ftl&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;package ${packageName}.${dtoPackage};

    import lombok.Data;
    import lombok.experimental.Accessors;

    @Data
    @Accessors(chain = true)
    public class ${table.entityName}Dto {

    }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;vo.java.ftl&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-config&#34; data-lang=&#34;config&#34;&gt;package ${packageName}.${voPackage};

    import lombok.Data;
    import lombok.experimental.Accessors;

    @Data
    @Accessors(chain = true)
    public class ${table.entityName}Vo {

    }
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
  </channel>
</rss>
