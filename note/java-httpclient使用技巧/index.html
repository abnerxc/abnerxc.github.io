<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">




<title>HttpClientä½¿ç”¨æŠ€å·§ | Abnerçš„åšå®¢</title>
<link rel="canonical" href="https://abnerxc.github.io/note/java-httpclient%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/">
<meta property="og:type" content="article" />
<meta property="og:title" content="HttpClientä½¿ç”¨æŠ€å·§ | Abnerçš„åšå®¢" />
<meta property="og:url" content="https://abnerxc.github.io/note/java-httpclient%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/" />








<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/custom.css" />
<script src="/js/copy-code-block.js"></script>
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    </head>

    <body>
        <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://abnerxc.github.io/">Abnerçš„åšå®¢</a>

        <nav class="menu">
            
        </nav>
    </div>
</header>

        <main class="main-wrapper">
            <div class="main">
                

<section class="single">
    <h1 class="title">HttpClientä½¿ç”¨æŠ€å·§</h1>

    <div class="tip">
        <time datetime="2021-01-25 22:07:58 &#43;0800 CST">2021/01/25</time>
        <span class="split">Â·</span>
        <span> 1978 words </span>
        <span class="split">Â·</span>
        <span>
            10 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/%E4%BB%A3%E7%A0%81">ä»£ç </a>
            
        </div>
        

        
    </div>

    
    
    <div class="post-toc">
        <h3>ç›®å½•</h3>
        <nav id="TableOfContents">
  <ul>
    <li></li>
  </ul>
</nav>
    </div>
    

    <hr />

    <div class="content">
        <h2 id="1-è§„èŒƒèƒŒæ™¯">1. è§„èŒƒèƒŒæ™¯ <a href="#1-%e8%a7%84%e8%8c%83%e8%83%8c%e6%99%af" class="anchor">ğŸ”—</a></h2><h3 id="11-http-clienté€‰æ‹©">1.1. http clienté€‰æ‹© <a href="#11-http-client%e9%80%89%e6%8b%a9" class="anchor">ğŸ”—</a></h3><ul>
<li>å¦‚æ— ç‰¹æ®Šæƒ…å†µï¼ˆæ¯”å¦‚ï¼šå•æœºtpsä¸Šåƒï¼‰ï¼Œå»ºè®®é€‰Spring Rest Templateåšé—¨é¢ï¼ŒApache HttpClient 4.xåšå®ç°</li>
</ul>
<h3 id="12-rest-template-è¿è¡Œç¯å¢ƒ">1.2. rest template è¿è¡Œç¯å¢ƒ <a href="#12-rest-template-%e8%bf%90%e8%a1%8c%e7%8e%af%e5%a2%83" class="anchor">ğŸ”—</a></h3><ul>
<li>
<p>jdk 1.8</p>
</li>
<li>
<p>spring booté¡¹ç›®</p>
</li>
</ul>
<h2 id="2-é…ç½®-rest-template">2. é…ç½® rest template <a href="#2-%e9%85%8d%e7%bd%ae-rest-template" class="anchor">ğŸ”—</a></h2><h3 id="21-å¼•å…¥jaråŒ…">2.1. å¼•å…¥jaråŒ… <a href="#21-%e5%bc%95%e5%85%a5jar%e5%8c%85" class="anchor">ğŸ”—</a></h3><ul>
<li>
<p>Spring Rest Templateåœ¨spring-webæ¨¡å—ä¸­å†…ç½®äº†ï¼Œspring bootä¼šè‡ªåŠ¨å¸®ä½ å¼•è¿›æ¥ï¼Œå› æ­¤æ— éœ€å†å¼•å…¥</p>
</li>
<li>
<p>å¼•å…¥Apache HttpClient 4.xåŒ…:</p>
</li>
</ul>
<pre tabindex="0"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;
    &lt;artifactId&gt;httpclient&lt;/artifactId&gt;
    &lt;version&gt;4.5.5&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- å¦‚æœä¸é…å¼‚æ­¥ï¼ˆAsyncRestTemplateï¼‰ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸ªä¾èµ– --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-all&lt;/artifactId&gt;
    &lt;version&gt;4.1.5.Final&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><h3 id="22-ç¼–å†™-yml-æ–‡ä»¶é…ç½®å¯é€‰">2.2. ç¼–å†™ yml æ–‡ä»¶é…ç½®ï¼ˆå¯é€‰ï¼‰ <a href="#22-%e7%bc%96%e5%86%99-yml-%e6%96%87%e4%bb%b6%e9%85%8d%e7%bd%ae%e5%8f%af%e9%80%89" class="anchor">ğŸ”—</a></h3><pre tabindex="0"><code># ymlé…ç½®çš„ä¼˜å…ˆçº§é«˜äºjavaé…ç½®ï¼›å¦‚æœymlé…ç½®å’Œjavaé…ç½®åŒæ—¶å­˜åœ¨ï¼Œåˆ™ymlé…ç½®ä¼šè¦†ç›–javaé…ç½®
####restTemplateçš„ymlé…ç½®å¼€å§‹####
spring:
  restTemplate:
    maxTotalConnect: 1000 #è¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°ï¼Œ0ä»£è¡¨ä¸é™ï¼›å¦‚æœå–0ï¼Œéœ€è¦è€ƒè™‘è¿æ¥æ³„éœ²å¯¼è‡´ç³»ç»Ÿå´©æºƒçš„åæœ
    maxConnectPerRoute: 200
    connectTimeout: 3000
    readTimeout: 5000
    charset: UTF-8
####restTemplateçš„ ymlé…ç½®å¼€å§‹####
</code></pre><h3 id="23-ç¼–å†™javaé…ç½®å¿…å¤‡ä¸å¯çœç•¥">2.3. ç¼–å†™javaé…ç½®ï¼ˆå¿…å¤‡ï¼Œä¸å¯çœç•¥ï¼‰ <a href="#23-%e7%bc%96%e5%86%99java%e9%85%8d%e7%bd%ae%e5%bf%85%e5%a4%87%e4%b8%8d%e5%8f%af%e7%9c%81%e7%95%a5" class="anchor">ğŸ”—</a></h3><pre tabindex="0"><code>//xxxä»£è¡¨ä½ çš„é¡¹ç›®ï¼Œä¾‹å¦‚ï¼š
//com.douyu.wsd.adx.gateway.config
//com.douyu.wsd.venus.config
//å¯ä»¥å†™ä¸€çº§ï¼Œä¹Ÿå¯ä»¥å†™å¤šçº§ï¼Œå…·ä½“è‡ªå·±éšæ„
package com.douyu.wsd.xxx.config;



import java.nio.charset.Charset;
import java.util.LinkedList;
import java.util.List;

import org.apache.http.Header;
import org.apache.http.client.HttpRequestRetryHandler;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.DefaultHttpRequestRetryHandler;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.impl.conn.PoolingHttpClientConnectionManager;
import org.apache.http.message.BasicHeader;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.client.ClientHttpRequestFactory;
import org.springframework.http.client.HttpComponentsClientHttpRequestFactory;
import org.springframework.http.client.Netty4ClientHttpRequestFactory;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.http.converter.StringHttpMessageConverter;
import org.springframework.web.client.AsyncRestTemplate;
import org.springframework.web.client.DefaultResponseErrorHandler;
import org.springframework.web.client.RestTemplate;

@Configuration
@ConfigurationProperties(prefix = &#34;spring.restTemplate&#34;)
@ConditionalOnClass(value = {RestTemplate.class, CloseableHttpClient.class})
public class RestTemplateConfiguration {

    // javaé…ç½®çš„ä¼˜å…ˆçº§ä½äºymlé…ç½®ï¼›å¦‚æœymlé…ç½®ä¸å­˜åœ¨ï¼Œä¼šé‡‡ç”¨javaé…ç½®
    // ####restTemplateçš„ javaé…ç½®å¼€å§‹####

    private int maxTotalConnection = 500; //è¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°

    private int maxConnectionPerRoute = 100; //åŒè·¯ç”±çš„å¹¶å‘æ•°

    private int connectionTimeout = 2 * 1000; //è¿æ¥è¶…æ—¶ï¼Œé»˜è®¤2s

    private int readTimeout = 30 * 1000; //è¯»å–è¶…æ—¶ï¼Œé»˜è®¤30s

    private String charset = &#34;UTF-8&#34;;

    // ####restTemplateçš„ javaé…ç½®ç»“æŸ####

    public void setMaxTotalConnection(int maxTotalConnection) {
        this.maxTotalConnection = maxTotalConnection;
    }

    public void setMaxConnectionPerRoute(int maxConnectionPerRoute) {
        this.maxConnectionPerRoute = maxConnectionPerRoute;
    }

    public void setConnectionTimeout(int connectionTimeout) {
        this.connectionTimeout = connectionTimeout;
    }

    public void setReadTimeout(int readTimeout) {
        this.readTimeout = readTimeout;
    }

    public void setCharset(String charset) {
        this.charset = charset;
    }

    //åˆ›å»ºHTTPå®¢æˆ·ç«¯å·¥å‚
    @Bean(name = &#34;clientHttpRequestFactory&#34;)
    public ClientHttpRequestFactory clientHttpRequestFactory() {
        return createClientHttpRequestFactory(this.connectionTimeout, this.readTimeout);
    }

    //åˆå§‹åŒ–RestTemplate,å¹¶åŠ å…¥springçš„Beanå·¥å‚ï¼Œç”±springç»Ÿä¸€ç®¡ç†
    @Bean(name = &#34;restTemplate&#34;)
    @ConditionalOnMissingBean(RestTemplate.class)
    public RestTemplate restTemplate(ClientHttpRequestFactory factory) {
        return createRestTemplate(factory);
    }

    //åˆå§‹åŒ–æ”¯æŒå¼‚æ­¥çš„RestTemplate,å¹¶åŠ å…¥springçš„Beanå·¥å‚ï¼Œç”±springç»Ÿä¸€ç®¡ç†
    //å¦‚æœä½ ç”¨ä¸åˆ°å¼‚æ­¥ï¼Œåˆ™æ— é¡»åˆ›å»ºè¯¥å¯¹è±¡
    @Bean(name = &#34;asyncRestTemplate&#34;)
    @ConditionalOnMissingBean(AsyncRestTemplate.class)
    public AsyncRestTemplate asyncRestTemplate(RestTemplate restTemplate) {
        final Netty4ClientHttpRequestFactory factory = new Netty4ClientHttpRequestFactory();
        factory.setConnectTimeout(this.connectionTimeout);
        factory.setReadTimeout(this.readTimeout);
        return new AsyncRestTemplate(factory, restTemplate);
    }

    private ClientHttpRequestFactory createClientHttpRequestFactory(int connectionTimeout, int readTimeout) {
        //maxTotalConnection å’Œ maxConnectionPerRoute å¿…é¡»è¦é…
        if (this.maxTotalConnection &lt;= 0) {
            throw new IllegalArgumentException(&#34;invalid maxTotalConnection: &#34; + maxTotalConnection);
        }
        if (this.maxConnectionPerRoute &lt;= 0) {
            throw new IllegalArgumentException(&#34;invalid maxConnectionPerRoute: &#34; + maxTotalConnection);
        }

        //å…¨å±€é»˜è®¤çš„headerå¤´é…ç½®
        List&lt;Header&gt; headers = new LinkedList&lt;&gt;();
        headers.add(new BasicHeader(&#34;Accept-Encoding&#34;, &#34;gzip,deflate&#34;));
        headers.add(new BasicHeader(&#34;Accept-Language&#34;, &#34;zh-CN,zh;q=0.8,en;q=0.6&#34;));

        //ç¦ç”¨è‡ªåŠ¨é‡è¯•ï¼Œéœ€è¦é‡è¯•æ—¶ï¼Œè¯·è‡ªè¡Œæ§åˆ¶
        HttpRequestRetryHandler retryHandler = new DefaultHttpRequestRetryHandler(0, false);

        PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager();
        cm.setMaxTotal(maxTotalConnection);
        cm.setDefaultMaxPerRoute(maxConnectionPerRoute);

        //åˆ›å»ºçœŸæ­£å¤„ç†httpè¯·æ±‚çš„httpClientå®ä¾‹
        CloseableHttpClient httpClient = HttpClients.custom()
                .setDefaultHeaders(headers)
                .setRetryHandler(retryHandler)
                .setConnectionManager(cm)
                .build();

        HttpComponentsClientHttpRequestFactory factory = new HttpComponentsClientHttpRequestFactory(
                httpClient);
        factory.setConnectTimeout(connectionTimeout);
        factory.setReadTimeout(readTimeout);
        return factory;
    }

    private RestTemplate createRestTemplate(ClientHttpRequestFactory factory) {
        RestTemplate restTemplate = new RestTemplate(factory);

        //æˆ‘ä»¬é‡‡ç”¨RestTemplateå†…éƒ¨çš„MessageConverter
        //é‡æ–°è®¾ç½®StringHttpMessageConverterå­—ç¬¦é›†ï¼Œè§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜
        modifyDefaultCharset(restTemplate);

        //è®¾ç½®é”™è¯¯å¤„ç†å™¨
        restTemplate.setErrorHandler(new DefaultResponseErrorHandler());

        return restTemplate;
    }

    private void modifyDefaultCharset(RestTemplate restTemplate) {
        List&lt;HttpMessageConverter&lt;?&gt;&gt; converterList = restTemplate.getMessageConverters();
        HttpMessageConverter&lt;?&gt; converterTarget = null;
        for (HttpMessageConverter&lt;?&gt; item : converterList) {
            if (StringHttpMessageConverter.class == item.getClass()) {
                converterTarget = item;
                break;
            }
        }
        if (null != converterTarget) {
            converterList.remove(converterTarget);
        }
        Charset defaultCharset = Charset.forName(charset);
        converterList.add(1, new StringHttpMessageConverter(defaultCharset));
    }

}
</code></pre><p>åšå®Œä¸Šè¿°é…ç½®ï¼Œå°±ç”Ÿæˆäº†å¯ç”¨çš„RestTemplateå®ä¾‹</p>
<p>é‡‡ç”¨ä¸Šè¿°é…ç½®ï¼Œå¯ä»¥åšåˆ°å¼€ç®±å³ç”¨ï¼›è‡ªå·±é…ï¼Œå¯èƒ½ä¼šè¸©äº›å‘ï¼Œæ¯”å¦‚ï¼š<a href="http://doc.dz11.com/ddse/preview/share/9c0f4c855b09e2b1cf33?sid=187">spring boot é…ç½®æŠ€å·§</a></p>
<h2 id="3-rest-templateåŸºæœ¬ç”¨æ³•">3. rest templateåŸºæœ¬ç”¨æ³• <a href="#3-rest-template%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95" class="anchor">ğŸ”—</a></h2><h3 id="31-getæ¼”ç¤º">3.1. getæ¼”ç¤º <a href="#31-get%e6%bc%94%e7%a4%ba" class="anchor">ğŸ”—</a></h3><ul>
<li>æ¼”ç¤ºä»£ç </li>
</ul>
<pre tabindex="0"><code>import com.douyu.wsd.framework.common.lang.StringUtils;

import java.net.URLEncoder;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.AsyncRestTemplate;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @Resource
    private AsyncRestTemplate asyncRestTemplate;

    //æœ€ç®€å•çš„getæ“ä½œ
    @RequestMapping(&#34;/get&#34;)
    public String testGet(String keyword) throws Exception {
        String kw = StringUtils.defaultString(URLEncoder.encode(keyword, &#34;UTF-8&#34;));
        String html = restTemplate.getForObject(&#34;https://www.douyu.com/search/?kw=&#34; + kw, String.class);
        return html;//è¿”å›çš„æ˜¯æ–—é±¼ä¸»ç«™çš„html
    }

    //éœ€è¦è‡ªå®šä¹‰headerå¤´çš„getæ“ä½œ
    @RequestMapping(&#34;/get2&#34;)
    public String testGet2(String keyword) throws Exception {
        HttpHeaders headers = new HttpHeaders();
        headers.set(&#34;MyHeaderKey&#34;, &#34;MyHeaderValue&#34;);
        HttpEntity entity = new HttpEntity(headers);

        String kw = StringUtils.defaultString(URLEncoder.encode(keyword, &#34;UTF-8&#34;));
        ResponseEntity&lt;String&gt; response = restTemplate.exchange(&#34;https://www.douyu.com/search/?kw=&#34; + kw, HttpMethod.GET, entity, String.class);
        return response.getBody();//è¿”å›çš„æ˜¯æ–—é±¼ä¸»ç«™çš„html
    }
    
}
</code></pre><h3 id="32-postè¡¨å•æ¼”ç¤º">3.2. postè¡¨å•æ¼”ç¤º <a href="#32-post%e8%a1%a8%e5%8d%95%e6%bc%94%e7%a4%ba" class="anchor">ğŸ”—</a></h3><ul>
<li>æ¼”ç¤ºä»£ç </li>
</ul>
<pre tabindex="0"><code>import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;

import javax.annotation.Resource;

import com.google.common.collect.ImmutableMap;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&#34;/postForm&#34;)
    public String testPostForm(String posid) throws Exception {//æµ‹è¯•ç”¨ä¾‹ï¼šposid=804009
        String url = &#34;http://www.douyu.com/lapi/sign/app/getinfo?aid=android1&amp;client_sys=android&amp;mdid=phone&amp;time=1524495658&amp;token=&amp;auth=789c4f732d6aa4d0a5c8fb33765af8cf&#34;;
        MultiValueMap&lt;String, String&gt; form = new LinkedMultiValueMap&lt;String, String&gt;();
        form.add(&#34;app&#34;, &#34;{\&#34;aname\&#34;:\&#34;æ–—é±¼ç›´æ’­\&#34;,\&#34;pname\&#34;:\&#34;air.tv.douyu.android\&#34;}&#34;);
        form.add(&#34;mdid&#34;, &#34;phone&#34;);
        form.add(&#34;cate1&#34;, &#34;0&#34;);
        form.add(&#34;client_sys&#34;, &#34;ios&#34;);
        form.add(&#34;cate2&#34;, &#34;0&#34;);
        form.add(&#34;auth&#34;, &#34;789c4f732d6aa4d0a5c8fb33765af8cf&#34;);
        form.add(&#34;roomid&#34;, &#34;0&#34;);
        form.add(&#34;posid&#34;, posid);
        form.add(&#34;imei&#34;, &#34;863254010282712&#34;);

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
        //headers.add(&#34;xx&#34;, &#34;yy&#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; formEntity = new HttpEntity&lt;&gt;(form, headers);
        String json = restTemplate.postForObject(url, formEntity, String.class);
        return json;//è¿”å›çš„æ˜¯å¹¿å‘Šapiçš„json
    }
}
</code></pre><h3 id="33-postè¯·æ±‚ä½“æ¼”ç¤º">3.3. postè¯·æ±‚ä½“æ¼”ç¤º <a href="#33-post%e8%af%b7%e6%b1%82%e4%bd%93%e6%bc%94%e7%a4%ba" class="anchor">ğŸ”—</a></h3><ul>
<li>æ¼”ç¤ºä»£ç </li>
</ul>
<pre tabindex="0"><code>import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&#34;/postBody&#34;)
    public String testPostBody() throws Exception {
        String url = &#34;https://venus.dz11.com/venus/release/pc/checkUpdate&#34;;
        String jsonBody = &#34;{\n&#34;
                + &#34;    \&#34;channelCode\&#34;: \&#34;official\&#34;,\n&#34;
                + &#34;    \&#34;appCode\&#34;: \&#34;Douyu_Live_PC_Client\&#34;,\n&#34;
                + &#34;    \&#34;versionCode\&#34;: \&#34;201804121\&#34;,\n&#34;
                + &#34;    \&#34;versionName\&#34;: \&#34;V5.1.9\&#34;,\n&#34;
                + &#34;    \&#34;deviceUid\&#34;: \&#34;02-15-03-59-5C-E2\&#34;,\n&#34;
                + &#34;    \&#34;deviceResolution\&#34;: \&#34;1920*1080\&#34;,\n&#34;
                + &#34;    \&#34;token\&#34;: \&#34;token\&#34;,\n&#34;
                + &#34;    \&#34;webView\&#34;: \&#34;\&#34;,\n&#34;
                + &#34;    \&#34;osInfo\&#34;: \&#34;10.0\&#34;,\n&#34;
                + &#34;    \&#34;osType\&#34;: \&#34;64\&#34;,\n&#34;
                + &#34;    \&#34;cpuInfo\&#34;:\n&#34;
                + &#34;    {\n&#34;
                + &#34;        \&#34;OemId\&#34;: \&#34;0\&#34;,\n&#34;
                + &#34;        \&#34;ProcessorArchitecture\&#34;: \&#34;0\&#34;,\n&#34;
                + &#34;        \&#34;PageSize\&#34;: \&#34;4096\&#34;,\n&#34;
                + &#34;        \&#34;MinimumApplicationAddress\&#34;: \&#34;00010000\&#34;,\n&#34;
                + &#34;        \&#34;MaximumApplicationAddress\&#34;: \&#34;7FFEFFFF\&#34;,\n&#34;
                + &#34;        \&#34;ActiveProcessorMask\&#34;: \&#34;15\&#34;,\n&#34;
                + &#34;        \&#34;NumberOfProcessors\&#34;: \&#34;4\&#34;,\n&#34;
                + &#34;        \&#34;ProcessorType\&#34;: \&#34;586\&#34;,\n&#34;
                + &#34;        \&#34;AllocationGranularity\&#34;: \&#34;65536\&#34;,\n&#34;
                + &#34;        \&#34;ProcessorLevel\&#34;: \&#34;6\&#34;,\n&#34;
                + &#34;        \&#34;ProcessorRevision\&#34;: \&#34;40457\&#34;\n&#34;
                + &#34;    },\n&#34;
                + &#34;    \&#34;diskInfo\&#34;: \&#34;931.507GB\&#34;,\n&#34;
                + &#34;    \&#34;memoryInfo\&#34;: \&#34;15.8906GB\&#34;,\n&#34;
                + &#34;    \&#34;driveInfo\&#34;: \&#34;Intel(R) HD Graphics 630:23.20.16.4973;\&#34;,\n&#34;
                + &#34;    \&#34;startTime\&#34;: \&#34;-501420357\&#34;\n&#34;
                + &#34;}\n&#34;;

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        //headers.add(&#34;xx&#34;, &#34;yy&#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&lt;String&gt; bodyEntity = new HttpEntity&lt;&gt;(jsonBody, headers);
        
        //1.ç›´æ¥æ‹¿åŸå§‹jsonä¸²
        String json = restTemplate.postForObject(url, bodyEntity, String.class);
        
        //2.å°†åŸå§‹çš„jsonä¼ è½¬æˆjavaå¯¹è±¡ï¼Œrest templateå¯ä»¥è‡ªåŠ¨å®Œæˆ
        ResultVo resultVo = restTemplate.postForObject(url, bodyEntity, ResultVo.class);
        if (resultVo != null &amp;&amp; resultVo.success()) {
            Object res = resultVo.getData();//dataèŠ‚ç‚¹çš„å®é™…ç±»å‹æ˜¯java.util.LinkedHashMap
            logger.info(&#34;å¤„ç†æˆåŠŸï¼Œè¿”å›æ•°æ®: {}&#34;, resultVo.getData());
        } else {
            logger.info(&#34;å¤„ç†å¤±è´¥ï¼Œå“åº”ç»“æœ: {}&#34;, resultVo);
        }

        return json;//è¿”å›çš„æ˜¯åˆ†åŒ…apiçš„json
    }
}
</code></pre><h3 id="34-postæ–‡ä»¶ä¸Šä¼ ">3.4. postæ–‡ä»¶ä¸Šä¼  <a href="#34-post%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0" class="anchor">ğŸ”—</a></h3><blockquote>
<p>åœºæ™¯è¯´æ˜ï¼šåªé€‚åˆå°æ–‡ä»¶ï¼ˆ20MBä»¥å†…ï¼‰ä¸Šä¼ </p>
</blockquote>
<ul>
<li>æ¼”ç¤ºä»£ç </li>
</ul>
<pre tabindex="0"><code>import com.douyu.wsd.framework.common.codec.CodecUtils;
import com.douyu.wsd.framework.common.lang.StringUtils;

import java.io.File;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.core.io.FileSystemResource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&#34;/postFile&#34;)
    public String testPostBody() throws Exception {
        String filePath = &#34;D:/config.png&#34;;
        
        //é€šè¿‡ç£ç›˜æ–‡ä»¶ä¸Šä¼ ï¼Œå¦‚æœäº§ç”Ÿäº†ä¸´æ—¶æ–‡ä»¶ï¼Œä¸€å®šè¦è®°å¾—åˆ é™¤ï¼Œå¦åˆ™ï¼Œä¸´æ—¶æ–‡ä»¶è¶Šç§¯è¶Šå¤šï¼Œç£ç›˜ä¼šçˆ†
        FileSystemResource resource = new FileSystemResource(new File(filePath));
	
        String url = &#34;http://dev.resuploader.dz11.com/Resource/Dss/put&#34;;
        String appId = &#34;***&#34;;//æµ‹è¯•çš„æ—¶å€™æ¢æˆè‡ªå·±çš„é…ç½®
        String secureKey = &#34;***&#34;;
        String time = String.valueOf(System.currentTimeMillis());
        String pubStr = &#34;1&#34;;
        String tempStr = String.format(&#34;app_id=%s&amp;is_public=%s&amp;time=%s&amp;vframe=0%s&#34;, appId, pubStr, time, secureKey);
        MultiValueMap&lt;String, Object&gt; form = new LinkedMultiValueMap&lt;&gt;();
        form.add(&#34;is_public&#34;, pubStr);
        form.add(&#34;vframe&#34;, &#34;0&#34;);
        form.add(&#34;file&#34;, resource);
        form.add(&#34;app_id&#34;, appId);
        form.add(&#34;time&#34;, time);
        form.add(&#34;sign&#34;, CodecUtils.md5(tempStr));

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.MULTIPART_FORM_DATA);
        //headers.add(&#34;xx&#34;, &#34;yy&#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; formEntity = new HttpEntity&lt;&gt;(form, headers);
        String json = restTemplate.postForObject(url, formEntity, String.class);
        return json;
    }
}
</code></pre><h3 id="35-æ–‡ä»¶ä¸‹è½½">3.5. æ–‡ä»¶ä¸‹è½½ <a href="#35-%e6%96%87%e4%bb%b6%e4%b8%8b%e8%bd%bd" class="anchor">ğŸ”—</a></h3><blockquote>
<p>åœºæ™¯è¯´æ˜ï¼šåªé€‚åˆå°æ–‡ä»¶ï¼ˆ10MBä»¥å†…ï¼‰ä¸‹è½½</p>
</blockquote>
<ul>
<li>æ¼”ç¤ºä»£ç </li>
</ul>
<pre tabindex="0"><code>import com.douyu.wsd.framework.common.lang.StringUtils;

import java.io.IOException;
import java.io.InputStream;
import java.net.URLEncoder;
import java.util.Collections;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.springframework.core.io.InputStreamResource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&#34;/downloadFile&#34;)
    public ResponseEntity testDownloadFile() throws Exception {
        String url = &#34;http://editor.baidu.com/editor/download/BaiduEditor(Online)_5-9-16.exe&#34;;
        HttpHeaders headers = new HttpHeaders();
        headers.setAccept(Collections.singletonList(MediaType.APPLICATION_OCTET_STREAM));
        HttpEntity&lt;String&gt; entity = new HttpEntity&lt;&gt;(headers);
        ResponseEntity&lt;byte[]&gt; response = restTemplate.exchange(url, HttpMethod.GET, entity, byte[].class);
        byte[] bytes = response.getBody();
        long contentLength = bytes != null ? bytes.length : 0;
        headers.setContentLength((int) contentLength);
        headers.setContentDispositionFormData(&#34;baidu.exe&#34;, URLEncoder.encode(&#34;ç™¾åº¦å®‰è£…åŒ….exe&#34;, &#34;UTF-8&#34;));
        return new ResponseEntity&lt;&gt;(response.getBody(), headers, HttpStatus.OK);
    }   
}
</code></pre><h3 id="36-æ›´å¤šapi">3.6. æ›´å¤šAPI <a href="#36-%e6%9b%b4%e5%a4%9aapi" class="anchor">ğŸ”—</a></h3><h4 id="361--resttemplate-api-ä¸httpåŠ¨è¯çš„å¯¹è±¡å…³ç³»">3.6.1.  RestTemplate API ä¸httpåŠ¨è¯çš„å¯¹è±¡å…³ç³»ï¼š <a href="#361--resttemplate-api-%e4%b8%8ehttp%e5%8a%a8%e8%af%8d%e7%9a%84%e5%af%b9%e8%b1%a1%e5%85%b3%e7%b3%bb" class="anchor">ğŸ”—</a></h4><p>| HTTPåŠ¨è¯  | å¯¹åº”çš„RestTemplate API   |
| ++++++-  |:++++++++++++-: |
|DELETE|	delete(String, String&hellip;)
|GET|	getForObject(String, Class, String&hellip;)
|HEAD|	headForHeaders(String, String&hellip;)
|OPTIONS|	optionsForAllow(String, String&hellip;)
|POST|	postForLocation(String, Object, String&hellip;)
|PUT|	put(String, Object, String&hellip;)</p>
<h4 id="362--postgetforentity-api-å’Œ-postgetforobject-çš„åŒºåˆ«">3.6.2.  (post|get)ForEntity API å’Œ (post|get)ForObject çš„åŒºåˆ« <a href="#362--postgetforentity-api-%e5%92%8c-postgetforobject-%e7%9a%84%e5%8c%ba%e5%88%ab" class="anchor">ğŸ”—</a></h4><pre><code>ForEntity APIæ‹¿åˆ°çš„æ˜¯ResponseEntityï¼Œé€šè¿‡ResponseEntityå¯ä»¥æ‹¿åˆ°çŠ¶æ€ç ï¼Œresponse headerç­‰ä¿¡æ¯

ForObject APIæ‹¿åˆ°çš„æ˜¯javaå¯¹è±¡ï¼Œç”¨åœ¨ä¸å…³å¿ƒresponseçŠ¶æ€ç å’Œheaderçš„åœºåˆä¸­
</code></pre>
<h4 id="363-getxxxpostxxx-å’Œ-exchange-æ–¹æ³•çš„åŒºåˆ«">3.6.3. getXXXã€postXXX å’Œ exchange æ–¹æ³•çš„åŒºåˆ« <a href="#363-getxxxpostxxx-%e5%92%8c-exchange-%e6%96%b9%e6%b3%95%e7%9a%84%e5%8c%ba%e5%88%ab" class="anchor">ğŸ”—</a></h4><pre><code>getXXXã€postXXX ç”¨äºæ¯”è¾ƒç®€å•çš„è°ƒç”¨

exchange ç”¨äºæ¯”è¾ƒå¤æ‚çš„è°ƒç”¨
</code></pre>
<h2 id="4-rest-templateé«˜é˜¶ç”¨æ³•">4. rest templateé«˜é˜¶ç”¨æ³• <a href="#4-rest-template%e9%ab%98%e9%98%b6%e7%94%a8%e6%b3%95" class="anchor">ğŸ”—</a></h2><h3 id="41-å¸¦æ³›å‹çš„å“åº”è§£ç ">4.1. å¸¦æ³›å‹çš„å“åº”è§£ç  <a href="#41-%e5%b8%a6%e6%b3%9b%e5%9e%8b%e7%9a%84%e5%93%8d%e5%ba%94%e8%a7%a3%e7%a0%81" class="anchor">ğŸ”—</a></h3><pre tabindex="0"><code>
import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    private static final Logger logger = LoggerFactory.getLogger(TestController.class);

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&#34;/postBody&#34;)
    public String testPostBody() throws Exception {//æµ‹è¯•ç”¨ä¾‹ï¼šposid=804009
        String url = &#34;https://venus.dz11.com/venus/release/pc/checkUpdate&#34;;
        String jsonBody = &#34;{\n&#34;
                + &#34;    \&#34;channelCode\&#34;: \&#34;official\&#34;,\n&#34;
                + &#34;    \&#34;appCode\&#34;: \&#34;Douyu_Live_PC_Client\&#34;,\n&#34;
                + &#34;    \&#34;versionCode\&#34;: \&#34;201804121\&#34;,\n&#34;
                + &#34;    \&#34;versionName\&#34;: \&#34;V5.1.9\&#34;,\n&#34;
                + &#34;    \&#34;deviceUid\&#34;: \&#34;02-15-03-59-5C-E2\&#34;,\n&#34;
                + &#34;    \&#34;deviceResolution\&#34;: \&#34;1920*1080\&#34;,\n&#34;
                + &#34;    \&#34;token\&#34;: \&#34;token\&#34;,\n&#34;
                + &#34;    \&#34;webView\&#34;: \&#34;\&#34;,\n&#34;
                + &#34;    \&#34;osInfo\&#34;: \&#34;10.0\&#34;,\n&#34;
                + &#34;    \&#34;osType\&#34;: \&#34;64\&#34;,\n&#34;
                + &#34;    \&#34;cpuInfo\&#34;:\n&#34;
                + &#34;    {\n&#34;
                + &#34;        \&#34;OemId\&#34;: \&#34;0\&#34;,\n&#34;
                + &#34;        \&#34;ProcessorArchitecture\&#34;: \&#34;0\&#34;,\n&#34;
                + &#34;        \&#34;PageSize\&#34;: \&#34;4096\&#34;,\n&#34;
                + &#34;        \&#34;MinimumApplicationAddress\&#34;: \&#34;00010000\&#34;,\n&#34;
                + &#34;        \&#34;MaximumApplicationAddress\&#34;: \&#34;7FFEFFFF\&#34;,\n&#34;
                + &#34;        \&#34;ActiveProcessorMask\&#34;: \&#34;15\&#34;,\n&#34;
                + &#34;        \&#34;NumberOfProcessors\&#34;: \&#34;4\&#34;,\n&#34;
                + &#34;        \&#34;ProcessorType\&#34;: \&#34;586\&#34;,\n&#34;
                + &#34;        \&#34;AllocationGranularity\&#34;: \&#34;65536\&#34;,\n&#34;
                + &#34;        \&#34;ProcessorLevel\&#34;: \&#34;6\&#34;,\n&#34;
                + &#34;        \&#34;ProcessorRevision\&#34;: \&#34;40457\&#34;\n&#34;
                + &#34;    },\n&#34;
                + &#34;    \&#34;diskInfo\&#34;: \&#34;931.507GB\&#34;,\n&#34;
                + &#34;    \&#34;memoryInfo\&#34;: \&#34;15.8906GB\&#34;,\n&#34;
                + &#34;    \&#34;driveInfo\&#34;: \&#34;Intel(R) HD Graphics 630:23.20.16.4973;\&#34;,\n&#34;
                + &#34;    \&#34;startTime\&#34;: \&#34;-501420357\&#34;\n&#34;
                + &#34;}\n&#34;;

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        HttpEntity&lt;String&gt; bodyEntity = new HttpEntity&lt;&gt;(jsonBody, headers);
        
        //1. ç›´æ¥æ‹¿åŸå§‹çš„jsonä¸²
        String json = restTemplate.postForObject(url, bodyEntity, String.class);

        //2. å°†åŸå§‹jsonä¼ è½¬javaå¯¹è±¡ï¼Œè·Ÿä¸Šæ–‡ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªjavaå¯¹è±¡é‡Œé¢æœ‰æ³›å‹ï¼ˆResultVo&lt;PcUpdateRes&gt;ï¼‰
        //å¤§å®¶å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼ŒæŠŠResultVo&lt;PcUpdateRes&gt;æ¢æˆè‡ªå·±çš„ç±»ï¼Œæ¯”å¦‚ï¼šList&lt;MemberInfo&gt;
        ResponseEntity&lt;ResultVo&lt;PcUpdateRes&gt;&gt; response = restTemplate
                .exchange(url, HttpMethod.POST, bodyEntity, new ParameterizedTypeReference&lt;ResultVo&lt;PcUpdateRes&gt;&gt;() {});
        if (response.getStatusCode().is2xxSuccessful() &amp;&amp; response.getBody() != null &amp;&amp; response.getBody().success()) {
            ResultVo&lt;PcUpdateRes data = &gt; resultVo = response.getBody();
            PcUpdateRes data = resultVo.getData();
            logger.info(&#34;å¤„ç†æˆåŠŸï¼Œè¿”å›æ•°æ®: {}&#34;, data);
        } else {
            logger.info(&#34;å¤„ç†å¤±è´¥ï¼Œå“åº”ç»“æœ: {}&#34;, response);
        }

        return json;
    }
}
</code></pre><h3 id="42-ä¸Šä¼ æ–‡ä»¶æµ">4.2. ä¸Šä¼ æ–‡ä»¶æµ <a href="#42-%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6%e6%b5%81" class="anchor">ğŸ”—</a></h3><pre tabindex="0"><code>import com.douyu.wsd.framework.common.codec.CodecUtils;
import com.douyu.wsd.framework.common.io.IOUtils;
import com.douyu.wsd.framework.common.lang.StringUtils;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.HashMap;
import java.util.Map;
import javax.annotation.Resource;

import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.core.io.InputStreamResource;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@Slf4j
public class TestController {

    @Resource
    private RestTemplate restTemplate;

    @RequestMapping(&#34;/postFile&#34;)
    public String testPostBody() throws Exception {
        String filePath = &#34;D:/config.png&#34;;
        MultipartFileResource resource = new MultipartFileResource(new FileInputStream(new File(filePath)), &#34;config.png&#34;);
        String url = &#34;http://dev.resuploader.dz11.com/Resource/Dss/put&#34;;
        String appId = &#34;***&#34;;//æµ‹è¯•çš„æ—¶å€™æ¢æˆè‡ªå·±çš„é…ç½®
        String secureKey = &#34;***&#34;;
        String time = String.valueOf(System.currentTimeMillis());
        String pubStr = &#34;1&#34;;
        String tempStr = String.format(&#34;app_id=%s&amp;is_public=%s&amp;time=%s&amp;vframe=0%s&#34;, appId, pubStr, time, secureKey);
        MultiValueMap&lt;String, Object&gt; form = new LinkedMultiValueMap&lt;&gt;();
        form.add(&#34;is_public&#34;, pubStr);
        form.add(&#34;vframe&#34;, &#34;0&#34;);
        form.add(&#34;file&#34;, resource);
        form.add(&#34;app_id&#34;, appId);
        form.add(&#34;time&#34;, time);
        form.add(&#34;sign&#34;, CodecUtils.md5(tempStr));

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.MULTIPART_FORM_DATA);
        //headers.add(&#34;xx&#34;, &#34;yy&#34;);//å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„headerå¤´
        HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; formEntity = new HttpEntity&lt;&gt;(form, headers);
        String json = restTemplate.postForObject(url, formEntity, String.class);
        return json;
    }

    private class MultipartFileResource extends InputStreamResource {

        private String filename;

        public MultipartFileResource(InputStream inputStream, String filename) {
            super(inputStream);
            this.filename = filename;
        }

        @Override
        public String getFilename() {
            return this.filename;
        }

        @Override
        public long contentLength() throws IOException {
            return -1; // we do not want to generally read the whole stream into memory ...
        }
    }
}
</code></pre><h3 id="43-å¼‚æ­¥æ“ä½œ">4.3 å¼‚æ­¥æ“ä½œ <a href="#43-%e5%bc%82%e6%ad%a5%e6%93%8d%e4%bd%9c" class="anchor">ğŸ”—</a></h3><ul>
<li>AsyncRestTemplate å¯æ”¯æŒå¼‚æ­¥ï¼Œä¸åŒæ­¥APIåŸºæœ¬ä¸€è‡´ï¼Œè¿”å›çš„æ˜¯future:</li>
</ul>
<pre tabindex="0"><code>import com.douyu.wsd.framework.common.lang.StringUtils;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.TimeUnit;
import javax.annotation.Resource;

import org.springframework.http.ResponseEntity;
import org.springframework.util.concurrent.ListenableFuture;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.AsyncRestTemplate;

@RestController
public class TestController {

    @Resource
    private AsyncRestTemplate asyncRestTemplate;

    @RequestMapping(&#34;/douyu&#34;)
    public String douyu() throws Exception {
        ListenableFuture&lt;ResponseEntity&lt;String&gt;&gt; future = asyncRestTemplate
                .getForEntity(&#34;http://www.douyu.com&#34;, String.class);
        return future.get(2 * 1000, TimeUnit.SECONDS).getBody();
    }
}
</code></pre><h3 id="44-ä¸åŒçš„è¶…æ—¶æ—¶é—´">4.4. ä¸åŒçš„è¶…æ—¶æ—¶é—´ <a href="#44-%e4%b8%8d%e5%90%8c%e7%9a%84%e8%b6%85%e6%97%b6%e6%97%b6%e9%97%b4" class="anchor">ğŸ”—</a></h3><p>å‡å¦‚æˆ‘ç¢°åˆ°è¿™ç§åœºæ™¯ï¼š</p>
<pre><code>ServiceA | 10s

ServiceB | 25s
</code></pre>
<p>æœ‰3ä¸ªå¥—è·¯å¯è§£å†³ï¼š</p>
<ul>
<li>å¥—è·¯ä¸€ï¼Œåˆ›å»ºå¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹æœ‰è‡ªå·±çš„è¶…æ—¶æ—¶é—´ï¼Œæ¯”å¦‚</li>
</ul>
<pre tabindex="0"><code>    // è¶…æ—¶æ—¶é—´çŸ­çš„å®ä¾‹
    @Bean(name = &#34;clientHttpRequestFactoryA&#34;)
    public ClientHttpRequestFactory clientHttpRequestFactoryA() {
        return createClientHttpRequestFactory(2*1000, 10*1000);
    }

    @Bean(name = &#34;restTemplateA&#34;)
    @ConditionalOnMissingBean(RestTemplate.class)
    public RestTemplate restTemplateA() {
        return createRestTemplate(clientHttpRequestFactoryA());
    }
    
    // è¶…æ—¶æ—¶é—´é•¿çš„å®ä¾‹
    @Bean(name = &#34;clientHttpRequestFactoryB&#34;)
    public ClientHttpRequestFactory clientHttpRequestFactoryB() {
        return createClientHttpRequestFactory(5*1000, 25*1000);
    }

    @Bean(name = &#34;restTemplateB&#34;)
    @ConditionalOnMissingBean(RestTemplate.class)
    public RestTemplate restTemplateB() {
        return createRestTemplate(clientHttpRequestFactoryB());
    }
</code></pre><ul>
<li>å¥—è·¯äºŒï¼ŒAsyncRestTemplate</li>
</ul>
<pre tabindex="0"><code>ListenableFuture&lt;ResponseEntity&lt;String&gt;&gt; future = asyncRestTemplate
                .getForEntity(&#34;http://www.douyu.com&#34;, String.class);
return future.get(2 * 1000, TimeUnit.SECONDS).getBody();
</code></pre><ul>
<li>å¥—è·¯ä¸‰ï¼Œä¸Š<a href="https://spring.io/guides/gs/circuit-breaker/"> Circuit Breaker</a></li>
</ul>
<pre tabindex="0"><code>@EnableCircuitBreaker
public class MyApp {
    public static void main(String[] args) {
        SpringApplication.run(MyApp .class, args);
    }
}

@Service
public class MyService {
    private final RestTemplate restTemplate;

    public BookService(RestTemplate rest) {
        this.restTemplate = rest;
    }

    @HystrixCommand(
        fallbackMethod = &#34;fooMethodFallback&#34;,
        commandProperties = { 
            @HystrixProperty(
                 name = &#34;execution.isolation.thread.timeoutInMilliseconds&#34;, 
                 value=&#34;5000&#34;
            )
        }
    )
    public String fooMethod() {
        // Your logic here.
        restTemplate.exchange(...); 
    }

    public String fooMethodFallback(Throwable t) {
        log.error(&#34;Fallback happened&#34;, t);
        return &#34;Sensible Default Here!&#34;
    }
}
</code></pre><h3 id="45-å¦‚ä½•è®¾ç½®è¿æ¥æ± ">4.5. å¦‚ä½•è®¾ç½®è¿æ¥æ±  <a href="#45-%e5%a6%82%e4%bd%95%e8%ae%be%e7%bd%ae%e8%bf%9e%e6%8e%a5%e6%b1%a0" class="anchor">ğŸ”—</a></h3><ul>
<li>è¿æ¥æ± éœ€è¦æœåŠ¡ç«¯æ”¯æŒé•¿è¿æ¥ï¼Œå¹¶éæ‰€æœ‰æœåŠ¡ç«¯éƒ½æ”¯æŒï¼Œå› æ­¤å•ç‹¬å¼€äº†ç¯‡æ–‡ç« ï¼š<a href="http://doc.dz11.com/ddse/preview/space/14816?sid=29&amp;pid=12940">RestTemplateå¦‚ä½•é…ç½®é•¿è¿æ¥</a></li>
</ul>
<h3 id="46-å…¨å±€ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†">4.6. å…¨å±€ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç† <a href="#46-%e5%85%a8%e5%b1%80%e7%bb%9f%e4%b8%80%e7%9a%84%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86" class="anchor">ğŸ”—</a></h3><pre tabindex="0"><code>//å®ç°å¼‚å¸¸å¤„ç†æ¥å£
public class CustomErrorHandler extends DefaultResponseErrorHandler {  
  
    @Override  
    public void handleError(ClientHttpResponse response) throws IOException {  
  
    }
    
}  

//å°†è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†å™¨åŠ è¿›å»
@Configuration  
public class RestClientConfig {  
  
    @Bean  
    public RestTemplate restTemplate() {  
        RestTemplate restTemplate = new RestTemplate();  
        restTemplate.setErrorHandler(new CustomErrorHandler());  
        return restTemplate;  
    }  
  
}
</code></pre><h2 id="5-å°æŠ€å·§">5. å°æŠ€å·§ <a href="#5-%e5%b0%8f%e6%8a%80%e5%b7%a7" class="anchor">ğŸ”—</a></h2><h3 id="51-å‚æ•°æ¨¡æ¿">5.1. å‚æ•°æ¨¡æ¿ <a href="#51-%e5%8f%82%e6%95%b0%e6%a8%a1%e6%9d%bf" class="anchor">ğŸ”—</a></h3><ul>
<li>æ•°ç»„ä¼ å‚</li>
</ul>
<pre tabindex="0"><code>String result = restTemplate.getForObject(&#34;http://example.com/hotels/{hotel}/bookings/{booking}&#34;, 
    String.class, &#34;42&#34;, &#34;21&#34;);
//å®é™…æ•ˆæœç­‰åŒäºï¼šGET http://example.com/hotels/42/bookings/21
</code></pre><ul>
<li>mapä¼ å‚</li>
</ul>
<pre tabindex="0"><code>Map&lt;String, String&gt; vars = new HashMap&lt;String, String&gt;();
vars.put(&#34;hotel&#34;, &#34;42&#34;);
vars.put(&#34;booking&#34;, &#34;21&#34;);
String result = restTemplate.getForObject(&#34;http://example.com/hotels/{hotel}/bookings/{booking}&#34;, 
    String.class, vars);
//å®é™…æ•ˆæœç­‰åŒäºï¼šGET http://example.com/hotels/42/rooms/42
</code></pre><h3 id="52-æ–‡ä»¶ä¸Šä¼ æ³¨æ„ç‚¹">5.2. æ–‡ä»¶ä¸Šä¼ æ³¨æ„ç‚¹ <a href="#52-%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e6%b3%a8%e6%84%8f%e7%82%b9" class="anchor">ğŸ”—</a></h3><ul>
<li>å¦‚æœä½¿ç”¨äº†æœ¬åœ°ä¸´æ—¶æ–‡ä»¶ï¼Œä¸€å®šè¦åœ¨finallyä»£ç å—ä¸­åˆ é™¤ï¼Œå¦åˆ™å¯èƒ½ä¼šæ’‘çˆ†ç£ç›˜</li>
</ul>
<h2 id="6-faq">6. FAQ <a href="#6-faq" class="anchor">ğŸ”—</a></h2><h3 id="61-è·å–çŠ¶æ€ç ">6.1. è·å–çŠ¶æ€ç  <a href="#61-%e8%8e%b7%e5%8f%96%e7%8a%b6%e6%80%81%e7%a0%81" class="anchor">ğŸ”—</a></h3><p>ä½¿ç”¨xxForEntityç±»æ–¹æ³•è°ƒç”¨æ¥å£ï¼Œå°†è¿”å›ResponseEntityå¯¹è±¡ï¼Œé€šè¿‡å®ƒèƒ½å–åˆ°çŠ¶æ€ç ã€‚</p>
<pre tabindex="0"><code>//åˆ¤æ–­æ¥å£è¿”å›æ˜¯å¦ä¸º200
public static Boolean ping(){
    String url = &#34;xxx&#34;;
    try{
        ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(url, String.class);
        HttpStatus status = responseEntity.getStatusCode();//è·å–è¿”å›çŠ¶æ€
        return status.is2xxSuccessful();//åˆ¤æ–­çŠ¶æ€ç æ˜¯å¦ä¸º2å¼€å¤´çš„
    }catch(Exception e){
        log.error(&#34;å¤„ç†å¤±è´¥: {}&#34;, url, e);
        return false; //502 ,500æ˜¯ä¸èƒ½æ­£å¸¸è¿”å›ç»“æœçš„ï¼Œéœ€è¦catchä½ï¼Œè¿”å›ä¸€ä¸ªfalse
    }
}
</code></pre><h3 id="62-æˆ‘éœ€è¦æ‰‹å·¥é‡Šæ”¾è¿æ¥å—">6.2. æˆ‘éœ€è¦æ‰‹å·¥é‡Šæ”¾è¿æ¥å—ï¼Ÿ <a href="#62-%e6%88%91%e9%9c%80%e8%a6%81%e6%89%8b%e5%b7%a5%e9%87%8a%e6%94%be%e8%bf%9e%e6%8e%a5%e5%90%97" class="anchor">ğŸ”—</a></h3><ul>
<li>ä¸éœ€è¦ï¼Œrest templateä¼šå¸®æˆ‘ä»¬é‡Šæ”¾ï¼Œå…·ä½“è¯·çœ‹ï¼š<a href="https://stackoverflow.com/questions/40161117/spring-resttemplate-need-to-release-connection">spring-resttemplate-need-to-release-connection ?</a></li>
</ul>
<h3 id="62-å¦‚ä½•è°ƒè¯•rest-template">6.2. å¦‚ä½•è°ƒè¯•rest template <a href="#62-%e5%a6%82%e4%bd%95%e8%b0%83%e8%af%95rest-template" class="anchor">ğŸ”—</a></h3><p>å¯ä»¥åœ¨logbacké‡Œå•ç‹¬é…ä¸€ä¸ªdebugçº§åˆ«çš„loggerï¼ŒæŠŠorg.apache.httpä¸‹é¢çš„æ—¥å¿—å®šå‘åˆ°æ§åˆ¶å°ï¼š</p>
<pre tabindex="0"><code>&lt;logger name=&#34;org.apache.http&#34; level=&#34;DEBUG&#34; additivity=&#34;false&#34;&gt;
    &lt;appender-ref ref=&#34;STDOUT&#34; /&gt;
&lt;/logger&gt;
</code></pre>
    </div>

    
</section>


            </div>
            <div class="side">
                <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/ai">ai(3)</a>
            </li>
        
            <li>
                <a href="/categories/go">go(23)</a>
            </li>
        
            <li>
                <a href="/categories/%E4%BB%A3%E7%A0%81">ä»£ç (2)</a>
            </li>
        
            <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7">å·¥å…·(8)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%80%86%E5%90%91">é€†å‘(3)</a>
            </li>
        
            <li>
                <a href="/categories/%E9%9D%A2%E8%AF%95">é¢è¯•(5)</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/note/">Recent Note</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/note/%E6%9E%B6%E6%9E%84%E8%80%83%E7%82%B9/">åœºæ™¯æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/rdis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E9%9B%AA%E5%B4%A9%E5%87%BB%E7%A9%BF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿çš„è§£å†³æ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/note/redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/">å•çº¿ç¨‹çš„redisä¸ºä»€ä¹ˆå¿«</a>
            </li>
        
            <li>
                <a href="/note/redis-%E6%80%BB%E7%BB%93/">redisæ€»ç»“</a>
            </li>
        
            <li>
                <a href="/note/mysql-%E6%80%BB%E7%BB%93/">mysqlæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/android/">Recent Android</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/android/redroid%E4%BD%BF%E7%94%A8/">Redroidå®‰å“å®¹å™¨</a>
            </li>
        
            <li>
                <a href="/android/%E5%85%A5%E9%97%A8/">é€†å‘ç¯å¢ƒ-æ‚</a>
            </li>
        
            <li>
                <a href="/android/frida%E6%95%99%E7%A8%8B/">fridaæ•™ç¨‹</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/tool/">Recent Tool</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tool/linux-almalinux%E4%BC%98%E5%8C%96/">AlmaLinux10</a>
            </li>
        
            <li>
                <a href="/tool/almalinux-k8s/">AlmaLinux-k8så®‰è£…</a>
            </li>
        
            <li>
                <a href="/tool/vscode%E6%8A%98%E8%85%BE/">vscodeæŠ˜è…¾</a>
            </li>
        
            <li>
                <a href="/tool/linux-ubuntu%E4%BC%98%E5%8C%96/">Ubuntuå¼€æœºä¼˜åŒ–</a>
            </li>
        
            <li>
                <a href="/tool/shell-ssh_script/">sshå¸¸ç”¨è„šæœ¬</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/llm/">Recent Llm</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/llm/transformers-%E5%85%A5%E9%97%A8%E7%AF%87/">Transformers-å…¥é—¨ç¯‡</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8Bvllm%E9%83%A8%E7%BD%B2/">AIæ¨¡å‹VLLMéƒ¨ç½²</a>
            </li>
        
            <li>
                <a href="/llm/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">AIæ¨¡å‹å¾®è°ƒ</a>
            </li>
        
    </ul>
</div>

                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/go/">Recent Go</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/go/go%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B7%B7%E5%90%88%E5%86%99%E5%B1%8F%E9%9A%9Cgc%E6%A8%A1%E5%BC%8F%E5%85%A8%E6%80%BB%E7%BB%93/">Goä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨æ€»ç»“</a>
            </li>
        
            <li>
                <a href="/go/go%E4%B8%ADmake%E4%B8%8Enew%E5%8C%BA%E5%88%AB/">Goä¸­makeä¸newåŒºåˆ«</a>
            </li>
        
            <li>
                <a href="/go/go%E5%B8%B8%E7%94%A8bug%E5%92%8C%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5%E6%96%B9%E6%B3%95/">Goå¸¸ç”¨bugå’Œæ€§èƒ½é—®é¢˜çš„å®è·µæ–¹æ³•</a>
            </li>
        
            <li>
                <a href="/go/grpc%E6%80%BB%E7%BB%93/">GRPCç¬”è®°</a>
            </li>
        
            <li>
                <a href="/go/go%E7%9A%84defer%E6%80%BB%E7%BB%93/">Goçš„deferæ€»ç»“</a>
            </li>
        
    </ul>
</div>

                
            </div>
        </main>
        <footer class="footer">
    <div class="footer-row">
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/note/index.xml">
                    Feed of Note
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/android/index.xml">
                    Feed of Android
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/tool/index.xml">
                    Feed of Tool
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/llm/index.xml">
                    Feed of Llm
                    <i class="icofont-rss"></i>
                </a>
            
        
            
            
                <a class="footer-item" href="https://abnerxc.github.io/go/index.xml">
                    Feed of Go
                    <i class="icofont-rss"></i>
                </a>
            
        

        
            
            
        
    </div>

    
</footer>

    </body>
</html>
